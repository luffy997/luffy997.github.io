

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Luffy997">
  <meta name="keywords" content="">
  
    <meta name="description" content="整体架构概览类继承关系12345678910111213141516171819# 基础抽象类HttpResponseBase (six.Iterator)├── HttpResponse                    # 标准HTTP响应├── StreamingHttpResponse          # 流式HTTP响应│   └── FileResponse">
<meta property="og:type" content="article">
<meta property="og:title" content="Django HTTP Response">
<meta property="og:url" content="https://luffy997.github.io/2025/07/07/Django-HTTP-Response/index.html">
<meta property="og:site_name" content="Luffy997&#39;s Blog">
<meta property="og:description" content="整体架构概览类继承关系12345678910111213141516171819# 基础抽象类HttpResponseBase (six.Iterator)├── HttpResponse                    # 标准HTTP响应├── StreamingHttpResponse          # 流式HTTP响应│   └── FileResponse">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s21.ax1x.com/2025/04/30/pEHJjt1.png">
<meta property="article:published_time" content="2025-07-07T13:12:34.000Z">
<meta property="article:modified_time" content="2026-01-07T14:27:31.580Z">
<meta property="article:author" content="Luffy997">
<meta property="article:tag" content="Django">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s21.ax1x.com/2025/04/30/pEHJjt1.png">
  
  
  
  <title>Django HTTP Response - Luffy997&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"luffy997.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Luffy997的博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Django HTTP Response"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-07-07 21:12" pubdate>
          2025年7月7日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          2.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          25 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Django HTTP Response</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="整体架构概览"><a href="#整体架构概览" class="headerlink" title="整体架构概览"></a>整体架构概览</h2><h3 id="类继承关系"><a href="#类继承关系" class="headerlink" title="类继承关系"></a>类继承关系</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 基础抽象类</span><br>HttpResponseBase (six.Iterator)<br>├── HttpResponse                    <span class="hljs-comment"># 标准HTTP响应</span><br>├── StreamingHttpResponse          <span class="hljs-comment"># 流式HTTP响应</span><br>│   └── FileResponse              <span class="hljs-comment"># 文件响应优化</span><br>└── HttpResponseRedirectBase       <span class="hljs-comment"># 重定向响应基类</span><br>    ├── HttpResponseRedirect       <span class="hljs-comment"># 临时重定向 (302)</span><br>    └── HttpResponsePermanentRedirect <span class="hljs-comment"># 永久重定向 (301)</span><br><br><span class="hljs-comment"># 具体状态码响应类</span><br>HttpResponse<br>├── HttpResponseNotModified        <span class="hljs-comment"># 304</span><br>├── HttpResponseBadRequest         <span class="hljs-comment"># 400</span><br>├── HttpResponseForbidden          <span class="hljs-comment"># 403</span><br>├── HttpResponseNotFound           <span class="hljs-comment"># 404</span><br>├── HttpResponseNotAllowed         <span class="hljs-comment"># 405</span><br>├── HttpResponseGone              <span class="hljs-comment"># 410</span><br>├── HttpResponseServerError        <span class="hljs-comment"># 500</span><br>└── JsonResponse                  <span class="hljs-comment"># JSON响应</span><br></code></pre></td></tr></table></figure>

<h2 id="HttpResponseBase-基础类详解"><a href="#HttpResponseBase-基础类详解" class="headerlink" title="HttpResponseBase 基础类详解"></a>HttpResponseBase 基础类详解</h2><h3 id="1-核心设计思想"><a href="#1-核心设计思想" class="headerlink" title="1. 核心设计思想"></a>1. <strong>核心设计思想</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponseBase</span>(six.Iterator):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    HTTP响应基类，提供字典式的头部访问接口</span><br><span class="hljs-string">    这个类不处理内容，不应直接使用</span><br><span class="hljs-string">    应该使用HttpResponse和StreamingHttpResponse子类</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    status_code = <span class="hljs-number">200</span><br></code></pre></td></tr></table></figure>

<p><strong>设计特点</strong>：</p>
<ul>
<li>继承自 <code>six.Iterator</code>，支持迭代器协议</li>
<li>只处理HTTP头部和状态码，不处理响应体</li>
<li>提供统一的HTTP响应接口</li>
</ul>
<h3 id="2-初始化过程"><a href="#2-初始化过程" class="headerlink" title="2. 初始化过程"></a>2. <strong>初始化过程</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, content_type=<span class="hljs-literal">None</span>, status=<span class="hljs-literal">None</span>, reason=<span class="hljs-literal">None</span>, charset=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-comment"># _headers: 存储HTTP头部的映射</span><br>    <span class="hljs-comment"># 键是小写的头部名称，值是(原始大小写名称, 头部值)的元组</span><br>    <span class="hljs-variable language_">self</span>._headers = &#123;&#125;<br>    <br>    <span class="hljs-comment"># 需要关闭的对象列表（如文件句柄）</span><br>    <span class="hljs-variable language_">self</span>._closable_objects = []<br>    <br>    <span class="hljs-comment"># 处理器类（用于request_finished信号）</span><br>    <span class="hljs-variable language_">self</span>._handler_class = <span class="hljs-literal">None</span><br>    <br>    <span class="hljs-comment"># Cookie容器</span><br>    <span class="hljs-variable language_">self</span>.cookies = SimpleCookie()<br>    <br>    <span class="hljs-comment"># 关闭状态标志</span><br>    <span class="hljs-variable language_">self</span>.closed = <span class="hljs-literal">False</span><br>    <br>    <span class="hljs-comment"># 状态码验证</span><br>    <span class="hljs-keyword">if</span> status <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-variable language_">self</span>.status_code = <span class="hljs-built_in">int</span>(status)<br>        <span class="hljs-keyword">except</span> (ValueError, TypeError):<br>            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">&#x27;HTTP status code must be an integer.&#x27;</span>)<br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">100</span> &lt;= <span class="hljs-variable language_">self</span>.status_code &lt;= <span class="hljs-number">599</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;HTTP status code must be an integer from 100 to 599.&#x27;</span>)<br>    <br>    <span class="hljs-comment"># 设置默认Content-Type</span><br>    <span class="hljs-keyword">if</span> content_type <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        content_type = <span class="hljs-string">&#x27;%s; charset=%s&#x27;</span> % (settings.DEFAULT_CONTENT_TYPE, <span class="hljs-variable language_">self</span>.charset)<br>    <span class="hljs-variable language_">self</span>[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] = content_type<br></code></pre></td></tr></table></figure>

<p><strong>关键特性</strong>：</p>
<ul>
<li><strong>状态码验证</strong>：确保状态码在100-599范围内</li>
<li><strong>字符集处理</strong>：自动设置默认字符集</li>
<li><strong>资源管理</strong>：维护需要关闭的对象列表</li>
</ul>
<h3 id="3-HTTP头部处理"><a href="#3-HTTP头部处理" class="headerlink" title="3. HTTP头部处理"></a>3. <strong>HTTP头部处理</strong></h3><h4 id="3-1-字典式接口"><a href="#3-1-字典式接口" class="headerlink" title="3.1 字典式接口"></a>3.1 字典式接口</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__setitem__</span>(<span class="hljs-params">self, header, value</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;设置HTTP头部&quot;&quot;&quot;</span><br>    header = <span class="hljs-variable language_">self</span>._convert_to_charset(header, <span class="hljs-string">&#x27;ascii&#x27;</span>)<br>    value = <span class="hljs-variable language_">self</span>._convert_to_charset(value, <span class="hljs-string">&#x27;latin-1&#x27;</span>, mime_encode=<span class="hljs-literal">True</span>)<br>    <span class="hljs-comment"># 存储：小写键 -&gt; (原始键, 值)</span><br>    <span class="hljs-variable language_">self</span>._headers[header.lower()] = (header, value)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, header</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;获取HTTP头部值&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._headers[header.lower()][<span class="hljs-number">1</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__delitem__</span>(<span class="hljs-params">self, header</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;删除HTTP头部&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">del</span> <span class="hljs-variable language_">self</span>._headers[header.lower()]<br>    <span class="hljs-keyword">except</span> KeyError:<br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">has_header</span>(<span class="hljs-params">self, header</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;检查是否存在某个头部（大小写不敏感）&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> header.lower() <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>._headers<br></code></pre></td></tr></table></figure>

<p><strong>设计亮点</strong>：</p>
<ul>
<li><strong>大小写不敏感</strong>：HTTP头部名称不区分大小写</li>
<li><strong>原始格式保留</strong>：保持原始的大小写格式，兼容老系统</li>
<li><strong>编码安全</strong>：自动处理ASCII和Latin-1编码</li>
</ul>
<h4 id="3-2-编码转换机制"><a href="#3-2-编码转换机制" class="headerlink" title="3.2 编码转换机制"></a>3.2 编码转换机制</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_convert_to_charset</span>(<span class="hljs-params">self, value, charset, mime_encode=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;将头部键/值转换为ascii/latin-1本地字符串&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, (<span class="hljs-built_in">bytes</span>, six.text_type)):<br>        value = <span class="hljs-built_in">str</span>(value)<br>    <br>    <span class="hljs-comment"># 防止头部注入攻击</span><br>    <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">isinstance</span>(value, <span class="hljs-built_in">bytes</span>) <span class="hljs-keyword">and</span> (<span class="hljs-string">b&#x27;\n&#x27;</span> <span class="hljs-keyword">in</span> value <span class="hljs-keyword">or</span> <span class="hljs-string">b&#x27;\r&#x27;</span> <span class="hljs-keyword">in</span> value)) <span class="hljs-keyword">or</span><br>            <span class="hljs-built_in">isinstance</span>(value, six.text_type) <span class="hljs-keyword">and</span> (<span class="hljs-string">&#x27;\n&#x27;</span> <span class="hljs-keyword">in</span> value <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;\r&#x27;</span> <span class="hljs-keyword">in</span> value)):<br>        <span class="hljs-keyword">raise</span> BadHeaderError(<span class="hljs-string">&quot;Header values can&#x27;t contain newlines (got %r)&quot;</span> % value)<br>    <br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> six.PY3:<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(value, <span class="hljs-built_in">str</span>):<br>                value.encode(charset)  <span class="hljs-comment"># 验证编码</span><br>            <span class="hljs-keyword">else</span>:<br>                value = value.decode(charset)  <span class="hljs-comment"># 解码字节串</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># Python 2处理逻辑</span><br>            <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">except</span> UnicodeError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">if</span> mime_encode:<br>            <span class="hljs-comment"># MIME编码处理非ASCII字符</span><br>            value = <span class="hljs-built_in">str</span>(Header(value, <span class="hljs-string">&#x27;utf-8&#x27;</span>, maxlinelen=sys.maxsize).encode())<br>        <span class="hljs-keyword">else</span>:<br>            e.reason += <span class="hljs-string">&#x27;, HTTP response headers must be in %s format&#x27;</span> % charset<br>            <span class="hljs-keyword">raise</span><br>    <span class="hljs-keyword">return</span> value<br></code></pre></td></tr></table></figure>

<p><strong>安全特性</strong>：</p>
<ul>
<li><strong>头部注入防护</strong>：检测并阻止换行符注入</li>
<li><strong>编码验证</strong>：确保头部值符合HTTP标准</li>
<li><strong>MIME编码支持</strong>：自动处理非ASCII字符</li>
</ul>
<h3 id="4-Cookie处理机制"><a href="#4-Cookie处理机制" class="headerlink" title="4. Cookie处理机制"></a>4. <strong>Cookie处理机制</strong></h3><h4 id="4-1-基本Cookie设置"><a href="#4-1-基本Cookie设置" class="headerlink" title="4.1 基本Cookie设置"></a>4.1 基本Cookie设置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_cookie</span>(<span class="hljs-params">self, key, value=<span class="hljs-string">&#x27;&#x27;</span>, max_age=<span class="hljs-literal">None</span>, expires=<span class="hljs-literal">None</span>, path=<span class="hljs-string">&#x27;/&#x27;</span>,</span><br><span class="hljs-params">               domain=<span class="hljs-literal">None</span>, secure=<span class="hljs-literal">False</span>, httponly=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;设置Cookie&quot;&quot;&quot;</span><br>    value = force_str(value)<br>    <span class="hljs-variable language_">self</span>.cookies[key] = value<br>    <br>    <span class="hljs-comment"># 处理过期时间</span><br>    <span class="hljs-keyword">if</span> expires <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(expires, datetime.datetime):<br>            <span class="hljs-keyword">if</span> timezone.is_aware(expires):<br>                expires = timezone.make_naive(expires, timezone.utc)<br>            delta = expires - expires.utcnow()<br>            <span class="hljs-comment"># 添加一秒确保时间匹配</span><br>            delta = delta + datetime.timedelta(seconds=<span class="hljs-number">1</span>)<br>            expires = <span class="hljs-literal">None</span><br>            max_age = <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, delta.days * <span class="hljs-number">86400</span> + delta.seconds)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;expires&#x27;</span>] = expires<br>    <br>    <span class="hljs-comment"># 设置各种Cookie属性</span><br>    <span class="hljs-keyword">if</span> max_age <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;max-age&#x27;</span>] = max_age<br>        <span class="hljs-comment"># IE需要expires，如果没有设置则自动添加</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> expires:<br>            <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;expires&#x27;</span>] = cookie_date(time.time() + max_age)<br>    <br>    <span class="hljs-keyword">if</span> path <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;path&#x27;</span>] = path<br>    <span class="hljs-keyword">if</span> domain <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;domain&#x27;</span>] = domain<br>    <span class="hljs-keyword">if</span> secure:<br>        <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;secure&#x27;</span>] = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">if</span> httponly:<br>        <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;httponly&#x27;</span>] = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>

<h4 id="4-2-签名Cookie支持"><a href="#4-2-签名Cookie支持" class="headerlink" title="4.2 签名Cookie支持"></a>4.2 签名Cookie支持</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_signed_cookie</span>(<span class="hljs-params">self, key, value, salt=<span class="hljs-string">&#x27;&#x27;</span>, **kwargs</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;设置签名Cookie，防止篡改&quot;&quot;&quot;</span><br>    value = signing.get_cookie_signer(salt=key + salt).sign(value)<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.set_cookie(key, value, **kwargs)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_cookie</span>(<span class="hljs-params">self, key, path=<span class="hljs-string">&#x27;/&#x27;</span>, domain=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;删除Cookie（通过设置过期时间为过去）&quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>.set_cookie(key, max_age=<span class="hljs-number">0</span>, path=path, domain=domain,<br>                    expires=<span class="hljs-string">&#x27;Thu, 01-Jan-1970 00:00:00 GMT&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p><strong>安全考虑</strong>：</p>
<ul>
<li><strong>签名验证</strong>：防止客户端篡改Cookie值</li>
<li><strong>盐值支持</strong>：增强签名安全性</li>
<li><strong>安全属性</strong>：支持Secure和HttpOnly标志</li>
</ul>
<h3 id="5-资源管理"><a href="#5-资源管理" class="headerlink" title="5. 资源管理"></a>5. <strong>资源管理</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">close</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;关闭响应，清理资源&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> closable <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>._closable_objects:<br>        <span class="hljs-keyword">try</span>:<br>            closable.close()<br>        <span class="hljs-keyword">except</span> Exception:<br>            <span class="hljs-keyword">pass</span><br>    <span class="hljs-variable language_">self</span>.closed = <span class="hljs-literal">True</span><br>    <span class="hljs-comment"># 发送请求完成信号</span><br>    signals.request_finished.send(sender=<span class="hljs-variable language_">self</span>._handler_class)<br></code></pre></td></tr></table></figure>

<p><strong>重要性</strong>：</p>
<ul>
<li><strong>文件句柄清理</strong>：确保文件等资源正确释放</li>
<li><strong>信号发送</strong>：通知Django请求处理完成</li>
<li><strong>异常安全</strong>：即使关闭失败也不影响其他资源</li>
</ul>
<h2 id="HttpResponse-标准响应类"><a href="#HttpResponse-标准响应类" class="headerlink" title="HttpResponse 标准响应类"></a>HttpResponse 标准响应类</h2><h3 id="1-内容管理"><a href="#1-内容管理" class="headerlink" title="1. 内容管理"></a>1. <strong>内容管理</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponse</span>(<span class="hljs-title class_ inherited__">HttpResponseBase</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;带有字符串内容的HTTP响应类&quot;&quot;&quot;</span><br>    streaming = <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, content=<span class="hljs-string">b&#x27;&#x27;</span>, *args, **kwargs</span>):<br>        <span class="hljs-built_in">super</span>(HttpResponse, <span class="hljs-variable language_">self</span>).__init__(*args, **kwargs)<br>        <span class="hljs-variable language_">self</span>.content = content<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">content</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;获取完整内容&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;&#x27;</span>.join(<span class="hljs-variable language_">self</span>._container)<br><br><span class="hljs-meta">    @content.setter</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">content</span>(<span class="hljs-params">self, value</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;设置内容，支持迭代器&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(value, <span class="hljs-string">&#x27;__iter__&#x27;</span>) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, (<span class="hljs-built_in">bytes</span>, six.string_types)):<br>            <span class="hljs-comment"># 处理迭代器内容</span><br>            content = <span class="hljs-string">b&#x27;&#x27;</span>.join(<span class="hljs-variable language_">self</span>.make_bytes(chunk) <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> value)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(value, <span class="hljs-string">&#x27;close&#x27;</span>):<br>                <span class="hljs-keyword">try</span>:<br>                    value.close()<br>                <span class="hljs-keyword">except</span> Exception:<br>                    <span class="hljs-keyword">pass</span><br>        <span class="hljs-keyword">else</span>:<br>            content = <span class="hljs-variable language_">self</span>.make_bytes(value)<br>        <br>        <span class="hljs-comment"># 创建正确编码的字节串列表</span><br>        <span class="hljs-variable language_">self</span>._container = [content]<br></code></pre></td></tr></table></figure>

<p><strong>设计特点</strong>：</p>
<ul>
<li><strong>统一字节处理</strong>：所有内容最终转换为字节串</li>
<li><strong>迭代器支持</strong>：可以接受迭代器作为内容</li>
<li><strong>资源清理</strong>：自动关闭可关闭的内容对象</li>
</ul>
<h3 id="2-可写接口"><a href="#2-可写接口" class="headerlink" title="2. 可写接口"></a>2. <strong>可写接口</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">write</span>(<span class="hljs-params">self, content</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;追加内容到响应&quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>._container.append(<span class="hljs-variable language_">self</span>.make_bytes(content))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">writelines</span>(<span class="hljs-params">self, lines</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;写入多行内容&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>        <span class="hljs-variable language_">self</span>.write(line)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">writable</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;指示响应是否可写&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>

<h3 id="3-序列化"><a href="#3-序列化" class="headerlink" title="3. 序列化"></a>3. <strong>序列化</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">serialize</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;完整的HTTP消息，包括头部，作为字节串&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.serialize_headers() + <span class="hljs-string">b&#x27;\r\n\r\n&#x27;</span> + <span class="hljs-variable language_">self</span>.content<br></code></pre></td></tr></table></figure>

<h2 id="StreamingHttpResponse-流式响应"><a href="#StreamingHttpResponse-流式响应" class="headerlink" title="StreamingHttpResponse 流式响应"></a>StreamingHttpResponse 流式响应</h2><h3 id="1-设计目标"><a href="#1-设计目标" class="headerlink" title="1. 设计目标"></a>1. <strong>设计目标</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamingHttpResponse</span>(<span class="hljs-title class_ inherited__">HttpResponseBase</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    带有迭代器内容的流式HTTP响应类</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    只应该迭代一次，当响应流式传输到客户端时</span><br><span class="hljs-string">    但是可以被追加或替换为包装原始内容的新迭代器</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    streaming = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>

<p><strong>适用场景</strong>：</p>
<ul>
<li>大文件下载</li>
<li>实时数据流</li>
<li>内存敏感的响应</li>
</ul>
<h3 id="2-流式内容处理"><a href="#2-流式内容处理" class="headerlink" title="2. 流式内容处理"></a>2. <strong>流式内容处理</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">streaming_content</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;流式内容属性&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">map</span>(<span class="hljs-variable language_">self</span>.make_bytes, <span class="hljs-variable language_">self</span>._iterator)<br><br><span class="hljs-meta">@streaming_content.setter</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">streaming_content</span>(<span class="hljs-params">self, value</span>):<br>    <span class="hljs-variable language_">self</span>._set_streaming_content(value)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_set_streaming_content</span>(<span class="hljs-params">self, value</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;设置流式内容&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 确保永远不能在&quot;value&quot;上迭代超过一次</span><br>    <span class="hljs-variable language_">self</span>._iterator = <span class="hljs-built_in">iter</span>(value)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(value, <span class="hljs-string">&#x27;close&#x27;</span>):<br>        <span class="hljs-variable language_">self</span>._closable_objects.append(value)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.streaming_content<br><br><span class="hljs-meta">@property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">content</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;流式响应没有content属性&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">raise</span> AttributeError(<br>        <span class="hljs-string">&quot;This %s instance has no `content` attribute. Use &quot;</span><br>        <span class="hljs-string">&quot;`streaming_content` instead.&quot;</span> % <span class="hljs-variable language_">self</span>.__class__.__name__<br>    )<br></code></pre></td></tr></table></figure>

<p><strong>关键特性</strong>：</p>
<ul>
<li><strong>一次性迭代</strong>：防止重复消费流内容</li>
<li><strong>延迟处理</strong>：内容按需生成和传输</li>
<li><strong>资源管理</strong>：自动管理流对象的生命周期</li>
</ul>
<h2 id="FileResponse-文件响应优化"><a href="#FileResponse-文件响应优化" class="headerlink" title="FileResponse 文件响应优化"></a>FileResponse 文件响应优化</h2><h3 id="1-文件特化处理"><a href="#1-文件特化处理" class="headerlink" title="1. 文件特化处理"></a>1. <strong>文件特化处理</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileResponse</span>(<span class="hljs-title class_ inherited__">StreamingHttpResponse</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;为文件优化的流式HTTP响应类&quot;&quot;&quot;</span><br>    block_size = <span class="hljs-number">4096</span>  <span class="hljs-comment"># 4KB块大小</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_set_streaming_content</span>(<span class="hljs-params">self, value</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(value, <span class="hljs-string">&#x27;read&#x27;</span>):<br>            <span class="hljs-comment"># 文件对象处理</span><br>            <span class="hljs-variable language_">self</span>.file_to_stream = value<br>            filelike = value<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(filelike, <span class="hljs-string">&#x27;close&#x27;</span>):<br>                <span class="hljs-variable language_">self</span>._closable_objects.append(filelike)<br>            <span class="hljs-comment"># 创建分块读取迭代器</span><br>            value = <span class="hljs-built_in">iter</span>(<span class="hljs-keyword">lambda</span>: filelike.read(<span class="hljs-variable language_">self</span>.block_size), <span class="hljs-string">b&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.file_to_stream = <span class="hljs-literal">None</span><br>        <span class="hljs-built_in">super</span>(FileResponse, <span class="hljs-variable language_">self</span>)._set_streaming_content(value)<br></code></pre></td></tr></table></figure>

<p><strong>优化特性</strong>：</p>
<ul>
<li><strong>分块读取</strong>：避免大文件一次性加载到内存</li>
<li><strong>WSGI优化</strong>：<code>file_to_stream</code>属性可被WSGI服务器优化使用</li>
<li><strong>自动清理</strong>：确保文件句柄正确关闭</li>
</ul>
<h2 id="重定向响应系列"><a href="#重定向响应系列" class="headerlink" title="重定向响应系列"></a>重定向响应系列</h2><h3 id="1-基础重定向类"><a href="#1-基础重定向类" class="headerlink" title="1. 基础重定向类"></a>1. <strong>基础重定向类</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponseRedirectBase</span>(<span class="hljs-title class_ inherited__">HttpResponse</span>):<br>    allowed_schemes = [<span class="hljs-string">&#x27;http&#x27;</span>, <span class="hljs-string">&#x27;https&#x27;</span>, <span class="hljs-string">&#x27;ftp&#x27;</span>]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, redirect_to, *args, **kwargs</span>):<br>        <span class="hljs-built_in">super</span>(HttpResponseRedirectBase, <span class="hljs-variable language_">self</span>).__init__(*args, **kwargs)<br>        <span class="hljs-variable language_">self</span>[<span class="hljs-string">&#x27;Location&#x27;</span>] = iri_to_uri(redirect_to)<br>        <br>        <span class="hljs-comment"># 安全检查：验证重定向URL的协议</span><br>        parsed = urlparse(force_text(redirect_to))<br>        <span class="hljs-keyword">if</span> parsed.scheme <span class="hljs-keyword">and</span> parsed.scheme <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.allowed_schemes:<br>            <span class="hljs-keyword">raise</span> DisallowedRedirect(<span class="hljs-string">&quot;Unsafe redirect to URL with protocol &#x27;%s&#x27;&quot;</span> % parsed.scheme)<br><br>    url = <span class="hljs-built_in">property</span>(<span class="hljs-keyword">lambda</span> <span class="hljs-variable language_">self</span>: <span class="hljs-variable language_">self</span>[<span class="hljs-string">&#x27;Location&#x27;</span>])<br></code></pre></td></tr></table></figure>

<p><strong>安全特性</strong>：</p>
<ul>
<li><strong>协议白名单</strong>：只允许安全的URL协议</li>
<li><strong>开放重定向防护</strong>：防止恶意重定向攻击</li>
</ul>
<h3 id="2-具体重定向类"><a href="#2-具体重定向类" class="headerlink" title="2. 具体重定向类"></a>2. <strong>具体重定向类</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponseRedirect</span>(<span class="hljs-title class_ inherited__">HttpResponseRedirectBase</span>):<br>    status_code = <span class="hljs-number">302</span>  <span class="hljs-comment"># 临时重定向</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponsePermanentRedirect</span>(<span class="hljs-title class_ inherited__">HttpResponseRedirectBase</span>):<br>    status_code = <span class="hljs-number">301</span>  <span class="hljs-comment"># 永久重定向</span><br></code></pre></td></tr></table></figure>

<h2 id="状态码响应类"><a href="#状态码响应类" class="headerlink" title="状态码响应类"></a>状态码响应类</h2><h3 id="1-特殊状态处理"><a href="#1-特殊状态处理" class="headerlink" title="1. 特殊状态处理"></a>1. <strong>特殊状态处理</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponseNotModified</span>(<span class="hljs-title class_ inherited__">HttpResponse</span>):<br>    status_code = <span class="hljs-number">304</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>):<br>        <span class="hljs-built_in">super</span>(HttpResponseNotModified, <span class="hljs-variable language_">self</span>).__init__(*args, **kwargs)<br>        <span class="hljs-comment"># 304响应不应该有Content-Type头</span><br>        <span class="hljs-keyword">del</span> <span class="hljs-variable language_">self</span>[<span class="hljs-string">&#x27;content-type&#x27;</span>]<br><br><span class="hljs-meta">    @HttpResponse.content.setter</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">content</span>(<span class="hljs-params">self, value</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;304响应不能有内容&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> value:<br>            <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">&quot;You cannot set content to a 304 (Not Modified) response&quot;</span>)<br>        <span class="hljs-variable language_">self</span>._container = []<br></code></pre></td></tr></table></figure>

<h3 id="2-方法不允许响应"><a href="#2-方法不允许响应" class="headerlink" title="2. 方法不允许响应"></a>2. <strong>方法不允许响应</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponseNotAllowed</span>(<span class="hljs-title class_ inherited__">HttpResponse</span>):<br>    status_code = <span class="hljs-number">405</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, permitted_methods, *args, **kwargs</span>):<br>        <span class="hljs-built_in">super</span>(HttpResponseNotAllowed, <span class="hljs-variable language_">self</span>).__init__(*args, **kwargs)<br>        <span class="hljs-comment"># 必须包含Allow头，列出允许的方法</span><br>        <span class="hljs-variable language_">self</span>[<span class="hljs-string">&#x27;Allow&#x27;</span>] = <span class="hljs-string">&#x27;, &#x27;</span>.join(permitted_methods)<br></code></pre></td></tr></table></figure>

<h2 id="JsonResponse-JSON响应"><a href="#JsonResponse-JSON响应" class="headerlink" title="JsonResponse JSON响应"></a>JsonResponse JSON响应</h2><h3 id="1-JSON特化处理"><a href="#1-JSON特化处理" class="headerlink" title="1. JSON特化处理"></a>1. <strong>JSON特化处理</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonResponse</span>(<span class="hljs-title class_ inherited__">HttpResponse</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;消费数据并序列化为JSON的HTTP响应类&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data, encoder=DjangoJSONEncoder, safe=<span class="hljs-literal">True</span>,</span><br><span class="hljs-params">                 json_dumps_params=<span class="hljs-literal">None</span>, **kwargs</span>):<br>        <span class="hljs-comment"># 安全检查：默认只允许dict对象</span><br>        <span class="hljs-keyword">if</span> safe <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(data, <span class="hljs-built_in">dict</span>):<br>            <span class="hljs-keyword">raise</span> TypeError(<br>                <span class="hljs-string">&#x27;In order to allow non-dict objects to be serialized set the &#x27;</span><br>                <span class="hljs-string">&#x27;safe parameter to False.&#x27;</span><br>            )<br>        <br>        <span class="hljs-keyword">if</span> json_dumps_params <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            json_dumps_params = &#123;&#125;<br>        <br>        <span class="hljs-comment"># 设置JSON内容类型</span><br>        kwargs.setdefault(<span class="hljs-string">&#x27;content_type&#x27;</span>, <span class="hljs-string">&#x27;application/json&#x27;</span>)<br>        <br>        <span class="hljs-comment"># 序列化数据</span><br>        data = json.dumps(data, cls=encoder, **json_dumps_params)<br>        <span class="hljs-built_in">super</span>(JsonResponse, <span class="hljs-variable language_">self</span>).__init__(content=data, **kwargs)<br></code></pre></td></tr></table></figure>

<p><strong>安全特性</strong>：</p>
<ul>
<li><strong>类型限制</strong>：默认只允许dict类型，防止数组JSON劫持</li>
<li><strong>自定义编码器</strong>：支持Django的JSON编码器</li>
<li><strong>内容类型自动设置</strong>：确保正确的MIME类型</li>
</ul>
<h2 id="工具函数和异常"><a href="#工具函数和异常" class="headerlink" title="工具函数和异常"></a>工具函数和异常</h2><h3 id="1-异常类"><a href="#1-异常类" class="headerlink" title="1. 异常类"></a>1. <strong>异常类</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BadHeaderError</span>(<span class="hljs-title class_ inherited__">ValueError</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;HTTP头部格式错误&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Http404</span>(<span class="hljs-title class_ inherited__">Exception</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;404错误的快捷异常&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure>

<h3 id="2-字符集检测"><a href="#2-字符集检测" class="headerlink" title="2. 字符集检测"></a>2. <strong>字符集检测</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">_charset_from_content_type_re = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;;\s*charset=(?P&lt;charset&gt;[^\s;]+)&#x27;</span>, re.I)<br><br><span class="hljs-meta">@property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">charset</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;从Content-Type头中提取字符集&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>._charset <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._charset<br>    content_type = <span class="hljs-variable language_">self</span>.get(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    matched = _charset_from_content_type_re.search(content_type)<br>    <span class="hljs-keyword">if</span> matched:<br>        <span class="hljs-keyword">return</span> matched.group(<span class="hljs-string">&#x27;charset&#x27;</span>).replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">return</span> settings.DEFAULT_CHARSET<br></code></pre></td></tr></table></figure>

<h2 id="设计模式和原则"><a href="#设计模式和原则" class="headerlink" title="设计模式和原则"></a>设计模式和原则</h2><h3 id="1-模板方法模式"><a href="#1-模板方法模式" class="headerlink" title="1. 模板方法模式"></a>1. <strong>模板方法模式</strong></h3><ul>
<li><strong>HttpResponseBase</strong>：定义响应处理的基本流程</li>
<li><strong>子类</strong>：实现具体的内容处理逻辑</li>
</ul>
<h3 id="2-策略模式"><a href="#2-策略模式" class="headerlink" title="2. 策略模式"></a>2. <strong>策略模式</strong></h3><ul>
<li><strong>不同响应类型</strong>：标准、流式、文件等不同处理策略</li>
<li><strong>编码器</strong>：可插拔的JSON编码器</li>
</ul>
<h3 id="3-装饰器模式"><a href="#3-装饰器模式" class="headerlink" title="3. 装饰器模式"></a>3. <strong>装饰器模式</strong></h3><ul>
<li><strong>头部处理</strong>：统一的头部设置和验证</li>
<li><strong>编码转换</strong>：透明的字符编码处理</li>
</ul>
<h3 id="4-资源管理模式"><a href="#4-资源管理模式" class="headerlink" title="4. 资源管理模式"></a>4. <strong>资源管理模式</strong></h3><ul>
<li><strong>RAII原则</strong>：通过<code>_closable_objects</code>自动管理资源</li>
<li><strong>上下文管理</strong>：确保资源正确释放</li>
</ul>
<h2 id="实际应用场景"><a href="#实际应用场景" class="headerlink" title="实际应用场景"></a>实际应用场景</h2><h3 id="1-基本Web响应"><a href="#1-基本Web响应" class="headerlink" title="1. 基本Web响应"></a>1. <strong>基本Web响应</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># 简单HTML响应</span><br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;&lt;h1&gt;Hello World&lt;/h1&gt;&#x27;</span>)<br>    <br>    <span class="hljs-comment"># JSON API响应</span><br>    <span class="hljs-keyword">return</span> JsonResponse(&#123;<span class="hljs-string">&#x27;status&#x27;</span>: <span class="hljs-string">&#x27;success&#x27;</span>, <span class="hljs-string">&#x27;data&#x27;</span>: data&#125;)<br>    <br>    <span class="hljs-comment"># 重定向</span><br>    <span class="hljs-keyword">return</span> HttpResponseRedirect(<span class="hljs-string">&#x27;/login/&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h3 id="2-文件下载"><a href="#2-文件下载" class="headerlink" title="2. 文件下载"></a>2. <strong>文件下载</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">download_file</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># 大文件下载</span><br>    file_obj = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;large_file.pdf&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>)<br>    response = FileResponse(file_obj)<br>    response[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>] = <span class="hljs-string">&#x27;attachment; filename=&quot;file.pdf&quot;&#x27;</span><br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure>

<h3 id="3-流式数据"><a href="#3-流式数据" class="headerlink" title="3. 流式数据"></a>3. <strong>流式数据</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">streaming_csv</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># 大量数据的CSV导出</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_csv</span>():<br>        <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> large_dataset:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;row[<span class="hljs-string">&#x27;id&#x27;</span>]&#125;</span>,<span class="hljs-subst">&#123;row[<span class="hljs-string">&#x27;name&#x27;</span>]&#125;</span>\n&quot;</span><br>    <br>    response = StreamingHttpResponse(generate_csv(), content_type=<span class="hljs-string">&#x27;text/csv&#x27;</span>)<br>    response[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>] = <span class="hljs-string">&#x27;attachment; filename=&quot;data.csv&quot;&#x27;</span><br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Django的HTTP响应系统体现了以下设计理念：</p>
<h3 id="安全第一"><a href="#安全第一" class="headerlink" title="安全第一"></a>安全第一</h3><ul>
<li><strong>头部注入防护</strong>：防止HTTP头部注入攻击</li>
<li><strong>重定向安全</strong>：协议白名单防止恶意重定向</li>
<li><strong>JSON安全</strong>：默认类型限制防止劫持攻击</li>
<li><strong>Cookie安全</strong>：签名验证和安全标志支持</li>
</ul>
<h3 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h3><ul>
<li><strong>流式处理</strong>：支持大文件和实时数据流</li>
<li><strong>延迟处理</strong>：按需生成和传输内容</li>
<li><strong>内存管理</strong>：分块处理避免内存溢出</li>
<li><strong>资源清理</strong>：自动管理文件句柄等资源</li>
</ul>
<h3 id="扩展性强"><a href="#扩展性强" class="headerlink" title="扩展性强"></a>扩展性强</h3><ul>
<li><strong>类继承体系</strong>：清晰的继承关系支持定制</li>
<li><strong>可插拔组件</strong>：自定义编码器和处理器</li>
<li><strong>标准兼容</strong>：完整的HTTP协议支持</li>
</ul>
<h3 id="易用性好"><a href="#易用性好" class="headerlink" title="易用性好"></a>易用性好</h3><ul>
<li><strong>字典式接口</strong>：直观的头部访问方式</li>
<li><strong>多种响应类型</strong>：覆盖常见的Web开发需求</li>
<li><strong>自动处理</strong>：编码、时区等细节的自动处理</li>
</ul>
<p>通过精心设计的类继承体系和丰富的功能特性，Django的响应系统为Web应用开发提供了强大、安全、高效的HTTP响应处理能力。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Django/" class="print-no-link">#Django</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Django HTTP Response</div>
      <div>https://luffy997.github.io/2025/07/07/Django-HTTP-Response/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Luffy997</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年7月7日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/07/07/Django-HTTP-Request/" title="Django HTTP Request">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Django HTTP Request</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/07/02/Django%E5%88%86%E9%A1%B5%E5%99%A8-Paginator/" title="Django 分页器 Paginator">
                        <span class="hidden-mobile">Django 分页器 Paginator</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
