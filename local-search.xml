<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Django Viewç±»æ ¸å¿ƒè®¾è®¡</title>
    <link href="/2025/07/30/Django-View%E7%B1%BB%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E6%80%BB%E7%BB%93/"/>
    <url>/2025/07/30/Django-View%E7%B1%BB%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h2 id="ğŸ¯-Viewç±»çš„æ ¸å¿ƒè®¾è®¡ç†å¿µ"><a href="#ğŸ¯-Viewç±»çš„æ ¸å¿ƒè®¾è®¡ç†å¿µ" class="headerlink" title="ğŸ¯ Viewç±»çš„æ ¸å¿ƒè®¾è®¡ç†å¿µ"></a>ğŸ¯ Viewç±»çš„æ ¸å¿ƒè®¾è®¡ç†å¿µ</h2><p>Django Viewç±»æ˜¯æ‰€æœ‰ç±»è§†å›¾çš„åŸºç¡€ï¼Œé‡‡ç”¨äº†<strong>æ•…æ„ç®€å•</strong>çš„è®¾è®¡å“²å­¦ï¼Œåªå®ç°HTTPæ–¹æ³•åˆ†å‘å’ŒåŸºæœ¬æ£€æŸ¥ã€‚</p><h3 id="æ ¸å¿ƒåŠŸèƒ½"><a href="#æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="æ ¸å¿ƒåŠŸèƒ½"></a>æ ¸å¿ƒåŠŸèƒ½</h3><ol><li><strong>HTTPæ–¹æ³•åˆ†å‘</strong> - <code>dispatch()</code>æ–¹æ³•æ ¹æ®è¯·æ±‚ç±»å‹è°ƒç”¨å¯¹åº”å¤„ç†æ–¹æ³•</li><li><strong>ç±»åˆ°å‡½æ•°çš„è½¬æ¢</strong> - <code>as_view()</code>æ–¹æ³•å°†ç±»è§†å›¾è½¬æ¢ä¸ºURLconféœ€è¦çš„å‡½æ•°</li><li><strong>å®ä¾‹éš”ç¦»</strong> - æ¯æ¬¡è¯·æ±‚åˆ›å»ºæ–°å®ä¾‹ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨</li></ol><h2 id="ğŸ”„-æ ¸å¿ƒå·¥ä½œæµç¨‹"><a href="#ğŸ”„-æ ¸å¿ƒå·¥ä½œæµç¨‹" class="headerlink" title="ğŸ”„ æ ¸å¿ƒå·¥ä½œæµç¨‹"></a>ğŸ”„ æ ¸å¿ƒå·¥ä½œæµç¨‹</h2><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">URL</span>è¯·æ±‚ â†’ as_view()è¿”å›çš„é—­åŒ…å‡½æ•° â†’ åˆ›å»ºè§†å›¾å®ä¾‹ â†’ <span class="hljs-built_in">dispatch</span>() â†’ <span class="hljs-built_in">get</span>/<span class="hljs-built_in">post</span>/<span class="hljs-built_in">put</span>/<span class="hljs-built_in">delete</span>ç­‰æ–¹æ³•<br></code></pre></td></tr></table></figure><h3 id="è¯¦ç»†æ‰§è¡Œæ­¥éª¤"><a href="#è¯¦ç»†æ‰§è¡Œæ­¥éª¤" class="headerlink" title="è¯¦ç»†æ‰§è¡Œæ­¥éª¤"></a>è¯¦ç»†æ‰§è¡Œæ­¥éª¤</h3><ol><li><strong>å¯åŠ¨æ—¶</strong>ï¼š<code>MyView.as_view()</code> åˆ›å»ºé—­åŒ…ï¼Œé…ç½®ä¿¡æ¯è¢«ä¿å­˜</li><li><strong>è¯·æ±‚æ—¶</strong>ï¼šè°ƒç”¨é—­åŒ…å‡½æ•° â†’ åˆ›å»ºæ–°å®ä¾‹ â†’ ç»‘å®šè¯·æ±‚æ•°æ® â†’ æ–¹æ³•åˆ†å‘</li></ol><h2 id="ğŸ§ -é—­åŒ…åœ¨Djangoè§†å›¾ä¸­çš„åº”ç”¨"><a href="#ğŸ§ -é—­åŒ…åœ¨Djangoè§†å›¾ä¸­çš„åº”ç”¨" class="headerlink" title="ğŸ§  é—­åŒ…åœ¨Djangoè§†å›¾ä¸­çš„åº”ç”¨"></a>ğŸ§  é—­åŒ…åœ¨Djangoè§†å›¾ä¸­çš„åº”ç”¨</h2><h3 id="ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ</h3><p><strong>é—­åŒ… &#x3D; å‡½æ•° + è¯¥å‡½æ•°èƒ½è®¿é—®çš„å¤–å±‚ä½œç”¨åŸŸå˜é‡</strong></p><p>é—­åŒ…çš„ä¸‰ä¸ªè¦ç´ ï¼š</p><ol><li><strong>åµŒå¥—å‡½æ•°</strong> - å†…å±‚å‡½æ•°å®šä¹‰åœ¨å¤–å±‚å‡½æ•°å†…éƒ¨</li><li><strong>å˜é‡æ•è·</strong> - å†…å±‚å‡½æ•°å¼•ç”¨å¤–å±‚å‡½æ•°çš„å˜é‡</li><li><strong>å‡½æ•°è¿”å›</strong> - å¤–å±‚å‡½æ•°è¿”å›å†…å±‚å‡½æ•°å¯¹è±¡</li></ol><h3 id="é—­åŒ…çš„åº•å±‚å®ç°åŸç†"><a href="#é—­åŒ…çš„åº•å±‚å®ç°åŸç†" class="headerlink" title="é—­åŒ…çš„åº•å±‚å®ç°åŸç†"></a>é—­åŒ…çš„åº•å±‚å®ç°åŸç†</h3><h4 id="Pythonä½¿ç”¨Cellå¯¹è±¡å®ç°é—­åŒ…"><a href="#Pythonä½¿ç”¨Cellå¯¹è±¡å®ç°é—­åŒ…" class="headerlink" title="Pythonä½¿ç”¨Cellå¯¹è±¡å®ç°é—­åŒ…"></a>Pythonä½¿ç”¨Cellå¯¹è±¡å®ç°é—­åŒ…</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">outer</span>():<br>    x = <span class="hljs-number">10</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inner</span>():<br>        <span class="hljs-keyword">return</span> x  <span class="hljs-comment"># å¼•ç”¨å¤–å±‚å˜é‡</span><br>    <span class="hljs-keyword">return</span> inner<br><br>func = outer()<br><span class="hljs-built_in">print</span>(func.__closure__)  <span class="hljs-comment"># (&lt;cell at 0x...: int object at 0x...&gt;,)</span><br></code></pre></td></tr></table></figure><p><strong>å†…å­˜ç»“æ„</strong>ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">å‡½æ•°å¯¹è±¡ â†’ <span class="hljs-emphasis">__closure__</span> â†’ Tuple[Cellå¯¹è±¡] â†’ è¢«æ•è·çš„å˜é‡<br></code></pre></td></tr></table></figure><h4 id="ç¼–è¯‘æ—¶ç¡®å®šï¼Œè¿è¡Œæ—¶è®¿é—®"><a href="#ç¼–è¯‘æ—¶ç¡®å®šï¼Œè¿è¡Œæ—¶è®¿é—®" class="headerlink" title="ç¼–è¯‘æ—¶ç¡®å®šï¼Œè¿è¡Œæ—¶è®¿é—®"></a>ç¼–è¯‘æ—¶ç¡®å®šï¼Œè¿è¡Œæ—¶è®¿é—®</h4><ul><li><strong>ç¼–è¯‘æ—¶</strong>ï¼šPythonç¼–è¯‘å™¨è¯†åˆ«é—­åŒ…å˜é‡ï¼Œç”Ÿæˆ<code>LOAD_DEREF</code>å­—èŠ‚ç </li><li><strong>è¿è¡Œæ—¶</strong>ï¼šé€šè¿‡Cellå¯¹è±¡è®¿é—®è¢«æ•è·çš„å˜é‡</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šåªè¦é—­åŒ…å‡½æ•°å­˜åœ¨ï¼Œè¢«æ•è·çš„å˜é‡å°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶</li></ul><h3 id="Djangoä¸­ä¸ºä»€ä¹ˆä½¿ç”¨é—­åŒ…ï¼Ÿ"><a href="#Djangoä¸­ä¸ºä»€ä¹ˆä½¿ç”¨é—­åŒ…ï¼Ÿ" class="headerlink" title="Djangoä¸­ä¸ºä»€ä¹ˆä½¿ç”¨é—­åŒ…ï¼Ÿ"></a>Djangoä¸­ä¸ºä»€ä¹ˆä½¿ç”¨é—­åŒ…ï¼Ÿ</h3><h4 id="æ ¸å¿ƒé—®é¢˜"><a href="#æ ¸å¿ƒé—®é¢˜" class="headerlink" title="æ ¸å¿ƒé—®é¢˜"></a>æ ¸å¿ƒé—®é¢˜</h4><p>Djangoé¢ä¸´çš„è®¾è®¡æŒ‘æˆ˜ï¼š</p><ul><li><strong>URLconféœ€è¦å‡½æ•°</strong>ï¼š<code>path(&#39;url/&#39;, function)</code></li><li><strong>ç±»è§†å›¾éœ€è¦é…ç½®</strong>ï¼š<code>ListView(model=Article, template_name=&#39;list.html&#39;)</code></li><li><strong>çº¿ç¨‹å®‰å…¨è¦æ±‚</strong>ï¼šå¤šä¸ªè¯·æ±‚ä¸èƒ½å…±äº«å®ä¾‹çŠ¶æ€</li></ul><h4 id="é—­åŒ…è§£å†³æ–¹æ¡ˆ"><a href="#é—­åŒ…è§£å†³æ–¹æ¡ˆ" class="headerlink" title="é—­åŒ…è§£å†³æ–¹æ¡ˆ"></a>é—­åŒ…è§£å†³æ–¹æ¡ˆ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@classmethod</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">as_view</span>(<span class="hljs-params">cls, **initkwargs</span>):<br>    <span class="hljs-comment"># å¤–å±‚å‡½æ•°ï¼šä¿å­˜é…ç½®ä¿¡æ¯</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">view</span>(<span class="hljs-params">request, *args, **kwargs</span>):<br>        <span class="hljs-comment"># å†…å±‚å‡½æ•°ï¼šæ¯æ¬¡è¯·æ±‚éƒ½æ‰§è¡Œ</span><br>        <span class="hljs-variable language_">self</span> = cls(**initkwargs)  <span class="hljs-comment"># ä½¿ç”¨é—­åŒ…æ•è·çš„é…ç½®</span><br>        <span class="hljs-variable language_">self</span>.request = request<br>        <span class="hljs-variable language_">self</span>.args = args<br>        <span class="hljs-variable language_">self</span>.kwargs = kwargs<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.dispatch(request, *args, **kwargs)<br>    <br>    <span class="hljs-comment"># ä¿å­˜å…ƒä¿¡æ¯</span><br>    view.view_class = cls<br>    view.view_initkwargs = initkwargs<br>    <br>    <span class="hljs-keyword">return</span> view  <span class="hljs-comment"># è¿”å›é—­åŒ…å‡½æ•°</span><br></code></pre></td></tr></table></figure><h4 id="é—­åŒ…çš„ä¼˜åŠ¿"><a href="#é—­åŒ…çš„ä¼˜åŠ¿" class="headerlink" title="é—­åŒ…çš„ä¼˜åŠ¿"></a>é—­åŒ…çš„ä¼˜åŠ¿</h4><ol><li><strong>é…ç½®å¤ç”¨</strong> - é…ç½®ä¿¡æ¯åªè§£æä¸€æ¬¡ï¼Œå­˜å‚¨åœ¨é—­åŒ…ç¯å¢ƒä¸­</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong> - é¿å…æ¯æ¬¡è¯·æ±‚é‡æ–°è§£æé…ç½®</li><li><strong>å®ä¾‹éš”ç¦»</strong> - æ¯æ¬¡è¯·æ±‚åˆ›å»ºæ–°å®ä¾‹ï¼Œçº¿ç¨‹å®‰å…¨</li><li><strong>æ¥å£ç»Ÿä¸€</strong> - è¿”å›å‡½æ•°æ»¡è¶³URLconfè¦æ±‚</li></ol><h3 id="å¦‚æœä¸ç”¨é—­åŒ…ä¼šæ€æ ·ï¼Ÿ"><a href="#å¦‚æœä¸ç”¨é—­åŒ…ä¼šæ€æ ·ï¼Ÿ" class="headerlink" title="å¦‚æœä¸ç”¨é—­åŒ…ä¼šæ€æ ·ï¼Ÿ"></a>å¦‚æœä¸ç”¨é—­åŒ…ä¼šæ€æ ·ï¼Ÿ</h3><h4 id="æ–¹æ¡ˆ1ï¼šæ¯æ¬¡é‡æ–°é…ç½®ï¼ˆæ€§èƒ½å·®ï¼‰"><a href="#æ–¹æ¡ˆ1ï¼šæ¯æ¬¡é‡æ–°é…ç½®ï¼ˆæ€§èƒ½å·®ï¼‰" class="headerlink" title="æ–¹æ¡ˆ1ï¼šæ¯æ¬¡é‡æ–°é…ç½®ï¼ˆæ€§èƒ½å·®ï¼‰"></a>æ–¹æ¡ˆ1ï¼šæ¯æ¬¡é‡æ–°é…ç½®ï¼ˆæ€§èƒ½å·®ï¼‰</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">no_closure_approach1</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># æ¯æ¬¡è¯·æ±‚éƒ½è¦é‡æ–°è§£æé…ç½®</span><br>    view = ListView()<br>    view.model = Article  <span class="hljs-comment"># é‡å¤è®¾ç½®</span><br>    view.template_name = <span class="hljs-string">&#x27;list.html&#x27;</span>  <span class="hljs-comment"># é‡å¤è®¾ç½®</span><br>    <span class="hljs-keyword">return</span> view.dispatch(request)<br></code></pre></td></tr></table></figure><p><strong>é—®é¢˜</strong>ï¼š</p><ul><li>é…ç½®è§£æå¼€é”€å¤§</li><li>ä»£ç é‡å¤</li><li>éš¾ä»¥ç»´æŠ¤</li></ul><h4 id="æ–¹æ¡ˆ2ï¼šå…¨å±€å®ä¾‹ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰"><a href="#æ–¹æ¡ˆ2ï¼šå…¨å±€å®ä¾‹ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰" class="headerlink" title="æ–¹æ¡ˆ2ï¼šå…¨å±€å®ä¾‹ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰"></a>æ–¹æ¡ˆ2ï¼šå…¨å±€å®ä¾‹ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å±é™©çš„å…¨å±€å®ä¾‹</span><br>global_view = ListView(model=Article, template_name=<span class="hljs-string">&#x27;list.html&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">no_closure_approach2</span>(<span class="hljs-params">request</span>):<br>    global_view.request = request  <span class="hljs-comment"># å¤šçº¿ç¨‹å†²çªï¼</span><br>    <span class="hljs-keyword">return</span> global_view.dispatch(request)<br></code></pre></td></tr></table></figure><p><strong>é—®é¢˜</strong>ï¼š</p><ul><li>çº¿ç¨‹å®‰å…¨é—®é¢˜</li><li>çŠ¶æ€æ±¡æŸ“</li><li>å¹¶å‘é”™è¯¯</li></ul><h4 id="æ–¹æ¡ˆ3ï¼šå·¥å‚å‡½æ•°ï¼ˆå¤æ‚ä¸”ä½æ•ˆï¼‰"><a href="#æ–¹æ¡ˆ3ï¼šå·¥å‚å‡½æ•°ï¼ˆå¤æ‚ä¸”ä½æ•ˆï¼‰" class="headerlink" title="æ–¹æ¡ˆ3ï¼šå·¥å‚å‡½æ•°ï¼ˆå¤æ‚ä¸”ä½æ•ˆï¼‰"></a>æ–¹æ¡ˆ3ï¼šå·¥å‚å‡½æ•°ï¼ˆå¤æ‚ä¸”ä½æ•ˆï¼‰</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_view_factory</span>(<span class="hljs-params">model, template_name</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">view_func</span>(<span class="hljs-params">request</span>):<br>        view = ListView()  <span class="hljs-comment"># æ¯æ¬¡éƒ½åˆ›å»º</span><br>        view.model = model  <span class="hljs-comment"># æ¯æ¬¡éƒ½è®¾ç½®</span><br>        view.template_name = template_name<br>        <span class="hljs-keyword">return</span> view.dispatch(request)<br>    <span class="hljs-keyword">return</span> view_func<br></code></pre></td></tr></table></figure><p><strong>é—®é¢˜</strong>ï¼š</p><ul><li>ä»£ç å¤æ‚</li><li>é…ç½®æ¯æ¬¡éƒ½è¦é‡æ–°è®¾ç½®</li><li>æ²¡æœ‰å……åˆ†åˆ©ç”¨Pythonè¯­è¨€ç‰¹æ€§</li></ul><h2 id="ğŸ¯-dispatchæ–¹æ³•-HTTPæ–¹æ³•åˆ†å‘å™¨"><a href="#ğŸ¯-dispatchæ–¹æ³•-HTTPæ–¹æ³•åˆ†å‘å™¨" class="headerlink" title="ğŸ¯ dispatchæ–¹æ³• - HTTPæ–¹æ³•åˆ†å‘å™¨"></a>ğŸ¯ dispatchæ–¹æ³• - HTTPæ–¹æ³•åˆ†å‘å™¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-params">self, request, *args, **kwargs</span>):<br>    <span class="hljs-comment"># æ£€æŸ¥è¯·æ±‚æ–¹æ³•æ˜¯å¦æ”¯æŒ</span><br>    <span class="hljs-keyword">if</span> request.method.lower() <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.http_method_names:<br>        <span class="hljs-comment"># åŠ¨æ€è·å–å¤„ç†æ–¹æ³•</span><br>        handler = <span class="hljs-built_in">getattr</span>(<span class="hljs-variable language_">self</span>, request.method.lower(), <span class="hljs-variable language_">self</span>.http_method_not_allowed)<br>    <span class="hljs-keyword">else</span>:<br>        handler = <span class="hljs-variable language_">self</span>.http_method_not_allowed<br>    <br>    <span class="hljs-comment"># è°ƒç”¨å¤„ç†æ–¹æ³•</span><br>    <span class="hljs-keyword">return</span> handler(request, *args, **kwargs)<br></code></pre></td></tr></table></figure><h3 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h3><ul><li><strong>Template Methodæ¨¡å¼</strong> - å®šä¹‰ç®—æ³•éª¨æ¶ï¼Œå…·ä½“å®ç°ç”±å­ç±»æä¾›</li><li><strong>Strategyæ¨¡å¼</strong> - æ ¹æ®HTTPæ–¹æ³•åŠ¨æ€é€‰æ‹©å¤„ç†ç­–ç•¥</li></ul><h2 id="ğŸ’¡-è®¾è®¡ç²¾é«“æ€»ç»“"><a href="#ğŸ’¡-è®¾è®¡ç²¾é«“æ€»ç»“" class="headerlink" title="ğŸ’¡ è®¾è®¡ç²¾é«“æ€»ç»“"></a>ğŸ’¡ è®¾è®¡ç²¾é«“æ€»ç»“</h2><h3 id="1-é—­åŒ…çš„ä½œç”¨"><a href="#1-é—­åŒ…çš„ä½œç”¨" class="headerlink" title="1. é—­åŒ…çš„ä½œç”¨"></a>1. é—­åŒ…çš„ä½œç”¨</h3><ul><li><strong>é…ç½®ç¼“å­˜</strong> - å¯åŠ¨æ—¶è§£æä¸€æ¬¡ï¼Œè¿è¡Œæ—¶ç›´æ¥ä½¿ç”¨</li><li><strong>å‡½æ•°æ¥å£</strong> - æ»¡è¶³URLconfå¯¹å‡½æ•°çš„è¦æ±‚</li><li><strong>çŠ¶æ€éš”ç¦»</strong> - é…ç½®å…±äº«ï¼Œå®ä¾‹éš”ç¦»</li></ul><h3 id="2-æ€§èƒ½ä¼˜åŒ–"><a href="#2-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="2. æ€§èƒ½ä¼˜åŒ–"></a>2. æ€§èƒ½ä¼˜åŒ–</h3><ul><li><strong>é›¶è¿è¡Œæ—¶é…ç½®å¼€é”€</strong> - é…ç½®ä¿¡æ¯é¢„å­˜åœ¨é—­åŒ…ä¸­</li><li><strong>å®ä¾‹åˆ›å»ºä¼˜åŒ–</strong> - åªåˆ›å»ºå¿…è¦çš„å®ä¾‹å±æ€§</li></ul><h3 id="3-çº¿ç¨‹å®‰å…¨"><a href="#3-çº¿ç¨‹å®‰å…¨" class="headerlink" title="3. çº¿ç¨‹å®‰å…¨"></a>3. çº¿ç¨‹å®‰å…¨</h3><ul><li><strong>æ— å…±äº«çŠ¶æ€</strong> - æ¯ä¸ªè¯·æ±‚ç‹¬ç«‹çš„å®ä¾‹</li><li><strong>æ— ç«äº‰æ¡ä»¶</strong> - å®ä¾‹çº§åˆ«çš„æ•°æ®éš”ç¦»</li></ul><h3 id="4-è®¾è®¡æ¨¡å¼åº”ç”¨"><a href="#4-è®¾è®¡æ¨¡å¼åº”ç”¨" class="headerlink" title="4. è®¾è®¡æ¨¡å¼åº”ç”¨"></a>4. è®¾è®¡æ¨¡å¼åº”ç”¨</h3><ul><li><strong>å·¥å‚æ¨¡å¼</strong> - <code>as_view()</code>ä½œä¸ºè§†å›¾å‡½æ•°å·¥å‚</li><li><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong> - <code>dispatch()</code>å®šä¹‰å¤„ç†æµç¨‹</li><li><strong>ç­–ç•¥æ¨¡å¼</strong> - åŠ¨æ€æ–¹æ³•åˆ†å‘</li></ul><h2 id="ğŸš€-æ€»ç»“"><a href="#ğŸš€-æ€»ç»“" class="headerlink" title="ğŸš€ æ€»ç»“"></a>ğŸš€ æ€»ç»“</h2><p>Django Viewç±»é€šè¿‡å·§å¦™ä½¿ç”¨é—­åŒ…ï¼Œå®ç°äº†ï¼š</p><ul><li><strong>é«˜æ€§èƒ½</strong> - é…ç½®å¤ç”¨ï¼Œé¿å…é‡å¤è§£æ</li><li><strong>çº¿ç¨‹å®‰å…¨</strong> - å®ä¾‹éš”ç¦»ï¼Œæ— çŠ¶æ€å…±äº«</li><li><strong>ä¼˜é›…è®¾è®¡</strong> - ç±»è§†å›¾çš„ä¾¿åˆ©æ€§ + å‡½æ•°æ¥å£çš„è¦æ±‚</li></ul><p>è¿™ç§è®¾è®¡å……åˆ†ä½“ç°äº†Djangoæ¡†æ¶çš„è®¾è®¡å“²å­¦ï¼š<strong>åœ¨ä¿è¯åŠŸèƒ½å®Œæ•´æ€§çš„å‰æä¸‹ï¼Œè¿½æ±‚ç®€æ´ã€é«˜æ•ˆã€å®‰å…¨çš„å®ç°æ–¹æ¡ˆ</strong>ã€‚</p><p>é—­åŒ…ä¸æ˜¯ä¸€ä¸ªå¤æ‚çš„æ¦‚å¿µï¼Œè€Œæ˜¯Pythonæä¾›çš„å¼ºå¤§å·¥å…·ã€‚Djangoå·§å¦™åœ°åˆ©ç”¨é—­åŒ…ç‰¹æ€§ï¼Œè§£å†³äº†webæ¡†æ¶ä¸­é…ç½®ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–å’Œçº¿ç¨‹å®‰å…¨çš„æ ¸å¿ƒé—®é¢˜ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django ORM</title>
    <link href="/2025/07/27/Django-ORM/"/>
    <url>/2025/07/27/Django-ORM/</url>
    
    <content type="html"><![CDATA[<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul><li><a href="#1-%E6%A6%82%E8%BF%B0">1. æ¦‚è¿°</a></li><li><a href="#2-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E6%9E%B6%E6%9E%84">2. æ ¸å¿ƒç»„ä»¶æ¶æ„</a></li><li><a href="#3-query-%E7%B1%BB%E8%AF%A6%E8%A7%A3">3. Query ç±»è¯¦è§£</a></li><li><a href="#4-sqlcompiler-%E7%BC%96%E8%AF%91%E5%99%A8">4. SQLCompiler ç¼–è¯‘å™¨</a></li><li><a href="#5-sql-%E7%94%9F%E6%88%90%E6%B5%81%E7%A8%8B">5. SQL ç”Ÿæˆæµç¨‹</a></li><li><a href="#6-%E5%85%B3%E9%94%AE%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">6. å…³é”®æ•°æ®ç»“æ„</a></li><li><a href="#7-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90">7. å®æˆ˜æ¡ˆä¾‹åˆ†æ</a></li><li><a href="#8-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7">8. é«˜çº§ç‰¹æ€§</a></li><li><a href="#9-%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">9. æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥</a></li><li><a href="#10-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%B0%83%E8%AF%95">10. æ€§èƒ½ç›‘æ§ä¸è°ƒè¯•</a></li><li><a href="#11-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">11. æœ€ä½³å®è·µ</a></li><li><a href="#12-%E6%80%BB%E7%BB%93">12. æ€»ç»“</a></li></ul><h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>Django ORM çš„ SQL æŸ¥è¯¢æ„å»ºæ˜¯ä¸€ä¸ªå¤æ‚è€Œç²¾å·§çš„ç³»ç»Ÿï¼Œå®ƒå°† Python å¯¹è±¡å’Œæ–¹æ³•è°ƒç”¨è½¬æ¢ä¸ºé«˜æ•ˆçš„ SQL æŸ¥è¯¢ã€‚è¿™ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒåœ¨äºå°†é¢å‘å¯¹è±¡çš„æŸ¥è¯¢ API æŠ½è±¡ä¸ºåº•å±‚çš„ SQL è¯­å¥ã€‚</p><h3 id="1-1-æ–‡ä»¶ç»“æ„"><a href="#1-1-æ–‡ä»¶ç»“æ„" class="headerlink" title="1.1 æ–‡ä»¶ç»“æ„"></a>1.1 æ–‡ä»¶ç»“æ„</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">django<span class="hljs-regexp">/db/m</span>odels<span class="hljs-regexp">/sql/</span><br>â”œâ”€â”€ __init__.py          <span class="hljs-comment"># æ¨¡å—å…¥å£</span><br>â”œâ”€â”€ constants.py         <span class="hljs-comment"># SQL ç›¸å…³å¸¸é‡</span><br>â”œâ”€â”€ query.py            <span class="hljs-comment"># Query ç±» - æŸ¥è¯¢æŠ½è±¡</span><br>â”œâ”€â”€ compiler.py         <span class="hljs-comment"># SQLCompiler - SQL ç¼–è¯‘å™¨</span><br>â”œâ”€â”€ datastructures.py   <span class="hljs-comment"># æ•°æ®ç»“æ„å®šä¹‰</span><br>â”œâ”€â”€ where.py            <span class="hljs-comment"># WHERE å­å¥å¤„ç†</span><br>â””â”€â”€ subqueries.py       <span class="hljs-comment"># å­æŸ¥è¯¢å¤„ç†</span><br></code></pre></td></tr></table></figure><h3 id="1-2-æ ¸å¿ƒè®¾è®¡åŸåˆ™"><a href="#1-2-æ ¸å¿ƒè®¾è®¡åŸåˆ™" class="headerlink" title="1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™"></a>1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™</h3><ol><li><strong>æŠ½è±¡åˆ†ç¦»</strong>ï¼šæŸ¥è¯¢é€»è¾‘ä¸ SQL ç”Ÿæˆåˆ†ç¦»</li><li><strong>å»¶è¿Ÿè®¡ç®—</strong>ï¼šåªæœ‰åœ¨éœ€è¦æ—¶æ‰ç”Ÿæˆ SQL</li><li><strong>å¤šæ•°æ®åº“æ”¯æŒ</strong>ï¼šé€šè¿‡ç¼–è¯‘å™¨é€‚é…ä¸åŒæ•°æ®åº“</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæ™ºèƒ½çš„ JOIN å’ŒæŸ¥è¯¢ä¼˜åŒ–</li></ol><h2 id="2-æ ¸å¿ƒç»„ä»¶æ¶æ„"><a href="#2-æ ¸å¿ƒç»„ä»¶æ¶æ„" class="headerlink" title="2. æ ¸å¿ƒç»„ä»¶æ¶æ„"></a>2. æ ¸å¿ƒç»„ä»¶æ¶æ„</h2><pre><code class=" mermaid">flowchart TD    A[&quot;QuerySet&quot;] --&gt; B[&quot;Query&quot;]    B --&gt; C[&quot;SQLCompiler&quot;]    C --&gt; D[&quot;SQL String&quot;]        subgraph &quot;Query å¯¹è±¡&quot;        E[&quot;æ¨¡å‹ä¿¡æ¯&quot;]        F[&quot;WHERE æ¡ä»¶&quot;]        G[&quot;SELECT å­—æ®µ&quot;]        H[&quot;JOIN ä¿¡æ¯&quot;]        I[&quot;ORDER BY&quot;]        J[&quot;GROUP BY&quot;]    end        subgraph &quot;SQLCompiler&quot;        K[&quot;as_sql&quot;]        L[&quot;get_select&quot;]        M[&quot;get_from_clause&quot;]        N[&quot;compile&quot;]    end        B --&gt; E    B --&gt; F    B --&gt; G    B --&gt; H    B --&gt; I    B --&gt; J        C --&gt; K    C --&gt; L    C --&gt; M    C --&gt; N        style A fill:#e1f5fe    style B fill:#f3e5f5    style C fill:#e8f5e8    style D fill:#fff3e0</code></pre><h2 id="3-Query-ç±»è¯¦è§£"><a href="#3-Query-ç±»è¯¦è§£" class="headerlink" title="3. Query ç±»è¯¦è§£"></a>3. Query ç±»è¯¦è§£</h2><h3 id="3-1-Query-ç±»çš„æ ¸å¿ƒå±æ€§"><a href="#3-1-Query-ç±»çš„æ ¸å¿ƒå±æ€§" class="headerlink" title="3.1 Query ç±»çš„æ ¸å¿ƒå±æ€§"></a>3.1 Query ç±»çš„æ ¸å¿ƒå±æ€§</h3><p>æ ¹æ®æºç åˆ†æï¼ŒQuery ç±»æ˜¯ SQL æŸ¥è¯¢çš„æŠ½è±¡è¡¨ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Query</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å•ä¸ª SQL æŸ¥è¯¢çš„æŠ½è±¡è¡¨ç¤º&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model, where=WhereNode</span>):<br>        <span class="hljs-comment"># æ¨¡å‹ç›¸å…³</span><br>        <span class="hljs-variable language_">self</span>.model = model<br>        <br>        <span class="hljs-comment"># è¡¨åˆ«åç®¡ç†</span><br>        <span class="hljs-variable language_">self</span>.alias_refcount = &#123;&#125;     <span class="hljs-comment"># åˆ«åå¼•ç”¨è®¡æ•°</span><br>        <span class="hljs-variable language_">self</span>.alias_map = &#123;&#125;          <span class="hljs-comment"># åˆ«åæ˜ å°„ - æœ€é‡è¦çš„ JOIN æ•°æ®ç»“æ„</span><br>        <span class="hljs-variable language_">self</span>.table_map = &#123;&#125;          <span class="hljs-comment"># è¡¨ååˆ°åˆ«åçš„æ˜ å°„</span><br>        <span class="hljs-variable language_">self</span>.tables = []             <span class="hljs-comment"># æŒ‰åˆ›å»ºé¡ºåºçš„åˆ«ååˆ—è¡¨</span><br>        <br>        <span class="hljs-comment"># SELECT ç›¸å…³</span><br>        <span class="hljs-variable language_">self</span>.select = []             <span class="hljs-comment"># SELECT å­å¥çš„è¡¨è¾¾å¼</span><br>        <span class="hljs-variable language_">self</span>.default_cols = <span class="hljs-literal">True</span>     <span class="hljs-comment"># æ˜¯å¦ä½¿ç”¨é»˜è®¤åˆ—</span><br>        <span class="hljs-variable language_">self</span>.values_select = []      <span class="hljs-comment"># values() è°ƒç”¨é€‰æ‹©çš„å­—æ®µ</span><br>        <br>        <span class="hljs-comment"># WHERE ç›¸å…³</span><br>        <span class="hljs-variable language_">self</span>.where = where()         <span class="hljs-comment"># WHERE æ¡ä»¶æ ‘</span><br>        <span class="hljs-variable language_">self</span>.where_class = where     <span class="hljs-comment"># WHERE èŠ‚ç‚¹ç±»å‹</span><br>        <br>        <span class="hljs-comment"># ORDER BY ç›¸å…³</span><br>        <span class="hljs-variable language_">self</span>.order_by = []           <span class="hljs-comment"># æ’åºå­—æ®µåˆ—è¡¨</span><br>        <span class="hljs-variable language_">self</span>.default_ordering = <span class="hljs-literal">True</span> <span class="hljs-comment"># æ˜¯å¦ä½¿ç”¨é»˜è®¤æ’åº</span><br>        <span class="hljs-variable language_">self</span>.standard_ordering = <span class="hljs-literal">True</span> <span class="hljs-comment"># æ ‡å‡†æ’åºæ–¹å‘</span><br>        <br>        <span class="hljs-comment"># GROUP BY ç›¸å…³</span><br>        <span class="hljs-variable language_">self</span>.group_by = <span class="hljs-literal">None</span>         <span class="hljs-comment"># åˆ†ç»„å­—æ®µ</span><br>        <br>        <span class="hljs-comment"># LIMIT/OFFSET ç›¸å…³</span><br>        <span class="hljs-variable language_">self</span>.low_mark, <span class="hljs-variable language_">self</span>.high_mark = <span class="hljs-number">0</span>, <span class="hljs-literal">None</span><br>        <br>        <span class="hljs-comment"># é«˜çº§ç‰¹æ€§</span><br>        <span class="hljs-variable language_">self</span>.select_related = <span class="hljs-literal">False</span>  <span class="hljs-comment"># æ˜¯å¦é¢„åŠ è½½å…³è”å¯¹è±¡</span><br>        <span class="hljs-variable language_">self</span>.distinct = <span class="hljs-literal">False</span>        <span class="hljs-comment"># æ˜¯å¦å»é‡</span><br>        <span class="hljs-variable language_">self</span>.select_for_update = <span class="hljs-literal">False</span> <span class="hljs-comment"># æ˜¯å¦åŠ é”æŸ¥è¯¢</span><br>        <br>        <span class="hljs-comment"># æ³¨è§£å’Œé¢å¤–å­—æ®µ</span><br>        <span class="hljs-variable language_">self</span>._annotations = <span class="hljs-literal">None</span>     <span class="hljs-comment"># æ³¨è§£è¡¨è¾¾å¼</span><br>        <span class="hljs-variable language_">self</span>._extra = <span class="hljs-literal">None</span>          <span class="hljs-comment"># é¢å¤–çš„ SQL ç‰‡æ®µ</span><br></code></pre></td></tr></table></figure><p><strong>å…³é”®ç‚¹åˆ†æ</strong>ï¼š</p><ul><li><code>alias_map</code> æ˜¯ JOIN ç®¡ç†çš„æ ¸å¿ƒæ•°æ®ç»“æ„</li><li><code>where</code> ä½¿ç”¨æ ‘å½¢ç»“æ„è¡¨ç¤ºå¤æ‚çš„æ¡ä»¶é€»è¾‘</li><li>å„ç§æ ‡å¿—ä½æ§åˆ¶ SQL ç”Ÿæˆçš„ä¸åŒæ–¹é¢</li></ul><h3 id="3-2-é‡è¦æ–¹æ³•åˆ†æ"><a href="#3-2-é‡è¦æ–¹æ³•åˆ†æ" class="headerlink" title="3.2 é‡è¦æ–¹æ³•åˆ†æ"></a>3.2 é‡è¦æ–¹æ³•åˆ†æ</h3><h4 id="æ·»åŠ è¿‡æ»¤æ¡ä»¶"><a href="#æ·»åŠ è¿‡æ»¤æ¡ä»¶" class="headerlink" title="æ·»åŠ è¿‡æ»¤æ¡ä»¶"></a>æ·»åŠ è¿‡æ»¤æ¡ä»¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_q</span>(<span class="hljs-params">self, q_object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ·»åŠ  Q å¯¹è±¡åˆ°æŸ¥è¯¢ä¸­&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># å°† Q å¯¹è±¡è§£æä¸º WHERE æ¡ä»¶</span><br>    clause, _ = <span class="hljs-variable language_">self</span>._add_q(q_object, <span class="hljs-variable language_">self</span>.used_aliases)<br>    <span class="hljs-keyword">if</span> clause:<br>        <span class="hljs-variable language_">self</span>.where.add(clause, AND)<br></code></pre></td></tr></table></figure><h4 id="æ·»åŠ å…³è”æŸ¥è¯¢"><a href="#æ·»åŠ å…³è”æŸ¥è¯¢" class="headerlink" title="æ·»åŠ å…³è”æŸ¥è¯¢"></a>æ·»åŠ å…³è”æŸ¥è¯¢</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_select_related</span>(<span class="hljs-params">self, fields</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ·»åŠ  select_related å­—æ®µ&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># è®¾ç½®é¢„åŠ è½½æ ‡å¿—</span><br>    field_dict = &#123;&#125;<br>    <span class="hljs-keyword">for</span> field <span class="hljs-keyword">in</span> fields:<br>        d = field_dict<br>        <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> field.split(LOOKUP_SEP):<br>            d = d.setdefault(part, &#123;&#125;)<br>    <span class="hljs-variable language_">self</span>.select_related = field_dict<br></code></pre></td></tr></table></figure><h2 id="4-SQLCompiler-ç¼–è¯‘å™¨"><a href="#4-SQLCompiler-ç¼–è¯‘å™¨" class="headerlink" title="4. SQLCompiler ç¼–è¯‘å™¨"></a>4. SQLCompiler ç¼–è¯‘å™¨</h2><h3 id="4-1-ç¼–è¯‘å™¨çš„ä½œç”¨"><a href="#4-1-ç¼–è¯‘å™¨çš„ä½œç”¨" class="headerlink" title="4.1 ç¼–è¯‘å™¨çš„ä½œç”¨"></a>4.1 ç¼–è¯‘å™¨çš„ä½œç”¨</h3><p>SQLCompiler æ˜¯å°† Query å¯¹è±¡è½¬æ¢ä¸ºå®é™… SQL å­—ç¬¦ä¸²çš„æ ¸å¿ƒç»„ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SQLCompiler</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, query, connection, using</span>):<br>        <span class="hljs-variable language_">self</span>.query = query           <span class="hljs-comment"># Query å¯¹è±¡</span><br>        <span class="hljs-variable language_">self</span>.connection = connection <span class="hljs-comment"># æ•°æ®åº“è¿æ¥</span><br>        <span class="hljs-variable language_">self</span>.using = using          <span class="hljs-comment"># æ•°æ®åº“åˆ«å</span><br>        <span class="hljs-variable language_">self</span>.quote_cache = &#123;&#125;       <span class="hljs-comment"># å¼•ç”¨ç¼“å­˜</span><br>        <br>        <span class="hljs-comment"># è¿™äº›å±æ€§åœ¨æŸ¥è¯¢æ‰§è¡Œæ—¶è®¾ç½®</span><br>        <span class="hljs-variable language_">self</span>.select = <span class="hljs-literal">None</span>          <span class="hljs-comment"># ç¼–è¯‘åçš„ SELECT å­—æ®µ</span><br>        <span class="hljs-variable language_">self</span>.klass_info = <span class="hljs-literal">None</span>      <span class="hljs-comment"># ç±»ä¿¡æ¯ï¼ˆç”¨äºå¯¹è±¡åˆ›å»ºï¼‰</span><br>        <span class="hljs-variable language_">self</span>.annotation_col_map = <span class="hljs-literal">None</span> <span class="hljs-comment"># æ³¨è§£åˆ—æ˜ å°„</span><br></code></pre></td></tr></table></figure><h3 id="4-2-SQL-ç”Ÿæˆçš„æ ¸å¿ƒæµç¨‹"><a href="#4-2-SQL-ç”Ÿæˆçš„æ ¸å¿ƒæµç¨‹" class="headerlink" title="4.2 SQL ç”Ÿæˆçš„æ ¸å¿ƒæµç¨‹"></a>4.2 SQL ç”Ÿæˆçš„æ ¸å¿ƒæµç¨‹</h3><pre><code class=" mermaid">sequenceDiagram    participant QS as &quot;QuerySet&quot;    participant Q as &quot;Query&quot;    participant C as &quot;SQLCompiler&quot;    participant DB as &quot;Database&quot;    QS-&gt;&gt;Q: &quot;æ„å»ºæŸ¥è¯¢æ¡ä»¶&quot;    Q-&gt;&gt;C: &quot;get_compiler()&quot;    C-&gt;&gt;C: &quot;pre_sql_setup()&quot;    C-&gt;&gt;C: &quot;setup_query()&quot;    C-&gt;&gt;C: &quot;get_select()&quot;    C-&gt;&gt;C: &quot;get_from_clause()&quot;    C-&gt;&gt;C: &quot;get_order_by()&quot;    C-&gt;&gt;C: &quot;get_group_by()&quot;    C-&gt;&gt;C: &quot;as_sql()&quot;    C-&gt;&gt;DB: &quot;SQL + parameters&quot;    DB--&gt;&gt;C: &quot;æŸ¥è¯¢ç»“æœ&quot;    C--&gt;&gt;QS: &quot;å¤„ç†åçš„å¯¹è±¡&quot;</code></pre><h3 id="4-3-as-sql-æ–¹æ³•è¯¦è§£"><a href="#4-3-as-sql-æ–¹æ³•è¯¦è§£" class="headerlink" title="4.3 as_sql æ–¹æ³•è¯¦è§£"></a>4.3 as_sql æ–¹æ³•è¯¦è§£</h3><p>è¿™æ˜¯ç”Ÿæˆæœ€ç»ˆ SQL çš„æ ¸å¿ƒæ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">as_sql</span>(<span class="hljs-params">self, with_limits=<span class="hljs-literal">True</span>, with_col_aliases=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;åˆ›å»ºæŸ¥è¯¢çš„ SQLï¼Œè¿”å› SQL å­—ç¬¦ä¸²å’Œå‚æ•°åˆ—è¡¨&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># 1. å‡†å¤‡å·¥ä½œ</span><br>    refcounts_before = <span class="hljs-variable language_">self</span>.query.alias_refcount.copy()<br>    <span class="hljs-keyword">try</span>:<br>        extra_select, order_by, group_by = <span class="hljs-variable language_">self</span>.pre_sql_setup()<br>        distinct_fields = <span class="hljs-variable language_">self</span>.get_distinct()<br>        <br>        <span class="hljs-comment"># 2. æ„å»º FROM å­å¥ï¼ˆå¿…é¡»åœ¨ select, ordering, distinct ä¹‹åï¼‰</span><br>        from_, f_params = <span class="hljs-variable language_">self</span>.get_from_clause()<br>        <br>        <span class="hljs-comment"># 3. ç¼–è¯‘ WHERE å’Œ HAVING å­å¥</span><br>        where, w_params = <span class="hljs-variable language_">self</span>.<span class="hljs-built_in">compile</span>(<span class="hljs-variable language_">self</span>.where) <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.where <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> (<span class="hljs-string">&quot;&quot;</span>, [])<br>        having, h_params = <span class="hljs-variable language_">self</span>.<span class="hljs-built_in">compile</span>(<span class="hljs-variable language_">self</span>.having) <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.having <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> (<span class="hljs-string">&quot;&quot;</span>, [])<br>        <br>        <span class="hljs-comment"># 4. å¤„ç†é›†åˆæ“ä½œï¼ˆUNION, INTERSECT ç­‰ï¼‰</span><br>        combinator = <span class="hljs-variable language_">self</span>.query.combinator<br>        <span class="hljs-keyword">if</span> combinator:<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.get_combinator_sql(combinator, <span class="hljs-variable language_">self</span>.query.combinator_all)<br>        <br>        <span class="hljs-comment"># 5. æ„å»ºåŸºæœ¬æŸ¥è¯¢ç»“æ„</span><br>        result = [<span class="hljs-string">&#x27;SELECT&#x27;</span>]<br>        params = []<br>        <br>        <span class="hljs-comment"># 6. å¤„ç† DISTINCT</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.query.distinct:<br>            result.append(<span class="hljs-variable language_">self</span>.connection.ops.distinct_sql(distinct_fields))<br>        <br>        <span class="hljs-comment"># 7. æ„å»º SELECT å­å¥</span><br>        out_cols = []<br>        col_idx = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">for</span> _, (s_sql, s_params), alias <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.select + extra_select:<br>            <span class="hljs-keyword">if</span> alias:<br>                s_sql = <span class="hljs-string">&#x27;%s AS %s&#x27;</span> % (s_sql, <span class="hljs-variable language_">self</span>.connection.ops.quote_name(alias))<br>            <span class="hljs-keyword">elif</span> with_col_aliases:<br>                s_sql = <span class="hljs-string">&#x27;%s AS %s&#x27;</span> % (s_sql, <span class="hljs-string">&#x27;Col%d&#x27;</span> % col_idx)<br>                col_idx += <span class="hljs-number">1</span><br>            params.extend(s_params)<br>            out_cols.append(s_sql)<br>        <br>        result.append(<span class="hljs-string">&#x27;, &#x27;</span>.join(out_cols))<br>        <br>        <span class="hljs-comment"># 8. æ·»åŠ  FROM å­å¥</span><br>        result.append(<span class="hljs-string">&#x27;FROM&#x27;</span>)<br>        result.extend(from_)<br>        params.extend(f_params)<br>        <br>        <span class="hljs-comment"># 9. æ·»åŠ  WHERE å­å¥</span><br>        <span class="hljs-keyword">if</span> where:<br>            result.append(<span class="hljs-string">&#x27;WHERE %s&#x27;</span> % where)<br>            params.extend(w_params)<br>        <br>        <span class="hljs-comment"># 10. æ·»åŠ  GROUP BY å­å¥</span><br>        grouping = []<br>        <span class="hljs-keyword">for</span> g_sql, g_params <span class="hljs-keyword">in</span> group_by:<br>            grouping.append(g_sql)<br>            params.extend(g_params)<br>        <span class="hljs-keyword">if</span> grouping:<br>            result.append(<span class="hljs-string">&#x27;GROUP BY %s&#x27;</span> % <span class="hljs-string">&#x27;, &#x27;</span>.join(grouping))<br>        <br>        <span class="hljs-comment"># 11. æ·»åŠ  HAVING å­å¥</span><br>        <span class="hljs-keyword">if</span> having:<br>            result.append(<span class="hljs-string">&#x27;HAVING %s&#x27;</span> % having)<br>            params.extend(h_params)<br>        <br>        <span class="hljs-comment"># 12. æ·»åŠ  ORDER BY å­å¥</span><br>        <span class="hljs-keyword">if</span> order_by:<br>            ordering = []<br>            <span class="hljs-keyword">for</span> _, (o_sql, o_params, _) <span class="hljs-keyword">in</span> order_by:<br>                ordering.append(o_sql)<br>                params.extend(o_params)<br>            result.append(<span class="hljs-string">&#x27;ORDER BY %s&#x27;</span> % <span class="hljs-string">&#x27;, &#x27;</span>.join(ordering))<br>        <br>        <span class="hljs-comment"># 13. æ·»åŠ  LIMIT/OFFSET å­å¥</span><br>        <span class="hljs-keyword">if</span> with_limits:<br>            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.query.high_mark <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                result.append(<span class="hljs-string">&#x27;LIMIT %d&#x27;</span> % (<span class="hljs-variable language_">self</span>.query.high_mark - <span class="hljs-variable language_">self</span>.query.low_mark))<br>            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.query.low_mark:<br>                <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.query.high_mark <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                    val = <span class="hljs-variable language_">self</span>.connection.ops.no_limit_value()<br>                    <span class="hljs-keyword">if</span> val:<br>                        result.append(<span class="hljs-string">&#x27;LIMIT %d&#x27;</span> % val)<br>                result.append(<span class="hljs-string">&#x27;OFFSET %d&#x27;</span> % <span class="hljs-variable language_">self</span>.query.low_mark)<br>        <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27; &#x27;</span>.join(result), <span class="hljs-built_in">tuple</span>(params)<br>    <br>    <span class="hljs-keyword">finally</span>:<br>        <span class="hljs-comment"># æ¸…ç†å·¥ä½œ - æ¸…é™¤åˆ›å»ºçš„ JOIN</span><br>        <span class="hljs-variable language_">self</span>.query.reset_refcounts(refcounts_before)<br></code></pre></td></tr></table></figure><h2 id="5-SQL-ç”Ÿæˆæµç¨‹"><a href="#5-SQL-ç”Ÿæˆæµç¨‹" class="headerlink" title="5. SQL ç”Ÿæˆæµç¨‹"></a>5. SQL ç”Ÿæˆæµç¨‹</h2><h3 id="5-1-å®Œæ•´çš„-SQL-ç”Ÿæˆæµç¨‹å›¾"><a href="#5-1-å®Œæ•´çš„-SQL-ç”Ÿæˆæµç¨‹å›¾" class="headerlink" title="5.1 å®Œæ•´çš„ SQL ç”Ÿæˆæµç¨‹å›¾"></a>5.1 å®Œæ•´çš„ SQL ç”Ÿæˆæµç¨‹å›¾</h3><pre><code class=" mermaid">flowchart TD    A[&quot;QuerySet æ–¹æ³•è°ƒç”¨&quot;] --&gt; B[&quot;ä¿®æ”¹ Query å¯¹è±¡&quot;]    B --&gt; C[&quot;è§¦å‘æ±‚å€¼æ“ä½œ&quot;]    C --&gt; D[&quot;get_compiler()&quot;]    D --&gt; E[&quot;pre_sql_setup()&quot;]        E --&gt; F[&quot;setup_query()&quot;]    E --&gt; G[&quot;get_order_by()&quot;]    E --&gt; H[&quot;split_having()&quot;]    E --&gt; I[&quot;get_extra_select()&quot;]    E --&gt; J[&quot;get_group_by()&quot;]        F --&gt; K[&quot;get_select()&quot;]    K --&gt; L[&quot;get_default_columns()&quot;]    K --&gt; M[&quot;get_related_selections()&quot;]    K --&gt; N[&quot;å¤„ç†æ³¨è§£å­—æ®µ&quot;]        G --&gt; O[&quot;è§£ææ’åºå­—æ®µ&quot;]    O --&gt; P[&quot;å¤„ç†è¡¨è¾¾å¼æ’åº&quot;]        subgraph &quot;as_sql() æ ¸å¿ƒæ–¹æ³•&quot;        Q[&quot;get_from_clause()&quot;]        R[&quot;ç¼–è¯‘ WHERE æ¡ä»¶&quot;]        S[&quot;æ„å»º SELECT å­å¥&quot;]        T[&quot;æ„å»º FROM å­å¥&quot;]        U[&quot;æ„å»º WHERE å­å¥&quot;]        V[&quot;æ„å»º GROUP BY å­å¥&quot;]        W[&quot;æ„å»º HAVING å­å¥&quot;]        X[&quot;æ„å»º ORDER BY å­å¥&quot;]        Y[&quot;æ„å»º LIMIT/OFFSET å­å¥&quot;]    end        F --&gt; Q    R --&gt; U    S --&gt; T    T --&gt; U    U --&gt; V    V --&gt; W    W --&gt; X    X --&gt; Y    Y --&gt; Z[&quot;æœ€ç»ˆ SQL å­—ç¬¦ä¸²&quot;]        style A fill:#e1f5fe    style Z fill:#e8f5e8    style Q fill:#fff3e0    style R fill:#fff3e0    style S fill:#fff3e0</code></pre><h3 id="5-2-å…³é”®æ­¥éª¤è¯¦è§£"><a href="#5-2-å…³é”®æ­¥éª¤è¯¦è§£" class="headerlink" title="5.2 å…³é”®æ­¥éª¤è¯¦è§£"></a>5.2 å…³é”®æ­¥éª¤è¯¦è§£</h3><h4 id="æ­¥éª¤1ï¼šsetup-query"><a href="#æ­¥éª¤1ï¼šsetup-query" class="headerlink" title="æ­¥éª¤1ï¼šsetup_query()"></a>æ­¥éª¤1ï¼šsetup_query()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">setup_query</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è®¾ç½®æŸ¥è¯¢çš„åŸºæœ¬ä¿¡æ¯&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªè¡¨åˆ«å</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">all</span>(<span class="hljs-variable language_">self</span>.query.alias_refcount[a] == <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.query.tables):<br>        <span class="hljs-variable language_">self</span>.query.get_initial_alias()<br>    <br>    <span class="hljs-comment"># è·å– SELECT å­å¥ä¿¡æ¯</span><br>    <span class="hljs-variable language_">self</span>.select, <span class="hljs-variable language_">self</span>.klass_info, <span class="hljs-variable language_">self</span>.annotation_col_map = <span class="hljs-variable language_">self</span>.get_select()<br>    <span class="hljs-variable language_">self</span>.col_count = <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.select)<br></code></pre></td></tr></table></figure><h4 id="æ­¥éª¤2ï¼šget-select"><a href="#æ­¥éª¤2ï¼šget-select" class="headerlink" title="æ­¥éª¤2ï¼šget_select()"></a>æ­¥éª¤2ï¼šget_select()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_select</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ„å»º SELECT å­å¥çš„å­—æ®µåˆ—è¡¨&quot;&quot;&quot;</span><br>    select = []<br>    klass_info = <span class="hljs-literal">None</span><br>    annotations = &#123;&#125;<br>    select_idx = <span class="hljs-number">0</span><br>    <br>    <span class="hljs-comment"># å¤„ç† extra_select</span><br>    <span class="hljs-keyword">for</span> alias, (sql, params) <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.query.extra_select.items():<br>        select.append((RawSQL(sql, params), alias))<br>        select_idx += <span class="hljs-number">1</span><br>    <br>    <span class="hljs-comment"># å¤„ç†é»˜è®¤åˆ—ï¼ˆæ¨¡å‹çš„æ‰€æœ‰å­—æ®µï¼‰</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.query.default_cols:<br>        select_list = []<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.get_default_columns():<br>            select_list.append(select_idx)<br>            select.append((c, <span class="hljs-literal">None</span>))<br>            select_idx += <span class="hljs-number">1</span><br>        klass_info = &#123;<br>            <span class="hljs-string">&#x27;model&#x27;</span>: <span class="hljs-variable language_">self</span>.query.model,<br>            <span class="hljs-string">&#x27;select_fields&#x27;</span>: select_list,<br>        &#125;<br>    <br>    <span class="hljs-comment"># å¤„ç† select_related</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.query.select_related:<br>        related_klass_infos = <span class="hljs-variable language_">self</span>.get_related_selections(select)<br>        klass_info[<span class="hljs-string">&#x27;related_klass_infos&#x27;</span>] = related_klass_infos<br>    <br>    <span class="hljs-keyword">return</span> select, klass_info, annotations<br></code></pre></td></tr></table></figure><h2 id="6-å…³é”®æ•°æ®ç»“æ„"><a href="#6-å…³é”®æ•°æ®ç»“æ„" class="headerlink" title="6. å…³é”®æ•°æ®ç»“æ„"></a>6. å…³é”®æ•°æ®ç»“æ„</h2><h3 id="6-1-alias-map-ç»“æ„"><a href="#6-1-alias-map-ç»“æ„" class="headerlink" title="6.1 alias_map ç»“æ„"></a>6.1 alias_map ç»“æ„</h3><p><code>alias_map</code> æ˜¯ç®¡ç†è¡¨è¿æ¥çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># alias_map çš„ç»“æ„</span><br>&#123;<br>    <span class="hljs-string">&#x27;table_alias&#x27;</span>: Join(<br>        table_name=<span class="hljs-string">&#x27;actual_table_name&#x27;</span>,<br>        parent_alias=<span class="hljs-string">&#x27;parent_table_alias&#x27;</span>,<br>        table_alias=<span class="hljs-string">&#x27;current_alias&#x27;</span>,<br>        join_type=INNER,  <span class="hljs-comment"># æˆ– LOUTER</span><br>        join_field=field_object,<br>        nullable=<span class="hljs-literal">True</span>/<span class="hljs-literal">False</span><br>    )<br>&#125;<br><br><span class="hljs-comment"># ä¾‹å­ï¼šUser.objects.select_related(&#x27;profile&#x27;)</span><br>&#123;<br>    <span class="hljs-string">&#x27;auth_user&#x27;</span>: BaseTable(<span class="hljs-string">&#x27;auth_user&#x27;</span>, <span class="hljs-string">&#x27;auth_user&#x27;</span>),<br>    <span class="hljs-string">&#x27;auth_user__profile&#x27;</span>: Join(<br>        table_name=<span class="hljs-string">&#x27;user_profile&#x27;</span>,<br>        parent_alias=<span class="hljs-string">&#x27;auth_user&#x27;</span>, <br>        table_alias=<span class="hljs-string">&#x27;auth_user__profile&#x27;</span>,<br>        join_type=LOUTER,<br>        join_field=profile_field,<br>        nullable=<span class="hljs-literal">True</span><br>    )<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-2-WHERE-æ¡ä»¶æ ‘"><a href="#6-2-WHERE-æ¡ä»¶æ ‘" class="headerlink" title="6.2 WHERE æ¡ä»¶æ ‘"></a>6.2 WHERE æ¡ä»¶æ ‘</h3><p>WHERE æ¡ä»¶ä½¿ç”¨æ ‘å½¢ç»“æ„è¡¨ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WhereNode</span>(<span class="hljs-title class_ inherited__">Node</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;WHERE æ¡ä»¶çš„æ ‘èŠ‚ç‚¹&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(WhereNode, <span class="hljs-variable language_">self</span>).__init__()<br>        <span class="hljs-variable language_">self</span>.connector = AND  <span class="hljs-comment"># è¿æ¥ç¬¦ï¼šAND æˆ– OR</span><br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, data, conn_type</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;æ·»åŠ æ¡ä»¶åˆ°æ ‘ä¸­&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> data:<br>            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.connector == conn_type:<br>                <span class="hljs-comment"># ç›¸åŒè¿æ¥ç¬¦ï¼Œç›´æ¥æ·»åŠ </span><br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(data, Node) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> data.negated:<br>                    <span class="hljs-variable language_">self</span>.children.extend(data.children)<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-variable language_">self</span>.children.append(data)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># ä¸åŒè¿æ¥ç¬¦ï¼Œåˆ›å»ºæ–°çš„å­æ ‘</span><br>                obj = <span class="hljs-variable language_">self</span>.__class__()<br>                obj.connector = conn_type<br>                obj.children.append(data)<br>                <span class="hljs-variable language_">self</span>.children.append(obj)<br><br><span class="hljs-comment"># ä¾‹å­ï¼šUser.objects.filter(age__gt=18, name__startswith=&#x27;A&#x27;)</span><br><span class="hljs-comment"># ç”Ÿæˆçš„æ ‘ç»“æ„ï¼š</span><br>WhereNode(connector=AND, children=[<br>    Lookup(field=<span class="hljs-string">&#x27;age&#x27;</span>, lookup=<span class="hljs-string">&#x27;gt&#x27;</span>, value=<span class="hljs-number">18</span>),<br>    Lookup(field=<span class="hljs-string">&#x27;name&#x27;</span>, lookup=<span class="hljs-string">&#x27;startswith&#x27;</span>, value=<span class="hljs-string">&#x27;A&#x27;</span>)<br>])<br></code></pre></td></tr></table></figure><h2 id="7-å®æˆ˜æ¡ˆä¾‹åˆ†æ"><a href="#7-å®æˆ˜æ¡ˆä¾‹åˆ†æ" class="headerlink" title="7. å®æˆ˜æ¡ˆä¾‹åˆ†æ"></a>7. å®æˆ˜æ¡ˆä¾‹åˆ†æ</h2><h3 id="7-1-ç®€å•æŸ¥è¯¢çš„æ„å»ºè¿‡ç¨‹"><a href="#7-1-ç®€å•æŸ¥è¯¢çš„æ„å»ºè¿‡ç¨‹" class="headerlink" title="7.1 ç®€å•æŸ¥è¯¢çš„æ„å»ºè¿‡ç¨‹"></a>7.1 ç®€å•æŸ¥è¯¢çš„æ„å»ºè¿‡ç¨‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åŸå§‹æŸ¥è¯¢</span><br>User.objects.<span class="hljs-built_in">filter</span>(age__gt=<span class="hljs-number">18</span>).order_by(<span class="hljs-string">&#x27;name&#x27;</span>)<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤åˆ†æ</strong>ï¼š</p><ol><li><strong>åˆ›å»º Query å¯¹è±¡</strong></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">query = Query(User)<br><span class="hljs-comment"># query.model = User</span><br><span class="hljs-comment"># query.alias_map = &#123;&#125;</span><br><span class="hljs-comment"># query.where = WhereNode()</span><br></code></pre></td></tr></table></figure><ol start="2"><li><strong>æ·»åŠ è¿‡æ»¤æ¡ä»¶</strong></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># filter(age__gt=18) è°ƒç”¨</span><br>lookup = Lookup(field=<span class="hljs-string">&#x27;age&#x27;</span>, lookup=<span class="hljs-string">&#x27;gt&#x27;</span>, value=<span class="hljs-number">18</span>)<br>query.where.add(lookup, AND)<br></code></pre></td></tr></table></figure><ol start="3"><li><strong>æ·»åŠ æ’åº</strong></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># order_by(&#x27;name&#x27;) è°ƒç”¨  </span><br>query.order_by = [<span class="hljs-string">&#x27;name&#x27;</span>]<br></code></pre></td></tr></table></figure><ol start="4"><li><strong>ç”Ÿæˆ SQL</strong></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">compiler = query.get_compiler(<span class="hljs-string">&#x27;default&#x27;</span>)<br>sql, params = compiler.as_sql()<br><span class="hljs-comment"># ç»“æœ: &quot;SELECT ... FROM auth_user WHERE age &gt; %s ORDER BY name&quot;, [18]</span><br></code></pre></td></tr></table></figure><h3 id="7-2-å¤æ‚å…³è”æŸ¥è¯¢"><a href="#7-2-å¤æ‚å…³è”æŸ¥è¯¢" class="headerlink" title="7.2 å¤æ‚å…³è”æŸ¥è¯¢"></a>7.2 å¤æ‚å…³è”æŸ¥è¯¢</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¤æ‚æŸ¥è¯¢</span><br>Post.objects.select_related(<span class="hljs-string">&#x27;author&#x27;</span>, <span class="hljs-string">&#x27;category&#x27;</span>).<span class="hljs-built_in">filter</span>(<br>    author__age__gt=<span class="hljs-number">25</span>,<br>    category__name=<span class="hljs-string">&#x27;Tech&#x27;</span><br>).order_by(<span class="hljs-string">&#x27;-created_at&#x27;</span>)<br></code></pre></td></tr></table></figure><p><strong>æ„å»ºè¿‡ç¨‹</strong>ï¼š</p><ol><li><strong>å¤„ç† select_related</strong></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åœ¨ alias_map ä¸­æ·»åŠ  JOIN ä¿¡æ¯</span><br>query.alias_map = &#123;<br>    <span class="hljs-string">&#x27;blog_post&#x27;</span>: BaseTable(<span class="hljs-string">&#x27;blog_post&#x27;</span>, <span class="hljs-string">&#x27;blog_post&#x27;</span>),<br>    <span class="hljs-string">&#x27;blog_post__author&#x27;</span>: Join(<br>        table_name=<span class="hljs-string">&#x27;auth_user&#x27;</span>,<br>        parent_alias=<span class="hljs-string">&#x27;blog_post&#x27;</span>,<br>        table_alias=<span class="hljs-string">&#x27;blog_post__author&#x27;</span>,<br>        join_type=INNER,<br>        join_cols=[(<span class="hljs-string">&#x27;blog_post&#x27;</span>, <span class="hljs-string">&#x27;author_id&#x27;</span>, <span class="hljs-string">&#x27;id&#x27;</span>)]<br>    ),<br>    <span class="hljs-string">&#x27;blog_post__category&#x27;</span>: Join(<br>        table_name=<span class="hljs-string">&#x27;blog_category&#x27;</span>, <br>        parent_alias=<span class="hljs-string">&#x27;blog_post&#x27;</span>,<br>        table_alias=<span class="hljs-string">&#x27;blog_post__category&#x27;</span>,<br>        join_type=INNER,<br>        join_cols=[(<span class="hljs-string">&#x27;blog_post&#x27;</span>, <span class="hljs-string">&#x27;category_id&#x27;</span>, <span class="hljs-string">&#x27;id&#x27;</span>)]<br>    )<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li><strong>å¤„ç† WHERE æ¡ä»¶</strong></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">query.where = WhereNode(connector=AND, children=[<br>    Lookup(field=<span class="hljs-string">&#x27;blog_post__author__age&#x27;</span>, lookup=<span class="hljs-string">&#x27;gt&#x27;</span>, value=<span class="hljs-number">25</span>),<br>    Lookup(field=<span class="hljs-string">&#x27;blog_post__category__name&#x27;</span>, lookup=<span class="hljs-string">&#x27;exact&#x27;</span>, value=<span class="hljs-string">&#x27;Tech&#x27;</span>)<br>])<br></code></pre></td></tr></table></figure><ol start="3"><li><strong>ç”Ÿæˆçš„ SQL</strong></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <br>    blog_post.id, blog_post.title, blog_post.author_id, blog_post.category_id,<br>    auth_user.id, auth_user.name, auth_user.age,<br>    blog_category.id, blog_category.name<br><span class="hljs-keyword">FROM</span> blog_post <br><span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> auth_user <span class="hljs-keyword">ON</span> (blog_post.author_id <span class="hljs-operator">=</span> auth_user.id)<br><span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> blog_category <span class="hljs-keyword">ON</span> (blog_post.category_id <span class="hljs-operator">=</span> blog_category.id)<br><span class="hljs-keyword">WHERE</span> auth_user.age <span class="hljs-operator">&gt;</span> <span class="hljs-operator">%</span>s <span class="hljs-keyword">AND</span> blog_category.name <span class="hljs-operator">=</span> <span class="hljs-operator">%</span>s<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> blog_post.created_at <span class="hljs-keyword">DESC</span><br></code></pre></td></tr></table></figure><h3 id="7-3-èšåˆæŸ¥è¯¢çš„å¤„ç†"><a href="#7-3-èšåˆæŸ¥è¯¢çš„å¤„ç†" class="headerlink" title="7.3 èšåˆæŸ¥è¯¢çš„å¤„ç†"></a>7.3 èšåˆæŸ¥è¯¢çš„å¤„ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># èšåˆæŸ¥è¯¢</span><br>User.objects.values(<span class="hljs-string">&#x27;department&#x27;</span>).annotate(<br>    count=Count(<span class="hljs-string">&#x27;id&#x27;</span>),<br>    avg_age=Avg(<span class="hljs-string">&#x27;age&#x27;</span>)<br>).<span class="hljs-built_in">filter</span>(count__gt=<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p><strong>æ„å»ºè¿‡ç¨‹</strong>ï¼š</p><ol><li><strong>å¤„ç† values() è°ƒç”¨</strong></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">query.values_select = [<span class="hljs-string">&#x27;department&#x27;</span>]<br>query.default_cols = <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><ol start="2"><li><strong>å¤„ç† annotate() è°ƒç”¨</strong></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">query.annotations = OrderedDict([<br>    (<span class="hljs-string">&#x27;count&#x27;</span>, Count(<span class="hljs-string">&#x27;id&#x27;</span>)),<br>    (<span class="hljs-string">&#x27;avg_age&#x27;</span>, Avg(<span class="hljs-string">&#x27;age&#x27;</span>))<br>])<br>query.group_by = <span class="hljs-literal">True</span>  <span class="hljs-comment"># æŒ‰ values_select åˆ†ç»„</span><br></code></pre></td></tr></table></figure><ol start="3"><li><strong>å¤„ç† HAVING æ¡ä»¶</strong></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># filter(count__gt=5) è¢«è¯†åˆ«ä¸º HAVING æ¡ä»¶</span><br>having_lookup = Lookup(field=<span class="hljs-string">&#x27;count&#x27;</span>, lookup=<span class="hljs-string">&#x27;gt&#x27;</span>, value=<span class="hljs-number">5</span>)<br>query.having.add(having_lookup, AND)<br></code></pre></td></tr></table></figure><ol start="4"><li><strong>ç”Ÿæˆçš„ SQL</strong></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <br>    auth_user.department,<br>    <span class="hljs-built_in">COUNT</span>(auth_user.id) <span class="hljs-keyword">AS</span> count,<br>    <span class="hljs-built_in">AVG</span>(auth_user.age) <span class="hljs-keyword">AS</span> avg_age<br><span class="hljs-keyword">FROM</span> auth_user<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> auth_user.department<br><span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(auth_user.id) <span class="hljs-operator">&gt;</span> <span class="hljs-operator">%</span>s<br></code></pre></td></tr></table></figure><h2 id="8-é«˜çº§ç‰¹æ€§"><a href="#8-é«˜çº§ç‰¹æ€§" class="headerlink" title="8. é«˜çº§ç‰¹æ€§"></a>8. é«˜çº§ç‰¹æ€§</h2><h3 id="8-1-å­æŸ¥è¯¢å¤„ç†"><a href="#8-1-å­æŸ¥è¯¢å¤„ç†" class="headerlink" title="8.1 å­æŸ¥è¯¢å¤„ç†"></a>8.1 å­æŸ¥è¯¢å¤„ç†</h3><p>Django æ”¯æŒå¤šç§ç±»å‹çš„å­æŸ¥è¯¢ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ ‡é‡å­æŸ¥è¯¢</span><br>newest_posts = Post.objects.<span class="hljs-built_in">filter</span>(<br>    author=OuterRef(<span class="hljs-string">&#x27;pk&#x27;</span>)<br>).order_by(<span class="hljs-string">&#x27;-created_at&#x27;</span>)<br><br>authors_with_recent_posts = Author.objects.annotate(<br>    newest_post_title=Subquery(newest_posts.values(<span class="hljs-string">&#x27;title&#x27;</span>)[:<span class="hljs-number">1</span>])<br>)<br></code></pre></td></tr></table></figure><p><strong>å®ç°æœºåˆ¶</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>Subquery</code> è¡¨è¾¾å¼åŒ…è£…å†…éƒ¨æŸ¥è¯¢</li><li>ç¼–è¯‘æ—¶é€’å½’è°ƒç”¨ <code>as_sql()</code> æ–¹æ³•</li><li>æ­£ç¡®å¤„ç†å¤–éƒ¨å¼•ç”¨ (<code>OuterRef</code>)</li></ul><h3 id="8-2-é›†åˆæ“ä½œ"><a href="#8-2-é›†åˆæ“ä½œ" class="headerlink" title="8.2 é›†åˆæ“ä½œ"></a>8.2 é›†åˆæ“ä½œ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># UNION æŸ¥è¯¢</span><br>recent_posts = Post.objects.<span class="hljs-built_in">filter</span>(created_at__gte=recent_date)<br>popular_posts = Post.objects.<span class="hljs-built_in">filter</span>(views__gte=<span class="hljs-number">1000</span>)<br>combined = recent_posts.union(popular_posts)<br></code></pre></td></tr></table></figure><p><strong>å®ç°æœºåˆ¶</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_combinator_sql</span>(<span class="hljs-params">self, combinator, <span class="hljs-built_in">all</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å¤„ç†é›†åˆæ“ä½œçš„ SQL ç”Ÿæˆ&quot;&quot;&quot;</span><br>    compilers = [<br>        query.get_compiler(<span class="hljs-variable language_">self</span>.using, <span class="hljs-variable language_">self</span>.connection)<br>        <span class="hljs-keyword">for</span> query <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.query.combined_queries<br>    ]<br>    parts = (compiler.as_sql() <span class="hljs-keyword">for</span> compiler <span class="hljs-keyword">in</span> compilers)<br>    combinator_sql = <span class="hljs-variable language_">self</span>.connection.ops.set_operators[combinator]<br>    sql_parts, args_parts = <span class="hljs-built_in">zip</span>(*parts)<br>    result = <span class="hljs-string">&#x27; &#123;&#125; &#x27;</span>.<span class="hljs-built_in">format</span>(combinator_sql).join(sql_parts)<br>    <span class="hljs-keyword">return</span> result, combined_params<br></code></pre></td></tr></table></figure><h3 id="8-3-åŸå§‹-SQL-æ”¯æŒ"><a href="#8-3-åŸå§‹-SQL-æ”¯æŒ" class="headerlink" title="8.3 åŸå§‹ SQL æ”¯æŒ"></a>8.3 åŸå§‹ SQL æ”¯æŒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä½¿ç”¨åŸå§‹ SQL</span><br>users = User.objects.extra(<br>    select=&#123;<span class="hljs-string">&#x27;full_name&#x27;</span>: <span class="hljs-string">&quot;first_name || &#x27; &#x27; || last_name&quot;</span>&#125;,<br>    where=[<span class="hljs-string">&quot;age &gt; %s&quot;</span>],<br>    params=[<span class="hljs-number">18</span>]<br>)<br></code></pre></td></tr></table></figure><p><strong>å®ç°æœºåˆ¶</strong>ï¼š</p><ul><li><code>extra_select</code> ç›´æ¥æ’å…¥åˆ° SELECT å­å¥</li><li><code>extra_where</code> ä½¿ç”¨ <code>ExtraWhere</code> èŠ‚ç‚¹</li><li>å‚æ•°é€šè¿‡ <code>params</code> ä¼ é€’</li></ul><h2 id="9-æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥"><a href="#9-æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="9. æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥"></a>9. æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥</h2><h3 id="9-1-åŸºç¡€ä¼˜åŒ–æŠ€å·§"><a href="#9-1-åŸºç¡€ä¼˜åŒ–æŠ€å·§" class="headerlink" title="9.1 åŸºç¡€ä¼˜åŒ–æŠ€å·§"></a>9.1 åŸºç¡€ä¼˜åŒ–æŠ€å·§</h3><h4 id="1-å­—æ®µé€‰æ‹©ä¼˜åŒ–"><a href="#1-å­—æ®µé€‰æ‹©ä¼˜åŒ–" class="headerlink" title="1. å­—æ®µé€‰æ‹©ä¼˜åŒ–"></a>1. å­—æ®µé€‰æ‹©ä¼˜åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># âŒ é¿å…ï¼šé€‰æ‹©æ‰€æœ‰å­—æ®µ</span><br>User.objects.<span class="hljs-built_in">all</span>()<br><br><span class="hljs-comment"># âœ… æ¨èï¼šåªé€‰æ‹©éœ€è¦çš„å­—æ®µ</span><br>User.objects.only(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;email&#x27;</span>)<br>User.objects.values(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;email&#x27;</span>)<br>User.objects.values_list(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;email&#x27;</span>)<br><br><span class="hljs-comment"># âœ… æ¨èï¼šå»¶è¿ŸåŠ è½½ä¸å¸¸ç”¨å­—æ®µ</span><br>User.objects.defer(<span class="hljs-string">&#x27;bio&#x27;</span>, <span class="hljs-string">&#x27;avatar&#x27;</span>)<br></code></pre></td></tr></table></figure><h4 id="2-å…³è”æŸ¥è¯¢ä¼˜åŒ–"><a href="#2-å…³è”æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2. å…³è”æŸ¥è¯¢ä¼˜åŒ–"></a>2. å…³è”æŸ¥è¯¢ä¼˜åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># âŒ é¿å…ï¼šN+1 æŸ¥è¯¢é—®é¢˜</span><br>posts = Post.objects.<span class="hljs-built_in">all</span>()<br><span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> posts:<br>    <span class="hljs-built_in">print</span>(post.author.name)  <span class="hljs-comment"># æ¯æ¬¡éƒ½æŸ¥è¯¢æ•°æ®åº“</span><br><br><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨ select_related (ForeignKey, OneToOne)</span><br>posts = Post.objects.select_related(<span class="hljs-string">&#x27;author&#x27;</span>, <span class="hljs-string">&#x27;category&#x27;</span>)<br><span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> posts:<br>    <span class="hljs-built_in">print</span>(post.author.name)  <span class="hljs-comment"># åªæŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“</span><br><br><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨ prefetch_related (ManyToMany, åå‘ForeignKey)</span><br>authors = Author.objects.prefetch_related(<span class="hljs-string">&#x27;posts&#x27;</span>)<br><span class="hljs-keyword">for</span> author <span class="hljs-keyword">in</span> authors:<br>    <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> author.posts.<span class="hljs-built_in">all</span>():<br>        <span class="hljs-built_in">print</span>(post.title)<br></code></pre></td></tr></table></figure><h4 id="3-æŸ¥è¯¢æ¡ä»¶ä¼˜åŒ–"><a href="#3-æŸ¥è¯¢æ¡ä»¶ä¼˜åŒ–" class="headerlink" title="3. æŸ¥è¯¢æ¡ä»¶ä¼˜åŒ–"></a>3. æŸ¥è¯¢æ¡ä»¶ä¼˜åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨æ•°æ®åº“ç´¢å¼•å­—æ®µè¿›è¡Œè¿‡æ»¤</span><br>User.objects.<span class="hljs-built_in">filter</span>(email=<span class="hljs-string">&#x27;user@example.com&#x27;</span>)  <span class="hljs-comment"># email å­—æ®µæœ‰ç´¢å¼•</span><br><br><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨ exists() æ£€æŸ¥å­˜åœ¨æ€§</span><br><span class="hljs-keyword">if</span> User.objects.<span class="hljs-built_in">filter</span>(email=<span class="hljs-string">&#x27;user@example.com&#x27;</span>).exists():<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-comment"># âŒ é¿å…ï¼šä½¿ç”¨ len() æˆ– count() æ£€æŸ¥å­˜åœ¨æ€§</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(User.objects.<span class="hljs-built_in">filter</span>(email=<span class="hljs-string">&#x27;user@example.com&#x27;</span>)) &gt; <span class="hljs-number">0</span>:<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h3 id="9-2-é«˜çº§ä¼˜åŒ–ç­–ç•¥"><a href="#9-2-é«˜çº§ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="9.2 é«˜çº§ä¼˜åŒ–ç­–ç•¥"></a>9.2 é«˜çº§ä¼˜åŒ–ç­–ç•¥</h3><h4 id="1-æ‰¹é‡æ“ä½œä¼˜åŒ–"><a href="#1-æ‰¹é‡æ“ä½œä¼˜åŒ–" class="headerlink" title="1. æ‰¹é‡æ“ä½œä¼˜åŒ–"></a>1. æ‰¹é‡æ“ä½œä¼˜åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨ bulk_create</span><br>users = [User(name=<span class="hljs-string">f&#x27;User<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>)]<br>User.objects.bulk_create(users, batch_size=<span class="hljs-number">100</span>)<br><br><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨ bulk_update</span><br>users = User.objects.<span class="hljs-built_in">filter</span>(department=<span class="hljs-string">&#x27;IT&#x27;</span>)<br><span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> users:<br>    user.salary *= <span class="hljs-number">1.1</span><br>User.objects.bulk_update(users, [<span class="hljs-string">&#x27;salary&#x27;</span>], batch_size=<span class="hljs-number">100</span>)<br><br><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨ update() è¿›è¡Œæ‰¹é‡æ›´æ–°</span><br>User.objects.<span class="hljs-built_in">filter</span>(department=<span class="hljs-string">&#x27;IT&#x27;</span>).update(salary=F(<span class="hljs-string">&#x27;salary&#x27;</span>) * <span class="hljs-number">1.1</span>)<br><br><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨ delete() è¿›è¡Œæ‰¹é‡åˆ é™¤</span><br>User.objects.<span class="hljs-built_in">filter</span>(is_active=<span class="hljs-literal">False</span>).delete()<br></code></pre></td></tr></table></figure><h4 id="2-å†…å­˜ä½¿ç”¨ä¼˜åŒ–"><a href="#2-å†…å­˜ä½¿ç”¨ä¼˜åŒ–" class="headerlink" title="2. å†…å­˜ä½¿ç”¨ä¼˜åŒ–"></a>2. å†…å­˜ä½¿ç”¨ä¼˜åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨ iterator() å¤„ç†å¤§æ•°æ®é›†</span><br><span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> User.objects.<span class="hljs-built_in">all</span>().iterator(chunk_size=<span class="hljs-number">1000</span>):<br>    process_user(user)<br><br><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨ values() å‡å°‘å†…å­˜å ç”¨</span><br><span class="hljs-keyword">for</span> user_data <span class="hljs-keyword">in</span> User.objects.values(<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>).iterator():<br>    process_user_data(user_data)<br><br><span class="hljs-comment"># âœ… æ¨èï¼šåˆ†é¡µå¤„ç†å¤§é‡æ•°æ®</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_users_in_batches</span>(<span class="hljs-params">batch_size=<span class="hljs-number">1000</span></span>):<br>    users = User.objects.<span class="hljs-built_in">all</span>()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, users.count(), batch_size):<br>        batch = users[i:i + batch_size]<br>        <span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> batch:<br>            process_user(user)<br></code></pre></td></tr></table></figure><h4 id="3-æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–"><a href="#3-æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–" class="headerlink" title="3. æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–"></a>3. æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># âœ… æ¨èï¼šé‡ç”¨ QuerySet ä»¥åˆ©ç”¨ç¼“å­˜</span><br>users = User.objects.<span class="hljs-built_in">filter</span>(is_active=<span class="hljs-literal">True</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(users))  <span class="hljs-comment"># æ‰§è¡ŒæŸ¥è¯¢å¹¶ç¼“å­˜</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bool</span>(users))  <span class="hljs-comment"># ä½¿ç”¨ç¼“å­˜</span><br><br><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨ prefetch_related çš„ Prefetch å¯¹è±¡è‡ªå®šä¹‰é¢„å–</span><br><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> Prefetch<br><br>authors = Author.objects.prefetch_related(<br>    Prefetch(<br>        <span class="hljs-string">&#x27;posts&#x27;</span>,<br>        queryset=Post.objects.select_related(<span class="hljs-string">&#x27;category&#x27;</span>).<span class="hljs-built_in">filter</span>(is_published=<span class="hljs-literal">True</span>),<br>        to_attr=<span class="hljs-string">&#x27;published_posts&#x27;</span><br>    )<br>)<br></code></pre></td></tr></table></figure><h4 id="4-æ•°æ®åº“çº§åˆ«ä¼˜åŒ–"><a href="#4-æ•°æ®åº“çº§åˆ«ä¼˜åŒ–" class="headerlink" title="4. æ•°æ®åº“çº§åˆ«ä¼˜åŒ–"></a>4. æ•°æ®åº“çº§åˆ«ä¼˜åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨ select_for_update é¿å…å¹¶å‘é—®é¢˜</span><br><span class="hljs-keyword">with</span> transaction.atomic():<br>    user = User.objects.select_for_update().get(pk=user_id)<br>    user.balance -= amount<br>    user.save()<br><br><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨ raw SQL å¤„ç†å¤æ‚æŸ¥è¯¢</span><br>users = User.objects.raw(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    SELECT u.*, COUNT(p.id) as post_count</span><br><span class="hljs-string">    FROM auth_user u</span><br><span class="hljs-string">    LEFT JOIN blog_post p ON u.id = p.author_id</span><br><span class="hljs-string">    GROUP BY u.id</span><br><span class="hljs-string">    HAVING COUNT(p.id) &gt; %s</span><br><span class="hljs-string">&quot;&quot;&quot;</span>, [<span class="hljs-number">5</span>])<br><br><span class="hljs-comment"># âœ… æ¨èï¼šä½¿ç”¨æ•°æ®åº“å‡½æ•°</span><br><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> F, Value<br><span class="hljs-keyword">from</span> django.db.models.functions <span class="hljs-keyword">import</span> Concat<br><br>User.objects.annotate(<br>    full_name=Concat(<span class="hljs-string">&#x27;first_name&#x27;</span>, Value(<span class="hljs-string">&#x27; &#x27;</span>), <span class="hljs-string">&#x27;last_name&#x27;</span>)<br>)<br></code></pre></td></tr></table></figure><h3 id="9-3-æŸ¥è¯¢æ€§èƒ½åˆ†æ"><a href="#9-3-æŸ¥è¯¢æ€§èƒ½åˆ†æ" class="headerlink" title="9.3 æŸ¥è¯¢æ€§èƒ½åˆ†æ"></a>9.3 æŸ¥è¯¢æ€§èƒ½åˆ†æ</h3><h4 id="1-ä½¿ç”¨-explain-åˆ†ææŸ¥è¯¢è®¡åˆ’"><a href="#1-ä½¿ç”¨-explain-åˆ†ææŸ¥è¯¢è®¡åˆ’" class="headerlink" title="1. ä½¿ç”¨ explain() åˆ†ææŸ¥è¯¢è®¡åˆ’"></a>1. ä½¿ç”¨ explain() åˆ†ææŸ¥è¯¢è®¡åˆ’</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Django 2.1+ æ”¯æŒ</span><br>queryset = User.objects.<span class="hljs-built_in">filter</span>(age__gt=<span class="hljs-number">25</span>).select_related(<span class="hljs-string">&#x27;profile&#x27;</span>)<br><span class="hljs-built_in">print</span>(queryset.explain())<br><br><span class="hljs-comment"># æ›´è¯¦ç»†çš„åˆ†æ</span><br><span class="hljs-built_in">print</span>(queryset.explain(options=&#123;<span class="hljs-string">&#x27;ANALYZE&#x27;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;VERBOSE&#x27;</span>: <span class="hljs-literal">True</span>&#125;))<br></code></pre></td></tr></table></figure><h4 id="2-ä½¿ç”¨-Django-Debug-Toolbar"><a href="#2-ä½¿ç”¨-Django-Debug-Toolbar" class="headerlink" title="2. ä½¿ç”¨ Django Debug Toolbar"></a>2. ä½¿ç”¨ Django Debug Toolbar</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># settings.py</span><br><span class="hljs-keyword">if</span> DEBUG:<br>    INSTALLED_APPS += [<span class="hljs-string">&#x27;debug_toolbar&#x27;</span>]<br>    MIDDLEWARE += [<span class="hljs-string">&#x27;debug_toolbar.middleware.DebugToolbarMiddleware&#x27;</span>]<br>    INTERNAL_IPS = [<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>]<br></code></pre></td></tr></table></figure><h4 id="3-è‡ªå®šä¹‰æŸ¥è¯¢åˆ†æå™¨"><a href="#3-è‡ªå®šä¹‰æŸ¥è¯¢åˆ†æå™¨" class="headerlink" title="3. è‡ªå®šä¹‰æŸ¥è¯¢åˆ†æå™¨"></a>3. è‡ªå®šä¹‰æŸ¥è¯¢åˆ†æå™¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> connection<br><span class="hljs-keyword">from</span> django.core.management.base <span class="hljs-keyword">import</span> BaseCommand<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryAnalyzer</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.queries = []<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.initial_queries = <span class="hljs-built_in">len</span>(connection.queries)<br>        <span class="hljs-variable language_">self</span>.start_time = time.time()<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span><br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, exc_type, exc_val, exc_tb</span>):<br>        <span class="hljs-variable language_">self</span>.end_time = time.time()<br>        <span class="hljs-variable language_">self</span>.queries = connection.queries[<span class="hljs-variable language_">self</span>.initial_queries:]<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">report</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ‰§è¡Œäº† <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(self.queries)&#125;</span> ä¸ªæŸ¥è¯¢&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ€»æ—¶é—´: <span class="hljs-subst">&#123;self.end_time - self.start_time:<span class="hljs-number">.4</span>f&#125;</span>s&quot;</span>)<br>        <br>        <span class="hljs-keyword">for</span> i, query <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-variable language_">self</span>.queries, <span class="hljs-number">1</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æŸ¥è¯¢ <span class="hljs-subst">&#123;i&#125;</span>: <span class="hljs-subst">&#123;query[<span class="hljs-string">&#x27;time&#x27;</span>]&#125;</span>s&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;SQL: <span class="hljs-subst">&#123;query[<span class="hljs-string">&#x27;sql&#x27;</span>]&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">50</span>)<br><br><span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span><br><span class="hljs-keyword">with</span> QueryAnalyzer() <span class="hljs-keyword">as</span> analyzer:<br>    users = <span class="hljs-built_in">list</span>(User.objects.select_related(<span class="hljs-string">&#x27;profile&#x27;</span>).<span class="hljs-built_in">all</span>())<br>    <br>analyzer.report()<br></code></pre></td></tr></table></figure><h3 id="9-4-å¸¸è§åæ¨¡å¼åŠè§£å†³æ–¹æ¡ˆ"><a href="#9-4-å¸¸è§åæ¨¡å¼åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="9.4 å¸¸è§åæ¨¡å¼åŠè§£å†³æ–¹æ¡ˆ"></a>9.4 å¸¸è§åæ¨¡å¼åŠè§£å†³æ–¹æ¡ˆ</h3><h4 id="1-é¿å…åœ¨å¾ªç¯ä¸­æŸ¥è¯¢"><a href="#1-é¿å…åœ¨å¾ªç¯ä¸­æŸ¥è¯¢" class="headerlink" title="1. é¿å…åœ¨å¾ªç¯ä¸­æŸ¥è¯¢"></a>1. é¿å…åœ¨å¾ªç¯ä¸­æŸ¥è¯¢</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># âŒ åæ¨¡å¼ï¼šåœ¨å¾ªç¯ä¸­æŸ¥è¯¢</span><br>posts = Post.objects.<span class="hljs-built_in">all</span>()<br><span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> posts:<br>    author = User.objects.get(<span class="hljs-built_in">id</span>=post.author_id)  <span class="hljs-comment"># N+1 æŸ¥è¯¢</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;post.title&#125;</span> by <span class="hljs-subst">&#123;author.name&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ select_related</span><br>posts = Post.objects.select_related(<span class="hljs-string">&#x27;author&#x27;</span>).<span class="hljs-built_in">all</span>()<br><span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> posts:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;post.title&#125;</span> by <span class="hljs-subst">&#123;post.author.name&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><h4 id="2-é¿å…é‡å¤æŸ¥è¯¢"><a href="#2-é¿å…é‡å¤æŸ¥è¯¢" class="headerlink" title="2. é¿å…é‡å¤æŸ¥è¯¢"></a>2. é¿å…é‡å¤æŸ¥è¯¢</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># âŒ åæ¨¡å¼ï¼šé‡å¤æŸ¥è¯¢</span><br>active_users = User.objects.<span class="hljs-built_in">filter</span>(is_active=<span class="hljs-literal">True</span>)<br>user_count = User.objects.<span class="hljs-built_in">filter</span>(is_active=<span class="hljs-literal">True</span>).count()  <span class="hljs-comment"># é‡å¤æŸ¥è¯¢</span><br>user_list = User.objects.<span class="hljs-built_in">filter</span>(is_active=<span class="hljs-literal">True</span>).<span class="hljs-built_in">all</span>()     <span class="hljs-comment"># é‡å¤æŸ¥è¯¢</span><br><br><span class="hljs-comment"># âœ… è§£å†³æ–¹æ¡ˆï¼šé‡ç”¨ QuerySet</span><br>active_users = User.objects.<span class="hljs-built_in">filter</span>(is_active=<span class="hljs-literal">True</span>)<br>user_count = active_users.count()<br>user_list = <span class="hljs-built_in">list</span>(active_users)  <span class="hljs-comment"># ç¼“å­˜ç»“æœ</span><br></code></pre></td></tr></table></figure><h4 id="3-é¿å…ä¸å¿…è¦çš„æ’åº"><a href="#3-é¿å…ä¸å¿…è¦çš„æ’åº" class="headerlink" title="3. é¿å…ä¸å¿…è¦çš„æ’åº"></a>3. é¿å…ä¸å¿…è¦çš„æ’åº</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># âŒ åæ¨¡å¼ï¼šä¸å¿…è¦çš„æ’åº</span><br>users = User.objects.<span class="hljs-built_in">all</span>().order_by(<span class="hljs-string">&#x27;name&#x27;</span>)<br>user_count = users.count()  <span class="hljs-comment"># count() ä¸éœ€è¦æ’åº</span><br><br><span class="hljs-comment"># âœ… è§£å†³æ–¹æ¡ˆï¼šåœ¨éœ€è¦æ—¶æ‰æ’åº</span><br>users = User.objects.<span class="hljs-built_in">all</span>()<br>user_count = users.count()<br>sorted_users = users.order_by(<span class="hljs-string">&#x27;name&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="9-5-æ•°æ®åº“ç‰¹å®šä¼˜åŒ–"><a href="#9-5-æ•°æ®åº“ç‰¹å®šä¼˜åŒ–" class="headerlink" title="9.5 æ•°æ®åº“ç‰¹å®šä¼˜åŒ–"></a>9.5 æ•°æ®åº“ç‰¹å®šä¼˜åŒ–</h3><h4 id="1-PostgreSQL-ä¼˜åŒ–"><a href="#1-PostgreSQL-ä¼˜åŒ–" class="headerlink" title="1. PostgreSQL ä¼˜åŒ–"></a>1. PostgreSQL ä¼˜åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä½¿ç”¨ PostgreSQL ç‰¹å®šåŠŸèƒ½</span><br><span class="hljs-keyword">from</span> django.contrib.postgres.search <span class="hljs-keyword">import</span> SearchVector, SearchQuery<br><span class="hljs-keyword">from</span> django.contrib.postgres.aggregates <span class="hljs-keyword">import</span> ArrayAgg<br><br><span class="hljs-comment"># å…¨æ–‡æœç´¢</span><br>Post.objects.annotate(<br>    search=SearchVector(<span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>)<br>).<span class="hljs-built_in">filter</span>(search=SearchQuery(<span class="hljs-string">&#x27;django&#x27;</span>))<br><br><span class="hljs-comment"># æ•°ç»„èšåˆ</span><br>authors = Author.objects.annotate(<br>    post_titles=ArrayAgg(<span class="hljs-string">&#x27;posts__title&#x27;</span>, distinct=<span class="hljs-literal">True</span>)<br>)<br></code></pre></td></tr></table></figure><h4 id="2-MySQL-ä¼˜åŒ–"><a href="#2-MySQL-ä¼˜åŒ–" class="headerlink" title="2. MySQL ä¼˜åŒ–"></a>2. MySQL ä¼˜åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä½¿ç”¨ MySQL ç‰¹å®šåŠŸèƒ½</span><br><span class="hljs-comment"># å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šç´¢å¼•</span><br>User.objects.extra(<br>    select=&#123;<span class="hljs-string">&#x27;force_index&#x27;</span>: <span class="hljs-string">&#x27;USE INDEX (idx_email)&#x27;</span>&#125;<br>).<span class="hljs-built_in">filter</span>(email__startswith=<span class="hljs-string">&#x27;admin&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="10-æ€§èƒ½ç›‘æ§ä¸è°ƒè¯•"><a href="#10-æ€§èƒ½ç›‘æ§ä¸è°ƒè¯•" class="headerlink" title="10. æ€§èƒ½ç›‘æ§ä¸è°ƒè¯•"></a>10. æ€§èƒ½ç›‘æ§ä¸è°ƒè¯•</h2><h3 id="10-1-SQL-æ—¥å¿—é…ç½®"><a href="#10-1-SQL-æ—¥å¿—é…ç½®" class="headerlink" title="10.1 SQL æ—¥å¿—é…ç½®"></a>10.1 SQL æ—¥å¿—é…ç½®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># settings.py</span><br>LOGGING = &#123;<br>    <span class="hljs-string">&#x27;version&#x27;</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-string">&#x27;disable_existing_loggers&#x27;</span>: <span class="hljs-literal">False</span>,<br>    <span class="hljs-string">&#x27;handlers&#x27;</span>: &#123;<br>        <span class="hljs-string">&#x27;console&#x27;</span>: &#123;<br>            <span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&#x27;logging.StreamHandler&#x27;</span>,<br>        &#125;,<br>        <span class="hljs-string">&#x27;file&#x27;</span>: &#123;<br>            <span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&#x27;logging.FileHandler&#x27;</span>,<br>            <span class="hljs-string">&#x27;filename&#x27;</span>: <span class="hljs-string">&#x27;sql.log&#x27;</span>,<br>        &#125;,<br>    &#125;,<br>    <span class="hljs-string">&#x27;loggers&#x27;</span>: &#123;<br>        <span class="hljs-string">&#x27;django.db.backends&#x27;</span>: &#123;<br>            <span class="hljs-string">&#x27;handlers&#x27;</span>: [<span class="hljs-string">&#x27;console&#x27;</span>, <span class="hljs-string">&#x27;file&#x27;</span>],<br>            <span class="hljs-string">&#x27;level&#x27;</span>: <span class="hljs-string">&#x27;DEBUG&#x27;</span>,<br>            <span class="hljs-string">&#x27;propagate&#x27;</span>: <span class="hljs-literal">False</span>,<br>        &#125;,<br>    &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="10-2-è‡ªå®šä¹‰ä¸­é—´ä»¶ç›‘æ§"><a href="#10-2-è‡ªå®šä¹‰ä¸­é—´ä»¶ç›‘æ§" class="headerlink" title="10.2 è‡ªå®šä¹‰ä¸­é—´ä»¶ç›‘æ§"></a>10.2 è‡ªå®šä¹‰ä¸­é—´ä»¶ç›‘æ§</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> connection<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SQLQueryCountMiddleware</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, get_response</span>):<br>        <span class="hljs-variable language_">self</span>.get_response = get_response<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self, request</span>):<br>        initial_queries = <span class="hljs-built_in">len</span>(connection.queries)<br>        start_time = time.time()<br>        <br>        response = <span class="hljs-variable language_">self</span>.get_response(request)<br>        <br>        end_time = time.time()<br>        query_count = <span class="hljs-built_in">len</span>(connection.queries) - initial_queries<br>        <br>        <span class="hljs-keyword">if</span> query_count &gt; <span class="hljs-number">10</span>:  <span class="hljs-comment"># æŸ¥è¯¢æ•°é‡é˜ˆå€¼</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è­¦å‘Š: <span class="hljs-subst">&#123;request.path&#125;</span> æ‰§è¡Œäº† <span class="hljs-subst">&#123;query_count&#125;</span> ä¸ªæŸ¥è¯¢&quot;</span>)<br>            <br>        response[<span class="hljs-string">&#x27;X-Query-Count&#x27;</span>] = <span class="hljs-built_in">str</span>(query_count)<br>        response[<span class="hljs-string">&#x27;X-Query-Time&#x27;</span>] = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.4</span>f&#125;</span>&quot;</span><br>        <br>        <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h3 id="10-3-æŸ¥è¯¢æ€§èƒ½æµ‹è¯•"><a href="#10-3-æŸ¥è¯¢æ€§èƒ½æµ‹è¯•" class="headerlink" title="10.3 æŸ¥è¯¢æ€§èƒ½æµ‹è¯•"></a>10.3 æŸ¥è¯¢æ€§èƒ½æµ‹è¯•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><span class="hljs-keyword">from</span> django.test <span class="hljs-keyword">import</span> TestCase<br><span class="hljs-keyword">from</span> django.test.utils <span class="hljs-keyword">import</span> override_settings<br><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> connection<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryPerformanceTest</span>(<span class="hljs-title class_ inherited__">TestCase</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_user_list_query_count</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;æµ‹è¯•ç”¨æˆ·åˆ—è¡¨é¡µé¢çš„æŸ¥è¯¢æ•°é‡&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># åˆ›å»ºæµ‹è¯•æ•°æ®</span><br>        users = [User(name=<span class="hljs-string">f&#x27;User<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br>        User.objects.bulk_create(users)<br>        <br>        <span class="hljs-keyword">with</span> <span class="hljs-variable language_">self</span>.assertNumQueries(<span class="hljs-number">1</span>):<br>            <span class="hljs-built_in">list</span>(User.objects.<span class="hljs-built_in">all</span>())<br>            <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_post_with_author_query_count</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;æµ‹è¯•å¸¦ä½œè€…ä¿¡æ¯çš„æ–‡ç« æŸ¥è¯¢&quot;&quot;&quot;</span><br>        author = User.objects.create(name=<span class="hljs-string">&#x27;Author&#x27;</span>)<br>        posts = [Post(title=<span class="hljs-string">f&#x27;Post<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>, author=author) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)]<br>        Post.objects.bulk_create(posts)<br>        <br>        <span class="hljs-comment"># ä½¿ç”¨ select_related åº”è¯¥åªæœ‰ 1 ä¸ªæŸ¥è¯¢</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-variable language_">self</span>.assertNumQueries(<span class="hljs-number">1</span>):<br>            posts_with_authors = Post.objects.select_related(<span class="hljs-string">&#x27;author&#x27;</span>).<span class="hljs-built_in">all</span>()<br>            <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> posts_with_authors:<br>                _ = post.author.name  <span class="hljs-comment"># è§¦å‘è®¿é—®ï¼Œä½†ä¸åº”è¯¥äº§ç”Ÿé¢å¤–æŸ¥è¯¢</span><br></code></pre></td></tr></table></figure><h2 id="11-æœ€ä½³å®è·µ"><a href="#11-æœ€ä½³å®è·µ" class="headerlink" title="11. æœ€ä½³å®è·µ"></a>11. æœ€ä½³å®è·µ</h2><h3 id="11-1-æŸ¥è¯¢è®¾è®¡åŸåˆ™"><a href="#11-1-æŸ¥è¯¢è®¾è®¡åŸåˆ™" class="headerlink" title="11.1 æŸ¥è¯¢è®¾è®¡åŸåˆ™"></a>11.1 æŸ¥è¯¢è®¾è®¡åŸåˆ™</h3><ol><li><strong>æœ€å°åŒ–æ•°æ®ä¼ è¾“</strong>ï¼šåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µå’Œè®°å½•</li><li><strong>å‡å°‘æŸ¥è¯¢æ¬¡æ•°</strong>ï¼šä½¿ç”¨ select_related å’Œ prefetch_related</li><li><strong>åˆ©ç”¨æ•°æ®åº“ç‰¹æ€§</strong>ï¼šä½¿ç”¨ç´¢å¼•ã€å­˜å‚¨è¿‡ç¨‹ã€è§†å›¾ç­‰</li><li><strong>åˆç†ä½¿ç”¨ç¼“å­˜</strong>ï¼šQuerySet ç¼“å­˜ã€Redisã€Memcached</li><li><strong>ç›‘æ§å’Œä¼˜åŒ–</strong>ï¼šå®šæœŸåˆ†ææ…¢æŸ¥è¯¢ï¼Œä¼˜åŒ–ç“¶é¢ˆ</li></ol><h3 id="11-2-ä»£ç ç»„ç»‡å»ºè®®"><a href="#11-2-ä»£ç ç»„ç»‡å»ºè®®" class="headerlink" title="11.2 ä»£ç ç»„ç»‡å»ºè®®"></a>11.2 ä»£ç ç»„ç»‡å»ºè®®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># models.py - åœ¨æ¨¡å‹ä¸­å®šä¹‰å¸¸ç”¨æŸ¥è¯¢</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserManager</span>(models.Manager):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">active</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.<span class="hljs-built_in">filter</span>(is_active=<span class="hljs-literal">True</span>)<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">with_posts</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.select_related().prefetch_related(<span class="hljs-string">&#x27;posts&#x27;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(models.Model):<br>    name = models.CharField(max_length=<span class="hljs-number">100</span>)<br>    is_active = models.BooleanField(default=<span class="hljs-literal">True</span>)<br>    <br>    objects = UserManager()<br><br><span class="hljs-comment"># views.py - åœ¨è§†å›¾ä¸­ä½¿ç”¨ä¼˜åŒ–çš„æŸ¥è¯¢</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">user_list</span>(<span class="hljs-params">request</span>):<br>    users = User.objects.active().with_posts()<br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;user_list.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;users&#x27;</span>: users&#125;)<br></code></pre></td></tr></table></figure><h3 id="11-3-æ€§èƒ½æ£€æŸ¥æ¸…å•"><a href="#11-3-æ€§èƒ½æ£€æŸ¥æ¸…å•" class="headerlink" title="11.3 æ€§èƒ½æ£€æŸ¥æ¸…å•"></a>11.3 æ€§èƒ½æ£€æŸ¥æ¸…å•</h3><ul><li><input disabled="" type="checkbox"> æ˜¯å¦ä½¿ç”¨äº†åˆé€‚çš„ select_related å’Œ prefetch_related</li><li><input disabled="" type="checkbox"> æ˜¯å¦é¿å…äº† N+1 æŸ¥è¯¢é—®é¢˜</li><li><input disabled="" type="checkbox"> æ˜¯å¦åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ</li><li><input disabled="" type="checkbox"> æ˜¯å¦ä¸ºå¸¸ç”¨æŸ¥è¯¢æ¡ä»¶åˆ›å»ºäº†ç´¢å¼•</li><li><input disabled="" type="checkbox"> æ˜¯å¦ä½¿ç”¨äº†æ‰¹é‡æ“ä½œè€Œä¸æ˜¯å¾ªç¯æ“ä½œ</li><li><input disabled="" type="checkbox"> æ˜¯å¦æ­£ç¡®å¤„ç†äº†å¤§æ•°æ®é›†ï¼ˆä½¿ç”¨ iteratorï¼‰</li><li><input disabled="" type="checkbox"> æ˜¯å¦ç›‘æ§äº†æŸ¥è¯¢æ€§èƒ½ï¼ˆæ…¢æŸ¥è¯¢æ—¥å¿—ï¼‰</li><li><input disabled="" type="checkbox"> æ˜¯å¦åœ¨å¿…è¦æ—¶ä½¿ç”¨äº†åŸå§‹ SQL</li></ul><h2 id="12-æ€»ç»“"><a href="#12-æ€»ç»“" class="headerlink" title="12. æ€»ç»“"></a>12. æ€»ç»“</h2><h3 id="12-1-æ ¸å¿ƒæ¶æ„å›é¡¾"><a href="#12-1-æ ¸å¿ƒæ¶æ„å›é¡¾" class="headerlink" title="12.1 æ ¸å¿ƒæ¶æ„å›é¡¾"></a>12.1 æ ¸å¿ƒæ¶æ„å›é¡¾</h3><p>Django SQL æŸ¥è¯¢ç³»ç»Ÿé‡‡ç”¨äº†ç»å…¸çš„ç¼–è¯‘å™¨è®¾è®¡æ¨¡å¼ï¼š</p><pre><code class=" mermaid">flowchart LR    A[&quot;QuerySet API&quot;] --&gt; B[&quot;Query å¯¹è±¡&lt;br/&gt;æŠ½è±¡è¯­æ³•æ ‘&quot;]    B --&gt; C[&quot;SQLCompiler&lt;br/&gt;ä»£ç ç”Ÿæˆå™¨&quot;]    C --&gt; D[&quot;SQL å­—ç¬¦ä¸²&lt;br/&gt;ç›®æ ‡ä»£ç &quot;]        style A fill:#e1f5fe    style B fill:#f3e5f5    style C fill:#e8f5e8    style D fill:#fff3e0</code></pre><h3 id="12-2-å…³é”®è®¾è®¡ç‰¹ç‚¹"><a href="#12-2-å…³é”®è®¾è®¡ç‰¹ç‚¹" class="headerlink" title="12.2 å…³é”®è®¾è®¡ç‰¹ç‚¹"></a>12.2 å…³é”®è®¾è®¡ç‰¹ç‚¹</h3><ol><li><p><strong>åˆ†å±‚æŠ½è±¡</strong></p><ul><li>QuerySet: ç”¨æˆ·æ¥å£å±‚</li><li>Query: æŸ¥è¯¢æŠ½è±¡å±‚</li><li>Compiler: SQL ç”Ÿæˆå±‚</li></ul></li><li><p><strong>å»¶è¿Ÿè®¡ç®—</strong></p><ul><li>æŸ¥è¯¢æ„å»ºä¸ç«‹å³ç”Ÿæˆ SQL</li><li>åªåœ¨éœ€è¦æ—¶æ‰ç¼–è¯‘æ‰§è¡Œ</li></ul></li><li><p><strong>æ•°æ®åº“æ— å…³æ€§</strong></p><ul><li>é€šè¿‡ä¸åŒçš„ Compiler æ”¯æŒå¤šæ•°æ®åº“</li><li>æ•°æ®åº“ç‰¹å®šçš„ SQL æ–¹è¨€å¤„ç†</li></ul></li><li><p><strong>ä¼˜åŒ–æœºåˆ¶</strong></p><ul><li>æ™ºèƒ½çš„ JOIN å¤„ç†</li><li>æŸ¥è¯¢åˆå¹¶å’Œä¼˜åŒ–</li><li>ç»“æœç¼“å­˜</li></ul></li></ol><h3 id="12-3-å­¦ä¹ è¦ç‚¹"><a href="#12-3-å­¦ä¹ è¦ç‚¹" class="headerlink" title="12.3 å­¦ä¹ è¦ç‚¹"></a>12.3 å­¦ä¹ è¦ç‚¹</h3><ul><li><strong>ç†è§£æ ¸å¿ƒæ•°æ®æµ</strong>ï¼šQuerySet â†’ Query â†’ SQLCompiler â†’ SQL</li><li><strong>æŒæ¡å…³é”®æ•°æ®ç»“æ„</strong>ï¼šalias_map, WHERE æ ‘, select åˆ—è¡¨</li><li><strong>ç†Ÿæ‚‰ç¼–è¯‘è¿‡ç¨‹</strong>ï¼špre_sql_setup, as_sql çš„å„ä¸ªæ­¥éª¤</li><li><strong>å®è·µæ€§èƒ½ä¼˜åŒ–</strong>ï¼šåˆç†ä½¿ç”¨å„ç§æŸ¥è¯¢æŠ€å·§</li></ul><h3 id="12-4-æ€§èƒ½ä¼˜åŒ–æ€»ç»“"><a href="#12-4-æ€§èƒ½ä¼˜åŒ–æ€»ç»“" class="headerlink" title="12.4 æ€§èƒ½ä¼˜åŒ–æ€»ç»“"></a>12.4 æ€§èƒ½ä¼˜åŒ–æ€»ç»“</h3><ol><li><p><strong>æŸ¥è¯¢ä¼˜åŒ–</strong>ï¼š</p><ul><li>ä½¿ç”¨ select_related å’Œ prefetch_related å‡å°‘æŸ¥è¯¢æ¬¡æ•°</li><li>ä½¿ç”¨ only() å’Œ defer() æ§åˆ¶å­—æ®µé€‰æ‹©</li><li>ä½¿ç”¨ exists() æ£€æŸ¥å­˜åœ¨æ€§è€Œä¸æ˜¯ count()</li></ul></li><li><p><strong>æ‰¹é‡æ“ä½œ</strong>ï¼š</p><ul><li>ä½¿ç”¨ bulk_create, bulk_update, update(), delete()</li><li>é¿å…åœ¨å¾ªç¯ä¸­æ‰§è¡Œæ•°æ®åº“æ“ä½œ</li></ul></li><li><p><strong>å†…å­˜ä¼˜åŒ–</strong>ï¼š</p><ul><li>ä½¿ç”¨ iterator() å¤„ç†å¤§æ•°æ®é›†</li><li>ä½¿ç”¨ values() å‡å°‘å¯¹è±¡åˆ›å»ºå¼€é”€</li></ul></li><li><p><strong>ç›‘æ§è°ƒè¯•</strong>ï¼š</p><ul><li>ä½¿ç”¨ Django Debug Toolbar</li><li>é…ç½® SQL æ—¥å¿—è®°å½•</li><li>ç¼–å†™æ€§èƒ½æµ‹è¯•ç”¨ä¾‹</li></ul></li></ol><p>Django çš„ SQL æ„å»ºç³»ç»Ÿæ˜¯ä¸€ä¸ªç²¾å·§çš„å·¥ç¨‹ï¼Œå®ƒæˆåŠŸåœ°å°†å¤æ‚çš„ SQL ç”Ÿæˆé€»è¾‘éšè—åœ¨ç®€æ´çš„ Python API ä¹‹åï¼Œä¸ºå¼€å‘è€…æä¾›äº†å¼ºå¤§è€Œæ˜“ç”¨çš„æ•°æ®åº“æ“ä½œèƒ½åŠ›ã€‚é€šè¿‡æ·±å…¥ç†è§£è¿™ä¸ªç³»ç»Ÿçš„å·¥ä½œåŸç†å’ŒæŒæ¡å„ç§ä¼˜åŒ–æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å‡ºé«˜æ€§èƒ½çš„ Django åº”ç”¨ç¨‹åºã€‚</p><h3 id="12-5-è¿›é˜¶å­¦ä¹ å»ºè®®"><a href="#12-5-è¿›é˜¶å­¦ä¹ å»ºè®®" class="headerlink" title="12.5 è¿›é˜¶å­¦ä¹ å»ºè®®"></a>12.5 è¿›é˜¶å­¦ä¹ å»ºè®®</h3><ol><li><strong>æºç è°ƒè¯•</strong>ï¼šä½¿ç”¨ debugger è·Ÿè¸ªå®Œæ•´çš„æŸ¥è¯¢æ„å»ºè¿‡ç¨‹</li><li><strong>æ€§èƒ½åˆ†æ</strong>ï¼šä½¿ç”¨å„ç§å·¥å…·åˆ†ææŸ¥è¯¢æ€§èƒ½ç“¶é¢ˆ</li><li><strong>æ‰©å±•å¼€å‘</strong>ï¼šå°è¯•å®ç°è‡ªå®šä¹‰çš„ Lookup å’Œ Expression</li><li><strong>æ•°æ®åº“ä¼˜åŒ–</strong>ï¼šå­¦ä¹ æ•°æ®åº“ç‰¹å®šçš„ä¼˜åŒ–æŠ€æœ¯</li></ol><p>è®°ä½ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯å’Œæ•°æ®è§„æ¨¡æ¥é€‰æ‹©åˆé€‚çš„ä¼˜åŒ–ç­–ç•¥ã€‚å§‹ç»ˆè¦å…ˆæµ‹é‡ï¼Œå†ä¼˜åŒ–ï¼Œé¿å…è¿‡æ—©ä¼˜åŒ–å¸¦æ¥çš„å¤æ‚æ€§ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django QuerySet</title>
    <link href="/2025/07/27/Django-QuerySet/"/>
    <url>/2025/07/27/Django-QuerySet/</url>
    
    <content type="html"><![CDATA[<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>Django QuerySet æ˜¯ Django ORM çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ç°äº†æ•°æ®åº“æŸ¥è¯¢çš„æƒ°æ€§åŠ è½½æœºåˆ¶ã€‚æœ¬æ–‡æ¡£åŸºäº Django 1.11 ç‰ˆæœ¬çš„æºç ï¼Œæ·±å…¥åˆ†æ QuerySet çš„å®ç°åŸç†ã€‚</p><h3 id="1-1-æ–‡ä»¶ä½ç½®"><a href="#1-1-æ–‡ä»¶ä½ç½®" class="headerlink" title="1.1 æ–‡ä»¶ä½ç½®"></a>1.1 æ–‡ä»¶ä½ç½®</h3><ul><li>ä¸»è¦æºç æ–‡ä»¶ï¼š<code>django/db/models/query.py</code></li><li>æ ¸å¿ƒç±»ï¼š<code>QuerySet</code>ã€<code>ModelIterable</code>ã€<code>RelatedPopulator</code></li></ul><h3 id="1-2-è®¾è®¡ç›®æ ‡"><a href="#1-2-è®¾è®¡ç›®æ ‡" class="headerlink" title="1.2 è®¾è®¡ç›®æ ‡"></a>1.2 è®¾è®¡ç›®æ ‡</h3><ul><li><strong>æƒ°æ€§æ±‚å€¼</strong>ï¼šåªæœ‰åœ¨çœŸæ­£éœ€è¦æ•°æ®æ—¶æ‰æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢</li><li><strong>é“¾å¼æ“ä½œ</strong>ï¼šæ”¯æŒæ–¹æ³•é“¾è°ƒç”¨ï¼Œä¿æŒä»£ç ç®€æ´</li><li><strong>ç»“æœç¼“å­˜</strong>ï¼šé¿å…é‡å¤çš„æ•°æ®åº“æŸ¥è¯¢</li><li><strong>å†…å­˜ä¼˜åŒ–</strong>ï¼šæ”¯æŒå¤§æ•°æ®é›†çš„é«˜æ•ˆå¤„ç†</li></ul><h2 id="2-QuerySet-æƒ°æ€§åŠ è½½æœºåˆ¶"><a href="#2-QuerySet-æƒ°æ€§åŠ è½½æœºåˆ¶" class="headerlink" title="2. QuerySet æƒ°æ€§åŠ è½½æœºåˆ¶"></a>2. QuerySet æƒ°æ€§åŠ è½½æœºåˆ¶</h2><h3 id="2-1-æ•´ä½“æµç¨‹å›¾"><a href="#2-1-æ•´ä½“æµç¨‹å›¾" class="headerlink" title="2.1 æ•´ä½“æµç¨‹å›¾"></a>2.1 æ•´ä½“æµç¨‹å›¾</h3><pre><code class=" mermaid">flowchart TD    A[&quot;åˆ›å»º QuerySet&quot;] --&gt; B&#123;&quot;æ˜¯å¦æœ‰è¿‡æ»¤/æ’åºæ“ä½œ?&quot;&#125;    B --&gt;|æ˜¯| C[&quot;é“¾å¼æ“ä½œåˆ›å»ºæ–° QuerySet&quot;]    B --&gt;|å¦| D[&quot;QuerySet å¯¹è±¡å‡†å¤‡å®Œæˆ&quot;]    C --&gt; D    D --&gt; E&#123;&quot;æ˜¯å¦è§¦å‘æ±‚å€¼æ“ä½œ?&quot;&#125;    E --&gt;|å¦| F[&quot;ä¿æŒæƒ°æ€§çŠ¶æ€&lt;br/&gt;_result_cache = None&quot;]    E --&gt;|æ˜¯| G[&quot;æ£€æŸ¥ _result_cache&quot;]    G --&gt; H&#123;&quot;ç¼“å­˜æ˜¯å¦ä¸ºç©º?&quot;&#125;    H --&gt;|å¦| I[&quot;ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ&quot;]    H --&gt;|æ˜¯| J[&quot;æ‰§è¡Œ _fetch_all&quot;]    J --&gt; K[&quot;åˆ›å»º SQL ç¼–è¯‘å™¨&quot;]    K --&gt; L[&quot;æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢&quot;]    L --&gt; M[&quot;åˆ›å»ºæ¨¡å‹å®ä¾‹&quot;]    M --&gt; N[&quot;å¤„ç†å…³è”å¯¹è±¡&quot;]    N --&gt; O[&quot;å­˜å‚¨åˆ° _result_cache&quot;]    O --&gt; P[&quot;è¿”å›ç»“æœ&quot;]        F --&gt; E        style A fill:#e1f5fe    style F fill:#fff3e0    style P fill:#e8f5e8    style L fill:#ffebee</code></pre><h3 id="2-2-æƒ°æ€§åŠ è½½çš„æ ¸å¿ƒåŸç†"><a href="#2-2-æƒ°æ€§åŠ è½½çš„æ ¸å¿ƒåŸç†" class="headerlink" title="2.2 æƒ°æ€§åŠ è½½çš„æ ¸å¿ƒåŸç†"></a>2.2 æƒ°æ€§åŠ è½½çš„æ ¸å¿ƒåŸç†</h3><p>æƒ°æ€§åŠ è½½é€šè¿‡ä»¥ä¸‹å‡ ä¸ªå…³é”®æœºåˆ¶å®ç°ï¼š</p><ol><li><strong>å»¶è¿Ÿæ‰§è¡Œ</strong>ï¼šQuerySet åˆ›å»ºæ—¶ä¸æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢</li><li><strong>ç»“æœç¼“å­˜</strong>ï¼š<code>_result_cache</code> å±æ€§æ§åˆ¶æŸ¥è¯¢çš„æ‰§è¡Œå’Œç¼“å­˜</li><li><strong>è§¦å‘æœºåˆ¶</strong>ï¼šç‰¹å®šæ“ä½œè§¦å‘å®é™…çš„æ•°æ®åº“æŸ¥è¯¢</li></ol><h2 id="3-æ ¸å¿ƒç±»å’Œæ–¹æ³•åˆ†æ"><a href="#3-æ ¸å¿ƒç±»å’Œæ–¹æ³•åˆ†æ" class="headerlink" title="3. æ ¸å¿ƒç±»å’Œæ–¹æ³•åˆ†æ"></a>3. æ ¸å¿ƒç±»å’Œæ–¹æ³•åˆ†æ</h2><h3 id="3-1-QuerySet-ç±»åˆå§‹åŒ–"><a href="#3-1-QuerySet-ç±»åˆå§‹åŒ–" class="headerlink" title="3.1 QuerySet ç±»åˆå§‹åŒ–"></a>3.1 QuerySet ç±»åˆå§‹åŒ–</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QuerySet</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model=<span class="hljs-literal">None</span>, query=<span class="hljs-literal">None</span>, using=<span class="hljs-literal">None</span>, hints=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-variable language_">self</span>.model = model<br>        <span class="hljs-variable language_">self</span>._db = using<br>        <span class="hljs-variable language_">self</span>._hints = hints <span class="hljs-keyword">or</span> &#123;&#125;<br>        <span class="hljs-variable language_">self</span>.query = query <span class="hljs-keyword">or</span> sql.Query(<span class="hljs-variable language_">self</span>.model)<br>        <span class="hljs-variable language_">self</span>._result_cache = <span class="hljs-literal">None</span>  <span class="hljs-comment"># ğŸ”‘ å…³é”®ï¼šç»“æœç¼“å­˜åˆå§‹ä¸º None</span><br>        <span class="hljs-variable language_">self</span>._sticky_filter = <span class="hljs-literal">False</span><br>        <span class="hljs-variable language_">self</span>._for_write = <span class="hljs-literal">False</span><br>        <span class="hljs-variable language_">self</span>._prefetch_related_lookups = ()<br>        <span class="hljs-variable language_">self</span>._prefetch_done = <span class="hljs-literal">False</span><br>        <span class="hljs-variable language_">self</span>._known_related_objects = &#123;&#125;<br>        <span class="hljs-variable language_">self</span>._iterable_class = ModelIterable<br>        <span class="hljs-variable language_">self</span>._fields = <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure><p><strong>å…³é”®ç‚¹åˆ†æ</strong>ï¼š</p><ul><li><code>_result_cache = None</code>ï¼šè¿™æ˜¯æƒ°æ€§åŠ è½½çš„æ ¸å¿ƒï¼Œåªæœ‰åœ¨çœŸæ­£éœ€è¦æ•°æ®æ—¶æ‰ä¼šå¡«å……</li><li><code>query</code> å¯¹è±¡ï¼šå°è£…äº† SQL æŸ¥è¯¢é€»è¾‘ï¼Œä½†ä¸ç«‹å³æ‰§è¡Œ</li><li><code>_iterable_class</code>ï¼šå®šä¹‰äº†å¦‚ä½•å°†æ•°æ®åº“è¡Œè½¬æ¢ä¸ºæ¨¡å‹å®ä¾‹</li></ul><h3 id="3-2-é“¾å¼æ“ä½œæœºåˆ¶"><a href="#3-2-é“¾å¼æ“ä½œæœºåˆ¶" class="headerlink" title="3.2 é“¾å¼æ“ä½œæœºåˆ¶"></a>3.2 é“¾å¼æ“ä½œæœºåˆ¶</h3><pre><code class=" mermaid">flowchart LR    A[&quot;User.objects&quot;] --&gt; B[&quot;.filter age__gt=18&quot;]    B --&gt; C[&quot;æ–° QuerySet 1&lt;br/&gt;ä»ç„¶æƒ°æ€§&quot;]    C --&gt; D[&quot;.filter name__startswith=&#x27;A&#x27;&quot;]    D --&gt; E[&quot;æ–° QuerySet 2&lt;br/&gt;ä»ç„¶æƒ°æ€§&quot;]    E --&gt; F[&quot;.order_by &#x27;id&#x27;&quot;]    F --&gt; G[&quot;æ–° QuerySet 3&lt;br/&gt;ä»ç„¶æƒ°æ€§&quot;]    G --&gt; H[&quot;è§¦å‘æ±‚å€¼æ“ä½œ&lt;br/&gt;å¦‚ list, len, forå¾ªç¯&quot;]    H --&gt; I[&quot;æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢&quot;]        style A fill:#e3f2fd    style C fill:#fff3e0    style E fill:#fff3e0    style G fill:#fff3e0    style I fill:#ffebee</code></pre><h4 id="filter-æ–¹æ³•å®ç°"><a href="#filter-æ–¹æ³•å®ç°" class="headerlink" title="filter æ–¹æ³•å®ç°"></a>filter æ–¹æ³•å®ç°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">filter</span>(<span class="hljs-params">self, *args, **kwargs</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è¿”å›æ–°çš„ QuerySet å®ä¾‹ï¼Œä¸æ‰§è¡ŒæŸ¥è¯¢&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._filter_or_exclude(<span class="hljs-literal">False</span>, *args, **kwargs)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_filter_or_exclude</span>(<span class="hljs-params">self, negate, *args, **kwargs</span>):<br>    clone = <span class="hljs-variable language_">self</span>._clone()  <span class="hljs-comment"># ğŸ”‘ å…‹éš†å½“å‰ QuerySet</span><br>    <span class="hljs-keyword">if</span> negate:<br>        clone.query.add_q(~Q(*args, **kwargs))<br>    <span class="hljs-keyword">else</span>:<br>        clone.query.add_q(Q(*args, **kwargs))<br>    <span class="hljs-keyword">return</span> clone  <span class="hljs-comment"># è¿”å›æ–°çš„ QuerySetï¼Œä»ç„¶æƒ°æ€§</span><br></code></pre></td></tr></table></figure><p><strong>è®¾è®¡è¦ç‚¹</strong>ï¼š</p><ul><li>æ¯ä¸ªè¿‡æ»¤æ“ä½œéƒ½è¿”å›æ–°çš„ QuerySet å¯¹è±¡</li><li>åŸå§‹ QuerySet ä¿æŒä¸å˜ï¼ˆä¸å¯å˜æ€§ï¼‰</li><li>æ–° QuerySet çš„ <code>_result_cache</code> ä»ç„¶ä¸º <code>None</code></li></ul><h3 id="3-3-è§¦å‘æ±‚å€¼çš„æ“ä½œ"><a href="#3-3-è§¦å‘æ±‚å€¼çš„æ“ä½œ" class="headerlink" title="3.3 è§¦å‘æ±‚å€¼çš„æ“ä½œ"></a>3.3 è§¦å‘æ±‚å€¼çš„æ“ä½œ</h3><pre><code class=" mermaid">flowchart TD    A[&quot;QuerySet å¯¹è±¡&lt;br/&gt;_result_cache = None&quot;] --&gt; B&#123;&quot;è§¦å‘æ–¹å¼&quot;&#125;        B --&gt;|è¿­ä»£| C[&quot;for item in qs:&lt;br/&gt;__iter__&quot;]    B --&gt;|é•¿åº¦| D[&quot;len qs&lt;br/&gt;__len__&quot;]    B --&gt;|å¸ƒå°”å€¼| E[&quot;if qs:&lt;br/&gt;__bool__&quot;]    B --&gt;|ç´¢å¼•è®¿é—®| F[&quot;qs[0]&lt;br/&gt;__getitem__&quot;]    B --&gt;|åˆ—è¡¨è½¬æ¢| G[&quot;list qs&quot;]    B --&gt;|è®¡æ•°| H[&quot;qs.count&quot;]    B --&gt;|å­˜åœ¨æ€§æ£€æŸ¥| I[&quot;qs.exists&quot;]        C --&gt; J[&quot;è°ƒç”¨ _fetch_all&quot;]    D --&gt; J    E --&gt; J    F --&gt; K&#123;&quot;æ˜¯å¦æœ‰ç¼“å­˜?&quot;&#125;    G --&gt; J    H --&gt; L[&quot;ç›´æ¥æ‰§è¡Œ COUNT æŸ¥è¯¢&quot;]    I --&gt; M[&quot;æ‰§è¡Œ EXISTS æŸ¥è¯¢&quot;]        K --&gt;|æœ‰| N[&quot;ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ&quot;]    K --&gt;|æ— | O[&quot;åˆ›å»ºé™åˆ¶æŸ¥è¯¢&quot;]        J --&gt; P[&quot;æ‰§è¡Œå®Œæ•´æŸ¥è¯¢&lt;br/&gt;å¡«å…… _result_cache&quot;]    O --&gt; Q[&quot;æ‰§è¡Œå•æ¡/åˆ‡ç‰‡æŸ¥è¯¢&quot;]        style A fill:#e1f5fe    style J fill:#fff3e0    style P fill:#e8f5e8    style L fill:#e8f5e8    style M fill:#e8f5e8</code></pre><h4 id="å…³é”®æ–¹æ³•å®ç°"><a href="#å…³é”®æ–¹æ³•å®ç°" class="headerlink" title="å…³é”®æ–¹æ³•å®ç°"></a>å…³é”®æ–¹æ³•å®ç°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è¿­ä»£å™¨åè®®å®ç°&quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>._fetch_all()  <span class="hljs-comment"># ğŸ”‘ è§¦å‘å®é™…çš„æ•°æ®åº“æŸ¥è¯¢</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">iter</span>(<span class="hljs-variable language_">self</span>._result_cache)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;é•¿åº¦è®¡ç®—&quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>._fetch_all()<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>._result_cache)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__bool__</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å¸ƒå°”å€¼åˆ¤æ–­&quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>._fetch_all()<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bool</span>(<span class="hljs-variable language_">self</span>._result_cache)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, k</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ç´¢å¼•/åˆ‡ç‰‡è®¿é—®&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>._result_cache <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._result_cache[k]  <span class="hljs-comment"># å¦‚æœå·²æœ‰ç¼“å­˜ï¼Œç›´æ¥è¿”å›</span><br>    <br>    <span class="hljs-comment"># åˆ‡ç‰‡æ“ä½œï¼šåˆ›å»ºæ–° QuerySet è€Œä¸æ˜¯æ‰§è¡ŒæŸ¥è¯¢</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(k, <span class="hljs-built_in">slice</span>):<br>        qs = <span class="hljs-variable language_">self</span>._clone()<br>        qs.query.set_limits(k.start, k.stop)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(qs)[::k.step] <span class="hljs-keyword">if</span> k.step <span class="hljs-keyword">else</span> qs<br>    <br>    <span class="hljs-comment"># å•ä¸ªå…ƒç´ è®¿é—®</span><br>    qs = <span class="hljs-variable language_">self</span>._clone()<br>    qs.query.set_limits(k, k + <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(qs)[<span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><h3 id="3-4-fetch-all-æ ¸å¿ƒæ–¹æ³•"><a href="#3-4-fetch-all-æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="3.4 _fetch_all æ ¸å¿ƒæ–¹æ³•"></a>3.4 _fetch_all æ ¸å¿ƒæ–¹æ³•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_fetch_all</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æƒ°æ€§åŠ è½½çš„æ ¸å¿ƒå®ç°&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>._result_cache <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:  <span class="hljs-comment"># ğŸ”‘ åªæœ‰ç¼“å­˜ä¸ºç©ºæ—¶æ‰æ‰§è¡ŒæŸ¥è¯¢</span><br>        <span class="hljs-variable language_">self</span>._result_cache = <span class="hljs-built_in">list</span>(<span class="hljs-variable language_">self</span>._iterable_class(<span class="hljs-variable language_">self</span>))<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>._prefetch_related_lookups <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>._prefetch_done:<br>        <span class="hljs-variable language_">self</span>._prefetch_related_objects()<br></code></pre></td></tr></table></figure><h4 id="æ‰§è¡Œæµç¨‹æ—¶åºå›¾"><a href="#æ‰§è¡Œæµç¨‹æ—¶åºå›¾" class="headerlink" title="æ‰§è¡Œæµç¨‹æ—¶åºå›¾"></a>æ‰§è¡Œæµç¨‹æ—¶åºå›¾</h4><pre><code class=" mermaid">sequenceDiagram    participant User as &quot;ç”¨æˆ·ä»£ç &quot;    participant QS as &quot;QuerySet&quot;    participant Iter as &quot;ModelIterable&quot;    participant Comp as &quot;SQL Compiler&quot;    participant DB as &quot;æ•°æ®åº“&quot;    participant Model as &quot;Model å®ä¾‹&quot;    User-&gt;&gt;QS: &quot;è§¦å‘æ±‚å€¼æ“ä½œ å¦‚ for å¾ªç¯&quot;    QS-&gt;&gt;QS: &quot;æ£€æŸ¥ _result_cache&quot;        alt &quot;_result_cache ä¸º None&quot;        QS-&gt;&gt;QS: &quot;è°ƒç”¨ _fetch_all&quot;        QS-&gt;&gt;Iter: &quot;åˆ›å»º ModelIterable&quot;        Iter-&gt;&gt;Comp: &quot;query.get_compiler&quot;        Comp-&gt;&gt;DB: &quot;execute_sql&quot;        DB--&gt;&gt;Comp: &quot;è¿”å›åŸå§‹æ•°æ®è¡Œ&quot;                loop &quot;å¤„ç†æ¯ä¸€è¡Œæ•°æ®&quot;            Comp-&gt;&gt;Model: &quot;model_cls.from_db&quot;            Model--&gt;&gt;Comp: &quot;è¿”å›æ¨¡å‹å®ä¾‹&quot;            Comp-&gt;&gt;Comp: &quot;å¤„ç†å…³è”å¯¹è±¡å’Œæ³¨è§£&quot;        end                Iter--&gt;&gt;QS: &quot;è¿”å›æ¨¡å‹å®ä¾‹åˆ—è¡¨&quot;        QS-&gt;&gt;QS: &quot;å­˜å‚¨åˆ° _result_cache&quot;    else &quot;_result_cache å·²å­˜åœ¨&quot;        QS-&gt;&gt;QS: &quot;ç›´æ¥ä½¿ç”¨ç¼“å­˜&quot;    end        QS--&gt;&gt;User: &quot;è¿”å›ç»“æœ&quot;</code></pre><h3 id="3-5-ModelIterable-ç±»åˆ†æ"><a href="#3-5-ModelIterable-ç±»åˆ†æ" class="headerlink" title="3.5 ModelIterable ç±»åˆ†æ"></a>3.5 ModelIterable ç±»åˆ†æ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelIterable</span>(<span class="hljs-title class_ inherited__">BaseIterable</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ä¸ºæ¯ä¸€è¡Œç”Ÿæˆä¸€ä¸ªæ¨¡å‹å®ä¾‹&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>        queryset = <span class="hljs-variable language_">self</span>.queryset<br>        db = queryset.db<br>        compiler = queryset.query.get_compiler(using=db)<br>        <br>        <span class="hljs-comment"># æ‰§è¡ŒæŸ¥è¯¢ï¼Œè¿™é‡Œæ‰çœŸæ­£è®¿é—®æ•°æ®åº“</span><br>        results = compiler.execute_sql(chunked_fetch=<span class="hljs-variable language_">self</span>.chunked_fetch)<br>        <br>        <span class="hljs-comment"># è·å–é€‰æ‹©å­—æ®µã€ç±»ä¿¡æ¯ç­‰</span><br>        select, klass_info, annotation_col_map = (<br>            compiler.select, compiler.klass_info, compiler.annotation_col_map<br>        )<br>        model_cls = klass_info[<span class="hljs-string">&#x27;model&#x27;</span>]<br>        select_fields = klass_info[<span class="hljs-string">&#x27;select_fields&#x27;</span>]<br>        model_fields_start, model_fields_end = select_fields[<span class="hljs-number">0</span>], select_fields[-<span class="hljs-number">1</span>] + <span class="hljs-number">1</span><br>        init_list = [f[<span class="hljs-number">0</span>].target.attname<br>                     <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> select[model_fields_start:model_fields_end]]<br>        <br>        <span class="hljs-comment"># è·å–å…³è”å¯¹è±¡å¡«å……å™¨</span><br>        related_populators = get_related_populators(klass_info, select, db)<br>        <br>        <span class="hljs-comment"># é€è¡Œå¤„ç†ç»“æœï¼Œåˆ›å»ºæ¨¡å‹å®ä¾‹</span><br>        <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> compiler.results_iter(results):<br>            obj = model_cls.from_db(db, init_list, row[model_fields_start:model_fields_end])<br>            <br>            <span class="hljs-comment"># å¤„ç†å…³è”å¯¹è±¡</span><br>            <span class="hljs-keyword">if</span> related_populators:<br>                <span class="hljs-keyword">for</span> rel_populator <span class="hljs-keyword">in</span> related_populators:<br>                    rel_populator.populate(row, obj)<br>                    <br>            <span class="hljs-comment"># å¤„ç†æ³¨è§£å­—æ®µ</span><br>            <span class="hljs-keyword">if</span> annotation_col_map:<br>                <span class="hljs-keyword">for</span> attr_name, col_pos <span class="hljs-keyword">in</span> annotation_col_map.items():<br>                    <span class="hljs-built_in">setattr</span>(obj, attr_name, row[col_pos])<br><br>            <span class="hljs-comment"># å¤„ç†å·²çŸ¥çš„å…³è”å¯¹è±¡</span><br>            <span class="hljs-keyword">if</span> queryset._known_related_objects:<br>                <span class="hljs-keyword">for</span> field, rel_objs <span class="hljs-keyword">in</span> queryset._known_related_objects.items():<br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(obj, field.get_cache_name()):<br>                        <span class="hljs-keyword">continue</span><br>                    pk = <span class="hljs-built_in">getattr</span>(obj, field.get_attname())<br>                    <span class="hljs-keyword">try</span>:<br>                        rel_obj = rel_objs[pk]<br>                    <span class="hljs-keyword">except</span> KeyError:<br>                        <span class="hljs-keyword">pass</span><br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-built_in">setattr</span>(obj, field.name, rel_obj)<br><br>            <span class="hljs-keyword">yield</span> obj  <span class="hljs-comment"># ğŸ”‘ ç”Ÿæˆå™¨æ¨¡å¼ï¼Œé€ä¸ªè¿”å›å¯¹è±¡</span><br></code></pre></td></tr></table></figure><p><strong>å…³é”®ç‰¹æ€§</strong>ï¼š</p><ul><li>ä½¿ç”¨ç”Ÿæˆå™¨æ¨¡å¼ï¼Œå†…å­˜æ•ˆç‡é«˜</li><li>æ”¯æŒåˆ†å—è·å–æ•°æ®ï¼ˆ<code>chunked_fetch</code>ï¼‰</li><li>è‡ªåŠ¨å¤„ç†å…³è”å¯¹è±¡å’Œæ³¨è§£å­—æ®µ</li></ul><h2 id="4-æµç¨‹å›¾è¯¦è§£"><a href="#4-æµç¨‹å›¾è¯¦è§£" class="headerlink" title="4. æµç¨‹å›¾è¯¦è§£"></a>4. æµç¨‹å›¾è¯¦è§£</h2><h3 id="4-1-QuerySet-çŠ¶æ€å˜åŒ–"><a href="#4-1-QuerySet-çŠ¶æ€å˜åŒ–" class="headerlink" title="4.1 QuerySet çŠ¶æ€å˜åŒ–"></a>4.1 QuerySet çŠ¶æ€å˜åŒ–</h3><pre><code class=" mermaid">stateDiagram-v2    [*] --&gt; Created: &quot;åˆ›å»º QuerySet&quot;    Created --&gt; Filtered: &quot;æ·»åŠ è¿‡æ»¤æ¡ä»¶&quot;    Filtered --&gt; Filtered: &quot;é“¾å¼æ“ä½œ&quot;    Filtered --&gt; Evaluated: &quot;è§¦å‘æ±‚å€¼&quot;    Created --&gt; Evaluated: &quot;ç›´æ¥æ±‚å€¼&quot;    Evaluated --&gt; Cached: &quot;ç»“æœå·²ç¼“å­˜&quot;    Cached --&gt; Cached: &quot;é‡å¤è®¿é—®ç¼“å­˜&quot;        note right of Created        &quot;_result_cache = None&lt;br/&gt;query å¯¹è±¡å·²åˆ›å»º&quot;    end note        note right of Filtered        &quot;ä»ç„¶ _result_cache = None&lt;br/&gt;query å¯¹è±¡è¢«ä¿®æ”¹&quot;    end note        note right of Evaluated        &quot;æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢&lt;br/&gt;_fetch_all è¢«è°ƒç”¨&quot;    end note        note right of Cached        &quot;_result_cache åŒ…å«ç»“æœ&lt;br/&gt;åç»­è®¿é—®æ— éœ€æŸ¥è¯¢æ•°æ®åº“&quot;    end note</code></pre><h3 id="4-2-å†…å­˜ä½¿ç”¨ä¼˜åŒ–ç­–ç•¥"><a href="#4-2-å†…å­˜ä½¿ç”¨ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="4.2 å†…å­˜ä½¿ç”¨ä¼˜åŒ–ç­–ç•¥"></a>4.2 å†…å­˜ä½¿ç”¨ä¼˜åŒ–ç­–ç•¥</h3><pre><code class=" mermaid">flowchart TD    A[&quot;å¤§é‡æ•°æ®æŸ¥è¯¢&quot;] --&gt; B&#123;&quot;é€‰æ‹©è¿­ä»£æ–¹å¼&quot;&#125;        B --&gt;|&quot;ä½¿ç”¨ QuerySet ç›´æ¥è¿­ä»£&quot;| C[&quot;list qs&lt;br/&gt;åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜&quot;]    B --&gt;|&quot;ä½¿ç”¨ iterator&quot;| D[&quot;qs.iterator&lt;br/&gt;é€æ¡è·å–ï¼Œä½å†…å­˜å ç”¨&quot;]    B --&gt;|&quot;ä½¿ç”¨ æ‰¹é‡å¤„ç†&quot;| E[&quot;åˆ†æ‰¹å¤„ç†&lt;br/&gt;batch_size å‚æ•°&quot;]        C --&gt; F[&quot;é«˜å†…å­˜ä½¿ç”¨&lt;br/&gt;é€‚åˆå°æ•°æ®é›†&quot;]    D --&gt; G[&quot;ä½å†…å­˜ä½¿ç”¨&lt;br/&gt;é€‚åˆå¤§æ•°æ®é›†&lt;br/&gt;ä½†ä¸èƒ½é‡å¤è¿­ä»£&quot;]    E --&gt; H[&quot;å¹³è¡¡å†…å­˜å’Œæ€§èƒ½&lt;br/&gt;å¯æ§åˆ¶æ‰¹æ¬¡å¤§å°&quot;]        style C fill:#ffebee    style D fill:#e8f5e8    style E fill:#fff3e0</code></pre><h2 id="5-æ€§èƒ½ä¼˜åŒ–æœºåˆ¶"><a href="#5-æ€§èƒ½ä¼˜åŒ–æœºåˆ¶" class="headerlink" title="5. æ€§èƒ½ä¼˜åŒ–æœºåˆ¶"></a>5. æ€§èƒ½ä¼˜åŒ–æœºåˆ¶</h2><h3 id="5-1-select-related-ä¼˜åŒ–"><a href="#5-1-select-related-ä¼˜åŒ–" class="headerlink" title="5.1 select_related ä¼˜åŒ–"></a>5.1 select_related ä¼˜åŒ–</h3><pre><code class=" mermaid">flowchart TD    A[&quot;QuerySet.select_related &#x27;foreign_key&#x27;&quot;] --&gt; B[&quot;ä¿®æ”¹ SQL æŸ¥è¯¢æ·»åŠ  JOIN&quot;]    B --&gt; C[&quot;æ‰§è¡Œå•æ¬¡æ•°æ®åº“æŸ¥è¯¢&quot;]    C --&gt; D[&quot;è·å–åŒ…å«å…³è”æ•°æ®çš„ç»“æœè¡Œ&quot;]    D --&gt; E[&quot;åˆ›å»ºä¸»æ¨¡å‹å®ä¾‹&quot;]    E --&gt; F[&quot;RelatedPopulator.populate&quot;]    F --&gt; G[&quot;ä»åŒä¸€è¡Œæ•°æ®åˆ›å»ºå…³è”å¯¹è±¡&quot;]    G --&gt; H[&quot;è®¾ç½®å¯¹è±¡é—´çš„å…³è”å…³ç³»&quot;]    H --&gt; I[&quot;é¿å…é¢å¤–çš„æ•°æ®åº“æŸ¥è¯¢&quot;]        J[&quot;ä¸ä½¿ç”¨ select_related&quot;] --&gt; K[&quot;åˆ›å»ºä¸»æ¨¡å‹å®ä¾‹&quot;]    K --&gt; L[&quot;è®¿é—®å…³è”å±æ€§æ—¶&quot;]    L --&gt; M[&quot;è§¦å‘é¢å¤–çš„æ•°æ®åº“æŸ¥è¯¢&quot;]    M --&gt; N[&quot;N+1 æŸ¥è¯¢é—®é¢˜&quot;]        style A fill:#e8f5e8    style I fill:#e8f5e8    style N fill:#ffebee</code></pre><h4 id="RelatedPopulator-ç±»å®ç°"><a href="#RelatedPopulator-ç±»å®ç°" class="headerlink" title="RelatedPopulator ç±»å®ç°"></a>RelatedPopulator ç±»å®ç°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RelatedPopulator</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    RelatedPopulator ç”¨äº select_related å¯¹è±¡å®ä¾‹åŒ–ã€‚</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    æ€è·¯æ˜¯æ¯ä¸ª select_related æ¨¡å‹éƒ½ç”±ä¸åŒçš„ RelatedPopulator å®ä¾‹å¡«å……ã€‚</span><br><span class="hljs-string">    RelatedPopulator å®ä¾‹è·å– klass_info å’Œ selectï¼ˆåœ¨ SQLCompiler ä¸­è®¡ç®—ï¼‰</span><br><span class="hljs-string">    ä»¥åŠä½¿ç”¨çš„æ•°æ®åº“ä½œä¸ºåˆå§‹åŒ–è¾“å…¥ã€‚</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, klass_info, select, db</span>):<br>        <span class="hljs-variable language_">self</span>.db = db<br>        <span class="hljs-comment"># é¢„è®¡ç®—éœ€è¦çš„å±æ€§</span><br>        select_fields = klass_info[<span class="hljs-string">&#x27;select_fields&#x27;</span>]<br>        from_parent = klass_info[<span class="hljs-string">&#x27;from_parent&#x27;</span>]<br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> from_parent:<br>            <span class="hljs-comment"># ç®€å•æƒ…å†µï¼šå­—æ®µé¡ºåºä¸ __init__ æœŸæœ›çš„é¡ºåºç›¸åŒ</span><br>            <span class="hljs-variable language_">self</span>.cols_start = select_fields[<span class="hljs-number">0</span>]<br>            <span class="hljs-variable language_">self</span>.cols_end = select_fields[-<span class="hljs-number">1</span>] + <span class="hljs-number">1</span><br>            <span class="hljs-variable language_">self</span>.init_list = [<br>                f[<span class="hljs-number">0</span>].target.attname <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> select[<span class="hljs-variable language_">self</span>.cols_start:<span class="hljs-variable language_">self</span>.cols_end]<br>            ]<br>            <span class="hljs-variable language_">self</span>.reorder_for_init = <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># å¤æ‚æƒ…å†µï¼šéœ€è¦é‡æ–°æ’åºå­—æ®µæ•°æ®</span><br>            model_init_attnames = [<br>                f.attname <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> klass_info[<span class="hljs-string">&#x27;model&#x27;</span>]._meta.concrete_fields<br>            ]<br>            reorder_map = []<br>            <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> select_fields:<br>                field = select[idx][<span class="hljs-number">0</span>].target<br>                init_pos = model_init_attnames.index(field.attname)<br>                reorder_map.append((init_pos, field.attname, idx))<br>            reorder_map.sort()<br>            <span class="hljs-variable language_">self</span>.init_list = [v[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> reorder_map]<br>            pos_list = [row_pos <span class="hljs-keyword">for</span> _, _, row_pos <span class="hljs-keyword">in</span> reorder_map]<br><br>            <span class="hljs-keyword">def</span> <span class="hljs-title function_">reorder_for_init</span>(<span class="hljs-params">row</span>):<br>                <span class="hljs-keyword">return</span> [row[row_pos] <span class="hljs-keyword">for</span> row_pos <span class="hljs-keyword">in</span> pos_list]<br>            <span class="hljs-variable language_">self</span>.reorder_for_init = reorder_for_init<br><br>        <span class="hljs-variable language_">self</span>.model_cls = klass_info[<span class="hljs-string">&#x27;model&#x27;</span>]<br>        <span class="hljs-variable language_">self</span>.pk_idx = <span class="hljs-variable language_">self</span>.init_list.index(<span class="hljs-variable language_">self</span>.model_cls._meta.pk.attname)<br>        <span class="hljs-variable language_">self</span>.related_populators = get_related_populators(klass_info, select, <span class="hljs-variable language_">self</span>.db)<br>        <br>        <span class="hljs-comment"># è®¾ç½®ç¼“å­˜åç§°</span><br>        field = klass_info[<span class="hljs-string">&#x27;field&#x27;</span>]<br>        reverse = klass_info[<span class="hljs-string">&#x27;reverse&#x27;</span>]<br>        <span class="hljs-variable language_">self</span>.reverse_cache_name = <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">if</span> reverse:<br>            <span class="hljs-variable language_">self</span>.cache_name = field.remote_field.get_cache_name()<br>            <span class="hljs-variable language_">self</span>.reverse_cache_name = field.get_cache_name()<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.cache_name = field.get_cache_name()<br>            <span class="hljs-keyword">if</span> field.unique:<br>                <span class="hljs-variable language_">self</span>.reverse_cache_name = field.remote_field.get_cache_name()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">populate</span>(<span class="hljs-params">self, row, from_obj</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;ä»æ•°æ®åº“è¡Œå¡«å……å…³è”å¯¹è±¡&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.reorder_for_init:<br>            obj_data = <span class="hljs-variable language_">self</span>.reorder_for_init(row)<br>        <span class="hljs-keyword">else</span>:<br>            obj_data = row[<span class="hljs-variable language_">self</span>.cols_start:<span class="hljs-variable language_">self</span>.cols_end]<br>            <br>        <span class="hljs-keyword">if</span> obj_data[<span class="hljs-variable language_">self</span>.pk_idx] <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            obj = <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">else</span>:<br>            obj = <span class="hljs-variable language_">self</span>.model_cls.from_db(<span class="hljs-variable language_">self</span>.db, <span class="hljs-variable language_">self</span>.init_list, obj_data)<br>            <br>        <span class="hljs-comment"># é€’å½’å¤„ç†åµŒå¥—çš„å…³è”å¯¹è±¡</span><br>        <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">and</span> <span class="hljs-variable language_">self</span>.related_populators:<br>            <span class="hljs-keyword">for</span> rel_iter <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.related_populators:<br>                rel_iter.populate(row, obj)<br>                <br>        <span class="hljs-comment"># è®¾ç½®å…³è”å¯¹è±¡åˆ°ä¸»å¯¹è±¡ä¸Š</span><br>        <span class="hljs-built_in">setattr</span>(from_obj, <span class="hljs-variable language_">self</span>.cache_name, obj)<br>        <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">and</span> <span class="hljs-variable language_">self</span>.reverse_cache_name:<br>            <span class="hljs-built_in">setattr</span>(obj, <span class="hljs-variable language_">self</span>.reverse_cache_name, from_obj)<br></code></pre></td></tr></table></figure><h3 id="5-2-prefetch-related-æœºåˆ¶"><a href="#5-2-prefetch-related-æœºåˆ¶" class="headerlink" title="5.2 prefetch_related æœºåˆ¶"></a>5.2 prefetch_related æœºåˆ¶</h3><p>prefetch_related é€šè¿‡å•ç‹¬çš„æŸ¥è¯¢æ¥è·å–å…³è”å¯¹è±¡ï¼Œç„¶ååœ¨ Python ä¸­è¿›è¡Œå…³è”ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">prefetch_related_objects</span>(<span class="hljs-params">model_instances, *related_lookups</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ä¸ºæ¨¡å‹å®ä¾‹åˆ—è¡¨å¡«å……é¢„å–çš„å¯¹è±¡ç¼“å­˜ï¼ŒåŸºäºç»™å®šçš„æŸ¥æ‰¾/Prefetch å®ä¾‹ã€‚</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(model_instances) == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span>  <span class="hljs-comment"># æ²¡æœ‰ä»€ä¹ˆå¯åšçš„</span><br><br>    related_lookups = normalize_prefetch_lookups(related_lookups)<br>    <br>    <span class="hljs-comment"># éœ€è¦èƒ½å¤ŸåŠ¨æ€æ·»åŠ åˆ°æˆ‘ä»¬æŸ¥æ‰¾çš„ prefetch_related æŸ¥æ‰¾åˆ—è¡¨ä¸­</span><br>    done_queries = &#123;&#125;    <span class="hljs-comment"># ç±»ä¼¼ &#x27;foo__bar&#x27;: [results] çš„å­—å…¸</span><br>    auto_lookups = <span class="hljs-built_in">set</span>()  <span class="hljs-comment"># æˆ‘ä»¬åœ¨è¿›è¡Œè¿‡ç¨‹ä¸­æ·»åŠ åˆ°è¿™é‡Œ</span><br>    followed_descriptors = <span class="hljs-built_in">set</span>()  <span class="hljs-comment"># é€’å½’ä¿æŠ¤</span><br><br>    all_lookups = deque(related_lookups)<br>    <span class="hljs-keyword">while</span> all_lookups:<br>        lookup = all_lookups.popleft()<br>        <span class="hljs-keyword">if</span> lookup.prefetch_to <span class="hljs-keyword">in</span> done_queries:<br>            <span class="hljs-keyword">if</span> lookup.queryset:<br>                <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;&#x27;%s&#x27; lookup was already seen with a different queryset. &quot;</span><br>                                 <span class="hljs-string">&quot;You may need to adjust the ordering of your lookups.&quot;</span> % lookup.prefetch_to)<br>            <span class="hljs-keyword">continue</span><br><br>        <span class="hljs-comment"># é¡¶å±‚ï¼Œè¦è£…é¥°çš„å¯¹è±¡åˆ—è¡¨æ˜¯ä¸» QuerySet çš„ç»“æœç¼“å­˜</span><br>        obj_list = model_instances<br>        <br>        <span class="hljs-comment"># å¤„ç†æŸ¥æ‰¾è·¯å¾„çš„æ¯ä¸ªéƒ¨åˆ†</span><br>        through_attrs = lookup.prefetch_through.split(LOOKUP_SEP)<br>        <span class="hljs-keyword">for</span> level, through_attr <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(through_attrs):<br>            <span class="hljs-comment"># ... å¤æ‚çš„é¢„å–é€»è¾‘</span><br>            <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h2 id="6-å®æˆ˜æ¡ˆä¾‹åˆ†æ"><a href="#6-å®æˆ˜æ¡ˆä¾‹åˆ†æ" class="headerlink" title="6. å®æˆ˜æ¡ˆä¾‹åˆ†æ"></a>6. å®æˆ˜æ¡ˆä¾‹åˆ†æ</h2><h3 id="6-1-åŸºç¡€ç”¨æ³•ç¤ºä¾‹"><a href="#6-1-åŸºç¡€ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="6.1 åŸºç¡€ç”¨æ³•ç¤ºä¾‹"></a>6.1 åŸºç¡€ç”¨æ³•ç¤ºä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç¤ºä¾‹æ¨¡å‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(models.Model):<br>    name = models.CharField(max_length=<span class="hljs-number">100</span>)<br>    age = models.IntegerField()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Post</span>(models.Model):<br>    title = models.CharField(max_length=<span class="hljs-number">200</span>)<br>    author = models.ForeignKey(User, on_delete=models.CASCADE)<br><br><span class="hljs-comment"># æƒ°æ€§åŠ è½½ç¤ºä¾‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">lazy_loading_example</span>():<br>    <span class="hljs-comment"># 1. åˆ›å»º QuerySet - æƒ°æ€§çš„ï¼Œä¸æ‰§è¡ŒæŸ¥è¯¢</span><br>    qs = User.objects.<span class="hljs-built_in">filter</span>(age__gt=<span class="hljs-number">18</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;QuerySet å·²åˆ›å»ºï¼Œä½†æœªæ‰§è¡ŒæŸ¥è¯¢&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;QuerySet._result_cache: <span class="hljs-subst">&#123;qs._result_cache&#125;</span>&quot;</span>)  <span class="hljs-comment"># None</span><br>    <br>    <span class="hljs-comment"># 2. é“¾å¼æ“ä½œ - ä»ç„¶æƒ°æ€§çš„</span><br>    qs = qs.<span class="hljs-built_in">filter</span>(name__startswith=<span class="hljs-string">&#x27;A&#x27;</span>).order_by(<span class="hljs-string">&#x27;id&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ·»åŠ äº†æ›´å¤šè¿‡æ»¤æ¡ä»¶ï¼Œä»æœªæ‰§è¡ŒæŸ¥è¯¢&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;QuerySet._result_cache: <span class="hljs-subst">&#123;qs._result_cache&#125;</span>&quot;</span>)  <span class="hljs-comment"># ä»ç„¶æ˜¯ None</span><br>    <br>    <span class="hljs-comment"># 3. è§¦å‘æ±‚å€¼çš„æ“ä½œ</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç°åœ¨å¼€å§‹æ‰§è¡ŒæŸ¥è¯¢...&quot;</span>)<br>    <br>    <span class="hljs-comment"># æ–¹å¼1ï¼šè¿­ä»£è§¦å‘</span><br>    <span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> qs:  <span class="hljs-comment"># è¿™é‡Œè§¦å‘ __iter__ -&gt; _fetch_all</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;User: <span class="hljs-subst">&#123;user.name&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;QuerySet._result_cache: <span class="hljs-subst">&#123;qs._result_cache <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>&#125;</span>&quot;</span>)  <span class="hljs-comment"># True</span><br>    <br>    <span class="hljs-comment"># æ–¹å¼2ï¼šé•¿åº¦è®¡ç®—è§¦å‘ï¼ˆä½¿ç”¨ç¼“å­˜ï¼Œä¸ä¼šé‡æ–°æŸ¥è¯¢ï¼‰</span><br>    count = <span class="hljs-built_in">len</span>(qs)  <span class="hljs-comment"># ä½¿ç”¨å·²ç¼“å­˜çš„ç»“æœ</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Count: <span class="hljs-subst">&#123;count&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># æ–¹å¼3ï¼šå¸ƒå°”å€¼åˆ¤æ–­ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰</span><br>    <span class="hljs-keyword">if</span> qs:  <span class="hljs-comment"># ä½¿ç”¨å·²ç¼“å­˜çš„ç»“æœ</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æœ‰æ•°æ®&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="6-2-æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹"><a href="#6-2-æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹" class="headerlink" title="6.2 æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹"></a>6.2 æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">optimization_examples</span>():<br>    <span class="hljs-comment"># âŒ N+1 æŸ¥è¯¢é—®é¢˜</span><br>    posts = Post.objects.<span class="hljs-built_in">all</span>()<br>    <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> posts:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;post.title&#125;</span> by <span class="hljs-subst">&#123;post.author.name&#125;</span>&quot;</span>)  <span class="hljs-comment"># æ¯æ¬¡éƒ½æŸ¥è¯¢æ•°æ®åº“</span><br>    <br>    <span class="hljs-comment"># âœ… ä½¿ç”¨ select_related ä¼˜åŒ– å®ç°åŸç†å°±æ˜¯æŠŠuserå’Œbookè¿›è¡Œinner joinäº†</span><br>    posts = Post.objects.select_related(<span class="hljs-string">&#x27;author&#x27;</span>).<span class="hljs-built_in">all</span>()<br>    <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> posts:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;post.title&#125;</span> by <span class="hljs-subst">&#123;post.author.name&#125;</span>&quot;</span>)  <span class="hljs-comment"># åªæŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“</span><br>    <br>    <span class="hljs-comment"># âœ… å¤§æ•°æ®é›†çš„å†…å­˜ä¼˜åŒ–</span><br>    <span class="hljs-comment"># æ–¹å¼1ï¼šä½¿ç”¨ iteratorï¼Œä½å†…å­˜å ç”¨</span><br>    <span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> User.objects.<span class="hljs-built_in">all</span>().iterator():<br>        process_user(user)<br>    <br>    <span class="hljs-comment"># æ–¹å¼2ï¼šåˆ†æ‰¹å¤„ç†</span><br>    batch_size = <span class="hljs-number">1000</span><br>    <span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> User.objects.<span class="hljs-built_in">all</span>().iterator(chunk_size=batch_size):<br>        process_user(user)<br></code></pre></td></tr></table></figure><h3 id="6-3-åˆ‡ç‰‡æ“ä½œçš„æƒ°æ€§ç‰¹æ€§"><a href="#6-3-åˆ‡ç‰‡æ“ä½œçš„æƒ°æ€§ç‰¹æ€§" class="headerlink" title="6.3 åˆ‡ç‰‡æ“ä½œçš„æƒ°æ€§ç‰¹æ€§"></a>6.3 åˆ‡ç‰‡æ“ä½œçš„æƒ°æ€§ç‰¹æ€§</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">slicing_examples</span>():<br>    <span class="hljs-comment"># åˆ‡ç‰‡æ“ä½œä»ç„¶ä¿æŒæƒ°æ€§</span><br>    qs = User.objects.<span class="hljs-built_in">filter</span>(age__gt=<span class="hljs-number">18</span>)<br>    <br>    <span class="hljs-comment"># è·å–å‰10ä¸ªç”¨æˆ· - åˆ›å»ºæ–°çš„ QuerySetï¼Œæ·»åŠ  LIMIT 10</span><br>    first_10 = qs[:<span class="hljs-number">10</span>]  <span class="hljs-comment"># ä»ç„¶æƒ°æ€§ï¼Œæœªæ‰§è¡ŒæŸ¥è¯¢</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;first_10._result_cache: <span class="hljs-subst">&#123;first_10._result_cache&#125;</span>&quot;</span>)  <span class="hljs-comment"># None</span><br>    <br>    <span class="hljs-comment"># åªæœ‰åœ¨å®é™…ä½¿ç”¨æ—¶æ‰æ‰§è¡ŒæŸ¥è¯¢</span><br>    users = <span class="hljs-built_in">list</span>(first_10)  <span class="hljs-comment"># ç°åœ¨æ‰§è¡ŒæŸ¥è¯¢ï¼ŒSQL åŒ…å« LIMIT 10</span><br>    <br>    <span class="hljs-comment"># è·å–å•ä¸ªç”¨æˆ·</span><br>    first_user = qs[<span class="hljs-number">0</span>]  <span class="hljs-comment"># åˆ›å»º LIMIT 1 çš„æŸ¥è¯¢å¹¶ç«‹å³æ‰§è¡Œ</span><br></code></pre></td></tr></table></figure><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><h3 id="7-1-æ ¸å¿ƒè®¾è®¡åŸåˆ™"><a href="#7-1-æ ¸å¿ƒè®¾è®¡åŸåˆ™" class="headerlink" title="7.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™"></a>7.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™</h3><ol><li><strong>æƒ°æ€§æ±‚å€¼</strong>ï¼šå»¶è¿Ÿæ‰§è¡Œç›´åˆ°çœŸæ­£éœ€è¦æ•°æ®</li><li><strong>ä¸å¯å˜æ€§</strong>ï¼šQuerySet æ“ä½œè¿”å›æ–°å¯¹è±¡ï¼Œä¿æŒåŸå¯¹è±¡ä¸å˜</li><li><strong>ç¼“å­˜æœºåˆ¶</strong>ï¼šé¿å…é‡å¤çš„æ•°æ®åº“æŸ¥è¯¢</li><li><strong>å†…å­˜æ•ˆç‡</strong>ï¼šæ”¯æŒå¤§æ•°æ®é›†çš„æµå¼å¤„ç†</li></ol><h3 id="7-2-å…³é”®æŠ€æœ¯ç‚¹"><a href="#7-2-å…³é”®æŠ€æœ¯ç‚¹" class="headerlink" title="7.2 å…³é”®æŠ€æœ¯ç‚¹"></a>7.2 å…³é”®æŠ€æœ¯ç‚¹</h3><ul><li><code>_result_cache</code> æ§åˆ¶æŸ¥è¯¢æ‰§è¡Œå’Œç»“æœç¼“å­˜</li><li><code>_fetch_all</code> æ˜¯æƒ°æ€§åŠ è½½çš„æ ¸å¿ƒå…¥å£</li><li><code>ModelIterable</code> ä½¿ç”¨ç”Ÿæˆå™¨æ¨¡å¼å¤„ç†æ•°æ®è¡Œ</li><li><code>RelatedPopulator</code> ä¼˜åŒ–å…³è”å¯¹è±¡çš„åŠ è½½</li><li>å¤šå±‚è¿­ä»£å™¨æ¶æ„æ”¯æŒçµæ´»çš„æ•°æ®å¤„ç†</li></ul><h3 id="7-3-æ€§èƒ½ä¼˜åŒ–å»ºè®®"><a href="#7-3-æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="7.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>7.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3><ol><li><strong>åˆç†ä½¿ç”¨ select_related</strong>ï¼šé¿å… N+1 æŸ¥è¯¢é—®é¢˜</li><li><strong>å¤§æ•°æ®é›†ä½¿ç”¨ iterator</strong>ï¼šé™ä½å†…å­˜ä½¿ç”¨</li><li><strong>é¿å…ä¸å¿…è¦çš„æ±‚å€¼</strong>ï¼šä¿æŒ QuerySet çš„æƒ°æ€§ç‰¹æ€§</li><li><strong>é‡ç”¨ QuerySet å¯¹è±¡</strong>ï¼šåˆ©ç”¨ç»“æœç¼“å­˜æœºåˆ¶</li></ol><h3 id="7-4-å­¦ä¹ è¦ç‚¹"><a href="#7-4-å­¦ä¹ è¦ç‚¹" class="headerlink" title="7.4 å­¦ä¹ è¦ç‚¹"></a>7.4 å­¦ä¹ è¦ç‚¹</h3><ul><li>ç†è§£æƒ°æ€§åŠ è½½çš„è§¦å‘æ—¶æœº</li><li>æŒæ¡ QuerySet çš„çŠ¶æ€å˜åŒ–è¿‡ç¨‹</li><li>ç†Ÿæ‚‰å„ç§ä¼˜åŒ–æŠ€æœ¯çš„ä½¿ç”¨åœºæ™¯</li><li>å…³æ³¨å†…å­˜ä½¿ç”¨å’ŒæŸ¥è¯¢æ•ˆç‡çš„å¹³è¡¡</li></ul><p>Django QuerySet çš„è®¾è®¡æ˜¯ç°ä»£ ORM æ¡†æ¶çš„å…¸å‹ä»£è¡¨ï¼Œé€šè¿‡å·§å¦™çš„æƒ°æ€§åŠ è½½æœºåˆ¶ï¼Œåœ¨æä¾›ç®€æ´ API çš„åŒæ—¶ä¿è¯äº†è‰¯å¥½çš„æ€§èƒ½ç‰¹æ€§ã€‚æ·±å…¥ç†è§£å…¶å®ç°åŸç†ï¼Œæœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½åœ°ä½¿ç”¨ Django ORMï¼Œç¼–å†™é«˜æ•ˆçš„æ•°æ®åº“æŸ¥è¯¢ä»£ç ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django äº‹åŠ¡</title>
    <link href="/2025/07/22/Django-%E4%BA%8B%E5%8A%A1/"/>
    <url>/2025/07/22/Django-%E4%BA%8B%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h3 id="1-1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1.1 åŸºæœ¬æ¦‚å¿µ"></a>1.1 åŸºæœ¬æ¦‚å¿µ</h3><ul><li>Django çš„äº‹åŠ¡ç®¡ç†ä¾èµ– <strong>æ•°æ®åº“çš„åŸç”Ÿäº‹åŠ¡èƒ½åŠ›</strong>ï¼Œç”± Python å±‚è¿›è¡Œå°è£…ã€‚</li><li>æ”¯æŒ ACID ä¸­çš„ <strong>åŸå­æ€§</strong>ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚</li><li>æ”¯æŒ <strong>åµŒå¥—äº‹åŠ¡</strong>ï¼ˆé€šè¿‡ä¿å­˜ç‚¹å®ç°ï¼‰ä»¥åŠ <strong>å¤šçº¿ç¨‹å®‰å…¨</strong>ï¼ˆä½¿ç”¨ <code>threading.local()</code>ï¼‰ã€‚</li></ul><h3 id="1-2-ä¸»è¦ç»„ä»¶"><a href="#1-2-ä¸»è¦ç»„ä»¶" class="headerlink" title="1.2 ä¸»è¦ç»„ä»¶"></a>1.2 ä¸»è¦ç»„ä»¶</h3><table><thead><tr><th>ç±» &#x2F; å‡½æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>transaction.atomic</code></td><td>è£…é¥°å™¨æˆ–ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œç”¨äºäº‹åŠ¡å—</td></tr><tr><td><code>savepoint()</code></td><td>åˆ›å»ºä¿å­˜ç‚¹ï¼Œè¿”å› <code>sid</code></td></tr><tr><td><code>savepoint_rollback(sid)</code></td><td>å›æ»šåˆ°æŒ‡å®šä¿å­˜ç‚¹</td></tr><tr><td><code>savepoint_commit(sid)</code></td><td>æäº¤å¹¶é‡Šæ”¾ä¿å­˜ç‚¹</td></tr><tr><td><code>set_autocommit(False)</code></td><td>æ˜¾å¼æ§åˆ¶äº‹åŠ¡èµ·å§‹</td></tr><tr><td><code>commit()</code> &#x2F; <code>rollback()</code></td><td>æ˜¾å¼æäº¤æˆ–å›æ»šæ•´ä¸ªäº‹åŠ¡</td></tr></tbody></table><hr><h2 id="äºŒã€Django-äº‹åŠ¡çš„å››ç§ç”¨æ³•"><a href="#äºŒã€Django-äº‹åŠ¡çš„å››ç§ç”¨æ³•" class="headerlink" title="äºŒã€Django äº‹åŠ¡çš„å››ç§ç”¨æ³•"></a>äºŒã€Django äº‹åŠ¡çš„å››ç§ç”¨æ³•</h2><h3 id="2-1-è£…é¥°å™¨æ–¹å¼ï¼ˆæ¨èï¼‰"><a href="#2-1-è£…é¥°å™¨æ–¹å¼ï¼ˆæ¨èï¼‰" class="headerlink" title="2.1 è£…é¥°å™¨æ–¹å¼ï¼ˆæ¨èï¼‰"></a>2.1 è£…é¥°å™¨æ–¹å¼ï¼ˆæ¨èï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@transaction.atomic</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">view_func</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># äº‹åŠ¡å—</span><br></code></pre></td></tr></table></figure><h3 id="2-2-ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ–¹å¼"><a href="#2-2-ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ–¹å¼" class="headerlink" title="2.2 ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ–¹å¼"></a>2.2 ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ–¹å¼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> transaction.atomic():<br>    <span class="hljs-comment"># äº‹åŠ¡å—</span><br></code></pre></td></tr></table></figure><h3 id="2-3-æ˜¾å¼æ§åˆ¶äº‹åŠ¡ï¼ˆç”¨äºå¤æ‚é€»è¾‘ï¼‰"><a href="#2-3-æ˜¾å¼æ§åˆ¶äº‹åŠ¡ï¼ˆç”¨äºå¤æ‚é€»è¾‘ï¼‰" class="headerlink" title="2.3 æ˜¾å¼æ§åˆ¶äº‹åŠ¡ï¼ˆç”¨äºå¤æ‚é€»è¾‘ï¼‰"></a>2.3 æ˜¾å¼æ§åˆ¶äº‹åŠ¡ï¼ˆç”¨äºå¤æ‚é€»è¾‘ï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">transaction.set_autocommit(<span class="hljs-literal">False</span>)<br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># æ“ä½œ</span><br>    transaction.commit()<br><span class="hljs-keyword">except</span>:<br>    transaction.rollback()<br></code></pre></td></tr></table></figure><h3 id="2-4-åµŒå¥—ä¿å­˜ç‚¹æ§åˆ¶ï¼ˆå±€éƒ¨å›æ»šï¼‰"><a href="#2-4-åµŒå¥—ä¿å­˜ç‚¹æ§åˆ¶ï¼ˆå±€éƒ¨å›æ»šï¼‰" class="headerlink" title="2.4 åµŒå¥—ä¿å­˜ç‚¹æ§åˆ¶ï¼ˆå±€éƒ¨å›æ»šï¼‰"></a>2.4 åµŒå¥—ä¿å­˜ç‚¹æ§åˆ¶ï¼ˆå±€éƒ¨å›æ»šï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> transaction.atomic():<br>    sid = transaction.savepoint()<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># å†…å±‚æ“ä½œ</span><br>    <span class="hljs-keyword">except</span>:<br>        transaction.savepoint_rollback(sid)<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€åº•å±‚åŸç†ï¼šä¿å­˜ç‚¹å®ç°æœºåˆ¶"><a href="#ä¸‰ã€åº•å±‚åŸç†ï¼šä¿å­˜ç‚¹å®ç°æœºåˆ¶" class="headerlink" title="ä¸‰ã€åº•å±‚åŸç†ï¼šä¿å­˜ç‚¹å®ç°æœºåˆ¶"></a>ä¸‰ã€åº•å±‚åŸç†ï¼šä¿å­˜ç‚¹å®ç°æœºåˆ¶</h2><h3 id="3-1-æ ¸å¿ƒæœºåˆ¶"><a href="#3-1-æ ¸å¿ƒæœºåˆ¶" class="headerlink" title="3.1 æ ¸å¿ƒæœºåˆ¶"></a>3.1 æ ¸å¿ƒæœºåˆ¶</h3><ul><li><p><strong>ä¿å­˜ç‚¹ä¾èµ–æ•°æ®åº“åŸç”Ÿæ”¯æŒï¼ˆå¦‚ PostgreSQL &#x2F; MySQL &#x2F; SQLiteï¼‰</strong></p></li><li><p>æ‰§è¡Œ SQL æŒ‡ä»¤å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SAVEPOINT</span> s1;<br><span class="hljs-keyword">ROLLBACK</span> <span class="hljs-keyword">TO</span> <span class="hljs-keyword">SAVEPOINT</span> s1;<br><span class="hljs-keyword">RELEASE</span> <span class="hljs-keyword">SAVEPOINT</span> s1;<br></code></pre></td></tr></table></figure></li></ul><h3 id="3-2-Django-çš„å°è£…å®ç°ï¼ˆæºç ä½ç½®ï¼šdjango-db-backends-base-base-pyï¼‰"><a href="#3-2-Django-çš„å°è£…å®ç°ï¼ˆæºç ä½ç½®ï¼šdjango-db-backends-base-base-pyï¼‰" class="headerlink" title="3.2 Django çš„å°è£…å®ç°ï¼ˆæºç ä½ç½®ï¼šdjango/db/backends/base/base.pyï¼‰"></a>3.2 Django çš„å°è£…å®ç°ï¼ˆæºç ä½ç½®ï¼š<code>django/db/backends/base/base.py</code>ï¼‰</h3><ul><li><p>åˆ›å»ºä¿å­˜ç‚¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">savepoint</span>(<span class="hljs-params">self</span>):<br>    sid = <span class="hljs-string">&quot;s%s&quot;</span> % <span class="hljs-variable language_">self</span>.savepoint_state<br>    <span class="hljs-variable language_">self</span>.cursor().execute(<span class="hljs-string">&quot;SAVEPOINT %s&quot;</span> % sid)<br>    <span class="hljs-keyword">return</span> sid<br></code></pre></td></tr></table></figure></li><li><p>å›æ»šä¿å­˜ç‚¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">savepoint_rollback</span>(<span class="hljs-params">self, sid</span>):<br>    <span class="hljs-variable language_">self</span>.cursor().execute(<span class="hljs-string">&quot;ROLLBACK TO SAVEPOINT %s&quot;</span> % sid)<br></code></pre></td></tr></table></figure></li><li><p>æäº¤ä¿å­˜ç‚¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">savepoint_commit</span>(<span class="hljs-params">self, sid</span>):<br>    <span class="hljs-variable language_">self</span>.cursor().execute(<span class="hljs-string">&quot;RELEASE SAVEPOINT %s&quot;</span> % sid)<br></code></pre></td></tr></table></figure></li></ul><hr><h2 id="å››ã€è®¾è®¡äº®ç‚¹ä¸æ³¨æ„äº‹é¡¹"><a href="#å››ã€è®¾è®¡äº®ç‚¹ä¸æ³¨æ„äº‹é¡¹" class="headerlink" title="å››ã€è®¾è®¡äº®ç‚¹ä¸æ³¨æ„äº‹é¡¹"></a>å››ã€è®¾è®¡äº®ç‚¹ä¸æ³¨æ„äº‹é¡¹</h2><h3 id="4-1-è®¾è®¡ä¼˜åŠ¿"><a href="#4-1-è®¾è®¡ä¼˜åŠ¿" class="headerlink" title="4.1 è®¾è®¡ä¼˜åŠ¿"></a>4.1 è®¾è®¡ä¼˜åŠ¿</h3><ul><li>âœ… <strong>è·¨æ•°æ®åº“ç»Ÿä¸€è¡Œä¸º</strong>ï¼šå¼€å‘è€…ä¸éœ€å…³å¿ƒ SQL å·®å¼‚ã€‚</li><li>âœ… <strong>äº‹åŠ¡åµŒå¥—çµæ´»</strong>ï¼šæ”¯æŒå¤æ‚ä¸šåŠ¡ä¸­çš„å±€éƒ¨å¤±è´¥ã€‚</li><li>âœ… <strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šäº‹åŠ¡çŠ¶æ€ä½¿ç”¨ <code>threading.local()</code> å­˜å‚¨ã€‚</li><li>âœ… <strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæ‡’è¿æ¥æœºåˆ¶ + å¯è°ƒ <code>CONN_MAX_AGE</code>ã€‚</li></ul><h3 id="4-2-æ³¨æ„äº‹é¡¹"><a href="#4-2-æ³¨æ„äº‹é¡¹" class="headerlink" title="4.2 æ³¨æ„äº‹é¡¹"></a>4.2 æ³¨æ„äº‹é¡¹</h3><ul><li>æ•è·å¼‚å¸¸ååº”æ˜¾å¼å›æ»šï¼Œå¦åˆ™ Django æ— æ³•æ„ŸçŸ¥äº‹åŠ¡å¤±è´¥ã€‚</li><li>SQLite çš„å†…å­˜æ•°æ®åº“ä¾ç„¶æ”¯æŒä¿å­˜ç‚¹ï¼Œä½†ä¸æ¨èç”¨äºç”Ÿäº§ã€‚</li><li>åœ¨ä½¿ç”¨å¤šä¸ªæ•°æ®åº“æ—¶ï¼Œéœ€è¦æ˜¾å¼æŒ‡å®š <code>using=&#39;xxx&#39;</code>ã€‚</li></ul><hr><h2 id="âœ…-æ€»ç»“ä¸€å¥è¯"><a href="#âœ…-æ€»ç»“ä¸€å¥è¯" class="headerlink" title="âœ… æ€»ç»“ä¸€å¥è¯"></a>âœ… æ€»ç»“ä¸€å¥è¯</h2><blockquote><p>Django çš„äº‹åŠ¡æœºåˆ¶æ˜¯å¯¹æ•°æ®åº“åŸç”Ÿäº‹åŠ¡åŠŸèƒ½çš„é«˜å±‚å°è£…ï¼Œé€šè¿‡ <code>atomic</code> å’Œ <code>savepoint</code> ç­‰ APIï¼Œæ—¢å®ç°äº†æ˜“ç”¨æ€§ï¼Œä¹Ÿä¿ç•™äº†é«˜çº§æ§åˆ¶èƒ½åŠ›ï¼Œé€‚åˆä»ç®€å•äº‹åŠ¡åˆ°å¤æ‚åµŒå¥—åœºæ™¯çš„å„ç±»éœ€æ±‚ã€‚</p></blockquote>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django æ•°æ®åº“è¿æ¥</title>
    <link href="/2025/07/21/Django-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5/"/>
    <url>/2025/07/21/Django-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5/</url>
    
    <content type="html"><![CDATA[<h2 id="1-Django-å¦‚ä½•ç®¡ç†æ•°æ®åº“è¿æ¥ï¼Ÿ"><a href="#1-Django-å¦‚ä½•ç®¡ç†æ•°æ®åº“è¿æ¥ï¼Ÿ" class="headerlink" title="1. Django å¦‚ä½•ç®¡ç†æ•°æ®åº“è¿æ¥ï¼Ÿ"></a>1. Django å¦‚ä½•ç®¡ç†æ•°æ®åº“è¿æ¥ï¼Ÿ</h2><ul><li>Django é€šè¿‡ <code>ConnectionHandler</code> ç±»æ¥ç®¡ç†æ‰€æœ‰æ•°æ®åº“è¿æ¥ã€‚</li><li>ä½ å¹³æ—¶ç”¨çš„ <code>connections[&#39;default&#39;]</code>ã€<code>connections[&#39;mydb&#39;]</code>ï¼ŒèƒŒåå°±æ˜¯å®ƒåœ¨å¸®ä½ åˆ›å»ºå’Œç¼“å­˜è¿æ¥ã€‚</li><li><strong>æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æ•°æ®åº“è¿æ¥</strong>ï¼Œäº’ä¸å¹²æ‰°ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li><li>é»˜è®¤æ²¡æœ‰è¿æ¥æ± æœºåˆ¶ï¼Œæ¯ä¸ªçº¿ç¨‹åªç»´æŠ¤ä¸€ä¸ªè¿æ¥å¯¹è±¡ã€‚</li></ul><h3 id="è¿æ¥çš„åˆ›å»ºæµç¨‹"><a href="#è¿æ¥çš„åˆ›å»ºæµç¨‹" class="headerlink" title="è¿æ¥çš„åˆ›å»ºæµç¨‹"></a>è¿æ¥çš„åˆ›å»ºæµç¨‹</h3><ol><li>è¯»å– settings.py é‡Œçš„ <code>DATABASES</code> é…ç½®ã€‚</li><li>æŒ‰éœ€è¡¥å…¨é»˜è®¤å‚æ•°ï¼ˆå¦‚HOSTã€PORTç­‰ï¼‰ã€‚</li><li>åŠ¨æ€åŠ è½½å¯¹åº”æ•°æ®åº“åç«¯ï¼ˆå¦‚MySQLã€PostgreSQLç­‰ï¼‰ã€‚</li><li>åˆ›å»ºè¿æ¥å¯¹è±¡ï¼ˆ<code>DatabaseWrapper</code>ï¼‰ï¼Œå¹¶ç¼“å­˜åˆ°å½“å‰çº¿ç¨‹ã€‚</li></ol><h3 id="è¿æ¥çš„è·å–ä¸å…³é—­"><a href="#è¿æ¥çš„è·å–ä¸å…³é—­" class="headerlink" title="è¿æ¥çš„è·å–ä¸å…³é—­"></a>è¿æ¥çš„è·å–ä¸å…³é—­</h3><ul><li>é€šè¿‡ <code>connections[&#39;default&#39;]</code> è·å–è¿æ¥ã€‚</li><li>é€šè¿‡ <code>close_all()</code> å¯ä»¥å…³é—­æ‰€æœ‰çº¿ç¨‹æœ¬åœ°çš„è¿æ¥ã€‚</li><li>æ²¡æœ‰ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„â€œè¿æ¥æ± â€ï¼Œä½†å¯ä»¥é€šè¿‡ <code>CONN_MAX_AGE</code> è®¾ç½®è¿æ¥å¤ç”¨æ—¶é—´ã€‚</li></ul><hr><h2 id="2-Django-å¦‚ä½•å†³å®šç”¨å“ªä¸ªæ•°æ®åº“ï¼Ÿï¼ˆå¤šæ•°æ®åº“-åˆ†åº“åœºæ™¯ï¼‰"><a href="#2-Django-å¦‚ä½•å†³å®šç”¨å“ªä¸ªæ•°æ®åº“ï¼Ÿï¼ˆå¤šæ•°æ®åº“-åˆ†åº“åœºæ™¯ï¼‰" class="headerlink" title="2. Django å¦‚ä½•å†³å®šç”¨å“ªä¸ªæ•°æ®åº“ï¼Ÿï¼ˆå¤šæ•°æ®åº“&#x2F;åˆ†åº“åœºæ™¯ï¼‰"></a>2. Django å¦‚ä½•å†³å®šç”¨å“ªä¸ªæ•°æ®åº“ï¼Ÿï¼ˆå¤šæ•°æ®åº“&#x2F;åˆ†åº“åœºæ™¯ï¼‰</h2><ul><li>Django é€šè¿‡ <code>ConnectionRouter</code> ç±»æ¥å†³å®šæ¯ä¸ªæ•°æ®åº“æ“ä½œç”¨å“ªä¸ªæ•°æ®åº“ã€‚</li><li>æ”¯æŒå¤šæ•°æ®åº“ã€è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨ã€è¿ç§»æ§åˆ¶ç­‰é«˜çº§ç”¨æ³•ã€‚</li></ul><h3 id="è·¯ç”±å™¨çš„å·¥ä½œæœºåˆ¶"><a href="#è·¯ç”±å™¨çš„å·¥ä½œæœºåˆ¶" class="headerlink" title="è·¯ç”±å™¨çš„å·¥ä½œæœºåˆ¶"></a>è·¯ç”±å™¨çš„å·¥ä½œæœºåˆ¶</h3><ul><li>ä½ å¯ä»¥åœ¨ settings.py é‡Œé…ç½® <code>DATABASE_ROUTERS</code>ï¼ŒæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªâ€œè·¯ç”±å™¨â€ç±»ã€‚</li><li>æ¯ä¸ªè·¯ç”±å™¨å¯ä»¥å®ç°å¦‚ä¸‹æ–¹æ³•ï¼š<ul><li><code>db_for_read(model, **hints)</code>ï¼šå†³å®šè¯»æ“ä½œç”¨å“ªä¸ªæ•°æ®åº“</li><li><code>db_for_write(model, **hints)</code>ï¼šå†³å®šå†™æ“ä½œç”¨å“ªä¸ªæ•°æ®åº“</li><li><code>allow_relation(obj1, obj2, **hints)</code>ï¼šå†³å®šä¸¤ä¸ªå¯¹è±¡æ˜¯å¦å…è®¸å»ºç«‹å…³ç³»</li><li><code>allow_migrate(db, app_label, **hints)</code>ï¼šå†³å®šå“ªäº›æ¨¡å‹å¯ä»¥åœ¨æŒ‡å®šæ•°æ®åº“è¿ç§»</li></ul></li><li>Django ä¼šä¾æ¬¡è°ƒç”¨æ‰€æœ‰è·¯ç”±å™¨çš„æ–¹æ³•ï¼Œåªè¦æœ‰ä¸€ä¸ªè¿”å›ç»“æœå°±ç”¨å®ƒã€‚</li><li>å¦‚æœéƒ½æ²¡è¿”å›ï¼Œåˆ™ç”¨é»˜è®¤æ•°æ®åº“ã€‚</li></ul><h3 id="å…¸å‹ç”¨æ³•ä¸¾ä¾‹"><a href="#å…¸å‹ç”¨æ³•ä¸¾ä¾‹" class="headerlink" title="å…¸å‹ç”¨æ³•ä¸¾ä¾‹"></a>å…¸å‹ç”¨æ³•ä¸¾ä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># settings.py</span><br>DATABASE_ROUTERS = [<span class="hljs-string">&#x27;myproject.db_routers.MyRouter&#x27;</span>]<br><br><span class="hljs-comment"># è‡ªå®šä¹‰è·¯ç”±å™¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRouter</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">db_for_read</span>(<span class="hljs-params">self, model, **hints</span>):<br>        <span class="hljs-keyword">if</span> model._meta.app_label == <span class="hljs-string">&#x27;analytics&#x27;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;analytics_db&#x27;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">db_for_write</span>(<span class="hljs-params">self, model, **hints</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;default&#x27;</span><br></code></pre></td></tr></table></figure><hr><h2 id="3-çº¿ç¨‹å®‰å…¨ä¸è¿æ¥æ± è¯´æ˜"><a href="#3-çº¿ç¨‹å®‰å…¨ä¸è¿æ¥æ± è¯´æ˜" class="headerlink" title="3. çº¿ç¨‹å®‰å…¨ä¸è¿æ¥æ± è¯´æ˜"></a>3. çº¿ç¨‹å®‰å…¨ä¸è¿æ¥æ± è¯´æ˜</h2><ul><li>Django é»˜è®¤ç”¨ <code>threading.local()</code>ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹çš„è¿æ¥å¯¹è±¡ã€‚</li><li>æ²¡æœ‰å†…ç½®è¿æ¥æ± æœºåˆ¶ï¼ˆä¸åƒJavaé‚£æ ·çš„æ± åŒ–ï¼‰ï¼Œé«˜å¹¶å‘åœºæ™¯å»ºè®®ç”¨ç¬¬ä¸‰æ–¹åº“æˆ–å¤–éƒ¨æ± åŒ–å·¥å…·ã€‚</li><li>é€šè¿‡ <code>CONN_MAX_AGE</code> å¯ä»¥è®©è¿æ¥åœ¨ä¸€æ®µæ—¶é—´å†…å¤ç”¨ï¼Œä½†æœ¬è´¨ä¸Šè¿˜æ˜¯â€œæ¯çº¿ç¨‹ä¸€ä¸ªè¿æ¥â€ã€‚</li></ul><hr><h2 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4. æ€»ç»“"></a>4. æ€»ç»“</h2><ul><li>Django çš„æ•°æ®åº“è¿æ¥ç®¡ç†ç®€å•ã€çº¿ç¨‹å®‰å…¨ï¼Œé€‚åˆå¤§å¤šæ•°Webåº”ç”¨ã€‚</li><li>å¤šæ•°æ®åº“å’Œåˆ†åº“åˆ†è¡¨åœºæ™¯ä¸‹ï¼Œè·¯ç”±å™¨æœºåˆ¶éå¸¸çµæ´»ã€‚</li><li>å¦‚æœæœ‰é«˜å¹¶å‘æˆ–è¿æ¥æ•°æœ‰é™éœ€æ±‚ï¼Œå»ºè®®ç»“åˆç¬¬ä¸‰æ–¹è¿æ¥æ± æ–¹æ¡ˆã€‚</li></ul><hr><p><strong>å¸¸ç”¨API</strong>ï¼š</p><ul><li><code>from django.db import connections</code></li><li><code>conn = connections[&#39;default&#39;]</code></li><li><code>cursor = conn.cursor()</code></li><li><code>connections.close_all()</code></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django URL åå‘è§£æ</title>
    <link href="/2025/07/21/Django-URL-%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90/"/>
    <url>/2025/07/21/Django-URL-%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆéœ€è¦åå‘è§£æï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åå‘è§£æï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åå‘è§£æï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦åå‘è§£æï¼Ÿ</h2><h3 id="1-é¿å…ç¡¬ç¼–ç URLçš„é—®é¢˜"><a href="#1-é¿å…ç¡¬ç¼–ç URLçš„é—®é¢˜" class="headerlink" title="1. é¿å…ç¡¬ç¼–ç URLçš„é—®é¢˜"></a>1. <strong>é¿å…ç¡¬ç¼–ç URLçš„é—®é¢˜</strong></h3><p><strong>ä¼ ç»Ÿç¡¬ç¼–ç æ–¹å¼çš„é—®é¢˜</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¸å¥½çš„åšæ³•ï¼šç¡¬ç¼–ç URL</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">some_view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># ç¡¬ç¼–ç URLè·¯å¾„</span><br>    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/blog/posts/123/&#x27;</span>)<br><br><span class="hljs-comment"># æ¨¡æ¿ä¸­ç¡¬ç¼–ç </span><br><span class="hljs-comment"># &lt;a href=&quot;/blog/posts/123/&quot;&gt;æŸ¥çœ‹æ–‡ç« &lt;/a&gt;</span><br></code></pre></td></tr></table></figure><p><strong>é—®é¢˜</strong>ï¼š</p><ul><li>URLç»“æ„å˜æ›´æ—¶éœ€è¦ä¿®æ”¹æ‰€æœ‰ç›¸å…³ä»£ç </li><li>å®¹æ˜“å‡ºé”™ï¼Œéš¾ä»¥ç»´æŠ¤</li><li>è¿åDRYåŸåˆ™ï¼ˆDonâ€™t Repeat Yourselfï¼‰</li></ul><h3 id="2-ä½¿ç”¨åå‘è§£æçš„ä¼˜åŠ¿"><a href="#2-ä½¿ç”¨åå‘è§£æçš„ä¼˜åŠ¿" class="headerlink" title="2. ä½¿ç”¨åå‘è§£æçš„ä¼˜åŠ¿"></a>2. <strong>ä½¿ç”¨åå‘è§£æçš„ä¼˜åŠ¿</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¥½çš„åšæ³•ï¼šä½¿ç”¨åå‘è§£æ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">some_view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># é€šè¿‡URLåç§°åå‘è§£æ</span><br>    <span class="hljs-keyword">return</span> redirect(reverse(<span class="hljs-string">&#x27;blog:post-detail&#x27;</span>, args=[<span class="hljs-number">123</span>]))<br><br><span class="hljs-comment"># æ¨¡æ¿ä¸­ä½¿ç”¨</span><br><span class="hljs-comment"># &#123;% url &#x27;blog:post-detail&#x27; 123 %&#125;</span><br></code></pre></td></tr></table></figure><h2 id="åå‘è§£æçš„æ ¸å¿ƒæœºåˆ¶"><a href="#åå‘è§£æçš„æ ¸å¿ƒæœºåˆ¶" class="headerlink" title="åå‘è§£æçš„æ ¸å¿ƒæœºåˆ¶"></a>åå‘è§£æçš„æ ¸å¿ƒæœºåˆ¶</h2><h3 id="1-viewnameå‚æ•°è§£æ"><a href="#1-viewnameå‚æ•°è§£æ" class="headerlink" title="1. viewnameå‚æ•°è§£æ"></a>1. <strong>viewnameå‚æ•°è§£æ</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs 30:47:django/urls/base.py">if not isinstance(viewname, six.string_types):<br>    view = viewname<br>else:<br>    parts = viewname.split(&#x27;:&#x27;)<br>    parts.reverse()<br>    view = parts[0]<br>    path = parts[1:]<br></code></pre></td></tr></table></figure><p><strong>è§£æè¿‡ç¨‹</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è¾“å…¥: &#x27;blog:post-detail&#x27;</span><br>parts = [<span class="hljs-string">&#x27;blog&#x27;</span>, <span class="hljs-string">&#x27;post-detail&#x27;</span>]<br>parts.reverse()  <span class="hljs-comment"># [&#x27;post-detail&#x27;, &#x27;blog&#x27;]</span><br>view = <span class="hljs-string">&#x27;post-detail&#x27;</span>  <span class="hljs-comment"># æœ€ç»ˆçš„è§†å›¾åç§°</span><br>path = [<span class="hljs-string">&#x27;blog&#x27;</span>]      <span class="hljs-comment"># å‘½åç©ºé—´è·¯å¾„</span><br></code></pre></td></tr></table></figure><h3 id="2-å‘½åç©ºé—´è§£æå¾ªç¯"><a href="#2-å‘½åç©ºé—´è§£æå¾ªç¯" class="headerlink" title="2. å‘½åç©ºé—´è§£æå¾ªç¯"></a>2. <strong>å‘½åç©ºé—´è§£æå¾ªç¯</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs 48:80:django/urls/base.py">while path:<br>    ns = path.pop()<br>    current_ns = current_path.pop() if current_path else None<br>    # Lookup the name to see if it could be an app identifier.<br>    try:<br>        app_list = resolver.app_dict[ns]<br>        # åº”ç”¨å‘½åç©ºé—´å¤„ç†é€»è¾‘...<br>    except KeyError:<br>        pass<br>    <br>    try:<br>        extra, resolver = resolver.namespace_dict[ns]<br>        resolved_path.append(ns)<br>        ns_pattern = ns_pattern + extra<br>    except KeyError as key:<br>        # å‘½åç©ºé—´ä¸å­˜åœ¨çš„é”™è¯¯å¤„ç†...<br></code></pre></td></tr></table></figure><h2 id="è¯¦ç»†ç¤ºä¾‹è¯´æ˜"><a href="#è¯¦ç»†ç¤ºä¾‹è¯´æ˜" class="headerlink" title="è¯¦ç»†ç¤ºä¾‹è¯´æ˜"></a>è¯¦ç»†ç¤ºä¾‹è¯´æ˜</h2><h3 id="1-åŸºç¡€åå‘è§£æç¤ºä¾‹"><a href="#1-åŸºç¡€åå‘è§£æç¤ºä¾‹" class="headerlink" title="1. åŸºç¡€åå‘è§£æç¤ºä¾‹"></a>1. <strong>åŸºç¡€åå‘è§£æç¤ºä¾‹</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># urls.pyé…ç½®</span><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^posts/(?P&lt;post_id&gt;\d+)/$&#x27;</span>, views.post_detail, name=<span class="hljs-string">&#x27;post-detail&#x27;</span>),<br>    url(<span class="hljs-string">r&#x27;^posts/(?P&lt;post_id&gt;\d+)/edit/$&#x27;</span>, views.post_edit, name=<span class="hljs-string">&#x27;post-edit&#x27;</span>),<br>]<br><br><span class="hljs-comment"># åœ¨è§†å›¾ä¸­ä½¿ç”¨åå‘è§£æ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_post</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># åˆ›å»ºæ–‡ç« åé‡å®šå‘åˆ°è¯¦æƒ…é¡µ</span><br>    post = Post.objects.create(title=<span class="hljs-string">&#x27;æ–°æ–‡ç« &#x27;</span>, content=<span class="hljs-string">&#x27;å†…å®¹&#x27;</span>)<br>    <span class="hljs-keyword">return</span> redirect(reverse(<span class="hljs-string">&#x27;post-detail&#x27;</span>, kwargs=&#123;<span class="hljs-string">&#x27;post_id&#x27;</span>: post.<span class="hljs-built_in">id</span>&#125;))<br>    <span class="hljs-comment"># ç”ŸæˆURL: /posts/123/</span><br><br><span class="hljs-comment"># åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨</span><br><span class="hljs-comment"># &#123;% url &#x27;post-detail&#x27; post.id %&#125;</span><br><span class="hljs-comment"># &#123;% url &#x27;post-edit&#x27; post_id=post.id %&#125;</span><br></code></pre></td></tr></table></figure><h3 id="2-å‘½åç©ºé—´åå‘è§£æç¤ºä¾‹"><a href="#2-å‘½åç©ºé—´åå‘è§£æç¤ºä¾‹" class="headerlink" title="2. å‘½åç©ºé—´åå‘è§£æç¤ºä¾‹"></a>2. <strong>å‘½åç©ºé—´åå‘è§£æç¤ºä¾‹</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¸»urls.py</span><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^blog/&#x27;</span>, include(<span class="hljs-string">&#x27;blog.urls&#x27;</span>, namespace=<span class="hljs-string">&#x27;blog&#x27;</span>)),<br>    url(<span class="hljs-string">r&#x27;^api/v1/&#x27;</span>, include(<span class="hljs-string">&#x27;api.urls&#x27;</span>, namespace=<span class="hljs-string">&#x27;api-v1&#x27;</span>)),<br>    url(<span class="hljs-string">r&#x27;^api/v2/&#x27;</span>, include(<span class="hljs-string">&#x27;api.urls&#x27;</span>, namespace=<span class="hljs-string">&#x27;api-v2&#x27;</span>)),<br>]<br><br><span class="hljs-comment"># blog/urls.py</span><br>app_name = <span class="hljs-string">&#x27;blog&#x27;</span>  <span class="hljs-comment"># åº”ç”¨å‘½åç©ºé—´</span><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^posts/(?P&lt;pk&gt;\d+)/$&#x27;</span>, views.PostDetail.as_view(), name=<span class="hljs-string">&#x27;post-detail&#x27;</span>),<br>    url(<span class="hljs-string">r&#x27;^categories/(?P&lt;slug&gt;[\w-]+)/$&#x27;</span>, views.category_posts, name=<span class="hljs-string">&#x27;category&#x27;</span>),<br>]<br><br><span class="hljs-comment"># ä½¿ç”¨å‘½åç©ºé—´åå‘è§£æ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">some_view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># å®ä¾‹å‘½åç©ºé—´ + åº”ç”¨å‘½åç©ºé—´ + URLåç§°</span><br>    blog_url = reverse(<span class="hljs-string">&#x27;blog:post-detail&#x27;</span>, args=[<span class="hljs-number">123</span>])<br>    <span class="hljs-comment"># ç”Ÿæˆ: /blog/posts/123/</span><br>    <br>    api_v1_url = reverse(<span class="hljs-string">&#x27;api-v1:post-list&#x27;</span>)  <br>    <span class="hljs-comment"># ç”Ÿæˆ: /api/v1/posts/</span><br>    <br>    api_v2_url = reverse(<span class="hljs-string">&#x27;api-v2:post-list&#x27;</span>)<br>    <span class="hljs-comment"># ç”Ÿæˆ: /api/v2/posts/</span><br></code></pre></td></tr></table></figure><h3 id="3-å¤æ‚åµŒå¥—å‘½åç©ºé—´ç¤ºä¾‹"><a href="#3-å¤æ‚åµŒå¥—å‘½åç©ºé—´ç¤ºä¾‹" class="headerlink" title="3. å¤æ‚åµŒå¥—å‘½åç©ºé—´ç¤ºä¾‹"></a>3. <strong>å¤æ‚åµŒå¥—å‘½åç©ºé—´ç¤ºä¾‹</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¤šå±‚åµŒå¥—çš„URLé…ç½®</span><br><span class="hljs-comment"># ä¸»urls.py</span><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^admin/&#x27;</span>, include(<span class="hljs-string">&#x27;management.urls&#x27;</span>, namespace=<span class="hljs-string">&#x27;admin&#x27;</span>)),<br>]<br><br><span class="hljs-comment"># management/urls.py  </span><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^users/&#x27;</span>, include(<span class="hljs-string">&#x27;users.urls&#x27;</span>, namespace=<span class="hljs-string">&#x27;users&#x27;</span>)),<br>    url(<span class="hljs-string">r&#x27;^reports/&#x27;</span>, include(<span class="hljs-string">&#x27;reports.urls&#x27;</span>, namespace=<span class="hljs-string">&#x27;reports&#x27;</span>)),<br>]<br><br><span class="hljs-comment"># users/urls.py</span><br>app_name = <span class="hljs-string">&#x27;users&#x27;</span><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^(?P&lt;user_id&gt;\d+)/profile/$&#x27;</span>, views.profile, name=<span class="hljs-string">&#x27;profile&#x27;</span>),<br>    url(<span class="hljs-string">r&#x27;^(?P&lt;user_id&gt;\d+)/permissions/$&#x27;</span>, views.permissions, name=<span class="hljs-string">&#x27;permissions&#x27;</span>),<br>]<br><br><span class="hljs-comment"># åå‘è§£æåµŒå¥—å‘½åç©ºé—´</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">admin_dashboard</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># è§£æè·¯å¾„: admin:users:profile</span><br>    user_profile_url = reverse(<span class="hljs-string">&#x27;admin:users:profile&#x27;</span>, args=[request.user.<span class="hljs-built_in">id</span>])<br>    <span class="hljs-comment"># ç”Ÿæˆ: /admin/users/123/profile/</span><br>    <br>    permissions_url = reverse(<span class="hljs-string">&#x27;admin:users:permissions&#x27;</span>, kwargs=&#123;<span class="hljs-string">&#x27;user_id&#x27;</span>: <span class="hljs-number">456</span>&#125;)<br>    <span class="hljs-comment"># ç”Ÿæˆ: /admin/users/456/permissions/</span><br></code></pre></td></tr></table></figure><h2 id="åå‘è§£æçš„å®é™…åº”ç”¨åœºæ™¯"><a href="#åå‘è§£æçš„å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="åå‘è§£æçš„å®é™…åº”ç”¨åœºæ™¯"></a>åå‘è§£æçš„å®é™…åº”ç”¨åœºæ™¯</h2><h3 id="1-è¡¨å•æäº¤åçš„é‡å®šå‘"><a href="#1-è¡¨å•æäº¤åçš„é‡å®šå‘" class="headerlink" title="1. è¡¨å•æäº¤åçš„é‡å®šå‘"></a>1. <strong>è¡¨å•æäº¤åçš„é‡å®šå‘</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit_article</span>(<span class="hljs-params">request, article_id</span>):<br>    article = get_object_or_404(Article, <span class="hljs-built_in">id</span>=article_id)<br>    <br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        form = ArticleForm(request.POST, instance=article)<br>        <span class="hljs-keyword">if</span> form.is_valid():<br>            form.save()<br>            <span class="hljs-comment"># ä½¿ç”¨åå‘è§£æé‡å®šå‘ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç URL</span><br>            <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;article:detail&#x27;</span>, article_id=article.<span class="hljs-built_in">id</span>)<br>    <span class="hljs-keyword">else</span>:<br>        form = ArticleForm(instance=article)<br>    <br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;edit_article.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;form&#x27;</span>: form&#125;)<br></code></pre></td></tr></table></figure><h3 id="2-åŠ¨æ€èœå•ç”Ÿæˆ"><a href="#2-åŠ¨æ€èœå•ç”Ÿæˆ" class="headerlink" title="2. åŠ¨æ€èœå•ç”Ÿæˆ"></a>2. <strong>åŠ¨æ€èœå•ç”Ÿæˆ</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åœ¨æ¨¡æ¿æˆ–ä¸Šä¸‹æ–‡å¤„ç†å™¨ä¸­åŠ¨æ€ç”Ÿæˆèœå•</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_navigation_menu</span>():<br>    <span class="hljs-keyword">return</span> [<br>        &#123;<br>            <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;é¦–é¡µ&#x27;</span>,<br>            <span class="hljs-string">&#x27;url&#x27;</span>: reverse(<span class="hljs-string">&#x27;home&#x27;</span>),<br>        &#125;,<br>        &#123;<br>            <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;åšå®¢&#x27;</span>,<br>            <span class="hljs-string">&#x27;url&#x27;</span>: reverse(<span class="hljs-string">&#x27;blog:post-list&#x27;</span>),<br>            <span class="hljs-string">&#x27;children&#x27;</span>: [<br>                &#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;æœ€æ–°æ–‡ç« &#x27;</span>, <span class="hljs-string">&#x27;url&#x27;</span>: reverse(<span class="hljs-string">&#x27;blog:latest&#x27;</span>)&#125;,<br>                &#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;åˆ†ç±»&#x27;</span>, <span class="hljs-string">&#x27;url&#x27;</span>: reverse(<span class="hljs-string">&#x27;blog:categories&#x27;</span>)&#125;,<br>            ]<br>        &#125;,<br>        &#123;<br>            <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;ç”¨æˆ·ä¸­å¿ƒ&#x27;</span>,<br>            <span class="hljs-string">&#x27;url&#x27;</span>: reverse(<span class="hljs-string">&#x27;accounts:profile&#x27;</span>),<br>        &#125;<br>    ]<br></code></pre></td></tr></table></figure><h3 id="3-APIç‰ˆæœ¬æ§åˆ¶"><a href="#3-APIç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="3. APIç‰ˆæœ¬æ§åˆ¶"></a>3. <strong>APIç‰ˆæœ¬æ§åˆ¶</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># APIç‰ˆæœ¬åˆ‡æ¢</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_api_endpoint</span>(<span class="hljs-params">version=<span class="hljs-string">&#x27;v1&#x27;</span>, endpoint=<span class="hljs-string">&#x27;posts&#x27;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ ¹æ®ç‰ˆæœ¬åŠ¨æ€ç”ŸæˆAPIç«¯ç‚¹&quot;&quot;&quot;</span><br>    namespace = <span class="hljs-string">f&#x27;api-<span class="hljs-subst">&#123;version&#125;</span>&#x27;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">return</span> reverse(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;namespace&#125;</span>:<span class="hljs-subst">&#123;endpoint&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">except</span> NoReverseMatch:<br>        <span class="hljs-comment"># é™çº§åˆ°é»˜è®¤ç‰ˆæœ¬</span><br>        <span class="hljs-keyword">return</span> reverse(<span class="hljs-string">f&#x27;api-v1:<span class="hljs-subst">&#123;endpoint&#125;</span>&#x27;</span>)<br><br><span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span><br>posts_v2_url = get_api_endpoint(<span class="hljs-string">&#x27;v2&#x27;</span>, <span class="hljs-string">&#x27;posts&#x27;</span>)  <span class="hljs-comment"># /api/v2/posts/</span><br>users_v1_url = get_api_endpoint(<span class="hljs-string">&#x27;v1&#x27;</span>, <span class="hljs-string">&#x27;users&#x27;</span>)  <span class="hljs-comment"># /api/v1/users/</span><br></code></pre></td></tr></table></figure><h3 id="4-é‚®ä»¶æ¨¡æ¿ä¸­çš„é“¾æ¥"><a href="#4-é‚®ä»¶æ¨¡æ¿ä¸­çš„é“¾æ¥" class="headerlink" title="4. é‚®ä»¶æ¨¡æ¿ä¸­çš„é“¾æ¥"></a>4. <strong>é‚®ä»¶æ¨¡æ¿ä¸­çš„é“¾æ¥</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_notification_email</span>(<span class="hljs-params">user, article</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å‘é€åŒ…å«é“¾æ¥çš„é€šçŸ¥é‚®ä»¶&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># ç”Ÿæˆç»å¯¹URLç”¨äºé‚®ä»¶</span><br>    article_url = request.build_absolute_uri(<br>        reverse(<span class="hljs-string">&#x27;blog:article-detail&#x27;</span>, args=[article.<span class="hljs-built_in">id</span>])<br>    )<br>    <br>    profile_url = request.build_absolute_uri(<br>        reverse(<span class="hljs-string">&#x27;accounts:profile&#x27;</span>, args=[user.<span class="hljs-built_in">id</span>])<br>    )<br>    <br>    send_mail(<br>        subject=<span class="hljs-string">&#x27;æ–°æ–‡ç« é€šçŸ¥&#x27;</span>,<br>        message=<span class="hljs-string">f&#x27;æŸ¥çœ‹æ–‡ç« : <span class="hljs-subst">&#123;article_url&#125;</span>\nç®¡ç†ä¸ªäººèµ„æ–™: <span class="hljs-subst">&#123;profile_url&#125;</span>&#x27;</span>,<br>        from_email=<span class="hljs-string">&#x27;system@example.com&#x27;</span>,<br>        recipient_list=[user.email],<br>    )<br></code></pre></td></tr></table></figure><h2 id="åå‘è§£æçš„æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“"><a href="#åå‘è§£æçš„æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“" class="headerlink" title="åå‘è§£æçš„æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“"></a>åå‘è§£æçš„æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“</h2><h3 id="1-ç»´æŠ¤æ€§"><a href="#1-ç»´æŠ¤æ€§" class="headerlink" title="1. ç»´æŠ¤æ€§"></a>1. <strong>ç»´æŠ¤æ€§</strong></h3><ul><li>URLç»“æ„å˜æ›´æ—¶åªéœ€ä¿®æ”¹URLconfï¼Œæ‰€æœ‰å¼•ç”¨è‡ªåŠ¨æ›´æ–°</li><li>å‡å°‘å› URLå˜æ›´å¯¼è‡´çš„404é”™è¯¯</li></ul><h3 id="2-å¯è¯»æ€§"><a href="#2-å¯è¯»æ€§" class="headerlink" title="2. å¯è¯»æ€§"></a>2. <strong>å¯è¯»æ€§</strong></h3><ul><li>ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°è€Œä¸æ˜¯å¤æ‚çš„URLè·¯å¾„</li><li>ä»£ç æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤</li></ul><h3 id="3-çµæ´»æ€§"><a href="#3-çµæ´»æ€§" class="headerlink" title="3. çµæ´»æ€§"></a>3. <strong>çµæ´»æ€§</strong></h3><ul><li>æ”¯æŒå‘½åç©ºé—´ï¼Œé¿å…åç§°å†²çª</li><li>æ”¯æŒå‚æ•°ä¼ é€’ï¼ŒåŠ¨æ€ç”ŸæˆURL</li></ul><h3 id="4-DRYåŸåˆ™"><a href="#4-DRYåŸåˆ™" class="headerlink" title="4. DRYåŸåˆ™"></a>4. <strong>DRYåŸåˆ™</strong></h3><ul><li>URLå®šä¹‰åªåœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œé¿å…é‡å¤</li><li>ç»Ÿä¸€çš„URLç®¡ç†æ–¹å¼</li></ul><h3 id="5-é”™è¯¯æ£€æµ‹"><a href="#5-é”™è¯¯æ£€æµ‹" class="headerlink" title="5. é”™è¯¯æ£€æµ‹"></a>5. <strong>é”™è¯¯æ£€æµ‹</strong></h3><ul><li>ç¼–è¯‘æ—¶å¯ä»¥æ£€æµ‹åˆ°æ— æ•ˆçš„URLåç§°</li><li>æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯</li></ul><p>åå‘è§£ææ˜¯Django URLç³»ç»Ÿçš„æ ¸å¿ƒç‰¹æ€§ï¼Œå®ƒå°†URLçš„å®šä¹‰å’Œä½¿ç”¨è§£è€¦ï¼Œä½¿å¾—Webåº”ç”¨æ›´åŠ çµæ´»ã€å¯ç»´æŠ¤å’Œå¥å£®ã€‚é€šè¿‡å‘½åURLæ¨¡å¼å’Œå‘½åç©ºé—´æœºåˆ¶ï¼Œå¼€å‘è€…å¯ä»¥æ„å»ºå¤æ‚è€Œæ¸…æ™°çš„URLç»“æ„ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„ç®€æ´æ€§å’Œå¯è¯»æ€§ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django ç¼“å­˜ä¸­é—´ä»¶</title>
    <link href="/2025/07/19/Django%E7%BC%93%E5%AD%98%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    <url>/2025/07/19/Django%E7%BC%93%E5%AD%98%E4%B8%AD%E9%97%B4%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h3 id="1-æ•´ä½“æ¶æ„è®¾è®¡"><a href="#1-æ•´ä½“æ¶æ„è®¾è®¡" class="headerlink" title="1. æ•´ä½“æ¶æ„è®¾è®¡"></a>1. <strong>æ•´ä½“æ¶æ„è®¾è®¡</strong></h3><p>Djangoé‡‡ç”¨äº†åˆ†ç¦»å¼ç¼“å­˜è®¾è®¡ï¼Œå°†ç¼“å­˜æ“ä½œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¸­é—´ä»¶é…ç½®é¡ºåºï¼ˆéå¸¸é‡è¦ï¼ï¼‰</span><br>MIDDLEWARE = [<br>    <span class="hljs-string">&#x27;django.middleware.cache.UpdateCacheMiddleware&#x27;</span>,  <span class="hljs-comment"># ç¬¬ä¸€ä¸ª</span><br>    <span class="hljs-string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,<br>    <span class="hljs-comment"># ... å…¶ä»–ä¸­é—´ä»¶ ...</span><br>    <span class="hljs-string">&#x27;django.middleware.cache.FetchFromCacheMiddleware&#x27;</span>  <span class="hljs-comment"># æœ€åä¸€ä¸ª</span><br>]<br></code></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</strong></p><ul><li><strong>è¯·æ±‚é˜¶æ®µ</strong>ï¼šä¸­é—´ä»¶ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œï¼Œ<code>FetchFromCacheMiddleware</code>æœ€åæ‰§è¡Œï¼Œå¯ä»¥ç›´æ¥è¿”å›ç¼“å­˜</li><li><strong>å“åº”é˜¶æ®µ</strong>ï¼šä¸­é—´ä»¶ä»ä¸‹åˆ°ä¸Šæ‰§è¡Œï¼Œ<code>UpdateCacheMiddleware</code>æœ€åæ‰§è¡Œï¼Œè·å¾—æœ€ç»ˆå“åº”è¿›è¡Œç¼“å­˜</li></ul><h3 id="2-FetchFromCacheMiddleware-ç¼“å­˜è·å–ä¸­é—´ä»¶"><a href="#2-FetchFromCacheMiddleware-ç¼“å­˜è·å–ä¸­é—´ä»¶" class="headerlink" title="2. FetchFromCacheMiddleware - ç¼“å­˜è·å–ä¸­é—´ä»¶"></a>2. <strong>FetchFromCacheMiddleware - ç¼“å­˜è·å–ä¸­é—´ä»¶</strong></h3><h4 id="2-1-æ ¸å¿ƒåŠŸèƒ½"><a href="#2-1-æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="2.1 æ ¸å¿ƒåŠŸèƒ½"></a>2.1 æ ¸å¿ƒåŠŸèƒ½</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_request</span>(<span class="hljs-params">self, request</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ä»ç¼“å­˜ä¸­æ£€æŸ¥å¹¶è¿”å›é¡µé¢&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># 1. åªç¼“å­˜GETå’ŒHEADè¯·æ±‚</span><br>    <span class="hljs-keyword">if</span> request.method <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;HEAD&#x27;</span>):<br>        request._cache_update_cache = <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>  <span class="hljs-comment"># ä¸æ£€æŸ¥ç¼“å­˜</span><br>    <br>    <span class="hljs-comment"># 2. å°è¯•è·å–GETè¯·æ±‚çš„ç¼“å­˜</span><br>    cache_key = get_cache_key(request, <span class="hljs-variable language_">self</span>.key_prefix, <span class="hljs-string">&#x27;GET&#x27;</span>, cache=<span class="hljs-variable language_">self</span>.cache)<br>    <span class="hljs-keyword">if</span> cache_key <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        request._cache_update_cache = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>  <span class="hljs-comment"># æ²¡æœ‰ç¼“å­˜ä¿¡æ¯ï¼Œéœ€è¦é‡æ–°æ„å»º</span><br>    <br>    response = <span class="hljs-variable language_">self</span>.cache.get(cache_key)<br>    <br>    <span class="hljs-comment"># 3. å¦‚æœæ²¡æ‰¾åˆ°ä¸”æ˜¯HEADè¯·æ±‚ï¼Œå°è¯•æŸ¥æ‰¾HEADä¸“ç”¨ç¼“å­˜</span><br>    <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> request.method == <span class="hljs-string">&#x27;HEAD&#x27;</span>:<br>        cache_key = get_cache_key(request, <span class="hljs-variable language_">self</span>.key_prefix, <span class="hljs-string">&#x27;HEAD&#x27;</span>, cache=<span class="hljs-variable language_">self</span>.cache)<br>        response = <span class="hljs-variable language_">self</span>.cache.get(cache_key)<br>    <br>    <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        request._cache_update_cache = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>  <span class="hljs-comment"># æ²¡æœ‰ç¼“å­˜ï¼Œéœ€è¦é‡æ–°æ„å»º</span><br>    <br>    <span class="hljs-comment"># 4. ç¼“å­˜å‘½ä¸­ï¼Œè¿”å›ç¼“å­˜çš„å“åº”</span><br>    request._cache_update_cache = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h4 id="2-2-ç¼“å­˜é”®ç”Ÿæˆæœºåˆ¶"><a href="#2-2-ç¼“å­˜é”®ç”Ÿæˆæœºåˆ¶" class="headerlink" title="2.2 ç¼“å­˜é”®ç”Ÿæˆæœºåˆ¶"></a>2.2 ç¼“å­˜é”®ç”Ÿæˆæœºåˆ¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># get_cache_keyå‡½æ•°ä¼šè€ƒè™‘ä»¥ä¸‹å› ç´ ï¼š</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_cache_key_example</span>(<span class="hljs-params">request</span>):<br>    factors = [<br>        request.get_full_path(),           <span class="hljs-comment"># URLè·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°</span><br>        request.method,                    <span class="hljs-comment"># HTTPæ–¹æ³•</span><br>        request.META.get(<span class="hljs-string">&#x27;HTTP_ACCEPT_LANGUAGE&#x27;</span>),  <span class="hljs-comment"># è¯­è¨€åå¥½</span><br>        request.META.get(<span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span>),       <span class="hljs-comment"># ç”¨æˆ·ä»£ç†ï¼ˆå¦‚æœåœ¨Varyä¸­ï¼‰</span><br>        request.COOKIES,                   <span class="hljs-comment"># Cookieï¼ˆå¦‚æœåœ¨Varyä¸­ï¼‰</span><br>    ]<br>    <span class="hljs-comment"># æ ¹æ®å“åº”çš„Varyå¤´å†³å®šå“ªäº›è¯·æ±‚å¤´å½±å“ç¼“å­˜é”®</span><br>    <span class="hljs-keyword">return</span> hashlib.md5(<span class="hljs-string">&#x27;|&#x27;</span>.join(factors).encode()).hexdigest()<br></code></pre></td></tr></table></figure><h3 id="3-UpdateCacheMiddleware-ç¼“å­˜æ›´æ–°ä¸­é—´ä»¶"><a href="#3-UpdateCacheMiddleware-ç¼“å­˜æ›´æ–°ä¸­é—´ä»¶" class="headerlink" title="3. UpdateCacheMiddleware - ç¼“å­˜æ›´æ–°ä¸­é—´ä»¶"></a>3. <strong>UpdateCacheMiddleware - ç¼“å­˜æ›´æ–°ä¸­é—´ä»¶</strong></h3><h4 id="3-1-æ ¸å¿ƒåŠŸèƒ½"><a href="#3-1-æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="3.1 æ ¸å¿ƒåŠŸèƒ½"></a>3.1 æ ¸å¿ƒåŠŸèƒ½</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_response</span>(<span class="hljs-params">self, request, response</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è®¾ç½®ç¼“å­˜ï¼ˆå¦‚æœéœ€è¦ï¼‰&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># 1. æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°ç¼“å­˜</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>._should_update_cache(request, response):<br>        <span class="hljs-keyword">return</span> response<br>    <br>    <span class="hljs-comment"># 2. ä¸ç¼“å­˜æµå¼å“åº”å’Œé200/304çŠ¶æ€ç </span><br>    <span class="hljs-keyword">if</span> response.streaming <span class="hljs-keyword">or</span> response.status_code <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-number">200</span>, <span class="hljs-number">304</span>):<br>        <span class="hljs-keyword">return</span> response<br>    <br>    <span class="hljs-comment"># 3. å®‰å…¨æ£€æŸ¥ï¼šä¸ç¼“å­˜å¯èƒ½åŒ…å«ç”¨æˆ·ç‰¹å®šä¿¡æ¯çš„å“åº”</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request.COOKIES <span class="hljs-keyword">and</span> response.cookies <span class="hljs-keyword">and</span> has_vary_header(response, <span class="hljs-string">&#x27;Cookie&#x27;</span>):<br>        <span class="hljs-keyword">return</span> response<br>    <br>    <span class="hljs-comment"># 4. è·å–ç¼“å­˜è¶…æ—¶æ—¶é—´</span><br>    timeout = get_max_age(response)  <span class="hljs-comment"># ä»Cache-Controlè·å–</span><br>    <span class="hljs-keyword">if</span> timeout <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        timeout = <span class="hljs-variable language_">self</span>.cache_timeout  <span class="hljs-comment"># ä½¿ç”¨é»˜è®¤å€¼</span><br>    <span class="hljs-keyword">elif</span> timeout == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> response  <span class="hljs-comment"># max-age=0ï¼Œä¸ç¼“å­˜</span><br>    <br>    <span class="hljs-comment"># 5. è®¾ç½®å“åº”å¤´</span><br>    patch_response_headers(response, timeout)<br>    <br>    <span class="hljs-comment"># 6. ç¼“å­˜å“åº”</span><br>    <span class="hljs-keyword">if</span> timeout <span class="hljs-keyword">and</span> response.status_code == <span class="hljs-number">200</span>:<br>        cache_key = learn_cache_key(request, response, timeout, <span class="hljs-variable language_">self</span>.key_prefix, cache=<span class="hljs-variable language_">self</span>.cache)<br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(response, <span class="hljs-string">&#x27;render&#x27;</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">callable</span>(response.render):<br>            <span class="hljs-comment"># æ¨¡æ¿å“åº”ï¼šç­‰æ¸²æŸ“å®Œæˆåå†ç¼“å­˜</span><br>            response.add_post_render_callback(<br>                <span class="hljs-keyword">lambda</span> r: <span class="hljs-variable language_">self</span>.cache.<span class="hljs-built_in">set</span>(cache_key, r, timeout)<br>            )<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># æ™®é€šå“åº”ï¼šç›´æ¥ç¼“å­˜</span><br>            <span class="hljs-variable language_">self</span>.cache.<span class="hljs-built_in">set</span>(cache_key, response, timeout)<br>    <br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h4 id="3-2-å®‰å…¨æœºåˆ¶è¯¦è§£"><a href="#3-2-å®‰å…¨æœºåˆ¶è¯¦è§£" class="headerlink" title="3.2 å®‰å…¨æœºåˆ¶è¯¦è§£"></a>3.2 å®‰å…¨æœºåˆ¶è¯¦è§£</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é˜²æ­¢ç”¨æˆ·ç‰¹å®šæ•°æ®æ³„éœ²</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">security_check_example</span>(<span class="hljs-params">request, response</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    åœºæ™¯ï¼šç”¨æˆ·é¦–æ¬¡è®¿é—®ï¼ˆæ— Cookieï¼‰ï¼ŒæœåŠ¡å™¨è®¾ç½®äº†ç”¨æˆ·ç‰¹å®šçš„Cookie</span><br><span class="hljs-string">    é—®é¢˜ï¼šå¦‚æœç¼“å­˜è¿™ä¸ªå“åº”ï¼Œå…¶ä»–ç”¨æˆ·å¯èƒ½çœ‹åˆ°ç¬¬ä¸€ä¸ªç”¨æˆ·çš„Cookie</span><br><span class="hljs-string">    è§£å†³ï¼šæ£€æµ‹åˆ°è¿™ç§æƒ…å†µæ—¶ï¼Œä¸è¿›è¡Œç¼“å­˜</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request.COOKIES <span class="hljs-keyword">and</span> response.cookies <span class="hljs-keyword">and</span> has_vary_header(response, <span class="hljs-string">&#x27;Cookie&#x27;</span>):<br>        <span class="hljs-comment"># è¯·æ±‚æ— Cookie + å“åº”è®¾ç½®äº†Cookie + å“åº”VaryåŒ…å«Cookie = ä¸ç¼“å­˜</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><h3 id="4-CacheMiddleware-ç»„åˆä¸­é—´ä»¶"><a href="#4-CacheMiddleware-ç»„åˆä¸­é—´ä»¶" class="headerlink" title="4. CacheMiddleware - ç»„åˆä¸­é—´ä»¶"></a>4. <strong>CacheMiddleware - ç»„åˆä¸­é—´ä»¶</strong></h3><h4 id="4-1-è®¾è®¡ç‰¹ç‚¹"><a href="#4-1-è®¾è®¡ç‰¹ç‚¹" class="headerlink" title="4.1 è®¾è®¡ç‰¹ç‚¹"></a>4.1 è®¾è®¡ç‰¹ç‚¹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheMiddleware</span>(UpdateCacheMiddleware, FetchFromCacheMiddleware):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ç®€å•ç«™ç‚¹çš„åŸºç¡€ç¼“å­˜ä¸­é—´ä»¶</span><br><span class="hljs-string">    åŒæ—¶ç»§æ‰¿è·å–å’Œæ›´æ–°åŠŸèƒ½</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, get_response=<span class="hljs-literal">None</span>, cache_timeout=<span class="hljs-literal">None</span>, **kwargs</span>):<br>        <span class="hljs-comment"># æ”¯æŒåŠ¨æ€é…ç½®å‚æ•°</span><br>        <span class="hljs-variable language_">self</span>.get_response = get_response<br>        <br>        <span class="hljs-comment"># å¤„ç†key_prefixå‚æ•°</span><br>        <span class="hljs-keyword">try</span>:<br>            key_prefix = kwargs[<span class="hljs-string">&#x27;key_prefix&#x27;</span>]<br>            <span class="hljs-keyword">if</span> key_prefix <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                key_prefix = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">except</span> KeyError:<br>            key_prefix = settings.CACHE_MIDDLEWARE_KEY_PREFIX<br>        <span class="hljs-variable language_">self</span>.key_prefix = key_prefix<br>        <br>        <span class="hljs-comment"># å¤„ç†cache_aliaså‚æ•°</span><br>        <span class="hljs-keyword">try</span>:<br>            cache_alias = kwargs[<span class="hljs-string">&#x27;cache_alias&#x27;</span>]<br>            <span class="hljs-keyword">if</span> cache_alias <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                cache_alias = DEFAULT_CACHE_ALIAS<br>        <span class="hljs-keyword">except</span> KeyError:<br>            cache_alias = settings.CACHE_MIDDLEWARE_ALIAS<br>        <span class="hljs-variable language_">self</span>.cache_alias = cache_alias<br>        <br>        <span class="hljs-comment"># å¤„ç†cache_timeoutå‚æ•°</span><br>        <span class="hljs-keyword">if</span> cache_timeout <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            cache_timeout = settings.CACHE_MIDDLEWARE_SECONDS<br>        <span class="hljs-variable language_">self</span>.cache_timeout = cache_timeout<br>        <br>        <span class="hljs-variable language_">self</span>.cache = caches[<span class="hljs-variable language_">self</span>.cache_alias]<br></code></pre></td></tr></table></figure><h4 id="4-2-è£…é¥°å™¨æ”¯æŒ"><a href="#4-2-è£…é¥°å™¨æ”¯æŒ" class="headerlink" title="4.2 è£…é¥°å™¨æ”¯æŒ"></a>4.2 è£…é¥°å™¨æ”¯æŒ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># CacheMiddlewareå¯ä»¥ä½œä¸ºè£…é¥°å™¨ä½¿ç”¨</span><br><span class="hljs-keyword">from</span> django.views.decorators.cache <span class="hljs-keyword">import</span> cache_page<br><br><span class="hljs-meta">@cache_page(<span class="hljs-params"><span class="hljs-number">60</span> * <span class="hljs-number">15</span></span>)  </span><span class="hljs-comment"># ç¼“å­˜15åˆ†é’Ÿ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;template.html&#x27;</span>, context)<br><br><span class="hljs-comment"># ç­‰ä»·äº</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;template.html&#x27;</span>, context)<br><br>my_view = CacheMiddleware(cache_timeout=<span class="hljs-number">900</span>)(my_view)<br></code></pre></td></tr></table></figure><h3 id="5-ç¼“å­˜ç­–ç•¥è¯¦è§£"><a href="#5-ç¼“å­˜ç­–ç•¥è¯¦è§£" class="headerlink" title="5. ç¼“å­˜ç­–ç•¥è¯¦è§£"></a>5. <strong>ç¼“å­˜ç­–ç•¥è¯¦è§£</strong></h3><h4 id="5-1-ç¼“å­˜æ¡ä»¶"><a href="#5-1-ç¼“å­˜æ¡ä»¶" class="headerlink" title="5.1 ç¼“å­˜æ¡ä»¶"></a>5.1 ç¼“å­˜æ¡ä»¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">should_cache_response</span>(<span class="hljs-params">request, response</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;åˆ¤æ–­å“åº”æ˜¯å¦åº”è¯¥è¢«ç¼“å­˜&quot;&quot;&quot;</span><br>    conditions = [<br>        request.method <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;HEAD&#x27;</span>),     <span class="hljs-comment"># åªç¼“å­˜å®‰å…¨æ–¹æ³•</span><br>        response.status_code <span class="hljs-keyword">in</span> (<span class="hljs-number">200</span>, <span class="hljs-number">304</span>),    <span class="hljs-comment"># åªç¼“å­˜æˆåŠŸå“åº”</span><br>        <span class="hljs-keyword">not</span> response.streaming,                <span class="hljs-comment"># ä¸ç¼“å­˜æµå¼å“åº”</span><br>        <span class="hljs-keyword">not</span> (<span class="hljs-keyword">not</span> request.COOKIES <span class="hljs-keyword">and</span> response.cookies <span class="hljs-keyword">and</span> has_vary_header(response, <span class="hljs-string">&#x27;Cookie&#x27;</span>)),  <span class="hljs-comment"># å®‰å…¨æ£€æŸ¥</span><br>    ]<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">all</span>(conditions)<br></code></pre></td></tr></table></figure><h4 id="5-2-ç¼“å­˜é”®ç­–ç•¥"><a href="#5-2-ç¼“å­˜é”®ç­–ç•¥" class="headerlink" title="5.2 ç¼“å­˜é”®ç­–ç•¥"></a>5.2 ç¼“å­˜é”®ç­–ç•¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">cache_key_factors</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;å½±å“ç¼“å­˜é”®çš„å› ç´ &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&#x27;always_included&#x27;</span>: [<br>            <span class="hljs-string">&#x27;request.get_full_path()&#x27;</span>,  <span class="hljs-comment"># URL + æŸ¥è¯¢å‚æ•°</span><br>            <span class="hljs-string">&#x27;request.method&#x27;</span>,           <span class="hljs-comment"># HTTPæ–¹æ³•</span><br>        ],<br>        <span class="hljs-string">&#x27;vary_dependent&#x27;</span>: [<br>            <span class="hljs-string">&#x27;Accept-Language&#x27;</span>,          <span class="hljs-comment"># å¦‚æœVaryåŒ…å«</span><br>            <span class="hljs-string">&#x27;Accept-Encoding&#x27;</span>,          <span class="hljs-comment"># å¦‚æœVaryåŒ…å«</span><br>            <span class="hljs-string">&#x27;Cookie&#x27;</span>,                   <span class="hljs-comment"># å¦‚æœVaryåŒ…å«</span><br>            <span class="hljs-string">&#x27;User-Agent&#x27;</span>,              <span class="hljs-comment"># å¦‚æœVaryåŒ…å«</span><br>        ]<br>    &#125;<br></code></pre></td></tr></table></figure><h4 id="5-3-è¶…æ—¶æ—¶é—´ä¼˜å…ˆçº§"><a href="#5-3-è¶…æ—¶æ—¶é—´ä¼˜å…ˆçº§" class="headerlink" title="5.3 è¶…æ—¶æ—¶é—´ä¼˜å…ˆçº§"></a>5.3 è¶…æ—¶æ—¶é—´ä¼˜å…ˆçº§</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cache_timeout</span>(<span class="hljs-params">response, default_timeout</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–ç¼“å­˜è¶…æ—¶æ—¶é—´çš„ä¼˜å…ˆçº§&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># 1. ä¼˜å…ˆï¼šå“åº”çš„Cache-Control max-age</span><br>    max_age = get_max_age(response)<br>    <span class="hljs-keyword">if</span> max_age <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">if</span> max_age == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>  <span class="hljs-comment"># ä¸ç¼“å­˜</span><br>        <span class="hljs-keyword">return</span> max_age<br>    <br>    <span class="hljs-comment"># 2. å…¶æ¬¡ï¼šä¸­é—´ä»¶é…ç½®çš„è¶…æ—¶æ—¶é—´</span><br>    <span class="hljs-keyword">if</span> default_timeout:<br>        <span class="hljs-keyword">return</span> default_timeout<br>    <br>    <span class="hljs-comment"># 3. æœ€åï¼šå…¨å±€é…ç½®</span><br>    <span class="hljs-keyword">return</span> settings.CACHE_MIDDLEWARE_SECONDS<br></code></pre></td></tr></table></figure><h3 id="6-å®é™…ä½¿ç”¨åœºæ™¯"><a href="#6-å®é™…ä½¿ç”¨åœºæ™¯" class="headerlink" title="6. å®é™…ä½¿ç”¨åœºæ™¯"></a>6. <strong>å®é™…ä½¿ç”¨åœºæ™¯</strong></h3><h4 id="6-1-å…¨ç«™ç¼“å­˜"><a href="#6-1-å…¨ç«™ç¼“å­˜" class="headerlink" title="6.1 å…¨ç«™ç¼“å­˜"></a>6.1 å…¨ç«™ç¼“å­˜</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># settings.py</span><br>MIDDLEWARE = [<br>    <span class="hljs-string">&#x27;django.middleware.cache.UpdateCacheMiddleware&#x27;</span>,<br>    <span class="hljs-comment"># ... å…¶ä»–ä¸­é—´ä»¶ ...</span><br>    <span class="hljs-string">&#x27;django.middleware.cache.FetchFromCacheMiddleware&#x27;</span><br>]<br><br>CACHE_MIDDLEWARE_ALIAS = <span class="hljs-string">&#x27;default&#x27;</span><br>CACHE_MIDDLEWARE_SECONDS = <span class="hljs-number">600</span><br>CACHE_MIDDLEWARE_KEY_PREFIX = <span class="hljs-string">&#x27;mysite&#x27;</span><br><br>CACHES = &#123;<br>    <span class="hljs-string">&#x27;default&#x27;</span>: &#123;<br>        <span class="hljs-string">&#x27;BACKEND&#x27;</span>: <span class="hljs-string">&#x27;django.core.cache.backends.redis.RedisCache&#x27;</span>,<br>        <span class="hljs-string">&#x27;LOCATION&#x27;</span>: <span class="hljs-string">&#x27;redis://127.0.0.1:6379/1&#x27;</span>,<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="6-2-è§†å›¾çº§ç¼“å­˜"><a href="#6-2-è§†å›¾çº§ç¼“å­˜" class="headerlink" title="6.2 è§†å›¾çº§ç¼“å­˜"></a>6.2 è§†å›¾çº§ç¼“å­˜</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.views.decorators.cache <span class="hljs-keyword">import</span> cache_page<br><span class="hljs-keyword">from</span> django.utils.decorators <span class="hljs-keyword">import</span> method_decorator<br><br><span class="hljs-comment"># å‡½æ•°è§†å›¾</span><br><span class="hljs-meta">@cache_page(<span class="hljs-params"><span class="hljs-number">60</span> * <span class="hljs-number">15</span>, key_prefix=<span class="hljs-string">&#x27;api&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">api_view</span>(<span class="hljs-params">request</span>):<br>    data = expensive_operation()<br>    <span class="hljs-keyword">return</span> JsonResponse(data)<br><br><span class="hljs-comment"># ç±»è§†å›¾</span><br><span class="hljs-meta">@method_decorator(<span class="hljs-params">cache_page(<span class="hljs-params"><span class="hljs-number">60</span> * <span class="hljs-number">15</span></span>), name=<span class="hljs-string">&#x27;get&#x27;</span></span>)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductListView</span>(<span class="hljs-title class_ inherited__">ListView</span>):<br>    model = Product<br>    template_name = <span class="hljs-string">&#x27;products.html&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="6-3-æ¡ä»¶ç¼“å­˜"><a href="#6-3-æ¡ä»¶ç¼“å­˜" class="headerlink" title="6.3 æ¡ä»¶ç¼“å­˜"></a>6.3 æ¡ä»¶ç¼“å­˜</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">conditional_cache_view</span>(<span class="hljs-params">request</span>):<br>    response = render(request, <span class="hljs-string">&#x27;template.html&#x27;</span>, context)<br>    <br>    <span class="hljs-comment"># åŠ¨æ€è®¾ç½®ç¼“å­˜å¤´</span><br>    <span class="hljs-keyword">if</span> request.user.is_authenticated:<br>        response[<span class="hljs-string">&#x27;Cache-Control&#x27;</span>] = <span class="hljs-string">&#x27;private, max-age=300&#x27;</span>  <span class="hljs-comment"># 5åˆ†é’Ÿ</span><br>    <span class="hljs-keyword">else</span>:<br>        response[<span class="hljs-string">&#x27;Cache-Control&#x27;</span>] = <span class="hljs-string">&#x27;public, max-age=3600&#x27;</span>  <span class="hljs-comment"># 1å°æ—¶</span><br>    <br>    <span class="hljs-comment"># è®¾ç½®Varyå¤´ï¼ŒåŸºäºç”¨æˆ·çŠ¶æ€ç¼“å­˜</span><br>    response[<span class="hljs-string">&#x27;Vary&#x27;</span>] = <span class="hljs-string">&#x27;Cookie&#x27;</span><br>    <br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h3 id="7-æ€§èƒ½ä¼˜åŒ–å’Œæ³¨æ„äº‹é¡¹"><a href="#7-æ€§èƒ½ä¼˜åŒ–å’Œæ³¨æ„äº‹é¡¹" class="headerlink" title="7. æ€§èƒ½ä¼˜åŒ–å’Œæ³¨æ„äº‹é¡¹"></a>7. <strong>æ€§èƒ½ä¼˜åŒ–å’Œæ³¨æ„äº‹é¡¹</strong></h3><h4 id="7-1-Varyå¤´çš„å½±å“"><a href="#7-1-Varyå¤´çš„å½±å“" class="headerlink" title="7.1 Varyå¤´çš„å½±å“"></a>7.1 Varyå¤´çš„å½±å“</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è¿‡å¤šçš„Varyå¤´ä¼šå¯¼è‡´ç¼“å­˜æ•ˆç‡ä½ä¸‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bad_vary_example</span>(<span class="hljs-params">request</span>):<br>    response = render(request, <span class="hljs-string">&#x27;template.html&#x27;</span>)<br>    response[<span class="hljs-string">&#x27;Vary&#x27;</span>] = <span class="hljs-string">&#x27;User-Agent, Accept-Language, Accept-Encoding, Cookie&#x27;</span><br>    <span class="hljs-comment"># è¿™ä¼šå¯¼è‡´æ¯ä¸ªç”¨æˆ·ä»£ç†+è¯­è¨€+ç¼–ç +Cookieç»„åˆéƒ½æœ‰å•ç‹¬ç¼“å­˜</span><br>    <span class="hljs-keyword">return</span> response<br><br><span class="hljs-comment"># æ›´å¥½çš„åšæ³•ï¼šåªVaryçœŸæ­£å½±å“å†…å®¹çš„å¤´</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">good_vary_example</span>(<span class="hljs-params">request</span>):<br>    response = render(request, <span class="hljs-string">&#x27;template.html&#x27;</span>)<br>    response[<span class="hljs-string">&#x27;Vary&#x27;</span>] = <span class="hljs-string">&#x27;Accept-Language&#x27;</span>  <span class="hljs-comment"># åªæœ‰è¯­è¨€å½±å“å†…å®¹</span><br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h4 id="7-2-ç¼“å­˜å¤±æ•ˆç­–ç•¥"><a href="#7-2-ç¼“å­˜å¤±æ•ˆç­–ç•¥" class="headerlink" title="7.2 ç¼“å­˜å¤±æ•ˆç­–ç•¥"></a>7.2 ç¼“å­˜å¤±æ•ˆç­–ç•¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¸»åŠ¨æ¸…ç†ç¼“å­˜</span><br><span class="hljs-keyword">from</span> django.core.cache <span class="hljs-keyword">import</span> cache<br><span class="hljs-keyword">from</span> django.core.cache.utils <span class="hljs-keyword">import</span> make_template_fragment_key<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">clear_cache_example</span>():<br>    <span class="hljs-comment"># æ¸…ç†ç‰¹å®šé¡µé¢ç¼“å­˜</span><br>    cache_key = <span class="hljs-string">f&quot;views.decorators.cache.cache_page.<span class="hljs-subst">&#123;hashlib.md5(<span class="hljs-string">b&#x27;/products/&#x27;</span>).hexdigest()&#125;</span>&quot;</span><br>    cache.delete(cache_key)<br>    <br>    <span class="hljs-comment"># æ¸…ç†æ¨¡æ¿ç‰‡æ®µç¼“å­˜</span><br>    fragment_key = make_template_fragment_key(<span class="hljs-string">&#x27;product_list&#x27;</span>, [category_id])<br>    cache.delete(fragment_key)<br></code></pre></td></tr></table></figure><h3 id="8-è°ƒè¯•å’Œç›‘æ§"><a href="#8-è°ƒè¯•å’Œç›‘æ§" class="headerlink" title="8. è°ƒè¯•å’Œç›‘æ§"></a>8. <strong>è°ƒè¯•å’Œç›‘æ§</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheMetricsMiddleware</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, get_response</span>):<br>        <span class="hljs-variable language_">self</span>.get_response = get_response<br>        <span class="hljs-variable language_">self</span>.cache_hits = <span class="hljs-number">0</span><br>        <span class="hljs-variable language_">self</span>.cache_misses = <span class="hljs-number">0</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self, request</span>):<br>        response = <span class="hljs-variable language_">self</span>.get_response(request)<br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(request, <span class="hljs-string">&#x27;_cache_update_cache&#x27;</span>):<br>            <span class="hljs-keyword">if</span> request._cache_update_cache:<br>                <span class="hljs-variable language_">self</span>.cache_misses += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-variable language_">self</span>.cache_hits += <span class="hljs-number">1</span><br>        <br>        <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Djangoçš„ç¼“å­˜ä¸­é—´ä»¶ç³»ç»Ÿé€šè¿‡åˆ†ç¦»è·å–å’Œæ›´æ–°é€»è¾‘ï¼Œæä¾›äº†çµæ´»è€Œå¼ºå¤§çš„é¡µé¢çº§ç¼“å­˜åŠŸèƒ½ã€‚å…³é”®ç‰¹ç‚¹ï¼š</p><ol><li><strong>åˆ†é˜¶æ®µå¤„ç†</strong>ï¼šè¯·æ±‚é˜¶æ®µè·å–ï¼Œå“åº”é˜¶æ®µæ›´æ–°</li><li><strong>å®‰å…¨ç¬¬ä¸€</strong>ï¼šé˜²æ­¢ç”¨æˆ·æ•°æ®æ³„éœ²</li><li><strong>çµæ´»é…ç½®</strong>ï¼šæ”¯æŒå¤šç§è¶…æ—¶ç­–ç•¥</li><li><strong>Varyæ”¯æŒ</strong>ï¼šåŸºäºè¯·æ±‚å¤´çš„ç»†ç²’åº¦ç¼“å­˜</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå‡å°‘æ•°æ®åº“æŸ¥è¯¢å’Œæ¨¡æ¿æ¸²æŸ“</li></ol><p>æ­£ç¡®ä½¿ç”¨è¿™äº›ä¸­é—´ä»¶å¯ä»¥æ˜¾è‘—æå‡Djangoåº”ç”¨çš„æ€§èƒ½ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django URLåŒ¹é…ç®—æ³•</title>
    <link href="/2025/07/18/Django-URL%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95/"/>
    <url>/2025/07/18/Django-URL%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>Djangoçš„URLåŒ¹é…å°±åƒ<strong>å‰¥æ´‹è‘±</strong>ä¸€æ ·ï¼Œä¸€å±‚ä¸€å±‚åœ°å¤„ç†URLï¼Œæ¯ä¸€å±‚åªè´Ÿè´£åŒ¹é…è‡ªå·±çš„éƒ¨åˆ†ï¼Œç„¶åæŠŠå‰©ä¸‹çš„éƒ¨åˆ†äº¤ç»™ä¸‹ä¸€å±‚ç»§ç»­å¤„ç†ã€‚</p><h2 id="ç®—æ³•æµç¨‹å›¾"><a href="#ç®—æ³•æµç¨‹å›¾" class="headerlink" title="ç®—æ³•æµç¨‹å›¾"></a>ç®—æ³•æµç¨‹å›¾</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs awk">è¯·æ±‚URL: <span class="hljs-regexp">/api/</span>v1<span class="hljs-regexp">/users/</span><span class="hljs-number">123</span><span class="hljs-regexp">/profile/</span><br>                â†“<br>        [ç¬¬<span class="hljs-number">1</span>å±‚] æ ¹è§£æå™¨ <span class="hljs-string">r&#x27;^/&#x27;</span><br>         åŒ¹é…æˆåŠŸï¼Œå‰©ä½™ï¼šapi<span class="hljs-regexp">/v1/u</span>sers<span class="hljs-regexp">/123/</span>profile/<br>                â†“<br>        [ç¬¬<span class="hljs-number">2</span>å±‚] APIè§£æå™¨ <span class="hljs-string">r&#x27;^api/v(\d+)/&#x27;</span><br>         åŒ¹é…æˆåŠŸï¼Œå‰©ä½™ï¼šusers<span class="hljs-regexp">/123/</span>profile/<br>         æ•è·å‚æ•°ï¼šversion=<span class="hljs-string">&#x27;1&#x27;</span><br>                â†“<br>        [ç¬¬<span class="hljs-number">3</span>å±‚] Usersè§£æå™¨ <span class="hljs-string">r&#x27;^users/&#x27;</span><br>         åŒ¹é…æˆåŠŸï¼Œå‰©ä½™ï¼š<span class="hljs-number">123</span><span class="hljs-regexp">/profile/</span><br>                â†“<br>        [ç¬¬<span class="hljs-number">4</span>å±‚] Profileæ¨¡å¼ <span class="hljs-string">r&#x27;^(?P&lt;user_id&gt;\d+)/profile/$&#x27;</span><br>         åŒ¹é…æˆåŠŸï¼Œå‰©ä½™ï¼šç©º<br>         æ•è·å‚æ•°ï¼šuser_id=<span class="hljs-string">&#x27;123&#x27;</span><br>                â†“<br>        æœ€ç»ˆç»“æœï¼šviews.profile(request, version=<span class="hljs-string">&#x27;1&#x27;</span>, user_id=<span class="hljs-string">&#x27;123&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="å…·ä½“ç¤ºä¾‹è¯´æ˜"><a href="#å…·ä½“ç¤ºä¾‹è¯´æ˜" class="headerlink" title="å…·ä½“ç¤ºä¾‹è¯´æ˜"></a>å…·ä½“ç¤ºä¾‹è¯´æ˜</h2><h3 id="1-URLé…ç½®ç»“æ„"><a href="#1-URLé…ç½®ç»“æ„" class="headerlink" title="1. URLé…ç½®ç»“æ„"></a>1. URLé…ç½®ç»“æ„</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¸»urls.py (æ ¹URLconf)</span><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^admin/&#x27;</span>, admin.site.urls),<br>    url(<span class="hljs-string">r&#x27;^api/v(\d+)/&#x27;</span>, include(<span class="hljs-string">&#x27;api.urls&#x27;</span>)),  <span class="hljs-comment"># APIç‰ˆæœ¬æ§åˆ¶</span><br>    url(<span class="hljs-string">r&#x27;^blog/&#x27;</span>, include(<span class="hljs-string">&#x27;blog.urls&#x27;</span>)),<br>]<br><br><span class="hljs-comment"># api/urls.py</span><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^users/&#x27;</span>, include(<span class="hljs-string">&#x27;users.urls&#x27;</span>)),<br>    url(<span class="hljs-string">r&#x27;^posts/&#x27;</span>, include(<span class="hljs-string">&#x27;posts.urls&#x27;</span>)),<br>]<br><br><span class="hljs-comment"># users/urls.py</span><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^$&#x27;</span>, views.user_list, name=<span class="hljs-string">&#x27;user-list&#x27;</span>),<br>    url(<span class="hljs-string">r&#x27;^(?P&lt;user_id&gt;\d+)/$&#x27;</span>, views.user_detail, name=<span class="hljs-string">&#x27;user-detail&#x27;</span>),<br>    url(<span class="hljs-string">r&#x27;^(?P&lt;user_id&gt;\d+)/profile/$&#x27;</span>, views.user_profile, name=<span class="hljs-string">&#x27;user-profile&#x27;</span>),<br>]<br></code></pre></td></tr></table></figure><h3 id="2-åŒ¹é…è¿‡ç¨‹è¯¦è§£"><a href="#2-åŒ¹é…è¿‡ç¨‹è¯¦è§£" class="headerlink" title="2. åŒ¹é…è¿‡ç¨‹è¯¦è§£"></a>2. åŒ¹é…è¿‡ç¨‹è¯¦è§£</h3><p>å½“ç”¨æˆ·è®¿é—® <code>/api/v1/users/123/profile/</code> æ—¶ï¼š</p><h4 id="ç¬¬1æ­¥ï¼šæ ¹è§£æå™¨å¤„ç†"><a href="#ç¬¬1æ­¥ï¼šæ ¹è§£æå™¨å¤„ç†" class="headerlink" title="ç¬¬1æ­¥ï¼šæ ¹è§£æå™¨å¤„ç†"></a>ç¬¬1æ­¥ï¼šæ ¹è§£æå™¨å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># RegexURLResolver(r&#x27;^/&#x27;, ä¸»urls.py)</span><br>path = <span class="hljs-string">&#x27;/api/v1/users/123/profile/&#x27;</span><br><span class="hljs-keyword">match</span> = <span class="hljs-string">r&#x27;^/&#x27;</span>.search(path)  <span class="hljs-comment"># åŒ¹é…æˆåŠŸ</span><br>new_path = <span class="hljs-string">&#x27;api/v1/users/123/profile/&#x27;</span>  <span class="hljs-comment"># å»æ‰å¼€å¤´çš„ &#x27;/&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="ç¬¬2æ­¥ï¼šéå†ä¸»URLconfçš„æ¨¡å¼"><a href="#ç¬¬2æ­¥ï¼šéå†ä¸»URLconfçš„æ¨¡å¼" class="headerlink" title="ç¬¬2æ­¥ï¼šéå†ä¸»URLconfçš„æ¨¡å¼"></a>ç¬¬2æ­¥ï¼šéå†ä¸»URLconfçš„æ¨¡å¼</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> [admin_pattern, api_pattern, blog_pattern]:<br>    <span class="hljs-comment"># å°è¯• r&#x27;^api/v(\d+)/&#x27; æ¨¡å¼</span><br>    sub_match = api_pattern.resolve(<span class="hljs-string">&#x27;api/v1/users/123/profile/&#x27;</span>)<br></code></pre></td></tr></table></figure><h4 id="ç¬¬3æ­¥ï¼šAPIè§£æå™¨å¤„ç†"><a href="#ç¬¬3æ­¥ï¼šAPIè§£æå™¨å¤„ç†" class="headerlink" title="ç¬¬3æ­¥ï¼šAPIè§£æå™¨å¤„ç†"></a>ç¬¬3æ­¥ï¼šAPIè§£æå™¨å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># RegexURLResolver(r&#x27;^api/v(\d+)/&#x27;, &#x27;api.urls&#x27;)</span><br>path = <span class="hljs-string">&#x27;api/v1/users/123/profile/&#x27;</span><br><span class="hljs-keyword">match</span> = <span class="hljs-string">r&#x27;^api/v(\d+)/&#x27;</span>.search(path)  <span class="hljs-comment"># åŒ¹é…æˆåŠŸ</span><br><span class="hljs-comment"># æ•è·ç»„ï¼šgroups() = (&#x27;1&#x27;,)  # ç‰ˆæœ¬å·</span><br>new_path = <span class="hljs-string">&#x27;users/123/profile/&#x27;</span>  <span class="hljs-comment"># å‰©ä½™è·¯å¾„</span><br></code></pre></td></tr></table></figure><h4 id="ç¬¬4æ­¥ï¼šUsersè§£æå™¨å¤„ç†"><a href="#ç¬¬4æ­¥ï¼šUsersè§£æå™¨å¤„ç†" class="headerlink" title="ç¬¬4æ­¥ï¼šUsersè§£æå™¨å¤„ç†"></a>ç¬¬4æ­¥ï¼šUsersè§£æå™¨å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># RegexURLResolver(r&#x27;^users/&#x27;, &#x27;users.urls&#x27;) </span><br>path = <span class="hljs-string">&#x27;users/123/profile/&#x27;</span><br><span class="hljs-keyword">match</span> = <span class="hljs-string">r&#x27;^users/&#x27;</span>.search(path)  <span class="hljs-comment"># åŒ¹é…æˆåŠŸ</span><br>new_path = <span class="hljs-string">&#x27;123/profile/&#x27;</span>  <span class="hljs-comment"># å‰©ä½™è·¯å¾„</span><br></code></pre></td></tr></table></figure><h4 id="ç¬¬5æ­¥ï¼šProfileæ¨¡å¼åŒ¹é…"><a href="#ç¬¬5æ­¥ï¼šProfileæ¨¡å¼åŒ¹é…" class="headerlink" title="ç¬¬5æ­¥ï¼šProfileæ¨¡å¼åŒ¹é…"></a>ç¬¬5æ­¥ï¼šProfileæ¨¡å¼åŒ¹é…</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># RegexURLPattern(r&#x27;^(?P&lt;user_id&gt;\d+)/profile/$&#x27;, views.user_profile)</span><br>path = <span class="hljs-string">&#x27;123/profile/&#x27;</span><br><span class="hljs-keyword">match</span> = <span class="hljs-string">r&#x27;^(?P&lt;user_id&gt;\d+)/profile/$&#x27;</span>.search(path)  <span class="hljs-comment"># åŒ¹é…æˆåŠŸ</span><br><span class="hljs-comment"># å‘½åç»„ï¼šgroupdict() = &#123;&#x27;user_id&#x27;: &#x27;123&#x27;&#125;</span><br>new_path = <span class="hljs-string">&#x27;&#x27;</span>  <span class="hljs-comment"># å®Œå…¨åŒ¹é…ï¼Œæ— å‰©ä½™</span><br></code></pre></td></tr></table></figure><h4 id="ç¬¬6æ­¥ï¼šå‚æ•°åˆå¹¶"><a href="#ç¬¬6æ­¥ï¼šå‚æ•°åˆå¹¶" class="headerlink" title="ç¬¬6æ­¥ï¼šå‚æ•°åˆå¹¶"></a>ç¬¬6æ­¥ï¼šå‚æ•°åˆå¹¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åˆå¹¶æ‰€æœ‰å±‚çº§çš„å‚æ•°</span><br>final_args = (<span class="hljs-string">&#x27;1&#x27;</span>,)  <span class="hljs-comment"># æ¥è‡ªç¬¬3æ­¥çš„ä½ç½®å‚æ•°</span><br>final_kwargs = &#123;<span class="hljs-string">&#x27;user_id&#x27;</span>: <span class="hljs-string">&#x27;123&#x27;</span>&#125;  <span class="hljs-comment"># æ¥è‡ªç¬¬5æ­¥çš„å‘½åå‚æ•°</span><br><br><span class="hljs-comment"># åˆ›å»ºæœ€ç»ˆç»“æœ</span><br><span class="hljs-keyword">return</span> ResolverMatch(<br>    func=views.user_profile,<br>    args=(<span class="hljs-string">&#x27;1&#x27;</span>,),<br>    kwargs=&#123;<span class="hljs-string">&#x27;user_id&#x27;</span>: <span class="hljs-string">&#x27;123&#x27;</span>&#125;,<br>    url_name=<span class="hljs-string">&#x27;user-profile&#x27;</span>,<br>    app_names=[],<br>    namespaces=[]<br>)<br></code></pre></td></tr></table></figure><h2 id="å…³é”®ç®—æ³•ç‰¹ç‚¹"><a href="#å…³é”®ç®—æ³•ç‰¹ç‚¹" class="headerlink" title="å…³é”®ç®—æ³•ç‰¹ç‚¹"></a>å…³é”®ç®—æ³•ç‰¹ç‚¹</h2><h3 id="1-åˆ†å±‚åŒ¹é…ç­–ç•¥"><a href="#1-åˆ†å±‚åŒ¹é…ç­–ç•¥" class="headerlink" title="1. åˆ†å±‚åŒ¹é…ç­–ç•¥"></a>1. åˆ†å±‚åŒ¹é…ç­–ç•¥</h3><ul><li><strong>æ¯å±‚åªç®¡è‡ªå·±çš„äº‹</strong>ï¼šæ¯ä¸ªURLResolveråªåŒ¹é…è‡ªå·±çš„æ­£åˆ™è¡¨è¾¾å¼</li><li><strong>å‰©ä½™è·¯å¾„ä¼ é€’</strong>ï¼šåŒ¹é…æˆåŠŸåï¼Œå°†å‰©ä½™éƒ¨åˆ†ä¼ ç»™ä¸‹ä¸€å±‚</li><li><strong>é€’å½’å¤„ç†</strong>ï¼šé€šè¿‡ <code>pattern.resolve(new_path)</code> å®ç°é€’å½’</li></ul><h3 id="2-å‚æ•°å¤„ç†è§„åˆ™"><a href="#2-å‚æ•°å¤„ç†è§„åˆ™" class="headerlink" title="2. å‚æ•°å¤„ç†è§„åˆ™"></a>2. å‚æ•°å¤„ç†è§„åˆ™</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è§„åˆ™ï¼šæœ‰å‘½åå‚æ•°æ—¶ï¼Œå¿½ç•¥ä½ç½®å‚æ•°</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> sub_match_dict:  <span class="hljs-comment"># å¦‚æœæ²¡æœ‰å‘½åå‚æ•°</span><br>    sub_match_args = <span class="hljs-keyword">match</span>.groups() + sub_match.args  <span class="hljs-comment"># åˆå¹¶ä½ç½®å‚æ•°</span><br><span class="hljs-keyword">else</span>:  <span class="hljs-comment"># æœ‰å‘½åå‚æ•°</span><br>    sub_match_args = sub_match.args  <span class="hljs-comment"># åªä½¿ç”¨å­å±‚çš„ä½ç½®å‚æ•°</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹å¯¹æ¯”</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æƒ…å†µ1ï¼šæ··åˆå‚æ•°</span><br><span class="hljs-string">r&#x27;^api/v(\d+)/&#x27;</span>  â†’  <span class="hljs-string">r&#x27;^users/(?P&lt;user_id&gt;\d+)/$&#x27;</span><br><span class="hljs-comment"># ç»“æœï¼šargs=(), kwargs=&#123;&#x27;user_id&#x27;: &#x27;123&#x27;&#125;  # å¿½ç•¥ç‰ˆæœ¬å·ä½ç½®å‚æ•°</span><br><br><span class="hljs-comment"># æƒ…å†µ2ï¼šçº¯ä½ç½®å‚æ•°  </span><br><span class="hljs-string">r&#x27;^api/v(\d+)/&#x27;</span>  â†’  <span class="hljs-string">r&#x27;^users/(\d+)/$&#x27;</span><br><span class="hljs-comment"># ç»“æœï¼šargs=(&#x27;1&#x27;, &#x27;123&#x27;), kwargs=&#123;&#125;  # åˆå¹¶ä½ç½®å‚æ•°</span><br></code></pre></td></tr></table></figure><h3 id="3-é”™è¯¯è¿½è¸ªæœºåˆ¶"><a href="#3-é”™è¯¯è¿½è¸ªæœºåˆ¶" class="headerlink" title="3. é”™è¯¯è¿½è¸ªæœºåˆ¶"></a>3. é”™è¯¯è¿½è¸ªæœºåˆ¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è®°å½•æ‰€æœ‰å°è¯•è¿‡çš„æ¨¡å¼ï¼Œç”¨äºç”Ÿæˆ404é”™è¯¯ä¿¡æ¯</span><br>tried = []<br><span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.url_patterns:<br>    <span class="hljs-keyword">try</span>:<br>        sub_match = pattern.resolve(new_path)<br>    <span class="hljs-keyword">except</span> Resolver404 <span class="hljs-keyword">as</span> e:<br>        tried.extend([pattern] + t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> e.args[<span class="hljs-number">0</span>].get(<span class="hljs-string">&#x27;tried&#x27;</span>, []))<br></code></pre></td></tr></table></figure><h2 id="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"><a href="#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"></a>æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h2><h3 id="1-æ­£åˆ™è¡¨è¾¾å¼ç¼“å­˜"><a href="#1-æ­£åˆ™è¡¨è¾¾å¼ç¼“å­˜" class="headerlink" title="1. æ­£åˆ™è¡¨è¾¾å¼ç¼“å­˜"></a>1. æ­£åˆ™è¡¨è¾¾å¼ç¼“å­˜</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@cached_property  </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">regex</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">return</span> re.<span class="hljs-built_in">compile</span>(<span class="hljs-variable language_">self</span>._regex, re.UNICODE)<br></code></pre></td></tr></table></figure><h3 id="2-URLconfæ¨¡å—ç¼“å­˜"><a href="#2-URLconfæ¨¡å—ç¼“å­˜" class="headerlink" title="2. URLconfæ¨¡å—ç¼“å­˜"></a>2. URLconfæ¨¡å—ç¼“å­˜</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@lru_cache.lru_cache(<span class="hljs-params">maxsize=<span class="hljs-literal">None</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_resolver</span>(<span class="hljs-params">urlconf=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">return</span> RegexURLResolver(<span class="hljs-string">r&#x27;^/&#x27;</span>, urlconf)<br></code></pre></td></tr></table></figure><h3 id="3-åå‘æŸ¥æ‰¾å­—å…¸é¢„æ„å»º"><a href="#3-åå‘æŸ¥æ‰¾å­—å…¸é¢„æ„å»º" class="headerlink" title="3. åå‘æŸ¥æ‰¾å­—å…¸é¢„æ„å»º"></a>3. åå‘æŸ¥æ‰¾å­—å…¸é¢„æ„å»º</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_populate</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-comment"># ä¸€æ¬¡æ€§æ„å»ºæ‰€æœ‰åå‘æŸ¥æ‰¾å­—å…¸</span><br>    <span class="hljs-comment"># é¿å…è¿è¡Œæ—¶é‡å¤è®¡ç®—</span><br></code></pre></td></tr></table></figure><h2 id="å®é™…åº”ç”¨åœºæ™¯"><a href="#å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="å®é™…åº”ç”¨åœºæ™¯"></a>å®é™…åº”ç”¨åœºæ™¯</h2><h3 id="å¤æ‚åµŒå¥—URL"><a href="#å¤æ‚åµŒå¥—URL" class="headerlink" title="å¤æ‚åµŒå¥—URL"></a>å¤æ‚åµŒå¥—URL</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç”µå•†ç½‘ç«™ç¤ºä¾‹</span><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^shop/&#x27;</span>, include([<br>        url(<span class="hljs-string">r&#x27;^categories/(?P&lt;cat_id&gt;\d+)/&#x27;</span>, include([<br>            url(<span class="hljs-string">r&#x27;^products/&#x27;</span>, include([<br>                url(<span class="hljs-string">r&#x27;^(?P&lt;product_id&gt;\d+)/&#x27;</span>, include([<br>                    url(<span class="hljs-string">r&#x27;^$&#x27;</span>, views.product_detail),<br>                    url(<span class="hljs-string">r&#x27;^reviews/$&#x27;</span>, views.product_reviews),<br>                    url(<span class="hljs-string">r&#x27;^buy/$&#x27;</span>, views.purchase),<br>                ])),<br>            ])),<br>        ])),<br>    ])),<br>]<br><br><span class="hljs-comment"># URL: /shop/categories/5/products/123/reviews/</span><br><span class="hljs-comment"># æœ€ç»ˆè°ƒç”¨: views.product_reviews(request, cat_id=&#x27;5&#x27;, product_id=&#x27;123&#x27;)</span><br></code></pre></td></tr></table></figure><h3 id="å‘½åç©ºé—´æ”¯æŒ"><a href="#å‘½åç©ºé—´æ”¯æŒ" class="headerlink" title="å‘½åç©ºé—´æ”¯æŒ"></a>å‘½åç©ºé—´æ”¯æŒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¤šç‰ˆæœ¬API</span><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^api/v1/&#x27;</span>, include(<span class="hljs-string">&#x27;api.v1.urls&#x27;</span>, namespace=<span class="hljs-string">&#x27;v1&#x27;</span>)),<br>    url(<span class="hljs-string">r&#x27;^api/v2/&#x27;</span>, include(<span class="hljs-string">&#x27;api.v2.urls&#x27;</span>, namespace=<span class="hljs-string">&#x27;v2&#x27;</span>)),<br>]<br><br><span class="hljs-comment"># åå‘è§£æ</span><br>reverse(<span class="hljs-string">&#x27;v1:user-list&#x27;</span>)  <span class="hljs-comment"># /api/v1/users/</span><br>reverse(<span class="hljs-string">&#x27;v2:user-list&#x27;</span>)  <span class="hljs-comment"># /api/v2/users/</span><br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Djangoçš„URLåŒ¹é…ç®—æ³•æ ¸å¿ƒæ˜¯<strong>åˆ†å±‚é€’å½’</strong>ï¼š</p><ol><li><strong>åˆ†å±‚</strong>ï¼šå°†å¤æ‚URLåˆ†è§£ä¸ºå¤šä¸ªç®€å•å±‚çº§</li><li><strong>é€’å½’</strong>ï¼šæ¯å±‚å¤„ç†è‡ªå·±çš„éƒ¨åˆ†ï¼Œé€’å½’å¤„ç†å‰©ä½™éƒ¨åˆ†  </li><li><strong>é«˜æ•ˆ</strong>ï¼šé€šè¿‡ç¼“å­˜å’Œé¢„ç¼–è¯‘æå‡æ€§èƒ½</li><li><strong>çµæ´»</strong>ï¼šæ”¯æŒå¤æ‚åµŒå¥—å’Œå‘½åç©ºé—´</li><li><strong>è°ƒè¯•å‹å¥½</strong>ï¼šå®Œæ•´è®°å½•åŒ¹é…å°è¯•è¿‡ç¨‹</li></ol><p>è¿™ç§è®¾è®¡è®©Djangoèƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†å„ç§å¤æ‚çš„URLç»“æ„ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django MultiPartParser</title>
    <link href="/2025/07/17/Django-MultiPartParser/"/>
    <url>/2025/07/17/Django-MultiPartParser/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Djangoçš„ <code>MultiPartParser</code> æ˜¯å¤„ç† <code>multipart/form-data</code> æ ¼å¼æ•°æ®çš„æ ¸å¿ƒç»„ä»¶ï¼Œä¸»è¦ç”¨äºå¤„ç†HTMLè¡¨å•çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚å®ƒå®ç°äº†ç¬¦åˆRFC 2388æ ‡å‡†çš„å¤šéƒ¨åˆ†æ•°æ®è§£æï¼Œæä¾›äº†å¼ºå¤§çš„å®‰å…¨é˜²æŠ¤å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</p><h2 id="æ ¸å¿ƒç»„ä»¶æ¶æ„"><a href="#æ ¸å¿ƒç»„ä»¶æ¶æ„" class="headerlink" title="æ ¸å¿ƒç»„ä»¶æ¶æ„"></a>æ ¸å¿ƒç»„ä»¶æ¶æ„</h2><h3 id="1-ä¸»è¦ç±»ç»“æ„"><a href="#1-ä¸»è¦ç±»ç»“æ„" class="headerlink" title="1. ä¸»è¦ç±»ç»“æ„"></a>1. ä¸»è¦ç±»ç»“æ„</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¼‚å¸¸ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiPartParserError</span>(<span class="hljs-title class_ inherited__">Exception</span>)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">InputStreamExhausted</span>(<span class="hljs-title class_ inherited__">Exception</span>)<br><br><span class="hljs-comment"># æ ¸å¿ƒè§£æå™¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiPartParser</span>(<span class="hljs-title class_ inherited__">object</span>)<br><br><span class="hljs-comment"># æµå¤„ç†ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyStream</span>(six.Iterator)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChunkIter</span>(six.Iterator)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">InterBoundaryIter</span>(six.Iterator)  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BoundaryIter</span>(six.Iterator)<br><br><span class="hljs-comment"># è§£æå™¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parser</span>(<span class="hljs-title class_ inherited__">object</span>)<br></code></pre></td></tr></table></figure><h3 id="2-æ•°æ®ç±»å‹å¸¸é‡"><a href="#2-æ•°æ®ç±»å‹å¸¸é‡" class="headerlink" title="2. æ•°æ®ç±»å‹å¸¸é‡"></a>2. æ•°æ®ç±»å‹å¸¸é‡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">RAW = <span class="hljs-string">&quot;raw&quot;</span>      <span class="hljs-comment"># åŸå§‹æ•°æ®</span><br>FILE = <span class="hljs-string">&quot;file&quot;</span>    <span class="hljs-comment"># æ–‡ä»¶å­—æ®µ</span><br>FIELD = <span class="hljs-string">&quot;field&quot;</span>  <span class="hljs-comment"># æ™®é€šè¡¨å•å­—æ®µ</span><br></code></pre></td></tr></table></figure><h2 id="MultiPartParser-æ ¸å¿ƒåŠŸèƒ½"><a href="#MultiPartParser-æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="MultiPartParser æ ¸å¿ƒåŠŸèƒ½"></a>MultiPartParser æ ¸å¿ƒåŠŸèƒ½</h2><h3 id="åˆå§‹åŒ–è¿‡ç¨‹"><a href="#åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="åˆå§‹åŒ–è¿‡ç¨‹"></a>åˆå§‹åŒ–è¿‡ç¨‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, META, input_data, upload_handlers, encoding=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-comment"># 1. éªŒè¯Content-Type</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> content_type.startswith(<span class="hljs-string">&#x27;multipart/&#x27;</span>):<br>        <span class="hljs-keyword">raise</span> MultiPartParserError(<span class="hljs-string">&#x27;Invalid Content-Type&#x27;</span>)<br>    <br>    <span class="hljs-comment"># 2. è§£æboundaryåˆ†éš”ç¬¦</span><br>    ctypes, opts = parse_header(content_type.encode(<span class="hljs-string">&#x27;ascii&#x27;</span>))<br>    boundary = opts.get(<span class="hljs-string">&#x27;boundary&#x27;</span>)<br>    <br>    <span class="hljs-comment"># 3. éªŒè¯boundaryæœ‰æ•ˆæ€§</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> boundary <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> cgi.valid_boundary(boundary):<br>        <span class="hljs-keyword">raise</span> MultiPartParserError(<span class="hljs-string">&#x27;Invalid boundary&#x27;</span>)<br>    <br>    <span class="hljs-comment"># 4. è·å–å†…å®¹é•¿åº¦å¹¶éªŒè¯</span><br>    content_length = <span class="hljs-built_in">int</span>(META.get(<span class="hljs-string">&#x27;CONTENT_LENGTH&#x27;</span>, <span class="hljs-number">0</span>))<br>    <span class="hljs-keyword">if</span> content_length &lt; <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">raise</span> MultiPartParserError(<span class="hljs-string">&quot;Invalid content length&quot;</span>)<br>    <br>    <span class="hljs-comment"># 5. è®¾ç½®chunk_sizeï¼ˆå…¼å®¹32ä½ç³»ç»Ÿï¼‰</span><br>    <span class="hljs-variable language_">self</span>._chunk_size = <span class="hljs-built_in">min</span>([<span class="hljs-number">2</span> ** <span class="hljs-number">31</span> - <span class="hljs-number">4</span>] + possible_sizes)<br></code></pre></td></tr></table></figure><h3 id="è§£ææµç¨‹"><a href="#è§£ææµç¨‹" class="headerlink" title="è§£ææµç¨‹"></a>è§£ææµç¨‹</h3><ol><li><strong>é¢„å¤„ç†æ£€æŸ¥</strong>ï¼šå†…å®¹é•¿åº¦éªŒè¯ã€å¤„ç†å™¨æ£€æŸ¥</li><li><strong>æµå¼è§£æ</strong>ï¼šåˆ›å»ºLazyStreamè¿›è¡Œé€å—è¯»å–</li><li><strong>è¾¹ç•Œåˆ†å‰²</strong>ï¼šä½¿ç”¨boundaryåˆ†å‰²å„ä¸ªå­—æ®µ</li><li><strong>ç±»å‹è¯†åˆ«</strong>ï¼šåŒºåˆ†æ™®é€šå­—æ®µ(FIELD)å’Œæ–‡ä»¶å­—æ®µ(FILE)</li><li><strong>æ•°æ®å¤„ç†</strong>ï¼šåˆ†åˆ«å¤„ç†æ–‡æœ¬æ•°æ®å’Œæ–‡ä»¶æ•°æ®</li><li><strong>ç»“æœç”Ÿæˆ</strong>ï¼šè¿”å›POSTå’ŒFILESå­—å…¸</li></ol><h2 id="å®‰å…¨é˜²æŠ¤æœºåˆ¶"><a href="#å®‰å…¨é˜²æŠ¤æœºåˆ¶" class="headerlink" title="å®‰å…¨é˜²æŠ¤æœºåˆ¶"></a>å®‰å…¨é˜²æŠ¤æœºåˆ¶</h2><h3 id="1-å­—æ®µæ•°é‡é™åˆ¶"><a href="#1-å­—æ®µæ•°é‡é™åˆ¶" class="headerlink" title="1. å­—æ®µæ•°é‡é™åˆ¶"></a>1. å­—æ®µæ•°é‡é™åˆ¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é˜²æ­¢DoSæ”»å‡»</span><br><span class="hljs-keyword">if</span> (settings.DATA_UPLOAD_MAX_NUMBER_FIELDS <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span><br>        settings.DATA_UPLOAD_MAX_NUMBER_FIELDS &lt; num_post_keys):<br>    <span class="hljs-keyword">raise</span> TooManyFieldsSent(<span class="hljs-string">&#x27;Too many fields&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="2-å†…å­˜ä½¿ç”¨é™åˆ¶"><a href="#2-å†…å­˜ä½¿ç”¨é™åˆ¶" class="headerlink" title="2. å†…å­˜ä½¿ç”¨é™åˆ¶"></a>2. å†…å­˜ä½¿ç”¨é™åˆ¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é˜²æ­¢å†…å­˜è€—å°½</span><br><span class="hljs-keyword">if</span> (settings.DATA_UPLOAD_MAX_MEMORY_SIZE <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span><br>        num_bytes_read &gt; settings.DATA_UPLOAD_MAX_MEMORY_SIZE):<br>    <span class="hljs-keyword">raise</span> RequestDataTooBig(<span class="hljs-string">&#x27;Request body exceeded memory limit&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="3-IEæ–‡ä»¶åå®‰å…¨åŒ–"><a href="#3-IEæ–‡ä»¶åå®‰å…¨åŒ–" class="headerlink" title="3. IEæ–‡ä»¶åå®‰å…¨åŒ–"></a>3. IEæ–‡ä»¶åå®‰å…¨åŒ–</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">IE_sanitize</span>(<span class="hljs-params">self, filename</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å¤„ç†IEçš„å®Œæ•´è·¯å¾„é—®é¢˜&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> filename <span class="hljs-keyword">and</span> filename[filename.rfind(<span class="hljs-string">&quot;\\&quot;</span>) + <span class="hljs-number">1</span>:].strip()<br></code></pre></td></tr></table></figure><p><strong>é—®é¢˜èƒŒæ™¯</strong>ï¼šæ—©æœŸIEæµè§ˆå™¨ä¼šåœ¨filenameå­—æ®µä¸­åŒ…å«å®Œæ•´çš„æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼Œå¦‚ï¼š</p><ul><li>æ­£å¸¸ï¼š<code>filename=&quot;document.pdf&quot;</code></li><li>IEé—®é¢˜ï¼š<code>filename=&quot;C:\Users\John\Documents\document.pdf&quot;</code></li></ul><p><strong>å®‰å…¨é£é™©</strong>ï¼š</p><ul><li>è·¯å¾„ä¿¡æ¯æ³„éœ²</li><li>ç›®å½•éå†æ”»å‡»</li><li>ç³»ç»Ÿä¿¡æ¯æš´éœ²</li></ul><h3 id="4-æ¶æ„MIMEè¯·æ±‚æ£€æµ‹"><a href="#4-æ¶æ„MIMEè¯·æ±‚æ£€æµ‹" class="headerlink" title="4. æ¶æ„MIMEè¯·æ±‚æ£€æµ‹"></a>4. æ¶æ„MIMEè¯·æ±‚æ£€æµ‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_update_unget_history</span>(<span class="hljs-params">self, num_bytes</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ£€æµ‹æ¶æ„æ„é€ çš„MIMEè¯·æ±‚&quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>._unget_history = [num_bytes] + <span class="hljs-variable language_">self</span>._unget_history[:<span class="hljs-number">49</span>]<br>    number_equal = <span class="hljs-built_in">len</span>([n <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>._unget_history <span class="hljs-keyword">if</span> n == num_bytes])<br>    <br>    <span class="hljs-keyword">if</span> number_equal &gt; <span class="hljs-number">40</span>:<br>        <span class="hljs-keyword">raise</span> SuspiciousMultipartForm(<br>            <span class="hljs-string">&quot;The multipart parser got stuck, which shouldn&#x27;t happen with&quot;</span><br>            <span class="hljs-string">&quot; normal uploaded files. Check for malicious upload activity&quot;</span><br>        )<br></code></pre></td></tr></table></figure><p><strong>æ¶æ„è¯·æ±‚ç±»å‹</strong>ï¼š</p><ul><li>æ— é™å¾ªç¯æ”»å‡»ï¼šæ„é€ é”™è¯¯è¾¹ç•Œå¯¼è‡´è§£æå™¨å¾ªç¯</li><li>å†…å­˜è€—å°½æ”»å‡»ï¼šå·¨å¤§æ•°æ®å—ä½†æ ¼å¼é”™è¯¯</li><li>CPUè€—å°½æ”»å‡»ï¼šè®¡ç®—å¯†é›†çš„è§£æå¾ªç¯</li><li>è¾¹ç•Œæ··æ·†æ”»å‡»ï¼šæ•…æ„æ„é€ æ¨¡ç³Šçš„è¾¹ç•Œæ ‡è¯†</li></ul><p><strong>æ£€æµ‹åŸç†</strong>ï¼šç›‘æ§<code>unget</code>æ“ä½œé¢‘ç‡ï¼ŒåŒæ ·å¤§å°çš„æ•°æ®è¢«è¿”å›è¶…è¿‡40æ¬¡æ—¶åˆ¤å®šä¸ºæ”»å‡»ã€‚</p><h2 id="Boundary-æœºåˆ¶è¯¦è§£"><a href="#Boundary-æœºåˆ¶è¯¦è§£" class="headerlink" title="Boundary æœºåˆ¶è¯¦è§£"></a>Boundary æœºåˆ¶è¯¦è§£</h2><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>Boundaryæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ†éš”ç¬¦ï¼Œç”¨äºåˆ†å‰²multipartæ•°æ®ä¸­çš„å„ä¸ªå­—æ®µã€‚</p><p><strong>æ ¼å¼ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW<br><br>------WebKitFormBoundary7MA4YWxkTrZu0gW<br><span class="hljs-attribute">Content-Disposition</span><span class="hljs-punctuation">: </span>form-data; name=&quot;username&quot;<br><br>john<br>------WebKitFormBoundary7MA4YWxkTrZu0gW<br><span class="hljs-attribute">Content-Disposition</span><span class="hljs-punctuation">: </span>form-data; name=&quot;avatar&quot;; filename=&quot;photo.jpg&quot;<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>image/jpeg<br><br>[äºŒè¿›åˆ¶æ–‡ä»¶æ•°æ®]<br>------WebKitFormBoundary7MA4YWxkTrZu0gW--<br></code></pre></td></tr></table></figure><h3 id="æŸ¥æ‰¾ç®—æ³•"><a href="#æŸ¥æ‰¾ç®—æ³•" class="headerlink" title="æŸ¥æ‰¾ç®—æ³•"></a>æŸ¥æ‰¾ç®—æ³•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_find_boundary</span>(<span class="hljs-params">self, data, eof=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;åœ¨æ•°æ®ä¸­æŸ¥æ‰¾multipartè¾¹ç•Œ&quot;&quot;&quot;</span><br>    index = data.find(<span class="hljs-variable language_">self</span>._boundary)<br>    <span class="hljs-keyword">if</span> index &lt; <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">else</span>:<br>        end = index<br>        <span class="hljs-built_in">next</span> = index + <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>._boundary)<br>        <br>        <span class="hljs-comment"># å¤„ç†CRLFæ¢è¡Œç¬¦</span><br>        <span class="hljs-keyword">if</span> data[end-<span class="hljs-number">1</span>:end] == <span class="hljs-string">b&#x27;\n&#x27;</span>:<br>            end -= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> data[end-<span class="hljs-number">1</span>:end] == <span class="hljs-string">b&#x27;\r&#x27;</span>:<br>            end -= <span class="hljs-number">1</span><br>        <br>        <span class="hljs-keyword">return</span> end, <span class="hljs-built_in">next</span><br></code></pre></td></tr></table></figure><h3 id="éƒ¨åˆ†è¾¹ç•Œå¤„ç†"><a href="#éƒ¨åˆ†è¾¹ç•Œå¤„ç†" class="headerlink" title="éƒ¨åˆ†è¾¹ç•Œå¤„ç†"></a>éƒ¨åˆ†è¾¹ç•Œå¤„ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é—®é¢˜ï¼šæ•°æ®å—å¯èƒ½åœ¨boundaryä¸­é—´è¢«åˆ‡æ–­</span><br><span class="hljs-comment"># è§£å†³ï¼šrollbackæœºåˆ¶</span><br><span class="hljs-variable language_">self</span>._rollback = <span class="hljs-built_in">len</span>(boundary) + <span class="hljs-number">6</span><br><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> boundary_found:<br>    stream.unget(chunk[-rollback:])  <span class="hljs-comment"># ä¿ç•™å¯èƒ½çš„éƒ¨åˆ†boundary</span><br>    <span class="hljs-keyword">return</span> chunk[:-rollback]         <span class="hljs-comment"># è¿”å›ç¡®å®šçš„æ•°æ®éƒ¨åˆ†</span><br></code></pre></td></tr></table></figure><h2 id="æµå¤„ç†æ¶æ„"><a href="#æµå¤„ç†æ¶æ„" class="headerlink" title="æµå¤„ç†æ¶æ„"></a>æµå¤„ç†æ¶æ„</h2><h3 id="LazyStream-æ‡’åŠ è½½æµ"><a href="#LazyStream-æ‡’åŠ è½½æµ" class="headerlink" title="LazyStream æ‡’åŠ è½½æµ"></a>LazyStream æ‡’åŠ è½½æµ</h3><ul><li><strong>åŠŸèƒ½</strong>ï¼šæ”¯æŒæ•°æ®çš„è¯»å–å’Œâ€å½’è¿˜â€(unget)</li><li><strong>ç‰¹ç‚¹</strong>ï¼šæŒ‰éœ€è¯»å–ï¼Œå†…å­˜å‹å¥½</li><li><strong>å®‰å…¨</strong>ï¼šæ¶æ„è¯·æ±‚æ£€æµ‹æœºåˆ¶</li></ul><h3 id="ChunkIter-å—è¿­ä»£å™¨"><a href="#ChunkIter-å—è¿­ä»£å™¨" class="headerlink" title="ChunkIter å—è¿­ä»£å™¨"></a>ChunkIter å—è¿­ä»£å™¨</h3><ul><li><strong>åŠŸèƒ½</strong>ï¼šåˆ†å—è¯»å–å¤§æ–‡ä»¶</li><li><strong>é»˜è®¤å—å¤§å°</strong>ï¼š64KB</li><li><strong>ä¼˜åŠ¿</strong>ï¼šé¿å…å¤§æ–‡ä»¶ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜</li></ul><h3 id="BoundaryIter-è¾¹ç•Œæ•æ„Ÿè¿­ä»£å™¨"><a href="#BoundaryIter-è¾¹ç•Œæ•æ„Ÿè¿­ä»£å™¨" class="headerlink" title="BoundaryIter è¾¹ç•Œæ•æ„Ÿè¿­ä»£å™¨"></a>BoundaryIter è¾¹ç•Œæ•æ„Ÿè¿­ä»£å™¨</h3><ul><li><strong>åŠŸèƒ½</strong>ï¼šè¯†åˆ«å’Œå¤„ç†multipartè¾¹ç•Œ</li><li><strong>å¤„ç†</strong>ï¼šè¾¹ç•Œå‰çš„æ•°æ®ã€è¾¹ç•Œæœ¬èº«ã€è¾¹ç•Œåçš„æ•°æ®</li><li><strong>ç®—æ³•</strong>ï¼šç²¾ç¡®çš„è¾¹ç•Œå®šä½å’Œæ•°æ®åˆ†å‰²</li></ul><h2 id="æ–‡ä»¶ä¸Šä¼ å¤„ç†"><a href="#æ–‡ä»¶ä¸Šä¼ å¤„ç†" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ å¤„ç†"></a>æ–‡ä»¶ä¸Šä¼ å¤„ç†</h2><h3 id="å¤„ç†å™¨é“¾æœºåˆ¶"><a href="#å¤„ç†å™¨é“¾æœºåˆ¶" class="headerlink" title="å¤„ç†å™¨é“¾æœºåˆ¶"></a>å¤„ç†å™¨é“¾æœºåˆ¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¯æ’æ‹”çš„æ–‡ä»¶ä¸Šä¼ å¤„ç†å™¨</span><br><span class="hljs-keyword">for</span> handler <span class="hljs-keyword">in</span> handlers:<br>    handler.new_file(field_name, file_name, content_type, ...)<br>    <br><span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> field_stream:<br>    <span class="hljs-keyword">for</span> handler <span class="hljs-keyword">in</span> handlers:<br>        chunk = handler.receive_data_chunk(chunk, counter)<br>        <br><span class="hljs-keyword">for</span> handler <span class="hljs-keyword">in</span> handlers:<br>    file_obj = handler.file_complete(counter)<br></code></pre></td></tr></table></figure><h3 id="Base64ä¼ è¾“ç¼–ç æ”¯æŒ"><a href="#Base64ä¼ è¾“ç¼–ç æ”¯æŒ" class="headerlink" title="Base64ä¼ è¾“ç¼–ç æ”¯æŒ"></a>Base64ä¼ è¾“ç¼–ç æ”¯æŒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> transfer_encoding == <span class="hljs-string">&#x27;base64&#x27;</span>:<br>    <span class="hljs-comment"># ç¡®ä¿base64å—æ˜¯4çš„å€æ•°</span><br>    stripped_chunk = <span class="hljs-string">b&quot;&quot;</span>.join(chunk.split())<br>    remaining = <span class="hljs-built_in">len</span>(stripped_chunk) % <span class="hljs-number">4</span><br>    <span class="hljs-keyword">while</span> remaining != <span class="hljs-number">0</span>:<br>        over_chunk = field_stream.read(<span class="hljs-number">4</span> - remaining)<br>        stripped_chunk += <span class="hljs-string">b&quot;&quot;</span>.join(over_chunk.split())<br>        remaining = <span class="hljs-built_in">len</span>(stripped_chunk) % <span class="hljs-number">4</span><br>    <br>    chunk = base64.b64decode(stripped_chunk)<br></code></pre></td></tr></table></figure><h2 id="æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§"><a href="#æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§"></a>æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§</h2><h3 id="1-å»¶è¿ŸåŠ è½½"><a href="#1-å»¶è¿ŸåŠ è½½" class="headerlink" title="1. å»¶è¿ŸåŠ è½½"></a>1. å»¶è¿ŸåŠ è½½</h3><ul><li>POSTå’ŒFILESå­—å…¸æŒ‰éœ€åˆ›å»º</li><li>æ–‡ä»¶å†…å®¹æµå¼å¤„ç†</li><li>é¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…</li></ul><h3 id="2-å†…å­˜ç®¡ç†"><a href="#2-å†…å­˜ç®¡ç†" class="headerlink" title="2. å†…å­˜ç®¡ç†"></a>2. å†…å­˜ç®¡ç†</h3><ul><li>åˆ†å—è¯»å–å¤§æ–‡ä»¶</li><li>åŠæ—¶é‡Šæ”¾æ–‡ä»¶å¥æŸ„</li><li>å†…å­˜ä½¿ç”¨ç›‘æ§å’Œé™åˆ¶</li></ul><h3 id="3-å¤„ç†å™¨ä¼˜åŒ–"><a href="#3-å¤„ç†å™¨ä¼˜åŒ–" class="headerlink" title="3. å¤„ç†å™¨ä¼˜åŒ–"></a>3. å¤„ç†å™¨ä¼˜åŒ–</h3><ul><li>å…è®¸å¤„ç†å™¨å®Œå…¨æ¥ç®¡è§£æè¿‡ç¨‹</li><li>æ”¯æŒæ—©æœŸåœæ­¢æœºåˆ¶(StopFutureHandlers)</li><li>é”™è¯¯æ—¶ä¼˜é›…é™çº§(SkipFile)</li></ul><h2 id="é”™è¯¯å¤„ç†æœºåˆ¶"><a href="#é”™è¯¯å¤„ç†æœºåˆ¶" class="headerlink" title="é”™è¯¯å¤„ç†æœºåˆ¶"></a>é”™è¯¯å¤„ç†æœºåˆ¶</h2><h3 id="å¼‚å¸¸ç±»å‹"><a href="#å¼‚å¸¸ç±»å‹" class="headerlink" title="å¼‚å¸¸ç±»å‹"></a>å¼‚å¸¸ç±»å‹</h3><ul><li><code>MultiPartParserError</code>ï¼šè§£æé”™è¯¯</li><li><code>RequestDataTooBig</code>ï¼šæ•°æ®è¿‡å¤§</li><li><code>TooManyFieldsSent</code>ï¼šå­—æ®µè¿‡å¤š</li><li><code>SuspiciousMultipartForm</code>ï¼šæ¶æ„è¯·æ±‚</li></ul><h3 id="æ¢å¤ç­–ç•¥"><a href="#æ¢å¤ç­–ç•¥" class="headerlink" title="æ¢å¤ç­–ç•¥"></a>æ¢å¤ç­–ç•¥</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_mark_post_parse_error</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ ‡è®°è§£æé”™è¯¯ï¼Œè®¾ç½®ç©ºå­—å…¸&quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>._post = QueryDict()<br>    <span class="hljs-variable language_">self</span>._files = MultiValueDict()<br>    <span class="hljs-variable language_">self</span>._post_parse_error = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><h3 id="èµ„æºæ¸…ç†"><a href="#èµ„æºæ¸…ç†" class="headerlink" title="èµ„æºæ¸…ç†"></a>èµ„æºæ¸…ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_close_files</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ç¡®ä¿æ–‡ä»¶å¥æŸ„æ­£ç¡®å…³é—­&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> handler <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>._upload_handlers:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(handler, <span class="hljs-string">&#x27;file&#x27;</span>):<br>            handler.file.close()<br></code></pre></td></tr></table></figure><h2 id="è®¾è®¡äº®ç‚¹æ€»ç»“"><a href="#è®¾è®¡äº®ç‚¹æ€»ç»“" class="headerlink" title="è®¾è®¡äº®ç‚¹æ€»ç»“"></a>è®¾è®¡äº®ç‚¹æ€»ç»“</h2><h3 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h3><ol><li><strong>å¤šå±‚é˜²æŠ¤</strong>ï¼šå­—æ®µé™åˆ¶ã€å†…å­˜é™åˆ¶ã€æ¶æ„è¯·æ±‚æ£€æµ‹</li><li><strong>æ–‡ä»¶åå®‰å…¨åŒ–</strong>ï¼šå¤„ç†IEè·¯å¾„é—®é¢˜</li><li><strong>è¾¹ç•ŒéªŒè¯</strong>ï¼šé˜²æ­¢æ³¨å…¥æ”»å‡»</li><li><strong>ç¼–ç å®‰å…¨</strong>ï¼šæ­£ç¡®å¤„ç†å„ç§å­—ç¬¦ç¼–ç </li></ol><h3 id="æ€§èƒ½"><a href="#æ€§èƒ½" class="headerlink" title="æ€§èƒ½"></a>æ€§èƒ½</h3><ol><li><strong>æµå¼å¤„ç†</strong>ï¼šæ”¯æŒå¤§æ–‡ä»¶è€Œä¸è€—å°½å†…å­˜</li><li><strong>æ‡’åŠ è½½</strong>ï¼šæŒ‰éœ€åˆ›å»ºå’Œè¯»å–</li><li><strong>å—ä¼˜åŒ–</strong>ï¼šæ™ºèƒ½é€‰æ‹©æœ€ä¼˜å—å¤§å°</li><li><strong>æ—©æœŸç»ˆæ­¢</strong>ï¼šæ”¯æŒå¤„ç†å™¨é“¾çš„ä¼˜åŒ–é€€å‡º</li></ol><h3 id="å¯æ‰©å±•æ€§"><a href="#å¯æ‰©å±•æ€§" class="headerlink" title="å¯æ‰©å±•æ€§"></a>å¯æ‰©å±•æ€§</h3><ol><li><strong>å¤„ç†å™¨é“¾</strong>ï¼šå¯æ’æ‹”çš„æ–‡ä»¶å¤„ç†æœºåˆ¶</li><li><strong>ç¼–ç æ”¯æŒ</strong>ï¼šå¤šç§ä¼ è¾“ç¼–ç </li><li><strong>æ ‡å‡†å…¼å®¹</strong>ï¼šå®Œæ•´çš„RFC 2388å®ç°</li><li><strong>é’©å­æœºåˆ¶</strong>ï¼šå…è®¸è‡ªå®šä¹‰å¤„ç†é€»è¾‘</li></ol><h3 id="é²æ£’æ€§"><a href="#é²æ£’æ€§" class="headerlink" title="é²æ£’æ€§"></a>é²æ£’æ€§</h3><ol><li><strong>é”™è¯¯æ¢å¤</strong>ï¼šå•ä¸ªé”™è¯¯ä¸å½±å“æ•´ä½“</li><li><strong>èµ„æºç®¡ç†</strong>ï¼šç¡®ä¿æ–‡ä»¶å¥æŸ„é‡Šæ”¾</li><li><strong>è¾¹ç•Œæƒ…å†µ</strong>ï¼šå¤„ç†å„ç§å¼‚å¸¸æ•°æ®æ ¼å¼</li><li><strong>å…¼å®¹æ€§</strong>ï¼šæ”¯æŒä¸åŒæµè§ˆå™¨çš„å·®å¼‚</li></ol><h2 id="å®é™…åº”ç”¨åœºæ™¯"><a href="#å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="å®é™…åº”ç”¨åœºæ™¯"></a>å®é™…åº”ç”¨åœºæ™¯</h2><ol><li><strong>HTMLè¡¨å•æ–‡ä»¶ä¸Šä¼ </strong>ï¼šæ ‡å‡†çš„Webæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½</li><li><strong>APIæ–‡ä»¶ä¼ è¾“</strong>ï¼šRESTful APIçš„æ–‡ä»¶ä¸Šä¼ æ¥å£</li><li><strong>æ‰¹é‡æ–‡ä»¶å¤„ç†</strong>ï¼šå¤šæ–‡ä»¶åŒæ—¶ä¸Šä¼ </li><li><strong>æ··åˆæ•°æ®æäº¤</strong>ï¼šæ–‡ä»¶å’Œè¡¨å•æ•°æ®æ··åˆæäº¤</li></ol><p>Djangoçš„MultiPartParseré€šè¿‡ç²¾å¿ƒè®¾è®¡çš„æ¶æ„å’Œå…¨é¢çš„å®‰å…¨æœºåˆ¶ï¼Œä¸ºWebåº”ç”¨æä¾›äº†å®‰å…¨ã€é«˜æ•ˆã€å¯é çš„æ–‡ä»¶ä¸Šä¼ å¤„ç†èƒ½åŠ›ï¼Œæ˜¯Djangoæ¡†æ¶ä¸­çš„ä¸€ä¸ªé‡è¦åŸºç¡€ç»„ä»¶ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django CSRFä¸­é—´ä»¶è§£æ</title>
    <link href="/2025/07/16/Django-CSRF%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%A7%A3%E6%9E%90/"/>
    <url>/2025/07/16/Django-CSRF%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h3 id="1-ä»€ä¹ˆæ˜¯CSRFæ”»å‡»"><a href="#1-ä»€ä¹ˆæ˜¯CSRFæ”»å‡»" class="headerlink" title="1. ä»€ä¹ˆæ˜¯CSRFæ”»å‡»"></a>1. <strong>ä»€ä¹ˆæ˜¯CSRFæ”»å‡»</strong></h3><p>CSRFï¼ˆCross-Site Request Forgeryï¼‰æ˜¯ä¸€ç§Webå®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…è¯±å¯¼ç”¨æˆ·åœ¨å·²ç™»å½•çš„ç½‘ç«™ä¸Šæ‰§è¡Œéé¢„æœŸçš„æ“ä½œã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- æ¶æ„ç½‘ç«™çš„é¡µé¢ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;https://bank.com/transfer&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:none;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;to&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;attacker@evil.com&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;amount&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;10000&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-property">forms</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">submit</span>();</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœç”¨æˆ·åœ¨é“¶è¡Œç½‘ç«™å·²ç™»å½•ï¼Œè¿™ä¸ªè¡¨å•ä¼šè‡ªåŠ¨æäº¤ï¼Œè½¬è´¦ç»™æ”»å‡»è€…ã€‚</p><h3 id="2-Djangoçš„CSRFä¿æŠ¤æœºåˆ¶"><a href="#2-Djangoçš„CSRFä¿æŠ¤æœºåˆ¶" class="headerlink" title="2. Djangoçš„CSRFä¿æŠ¤æœºåˆ¶"></a>2. <strong>Djangoçš„CSRFä¿æŠ¤æœºåˆ¶</strong></h3><h4 id="2-1-åŒé‡TokenéªŒè¯"><a href="#2-1-åŒé‡TokenéªŒè¯" class="headerlink" title="2.1 åŒé‡TokenéªŒè¯"></a>2.1 åŒé‡TokenéªŒè¯</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1. æœåŠ¡å™¨ç”Ÿæˆå¯†é’¥å¹¶å­˜å‚¨</span><br>csrf_secret = _get_new_csrf_string()  <span class="hljs-comment"># 32ä½éšæœºå­—ç¬¦ä¸²</span><br>request.META[<span class="hljs-string">&quot;CSRF_COOKIE&quot;</span>] = _salt_cipher_secret(csrf_secret)<br><br><span class="hljs-comment"># 2. æ¯æ¬¡è¡¨å•è¯·æ±‚éƒ½ç”Ÿæˆæ–°çš„Token</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_token</span>(<span class="hljs-params">request</span>):<br>    csrf_secret = _unsalt_cipher_token(request.META[<span class="hljs-string">&quot;CSRF_COOKIE&quot;</span>])<br>    <span class="hljs-keyword">return</span> _salt_cipher_secret(csrf_secret)  <span class="hljs-comment"># æ¯æ¬¡éƒ½ä¸åŒ</span><br></code></pre></td></tr></table></figure><h4 id="2-2-SaltåŠ å¯†æœºåˆ¶"><a href="#2-2-SaltåŠ å¯†æœºåˆ¶" class="headerlink" title="2.2 SaltåŠ å¯†æœºåˆ¶"></a>2.2 SaltåŠ å¯†æœºåˆ¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_salt_cipher_secret</span>(<span class="hljs-params">secret</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ä½¿ç”¨saltå¯¹å¯†é’¥è¿›è¡ŒåŠ å¯†&quot;&quot;&quot;</span><br>    salt = _get_new_csrf_string()  <span class="hljs-comment"># ç”Ÿæˆæ–°çš„salt</span><br>    chars = CSRF_ALLOWED_CHARS<br>    pairs = <span class="hljs-built_in">zip</span>((chars.index(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> secret), (chars.index(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> salt))<br>    cipher = <span class="hljs-string">&#x27;&#x27;</span>.join(chars[(x + y) % <span class="hljs-built_in">len</span>(chars)] <span class="hljs-keyword">for</span> x, y <span class="hljs-keyword">in</span> pairs)<br>    <span class="hljs-keyword">return</span> salt + cipher  <span class="hljs-comment"># salt + åŠ å¯†åçš„å¯†é’¥</span><br></code></pre></td></tr></table></figure><p><strong>åŠ å¯†è¿‡ç¨‹</strong>ï¼š</p><ul><li>ç”Ÿæˆ32ä½éšæœºsalt</li><li>å°†secretå’Œsaltå¯¹åº”å­—ç¬¦çš„ASCIIç ç›¸åŠ </li><li>ç»“æœå¯¹å­—ç¬¦é›†é•¿åº¦å–æ¨¡ï¼Œå¾—åˆ°æ–°å­—ç¬¦</li><li>è¿”å› <code>salt + åŠ å¯†ç»“æœ</code>ï¼ˆæ€»é•¿64ä½ï¼‰</li></ul><h3 id="3-æ ¸å¿ƒéªŒè¯æµç¨‹"><a href="#3-æ ¸å¿ƒéªŒè¯æµç¨‹" class="headerlink" title="3. æ ¸å¿ƒéªŒè¯æµç¨‹"></a>3. <strong>æ ¸å¿ƒéªŒè¯æµç¨‹</strong></h3><h4 id="3-1-process-viewæ–¹æ³•-ä¸»è¦éªŒè¯é€»è¾‘"><a href="#3-1-process-viewæ–¹æ³•-ä¸»è¦éªŒè¯é€»è¾‘" class="headerlink" title="3.1 process_viewæ–¹æ³• - ä¸»è¦éªŒè¯é€»è¾‘"></a>3.1 process_viewæ–¹æ³• - ä¸»è¦éªŒè¯é€»è¾‘</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_view</span>(<span class="hljs-params">self, request, callback, callback_args, callback_kwargs</span>):<br>    <span class="hljs-comment"># 1. è·³è¿‡å·²å¤„ç†çš„è¯·æ±‚</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">getattr</span>(request, <span class="hljs-string">&#x27;csrf_processing_done&#x27;</span>, <span class="hljs-literal">False</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>    <br>    <span class="hljs-comment"># 2. è·å–CSRF token</span><br>    csrf_token = <span class="hljs-variable language_">self</span>._get_token(request)<br>    <br>    <span class="hljs-comment"># 3. è·³è¿‡@csrf_exemptè£…é¥°çš„è§†å›¾</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">getattr</span>(callback, <span class="hljs-string">&#x27;csrf_exempt&#x27;</span>, <span class="hljs-literal">False</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>    <br>    <span class="hljs-comment"># 4. ä»…å¯¹ä¸å®‰å…¨æ–¹æ³•è¿›è¡Œæ£€æŸ¥</span><br>    <span class="hljs-keyword">if</span> request.method <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;HEAD&#x27;</span>, <span class="hljs-string">&#x27;OPTIONS&#x27;</span>, <span class="hljs-string">&#x27;TRACE&#x27;</span>):<br>        <span class="hljs-comment"># æ‰§è¡ŒCSRFéªŒè¯</span><br></code></pre></td></tr></table></figure><h4 id="3-2-HTTPSä¸‹çš„Refereræ£€æŸ¥"><a href="#3-2-HTTPSä¸‹çš„Refereræ£€æŸ¥" class="headerlink" title="3.2 HTTPSä¸‹çš„Refereræ£€æŸ¥"></a>3.2 HTTPSä¸‹çš„Refereræ£€æŸ¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> request.is_secure():  <span class="hljs-comment"># HTTPSè¯·æ±‚</span><br>    referer = force_text(request.META.get(<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>))<br>    <br>    <span class="hljs-comment"># 1. å¿…é¡»æœ‰Refererå¤´</span><br>    <span class="hljs-keyword">if</span> referer <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._reject(request, REASON_NO_REFERER)<br>    <br>    <span class="hljs-comment"># 2. Refererå¿…é¡»æ˜¯æœ‰æ•ˆURL</span><br>    referer = urlparse(referer)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">in</span> (referer.scheme, referer.netloc):<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._reject(request, REASON_MALFORMED_REFERER)<br>    <br>    <span class="hljs-comment"># 3. Refererå¿…é¡»æ˜¯HTTPS</span><br>    <span class="hljs-keyword">if</span> referer.scheme != <span class="hljs-string">&#x27;https&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._reject(request, REASON_INSECURE_REFERER)<br>    <br>    <span class="hljs-comment"># 4. åŸŸåå¿…é¡»åœ¨ä¿¡ä»»åˆ—è¡¨ä¸­</span><br>    good_hosts = <span class="hljs-built_in">list</span>(settings.CSRF_TRUSTED_ORIGINS)<br>    good_hosts.append(request.get_host())<br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">any</span>(is_same_domain(referer.netloc, host) <span class="hljs-keyword">for</span> host <span class="hljs-keyword">in</span> good_hosts):<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._reject(request, REASON_BAD_REFERER % referer.geturl())<br></code></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆHTTPSéœ€è¦Refereræ£€æŸ¥ï¼Ÿ</strong></p><p>åœ¨HTTPSç¯å¢ƒä¸‹ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ä¸­é—´äººæ”»å‡»ç»•è¿‡CSRFä¿æŠ¤ã€‚Refereræ£€æŸ¥ç¡®ä¿è¯·æ±‚æ¥æºå¯ä¿¡ã€‚</p><h4 id="3-3-TokenéªŒè¯"><a href="#3-3-TokenéªŒè¯" class="headerlink" title="3.3 TokenéªŒè¯"></a>3.3 TokenéªŒè¯</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1. ä»POSTæ•°æ®è·å–token</span><br>request_csrf_token = request.POST.get(<span class="hljs-string">&#x27;csrfmiddlewaretoken&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># 2. å¦‚æœæ²¡æœ‰ï¼Œä»HTTPå¤´è·å–ï¼ˆç”¨äºAJAXï¼‰</span><br><span class="hljs-keyword">if</span> request_csrf_token == <span class="hljs-string">&quot;&quot;</span>:<br>    request_csrf_token = request.META.get(settings.CSRF_HEADER_NAME, <span class="hljs-string">&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># 3. éªŒè¯token</span><br>request_csrf_token = _sanitize_token(request_csrf_token)<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> _compare_salted_tokens(request_csrf_token, csrf_token):<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._reject(request, REASON_BAD_TOKEN)<br></code></pre></td></tr></table></figure><h3 id="4-Tokenæ¯”è¾ƒæœºåˆ¶"><a href="#4-Tokenæ¯”è¾ƒæœºåˆ¶" class="headerlink" title="4. Tokenæ¯”è¾ƒæœºåˆ¶"></a>4. <strong>Tokenæ¯”è¾ƒæœºåˆ¶</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_compare_salted_tokens</span>(<span class="hljs-params">request_csrf_token, csrf_token</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ¯”è¾ƒä¸¤ä¸ªåŠ ç›çš„token&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> constant_time_compare(<br>        _unsalt_cipher_token(request_csrf_token),  <span class="hljs-comment"># è§£å¯†ç”¨æˆ·æäº¤çš„token</span><br>        _unsalt_cipher_token(csrf_token),         <span class="hljs-comment"># è§£å¯†æœåŠ¡å™¨çš„token</span><br>    )<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_unsalt_cipher_token</span>(<span class="hljs-params">token</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è§£å¯†tokenè·å–åŸå§‹secret&quot;&quot;&quot;</span><br>    salt = token[:CSRF_SECRET_LENGTH]      <span class="hljs-comment"># å‰32ä½æ˜¯salt</span><br>    token = token[CSRF_SECRET_LENGTH:]     <span class="hljs-comment"># å32ä½æ˜¯åŠ å¯†çš„secret</span><br>    chars = CSRF_ALLOWED_CHARS<br>    pairs = <span class="hljs-built_in">zip</span>((chars.index(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> token), (chars.index(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> salt))<br>    secret = <span class="hljs-string">&#x27;&#x27;</span>.join(chars[x - y] <span class="hljs-keyword">for</span> x, y <span class="hljs-keyword">in</span> pairs)  <span class="hljs-comment"># è§£å¯†</span><br>    <span class="hljs-keyword">return</span> secret<br></code></pre></td></tr></table></figure><h3 id="5-Cookieç®¡ç†"><a href="#5-Cookieç®¡ç†" class="headerlink" title="5. Cookieç®¡ç†"></a>5. <strong>Cookieç®¡ç†</strong></h3><h4 id="5-1-è®¾ç½®CSRF-Cookie"><a href="#5-1-è®¾ç½®CSRF-Cookie" class="headerlink" title="5.1 è®¾ç½®CSRF Cookie"></a>5.1 è®¾ç½®CSRF Cookie</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_set_token</span>(<span class="hljs-params">self, request, response</span>):<br>    <span class="hljs-keyword">if</span> settings.CSRF_USE_SESSIONS:<br>        <span class="hljs-comment"># å­˜å‚¨åœ¨sessionä¸­</span><br>        request.session[CSRF_SESSION_KEY] = request.META[<span class="hljs-string">&#x27;CSRF_COOKIE&#x27;</span>]<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># è®¾ç½®Cookie</span><br>        response.set_cookie(<br>            settings.CSRF_COOKIE_NAME,           <span class="hljs-comment"># é»˜è®¤: &#x27;csrftoken&#x27;</span><br>            request.META[<span class="hljs-string">&#x27;CSRF_COOKIE&#x27;</span>],<br>            max_age=settings.CSRF_COOKIE_AGE,    <span class="hljs-comment"># è¿‡æœŸæ—¶é—´</span><br>            domain=settings.CSRF_COOKIE_DOMAIN,  <span class="hljs-comment"># åŸŸåé™åˆ¶</span><br>            path=settings.CSRF_COOKIE_PATH,      <span class="hljs-comment"># è·¯å¾„é™åˆ¶  </span><br>            secure=settings.CSRF_COOKIE_SECURE,  <span class="hljs-comment"># ä»…HTTPS</span><br>            httponly=settings.CSRF_COOKIE_HTTPONLY,  <span class="hljs-comment"># é˜²XSS</span><br>        )<br></code></pre></td></tr></table></figure><h4 id="5-2-process-response-Cookieæ›´æ–°"><a href="#5-2-process-response-Cookieæ›´æ–°" class="headerlink" title="5.2 process_response - Cookieæ›´æ–°"></a>5.2 process_response - Cookieæ›´æ–°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_response</span>(<span class="hljs-params">self, request, response</span>):<br>    <span class="hljs-comment"># 1. è·³è¿‡ä¸éœ€è¦é‡ç½®cookieçš„æƒ…å†µ</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">getattr</span>(request, <span class="hljs-string">&#x27;csrf_cookie_needs_reset&#x27;</span>, <span class="hljs-literal">False</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">getattr</span>(response, <span class="hljs-string">&#x27;csrf_cookie_set&#x27;</span>, <span class="hljs-literal">False</span>):<br>            <span class="hljs-keyword">return</span> response<br>    <br>    <span class="hljs-comment"># 2. è·³è¿‡æœªä½¿ç”¨CSRFçš„è¯·æ±‚</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request.META.get(<span class="hljs-string">&quot;CSRF_COOKIE_USED&quot;</span>, <span class="hljs-literal">False</span>):<br>        <span class="hljs-keyword">return</span> response<br>    <br>    <span class="hljs-comment"># 3. è®¾ç½®æˆ–æ›´æ–°CSRF cookie</span><br>    <span class="hljs-variable language_">self</span>._set_token(request, response)<br>    response.csrf_cookie_set = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h3 id="6-å®é™…ä½¿ç”¨ç¤ºä¾‹"><a href="#6-å®é™…ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="6. å®é™…ä½¿ç”¨ç¤ºä¾‹"></a>6. <strong>å®é™…ä½¿ç”¨ç¤ºä¾‹</strong></h3><h4 id="6-1-æ¨¡æ¿ä¸­ä½¿ç”¨"><a href="#6-1-æ¨¡æ¿ä¸­ä½¿ç”¨" class="headerlink" title="6.1 æ¨¡æ¿ä¸­ä½¿ç”¨"></a>6.1 æ¨¡æ¿ä¸­ä½¿ç”¨</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>    &#123;% csrf_token %&#125;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;john&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- æ¸²æŸ“å --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;csrfmiddlewaretoken&quot;</span> </span><br><span class="hljs-tag">           <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;abc123...xyz789&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;john&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="6-2-AJAXè¯·æ±‚"><a href="#6-2-AJAXè¯·æ±‚" class="headerlink" title="6.2 AJAXè¯·æ±‚"></a>6.2 AJAXè¯·æ±‚</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// è·å–CSRF token</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getCSRFToken</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;[name=csrfmiddlewaretoken]&#x27;</span>).<span class="hljs-property">value</span>;<br>&#125;<br><br><span class="hljs-comment">// AJAXè¯·æ±‚</span><br><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/data/&#x27;</span>, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>    <span class="hljs-attr">headers</span>: &#123;<br>        <span class="hljs-string">&#x27;X-CSRFToken&#x27;</span>: <span class="hljs-title function_">getCSRFToken</span>(),<br>        <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,<br>    &#125;,<br>    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<span class="hljs-attr">data</span>: <span class="hljs-string">&#x27;value&#x27;</span>&#125;)<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="7-é…ç½®é€‰é¡¹"><a href="#7-é…ç½®é€‰é¡¹" class="headerlink" title="7. é…ç½®é€‰é¡¹"></a>7. <strong>é…ç½®é€‰é¡¹</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># settings.py</span><br>CSRF_COOKIE_NAME = <span class="hljs-string">&#x27;csrftoken&#x27;</span>           <span class="hljs-comment"># Cookieåç§°</span><br>CSRF_COOKIE_AGE = <span class="hljs-literal">None</span>                   <span class="hljs-comment"># Cookieè¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</span><br>CSRF_COOKIE_DOMAIN = <span class="hljs-literal">None</span>                <span class="hljs-comment"># CookieåŸŸå</span><br>CSRF_COOKIE_PATH = <span class="hljs-string">&#x27;/&#x27;</span>                   <span class="hljs-comment"># Cookieè·¯å¾„</span><br>CSRF_COOKIE_SECURE = <span class="hljs-literal">False</span>               <span class="hljs-comment"># ä»…HTTPSä¼ è¾“</span><br>CSRF_COOKIE_HTTPONLY = <span class="hljs-literal">False</span>             <span class="hljs-comment"># é˜²æ­¢JSè®¿é—®</span><br>CSRF_COOKIE_SAMESITE = <span class="hljs-string">&#x27;Lax&#x27;</span>            <span class="hljs-comment"># SameSiteç­–ç•¥</span><br><br>CSRF_USE_SESSIONS = <span class="hljs-literal">False</span>                <span class="hljs-comment"># ä½¿ç”¨sessionå­˜å‚¨token</span><br>CSRF_TRUSTED_ORIGINS = []                <span class="hljs-comment"># ä¿¡ä»»çš„æ¥æºåŸŸå</span><br>CSRF_HEADER_NAME = <span class="hljs-string">&#x27;HTTP_X_CSRFTOKEN&#x27;</span>    <span class="hljs-comment"># AJAXè¯·æ±‚å¤´åç§°</span><br>CSRF_FAILURE_VIEW = <span class="hljs-string">&#x27;django.views.csrf.csrf_failure&#x27;</span>  <span class="hljs-comment"># å¤±è´¥é¡µé¢</span><br></code></pre></td></tr></table></figure><h3 id="8-å®‰å…¨ç‰¹æ€§æ€»ç»“"><a href="#8-å®‰å…¨ç‰¹æ€§æ€»ç»“" class="headerlink" title="8. å®‰å…¨ç‰¹æ€§æ€»ç»“"></a>8. <strong>å®‰å…¨ç‰¹æ€§æ€»ç»“</strong></h3><ol><li><strong>åŒé‡éªŒè¯</strong>ï¼šCookie + è¡¨å•Token</li><li><strong>SaltåŠ å¯†</strong>ï¼šæ¯æ¬¡ç”Ÿæˆä¸åŒçš„Token</li><li><strong>Refereræ£€æŸ¥</strong>ï¼šHTTPSä¸‹éªŒè¯è¯·æ±‚æ¥æº</li><li><strong>æ—¶åºæ”»å‡»é˜²æŠ¤</strong>ï¼šä½¿ç”¨<code>constant_time_compare</code></li><li><strong>Sessionéš”ç¦»</strong>ï¼šæ¯ä¸ªç”¨æˆ·ç‹¬ç«‹çš„CSRFå¯†é’¥</li><li><strong>åŸŸåé™åˆ¶</strong>ï¼šé€šè¿‡é…ç½®æ§åˆ¶å¯ä¿¡æ¥æº</li></ol><p>è¿™ä¸ªä¸­é—´ä»¶æä¾›äº†å®Œæ•´çš„CSRFä¿æŠ¤ï¼Œæœ‰æ•ˆé˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»ï¼Œæ˜¯Djangoå®‰å…¨ä½“ç³»çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django LocaleMiddleware ä¸­é—´ä»¶</title>
    <link href="/2025/07/16/Django-LocaleMiddleware-%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    <url>/2025/07/16/Django-LocaleMiddleware-%E4%B8%AD%E9%97%B4%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h3 id="1-è¿™ä¸ªä¸­é—´ä»¶è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#1-è¿™ä¸ªä¸­é—´ä»¶è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="1. è¿™ä¸ªä¸­é—´ä»¶è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>1. <strong>è¿™ä¸ªä¸­é—´ä»¶è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></h3><p>æƒ³è±¡æ‚¨çš„ç½‘ç«™éœ€è¦æ”¯æŒå¤šç§è¯­è¨€ï¼šä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ã€‚ç”¨æˆ·è®¿é—®æ—¶ï¼Œç½‘ç«™éœ€è¦çŸ¥é“ï¼š</p><ul><li>ç”¨æˆ·æƒ³çœ‹å“ªç§è¯­è¨€ï¼Ÿ</li><li>å¦‚ä½•ç»™ç”¨æˆ·æ˜¾ç¤ºæ­£ç¡®çš„è¯­è¨€ç‰ˆæœ¬ï¼Ÿ</li></ul><h3 id="2-æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªåŠŸèƒ½"><a href="#2-æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªåŠŸèƒ½" class="headerlink" title="2. æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªåŠŸèƒ½"></a>2. <strong>æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªåŠŸèƒ½</strong></h3><h4 id="åŠŸèƒ½1ï¼šåœ¨è¯·æ±‚å¼€å§‹æ—¶å†³å®šç”¨æˆ·è¯­è¨€"><a href="#åŠŸèƒ½1ï¼šåœ¨è¯·æ±‚å¼€å§‹æ—¶å†³å®šç”¨æˆ·è¯­è¨€" class="headerlink" title="åŠŸèƒ½1ï¼šåœ¨è¯·æ±‚å¼€å§‹æ—¶å†³å®šç”¨æˆ·è¯­è¨€"></a>åŠŸèƒ½1ï¼šåœ¨è¯·æ±‚å¼€å§‹æ—¶å†³å®šç”¨æˆ·è¯­è¨€</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_request</span>(<span class="hljs-params">self, request</span>):<br>    <span class="hljs-comment"># ç®€å•è¯´å°±æ˜¯ï¼šæ ¹æ®å„ç§çº¿ç´¢çŒœæµ‹ç”¨æˆ·æƒ³è¦ä»€ä¹ˆè¯­è¨€</span><br>    <br>    <span class="hljs-comment"># çº¿ç´¢1: URLé‡Œæœ‰è¯­è¨€å—ï¼Ÿ /zh-cn/products/ â†’ ä¸­æ–‡</span><br>    <span class="hljs-comment"># çº¿ç´¢2: ç”¨æˆ·ä¹‹å‰é€‰è¿‡è¯­è¨€å—ï¼Ÿ(å­˜åœ¨session/cookieé‡Œ)</span><br>    <span class="hljs-comment"># çº¿ç´¢3: æµè§ˆå™¨åå¥½ä»€ä¹ˆè¯­è¨€ï¼Ÿ(Accept-Languageå¤´)</span><br>    <span class="hljs-comment"># çº¿ç´¢4: éƒ½æ²¡æœ‰ï¼Ÿç”¨é»˜è®¤è¯­è¨€(è‹±æ–‡)</span><br>    <br>    language = <span class="hljs-string">&quot;æ ¹æ®ä¸Šé¢çš„çº¿ç´¢å¾—å‡ºçš„è¯­è¨€&quot;</span><br>    translation.activate(language)  <span class="hljs-comment"># å‘Šè¯‰Djangoï¼š&quot;ç°åœ¨ç”¨è¿™ä¸ªè¯­è¨€ï¼&quot;</span><br>    request.LANGUAGE_CODE = language  <span class="hljs-comment"># æŠŠè¯­è¨€ä¿¡æ¯å­˜åˆ°è¯·æ±‚é‡Œ</span><br></code></pre></td></tr></table></figure><h4 id="åŠŸèƒ½2ï¼šåœ¨å“åº”æ—¶å¤„ç†ç‰¹æ®Šæƒ…å†µ"><a href="#åŠŸèƒ½2ï¼šåœ¨å“åº”æ—¶å¤„ç†ç‰¹æ®Šæƒ…å†µ" class="headerlink" title="åŠŸèƒ½2ï¼šåœ¨å“åº”æ—¶å¤„ç†ç‰¹æ®Šæƒ…å†µ"></a>åŠŸèƒ½2ï¼šåœ¨å“åº”æ—¶å¤„ç†ç‰¹æ®Šæƒ…å†µ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_response</span>(<span class="hljs-params">self, request, response</span>):<br>    <span class="hljs-comment"># ç®€å•è¯´å°±æ˜¯ï¼šå¦‚æœé¡µé¢404äº†ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯ç¼ºå°‘è¯­è¨€å‰ç¼€</span><br>    <br>    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">404</span>:<br>        <span class="hljs-comment"># ç”¨æˆ·è®¿é—® /products/ â†’ 404é”™è¯¯</span><br>        <span class="hljs-comment"># ä½†æ˜¯ /zh-cn/products/ å­˜åœ¨</span><br>        <span class="hljs-comment"># å°±è‡ªåŠ¨é‡å®šå‘ç”¨æˆ·åˆ° /zh-cn/products/</span><br>        <br>    <span class="hljs-comment"># è®¾ç½®ä¸€äº›HTTPå¤´ï¼Œå‘Šè¯‰æµè§ˆå™¨å’Œç¼“å­˜è¿™ä¸ªé¡µé¢çš„è¯­è¨€ä¿¡æ¯</span><br>    response[<span class="hljs-string">&#x27;Content-Language&#x27;</span>] = language<br></code></pre></td></tr></table></figure><h3 id="3-ç”¨ç”Ÿæ´»ä¾‹å­ç†è§£"><a href="#3-ç”¨ç”Ÿæ´»ä¾‹å­ç†è§£" class="headerlink" title="3. ç”¨ç”Ÿæ´»ä¾‹å­ç†è§£"></a>3. <strong>ç”¨ç”Ÿæ´»ä¾‹å­ç†è§£</strong></h3><p>æŠŠè¿™ä¸ªä¸­é—´ä»¶æƒ³è±¡æˆä¸€ä¸ª<strong>æ™ºèƒ½ç¿»è¯‘åŠ©æ‰‹</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åœºæ™¯1ï¼šç”¨æˆ·è®¿é—®ç½‘ç«™</span><br>ç”¨æˆ·: <span class="hljs-string">&quot;æˆ‘æƒ³çœ‹äº§å“é¡µé¢&quot;</span> (è®¿é—® /products/)<br>åŠ©æ‰‹: <span class="hljs-string">&quot;æˆ‘çœ‹çœ‹ä½ æƒ³è¦ä»€ä¹ˆè¯­è¨€...&quot;</span><br>åŠ©æ‰‹: <span class="hljs-string">&quot;ä½ çš„æµè§ˆå™¨è®¾ç½®æ˜¯ä¸­æ–‡ï¼Œé‚£æˆ‘ç»™ä½ ä¸­æ–‡ç‰ˆæœ¬&quot;</span><br>ç»“æœ: æ˜¾ç¤ºä¸­æ–‡çš„äº§å“é¡µé¢<br><br><span class="hljs-comment"># åœºæ™¯2ï¼šç”¨æˆ·è®¿é—®é”™è¯¯çš„URL</span><br>ç”¨æˆ·: <span class="hljs-string">&quot;æˆ‘æƒ³çœ‹äº§å“é¡µé¢&quot;</span> (è®¿é—® /products/ ä½†è¿™ä¸ªURLä¸å­˜åœ¨)<br>åŠ©æ‰‹: <span class="hljs-string">&quot;è¿™ä¸ªé¡µé¢ä¸å­˜åœ¨ï¼Œä½†æ˜¯æˆ‘å‘ç° /zh-cn/products/ å­˜åœ¨&quot;</span><br>åŠ©æ‰‹: <span class="hljs-string">&quot;æˆ‘å¸®ä½ è·³è½¬è¿‡å»&quot;</span><br>ç»“æœ: è‡ªåŠ¨è·³è½¬åˆ° /zh-cn/products/<br></code></pre></td></tr></table></figure><h3 id="4-å‡ ä¸ªå…³é”®æ¦‚å¿µç®€åŒ–è§£é‡Š"><a href="#4-å‡ ä¸ªå…³é”®æ¦‚å¿µç®€åŒ–è§£é‡Š" class="headerlink" title="4. å‡ ä¸ªå…³é”®æ¦‚å¿µç®€åŒ–è§£é‡Š"></a>4. <strong>å‡ ä¸ªå…³é”®æ¦‚å¿µç®€åŒ–è§£é‡Š</strong></h3><h4 id="æ¦‚å¿µ1ï¼šè¯­è¨€æ£€æµ‹ä¼˜å…ˆçº§"><a href="#æ¦‚å¿µ1ï¼šè¯­è¨€æ£€æµ‹ä¼˜å…ˆçº§" class="headerlink" title="æ¦‚å¿µ1ï¼šè¯­è¨€æ£€æµ‹ä¼˜å…ˆçº§"></a>æ¦‚å¿µ1ï¼šè¯­è¨€æ£€æµ‹ä¼˜å…ˆçº§</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å°±æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§åˆ—è¡¨ï¼Œä»é«˜åˆ°ä½ï¼š</span><br><span class="hljs-number">1.</span> URLé‡Œæ˜ç¡®å†™äº†è¯­è¨€ (/zh-cn/products/) â†’ æœ€ä¼˜å…ˆ<br><span class="hljs-number">2.</span> ç”¨æˆ·ä¹‹å‰é€‰æ‹©è¿‡è¯­è¨€ (å­˜åœ¨session/cookie) â†’ å…¶æ¬¡<br><span class="hljs-number">3.</span> æµè§ˆå™¨è¯­è¨€åå¥½ â†’ å†æ¬¡  <br><span class="hljs-number">4.</span> ç½‘ç«™é»˜è®¤è¯­è¨€ â†’ æœ€åå…œåº•<br></code></pre></td></tr></table></figure><h4 id="æ¦‚å¿µ2ï¼ši18n-patterns"><a href="#æ¦‚å¿µ2ï¼ši18n-patterns" class="headerlink" title="æ¦‚å¿µ2ï¼ši18n_patterns"></a>æ¦‚å¿µ2ï¼ši18n_patterns</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å°±æ˜¯å‘Šè¯‰Djangoå“ªäº›URLéœ€è¦è¯­è¨€å‰ç¼€</span><br><span class="hljs-comment"># æ™®é€šURL: /products/</span><br><span class="hljs-comment"># å›½é™…åŒ–URL: /en/products/, /zh-cn/products/, /ja/products/</span><br></code></pre></td></tr></table></figure><h4 id="æ¦‚å¿µ3ï¼š404æ™ºèƒ½å¤„ç†"><a href="#æ¦‚å¿µ3ï¼š404æ™ºèƒ½å¤„ç†" class="headerlink" title="æ¦‚å¿µ3ï¼š404æ™ºèƒ½å¤„ç†"></a>æ¦‚å¿µ3ï¼š404æ™ºèƒ½å¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç”¨æˆ·è®¿é—®: /products/ â†’ 404</span><br><span class="hljs-comment"># ä¸­é—´ä»¶æƒ³: &quot;è®©æˆ‘è¯•è¯•åŠ ä¸Šè¯­è¨€å‰ç¼€&quot;</span><br><span class="hljs-comment"># æ£€æŸ¥: /zh-cn/products/ â†’ å­˜åœ¨ï¼</span><br><span class="hljs-comment"># åŠ¨ä½œ: è‡ªåŠ¨è·³è½¬åˆ° /zh-cn/products/</span><br></code></pre></td></tr></table></figure><h3 id="5-å®é™…æ•ˆæœæ¼”ç¤º"><a href="#5-å®é™…æ•ˆæœæ¼”ç¤º" class="headerlink" title="5. å®é™…æ•ˆæœæ¼”ç¤º"></a>5. <strong>å®é™…æ•ˆæœæ¼”ç¤º</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é…ç½®äº†è¿™ä¸ªä¸­é—´ä»¶åçš„ç”¨æˆ·ä½“éªŒï¼š</span><br><br><span class="hljs-comment"># æƒ…å†µ1ï¼šä¸­æ–‡ç”¨æˆ·è®¿é—®</span><br>ç”¨æˆ·æµè§ˆå™¨: Accept-Language: zh-CN<br>ç”¨æˆ·è®¿é—®: yoursite.com/products/<br>å®é™…çœ‹åˆ°: ä¸­æ–‡ç‰ˆæœ¬çš„äº§å“é¡µé¢<br>URLå˜æˆ: yoursite.com/zh-cn/products/ (å¦‚æœé…ç½®äº†è¯­è¨€å‰ç¼€)<br><br><span class="hljs-comment"># æƒ…å†µ2ï¼šè‹±æ–‡ç”¨æˆ·è®¿é—®  </span><br>ç”¨æˆ·æµè§ˆå™¨: Accept-Language: en-US<br>ç”¨æˆ·è®¿é—®: yoursite.com/products/<br>å®é™…çœ‹åˆ°: è‹±æ–‡ç‰ˆæœ¬çš„äº§å“é¡µé¢<br>URLå¯èƒ½: yoursite.com/products/ (å¦‚æœè‹±æ–‡æ˜¯é»˜è®¤è¯­è¨€)<br><br><span class="hljs-comment"># æƒ…å†µ3ï¼šç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©è¯­è¨€</span><br>ç”¨æˆ·ç‚¹å‡»: <span class="hljs-string">&quot;åˆ‡æ¢åˆ°æ—¥æ–‡&quot;</span><br>ç³»ç»Ÿè®°ä½: åœ¨session/cookieé‡Œä¿å­˜ <span class="hljs-string">&quot;ja&quot;</span><br>ä¸‹æ¬¡è®¿é—®: è‡ªåŠ¨æ˜¾ç¤ºæ—¥æ–‡ç‰ˆæœ¬<br></code></pre></td></tr></table></figure><h3 id="6-æ€»ç»“ä¸€å¥è¯"><a href="#6-æ€»ç»“ä¸€å¥è¯" class="headerlink" title="6. æ€»ç»“ä¸€å¥è¯"></a>6. <strong>æ€»ç»“ä¸€å¥è¯</strong></h3><p><strong>è¿™ä¸ªä¸­é—´ä»¶å°±æ˜¯ä¸€ä¸ªæ™ºèƒ½çš„è¯­è¨€ç®¡å®¶ï¼Œå®ƒä¼šçŒœæµ‹ç”¨æˆ·æƒ³è¦ä»€ä¹ˆè¯­è¨€ï¼Œç„¶åè‡ªåŠ¨æä¾›å¯¹åº”è¯­è¨€çš„é¡µé¢ï¼Œå¦‚æœç”¨æˆ·è®¿é—®äº†é”™è¯¯çš„URLï¼Œè¿˜ä¼šæ™ºèƒ½åœ°å¸®ç”¨æˆ·è·³è½¬åˆ°æ­£ç¡®çš„åœ°å€ã€‚</strong></p><p>ä¸éœ€è¦ç†è§£æ¯è¡Œä»£ç çš„ç»†èŠ‚ï¼Œåªè¦çŸ¥é“å®ƒåœ¨åšä»€ä¹ˆå°±å¤Ÿäº†ï¼š<strong>è®©å¤šè¯­è¨€ç½‘ç«™å˜å¾—ç”¨æˆ·å‹å¥½</strong>ã€‚</p><p>å›½é™…åŒ–çš„å®ç°æ˜¯åŒä¸€é¡µé¢ï¼Œå¤šä¸ªç¿»è¯‘æ–‡ä»¶ï¼Œå®æ—¶çš„è¿›è¡Œé¡µé¢æ¸²æŸ“</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django HTTP Request</title>
    <link href="/2025/07/07/Django-HTTP-Request/"/>
    <url>/2025/07/07/Django-HTTP-Request/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Djangoçš„HTTPè¯·æ±‚å¤„ç†æ˜¯ä¸€ä¸ªåˆ†å±‚æ¶æ„ï¼Œä»¥<code>HttpRequest</code>ä½œä¸ºåŸºç¡€æŠ½è±¡ç±»ï¼Œ<code>WSGIRequest</code>ä½œä¸ºå®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨çš„å®ç°ç±»ã€‚é€šè¿‡ä¸­é—´ä»¶ç³»ç»Ÿï¼ŒDjangoåŠ¨æ€åœ°æ‰©å±•è¯·æ±‚å¯¹è±¡çš„åŠŸèƒ½ï¼Œæä¾›äº†å®Œæ•´çš„Webè¯·æ±‚å¤„ç†èƒ½åŠ›ã€‚</p><h2 id="æ ¸å¿ƒæ¶æ„"><a href="#æ ¸å¿ƒæ¶æ„" class="headerlink" title="æ ¸å¿ƒæ¶æ„"></a>æ ¸å¿ƒæ¶æ„</h2><h3 id="1-ç±»ç»§æ‰¿å…³ç³»"><a href="#1-ç±»ç»§æ‰¿å…³ç³»" class="headerlink" title="1. ç±»ç»§æ‰¿å…³ç³»"></a>1. ç±»ç»§æ‰¿å…³ç³»</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åŸºç¡€æŠ½è±¡ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpRequest</span>(<span class="hljs-title class_ inherited__">object</span>)<br><br><span class="hljs-comment"># å®é™…ä½¿ç”¨çš„WSGIå®ç°  </span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WSGIRequest</span>(<span class="hljs-title class_ inherited__">HttpRequest</span>)<br><br><span class="hljs-comment"># ä¸“ç”¨çš„æŸ¥è¯¢å­—å…¸</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryDict</span>(<span class="hljs-title class_ inherited__">MultiValueDict</span>)<br></code></pre></td></tr></table></figure><h3 id="2-ä¸»è¦ç»„ä»¶"><a href="#2-ä¸»è¦ç»„ä»¶" class="headerlink" title="2. ä¸»è¦ç»„ä»¶"></a>2. ä¸»è¦ç»„ä»¶</h3><ul><li><strong>HttpRequest</strong>: åŸºç¡€HTTPè¯·æ±‚æŠ½è±¡</li><li><strong>WSGIRequest</strong>: WSGIç¯å¢ƒä¸‹çš„å…·ä½“å®ç°</li><li><strong>QueryDict</strong>: å¤„ç†æŸ¥è¯¢å­—ç¬¦ä¸²å’Œè¡¨å•æ•°æ®</li><li><strong>MultiValueDict</strong>: æ”¯æŒä¸€é”®å¤šå€¼çš„å­—å…¸å®ç°</li></ul><h2 id="HttpRequest-åŸºç¡€ç±»è¯¦è§£"><a href="#HttpRequest-åŸºç¡€ç±»è¯¦è§£" class="headerlink" title="HttpRequest åŸºç¡€ç±»è¯¦è§£"></a>HttpRequest åŸºç¡€ç±»è¯¦è§£</h2><h3 id="æ ¸å¿ƒå±æ€§"><a href="#æ ¸å¿ƒå±æ€§" class="headerlink" title="æ ¸å¿ƒå±æ€§"></a>æ ¸å¿ƒå±æ€§</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-variable language_">self</span>.GET = QueryDict(mutable=<span class="hljs-literal">True</span>)          <span class="hljs-comment"># GETå‚æ•°</span><br>    <span class="hljs-variable language_">self</span>.POST = QueryDict(mutable=<span class="hljs-literal">True</span>)         <span class="hljs-comment"># POSTæ•°æ®  </span><br>    <span class="hljs-variable language_">self</span>.COOKIES = &#123;&#125;                           <span class="hljs-comment"># Cookieæ•°æ®</span><br>    <span class="hljs-variable language_">self</span>.META = &#123;&#125;                              <span class="hljs-comment"># HTTPå¤´å’Œç¯å¢ƒå˜é‡</span><br>    <span class="hljs-variable language_">self</span>.FILES = MultiValueDict()               <span class="hljs-comment"># ä¸Šä¼ æ–‡ä»¶</span><br>    <br>    <span class="hljs-variable language_">self</span>.path = <span class="hljs-string">&#x27;&#x27;</span>                              <span class="hljs-comment"># è¯·æ±‚è·¯å¾„</span><br>    <span class="hljs-variable language_">self</span>.path_info = <span class="hljs-string">&#x27;&#x27;</span>                         <span class="hljs-comment"># è·¯å¾„ä¿¡æ¯</span><br>    <span class="hljs-variable language_">self</span>.method = <span class="hljs-literal">None</span>                          <span class="hljs-comment"># HTTPæ–¹æ³•</span><br>    <span class="hljs-variable language_">self</span>.resolver_match = <span class="hljs-literal">None</span>                  <span class="hljs-comment"># URLè§£æåŒ¹é…</span><br>    <span class="hljs-variable language_">self</span>._post_parse_error = <span class="hljs-literal">False</span>              <span class="hljs-comment"># POSTè§£æé”™è¯¯æ ‡å¿—</span><br>    <span class="hljs-variable language_">self</span>.content_type = <span class="hljs-literal">None</span>                    <span class="hljs-comment"># å†…å®¹ç±»å‹</span><br>    <span class="hljs-variable language_">self</span>.content_params = <span class="hljs-literal">None</span>                  <span class="hljs-comment"># å†…å®¹å‚æ•°</span><br></code></pre></td></tr></table></figure><h3 id="ä¸»æœºå’Œå®‰å…¨å¤„ç†"><a href="#ä¸»æœºå’Œå®‰å…¨å¤„ç†" class="headerlink" title="ä¸»æœºå’Œå®‰å…¨å¤„ç†"></a>ä¸»æœºå’Œå®‰å…¨å¤„ç†</h3><h4 id="ä¸»æœºå¤´éªŒè¯-é˜²Hostå¤´æ”»å‡»"><a href="#ä¸»æœºå¤´éªŒè¯-é˜²Hostå¤´æ”»å‡»" class="headerlink" title="ä¸»æœºå¤´éªŒè¯ (é˜²Hostå¤´æ”»å‡»)"></a>ä¸»æœºå¤´éªŒè¯ (é˜²Hostå¤´æ”»å‡»)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_host</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è¿”å›HTTPä¸»æœºï¼Œè¿›è¡Œå®‰å…¨éªŒè¯&quot;&quot;&quot;</span><br>    host = <span class="hljs-variable language_">self</span>._get_raw_host()<br>    <br>    <span class="hljs-comment"># è°ƒè¯•æ¨¡å¼ä¸‹å…è®¸localhostå˜ä½“</span><br>    allowed_hosts = settings.ALLOWED_HOSTS<br>    <span class="hljs-keyword">if</span> settings.DEBUG <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> allowed_hosts:<br>        allowed_hosts = [<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-string">&#x27;[::1]&#x27;</span>]<br>    <br>    domain, port = split_domain_port(host)<br>    <span class="hljs-keyword">if</span> domain <span class="hljs-keyword">and</span> validate_host(domain, allowed_hosts):<br>        <span class="hljs-keyword">return</span> host<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># æŠ›å‡ºDisallowedHostå¼‚å¸¸ï¼Œé˜²æ­¢Hostå¤´æ”»å‡»</span><br>        <span class="hljs-keyword">raise</span> DisallowedHost(<span class="hljs-string">&quot;Invalid HTTP_HOST header&quot;</span>)<br></code></pre></td></tr></table></figure><p><strong>å®‰å…¨ä»·å€¼</strong>ï¼šé˜²æ­¢æ”»å‡»è€…é€šè¿‡ä¼ªé€ Hostå¤´è¿›è¡Œç¼“å­˜æ±¡æŸ“æˆ–å¯†ç é‡ç½®æ”»å‡»ã€‚</p><h4 id="ç­¾åCookieæ”¯æŒ"><a href="#ç­¾åCookieæ”¯æŒ" class="headerlink" title="ç­¾åCookieæ”¯æŒ"></a>ç­¾åCookieæ”¯æŒ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_signed_cookie</span>(<span class="hljs-params">self, key, default=RAISE_ERROR, salt=<span class="hljs-string">&#x27;&#x27;</span>, max_age=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–ç­¾åcookieï¼Œé˜²æ­¢ç¯¡æ”¹&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        cookie_value = <span class="hljs-variable language_">self</span>.COOKIES[key]<br>        value = signing.get_cookie_signer(salt=key + salt).unsign(<br>            cookie_value, max_age=max_age)<br>        <span class="hljs-keyword">return</span> value<br>    <span class="hljs-keyword">except</span> signing.BadSignature:<br>        <span class="hljs-comment"># ç­¾åéªŒè¯å¤±è´¥</span><br>        <span class="hljs-keyword">if</span> default <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> RAISE_ERROR:<br>            <span class="hljs-keyword">return</span> default<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">raise</span><br></code></pre></td></tr></table></figure><h4 id="HTTPSæ£€æµ‹"><a href="#HTTPSæ£€æµ‹" class="headerlink" title="HTTPSæ£€æµ‹"></a>HTTPSæ£€æµ‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">scheme</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-comment"># æ”¯æŒä»£ç†æœåŠ¡å™¨çš„HTTPSæ£€æµ‹</span><br>    <span class="hljs-keyword">if</span> settings.SECURE_PROXY_SSL_HEADER:<br>        header, value = settings.SECURE_PROXY_SSL_HEADER<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.META.get(header) == value:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;https&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._get_scheme()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_secure</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.scheme == <span class="hljs-string">&#x27;https&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="URLæ„å»ºåŠŸèƒ½"><a href="#URLæ„å»ºåŠŸèƒ½" class="headerlink" title="URLæ„å»ºåŠŸèƒ½"></a>URLæ„å»ºåŠŸèƒ½</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_full_path</span>(<span class="hljs-params">self, force_append_slash=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–å®Œæ•´è·¯å¾„åŒ…å«æŸ¥è¯¢å­—ç¬¦ä¸²&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;%s%s%s&#x27;</span> % (<br>        escape_uri_path(<span class="hljs-variable language_">self</span>.path),<br>        <span class="hljs-string">&#x27;/&#x27;</span> <span class="hljs-keyword">if</span> force_append_slash <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.path.endswith(<span class="hljs-string">&#x27;/&#x27;</span>) <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&#x27;</span>,<br>        (<span class="hljs-string">&#x27;?&#x27;</span> + iri_to_uri(<span class="hljs-variable language_">self</span>.META.get(<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>))) <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.META.get(<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>) <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&#x27;</span><br>    )<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_absolute_uri</span>(<span class="hljs-params">self, location=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ„å»ºç»å¯¹URI&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> location <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        location = <span class="hljs-string">&#x27;//%s&#x27;</span> % <span class="hljs-variable language_">self</span>.get_full_path()<br>    <span class="hljs-comment"># ... å¤„ç†ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„çš„é€»è¾‘</span><br>    <span class="hljs-keyword">return</span> iri_to_uri(location)<br></code></pre></td></tr></table></figure><h3 id="ç¼–ç å¤„ç†"><a href="#ç¼–ç å¤„ç†" class="headerlink" title="ç¼–ç å¤„ç†"></a>ç¼–ç å¤„ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@encoding.setter</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encoding</span>(<span class="hljs-params">self, val</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è®¾ç½®GET/POSTè®¿é—®çš„ç¼–ç &quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>._encoding = val<br>    <span class="hljs-comment"># ç¼–ç æ”¹å˜æ—¶é‡æ–°åˆ›å»ºGETå’ŒPOSTå­—å…¸</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(<span class="hljs-variable language_">self</span>, <span class="hljs-string">&#x27;GET&#x27;</span>):<br>        <span class="hljs-keyword">del</span> <span class="hljs-variable language_">self</span>.GET<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(<span class="hljs-variable language_">self</span>, <span class="hljs-string">&#x27;_post&#x27;</span>):<br>        <span class="hljs-keyword">del</span> <span class="hljs-variable language_">self</span>._post<br></code></pre></td></tr></table></figure><h3 id="æ–‡ä»¶ä¸Šä¼ å¤„ç†"><a href="#æ–‡ä»¶ä¸Šä¼ å¤„ç†" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ å¤„ç†"></a>æ–‡ä»¶ä¸Šä¼ å¤„ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_initialize_handlers</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ å¤„ç†å™¨&quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>._upload_handlers = [uploadhandler.load_handler(handler, <span class="hljs-variable language_">self</span>)<br>                             <span class="hljs-keyword">for</span> handler <span class="hljs-keyword">in</span> settings.FILE_UPLOAD_HANDLERS]<br><br><span class="hljs-meta">@property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_handlers</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>._upload_handlers:<br>        <span class="hljs-variable language_">self</span>._initialize_handlers()<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._upload_handlers<br><br><span class="hljs-meta">@upload_handlers.setter  </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_handlers</span>(<span class="hljs-params">self, upload_handlers</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(<span class="hljs-variable language_">self</span>, <span class="hljs-string">&#x27;_files&#x27;</span>):<br>        <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">&quot;You cannot set the upload handlers after the upload has been processed.&quot;</span>)<br>    <span class="hljs-variable language_">self</span>._upload_handlers = upload_handlers<br></code></pre></td></tr></table></figure><h3 id="è¯·æ±‚ä½“å¤„ç†"><a href="#è¯·æ±‚ä½“å¤„ç†" class="headerlink" title="è¯·æ±‚ä½“å¤„ç†"></a>è¯·æ±‚ä½“å¤„ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">body</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">hasattr</span>(<span class="hljs-variable language_">self</span>, <span class="hljs-string">&#x27;_body&#x27;</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>._read_started:<br>            <span class="hljs-keyword">raise</span> RawPostDataException(<span class="hljs-string">&quot;You cannot access body after reading from request&#x27;s data stream&quot;</span>)<br><br>        <span class="hljs-comment"># æ£€æŸ¥è¯·æ±‚ä½“å¤§å°é™åˆ¶</span><br>        <span class="hljs-keyword">if</span> (settings.DATA_UPLOAD_MAX_MEMORY_SIZE <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span><br>                <span class="hljs-built_in">int</span>(<span class="hljs-variable language_">self</span>.META.get(<span class="hljs-string">&#x27;CONTENT_LENGTH&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>) &gt; settings.DATA_UPLOAD_MAX_MEMORY_SIZE):<br>            <span class="hljs-keyword">raise</span> RequestDataTooBig(<span class="hljs-string">&#x27;Request body exceeded settings.DATA_UPLOAD_MAX_MEMORY_SIZE.&#x27;</span>)<br><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-variable language_">self</span>._body = <span class="hljs-variable language_">self</span>.read()<br>        <span class="hljs-keyword">except</span> IOError <span class="hljs-keyword">as</span> e:<br>            six.reraise(UnreadablePostError, UnreadablePostError(*e.args), sys.exc_info()[<span class="hljs-number">2</span>])<br>        <span class="hljs-variable language_">self</span>._stream = BytesIO(<span class="hljs-variable language_">self</span>._body)<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._body<br></code></pre></td></tr></table></figure><h3 id="POSTæ•°æ®è§£æ"><a href="#POSTæ•°æ®è§£æ" class="headerlink" title="POSTæ•°æ®è§£æ"></a>POSTæ•°æ®è§£æ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_load_post_and_files</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ ¹æ®content-typeè§£æPOSTæ•°æ®å’Œæ–‡ä»¶&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.method != <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-variable language_">self</span>._post, <span class="hljs-variable language_">self</span>._files = QueryDict(encoding=<span class="hljs-variable language_">self</span>._encoding), MultiValueDict()<br>        <span class="hljs-keyword">return</span><br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.content_type == <span class="hljs-string">&#x27;multipart/form-data&#x27;</span>:<br>        <span class="hljs-comment"># å¤„ç†æ–‡ä»¶ä¸Šä¼ </span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(<span class="hljs-variable language_">self</span>, <span class="hljs-string">&#x27;_body&#x27;</span>):<br>            data = BytesIO(<span class="hljs-variable language_">self</span>._body)<br>        <span class="hljs-keyword">else</span>:<br>            data = <span class="hljs-variable language_">self</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-variable language_">self</span>._post, <span class="hljs-variable language_">self</span>._files = <span class="hljs-variable language_">self</span>.parse_file_upload(<span class="hljs-variable language_">self</span>.META, data)<br>        <span class="hljs-keyword">except</span> MultiPartParserError:<br>            <span class="hljs-variable language_">self</span>._mark_post_parse_error()<br>            <span class="hljs-keyword">raise</span><br>    <span class="hljs-keyword">elif</span> <span class="hljs-variable language_">self</span>.content_type == <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>:<br>        <span class="hljs-comment"># å¤„ç†è¡¨å•æ•°æ®</span><br>        <span class="hljs-variable language_">self</span>._post, <span class="hljs-variable language_">self</span>._files = QueryDict(<span class="hljs-variable language_">self</span>.body, encoding=<span class="hljs-variable language_">self</span>._encoding), MultiValueDict()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># å…¶ä»–ç±»å‹ï¼ˆå¦‚JSONï¼‰</span><br>        <span class="hljs-variable language_">self</span>._post, <span class="hljs-variable language_">self</span>._files = QueryDict(encoding=<span class="hljs-variable language_">self</span>._encoding), MultiValueDict()<br></code></pre></td></tr></table></figure><h3 id="æµå¼æ¥å£"><a href="#æµå¼æ¥å£" class="headerlink" title="æµå¼æ¥å£"></a>æµå¼æ¥å£</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">read</span>(<span class="hljs-params">self, *args, **kwargs</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è¯»å–è¯·æ±‚ä½“æ•°æ®&quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>._read_started = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._stream.read(*args, **kwargs)<br>    <span class="hljs-keyword">except</span> IOError <span class="hljs-keyword">as</span> e:<br>        six.reraise(UnreadablePostError, UnreadablePostError(*e.args), sys.exc_info()[<span class="hljs-number">2</span>])<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ”¯æŒè¿­ä»£å™¨åè®®ï¼Œç”¨äºå¤§æ–‡ä»¶æµå¤„ç†&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.xreadlines()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">xreadlines</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ç”Ÿæˆå™¨å½¢å¼çš„é€è¡Œè¯»å–&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        buf = <span class="hljs-variable language_">self</span>.readline()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> buf:<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">yield</span> buf<br></code></pre></td></tr></table></figure><h2 id="WSGIRequest-å®é™…å®ç°"><a href="#WSGIRequest-å®é™…å®ç°" class="headerlink" title="WSGIRequest å®é™…å®ç°"></a>WSGIRequest å®é™…å®ç°</h2><h3 id="ä¸HttpRequestçš„åŒºåˆ«"><a href="#ä¸HttpRequestçš„åŒºåˆ«" class="headerlink" title="ä¸HttpRequestçš„åŒºåˆ«"></a>ä¸HttpRequestçš„åŒºåˆ«</h3><p><strong>å…³é”®å·®å¼‚</strong>ï¼š</p><ol><li><strong>ä¸è°ƒç”¨çˆ¶ç±»__init__</strong>ï¼šç›´æ¥é‡æ–°å®ç°æ‰€æœ‰åˆå§‹åŒ–é€»è¾‘</li><li><strong>ç›´æ¥ä½¿ç”¨WSGIç¯å¢ƒ</strong>ï¼š<code>self.META = environ</code></li><li><strong>æµå¤„ç†ä¼˜åŒ–</strong>ï¼šä½¿ç”¨<code>LimitedStream</code>è¿›è¡Œå®‰å…¨çš„è¯·æ±‚ä½“è¯»å–</li></ol><h3 id="åˆå§‹åŒ–è¿‡ç¨‹"><a href="#åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="åˆå§‹åŒ–è¿‡ç¨‹"></a>åˆå§‹åŒ–è¿‡ç¨‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WSGIRequest</span>(http.HttpRequest):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, environ</span>):<br>        <span class="hljs-comment"># è§£æWSGIè·¯å¾„ä¿¡æ¯</span><br>        script_name = get_script_name(environ)<br>        path_info = get_path_info(environ)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> path_info:<br>            path_info = <span class="hljs-string">&#x27;/&#x27;</span><br>            <br>        <span class="hljs-comment"># ç›´æ¥è®¾ç½®å±æ€§ï¼Œä¸è°ƒç”¨çˆ¶ç±»__init__</span><br>        <span class="hljs-variable language_">self</span>.environ = environ<br>        <span class="hljs-variable language_">self</span>.path_info = path_info<br>        <span class="hljs-variable language_">self</span>.path = <span class="hljs-string">&#x27;%s/%s&#x27;</span> % (script_name.rstrip(<span class="hljs-string">&#x27;/&#x27;</span>), path_info.replace(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-number">1</span>))<br>        <span class="hljs-variable language_">self</span>.META = environ  <span class="hljs-comment"># ç›´æ¥ä½¿ç”¨WSGIç¯å¢ƒä½œä¸ºMETA</span><br>        <span class="hljs-variable language_">self</span>.META[<span class="hljs-string">&#x27;PATH_INFO&#x27;</span>] = path_info<br>        <span class="hljs-variable language_">self</span>.META[<span class="hljs-string">&#x27;SCRIPT_NAME&#x27;</span>] = script_name<br>        <br>        <span class="hljs-comment"># HTTPæ–¹æ³•å’Œå†…å®¹ç±»å‹å¤„ç†</span><br>        <span class="hljs-variable language_">self</span>.method = environ[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>].upper()<br>        <span class="hljs-variable language_">self</span>.content_type, <span class="hljs-variable language_">self</span>.content_params = cgi.parse_header(environ.get(<span class="hljs-string">&#x27;CONTENT_TYPE&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>))<br>        <br>        <span class="hljs-comment"># å­—ç¬¦ç¼–ç å¤„ç†</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;charset&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.content_params:<br>            <span class="hljs-keyword">try</span>:<br>                codecs.lookup(<span class="hljs-variable language_">self</span>.content_params[<span class="hljs-string">&#x27;charset&#x27;</span>])<br>                <span class="hljs-variable language_">self</span>.encoding = <span class="hljs-variable language_">self</span>.content_params[<span class="hljs-string">&#x27;charset&#x27;</span>]<br>            <span class="hljs-keyword">except</span> LookupError:<br>                <span class="hljs-keyword">pass</span><br>        <br>        <span class="hljs-comment"># è®¾ç½®é™åˆ¶æµç”¨äºå®‰å…¨è¯»å–è¯·æ±‚ä½“</span><br>        <span class="hljs-keyword">try</span>:<br>            content_length = <span class="hljs-built_in">int</span>(environ.get(<span class="hljs-string">&#x27;CONTENT_LENGTH&#x27;</span>))<br>        <span class="hljs-keyword">except</span> (ValueError, TypeError):<br>            content_length = <span class="hljs-number">0</span><br>        <span class="hljs-variable language_">self</span>._stream = LimitedStream(<span class="hljs-variable language_">self</span>.environ[<span class="hljs-string">&#x27;wsgi.input&#x27;</span>], content_length)<br>        <span class="hljs-variable language_">self</span>._read_started = <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><h3 id="å»¶è¿Ÿå±æ€§åŠ è½½"><a href="#å»¶è¿Ÿå±æ€§åŠ è½½" class="headerlink" title="å»¶è¿Ÿå±æ€§åŠ è½½"></a>å»¶è¿Ÿå±æ€§åŠ è½½</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@cached_property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">GET</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å»¶è¿ŸåŠ è½½GETå‚æ•°&quot;&quot;&quot;</span><br>    raw_query_string = get_bytes_from_wsgi(<span class="hljs-variable language_">self</span>.environ, <span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">return</span> http.QueryDict(raw_query_string, encoding=<span class="hljs-variable language_">self</span>._encoding)<br><br><span class="hljs-meta">@cached_property  </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">COOKIES</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å»¶è¿ŸåŠ è½½Cookie&quot;&quot;&quot;</span><br>    raw_cookie = get_str_from_wsgi(<span class="hljs-variable language_">self</span>.environ, <span class="hljs-string">&#x27;HTTP_COOKIE&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">return</span> http.parse_cookie(raw_cookie)<br><br><span class="hljs-meta">@property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">FILES</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å»¶è¿ŸåŠ è½½æ–‡ä»¶æ•°æ®&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">hasattr</span>(<span class="hljs-variable language_">self</span>, <span class="hljs-string">&#x27;_files&#x27;</span>):<br>        <span class="hljs-variable language_">self</span>._load_post_and_files()<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._files<br><br><span class="hljs-comment"># POSTä½¿ç”¨propertyè€Œä¸æ˜¯cached_propertyï¼Œå…è®¸åŠ¨æ€ä¿®æ”¹</span><br>POST = <span class="hljs-built_in">property</span>(_get_post, _set_post)<br></code></pre></td></tr></table></figure><h3 id="LimitedStream-å®‰å…¨æµ"><a href="#LimitedStream-å®‰å…¨æµ" class="headerlink" title="LimitedStream å®‰å…¨æµ"></a>LimitedStream å®‰å…¨æµ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LimitedStream</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;é™åˆ¶å¤§å°çš„æµï¼Œé˜²æ­¢å†…å­˜è€—å°½æ”»å‡»&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, stream, limit, buf_size=<span class="hljs-number">64</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span></span>):<br>        <span class="hljs-variable language_">self</span>.stream = stream<br>        <span class="hljs-variable language_">self</span>.remaining = limit<br>        <span class="hljs-variable language_">self</span>.buffer = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-variable language_">self</span>.buf_size = buf_size<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_read_limited</span>(<span class="hljs-params">self, size=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-keyword">if</span> size <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> size &gt; <span class="hljs-variable language_">self</span>.remaining:<br>            size = <span class="hljs-variable language_">self</span>.remaining<br>        <span class="hljs-keyword">if</span> size == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;&#x27;</span><br>        result = <span class="hljs-variable language_">self</span>.stream.read(size)<br>        <span class="hljs-variable language_">self</span>.remaining -= <span class="hljs-built_in">len</span>(result)<br>        <span class="hljs-keyword">return</span> result<br></code></pre></td></tr></table></figure><h2 id="QueryDict-ä¸“ç”¨å­—å…¸"><a href="#QueryDict-ä¸“ç”¨å­—å…¸" class="headerlink" title="QueryDict ä¸“ç”¨å­—å…¸"></a>QueryDict ä¸“ç”¨å­—å…¸</h2><h3 id="è®¾è®¡ç›®æ ‡"><a href="#è®¾è®¡ç›®æ ‡" class="headerlink" title="è®¾è®¡ç›®æ ‡"></a>è®¾è®¡ç›®æ ‡</h3><p>QueryDictè§£å†³äº†Webè¡¨å•çš„ç‰¹æ®Šéœ€æ±‚ï¼š</p><ul><li><strong>å¤šå€¼æ”¯æŒ</strong>ï¼šä¸€ä¸ªé”®å¯ä»¥æœ‰å¤šä¸ªå€¼ï¼ˆå¦‚å¤é€‰æ¡†ï¼‰</li><li><strong>ä¸å¯å˜æ€§</strong>ï¼šé»˜è®¤ä¸å¯å˜ï¼Œé˜²æ­¢æ„å¤–ä¿®æ”¹</li><li><strong>ç¼–ç å¤„ç†</strong>ï¼šè‡ªåŠ¨å¤„ç†å­—ç¬¦ç¼–ç è½¬æ¢</li></ul><h3 id="æ ¸å¿ƒç‰¹æ€§"><a href="#æ ¸å¿ƒç‰¹æ€§" class="headerlink" title="æ ¸å¿ƒç‰¹æ€§"></a>æ ¸å¿ƒç‰¹æ€§</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryDict</span>(<span class="hljs-title class_ inherited__">MultiValueDict</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ä¸“é—¨å¤„ç†æŸ¥è¯¢å­—ç¬¦ä¸²çš„MultiValueDict&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># é»˜è®¤ä¸å¯å˜</span><br>    _mutable = <span class="hljs-literal">True</span><br>    _encoding = <span class="hljs-literal">None</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, query_string=<span class="hljs-literal">None</span>, mutable=<span class="hljs-literal">False</span>, encoding=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-built_in">super</span>(QueryDict, <span class="hljs-variable language_">self</span>).__init__()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> encoding:<br>            encoding = settings.DEFAULT_CHARSET<br>        <span class="hljs-variable language_">self</span>.encoding = encoding<br>        <br>        <span class="hljs-comment"># è§£ææŸ¥è¯¢å­—ç¬¦ä¸²</span><br>        <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> limited_parse_qsl(query_string, **parse_qsl_kwargs):<br>            <span class="hljs-variable language_">self</span>.appendlist(key, value)<br>        <br>        <span class="hljs-variable language_">self</span>._mutable = mutable<br></code></pre></td></tr></table></figure><h3 id="ä¸å¯å˜æ€§ä¿æŠ¤"><a href="#ä¸å¯å˜æ€§ä¿æŠ¤" class="headerlink" title="ä¸å¯å˜æ€§ä¿æŠ¤"></a>ä¸å¯å˜æ€§ä¿æŠ¤</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_assert_mutable</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>._mutable:<br>        <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">&quot;This QueryDict instance is immutable&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__setitem__</span>(<span class="hljs-params">self, key, value</span>):<br>    <span class="hljs-variable language_">self</span>._assert_mutable()<br>    key = bytes_to_text(key, <span class="hljs-variable language_">self</span>.encoding)<br>    value = bytes_to_text(value, <span class="hljs-variable language_">self</span>.encoding)<br>    <span class="hljs-built_in">super</span>(QueryDict, <span class="hljs-variable language_">self</span>).__setitem__(key, value)<br></code></pre></td></tr></table></figure><h3 id="MultiValueDictè®¾è®¡é—®é¢˜"><a href="#MultiValueDictè®¾è®¡é—®é¢˜" class="headerlink" title="MultiValueDictè®¾è®¡é—®é¢˜"></a>MultiValueDictè®¾è®¡é—®é¢˜</h3><p><strong>é—®é¢˜</strong>ï¼š<code>__setitem__</code> ä¼šæ›¿æ¢æ•´ä¸ªåˆ—è¡¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">d = MultiValueDict()<br>d.appendlist(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;Adrian&#x27;</span>)<br>d.appendlist(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;Simon&#x27;</span>)  <span class="hljs-comment"># [&#x27;Adrian&#x27;, &#x27;Simon&#x27;]</span><br>d[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&#x27;John&#x27;</span>             <span class="hljs-comment"># [&#x27;John&#x27;] - æ•°æ®ä¸¢å¤±ï¼</span><br></code></pre></td></tr></table></figure><p><strong>è®¾è®¡è€ƒè™‘</strong>ï¼š</p><ul><li><strong>å…¼å®¹æ€§</strong>ï¼šä¿æŒä¸æ ‡å‡†å­—å…¸ç›¸ä¼¼çš„æ¥å£</li><li><strong>Webè¯­ä¹‰</strong>ï¼šHTMLè¡¨å•ä¸­åŒåå­—æ®µé€šå¸¸æ„å‘³ç€â€æ›¿æ¢â€</li><li><strong>å‘åå…¼å®¹</strong>ï¼šå¤§é‡ç°æœ‰ä»£ç ä¾èµ–å½“å‰è¡Œä¸º</li></ul><p><strong>æ¨èåšæ³•</strong>ï¼š</p><ul><li>æ˜ç¡®ä½¿ç”¨ <code>appendlist()</code> æ¥è¿½åŠ </li><li>æ˜ç¡®ä½¿ç”¨ <code>setlist()</code> æ¥æ›¿æ¢</li><li>é¿å…æ··ç”¨ <code>d[key] = value</code> å’Œ <code>appendlist()</code></li></ul><h2 id="ä¸­é—´ä»¶æ‰©å±•æœºåˆ¶"><a href="#ä¸­é—´ä»¶æ‰©å±•æœºåˆ¶" class="headerlink" title="ä¸­é—´ä»¶æ‰©å±•æœºåˆ¶"></a>ä¸­é—´ä»¶æ‰©å±•æœºåˆ¶</h2><p>Djangoé€šè¿‡ä¸­é—´ä»¶ç³»ç»ŸåŠ¨æ€åœ°å‘HttpRequestå¯¹è±¡æ·»åŠ å±æ€§ï¼š</p><h3 id="ç”¨æˆ·è®¤è¯"><a href="#ç”¨æˆ·è®¤è¯" class="headerlink" title="ç”¨æˆ·è®¤è¯"></a>ç”¨æˆ·è®¤è¯</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># AuthenticationMiddleware</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthenticationMiddleware</span>(<span class="hljs-title class_ inherited__">MiddlewareMixin</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_request</span>(<span class="hljs-params">self, request</span>):<br>        request.user = SimpleLazyObject(<span class="hljs-keyword">lambda</span>: get_user(request))<br></code></pre></td></tr></table></figure><h3 id="ä¼šè¯æ”¯æŒ"><a href="#ä¼šè¯æ”¯æŒ" class="headerlink" title="ä¼šè¯æ”¯æŒ"></a>ä¼šè¯æ”¯æŒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># SessionMiddleware</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SessionMiddleware</span>(<span class="hljs-title class_ inherited__">MiddlewareMixin</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_request</span>(<span class="hljs-params">self, request</span>):<br>        session_key = request.COOKIES.get(settings.SESSION_COOKIE_NAME)<br>        request.session = <span class="hljs-variable language_">self</span>.SessionStore(session_key)<br></code></pre></td></tr></table></figure><h3 id="CSRFä¿æŠ¤"><a href="#CSRFä¿æŠ¤" class="headerlink" title="CSRFä¿æŠ¤"></a>CSRFä¿æŠ¤</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># CsrfViewMiddleware</span><br><span class="hljs-comment"># æ·»åŠ  csrf_token, META[&#x27;CSRF_COOKIE&#x27;] ç­‰å±æ€§</span><br></code></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯æ¡†æ¶"><a href="#æ¶ˆæ¯æ¡†æ¶" class="headerlink" title="æ¶ˆæ¯æ¡†æ¶"></a>æ¶ˆæ¯æ¡†æ¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># MessageMiddleware</span><br><span class="hljs-comment"># æ·»åŠ  request._messages</span><br></code></pre></td></tr></table></figure><h2 id="å®‰å…¨ç‰¹æ€§æ€»ç»“"><a href="#å®‰å…¨ç‰¹æ€§æ€»ç»“" class="headerlink" title="å®‰å…¨ç‰¹æ€§æ€»ç»“"></a>å®‰å…¨ç‰¹æ€§æ€»ç»“</h2><h3 id="1-ä¸»æœºéªŒè¯"><a href="#1-ä¸»æœºéªŒè¯" class="headerlink" title="1. ä¸»æœºéªŒè¯"></a>1. ä¸»æœºéªŒè¯</h3><ul><li><strong>Hostå¤´æ”»å‡»é˜²æŠ¤</strong>ï¼šéªŒè¯Hostå¤´åœ¨ALLOWED_HOSTSä¸­</li><li><strong>è°ƒè¯•æ¨¡å¼å®‰å…¨</strong>ï¼šè°ƒè¯•æ—¶å…è®¸localhostå˜ä½“</li><li><strong>è¯¦ç»†é”™è¯¯ä¿¡æ¯</strong>ï¼šæä¾›æ˜ç¡®çš„é…ç½®æŒ‡å¯¼</li></ul><h3 id="2-Cookieå®‰å…¨"><a href="#2-Cookieå®‰å…¨" class="headerlink" title="2. Cookieå®‰å…¨"></a>2. Cookieå®‰å…¨</h3><ul><li><strong>ç­¾åéªŒè¯</strong>ï¼šé˜²æ­¢å®¢æˆ·ç«¯ç¯¡æ”¹cookieæ•°æ®</li><li><strong>æ—¶é—´éªŒè¯</strong>ï¼šæ”¯æŒcookieè¿‡æœŸæ—¶é—´æ£€æŸ¥</li><li><strong>ç›å€¼æ”¯æŒ</strong>ï¼šå¢å¼ºç­¾åå®‰å…¨æ€§</li></ul><h3 id="3-è¯·æ±‚ä½“ä¿æŠ¤"><a href="#3-è¯·æ±‚ä½“ä¿æŠ¤" class="headerlink" title="3. è¯·æ±‚ä½“ä¿æŠ¤"></a>3. è¯·æ±‚ä½“ä¿æŠ¤</h3><ul><li><strong>å¤§å°é™åˆ¶</strong>ï¼šé˜²æ­¢å†…å­˜è€—å°½æ”»å‡»</li><li><strong>æµå¼å¤„ç†</strong>ï¼šæ”¯æŒå¤§æ–‡ä»¶è€Œä¸å ç”¨è¿‡å¤šå†…å­˜</li><li><strong>é”™è¯¯æ¢å¤</strong>ï¼šIOé”™è¯¯æ—¶çš„ä¼˜é›…å¤„ç†</li></ul><h3 id="4-ç¼–ç å®‰å…¨"><a href="#4-ç¼–ç å®‰å…¨" class="headerlink" title="4. ç¼–ç å®‰å…¨"></a>4. ç¼–ç å®‰å…¨</h3><ul><li><strong>å­—ç¬¦é›†å¤„ç†</strong>ï¼šæ­£ç¡®å¤„ç†å„ç§å­—ç¬¦ç¼–ç </li><li><strong>é”™è¯¯æ›¿æ¢</strong>ï¼šç¼–ç é”™è¯¯æ—¶çš„å®‰å…¨é™çº§</li><li><strong>Unicodeæ ‡å‡†åŒ–</strong>ï¼šé˜²æ­¢ç¼–ç ç›¸å…³çš„å®‰å…¨é—®é¢˜</li></ul><h2 id="æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§"><a href="#æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§"></a>æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§</h2><h3 id="1-å»¶è¿ŸåŠ è½½"><a href="#1-å»¶è¿ŸåŠ è½½" class="headerlink" title="1. å»¶è¿ŸåŠ è½½"></a>1. å»¶è¿ŸåŠ è½½</h3><ul><li><strong>å±æ€§å»¶è¿Ÿ</strong>ï¼šGETã€COOKIESç­‰å±æ€§æŒ‰éœ€åˆ›å»º</li><li><strong>POSTå»¶è¿Ÿ</strong>ï¼šåªæœ‰è®¿é—®æ—¶æ‰è§£æPOSTæ•°æ®</li><li><strong>æ–‡ä»¶å»¶è¿Ÿ</strong>ï¼šæ–‡ä»¶ä¸Šä¼ æ•°æ®çš„å»¶è¿Ÿå¤„ç†</li></ul><h3 id="2-å†…å­˜ç®¡ç†"><a href="#2-å†…å­˜ç®¡ç†" class="headerlink" title="2. å†…å­˜ç®¡ç†"></a>2. å†…å­˜ç®¡ç†</h3><ul><li><strong>æµå¼è¯»å–</strong>ï¼šå¤§è¯·æ±‚çš„åˆ†å—å¤„ç†</li><li><strong>èµ„æºæ¸…ç†</strong>ï¼šç¡®ä¿æ–‡ä»¶å¥æŸ„æ­£ç¡®é‡Šæ”¾</li><li><strong>ç¼“å­˜æœºåˆ¶</strong>ï¼šé€‚å½“çš„å±æ€§ç¼“å­˜</li></ul><h3 id="3-ç¼–ç ä¼˜åŒ–"><a href="#3-ç¼–ç ä¼˜åŒ–" class="headerlink" title="3. ç¼–ç ä¼˜åŒ–"></a>3. ç¼–ç ä¼˜åŒ–</h3><ul><li><strong>ç¼–ç ç¼“å­˜</strong>ï¼šé¿å…é‡å¤çš„ç¼–ç è½¬æ¢</li><li><strong>æ‰¹é‡å¤„ç†</strong>ï¼šQueryDictçš„æ‰¹é‡æ“ä½œä¼˜åŒ–</li></ul><h2 id="é”™è¯¯å¤„ç†æœºåˆ¶"><a href="#é”™è¯¯å¤„ç†æœºåˆ¶" class="headerlink" title="é”™è¯¯å¤„ç†æœºåˆ¶"></a>é”™è¯¯å¤„ç†æœºåˆ¶</h2><h3 id="å¼‚å¸¸ä½“ç³»"><a href="#å¼‚å¸¸ä½“ç³»" class="headerlink" title="å¼‚å¸¸ä½“ç³»"></a>å¼‚å¸¸ä½“ç³»</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UnreadablePostError</span>(<span class="hljs-title class_ inherited__">IOError</span>)          <span class="hljs-comment"># POSTæ•°æ®æ— æ³•è¯»å–</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RawPostDataException</span>(<span class="hljs-title class_ inherited__">Exception</span>)       <span class="hljs-comment"># åŸå§‹æ•°æ®è®¿é—®é”™è¯¯  </span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DisallowedHost</span>(<span class="hljs-title class_ inherited__">Exception</span>)            <span class="hljs-comment"># ä¸å…è®¸çš„ä¸»æœº</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestDataTooBig</span>(<span class="hljs-title class_ inherited__">Exception</span>)         <span class="hljs-comment"># è¯·æ±‚æ•°æ®è¿‡å¤§</span><br></code></pre></td></tr></table></figure><h3 id="é”™è¯¯æ¢å¤"><a href="#é”™è¯¯æ¢å¤" class="headerlink" title="é”™è¯¯æ¢å¤"></a>é”™è¯¯æ¢å¤</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_mark_post_parse_error</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;POSTè§£æé”™è¯¯æ—¶çš„æ¢å¤æœºåˆ¶&quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>._post = QueryDict()<br>    <span class="hljs-variable language_">self</span>._files = MultiValueDict()<br>    <span class="hljs-variable language_">self</span>._post_parse_error = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><h3 id="èµ„æºæ¸…ç†"><a href="#èµ„æºæ¸…ç†" class="headerlink" title="èµ„æºæ¸…ç†"></a>èµ„æºæ¸…ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">close</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ç¡®ä¿ä¸Šä¼ æ–‡ä»¶å¾—åˆ°æ­£ç¡®æ¸…ç†&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(<span class="hljs-variable language_">self</span>, <span class="hljs-string">&#x27;_files&#x27;</span>):<br>        <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> chain.from_iterable(l[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>._files.lists()):<br>            f.close()<br></code></pre></td></tr></table></figure><h2 id="è®¾è®¡æ¨¡å¼å’ŒåŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼å’ŒåŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼å’ŒåŸåˆ™"></a>è®¾è®¡æ¨¡å¼å’ŒåŸåˆ™</h2><h3 id="1-æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#1-æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="1. æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>1. æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h3><ul><li><strong>HttpRequest</strong>ï¼šå®šä¹‰åŸºæœ¬æµç¨‹å’Œæ¥å£</li><li><strong>WSGIRequest</strong>ï¼šå®ç°å…·ä½“çš„WSGIç¯å¢ƒå¤„ç†</li><li><strong>é’©å­æ–¹æ³•</strong>ï¼š<code>_get_scheme()</code> ç­‰å¯é‡å†™æ–¹æ³•</li></ul><h3 id="2-ä»£ç†æ¨¡å¼"><a href="#2-ä»£ç†æ¨¡å¼" class="headerlink" title="2. ä»£ç†æ¨¡å¼"></a>2. ä»£ç†æ¨¡å¼</h3><ul><li><strong>SimpleLazyObject</strong>ï¼šå»¶è¿ŸåŠ è½½ç”¨æˆ·å¯¹è±¡</li><li><strong>cached_property</strong>ï¼šå±æ€§çº§åˆ«çš„å»¶è¿Ÿè®¡ç®—</li></ul><h3 id="3-ç­–ç•¥æ¨¡å¼"><a href="#3-ç­–ç•¥æ¨¡å¼" class="headerlink" title="3. ç­–ç•¥æ¨¡å¼"></a>3. ç­–ç•¥æ¨¡å¼</h3><ul><li><strong>ä¸Šä¼ å¤„ç†å™¨</strong>ï¼šå¯æ’æ‹”çš„æ–‡ä»¶å¤„ç†ç­–ç•¥</li><li><strong>ç¼–ç å¤„ç†</strong>ï¼šä¸åŒç¼–ç æ–¹å¼çš„å¤„ç†ç­–ç•¥</li></ul><h3 id="4-è´£ä»»é“¾æ¨¡å¼"><a href="#4-è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="4. è´£ä»»é“¾æ¨¡å¼"></a>4. è´£ä»»é“¾æ¨¡å¼</h3><ul><li><strong>ä¸­é—´ä»¶ç³»ç»Ÿ</strong>ï¼šè¯·æ±‚å¤„ç†çš„è´£ä»»é“¾</li><li><strong>ä¸Šä¼ å¤„ç†å™¨é“¾</strong>ï¼šæ–‡ä»¶å¤„ç†çš„è´£ä»»é“¾</li></ul><h2 id="å®é™…åº”ç”¨åœºæ™¯"><a href="#å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="å®é™…åº”ç”¨åœºæ™¯"></a>å®é™…åº”ç”¨åœºæ™¯</h2><h3 id="1-Webåº”ç”¨å¼€å‘"><a href="#1-Webåº”ç”¨å¼€å‘" class="headerlink" title="1. Webåº”ç”¨å¼€å‘"></a>1. Webåº”ç”¨å¼€å‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># åŸºæœ¬ä¿¡æ¯è®¿é—®</span><br>    method = request.method<br>    path = request.path<br>    user = request.user<br>    <br>    <span class="hljs-comment"># å‚æ•°è·å–</span><br>    search = request.GET.get(<span class="hljs-string">&#x27;q&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    username = request.POST.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>    <br>    <span class="hljs-comment"># æ–‡ä»¶å¤„ç†</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;avatar&#x27;</span> <span class="hljs-keyword">in</span> request.FILES:<br>        avatar = request.FILES[<span class="hljs-string">&#x27;avatar&#x27;</span>]<br>    <br>    <span class="hljs-comment"># å®‰å…¨åŠŸèƒ½</span><br>    <span class="hljs-keyword">if</span> request.is_secure():<br>        <span class="hljs-comment"># HTTPSå¤„ç†</span><br>        <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h3 id="2-APIå¼€å‘"><a href="#2-APIå¼€å‘" class="headerlink" title="2. APIå¼€å‘"></a>2. APIå¼€å‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">api_view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># JSONæ•°æ®å¤„ç†</span><br>    <span class="hljs-keyword">if</span> request.content_type == <span class="hljs-string">&#x27;application/json&#x27;</span>:<br>        data = json.loads(request.body)<br>    <br>    <span class="hljs-comment"># è®¤è¯æ£€æŸ¥</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request.user.is_authenticated:<br>        <span class="hljs-keyword">return</span> HttpResponseUnauthorized()<br>    <br>    <span class="hljs-comment"># æ„å»ºå“åº”URL</span><br>    callback_url = request.build_absolute_uri(<span class="hljs-string">&#x27;/callback/&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="3-æ–‡ä»¶ä¸Šä¼ æœåŠ¡"><a href="#3-æ–‡ä»¶ä¸Šä¼ æœåŠ¡" class="headerlink" title="3. æ–‡ä»¶ä¸Šä¼ æœåŠ¡"></a>3. æ–‡ä»¶ä¸Šä¼ æœåŠ¡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># è‡ªå®šä¹‰ä¸Šä¼ å¤„ç†å™¨</span><br>    request.upload_handlers = [CustomUploadHandler()]<br>    <br>    <span class="hljs-comment"># å¤„ç†å¤šæ–‡ä»¶ä¸Šä¼ </span><br>    <span class="hljs-keyword">for</span> field_name, file_obj <span class="hljs-keyword">in</span> request.FILES.items():<br>        <span class="hljs-comment"># å¤„ç†æ–‡ä»¶</span><br>        <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Djangoçš„HTTPè¯·æ±‚å¤„ç†æ¶æ„ä½“ç°äº†ä»¥ä¸‹è®¾è®¡ç†å¿µï¼š</p><h3 id="å®‰å…¨ç¬¬ä¸€"><a href="#å®‰å…¨ç¬¬ä¸€" class="headerlink" title="å®‰å…¨ç¬¬ä¸€"></a>å®‰å…¨ç¬¬ä¸€</h3><ul><li>å¤šå±‚æ¬¡çš„å®‰å…¨é˜²æŠ¤æœºåˆ¶</li><li>è¾“å…¥éªŒè¯å’Œè¾“å‡ºç¼–ç </li><li>æ”»å‡»å‘é‡çš„å…¨é¢é˜²èŒƒ</li></ul><h3 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h3><ul><li>å»¶è¿ŸåŠ è½½å’ŒæŒ‰éœ€è®¡ç®—</li><li>æµå¼å¤„ç†å¤§æ•°æ®</li><li>å†…å­˜ä½¿ç”¨çš„ç²¾ç»†æ§åˆ¶</li></ul><h3 id="æ‰©å±•æ€§å¼º"><a href="#æ‰©å±•æ€§å¼º" class="headerlink" title="æ‰©å±•æ€§å¼º"></a>æ‰©å±•æ€§å¼º</h3><ul><li>ä¸­é—´ä»¶çš„åŠ¨æ€æ‰©å±•æœºåˆ¶</li><li>å¯æ’æ‹”çš„å¤„ç†å™¨ç³»ç»Ÿ</li><li>æ¸…æ™°çš„ç»§æ‰¿å’Œé‡å†™æ¥å£</li></ul><h3 id="æ ‡å‡†å…¼å®¹"><a href="#æ ‡å‡†å…¼å®¹" class="headerlink" title="æ ‡å‡†å…¼å®¹"></a>æ ‡å‡†å…¼å®¹</h3><ul><li>å®Œæ•´çš„HTTPåè®®æ”¯æŒ</li><li>WSGIæ ‡å‡†çš„å®Œç¾å®ç°</li><li>RFCè§„èŒƒçš„ä¸¥æ ¼éµå¾ª</li></ul><p>é€šè¿‡HttpRequeståŸºç¡€ç±»å’ŒWSGIRequestå®ç°ç±»çš„åˆ†å±‚è®¾è®¡ï¼ŒDjangoæä¾›äº†æ—¢æŠ½è±¡åˆå®ç”¨çš„HTTPè¯·æ±‚å¤„ç†èƒ½åŠ›ï¼Œä¸ºWebåº”ç”¨å¼€å‘æä¾›äº†å¼ºå¤§è€Œå®‰å…¨çš„åŸºç¡€è®¾æ–½ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django HTTP Response</title>
    <link href="/2025/07/07/Django-HTTP-Response/"/>
    <url>/2025/07/07/Django-HTTP-Response/</url>
    
    <content type="html"><![CDATA[<h2 id="æ•´ä½“æ¶æ„æ¦‚è§ˆ"><a href="#æ•´ä½“æ¶æ„æ¦‚è§ˆ" class="headerlink" title="æ•´ä½“æ¶æ„æ¦‚è§ˆ"></a>æ•´ä½“æ¶æ„æ¦‚è§ˆ</h2><h3 id="ç±»ç»§æ‰¿å…³ç³»"><a href="#ç±»ç»§æ‰¿å…³ç³»" class="headerlink" title="ç±»ç»§æ‰¿å…³ç³»"></a>ç±»ç»§æ‰¿å…³ç³»</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åŸºç¡€æŠ½è±¡ç±»</span><br>HttpResponseBase (six.Iterator)<br>â”œâ”€â”€ HttpResponse                    <span class="hljs-comment"># æ ‡å‡†HTTPå“åº”</span><br>â”œâ”€â”€ StreamingHttpResponse          <span class="hljs-comment"># æµå¼HTTPå“åº”</span><br>â”‚   â””â”€â”€ FileResponse              <span class="hljs-comment"># æ–‡ä»¶å“åº”ä¼˜åŒ–</span><br>â””â”€â”€ HttpResponseRedirectBase       <span class="hljs-comment"># é‡å®šå‘å“åº”åŸºç±»</span><br>    â”œâ”€â”€ HttpResponseRedirect       <span class="hljs-comment"># ä¸´æ—¶é‡å®šå‘ (302)</span><br>    â””â”€â”€ HttpResponsePermanentRedirect <span class="hljs-comment"># æ°¸ä¹…é‡å®šå‘ (301)</span><br><br><span class="hljs-comment"># å…·ä½“çŠ¶æ€ç å“åº”ç±»</span><br>HttpResponse<br>â”œâ”€â”€ HttpResponseNotModified        <span class="hljs-comment"># 304</span><br>â”œâ”€â”€ HttpResponseBadRequest         <span class="hljs-comment"># 400</span><br>â”œâ”€â”€ HttpResponseForbidden          <span class="hljs-comment"># 403</span><br>â”œâ”€â”€ HttpResponseNotFound           <span class="hljs-comment"># 404</span><br>â”œâ”€â”€ HttpResponseNotAllowed         <span class="hljs-comment"># 405</span><br>â”œâ”€â”€ HttpResponseGone              <span class="hljs-comment"># 410</span><br>â”œâ”€â”€ HttpResponseServerError        <span class="hljs-comment"># 500</span><br>â””â”€â”€ JsonResponse                  <span class="hljs-comment"># JSONå“åº”</span><br></code></pre></td></tr></table></figure><h2 id="HttpResponseBase-åŸºç¡€ç±»è¯¦è§£"><a href="#HttpResponseBase-åŸºç¡€ç±»è¯¦è§£" class="headerlink" title="HttpResponseBase åŸºç¡€ç±»è¯¦è§£"></a>HttpResponseBase åŸºç¡€ç±»è¯¦è§£</h2><h3 id="1-æ ¸å¿ƒè®¾è®¡æ€æƒ³"><a href="#1-æ ¸å¿ƒè®¾è®¡æ€æƒ³" class="headerlink" title="1. æ ¸å¿ƒè®¾è®¡æ€æƒ³"></a>1. <strong>æ ¸å¿ƒè®¾è®¡æ€æƒ³</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponseBase</span>(six.Iterator):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    HTTPå“åº”åŸºç±»ï¼Œæä¾›å­—å…¸å¼çš„å¤´éƒ¨è®¿é—®æ¥å£</span><br><span class="hljs-string">    è¿™ä¸ªç±»ä¸å¤„ç†å†…å®¹ï¼Œä¸åº”ç›´æ¥ä½¿ç”¨</span><br><span class="hljs-string">    åº”è¯¥ä½¿ç”¨HttpResponseå’ŒStreamingHttpResponseå­ç±»</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    status_code = <span class="hljs-number">200</span><br></code></pre></td></tr></table></figure><p><strong>è®¾è®¡ç‰¹ç‚¹</strong>ï¼š</p><ul><li>ç»§æ‰¿è‡ª <code>six.Iterator</code>ï¼Œæ”¯æŒè¿­ä»£å™¨åè®®</li><li>åªå¤„ç†HTTPå¤´éƒ¨å’ŒçŠ¶æ€ç ï¼Œä¸å¤„ç†å“åº”ä½“</li><li>æä¾›ç»Ÿä¸€çš„HTTPå“åº”æ¥å£</li></ul><h3 id="2-åˆå§‹åŒ–è¿‡ç¨‹"><a href="#2-åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="2. åˆå§‹åŒ–è¿‡ç¨‹"></a>2. <strong>åˆå§‹åŒ–è¿‡ç¨‹</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, content_type=<span class="hljs-literal">None</span>, status=<span class="hljs-literal">None</span>, reason=<span class="hljs-literal">None</span>, charset=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-comment"># _headers: å­˜å‚¨HTTPå¤´éƒ¨çš„æ˜ å°„</span><br>    <span class="hljs-comment"># é”®æ˜¯å°å†™çš„å¤´éƒ¨åç§°ï¼Œå€¼æ˜¯(åŸå§‹å¤§å°å†™åç§°, å¤´éƒ¨å€¼)çš„å…ƒç»„</span><br>    <span class="hljs-variable language_">self</span>._headers = &#123;&#125;<br>    <br>    <span class="hljs-comment"># éœ€è¦å…³é—­çš„å¯¹è±¡åˆ—è¡¨ï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ï¼‰</span><br>    <span class="hljs-variable language_">self</span>._closable_objects = []<br>    <br>    <span class="hljs-comment"># å¤„ç†å™¨ç±»ï¼ˆç”¨äºrequest_finishedä¿¡å·ï¼‰</span><br>    <span class="hljs-variable language_">self</span>._handler_class = <span class="hljs-literal">None</span><br>    <br>    <span class="hljs-comment"># Cookieå®¹å™¨</span><br>    <span class="hljs-variable language_">self</span>.cookies = SimpleCookie()<br>    <br>    <span class="hljs-comment"># å…³é—­çŠ¶æ€æ ‡å¿—</span><br>    <span class="hljs-variable language_">self</span>.closed = <span class="hljs-literal">False</span><br>    <br>    <span class="hljs-comment"># çŠ¶æ€ç éªŒè¯</span><br>    <span class="hljs-keyword">if</span> status <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-variable language_">self</span>.status_code = <span class="hljs-built_in">int</span>(status)<br>        <span class="hljs-keyword">except</span> (ValueError, TypeError):<br>            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">&#x27;HTTP status code must be an integer.&#x27;</span>)<br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-number">100</span> &lt;= <span class="hljs-variable language_">self</span>.status_code &lt;= <span class="hljs-number">599</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;HTTP status code must be an integer from 100 to 599.&#x27;</span>)<br>    <br>    <span class="hljs-comment"># è®¾ç½®é»˜è®¤Content-Type</span><br>    <span class="hljs-keyword">if</span> content_type <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        content_type = <span class="hljs-string">&#x27;%s; charset=%s&#x27;</span> % (settings.DEFAULT_CONTENT_TYPE, <span class="hljs-variable language_">self</span>.charset)<br>    <span class="hljs-variable language_">self</span>[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] = content_type<br></code></pre></td></tr></table></figure><p><strong>å…³é”®ç‰¹æ€§</strong>ï¼š</p><ul><li><strong>çŠ¶æ€ç éªŒè¯</strong>ï¼šç¡®ä¿çŠ¶æ€ç åœ¨100-599èŒƒå›´å†…</li><li><strong>å­—ç¬¦é›†å¤„ç†</strong>ï¼šè‡ªåŠ¨è®¾ç½®é»˜è®¤å­—ç¬¦é›†</li><li><strong>èµ„æºç®¡ç†</strong>ï¼šç»´æŠ¤éœ€è¦å…³é—­çš„å¯¹è±¡åˆ—è¡¨</li></ul><h3 id="3-HTTPå¤´éƒ¨å¤„ç†"><a href="#3-HTTPå¤´éƒ¨å¤„ç†" class="headerlink" title="3. HTTPå¤´éƒ¨å¤„ç†"></a>3. <strong>HTTPå¤´éƒ¨å¤„ç†</strong></h3><h4 id="3-1-å­—å…¸å¼æ¥å£"><a href="#3-1-å­—å…¸å¼æ¥å£" class="headerlink" title="3.1 å­—å…¸å¼æ¥å£"></a>3.1 å­—å…¸å¼æ¥å£</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__setitem__</span>(<span class="hljs-params">self, header, value</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è®¾ç½®HTTPå¤´éƒ¨&quot;&quot;&quot;</span><br>    header = <span class="hljs-variable language_">self</span>._convert_to_charset(header, <span class="hljs-string">&#x27;ascii&#x27;</span>)<br>    value = <span class="hljs-variable language_">self</span>._convert_to_charset(value, <span class="hljs-string">&#x27;latin-1&#x27;</span>, mime_encode=<span class="hljs-literal">True</span>)<br>    <span class="hljs-comment"># å­˜å‚¨ï¼šå°å†™é”® -&gt; (åŸå§‹é”®, å€¼)</span><br>    <span class="hljs-variable language_">self</span>._headers[header.lower()] = (header, value)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, header</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–HTTPå¤´éƒ¨å€¼&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._headers[header.lower()][<span class="hljs-number">1</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__delitem__</span>(<span class="hljs-params">self, header</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;åˆ é™¤HTTPå¤´éƒ¨&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">del</span> <span class="hljs-variable language_">self</span>._headers[header.lower()]<br>    <span class="hljs-keyword">except</span> KeyError:<br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">has_header</span>(<span class="hljs-params">self, header</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸä¸ªå¤´éƒ¨ï¼ˆå¤§å°å†™ä¸æ•æ„Ÿï¼‰&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> header.lower() <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>._headers<br></code></pre></td></tr></table></figure><p><strong>è®¾è®¡äº®ç‚¹</strong>ï¼š</p><ul><li><strong>å¤§å°å†™ä¸æ•æ„Ÿ</strong>ï¼šHTTPå¤´éƒ¨åç§°ä¸åŒºåˆ†å¤§å°å†™</li><li><strong>åŸå§‹æ ¼å¼ä¿ç•™</strong>ï¼šä¿æŒåŸå§‹çš„å¤§å°å†™æ ¼å¼ï¼Œå…¼å®¹è€ç³»ç»Ÿ</li><li><strong>ç¼–ç å®‰å…¨</strong>ï¼šè‡ªåŠ¨å¤„ç†ASCIIå’ŒLatin-1ç¼–ç </li></ul><h4 id="3-2-ç¼–ç è½¬æ¢æœºåˆ¶"><a href="#3-2-ç¼–ç è½¬æ¢æœºåˆ¶" class="headerlink" title="3.2 ç¼–ç è½¬æ¢æœºåˆ¶"></a>3.2 ç¼–ç è½¬æ¢æœºåˆ¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_convert_to_charset</span>(<span class="hljs-params">self, value, charset, mime_encode=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å°†å¤´éƒ¨é”®/å€¼è½¬æ¢ä¸ºascii/latin-1æœ¬åœ°å­—ç¬¦ä¸²&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, (<span class="hljs-built_in">bytes</span>, six.text_type)):<br>        value = <span class="hljs-built_in">str</span>(value)<br>    <br>    <span class="hljs-comment"># é˜²æ­¢å¤´éƒ¨æ³¨å…¥æ”»å‡»</span><br>    <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">isinstance</span>(value, <span class="hljs-built_in">bytes</span>) <span class="hljs-keyword">and</span> (<span class="hljs-string">b&#x27;\n&#x27;</span> <span class="hljs-keyword">in</span> value <span class="hljs-keyword">or</span> <span class="hljs-string">b&#x27;\r&#x27;</span> <span class="hljs-keyword">in</span> value)) <span class="hljs-keyword">or</span><br>            <span class="hljs-built_in">isinstance</span>(value, six.text_type) <span class="hljs-keyword">and</span> (<span class="hljs-string">&#x27;\n&#x27;</span> <span class="hljs-keyword">in</span> value <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;\r&#x27;</span> <span class="hljs-keyword">in</span> value)):<br>        <span class="hljs-keyword">raise</span> BadHeaderError(<span class="hljs-string">&quot;Header values can&#x27;t contain newlines (got %r)&quot;</span> % value)<br>    <br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> six.PY3:<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(value, <span class="hljs-built_in">str</span>):<br>                value.encode(charset)  <span class="hljs-comment"># éªŒè¯ç¼–ç </span><br>            <span class="hljs-keyword">else</span>:<br>                value = value.decode(charset)  <span class="hljs-comment"># è§£ç å­—èŠ‚ä¸²</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># Python 2å¤„ç†é€»è¾‘</span><br>            <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">except</span> UnicodeError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">if</span> mime_encode:<br>            <span class="hljs-comment"># MIMEç¼–ç å¤„ç†éASCIIå­—ç¬¦</span><br>            value = <span class="hljs-built_in">str</span>(Header(value, <span class="hljs-string">&#x27;utf-8&#x27;</span>, maxlinelen=sys.maxsize).encode())<br>        <span class="hljs-keyword">else</span>:<br>            e.reason += <span class="hljs-string">&#x27;, HTTP response headers must be in %s format&#x27;</span> % charset<br>            <span class="hljs-keyword">raise</span><br>    <span class="hljs-keyword">return</span> value<br></code></pre></td></tr></table></figure><p><strong>å®‰å…¨ç‰¹æ€§</strong>ï¼š</p><ul><li><strong>å¤´éƒ¨æ³¨å…¥é˜²æŠ¤</strong>ï¼šæ£€æµ‹å¹¶é˜»æ­¢æ¢è¡Œç¬¦æ³¨å…¥</li><li><strong>ç¼–ç éªŒè¯</strong>ï¼šç¡®ä¿å¤´éƒ¨å€¼ç¬¦åˆHTTPæ ‡å‡†</li><li><strong>MIMEç¼–ç æ”¯æŒ</strong>ï¼šè‡ªåŠ¨å¤„ç†éASCIIå­—ç¬¦</li></ul><h3 id="4-Cookieå¤„ç†æœºåˆ¶"><a href="#4-Cookieå¤„ç†æœºåˆ¶" class="headerlink" title="4. Cookieå¤„ç†æœºåˆ¶"></a>4. <strong>Cookieå¤„ç†æœºåˆ¶</strong></h3><h4 id="4-1-åŸºæœ¬Cookieè®¾ç½®"><a href="#4-1-åŸºæœ¬Cookieè®¾ç½®" class="headerlink" title="4.1 åŸºæœ¬Cookieè®¾ç½®"></a>4.1 åŸºæœ¬Cookieè®¾ç½®</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_cookie</span>(<span class="hljs-params">self, key, value=<span class="hljs-string">&#x27;&#x27;</span>, max_age=<span class="hljs-literal">None</span>, expires=<span class="hljs-literal">None</span>, path=<span class="hljs-string">&#x27;/&#x27;</span>,</span><br><span class="hljs-params">               domain=<span class="hljs-literal">None</span>, secure=<span class="hljs-literal">False</span>, httponly=<span class="hljs-literal">False</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è®¾ç½®Cookie&quot;&quot;&quot;</span><br>    value = force_str(value)<br>    <span class="hljs-variable language_">self</span>.cookies[key] = value<br>    <br>    <span class="hljs-comment"># å¤„ç†è¿‡æœŸæ—¶é—´</span><br>    <span class="hljs-keyword">if</span> expires <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(expires, datetime.datetime):<br>            <span class="hljs-keyword">if</span> timezone.is_aware(expires):<br>                expires = timezone.make_naive(expires, timezone.utc)<br>            delta = expires - expires.utcnow()<br>            <span class="hljs-comment"># æ·»åŠ ä¸€ç§’ç¡®ä¿æ—¶é—´åŒ¹é…</span><br>            delta = delta + datetime.timedelta(seconds=<span class="hljs-number">1</span>)<br>            expires = <span class="hljs-literal">None</span><br>            max_age = <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, delta.days * <span class="hljs-number">86400</span> + delta.seconds)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;expires&#x27;</span>] = expires<br>    <br>    <span class="hljs-comment"># è®¾ç½®å„ç§Cookieå±æ€§</span><br>    <span class="hljs-keyword">if</span> max_age <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;max-age&#x27;</span>] = max_age<br>        <span class="hljs-comment"># IEéœ€è¦expiresï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®åˆ™è‡ªåŠ¨æ·»åŠ </span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> expires:<br>            <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;expires&#x27;</span>] = cookie_date(time.time() + max_age)<br>    <br>    <span class="hljs-keyword">if</span> path <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;path&#x27;</span>] = path<br>    <span class="hljs-keyword">if</span> domain <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;domain&#x27;</span>] = domain<br>    <span class="hljs-keyword">if</span> secure:<br>        <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;secure&#x27;</span>] = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">if</span> httponly:<br>        <span class="hljs-variable language_">self</span>.cookies[key][<span class="hljs-string">&#x27;httponly&#x27;</span>] = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><h4 id="4-2-ç­¾åCookieæ”¯æŒ"><a href="#4-2-ç­¾åCookieæ”¯æŒ" class="headerlink" title="4.2 ç­¾åCookieæ”¯æŒ"></a>4.2 ç­¾åCookieæ”¯æŒ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_signed_cookie</span>(<span class="hljs-params">self, key, value, salt=<span class="hljs-string">&#x27;&#x27;</span>, **kwargs</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è®¾ç½®ç­¾åCookieï¼Œé˜²æ­¢ç¯¡æ”¹&quot;&quot;&quot;</span><br>    value = signing.get_cookie_signer(salt=key + salt).sign(value)<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.set_cookie(key, value, **kwargs)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_cookie</span>(<span class="hljs-params">self, key, path=<span class="hljs-string">&#x27;/&#x27;</span>, domain=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;åˆ é™¤Cookieï¼ˆé€šè¿‡è®¾ç½®è¿‡æœŸæ—¶é—´ä¸ºè¿‡å»ï¼‰&quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>.set_cookie(key, max_age=<span class="hljs-number">0</span>, path=path, domain=domain,<br>                    expires=<span class="hljs-string">&#x27;Thu, 01-Jan-1970 00:00:00 GMT&#x27;</span>)<br></code></pre></td></tr></table></figure><p><strong>å®‰å…¨è€ƒè™‘</strong>ï¼š</p><ul><li><strong>ç­¾åéªŒè¯</strong>ï¼šé˜²æ­¢å®¢æˆ·ç«¯ç¯¡æ”¹Cookieå€¼</li><li><strong>ç›å€¼æ”¯æŒ</strong>ï¼šå¢å¼ºç­¾åå®‰å…¨æ€§</li><li><strong>å®‰å…¨å±æ€§</strong>ï¼šæ”¯æŒSecureå’ŒHttpOnlyæ ‡å¿—</li></ul><h3 id="5-èµ„æºç®¡ç†"><a href="#5-èµ„æºç®¡ç†" class="headerlink" title="5. èµ„æºç®¡ç†"></a>5. <strong>èµ„æºç®¡ç†</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">close</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å…³é—­å“åº”ï¼Œæ¸…ç†èµ„æº&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> closable <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>._closable_objects:<br>        <span class="hljs-keyword">try</span>:<br>            closable.close()<br>        <span class="hljs-keyword">except</span> Exception:<br>            <span class="hljs-keyword">pass</span><br>    <span class="hljs-variable language_">self</span>.closed = <span class="hljs-literal">True</span><br>    <span class="hljs-comment"># å‘é€è¯·æ±‚å®Œæˆä¿¡å·</span><br>    signals.request_finished.send(sender=<span class="hljs-variable language_">self</span>._handler_class)<br></code></pre></td></tr></table></figure><p><strong>é‡è¦æ€§</strong>ï¼š</p><ul><li><strong>æ–‡ä»¶å¥æŸ„æ¸…ç†</strong>ï¼šç¡®ä¿æ–‡ä»¶ç­‰èµ„æºæ­£ç¡®é‡Šæ”¾</li><li><strong>ä¿¡å·å‘é€</strong>ï¼šé€šçŸ¥Djangoè¯·æ±‚å¤„ç†å®Œæˆ</li><li><strong>å¼‚å¸¸å®‰å…¨</strong>ï¼šå³ä½¿å…³é—­å¤±è´¥ä¹Ÿä¸å½±å“å…¶ä»–èµ„æº</li></ul><h2 id="HttpResponse-æ ‡å‡†å“åº”ç±»"><a href="#HttpResponse-æ ‡å‡†å“åº”ç±»" class="headerlink" title="HttpResponse æ ‡å‡†å“åº”ç±»"></a>HttpResponse æ ‡å‡†å“åº”ç±»</h2><h3 id="1-å†…å®¹ç®¡ç†"><a href="#1-å†…å®¹ç®¡ç†" class="headerlink" title="1. å†…å®¹ç®¡ç†"></a>1. <strong>å†…å®¹ç®¡ç†</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponse</span>(<span class="hljs-title class_ inherited__">HttpResponseBase</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å¸¦æœ‰å­—ç¬¦ä¸²å†…å®¹çš„HTTPå“åº”ç±»&quot;&quot;&quot;</span><br>    streaming = <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, content=<span class="hljs-string">b&#x27;&#x27;</span>, *args, **kwargs</span>):<br>        <span class="hljs-built_in">super</span>(HttpResponse, <span class="hljs-variable language_">self</span>).__init__(*args, **kwargs)<br>        <span class="hljs-variable language_">self</span>.content = content<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">content</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;è·å–å®Œæ•´å†…å®¹&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;&#x27;</span>.join(<span class="hljs-variable language_">self</span>._container)<br><br><span class="hljs-meta">    @content.setter</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">content</span>(<span class="hljs-params">self, value</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;è®¾ç½®å†…å®¹ï¼Œæ”¯æŒè¿­ä»£å™¨&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(value, <span class="hljs-string">&#x27;__iter__&#x27;</span>) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, (<span class="hljs-built_in">bytes</span>, six.string_types)):<br>            <span class="hljs-comment"># å¤„ç†è¿­ä»£å™¨å†…å®¹</span><br>            content = <span class="hljs-string">b&#x27;&#x27;</span>.join(<span class="hljs-variable language_">self</span>.make_bytes(chunk) <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> value)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(value, <span class="hljs-string">&#x27;close&#x27;</span>):<br>                <span class="hljs-keyword">try</span>:<br>                    value.close()<br>                <span class="hljs-keyword">except</span> Exception:<br>                    <span class="hljs-keyword">pass</span><br>        <span class="hljs-keyword">else</span>:<br>            content = <span class="hljs-variable language_">self</span>.make_bytes(value)<br>        <br>        <span class="hljs-comment"># åˆ›å»ºæ­£ç¡®ç¼–ç çš„å­—èŠ‚ä¸²åˆ—è¡¨</span><br>        <span class="hljs-variable language_">self</span>._container = [content]<br></code></pre></td></tr></table></figure><p><strong>è®¾è®¡ç‰¹ç‚¹</strong>ï¼š</p><ul><li><strong>ç»Ÿä¸€å­—èŠ‚å¤„ç†</strong>ï¼šæ‰€æœ‰å†…å®¹æœ€ç»ˆè½¬æ¢ä¸ºå­—èŠ‚ä¸²</li><li><strong>è¿­ä»£å™¨æ”¯æŒ</strong>ï¼šå¯ä»¥æ¥å—è¿­ä»£å™¨ä½œä¸ºå†…å®¹</li><li><strong>èµ„æºæ¸…ç†</strong>ï¼šè‡ªåŠ¨å…³é—­å¯å…³é—­çš„å†…å®¹å¯¹è±¡</li></ul><h3 id="2-å¯å†™æ¥å£"><a href="#2-å¯å†™æ¥å£" class="headerlink" title="2. å¯å†™æ¥å£"></a>2. <strong>å¯å†™æ¥å£</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">write</span>(<span class="hljs-params">self, content</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è¿½åŠ å†…å®¹åˆ°å“åº”&quot;&quot;&quot;</span><br>    <span class="hljs-variable language_">self</span>._container.append(<span class="hljs-variable language_">self</span>.make_bytes(content))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">writelines</span>(<span class="hljs-params">self, lines</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å†™å…¥å¤šè¡Œå†…å®¹&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>        <span class="hljs-variable language_">self</span>.write(line)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">writable</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æŒ‡ç¤ºå“åº”æ˜¯å¦å¯å†™&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><h3 id="3-åºåˆ—åŒ–"><a href="#3-åºåˆ—åŒ–" class="headerlink" title="3. åºåˆ—åŒ–"></a>3. <strong>åºåˆ—åŒ–</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">serialize</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å®Œæ•´çš„HTTPæ¶ˆæ¯ï¼ŒåŒ…æ‹¬å¤´éƒ¨ï¼Œä½œä¸ºå­—èŠ‚ä¸²&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.serialize_headers() + <span class="hljs-string">b&#x27;\r\n\r\n&#x27;</span> + <span class="hljs-variable language_">self</span>.content<br></code></pre></td></tr></table></figure><h2 id="StreamingHttpResponse-æµå¼å“åº”"><a href="#StreamingHttpResponse-æµå¼å“åº”" class="headerlink" title="StreamingHttpResponse æµå¼å“åº”"></a>StreamingHttpResponse æµå¼å“åº”</h2><h3 id="1-è®¾è®¡ç›®æ ‡"><a href="#1-è®¾è®¡ç›®æ ‡" class="headerlink" title="1. è®¾è®¡ç›®æ ‡"></a>1. <strong>è®¾è®¡ç›®æ ‡</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamingHttpResponse</span>(<span class="hljs-title class_ inherited__">HttpResponseBase</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å¸¦æœ‰è¿­ä»£å™¨å†…å®¹çš„æµå¼HTTPå“åº”ç±»</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    åªåº”è¯¥è¿­ä»£ä¸€æ¬¡ï¼Œå½“å“åº”æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯æ—¶</span><br><span class="hljs-string">    ä½†æ˜¯å¯ä»¥è¢«è¿½åŠ æˆ–æ›¿æ¢ä¸ºåŒ…è£…åŸå§‹å†…å®¹çš„æ–°è¿­ä»£å™¨</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    streaming = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>å¤§æ–‡ä»¶ä¸‹è½½</li><li>å®æ—¶æ•°æ®æµ</li><li>å†…å­˜æ•æ„Ÿçš„å“åº”</li></ul><h3 id="2-æµå¼å†…å®¹å¤„ç†"><a href="#2-æµå¼å†…å®¹å¤„ç†" class="headerlink" title="2. æµå¼å†…å®¹å¤„ç†"></a>2. <strong>æµå¼å†…å®¹å¤„ç†</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">streaming_content</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æµå¼å†…å®¹å±æ€§&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">map</span>(<span class="hljs-variable language_">self</span>.make_bytes, <span class="hljs-variable language_">self</span>._iterator)<br><br><span class="hljs-meta">@streaming_content.setter</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">streaming_content</span>(<span class="hljs-params">self, value</span>):<br>    <span class="hljs-variable language_">self</span>._set_streaming_content(value)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_set_streaming_content</span>(<span class="hljs-params">self, value</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è®¾ç½®æµå¼å†…å®¹&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># ç¡®ä¿æ°¸è¿œä¸èƒ½åœ¨&quot;value&quot;ä¸Šè¿­ä»£è¶…è¿‡ä¸€æ¬¡</span><br>    <span class="hljs-variable language_">self</span>._iterator = <span class="hljs-built_in">iter</span>(value)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(value, <span class="hljs-string">&#x27;close&#x27;</span>):<br>        <span class="hljs-variable language_">self</span>._closable_objects.append(value)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.streaming_content<br><br><span class="hljs-meta">@property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">content</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æµå¼å“åº”æ²¡æœ‰contentå±æ€§&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">raise</span> AttributeError(<br>        <span class="hljs-string">&quot;This %s instance has no `content` attribute. Use &quot;</span><br>        <span class="hljs-string">&quot;`streaming_content` instead.&quot;</span> % <span class="hljs-variable language_">self</span>.__class__.__name__<br>    )<br></code></pre></td></tr></table></figure><p><strong>å…³é”®ç‰¹æ€§</strong>ï¼š</p><ul><li><strong>ä¸€æ¬¡æ€§è¿­ä»£</strong>ï¼šé˜²æ­¢é‡å¤æ¶ˆè´¹æµå†…å®¹</li><li><strong>å»¶è¿Ÿå¤„ç†</strong>ï¼šå†…å®¹æŒ‰éœ€ç”Ÿæˆå’Œä¼ è¾“</li><li><strong>èµ„æºç®¡ç†</strong>ï¼šè‡ªåŠ¨ç®¡ç†æµå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</li></ul><h2 id="FileResponse-æ–‡ä»¶å“åº”ä¼˜åŒ–"><a href="#FileResponse-æ–‡ä»¶å“åº”ä¼˜åŒ–" class="headerlink" title="FileResponse æ–‡ä»¶å“åº”ä¼˜åŒ–"></a>FileResponse æ–‡ä»¶å“åº”ä¼˜åŒ–</h2><h3 id="1-æ–‡ä»¶ç‰¹åŒ–å¤„ç†"><a href="#1-æ–‡ä»¶ç‰¹åŒ–å¤„ç†" class="headerlink" title="1. æ–‡ä»¶ç‰¹åŒ–å¤„ç†"></a>1. <strong>æ–‡ä»¶ç‰¹åŒ–å¤„ç†</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileResponse</span>(<span class="hljs-title class_ inherited__">StreamingHttpResponse</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ä¸ºæ–‡ä»¶ä¼˜åŒ–çš„æµå¼HTTPå“åº”ç±»&quot;&quot;&quot;</span><br>    block_size = <span class="hljs-number">4096</span>  <span class="hljs-comment"># 4KBå—å¤§å°</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_set_streaming_content</span>(<span class="hljs-params">self, value</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(value, <span class="hljs-string">&#x27;read&#x27;</span>):<br>            <span class="hljs-comment"># æ–‡ä»¶å¯¹è±¡å¤„ç†</span><br>            <span class="hljs-variable language_">self</span>.file_to_stream = value<br>            filelike = value<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(filelike, <span class="hljs-string">&#x27;close&#x27;</span>):<br>                <span class="hljs-variable language_">self</span>._closable_objects.append(filelike)<br>            <span class="hljs-comment"># åˆ›å»ºåˆ†å—è¯»å–è¿­ä»£å™¨</span><br>            value = <span class="hljs-built_in">iter</span>(<span class="hljs-keyword">lambda</span>: filelike.read(<span class="hljs-variable language_">self</span>.block_size), <span class="hljs-string">b&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.file_to_stream = <span class="hljs-literal">None</span><br>        <span class="hljs-built_in">super</span>(FileResponse, <span class="hljs-variable language_">self</span>)._set_streaming_content(value)<br></code></pre></td></tr></table></figure><p><strong>ä¼˜åŒ–ç‰¹æ€§</strong>ï¼š</p><ul><li><strong>åˆ†å—è¯»å–</strong>ï¼šé¿å…å¤§æ–‡ä»¶ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜</li><li><strong>WSGIä¼˜åŒ–</strong>ï¼š<code>file_to_stream</code>å±æ€§å¯è¢«WSGIæœåŠ¡å™¨ä¼˜åŒ–ä½¿ç”¨</li><li><strong>è‡ªåŠ¨æ¸…ç†</strong>ï¼šç¡®ä¿æ–‡ä»¶å¥æŸ„æ­£ç¡®å…³é—­</li></ul><h2 id="é‡å®šå‘å“åº”ç³»åˆ—"><a href="#é‡å®šå‘å“åº”ç³»åˆ—" class="headerlink" title="é‡å®šå‘å“åº”ç³»åˆ—"></a>é‡å®šå‘å“åº”ç³»åˆ—</h2><h3 id="1-åŸºç¡€é‡å®šå‘ç±»"><a href="#1-åŸºç¡€é‡å®šå‘ç±»" class="headerlink" title="1. åŸºç¡€é‡å®šå‘ç±»"></a>1. <strong>åŸºç¡€é‡å®šå‘ç±»</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponseRedirectBase</span>(<span class="hljs-title class_ inherited__">HttpResponse</span>):<br>    allowed_schemes = [<span class="hljs-string">&#x27;http&#x27;</span>, <span class="hljs-string">&#x27;https&#x27;</span>, <span class="hljs-string">&#x27;ftp&#x27;</span>]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, redirect_to, *args, **kwargs</span>):<br>        <span class="hljs-built_in">super</span>(HttpResponseRedirectBase, <span class="hljs-variable language_">self</span>).__init__(*args, **kwargs)<br>        <span class="hljs-variable language_">self</span>[<span class="hljs-string">&#x27;Location&#x27;</span>] = iri_to_uri(redirect_to)<br>        <br>        <span class="hljs-comment"># å®‰å…¨æ£€æŸ¥ï¼šéªŒè¯é‡å®šå‘URLçš„åè®®</span><br>        parsed = urlparse(force_text(redirect_to))<br>        <span class="hljs-keyword">if</span> parsed.scheme <span class="hljs-keyword">and</span> parsed.scheme <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.allowed_schemes:<br>            <span class="hljs-keyword">raise</span> DisallowedRedirect(<span class="hljs-string">&quot;Unsafe redirect to URL with protocol &#x27;%s&#x27;&quot;</span> % parsed.scheme)<br><br>    url = <span class="hljs-built_in">property</span>(<span class="hljs-keyword">lambda</span> <span class="hljs-variable language_">self</span>: <span class="hljs-variable language_">self</span>[<span class="hljs-string">&#x27;Location&#x27;</span>])<br></code></pre></td></tr></table></figure><p><strong>å®‰å…¨ç‰¹æ€§</strong>ï¼š</p><ul><li><strong>åè®®ç™½åå•</strong>ï¼šåªå…è®¸å®‰å…¨çš„URLåè®®</li><li><strong>å¼€æ”¾é‡å®šå‘é˜²æŠ¤</strong>ï¼šé˜²æ­¢æ¶æ„é‡å®šå‘æ”»å‡»</li></ul><h3 id="2-å…·ä½“é‡å®šå‘ç±»"><a href="#2-å…·ä½“é‡å®šå‘ç±»" class="headerlink" title="2. å…·ä½“é‡å®šå‘ç±»"></a>2. <strong>å…·ä½“é‡å®šå‘ç±»</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponseRedirect</span>(<span class="hljs-title class_ inherited__">HttpResponseRedirectBase</span>):<br>    status_code = <span class="hljs-number">302</span>  <span class="hljs-comment"># ä¸´æ—¶é‡å®šå‘</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponsePermanentRedirect</span>(<span class="hljs-title class_ inherited__">HttpResponseRedirectBase</span>):<br>    status_code = <span class="hljs-number">301</span>  <span class="hljs-comment"># æ°¸ä¹…é‡å®šå‘</span><br></code></pre></td></tr></table></figure><h2 id="çŠ¶æ€ç å“åº”ç±»"><a href="#çŠ¶æ€ç å“åº”ç±»" class="headerlink" title="çŠ¶æ€ç å“åº”ç±»"></a>çŠ¶æ€ç å“åº”ç±»</h2><h3 id="1-ç‰¹æ®ŠçŠ¶æ€å¤„ç†"><a href="#1-ç‰¹æ®ŠçŠ¶æ€å¤„ç†" class="headerlink" title="1. ç‰¹æ®ŠçŠ¶æ€å¤„ç†"></a>1. <strong>ç‰¹æ®ŠçŠ¶æ€å¤„ç†</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponseNotModified</span>(<span class="hljs-title class_ inherited__">HttpResponse</span>):<br>    status_code = <span class="hljs-number">304</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *args, **kwargs</span>):<br>        <span class="hljs-built_in">super</span>(HttpResponseNotModified, <span class="hljs-variable language_">self</span>).__init__(*args, **kwargs)<br>        <span class="hljs-comment"># 304å“åº”ä¸åº”è¯¥æœ‰Content-Typeå¤´</span><br>        <span class="hljs-keyword">del</span> <span class="hljs-variable language_">self</span>[<span class="hljs-string">&#x27;content-type&#x27;</span>]<br><br><span class="hljs-meta">    @HttpResponse.content.setter</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">content</span>(<span class="hljs-params">self, value</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;304å“åº”ä¸èƒ½æœ‰å†…å®¹&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> value:<br>            <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">&quot;You cannot set content to a 304 (Not Modified) response&quot;</span>)<br>        <span class="hljs-variable language_">self</span>._container = []<br></code></pre></td></tr></table></figure><h3 id="2-æ–¹æ³•ä¸å…è®¸å“åº”"><a href="#2-æ–¹æ³•ä¸å…è®¸å“åº”" class="headerlink" title="2. æ–¹æ³•ä¸å…è®¸å“åº”"></a>2. <strong>æ–¹æ³•ä¸å…è®¸å“åº”</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpResponseNotAllowed</span>(<span class="hljs-title class_ inherited__">HttpResponse</span>):<br>    status_code = <span class="hljs-number">405</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, permitted_methods, *args, **kwargs</span>):<br>        <span class="hljs-built_in">super</span>(HttpResponseNotAllowed, <span class="hljs-variable language_">self</span>).__init__(*args, **kwargs)<br>        <span class="hljs-comment"># å¿…é¡»åŒ…å«Allowå¤´ï¼Œåˆ—å‡ºå…è®¸çš„æ–¹æ³•</span><br>        <span class="hljs-variable language_">self</span>[<span class="hljs-string">&#x27;Allow&#x27;</span>] = <span class="hljs-string">&#x27;, &#x27;</span>.join(permitted_methods)<br></code></pre></td></tr></table></figure><h2 id="JsonResponse-JSONå“åº”"><a href="#JsonResponse-JSONå“åº”" class="headerlink" title="JsonResponse JSONå“åº”"></a>JsonResponse JSONå“åº”</h2><h3 id="1-JSONç‰¹åŒ–å¤„ç†"><a href="#1-JSONç‰¹åŒ–å¤„ç†" class="headerlink" title="1. JSONç‰¹åŒ–å¤„ç†"></a>1. <strong>JSONç‰¹åŒ–å¤„ç†</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonResponse</span>(<span class="hljs-title class_ inherited__">HttpResponse</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ¶ˆè´¹æ•°æ®å¹¶åºåˆ—åŒ–ä¸ºJSONçš„HTTPå“åº”ç±»&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data, encoder=DjangoJSONEncoder, safe=<span class="hljs-literal">True</span>,</span><br><span class="hljs-params">                 json_dumps_params=<span class="hljs-literal">None</span>, **kwargs</span>):<br>        <span class="hljs-comment"># å®‰å…¨æ£€æŸ¥ï¼šé»˜è®¤åªå…è®¸dictå¯¹è±¡</span><br>        <span class="hljs-keyword">if</span> safe <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(data, <span class="hljs-built_in">dict</span>):<br>            <span class="hljs-keyword">raise</span> TypeError(<br>                <span class="hljs-string">&#x27;In order to allow non-dict objects to be serialized set the &#x27;</span><br>                <span class="hljs-string">&#x27;safe parameter to False.&#x27;</span><br>            )<br>        <br>        <span class="hljs-keyword">if</span> json_dumps_params <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            json_dumps_params = &#123;&#125;<br>        <br>        <span class="hljs-comment"># è®¾ç½®JSONå†…å®¹ç±»å‹</span><br>        kwargs.setdefault(<span class="hljs-string">&#x27;content_type&#x27;</span>, <span class="hljs-string">&#x27;application/json&#x27;</span>)<br>        <br>        <span class="hljs-comment"># åºåˆ—åŒ–æ•°æ®</span><br>        data = json.dumps(data, cls=encoder, **json_dumps_params)<br>        <span class="hljs-built_in">super</span>(JsonResponse, <span class="hljs-variable language_">self</span>).__init__(content=data, **kwargs)<br></code></pre></td></tr></table></figure><p><strong>å®‰å…¨ç‰¹æ€§</strong>ï¼š</p><ul><li><strong>ç±»å‹é™åˆ¶</strong>ï¼šé»˜è®¤åªå…è®¸dictç±»å‹ï¼Œé˜²æ­¢æ•°ç»„JSONåŠ«æŒ</li><li><strong>è‡ªå®šä¹‰ç¼–ç å™¨</strong>ï¼šæ”¯æŒDjangoçš„JSONç¼–ç å™¨</li><li><strong>å†…å®¹ç±»å‹è‡ªåŠ¨è®¾ç½®</strong>ï¼šç¡®ä¿æ­£ç¡®çš„MIMEç±»å‹</li></ul><h2 id="å·¥å…·å‡½æ•°å’Œå¼‚å¸¸"><a href="#å·¥å…·å‡½æ•°å’Œå¼‚å¸¸" class="headerlink" title="å·¥å…·å‡½æ•°å’Œå¼‚å¸¸"></a>å·¥å…·å‡½æ•°å’Œå¼‚å¸¸</h2><h3 id="1-å¼‚å¸¸ç±»"><a href="#1-å¼‚å¸¸ç±»" class="headerlink" title="1. å¼‚å¸¸ç±»"></a>1. <strong>å¼‚å¸¸ç±»</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BadHeaderError</span>(<span class="hljs-title class_ inherited__">ValueError</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;HTTPå¤´éƒ¨æ ¼å¼é”™è¯¯&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Http404</span>(<span class="hljs-title class_ inherited__">Exception</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;404é”™è¯¯çš„å¿«æ·å¼‚å¸¸&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h3 id="2-å­—ç¬¦é›†æ£€æµ‹"><a href="#2-å­—ç¬¦é›†æ£€æµ‹" class="headerlink" title="2. å­—ç¬¦é›†æ£€æµ‹"></a>2. <strong>å­—ç¬¦é›†æ£€æµ‹</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">_charset_from_content_type_re = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;;\s*charset=(?P&lt;charset&gt;[^\s;]+)&#x27;</span>, re.I)<br><br><span class="hljs-meta">@property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">charset</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ä»Content-Typeå¤´ä¸­æå–å­—ç¬¦é›†&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>._charset <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._charset<br>    content_type = <span class="hljs-variable language_">self</span>.get(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    matched = _charset_from_content_type_re.search(content_type)<br>    <span class="hljs-keyword">if</span> matched:<br>        <span class="hljs-keyword">return</span> matched.group(<span class="hljs-string">&#x27;charset&#x27;</span>).replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">return</span> settings.DEFAULT_CHARSET<br></code></pre></td></tr></table></figure><h2 id="è®¾è®¡æ¨¡å¼å’ŒåŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼å’ŒåŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼å’ŒåŸåˆ™"></a>è®¾è®¡æ¨¡å¼å’ŒåŸåˆ™</h2><h3 id="1-æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#1-æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="1. æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>1. <strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong></h3><ul><li><strong>HttpResponseBase</strong>ï¼šå®šä¹‰å“åº”å¤„ç†çš„åŸºæœ¬æµç¨‹</li><li><strong>å­ç±»</strong>ï¼šå®ç°å…·ä½“çš„å†…å®¹å¤„ç†é€»è¾‘</li></ul><h3 id="2-ç­–ç•¥æ¨¡å¼"><a href="#2-ç­–ç•¥æ¨¡å¼" class="headerlink" title="2. ç­–ç•¥æ¨¡å¼"></a>2. <strong>ç­–ç•¥æ¨¡å¼</strong></h3><ul><li><strong>ä¸åŒå“åº”ç±»å‹</strong>ï¼šæ ‡å‡†ã€æµå¼ã€æ–‡ä»¶ç­‰ä¸åŒå¤„ç†ç­–ç•¥</li><li><strong>ç¼–ç å™¨</strong>ï¼šå¯æ’æ‹”çš„JSONç¼–ç å™¨</li></ul><h3 id="3-è£…é¥°å™¨æ¨¡å¼"><a href="#3-è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="3. è£…é¥°å™¨æ¨¡å¼"></a>3. <strong>è£…é¥°å™¨æ¨¡å¼</strong></h3><ul><li><strong>å¤´éƒ¨å¤„ç†</strong>ï¼šç»Ÿä¸€çš„å¤´éƒ¨è®¾ç½®å’ŒéªŒè¯</li><li><strong>ç¼–ç è½¬æ¢</strong>ï¼šé€æ˜çš„å­—ç¬¦ç¼–ç å¤„ç†</li></ul><h3 id="4-èµ„æºç®¡ç†æ¨¡å¼"><a href="#4-èµ„æºç®¡ç†æ¨¡å¼" class="headerlink" title="4. èµ„æºç®¡ç†æ¨¡å¼"></a>4. <strong>èµ„æºç®¡ç†æ¨¡å¼</strong></h3><ul><li><strong>RAIIåŸåˆ™</strong>ï¼šé€šè¿‡<code>_closable_objects</code>è‡ªåŠ¨ç®¡ç†èµ„æº</li><li><strong>ä¸Šä¸‹æ–‡ç®¡ç†</strong>ï¼šç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾</li></ul><h2 id="å®é™…åº”ç”¨åœºæ™¯"><a href="#å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="å®é™…åº”ç”¨åœºæ™¯"></a>å®é™…åº”ç”¨åœºæ™¯</h2><h3 id="1-åŸºæœ¬Webå“åº”"><a href="#1-åŸºæœ¬Webå“åº”" class="headerlink" title="1. åŸºæœ¬Webå“åº”"></a>1. <strong>åŸºæœ¬Webå“åº”</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># ç®€å•HTMLå“åº”</span><br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&#x27;&lt;h1&gt;Hello World&lt;/h1&gt;&#x27;</span>)<br>    <br>    <span class="hljs-comment"># JSON APIå“åº”</span><br>    <span class="hljs-keyword">return</span> JsonResponse(&#123;<span class="hljs-string">&#x27;status&#x27;</span>: <span class="hljs-string">&#x27;success&#x27;</span>, <span class="hljs-string">&#x27;data&#x27;</span>: data&#125;)<br>    <br>    <span class="hljs-comment"># é‡å®šå‘</span><br>    <span class="hljs-keyword">return</span> HttpResponseRedirect(<span class="hljs-string">&#x27;/login/&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="2-æ–‡ä»¶ä¸‹è½½"><a href="#2-æ–‡ä»¶ä¸‹è½½" class="headerlink" title="2. æ–‡ä»¶ä¸‹è½½"></a>2. <strong>æ–‡ä»¶ä¸‹è½½</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">download_file</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># å¤§æ–‡ä»¶ä¸‹è½½</span><br>    file_obj = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;large_file.pdf&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>)<br>    response = FileResponse(file_obj)<br>    response[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>] = <span class="hljs-string">&#x27;attachment; filename=&quot;file.pdf&quot;&#x27;</span><br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h3 id="3-æµå¼æ•°æ®"><a href="#3-æµå¼æ•°æ®" class="headerlink" title="3. æµå¼æ•°æ®"></a>3. <strong>æµå¼æ•°æ®</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">streaming_csv</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># å¤§é‡æ•°æ®çš„CSVå¯¼å‡º</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_csv</span>():<br>        <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> large_dataset:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;row[<span class="hljs-string">&#x27;id&#x27;</span>]&#125;</span>,<span class="hljs-subst">&#123;row[<span class="hljs-string">&#x27;name&#x27;</span>]&#125;</span>\n&quot;</span><br>    <br>    response = StreamingHttpResponse(generate_csv(), content_type=<span class="hljs-string">&#x27;text/csv&#x27;</span>)<br>    response[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>] = <span class="hljs-string">&#x27;attachment; filename=&quot;data.csv&quot;&#x27;</span><br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Djangoçš„HTTPå“åº”ç³»ç»Ÿä½“ç°äº†ä»¥ä¸‹è®¾è®¡ç†å¿µï¼š</p><h3 id="å®‰å…¨ç¬¬ä¸€"><a href="#å®‰å…¨ç¬¬ä¸€" class="headerlink" title="å®‰å…¨ç¬¬ä¸€"></a>å®‰å…¨ç¬¬ä¸€</h3><ul><li><strong>å¤´éƒ¨æ³¨å…¥é˜²æŠ¤</strong>ï¼šé˜²æ­¢HTTPå¤´éƒ¨æ³¨å…¥æ”»å‡»</li><li><strong>é‡å®šå‘å®‰å…¨</strong>ï¼šåè®®ç™½åå•é˜²æ­¢æ¶æ„é‡å®šå‘</li><li><strong>JSONå®‰å…¨</strong>ï¼šé»˜è®¤ç±»å‹é™åˆ¶é˜²æ­¢åŠ«æŒæ”»å‡»</li><li><strong>Cookieå®‰å…¨</strong>ï¼šç­¾åéªŒè¯å’Œå®‰å…¨æ ‡å¿—æ”¯æŒ</li></ul><h3 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h3><ul><li><strong>æµå¼å¤„ç†</strong>ï¼šæ”¯æŒå¤§æ–‡ä»¶å’Œå®æ—¶æ•°æ®æµ</li><li><strong>å»¶è¿Ÿå¤„ç†</strong>ï¼šæŒ‰éœ€ç”Ÿæˆå’Œä¼ è¾“å†…å®¹</li><li><strong>å†…å­˜ç®¡ç†</strong>ï¼šåˆ†å—å¤„ç†é¿å…å†…å­˜æº¢å‡º</li><li><strong>èµ„æºæ¸…ç†</strong>ï¼šè‡ªåŠ¨ç®¡ç†æ–‡ä»¶å¥æŸ„ç­‰èµ„æº</li></ul><h3 id="æ‰©å±•æ€§å¼º"><a href="#æ‰©å±•æ€§å¼º" class="headerlink" title="æ‰©å±•æ€§å¼º"></a>æ‰©å±•æ€§å¼º</h3><ul><li><strong>ç±»ç»§æ‰¿ä½“ç³»</strong>ï¼šæ¸…æ™°çš„ç»§æ‰¿å…³ç³»æ”¯æŒå®šåˆ¶</li><li><strong>å¯æ’æ‹”ç»„ä»¶</strong>ï¼šè‡ªå®šä¹‰ç¼–ç å™¨å’Œå¤„ç†å™¨</li><li><strong>æ ‡å‡†å…¼å®¹</strong>ï¼šå®Œæ•´çš„HTTPåè®®æ”¯æŒ</li></ul><h3 id="æ˜“ç”¨æ€§å¥½"><a href="#æ˜“ç”¨æ€§å¥½" class="headerlink" title="æ˜“ç”¨æ€§å¥½"></a>æ˜“ç”¨æ€§å¥½</h3><ul><li><strong>å­—å…¸å¼æ¥å£</strong>ï¼šç›´è§‚çš„å¤´éƒ¨è®¿é—®æ–¹å¼</li><li><strong>å¤šç§å“åº”ç±»å‹</strong>ï¼šè¦†ç›–å¸¸è§çš„Webå¼€å‘éœ€æ±‚</li><li><strong>è‡ªåŠ¨å¤„ç†</strong>ï¼šç¼–ç ã€æ—¶åŒºç­‰ç»†èŠ‚çš„è‡ªåŠ¨å¤„ç†</li></ul><p>é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„ç±»ç»§æ‰¿ä½“ç³»å’Œä¸°å¯Œçš„åŠŸèƒ½ç‰¹æ€§ï¼ŒDjangoçš„å“åº”ç³»ç»Ÿä¸ºWebåº”ç”¨å¼€å‘æä¾›äº†å¼ºå¤§ã€å®‰å…¨ã€é«˜æ•ˆçš„HTTPå“åº”å¤„ç†èƒ½åŠ›ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django åˆ†é¡µå™¨ Paginator</title>
    <link href="/2025/07/02/Django%E5%88%86%E9%A1%B5%E5%99%A8-Paginator/"/>
    <url>/2025/07/02/Django%E5%88%86%E9%A1%B5%E5%99%A8-Paginator/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Djangoçš„åˆ†é¡µå™¨ç³»ç»Ÿæ˜¯ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„ç»„ä»¶ï¼Œç”¨äºå¤„ç†å¤§é‡æ•°æ®çš„åˆ†é¡µæ˜¾ç¤ºã€‚å®ƒç”±ä¸¤ä¸ªæ ¸å¿ƒç±»ç»„æˆï¼š</p><ul><li><code>Paginator</code>ï¼šåˆ†é¡µå™¨ä¸»ç±»ï¼Œè´Ÿè´£åˆ†é¡µé€»è¾‘å’Œå…ƒæ•°æ®è®¡ç®—</li><li><code>Page</code>ï¼šå•ä¸ªé¡µé¢ç±»ï¼Œè¡¨ç¤ºå…·ä½“æŸä¸€é¡µçš„æ•°æ®å’Œå¯¼èˆªä¿¡æ¯</li></ul><h2 id="æ ¸å¿ƒè®¾è®¡åŸç†"><a href="#æ ¸å¿ƒè®¾è®¡åŸç†" class="headerlink" title="æ ¸å¿ƒè®¾è®¡åŸç†"></a>æ ¸å¿ƒè®¾è®¡åŸç†</h2><h3 id="1-åˆ†é¡µå™¨åˆå§‹åŒ–"><a href="#1-åˆ†é¡µå™¨åˆå§‹åŒ–" class="headerlink" title="1. åˆ†é¡µå™¨åˆå§‹åŒ–"></a>1. åˆ†é¡µå™¨åˆå§‹åŒ–</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Paginator</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, object_list, per_page, orphans=<span class="hljs-number">0</span>, allow_empty_first_page=<span class="hljs-literal">True</span></span>):<br>        <span class="hljs-variable language_">self</span>.object_list = object_list      <span class="hljs-comment"># è¦åˆ†é¡µçš„æ•°æ®åˆ—è¡¨</span><br>        <span class="hljs-variable language_">self</span>.per_page = <span class="hljs-built_in">int</span>(per_page)       <span class="hljs-comment"># æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®</span><br>        <span class="hljs-variable language_">self</span>.orphans = <span class="hljs-built_in">int</span>(orphans)         <span class="hljs-comment"># å­¤ç«‹æ¡ç›®æ•°ï¼ˆé¿å…æœ€åä¸€é¡µåªæœ‰å¾ˆå°‘æ•°æ®ï¼‰</span><br>        <span class="hljs-variable language_">self</span>.allow_empty_first_page = allow_empty_first_page  <span class="hljs-comment"># æ˜¯å¦å…è®¸ç¬¬ä¸€é¡µä¸ºç©º</span><br></code></pre></td></tr></table></figure><p><strong>orphanså‚æ•°çš„å·§å¦™è®¾è®¡</strong>ï¼š</p><ul><li>å¦‚æœæœ€åä¸€é¡µçš„é¡¹ç›®æ•°å°‘äºæˆ–ç­‰äºorphansï¼Œè¿™äº›é¡¹ç›®ä¼šè¢«æ·»åŠ åˆ°å‰ä¸€é¡µ</li><li>é¿å…å‡ºç°æœ€åä¸€é¡µåªæœ‰1-2æ¡æ•°æ®çš„å°´å°¬æƒ…å†µ</li></ul><h3 id="2-æ ¸å¿ƒåˆ†é¡µç®—æ³•"><a href="#2-æ ¸å¿ƒåˆ†é¡µç®—æ³•" class="headerlink" title="2. æ ¸å¿ƒåˆ†é¡µç®—æ³•"></a>2. æ ¸å¿ƒåˆ†é¡µç®—æ³•</h3><h4 id="æ€»é¡µæ•°è®¡ç®—ç®—æ³•"><a href="#æ€»é¡µæ•°è®¡ç®—ç®—æ³•" class="headerlink" title="æ€»é¡µæ•°è®¡ç®—ç®—æ³•"></a>æ€»é¡µæ•°è®¡ç®—ç®—æ³•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@cached_property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">num_pages</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.count == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.allow_empty_first_page:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-comment"># æ€»è®°å½•æ•°ï¼Œå‡å»å­¤ç«‹çš„æ¡ç›®æ•°ï¼Œç¡®ä¿è‡³å°‘æœ‰ä¸€é¡µ</span><br>    hits = <span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>, <span class="hljs-variable language_">self</span>.count - <span class="hljs-variable language_">self</span>.orphans)<br>    <span class="hljs-comment"># è®¡ç®—æ€»é¡µæ•°ï¼Œä½¿ç”¨ceilå‡½æ•°å‘ä¸Šå–æ•´</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(ceil(hits / <span class="hljs-built_in">float</span>(<span class="hljs-variable language_">self</span>.per_page)))<br></code></pre></td></tr></table></figure><p><strong>ç®—æ³•ç²¾é«“</strong>ï¼š</p><ul><li><code>hits = max(1, self.count - self.orphans)</code> ç¡®ä¿è‡³å°‘æœ‰1é¡µ</li><li>é€šè¿‡<code>ceil</code>å‘ä¸Šå–æ•´ï¼Œä¿è¯æ‰€æœ‰æ•°æ®éƒ½èƒ½è¢«åŒ…å«</li><li>orphanså‚æ•°ä¼šå‡å°‘æ€»çš„æœ‰æ•ˆè®°å½•æ•°ï¼Œä»è€Œå¯èƒ½å‡å°‘é¡µæ•°</li></ul><h4 id="é¡µé¢æ•°æ®è·å–ç®—æ³•"><a href="#é¡µé¢æ•°æ®è·å–ç®—æ³•" class="headerlink" title="é¡µé¢æ•°æ®è·å–ç®—æ³•"></a>é¡µé¢æ•°æ®è·å–ç®—æ³•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">page</span>(<span class="hljs-params">self, number</span>):<br>    number = <span class="hljs-variable language_">self</span>.validate_number(number)<br>    bottom = (number - <span class="hljs-number">1</span>) * <span class="hljs-variable language_">self</span>.per_page  <span class="hljs-comment"># èµ·å§‹ç´¢å¼•</span><br>    top = bottom + <span class="hljs-variable language_">self</span>.per_page           <span class="hljs-comment"># ç»“æŸç´¢å¼•</span><br>    <br>    <span class="hljs-comment"># ç‰¹æ®Šå¤„ç†æœ€åä¸€é¡µï¼šåŒ…å«orphanæ•°æ®</span><br>    <span class="hljs-keyword">if</span> top + <span class="hljs-variable language_">self</span>.orphans &gt;= <span class="hljs-variable language_">self</span>.count:<br>        top = <span class="hljs-variable language_">self</span>.count<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._get_page(<span class="hljs-variable language_">self</span>.object_list[bottom:top], number, <span class="hljs-variable language_">self</span>)<br></code></pre></td></tr></table></figure><p><strong>å…³é”®é€»è¾‘</strong>ï¼š</p><ul><li>ä½¿ç”¨åˆ‡ç‰‡æ“ä½œ <code>object_list[bottom:top]</code> è·å–é¡µé¢æ•°æ®</li><li>æœ€åä¸€é¡µç‰¹æ®Šå¤„ç†ï¼šå°†å‰©ä½™çš„orphanæ•°æ®åŒ…å«è¿›æ¥</li></ul><h4 id="æ•°æ®æ€»æ•°è·å–ç­–ç•¥"><a href="#æ•°æ®æ€»æ•°è·å–ç­–ç•¥" class="headerlink" title="æ•°æ®æ€»æ•°è·å–ç­–ç•¥"></a>æ•°æ®æ€»æ•°è·å–ç­–ç•¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@cached_property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># ä¼˜å…ˆä½¿ç”¨count()æ–¹æ³•ï¼ˆé€‚ç”¨äºQuerySetï¼‰</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.object_list.count()<br>    <span class="hljs-keyword">except</span> (AttributeError, TypeError):<br>        <span class="hljs-comment"># é™çº§ä½¿ç”¨len()å‡½æ•°ï¼ˆé€‚ç”¨äºlistç­‰ï¼‰</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.object_list)<br></code></pre></td></tr></table></figure><p><strong>å…¼å®¹æ€§è®¾è®¡</strong>ï¼š</p><ul><li>QuerySet.count() â†’ æ‰§è¡Œ <code>SELECT COUNT(*)</code> SQLæŸ¥è¯¢</li><li>list&#x2F;tuple â†’ ä½¿ç”¨Pythonå†…ç½®çš„ <code>len()</code> å‡½æ•°</li></ul><h2 id="cached-propertyè£…é¥°å™¨æ·±åº¦è§£æ"><a href="#cached-propertyè£…é¥°å™¨æ·±åº¦è§£æ" class="headerlink" title="@cached_propertyè£…é¥°å™¨æ·±åº¦è§£æ"></a>@cached_propertyè£…é¥°å™¨æ·±åº¦è§£æ</h2><h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">cached_property</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, func, name=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-variable language_">self</span>.func = func<br>        <span class="hljs-variable language_">self</span>.__doc__ = <span class="hljs-built_in">getattr</span>(func, <span class="hljs-string">&#x27;__doc__&#x27;</span>)<br>        <span class="hljs-variable language_">self</span>.name = name <span class="hljs-keyword">or</span> func.__name__<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, instance, cls=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-keyword">if</span> instance <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span><br>        <span class="hljs-comment"># æ ¸å¿ƒï¼šä¸€æ¬¡è®¡ç®—ï¼Œå­˜å‚¨åˆ°å®ä¾‹å­—å…¸ï¼Œåç»­ç›´æ¥è¯»å–</span><br>        res = instance.__dict__[<span class="hljs-variable language_">self</span>.name] = <span class="hljs-variable language_">self</span>.func(instance)<br>        <span class="hljs-keyword">return</span> res<br></code></pre></td></tr></table></figure><h3 id="å·¥ä½œæœºåˆ¶"><a href="#å·¥ä½œæœºåˆ¶" class="headerlink" title="å·¥ä½œæœºåˆ¶"></a>å·¥ä½œæœºåˆ¶</h3><ol><li><strong>æè¿°ç¬¦åè®®</strong>ï¼šå®ç°äº†<code>__get__</code>æ–¹æ³•ï¼Œæ§åˆ¶å±æ€§è®¿é—®</li><li><strong>ç¼“å­˜ç­–ç•¥</strong>ï¼šå°†è®¡ç®—ç»“æœå­˜å‚¨åœ¨<code>instance.__dict__</code>ä¸­</li><li><strong>è®¿é—®ä¼˜åŒ–</strong>ï¼šåˆ©ç”¨Pythonå±æ€§æŸ¥æ‰¾é¡ºåºï¼Œåç»­è®¿é—®ç›´æ¥ä»å®ä¾‹å­—å…¸è·å–</li></ol><h3 id="é“¾å¼èµ‹å€¼çš„å·§å¦™è¿ç”¨"><a href="#é“¾å¼èµ‹å€¼çš„å·§å¦™è¿ç”¨" class="headerlink" title="é“¾å¼èµ‹å€¼çš„å·§å¦™è¿ç”¨"></a>é“¾å¼èµ‹å€¼çš„å·§å¦™è¿ç”¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">res = instance.__dict__[<span class="hljs-variable language_">self</span>.name] = <span class="hljs-variable language_">self</span>.func(instance)<br></code></pre></td></tr></table></figure><p>è¿™è¡Œä»£ç ä½“ç°äº†Pythoné“¾å¼èµ‹å€¼çš„ä¼˜é›…ï¼š</p><ul><li><strong>åªè°ƒç”¨ä¸€æ¬¡å‡½æ•°</strong>ï¼š<code>self.func(instance)</code>åªæ‰§è¡Œä¸€æ¬¡</li><li><strong>åŒæ—¶å®Œæˆç¼“å­˜å’Œè¿”å›</strong>ï¼šä¸€æ­¥åˆ°ä½</li><li><strong>ä»£ç ç®€æ´</strong>ï¼šé¿å…ä¸´æ—¶å˜é‡</li></ul><h2 id="Pageç±»çš„è®¾è®¡äº®ç‚¹"><a href="#Pageç±»çš„è®¾è®¡äº®ç‚¹" class="headerlink" title="Pageç±»çš„è®¾è®¡äº®ç‚¹"></a>Pageç±»çš„è®¾è®¡äº®ç‚¹</h2><h3 id="1-å®ç°Sequenceåè®®"><a href="#1-å®ç°Sequenceåè®®" class="headerlink" title="1. å®ç°Sequenceåè®®"></a>1. å®ç°Sequenceåè®®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Page</span>(collections.<span class="hljs-type">Sequence</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.object_list)<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, index</span>):<br>        <span class="hljs-comment"># æ”¯æŒç´¢å¼•å’Œåˆ‡ç‰‡è®¿é—®</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(<span class="hljs-variable language_">self</span>.object_list, <span class="hljs-built_in">list</span>):<br>            <span class="hljs-variable language_">self</span>.object_list = <span class="hljs-built_in">list</span>(<span class="hljs-variable language_">self</span>.object_list)  <span class="hljs-comment"># QuerySetä¼˜åŒ–</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.object_list[index]<br></code></pre></td></tr></table></figure><h3 id="2-å¯¼èˆªæ–¹æ³•"><a href="#2-å¯¼èˆªæ–¹æ³•" class="headerlink" title="2. å¯¼èˆªæ–¹æ³•"></a>2. å¯¼èˆªæ–¹æ³•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">start_index</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-comment"># è¿”å›å½“å‰é¡µç¬¬ä¸€ä¸ªå¯¹è±¡åœ¨æ•´ä¸ªåˆ—è¡¨ä¸­çš„ä½ç½®ï¼ˆ1åŸºç´¢å¼•ï¼‰</span><br>    <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">self</span>.paginator.per_page * (<span class="hljs-variable language_">self</span>.number - <span class="hljs-number">1</span>)) + <span class="hljs-number">1</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">end_index</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-comment"># ç‰¹æ®Šå¤„ç†æœ€åä¸€é¡µçš„orphanæ•°æ®</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.number == <span class="hljs-variable language_">self</span>.paginator.num_pages:<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.paginator.count<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.number * <span class="hljs-variable language_">self</span>.paginator.per_page<br></code></pre></td></tr></table></figure><h2 id="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"><a href="#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"></a>æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h2><h3 id="1-ç¼“å­˜å±‚æ¬¡"><a href="#1-ç¼“å­˜å±‚æ¬¡" class="headerlink" title="1. ç¼“å­˜å±‚æ¬¡"></a>1. ç¼“å­˜å±‚æ¬¡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç¬¬ä¸€å±‚ï¼š@cached_propertyç¼“å­˜</span><br>paginator.count        <span class="hljs-comment"># ç¬¬1æ¬¡ï¼šSQLæŸ¥è¯¢ + ç¼“å­˜</span><br>paginator.count        <span class="hljs-comment"># ç¬¬2æ¬¡ï¼šç›´æ¥ä½¿ç”¨ç¼“å­˜</span><br>paginator.num_pages    <span class="hljs-comment"># ä½¿ç”¨countç¼“å­˜ï¼Œæ— é¢å¤–SQL</span><br><br><span class="hljs-comment"># ç¬¬äºŒå±‚ï¼šQuerySetçº§åˆ«ä¼˜åŒ–</span><br>page.object_list       <span class="hljs-comment"># QuerySet â†’ listè½¬æ¢ï¼Œé¿å…é‡å¤æ•°æ®åº“è®¿é—®</span><br></code></pre></td></tr></table></figure><h3 id="2-QuerySetä¼˜åŒ–"><a href="#2-QuerySetä¼˜åŒ–" class="headerlink" title="2. QuerySetä¼˜åŒ–"></a>2. QuerySetä¼˜åŒ–</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Pageç±»ä¸­çš„ä¼˜åŒ–</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, index</span>):<br>    <span class="hljs-comment"># å°†QuerySetè½¬ä¸ºlistï¼Œé¿å…æ¯æ¬¡__getitem__éƒ½æŸ¥è¯¢æ•°æ®åº“</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(<span class="hljs-variable language_">self</span>.object_list, <span class="hljs-built_in">list</span>):<br>        <span class="hljs-variable language_">self</span>.object_list = <span class="hljs-built_in">list</span>(<span class="hljs-variable language_">self</span>.object_list)<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.object_list[index]<br></code></pre></td></tr></table></figure><h3 id="3-æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–"><a href="#3-æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="3. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–"></a>3. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># QuerySet.count()å®ç°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>._result_cache <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>._result_cache)  <span class="hljs-comment"># å¦‚æœå·²ç¼“å­˜ï¼Œç›´æ¥è¿”å›</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.query.get_count(using=<span class="hljs-variable language_">self</span>.db)  <span class="hljs-comment"># æ‰§è¡ŒSELECT COUNT(*)</span><br></code></pre></td></tr></table></figure><h2 id="æ€§èƒ½ä¸æ•°æ®ä¸€è‡´æ€§çš„æƒè¡¡"><a href="#æ€§èƒ½ä¸æ•°æ®ä¸€è‡´æ€§çš„æƒè¡¡" class="headerlink" title="æ€§èƒ½ä¸æ•°æ®ä¸€è‡´æ€§çš„æƒè¡¡"></a>æ€§èƒ½ä¸æ•°æ®ä¸€è‡´æ€§çš„æƒè¡¡</h2><h3 id="æ ¸å¿ƒé—®é¢˜"><a href="#æ ¸å¿ƒé—®é¢˜" class="headerlink" title="æ ¸å¿ƒé—®é¢˜"></a>æ ¸å¿ƒé—®é¢˜</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ•°æ®ä¸€è‡´æ€§é—®é¢˜æ¼”ç¤º</span><br>paginator = Paginator(Article.objects.<span class="hljs-built_in">all</span>(), <span class="hljs-number">10</span>)<br><span class="hljs-built_in">print</span>(paginator.count)  <span class="hljs-comment"># 100æ¡è®°å½•</span><br><br><span class="hljs-comment"># åœ¨åˆ«å¤„åˆ é™¤äº†æ•°æ®</span><br>Article.objects.<span class="hljs-built_in">filter</span>(id__lte=<span class="hljs-number">10</span>).delete()<br><br><span class="hljs-comment"># åˆ†é¡µå™¨ç¼“å­˜æœªæ›´æ–°ï¼</span><br><span class="hljs-built_in">print</span>(paginator.count)  <span class="hljs-comment"># ä»ç„¶æ˜¾ç¤º100æ¡ï¼ˆä¸ä¸€è‡´ï¼ï¼‰</span><br></code></pre></td></tr></table></figure><h3 id="Djangoçš„è§£å†³ç­–ç•¥ï¼šè¯·æ±‚çº§ç¼“å­˜"><a href="#Djangoçš„è§£å†³ç­–ç•¥ï¼šè¯·æ±‚çº§ç¼“å­˜" class="headerlink" title="Djangoçš„è§£å†³ç­–ç•¥ï¼šè¯·æ±‚çº§ç¼“å­˜"></a>Djangoçš„è§£å†³ç­–ç•¥ï¼šè¯·æ±‚çº§ç¼“å­˜</h3><h4 id="1-çŸ­ç”Ÿå‘½å‘¨æœŸè®¾è®¡"><a href="#1-çŸ­ç”Ÿå‘½å‘¨æœŸè®¾è®¡" class="headerlink" title="1. çŸ­ç”Ÿå‘½å‘¨æœŸè®¾è®¡"></a>1. çŸ­ç”Ÿå‘½å‘¨æœŸè®¾è®¡</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">article_list</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># æ¯ä¸ªHTTPè¯·æ±‚åˆ›å»ºæ–°çš„åˆ†é¡µå™¨å®ä¾‹</span><br>    paginator = Paginator(Article.objects.<span class="hljs-built_in">all</span>(), <span class="hljs-number">10</span>)<br>    <br>    <span class="hljs-comment"># åœ¨è¯·æ±‚æœŸé—´ï¼Œç¼“å­˜æœ‰æ•ˆ</span><br>    count1 = paginator.count      <span class="hljs-comment"># SQLæŸ¥è¯¢ + ç¼“å­˜</span><br>    count2 = paginator.count      <span class="hljs-comment"># ä½¿ç”¨ç¼“å­˜</span><br>    num_pages = paginator.num_pages  <span class="hljs-comment"># ä½¿ç”¨countç¼“å­˜</span><br>    <br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;list.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;paginator&#x27;</span>: paginator&#125;)<br>    <span class="hljs-comment"># è¯·æ±‚ç»“æŸï¼Œå®ä¾‹é”€æ¯ï¼Œç¼“å­˜æ¶ˆå¤±</span><br></code></pre></td></tr></table></figure><h4 id="2-å®ä¾‹çº§éš”ç¦»"><a href="#2-å®ä¾‹çº§éš”ç¦»" class="headerlink" title="2. å®ä¾‹çº§éš”ç¦»"></a>2. å®ä¾‹çº§éš”ç¦»</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¸åŒè¯·æ±‚ï¼Œä¸åŒå®ä¾‹ï¼Œç‹¬ç«‹ç¼“å­˜</span><br>request_1_paginator = Paginator(queryset, <span class="hljs-number">10</span>)  <span class="hljs-comment"># å®ä¾‹1</span><br>request_2_paginator = Paginator(queryset, <span class="hljs-number">10</span>)  <span class="hljs-comment"># å®ä¾‹2ï¼ˆç‹¬ç«‹ï¼‰</span><br><br><span class="hljs-comment"># ä¸¤è€…ç¼“å­˜å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å½±å“</span><br></code></pre></td></tr></table></figure><h3 id="æƒè¡¡åˆ†æ"><a href="#æƒè¡¡åˆ†æ" class="headerlink" title="æƒè¡¡åˆ†æ"></a>æƒè¡¡åˆ†æ</h3><table><thead><tr><th>æ–¹æ¡ˆ</th><th>æ€§èƒ½</th><th>ä¸€è‡´æ€§</th><th>å¤æ‚åº¦</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>æ— ç¼“å­˜</td><td>å·®</td><td>å¼ºä¸€è‡´</td><td>ä½</td><td>æ•°æ®å˜åŒ–é¢‘ç¹</td></tr><tr><td>è¯·æ±‚çº§ç¼“å­˜</td><td>å¥½</td><td>è¯·æ±‚å†…ä¸€è‡´</td><td>ä½</td><td><strong>Webåº”ç”¨ï¼ˆDjangoé€‰æ‹©ï¼‰</strong></td></tr><tr><td>å…¨å±€ç¼“å­˜</td><td>æœ€å¥½</td><td>å¼±ä¸€è‡´</td><td>é«˜</td><td>è¯»å¤šå†™å°‘</td></tr><tr><td>TTLç¼“å­˜</td><td>è¾ƒå¥½</td><td>æœ€ç»ˆä¸€è‡´</td><td>ä¸­</td><td>å¯æ¥å—å»¶è¿Ÿ</td></tr></tbody></table><h3 id="Djangoé€‰æ‹©çš„ä¼˜åŠ¿"><a href="#Djangoé€‰æ‹©çš„ä¼˜åŠ¿" class="headerlink" title="Djangoé€‰æ‹©çš„ä¼˜åŠ¿"></a>Djangoé€‰æ‹©çš„ä¼˜åŠ¿</h3><ol><li><strong>ç®€å•å¯é </strong>ï¼šä¸éœ€è¦å¤æ‚çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥</li><li><strong>å†…å­˜å®‰å…¨</strong>ï¼šéšè¯·æ±‚ç»“æŸè‡ªåŠ¨æ¸…ç†ï¼Œæ— å†…å­˜æ³„æ¼</li><li><strong>å¹¶å‘å®‰å…¨</strong>ï¼šæ¯ä¸ªè¯·æ±‚ç‹¬ç«‹ï¼Œæ— ç«æ€æ¡ä»¶</li><li><strong>é€‚åˆWebåœºæ™¯</strong>ï¼šç¬¦åˆHTTPè¯·æ±‚çš„æ— çŠ¶æ€ç‰¹æ€§</li></ol><h2 id="å®é™…åº”ç”¨åœºæ™¯"><a href="#å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="å®é™…åº”ç”¨åœºæ™¯"></a>å®é™…åº”ç”¨åœºæ™¯</h2><h3 id="1-åŸºç¡€åˆ†é¡µ"><a href="#1-åŸºç¡€åˆ†é¡µ" class="headerlink" title="1. åŸºç¡€åˆ†é¡µ"></a>1. åŸºç¡€åˆ†é¡µ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">article_list</span>(<span class="hljs-params">request</span>):<br>    articles = Article.objects.<span class="hljs-built_in">all</span>().order_by(<span class="hljs-string">&#x27;-created_at&#x27;</span>)<br>    paginator = Paginator(articles, <span class="hljs-number">10</span>)<br>    <br>    page_number = request.GET.get(<span class="hljs-string">&#x27;page&#x27;</span>, <span class="hljs-number">1</span>)<br>    page = paginator.page(page_number)<br>    <br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;list.html&#x27;</span>, &#123;<br>        <span class="hljs-string">&#x27;page&#x27;</span>: page,<br>        <span class="hljs-string">&#x27;paginator&#x27;</span>: paginator<br>    &#125;)<br></code></pre></td></tr></table></figure><h3 id="2-æ¨¡æ¿ä¸­çš„ä½¿ç”¨"><a href="#2-æ¨¡æ¿ä¸­çš„ä½¿ç”¨" class="headerlink" title="2. æ¨¡æ¿ä¸­çš„ä½¿ç”¨"></a>2. æ¨¡æ¿ä¸­çš„ä½¿ç”¨</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- åˆ†é¡µä¿¡æ¯ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pagination-info&quot;</span>&gt;</span><br>    å…± &#123;&#123; paginator.count &#125;&#125; æ¡è®°å½•ï¼Œåˆ†ä¸º &#123;&#123; paginator.num_pages &#125;&#125; é¡µ<br>    å½“å‰ç¬¬ &#123;&#123; page.number &#125;&#125; é¡µ<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- é¡µé¢å¯¼èˆª --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pagination&quot;</span>&gt;</span><br>    &#123;% if page.has_previous %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;?page=&#123;&#123; page.previous_page_number &#125;&#125;&quot;</span>&gt;</span>ä¸Šä¸€é¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    &#123;% endif %&#125;<br>    <br>    &#123;% for num in paginator.page_range %&#125;<br>        &#123;% if num == page.number %&#125;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>&#123;&#123; num &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><br>        &#123;% else %&#125;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;?page=&#123;&#123; num &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; num &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>        &#123;% endif %&#125;<br>    &#123;% endfor %&#125;<br>    <br>    &#123;% if page.has_next %&#125;<br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;?page=&#123;&#123; page.next_page_number &#125;&#125;&quot;</span>&gt;</span>ä¸‹ä¸€é¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    &#123;% endif %&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="3-orphanså‚æ•°çš„åº”ç”¨"><a href="#3-orphanså‚æ•°çš„åº”ç”¨" class="headerlink" title="3. orphanså‚æ•°çš„åº”ç”¨"></a>3. orphanså‚æ•°çš„åº”ç”¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é¿å…æœ€åä¸€é¡µåªæœ‰å¾ˆå°‘æ•°æ®</span><br>paginator = Paginator(articles, per_page=<span class="hljs-number">10</span>, orphans=<span class="hljs-number">3</span>)<br><br><span class="hljs-comment"># ç¤ºä¾‹ï¼š103æ¡è®°å½•</span><br><span class="hljs-comment"># ä¸ä½¿ç”¨orphans: 10é¡µ (10+10+...+10+3)</span><br><span class="hljs-comment"># ä½¿ç”¨orphans=3: 9é¡µ (10+10+...+10+13)</span><br></code></pre></td></tr></table></figure><h2 id="é«˜çº§æ‰©å±•"><a href="#é«˜çº§æ‰©å±•" class="headerlink" title="é«˜çº§æ‰©å±•"></a>é«˜çº§æ‰©å±•</h2><h3 id="1-è‡ªå®šä¹‰åˆ†é¡µå™¨"><a href="#1-è‡ªå®šä¹‰åˆ†é¡µå™¨" class="headerlink" title="1. è‡ªå®šä¹‰åˆ†é¡µå™¨"></a>1. è‡ªå®šä¹‰åˆ†é¡µå™¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartPaginator</span>(<span class="hljs-title class_ inherited__">Paginator</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">refresh_count</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;æ‰‹åŠ¨åˆ·æ–°è®¡æ•°ç¼“å­˜&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;count&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.__dict__:<br>            <span class="hljs-keyword">del</span> <span class="hljs-variable language_">self</span>.__dict__[<span class="hljs-string">&#x27;count&#x27;</span>]<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;num_pages&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.__dict__:<br>            <span class="hljs-keyword">del</span> <span class="hljs-variable language_">self</span>.__dict__[<span class="hljs-string">&#x27;num_pages&#x27;</span>]<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_fresh_count</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;è·å–æœ€æ–°è®¡æ•°ï¼Œç»•è¿‡ç¼“å­˜&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.object_list.count()<br></code></pre></td></tr></table></figure><h3 id="2-TTLç¼“å­˜å®ç°"><a href="#2-TTLç¼“å­˜å®ç°" class="headerlink" title="2. TTLç¼“å­˜å®ç°"></a>2. TTLç¼“å­˜å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TTLPaginator</span>(<span class="hljs-title class_ inherited__">Paginator</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *args, cache_ttl=<span class="hljs-number">60</span>, **kwargs</span>):<br>        <span class="hljs-built_in">super</span>().__init__(*args, **kwargs)<br>        <span class="hljs-variable language_">self</span>.cache_ttl = cache_ttl<br>        <span class="hljs-variable language_">self</span>._count_cache_time = <span class="hljs-number">0</span><br>        <span class="hljs-variable language_">self</span>._count_cache_value = <span class="hljs-literal">None</span><br>    <br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">count</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">import</span> time<br>        current_time = time.time()<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">self</span>._count_cache_value <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> <br>            current_time - <span class="hljs-variable language_">self</span>._count_cache_time &gt; <span class="hljs-variable language_">self</span>.cache_ttl):<br>            <span class="hljs-variable language_">self</span>._count_cache_value = <span class="hljs-variable language_">self</span>.object_list.count()<br>            <span class="hljs-variable language_">self</span>._count_cache_time = current_time<br>        <br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>._count_cache_value<br></code></pre></td></tr></table></figure><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><h3 id="1-æ€§èƒ½ä¼˜åŒ–"><a href="#1-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="1. æ€§èƒ½ä¼˜åŒ–"></a>1. æ€§èƒ½ä¼˜åŒ–</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># âœ… æ­£ç¡®ï¼šæ·»åŠ æ’åºï¼Œé¿å…è­¦å‘Š</span><br>articles = Article.objects.<span class="hljs-built_in">all</span>().order_by(<span class="hljs-string">&#x27;-id&#x27;</span>)<br>paginator = Paginator(articles, <span class="hljs-number">10</span>)<br><br><span class="hljs-comment"># âŒ é”™è¯¯ï¼šæ— åºQuerySetå¯èƒ½å¯¼è‡´åˆ†é¡µç»“æœä¸ä¸€è‡´</span><br>articles = Article.objects.<span class="hljs-built_in">all</span>()  <span class="hljs-comment"># æ— order_by</span><br>paginator = Paginator(articles, <span class="hljs-number">10</span>)  <span class="hljs-comment"># ä¼šäº§ç”Ÿè­¦å‘Š</span><br></code></pre></td></tr></table></figure><h3 id="2-æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–"><a href="#2-æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–"></a>2. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># âœ… ä½¿ç”¨select_relatedå‡å°‘æ•°æ®åº“æŸ¥è¯¢</span><br>articles = Article.objects.select_related(<span class="hljs-string">&#x27;author&#x27;</span>).order_by(<span class="hljs-string">&#x27;-created_at&#x27;</span>)<br>paginator = Paginator(articles, <span class="hljs-number">10</span>)<br><br><span class="hljs-comment"># âœ… ä½¿ç”¨prefetch_relatedä¼˜åŒ–åå‘å…³ç³»</span><br>articles = Article.objects.prefetch_related(<span class="hljs-string">&#x27;tags&#x27;</span>).order_by(<span class="hljs-string">&#x27;-created_at&#x27;</span>)<br>paginator = Paginator(articles, <span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><h3 id="3-é”™è¯¯å¤„ç†"><a href="#3-é”™è¯¯å¤„ç†" class="headerlink" title="3. é”™è¯¯å¤„ç†"></a>3. é”™è¯¯å¤„ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.core.paginator <span class="hljs-keyword">import</span> EmptyPage, PageNotAnInteger<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">article_list</span>(<span class="hljs-params">request</span>):<br>    paginator = Paginator(articles, <span class="hljs-number">10</span>)<br>    page_number = request.GET.get(<span class="hljs-string">&#x27;page&#x27;</span>, <span class="hljs-number">1</span>)<br>    <br>    <span class="hljs-keyword">try</span>:<br>        page = paginator.page(page_number)<br>    <span class="hljs-keyword">except</span> PageNotAnInteger:<br>        page = paginator.page(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">except</span> EmptyPage:<br>        page = paginator.page(paginator.num_pages)<br>    <br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;list.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;page&#x27;</span>: page&#125;)<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Djangoåˆ†é¡µå™¨çš„è®¾è®¡ä½“ç°äº†ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒåŸåˆ™ï¼š</p><ol><li><strong>å®ç”¨ä¸»ä¹‰</strong>ï¼šé€‰æ‹©é€‚åˆWebåº”ç”¨åœºæ™¯çš„ç¼“å­˜ç­–ç•¥</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé€šè¿‡@cached_propertyé¿å…é‡å¤è®¡ç®—</li><li><strong>ç®€å•å¯é </strong>ï¼šè¯·æ±‚çº§ç¼“å­˜ï¼Œé¿å…å¤æ‚çš„å¤±æ•ˆæœºåˆ¶</li><li><strong>å‘åå…¼å®¹</strong>ï¼šæ”¯æŒQuerySetå’Œæ™®é€šåˆ—è¡¨</li><li><strong>ç”¨æˆ·å‹å¥½</strong>ï¼šorphanså‚æ•°ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</li></ol><p>è¿™ä¸ªè®¾è®¡åœ¨æ€§èƒ½ã€ä¸€è‡´æ€§å’Œå¤æ‚åº¦ä¹‹é—´æ‰¾åˆ°äº†æœ€ä½³å¹³è¡¡ç‚¹ï¼Œæ˜¯Webæ¡†æ¶è®¾è®¡çš„å…¸å‹èŒƒä¾‹ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django ç­¾å</title>
    <link href="/2025/07/01/Django-%E7%AD%BE%E5%90%8D/"/>
    <url>/2025/07/01/Django-%E7%AD%BE%E5%90%8D/</url>
    
    <content type="html"><![CDATA[<h2 id="ğŸ“š-æ¦‚è¿°"><a href="#ğŸ“š-æ¦‚è¿°" class="headerlink" title="ğŸ“š æ¦‚è¿°"></a>ğŸ“š æ¦‚è¿°</h2><p>Djangoçš„ç­¾åç³»ç»Ÿæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å®‰å…¨å·¥å…·ï¼Œç”¨äºåˆ›å»ºå’ŒéªŒè¯<strong>æ•°å­—ç­¾å</strong>ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚å®ƒåŸºäºHMAC-SHA1ç®—æ³•ï¼Œä½¿ç”¨SECRET_KEYè¿›è¡Œç­¾åï¼Œé˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹æˆ–ä¼ªé€ ã€‚</p><h2 id="ğŸ”-æ ¸å¿ƒæ¦‚å¿µ"><a href="#ğŸ”-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="ğŸ” æ ¸å¿ƒæ¦‚å¿µ"></a>ğŸ” æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="ä»€ä¹ˆæ˜¯æ•°å­—ç­¾åï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ•°å­—ç­¾åï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°å­—ç­¾åï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ•°å­—ç­¾åï¼Ÿ</h3><p>æ•°å­—ç­¾åæ˜¯ä¸€ç§<strong>åŠ å¯†æŠ€æœ¯</strong>ï¼Œç”¨äºï¼š</p><ol><li><strong>éªŒè¯æ•°æ®å®Œæ•´æ€§</strong> - ç¡®ä¿æ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹</li><li><strong>éªŒè¯æ•°æ®æ¥æº</strong> - ç¡®ä¿æ•°æ®ç¡®å®æ¥è‡ªä½ çš„æœåŠ¡å™¨  </li><li><strong>é˜²æ­¢ä¼ªé€ </strong> - é˜²æ­¢æ¶æ„ç”¨æˆ·ä¼ªé€ æ•°æ®</li></ol><h3 id="ç­¾åæ ¼å¼"><a href="#ç­¾åæ ¼å¼" class="headerlink" title="ç­¾åæ ¼å¼"></a>ç­¾åæ ¼å¼</h3><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">ImhlbGxvIg:</span><span class="hljs-number">1</span>QaUZC:YIye-ze3TTx7gtSv422nZA4sgmk<br>â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<br>â”‚  æ•°æ®   â”‚æ—¶é—´æˆ³â”‚           HMACç­¾å              â”‚<br></code></pre></td></tr></table></figure><p>ä¸‰éƒ¨åˆ†ç”¨å†’å·åˆ†éš”ï¼š</p><ul><li><strong>æ•°æ®éƒ¨åˆ†</strong>ï¼šåŸå§‹æ•°æ®çš„Base64ç¼–ç </li><li><strong>æ—¶é—´æˆ³</strong>ï¼šBase62ç¼–ç çš„æ—¶é—´æˆ³ï¼ˆä»…TimestampSignerï¼‰</li><li><strong>ç­¾åéƒ¨åˆ†</strong>ï¼šHMAC-SHA1ç­¾å</li></ul><h2 id="ğŸ› ï¸-æ ¸å¿ƒç±»å’Œå‡½æ•°"><a href="#ğŸ› ï¸-æ ¸å¿ƒç±»å’Œå‡½æ•°" class="headerlink" title="ğŸ› ï¸ æ ¸å¿ƒç±»å’Œå‡½æ•°"></a>ğŸ› ï¸ æ ¸å¿ƒç±»å’Œå‡½æ•°</h2><h3 id="1-Signerç±»"><a href="#1-Signerç±»" class="headerlink" title="1. Signerç±»"></a>1. Signerç±»</h3><p>åŸºç¡€ç­¾åå™¨ï¼Œæä¾›åŸºæœ¬çš„ç­¾åå’ŒéªŒè¯åŠŸèƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.core.signing <span class="hljs-keyword">import</span> Signer<br><br>signer = Signer(<span class="hljs-string">&#x27;my-secret-key&#x27;</span>)<br>signed_value = signer.sign(<span class="hljs-string">&#x27;hello world&#x27;</span>)<br><span class="hljs-built_in">print</span>(signed_value)  <span class="hljs-comment"># &#x27;hello world:signature&#x27;</span><br><br><span class="hljs-comment"># éªŒè¯ç­¾å</span><br>original_value = signer.unsign(signed_value)<br><span class="hljs-built_in">print</span>(original_value)  <span class="hljs-comment"># &#x27;hello world&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="2-TimestampSignerç±»"><a href="#2-TimestampSignerç±»" class="headerlink" title="2. TimestampSignerç±»"></a>2. TimestampSignerç±»</h3><p>ç»§æ‰¿è‡ªSignerï¼Œæ·»åŠ æ—¶é—´æˆ³åŠŸèƒ½ï¼Œæ”¯æŒè¿‡æœŸéªŒè¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.core.signing <span class="hljs-keyword">import</span> TimestampSigner<br><br>signer = TimestampSigner(<span class="hljs-string">&#x27;my-secret-key&#x27;</span>)<br>signed_value = signer.sign(<span class="hljs-string">&#x27;hello world&#x27;</span>)<br><span class="hljs-built_in">print</span>(signed_value)  <span class="hljs-comment"># &#x27;hello world:timestamp:signature&#x27;</span><br><br><span class="hljs-comment"># éªŒè¯ç­¾åï¼ˆä¸æ£€æŸ¥è¿‡æœŸï¼‰</span><br>original_value = signer.unsign(signed_value)<br><br><span class="hljs-comment"># éªŒè¯ç­¾åï¼ˆæ£€æŸ¥è¿‡æœŸæ—¶é—´ï¼‰</span><br><span class="hljs-keyword">try</span>:<br>    original_value = signer.unsign(signed_value, max_age=<span class="hljs-number">3600</span>)  <span class="hljs-comment"># 1å°æ—¶æœ‰æ•ˆ</span><br><span class="hljs-keyword">except</span> SignatureExpired:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç­¾åå·²è¿‡æœŸ&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="3-ä¾¿åˆ©å‡½æ•°ï¼šdumps-å’Œ-loads"><a href="#3-ä¾¿åˆ©å‡½æ•°ï¼šdumps-å’Œ-loads" class="headerlink" title="3. ä¾¿åˆ©å‡½æ•°ï¼šdumps() å’Œ loads()"></a>3. ä¾¿åˆ©å‡½æ•°ï¼šdumps() å’Œ loads()</h3><h4 id="dumps-åºåˆ—åŒ–å¹¶ç­¾å"><a href="#dumps-åºåˆ—åŒ–å¹¶ç­¾å" class="headerlink" title="dumps() - åºåˆ—åŒ–å¹¶ç­¾å"></a>dumps() - åºåˆ—åŒ–å¹¶ç­¾å</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.core <span class="hljs-keyword">import</span> signing<br><br><span class="hljs-comment"># åŸºæœ¬ç”¨æ³•</span><br>token = signing.dumps(&#123;<span class="hljs-string">&#x27;user_id&#x27;</span>: <span class="hljs-number">123</span>, <span class="hljs-string">&#x27;action&#x27;</span>: <span class="hljs-string">&#x27;reset_password&#x27;</span>&#125;)<br><span class="hljs-built_in">print</span>(token)  <span class="hljs-comment"># &#x27;eyJ1c2VyX2lkIjoxMjMsImFjdGlvbiI6InJlc2V0X3Bhc3N3b3JkIn0:1QaUZC:abc123...&#x27;</span><br><br><span class="hljs-comment"># å¯ç”¨å‹ç¼©</span><br>compressed_token = signing.dumps(large_data, compress=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># è‡ªå®šä¹‰salt</span><br>custom_token = signing.dumps(data, salt=<span class="hljs-string">&#x27;my.custom.salt&#x27;</span>)<br></code></pre></td></tr></table></figure><h4 id="loads-éªŒè¯å¹¶ååºåˆ—åŒ–"><a href="#loads-éªŒè¯å¹¶ååºåˆ—åŒ–" class="headerlink" title="loads() - éªŒè¯å¹¶ååºåˆ—åŒ–"></a>loads() - éªŒè¯å¹¶ååºåˆ—åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åŸºæœ¬éªŒè¯</span><br><span class="hljs-keyword">try</span>:<br>    data = signing.loads(token)<br>    <span class="hljs-built_in">print</span>(data)  <span class="hljs-comment"># &#123;&#x27;user_id&#x27;: 123, &#x27;action&#x27;: &#x27;reset_password&#x27;&#125;</span><br><span class="hljs-keyword">except</span> signing.BadSignature:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç­¾åæ— æ•ˆ&quot;</span>)<br><br><span class="hljs-comment"># å¸¦è¿‡æœŸæ£€æŸ¥</span><br><span class="hljs-keyword">try</span>:<br>    data = signing.loads(token, max_age=<span class="hljs-number">3600</span>)  <span class="hljs-comment"># 1å°æ—¶æœ‰æ•ˆæœŸ</span><br><span class="hljs-keyword">except</span> signing.SignatureExpired:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç­¾åå·²è¿‡æœŸ&quot;</span>)<br><span class="hljs-keyword">except</span> signing.BadSignature:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç­¾åæ— æ•ˆ&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="â°-æ—¶é—´æˆ³æœºåˆ¶è¯¦è§£"><a href="#â°-æ—¶é—´æˆ³æœºåˆ¶è¯¦è§£" class="headerlink" title="â° æ—¶é—´æˆ³æœºåˆ¶è¯¦è§£"></a>â° æ—¶é—´æˆ³æœºåˆ¶è¯¦è§£</h2><h3 id="æ—¶é—´æˆ³ç”Ÿæˆ"><a href="#æ—¶é—´æˆ³ç”Ÿæˆ" class="headerlink" title="æ—¶é—´æˆ³ç”Ÿæˆ"></a>æ—¶é—´æˆ³ç”Ÿæˆ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">timestamp</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">return</span> baseconv.base62.encode(<span class="hljs-built_in">int</span>(time.time()))<br></code></pre></td></tr></table></figure><h3 id="æ—¶é—´æˆ³éªŒè¯"><a href="#æ—¶é—´æˆ³éªŒè¯" class="headerlink" title="æ—¶é—´æˆ³éªŒè¯"></a>æ—¶é—´æˆ³éªŒè¯</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">unsign</span>(<span class="hljs-params">self, value, max_age=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-comment"># æå–æ—¶é—´æˆ³</span><br>    value, timestamp = result.rsplit(<span class="hljs-variable language_">self</span>.sep, <span class="hljs-number">1</span>)<br>    timestamp = baseconv.base62.decode(timestamp)<br>    <br>    <span class="hljs-keyword">if</span> max_age <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># è®¡ç®—ç­¾åå¹´é¾„</span><br>        age = time.time() - timestamp<br>        <span class="hljs-keyword">if</span> age &gt; max_age:<br>            <span class="hljs-keyword">raise</span> SignatureExpired(...)<br>    <br>    <span class="hljs-keyword">return</span> value<br></code></pre></td></tr></table></figure><h3 id="Base62ç¼–ç "><a href="#Base62ç¼–ç " class="headerlink" title="Base62ç¼–ç "></a>Base62ç¼–ç </h3><p>Djangoä½¿ç”¨Base62ç¼–ç æ—¶é—´æˆ³ï¼ŒåŒ…å«62ä¸ªå­—ç¬¦ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">BASE62_ALPHABET = <span class="hljs-string">&#x27;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&#x27;</span><br></code></pre></td></tr></table></figure><p>ä¼˜åŠ¿ï¼š</p><ul><li><strong>URLå®‰å…¨</strong>ï¼šä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦</li><li><strong>ç´§å‡‘æ€§</strong>ï¼šæ¯”åè¿›åˆ¶æ›´çŸ­</li><li><strong>å¯è¯»æ€§</strong>ï¼šæ··åˆæ•°å­—å’Œå­—æ¯</li></ul><h2 id="ğŸ¯-å®é™…åº”ç”¨åœºæ™¯"><a href="#ğŸ¯-å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="ğŸ¯ å®é™…åº”ç”¨åœºæ™¯"></a>ğŸ¯ å®é™…åº”ç”¨åœºæ™¯</h2><h3 id="1-CSRFé˜²æŠ¤"><a href="#1-CSRFé˜²æŠ¤" class="headerlink" title="1. CSRFé˜²æŠ¤"></a>1. CSRFé˜²æŠ¤</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># django/middleware/csrf.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_token</span>(<span class="hljs-params">request</span>):<br>    csrf_secret = _get_new_csrf_string()<br>    request.META[<span class="hljs-string">&quot;CSRF_COOKIE&quot;</span>] = _salt_cipher_secret(csrf_secret)<br>    <span class="hljs-keyword">return</span> _salt_cipher_secret(csrf_secret)<br></code></pre></td></tr></table></figure><h3 id="2-Sessionæ•°æ®ï¼ˆç­¾åCookieï¼‰"><a href="#2-Sessionæ•°æ®ï¼ˆç­¾åCookieï¼‰" class="headerlink" title="2. Sessionæ•°æ®ï¼ˆç­¾åCookieï¼‰"></a>2. Sessionæ•°æ®ï¼ˆç­¾åCookieï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># django/contrib/sessions/backends/signed_cookies.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_session_key</span>(<span class="hljs-params">self</span>):<br>    session_cache = <span class="hljs-built_in">getattr</span>(<span class="hljs-variable language_">self</span>, <span class="hljs-string">&#x27;_session_cache&#x27;</span>, &#123;&#125;)<br>    <span class="hljs-keyword">return</span> signing.dumps(<br>        session_cache, compress=<span class="hljs-literal">True</span>,<br>        salt=<span class="hljs-string">&#x27;django.contrib.sessions.backends.signed_cookies&#x27;</span>,<br>    )<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">return</span> signing.loads(<br>        <span class="hljs-variable language_">self</span>.session_key,<br>        max_age=settings.SESSION_COOKIE_AGE,<br>        salt=<span class="hljs-string">&#x27;django.contrib.sessions.backends.signed_cookies&#x27;</span>,<br>    )<br></code></pre></td></tr></table></figure><h3 id="3-å¯†ç é‡ç½®ä»¤ç‰Œ"><a href="#3-å¯†ç é‡ç½®ä»¤ç‰Œ" class="headerlink" title="3. å¯†ç é‡ç½®ä»¤ç‰Œ"></a>3. å¯†ç é‡ç½®ä»¤ç‰Œ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># django/contrib/auth/forms.py</span><br>context = &#123;<br>    <span class="hljs-string">&#x27;uid&#x27;</span>: urlsafe_base64_encode(force_bytes(user.pk)),<br>    <span class="hljs-string">&#x27;token&#x27;</span>: token_generator.make_token(user),<br>    <span class="hljs-string">&#x27;protocol&#x27;</span>: <span class="hljs-string">&#x27;https&#x27;</span> <span class="hljs-keyword">if</span> use_https <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;http&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-é‚®ä»¶æ¿€æ´»é“¾æ¥"><a href="#4-é‚®ä»¶æ¿€æ´»é“¾æ¥" class="headerlink" title="4. é‚®ä»¶æ¿€æ´»é“¾æ¥"></a>4. é‚®ä»¶æ¿€æ´»é“¾æ¥</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç”Ÿæˆæ¿€æ´»ä»¤ç‰Œ</span><br>activation_token = signing.dumps(&#123;<br>    <span class="hljs-string">&#x27;user_id&#x27;</span>: user.<span class="hljs-built_in">id</span>,<br>    <span class="hljs-string">&#x27;email&#x27;</span>: user.email,<br>    <span class="hljs-string">&#x27;action&#x27;</span>: <span class="hljs-string">&#x27;activate_account&#x27;</span><br>&#125;)<br><br><span class="hljs-comment"># éªŒè¯æ¿€æ´»ä»¤ç‰Œ</span><br><span class="hljs-keyword">try</span>:<br>    data = signing.loads(token, max_age=<span class="hljs-number">24</span>*<span class="hljs-number">3600</span>)  <span class="hljs-comment"># 24å°æ—¶æœ‰æ•ˆ</span><br>    user_id = data[<span class="hljs-string">&#x27;user_id&#x27;</span>]<br>    <span class="hljs-comment"># æ¿€æ´»ç”¨æˆ·è´¦æˆ·...</span><br><span class="hljs-keyword">except</span> signing.SignatureExpired:<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;æ¿€æ´»é“¾æ¥å·²è¿‡æœŸ&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="âš™ï¸-é…ç½®è®¾ç½®"><a href="#âš™ï¸-é…ç½®è®¾ç½®" class="headerlink" title="âš™ï¸ é…ç½®è®¾ç½®"></a>âš™ï¸ é…ç½®è®¾ç½®</h2><h3 id="é»˜è®¤è¿‡æœŸæ—¶é—´è®¾ç½®"><a href="#é»˜è®¤è¿‡æœŸæ—¶é—´è®¾ç½®" class="headerlink" title="é»˜è®¤è¿‡æœŸæ—¶é—´è®¾ç½®"></a>é»˜è®¤è¿‡æœŸæ—¶é—´è®¾ç½®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># django/conf/global_settings.py</span><br><br><span class="hljs-comment"># TimestampSigneræœ¬èº«ï¼šé»˜è®¤æ°¸ä¸è¿‡æœŸï¼ˆmax_age=Noneï¼‰</span><br><span class="hljs-comment"># åªæœ‰æ˜ç¡®æŒ‡å®šmax_ageå‚æ•°æ‰ä¼šæ£€æŸ¥è¿‡æœŸ</span><br><br><span class="hljs-comment"># Sessionä¼šè¯ï¼š2å‘¨</span><br>SESSION_COOKIE_AGE = <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">7</span> * <span class="hljs-number">2</span>  <span class="hljs-comment"># 1,209,600ç§’</span><br><br><span class="hljs-comment"># å¯†ç é‡ç½®ï¼š3å¤©  </span><br>PASSWORD_RESET_TIMEOUT_DAYS = <span class="hljs-number">3</span>  <span class="hljs-comment"># 259,200ç§’</span><br><br><span class="hljs-comment"># CSRFä»¤ç‰Œï¼š1å¹´</span><br>CSRF_COOKIE_AGE = <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">7</span> * <span class="hljs-number">52</span>  <span class="hljs-comment"># 31,449,600ç§’</span><br></code></pre></td></tr></table></figure><h3 id="ç­¾ååç«¯é…ç½®"><a href="#ç­¾ååç«¯é…ç½®" class="headerlink" title="ç­¾ååç«¯é…ç½®"></a>ç­¾ååç«¯é…ç½®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é»˜è®¤ç­¾ååç«¯</span><br>SIGNING_BACKEND = <span class="hljs-string">&#x27;django.core.signing.TimestampSigner&#x27;</span><br><br><span class="hljs-comment"># SECRET_KEYç”¨äºç­¾å</span><br>SECRET_KEY = <span class="hljs-string">&#x27;your-secret-key-here&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="ğŸ”’-å®‰å…¨ç‰¹æ€§"><a href="#ğŸ”’-å®‰å…¨ç‰¹æ€§" class="headerlink" title="ğŸ”’ å®‰å…¨ç‰¹æ€§"></a>ğŸ”’ å®‰å…¨ç‰¹æ€§</h2><h3 id="1-åŸºäºHMAC-SHA1"><a href="#1-åŸºäºHMAC-SHA1" class="headerlink" title="1. åŸºäºHMAC-SHA1"></a>1. åŸºäºHMAC-SHA1</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">base64_hmac</span>(<span class="hljs-params">salt, value, key</span>):<br>    <span class="hljs-keyword">return</span> b64_encode(salted_hmac(salt, value, key).digest())<br></code></pre></td></tr></table></figure><h3 id="2-ç›å€¼æœºåˆ¶"><a href="#2-ç›å€¼æœºåˆ¶" class="headerlink" title="2. ç›å€¼æœºåˆ¶"></a>2. ç›å€¼æœºåˆ¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">signature</span>(<span class="hljs-params">self, value</span>):<br>    signature = base64_hmac(<span class="hljs-variable language_">self</span>.salt + <span class="hljs-string">&#x27;signer&#x27;</span>, value, <span class="hljs-variable language_">self</span>.key)<br>    <span class="hljs-keyword">return</span> force_str(signature)<br></code></pre></td></tr></table></figure><h3 id="3-å¸¸é‡æ—¶é—´æ¯”è¾ƒ"><a href="#3-å¸¸é‡æ—¶é—´æ¯”è¾ƒ" class="headerlink" title="3. å¸¸é‡æ—¶é—´æ¯”è¾ƒ"></a>3. å¸¸é‡æ—¶é—´æ¯”è¾ƒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">unsign</span>(<span class="hljs-params">self, signed_value</span>):<br>    <span class="hljs-comment"># ...</span><br>    <span class="hljs-keyword">if</span> constant_time_compare(sig, <span class="hljs-variable language_">self</span>.signature(value)):<br>        <span class="hljs-keyword">return</span> force_text(value)<br>    <span class="hljs-keyword">raise</span> BadSignature(...)<br></code></pre></td></tr></table></figure><h2 id="ğŸ“‹-å¼‚å¸¸å¤„ç†"><a href="#ğŸ“‹-å¼‚å¸¸å¤„ç†" class="headerlink" title="ğŸ“‹ å¼‚å¸¸å¤„ç†"></a>ğŸ“‹ å¼‚å¸¸å¤„ç†</h2><h3 id="å¼‚å¸¸ç±»å‹"><a href="#å¼‚å¸¸ç±»å‹" class="headerlink" title="å¼‚å¸¸ç±»å‹"></a>å¼‚å¸¸ç±»å‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BadSignature</span>(<span class="hljs-title class_ inherited__">Exception</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ç­¾åä¸åŒ¹é…&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SignatureExpired</span>(<span class="hljs-title class_ inherited__">BadSignature</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ç­¾åæ—¶é—´æˆ³è¶…è¿‡required max_age&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h3 id="å¼‚å¸¸å¤„ç†ç¤ºä¾‹"><a href="#å¼‚å¸¸å¤„ç†ç¤ºä¾‹" class="headerlink" title="å¼‚å¸¸å¤„ç†ç¤ºä¾‹"></a>å¼‚å¸¸å¤„ç†ç¤ºä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.core <span class="hljs-keyword">import</span> signing<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_token</span>(<span class="hljs-params">token</span>):<br>    <span class="hljs-keyword">try</span>:<br>        data = signing.loads(token, max_age=<span class="hljs-number">3600</span>)<br>        <span class="hljs-keyword">return</span> data, <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">except</span> signing.SignatureExpired:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;ä»¤ç‰Œå·²è¿‡æœŸï¼Œè¯·é‡æ–°è·å–&quot;</span><br>    <span class="hljs-keyword">except</span> signing.BadSignature:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;ä»¤ç‰Œæ— æ•ˆï¼Œå¯èƒ½è¢«ç¯¡æ”¹&quot;</span><br></code></pre></td></tr></table></figure><h2 id="ğŸ’¡-æœ€ä½³å®è·µ"><a href="#ğŸ’¡-æœ€ä½³å®è·µ" class="headerlink" title="ğŸ’¡ æœ€ä½³å®è·µ"></a>ğŸ’¡ æœ€ä½³å®è·µ</h2><h3 id="1-æ ¹æ®åœºæ™¯è®¾ç½®åˆé€‚çš„æœ‰æ•ˆæœŸ"><a href="#1-æ ¹æ®åœºæ™¯è®¾ç½®åˆé€‚çš„æœ‰æ•ˆæœŸ" class="headerlink" title="1. æ ¹æ®åœºæ™¯è®¾ç½®åˆé€‚çš„æœ‰æ•ˆæœŸ"></a>1. æ ¹æ®åœºæ™¯è®¾ç½®åˆé€‚çš„æœ‰æ•ˆæœŸ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¯†ç é‡ç½® - è¾ƒçŸ­æœ‰æ•ˆæœŸ</span><br>password_reset_token = signing.dumps(user_data)<br>signing.loads(password_reset_token, max_age=<span class="hljs-number">3600</span>)  <span class="hljs-comment"># 1å°æ—¶</span><br><br><span class="hljs-comment"># è®°ä½ç™»å½• - è¾ƒé•¿æœ‰æ•ˆæœŸ  </span><br>remember_token = signing.dumps(user_data)<br>signing.loads(remember_token, max_age=<span class="hljs-number">30</span>*<span class="hljs-number">24</span>*<span class="hljs-number">3600</span>)  <span class="hljs-comment"># 30å¤©</span><br><br><span class="hljs-comment"># ä¸´æ—¶æ“ä½œ - å¾ˆçŸ­æœ‰æ•ˆæœŸ</span><br>temp_token = signing.dumps(operation_data)<br>signing.loads(temp_token, max_age=<span class="hljs-number">300</span>)  <span class="hljs-comment"># 5åˆ†é’Ÿ</span><br></code></pre></td></tr></table></figure><h3 id="2-ä½¿ç”¨ä¸åŒçš„salt"><a href="#2-ä½¿ç”¨ä¸åŒçš„salt" class="headerlink" title="2. ä½¿ç”¨ä¸åŒçš„salt"></a>2. ä½¿ç”¨ä¸åŒçš„salt</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¸åŒç”¨é€”ä½¿ç”¨ä¸åŒçš„salt</span><br>email_token = signing.dumps(data, salt=<span class="hljs-string">&#x27;email.verification&#x27;</span>)<br>download_token = signing.dumps(data, salt=<span class="hljs-string">&#x27;file.download&#x27;</span>)<br>api_token = signing.dumps(data, salt=<span class="hljs-string">&#x27;api.access&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="3-å¤„ç†å¼‚å¸¸"><a href="#3-å¤„ç†å¼‚å¸¸" class="headerlink" title="3. å¤„ç†å¼‚å¸¸"></a>3. å¤„ç†å¼‚å¸¸</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_loads</span>(<span class="hljs-params">token, max_age=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">return</span> signing.loads(token, max_age=max_age), <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">except</span> signing.SignatureExpired:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;TOKEN_EXPIRED&quot;</span><br>    <span class="hljs-keyword">except</span> signing.BadSignature:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;TOKEN_INVALID&quot;</span><br></code></pre></td></tr></table></figure><h3 id="4-ç”Ÿäº§ç¯å¢ƒè€ƒè™‘"><a href="#4-ç”Ÿäº§ç¯å¢ƒè€ƒè™‘" class="headerlink" title="4. ç”Ÿäº§ç¯å¢ƒè€ƒè™‘"></a>4. ç”Ÿäº§ç¯å¢ƒè€ƒè™‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç¡®ä¿SECRET_KEYå®‰å…¨</span><br>SECRET_KEY = os.environ.get(<span class="hljs-string">&#x27;DJANGO_SECRET_KEY&#x27;</span>)<br><br><span class="hljs-comment"># è€ƒè™‘æ—¶é’Ÿåç§»</span><br>max_age = <span class="hljs-number">3600</span> + <span class="hljs-number">60</span>  <span class="hljs-comment"># å¤šç»™60ç§’ç¼“å†²æ—¶é—´</span><br><br><span class="hljs-comment"># æ—¥å¿—è®°å½•</span><br><span class="hljs-keyword">import</span> logging<br>logger = logging.getLogger(__name__)<br><br><span class="hljs-keyword">try</span>:<br>    data = signing.loads(token, max_age=<span class="hljs-number">3600</span>)<br><span class="hljs-keyword">except</span> signing.SignatureExpired:<br>    logger.warning(<span class="hljs-string">f&quot;Token expired for user <span class="hljs-subst">&#123;request.user.<span class="hljs-built_in">id</span>&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">raise</span><br></code></pre></td></tr></table></figure><h2 id="ğŸ”„-å®Œæ•´å·¥ä½œæµç¨‹"><a href="#ğŸ”„-å®Œæ•´å·¥ä½œæµç¨‹" class="headerlink" title="ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹"></a>ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹</h2><h3 id="ç­¾åç”Ÿæˆæµç¨‹"><a href="#ç­¾åç”Ÿæˆæµç¨‹" class="headerlink" title="ç­¾åç”Ÿæˆæµç¨‹"></a>ç­¾åç”Ÿæˆæµç¨‹</h3><ol><li><strong>æ•°æ®åºåˆ—åŒ–</strong>ï¼šå°†Pythonå¯¹è±¡è½¬æ¢ä¸ºJSON</li><li><strong>æ•°æ®å‹ç¼©</strong>ï¼šå¯é€‰ï¼Œå¦‚æœå¯ç”¨compress&#x3D;True</li><li><strong>Base64ç¼–ç </strong>ï¼šå°†æ•°æ®è½¬æ¢ä¸ºURLå®‰å…¨æ ¼å¼</li><li><strong>æ·»åŠ æ—¶é—´æˆ³</strong>ï¼šTimestampSigneræ·»åŠ å½“å‰æ—¶é—´æˆ³</li><li><strong>ç”Ÿæˆç­¾å</strong>ï¼šä½¿ç”¨HMAC-SHA1å’ŒSECRET_KEYç”Ÿæˆç­¾å</li><li><strong>ç»„åˆç»“æœ</strong>ï¼šå°†æ•°æ®ã€æ—¶é—´æˆ³ã€ç­¾åç”¨å†’å·è¿æ¥</li></ol><h3 id="ç­¾åéªŒè¯æµç¨‹"><a href="#ç­¾åéªŒè¯æµç¨‹" class="headerlink" title="ç­¾åéªŒè¯æµç¨‹"></a>ç­¾åéªŒè¯æµç¨‹</h3><ol><li><strong>åˆ†ç¦»ç»„ä»¶</strong>ï¼šæŒ‰å†’å·åˆ†ç¦»æ•°æ®ã€æ—¶é—´æˆ³ã€ç­¾å</li><li><strong>éªŒè¯ç­¾å</strong>ï¼šé‡æ–°è®¡ç®—ç­¾åå¹¶ä¸æä¾›çš„ç­¾åæ¯”è¾ƒ</li><li><strong>æ£€æŸ¥æ—¶é—´</strong>ï¼šå¦‚æœæŒ‡å®šmax_ageï¼Œæ£€æŸ¥æ˜¯å¦è¿‡æœŸ</li><li><strong>è§£ç æ•°æ®</strong>ï¼šBase64è§£ç å’ŒJSONååºåˆ—åŒ–</li><li><strong>è¿”å›ç»“æœ</strong>ï¼šè¿”å›åŸå§‹æ•°æ®æˆ–æŠ›å‡ºå¼‚å¸¸</li></ol><h2 id="ğŸš€-ç¤ºä¾‹ï¼šæ„å»ºé‚®ä»¶éªŒè¯ç³»ç»Ÿ"><a href="#ğŸš€-ç¤ºä¾‹ï¼šæ„å»ºé‚®ä»¶éªŒè¯ç³»ç»Ÿ" class="headerlink" title="ğŸš€ ç¤ºä¾‹ï¼šæ„å»ºé‚®ä»¶éªŒè¯ç³»ç»Ÿ"></a>ğŸš€ ç¤ºä¾‹ï¼šæ„å»ºé‚®ä»¶éªŒè¯ç³»ç»Ÿ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.core <span class="hljs-keyword">import</span> signing<br><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render, redirect<br><span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResponse<br><span class="hljs-keyword">import</span> datetime<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_verification_email</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å‘é€éªŒè¯é‚®ä»¶&quot;&quot;&quot;</span><br>    user_email = request.POST.get(<span class="hljs-string">&#x27;email&#x27;</span>)<br>    <br>    <span class="hljs-comment"># ç”ŸæˆéªŒè¯ä»¤ç‰Œï¼ˆ24å°æ—¶æœ‰æ•ˆï¼‰</span><br>    token_data = &#123;<br>        <span class="hljs-string">&#x27;email&#x27;</span>: user_email,<br>        <span class="hljs-string">&#x27;action&#x27;</span>: <span class="hljs-string">&#x27;verify_email&#x27;</span>,<br>        <span class="hljs-string">&#x27;user_id&#x27;</span>: request.user.<span class="hljs-built_in">id</span><br>    &#125;<br>    <br>    verification_token = signing.dumps(token_data, salt=<span class="hljs-string">&#x27;email.verification&#x27;</span>)<br>    <br>    <span class="hljs-comment"># æ„å»ºéªŒè¯é“¾æ¥</span><br>    verification_url = <span class="hljs-string">f&quot;https://example.com/verify/<span class="hljs-subst">&#123;verification_token&#125;</span>/&quot;</span><br>    <br>    <span class="hljs-comment"># å‘é€é‚®ä»¶ï¼ˆè¿™é‡Œçœç•¥é‚®ä»¶å‘é€ä»£ç ï¼‰</span><br>    <span class="hljs-comment"># send_email(user_email, verification_url)</span><br>    <br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;éªŒè¯é‚®ä»¶å·²å‘é€&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_email</span>(<span class="hljs-params">request, token</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;éªŒè¯é‚®ä»¶&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># éªŒè¯ä»¤ç‰Œï¼ˆ24å°æ—¶æœ‰æ•ˆæœŸï¼‰</span><br>        data = signing.loads(<br>            token, <br>            salt=<span class="hljs-string">&#x27;email.verification&#x27;</span>, <br>            max_age=<span class="hljs-number">24</span>*<span class="hljs-number">3600</span><br>        )<br>        <br>        <span class="hljs-comment"># æå–æ•°æ®</span><br>        email = data[<span class="hljs-string">&#x27;email&#x27;</span>]<br>        user_id = data[<span class="hljs-string">&#x27;user_id&#x27;</span>]<br>        action = data[<span class="hljs-string">&#x27;action&#x27;</span>]<br>        <br>        <span class="hljs-keyword">if</span> action != <span class="hljs-string">&#x27;verify_email&#x27;</span>:<br>            <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;æ— æ•ˆçš„éªŒè¯ç±»å‹&quot;</span>, status=<span class="hljs-number">400</span>)<br>        <br>        <span class="hljs-comment"># æ›´æ–°ç”¨æˆ·é‚®ç®±éªŒè¯çŠ¶æ€</span><br>        <span class="hljs-comment"># User.objects.filter(id=user_id).update(email_verified=True)</span><br>        <br>        <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;é‚®ç®±éªŒè¯æˆåŠŸï¼&quot;</span>)<br>        <br>    <span class="hljs-keyword">except</span> signing.SignatureExpired:<br>        <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;éªŒè¯é“¾æ¥å·²è¿‡æœŸï¼Œè¯·é‡æ–°å‘é€éªŒè¯é‚®ä»¶&quot;</span>, status=<span class="hljs-number">400</span>)<br>    <span class="hljs-keyword">except</span> signing.BadSignature:<br>        <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;æ— æ•ˆçš„éªŒè¯é“¾æ¥&quot;</span>, status=<span class="hljs-number">400</span>)<br></code></pre></td></tr></table></figure><h2 id="ğŸ“Š-æ€§èƒ½è€ƒè™‘"><a href="#ğŸ“Š-æ€§èƒ½è€ƒè™‘" class="headerlink" title="ğŸ“Š æ€§èƒ½è€ƒè™‘"></a>ğŸ“Š æ€§èƒ½è€ƒè™‘</h2><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><ul><li><strong>ç­¾åç”Ÿæˆ</strong>ï¼šO(n)ï¼Œnä¸ºæ•°æ®å¤§å°</li><li><strong>ç­¾åéªŒè¯</strong>ï¼šO(n)ï¼Œnä¸ºæ•°æ®å¤§å°</li><li><strong>æ—¶é—´æˆ³ç¼–ç &#x2F;è§£ç </strong>ï¼šO(1)</li></ul><h3 id="ç©ºé—´æ•ˆç‡"><a href="#ç©ºé—´æ•ˆç‡" class="headerlink" title="ç©ºé—´æ•ˆç‡"></a>ç©ºé—´æ•ˆç‡</h3><ul><li><strong>Base62ç¼–ç </strong>ï¼šæ¯”Base10æ›´ç´§å‡‘</li><li><strong>å‹ç¼©é€‰é¡¹</strong>ï¼šå¤§æ•°æ®å¯ä»¥å¯ç”¨compress&#x3D;True</li><li><strong>ç­¾åå¼€é”€</strong>ï¼šå›ºå®šå¤§å°çš„ç­¾åéƒ¨åˆ†</li></ul><h3 id="ç¼“å­˜ç­–ç•¥"><a href="#ç¼“å­˜ç­–ç•¥" class="headerlink" title="ç¼“å­˜ç­–ç•¥"></a>ç¼“å­˜ç­–ç•¥</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¯ä»¥ç¼“å­˜ç»å¸¸éªŒè¯çš„ä»¤ç‰Œç»“æœ</span><br><span class="hljs-keyword">from</span> django.core.cache <span class="hljs-keyword">import</span> cache<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cached_verify_token</span>(<span class="hljs-params">token</span>):<br>    cache_key = <span class="hljs-string">f&quot;token_verify_<span class="hljs-subst">&#123;<span class="hljs-built_in">hash</span>(token)&#125;</span>&quot;</span><br>    result = cache.get(cache_key)<br>    <br>    <span class="hljs-keyword">if</span> result <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">try</span>:<br>            result = signing.loads(token, max_age=<span class="hljs-number">3600</span>)<br>            cache.<span class="hljs-built_in">set</span>(cache_key, result, timeout=<span class="hljs-number">300</span>)  <span class="hljs-comment"># ç¼“å­˜5åˆ†é’Ÿ</span><br>        <span class="hljs-keyword">except</span> signing.BadSignature:<br>            result = <span class="hljs-literal">False</span><br>            cache.<span class="hljs-built_in">set</span>(cache_key, result, timeout=<span class="hljs-number">60</span>)   <span class="hljs-comment"># ç¼“å­˜å¤±è´¥1åˆ†é’Ÿ</span><br>    <br>    <span class="hljs-keyword">return</span> result<br></code></pre></td></tr></table></figure><h2 id="ğŸ”-è°ƒè¯•æŠ€å·§"><a href="#ğŸ”-è°ƒè¯•æŠ€å·§" class="headerlink" title="ğŸ” è°ƒè¯•æŠ€å·§"></a>ğŸ” è°ƒè¯•æŠ€å·§</h2><h3 id="æŸ¥çœ‹ç­¾åç»„æˆ"><a href="#æŸ¥çœ‹ç­¾åç»„æˆ" class="headerlink" title="æŸ¥çœ‹ç­¾åç»„æˆ"></a>æŸ¥çœ‹ç­¾åç»„æˆ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug_signature</span>(<span class="hljs-params">signed_value</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è°ƒè¯•ç­¾åç»„æˆéƒ¨åˆ†&quot;&quot;&quot;</span><br>    parts = signed_value.split(<span class="hljs-string">&#x27;:&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ€»å…± <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(parts)&#125;</span> éƒ¨åˆ†:&quot;</span>)<br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) &gt;= <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ•°æ®éƒ¨åˆ†: <span class="hljs-subst">&#123;parts[<span class="hljs-number">0</span>]&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æœ€åéƒ¨åˆ†(ç­¾å): <span class="hljs-subst">&#123;parts[-<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) == <span class="hljs-number">3</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ—¶é—´æˆ³éƒ¨åˆ†: <span class="hljs-subst">&#123;parts[<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">from</span> django.utils <span class="hljs-keyword">import</span> baseconv<br>            timestamp = baseconv.base62.decode(parts[<span class="hljs-number">1</span>])<br>            <span class="hljs-keyword">import</span> datetime<br>            dt = datetime.datetime.fromtimestamp(timestamp)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”Ÿæˆæ—¶é—´: <span class="hljs-subst">&#123;dt&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span><br>token = signing.dumps(<span class="hljs-string">&quot;hello world&quot;</span>)<br>debug_signature(token)<br></code></pre></td></tr></table></figure><h3 id="æµ‹è¯•ä¸åŒåœºæ™¯"><a href="#æµ‹è¯•ä¸åŒåœºæ™¯" class="headerlink" title="æµ‹è¯•ä¸åŒåœºæ™¯"></a>æµ‹è¯•ä¸åŒåœºæ™¯</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> django.core <span class="hljs-keyword">import</span> signing<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_signing_scenarios</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;æµ‹è¯•å„ç§ç­¾ååœºæ™¯&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># æµ‹è¯•åŸºæœ¬ç­¾å</span><br>    signer = signing.Signer()<br>    simple_signed = signer.sign(<span class="hljs-string">&quot;test data&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åŸºæœ¬ç­¾å:&quot;</span>, simple_signed)<br>    <br>    <span class="hljs-comment"># æµ‹è¯•æ—¶é—´æˆ³ç­¾å</span><br>    timestamp_signer = signing.TimestampSigner()<br>    time_signed = timestamp_signer.sign(<span class="hljs-string">&quot;test data&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ—¶é—´æˆ³ç­¾å:&quot;</span>, time_signed)<br>    <br>    <span class="hljs-comment"># æµ‹è¯•å¤æ‚æ•°æ®</span><br>    complex_data = &#123;<br>        <span class="hljs-string">&#x27;user_id&#x27;</span>: <span class="hljs-number">123</span>,<br>        <span class="hljs-string">&#x27;permissions&#x27;</span>: [<span class="hljs-string">&#x27;read&#x27;</span>, <span class="hljs-string">&#x27;write&#x27;</span>],<br>        <span class="hljs-string">&#x27;expires&#x27;</span>: <span class="hljs-string">&#x27;2024-12-31&#x27;</span><br>    &#125;<br>    complex_signed = signing.dumps(complex_data)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¤æ‚æ•°æ®ç­¾å:&quot;</span>, complex_signed)<br>    <br>    <span class="hljs-comment"># æµ‹è¯•å‹ç¼©</span><br>    large_data = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>))<br>    compressed = signing.dumps(large_data, compress=<span class="hljs-literal">True</span>)<br>    uncompressed = signing.dumps(large_data, compress=<span class="hljs-literal">False</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å‹ç¼©åé•¿åº¦: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(compressed)&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æœªå‹ç¼©é•¿åº¦: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(uncompressed)&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å‹ç¼©ç‡: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(compressed)/<span class="hljs-built_in">len</span>(uncompressed)*<span class="hljs-number">100</span>:<span class="hljs-number">.1</span>f&#125;</span>%&quot;</span>)<br><br>test_signing_scenarios()<br></code></pre></td></tr></table></figure><h2 id="ğŸ¯-æ€»ç»“"><a href="#ğŸ¯-æ€»ç»“" class="headerlink" title="ğŸ¯ æ€»ç»“"></a>ğŸ¯ æ€»ç»“</h2><p>Djangoçš„ç­¾åç³»ç»Ÿæ˜¯ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„å®‰å…¨å·¥å…·ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><h3 id="âœ…-ä¼˜åŠ¿"><a href="#âœ…-ä¼˜åŠ¿" class="headerlink" title="âœ… ä¼˜åŠ¿"></a>âœ… ä¼˜åŠ¿</h3><ol><li><strong>å®‰å…¨å¯é </strong>ï¼šåŸºäºHMAC-SHA1ï¼Œä½¿ç”¨SECRET_KEY</li><li><strong>ä½¿ç”¨ç®€å•</strong>ï¼šæä¾›ä¾¿åˆ©çš„dumps&#x2F;loadsæ¥å£</li><li><strong>åŠŸèƒ½å®Œæ•´</strong>ï¼šæ”¯æŒæ—¶é—´æˆ³ã€å‹ç¼©ã€è‡ªå®šä¹‰salt</li><li><strong>æ€§èƒ½è‰¯å¥½</strong>ï¼šé«˜æ•ˆçš„ç¼–ç å’Œç­¾åç®—æ³•</li><li><strong>åº”ç”¨å¹¿æ³›</strong>ï¼šCSRFã€Sessionã€å¯†ç é‡ç½®ç­‰åœºæ™¯</li></ol><h3 id="âš ï¸-æ³¨æ„äº‹é¡¹"><a href="#âš ï¸-æ³¨æ„äº‹é¡¹" class="headerlink" title="âš ï¸ æ³¨æ„äº‹é¡¹"></a>âš ï¸ æ³¨æ„äº‹é¡¹</h3><ol><li><strong>SECRET_KEYå®‰å…¨</strong>ï¼šå¿…é¡»ä¿è¯SECRET_KEYçš„å®‰å…¨æ€§</li><li><strong>æ—¶é—´åŒæ­¥</strong>ï¼šæœåŠ¡å™¨æ—¶é—´éœ€è¦å‡†ç¡®åŒæ­¥</li><li><strong>è¿‡æœŸå¤„ç†</strong>ï¼šåˆç†è®¾ç½®max_ageå‚æ•°</li><li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼šæ­£ç¡®å¤„ç†ç­¾åå¼‚å¸¸</li><li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šå¤§é‡ç­¾åæ“ä½œéœ€è¦æ€§èƒ½ç›‘æ§</li></ol><h3 id="ğŸ”®-é€‚ç”¨åœºæ™¯"><a href="#ğŸ”®-é€‚ç”¨åœºæ™¯" class="headerlink" title="ğŸ”® é€‚ç”¨åœºæ™¯"></a>ğŸ”® é€‚ç”¨åœºæ™¯</h3><ul><li>âœ… æ— çŠ¶æ€ä»¤ç‰ŒéªŒè¯</li><li>âœ… ä¸´æ—¶é“¾æ¥ç”Ÿæˆ</li><li>âœ… å®¢æˆ·ç«¯æ•°æ®å­˜å‚¨</li><li>âœ… APIè®¤è¯ä»¤ç‰Œ</li><li>âŒ é•¿æœŸå­˜å‚¨åŠ å¯†</li><li>âŒ æ•æ„Ÿæ•°æ®åŠ å¯†</li></ul><p>Djangoç­¾åç³»ç»Ÿä¸ºç°ä»£Webåº”ç”¨æä¾›äº†å¼ºå¤§çš„å®‰å…¨åŸºç¡€ï¼Œæ˜¯æ„å»ºå®‰å…¨å¯é åº”ç”¨çš„é‡è¦å·¥å…·ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django ä¿¡å·</title>
    <link href="/2025/07/01/Django-%E4%BF%A1%E5%8F%B7/"/>
    <url>/2025/07/01/Django-%E4%BF%A1%E5%8F%B7/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Djangoä¿¡å·ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºè§‚å¯Ÿè€…æ¨¡å¼çš„äº‹ä»¶ç³»ç»Ÿï¼Œå…è®¸åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨æ‰§è¡Œç›¸å…³ä»£ç ã€‚å®ƒå®ç°äº†åº”ç”¨ç»„ä»¶ä¹‹é—´çš„è§£è€¦ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤ã€‚</p><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="1-ä¿¡å·ï¼ˆSignalï¼‰"><a href="#1-ä¿¡å·ï¼ˆSignalï¼‰" class="headerlink" title="1. ä¿¡å·ï¼ˆSignalï¼‰"></a>1. ä¿¡å·ï¼ˆSignalï¼‰</h3><p>ä¿¡å·æ˜¯Djangoä¸­çš„äº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼Œå½“æŸä¸ªåŠ¨ä½œå‘ç”Ÿæ—¶ï¼Œä¿¡å·ä¼šè¢«å‘é€ç»™æ‰€æœ‰æ³¨å†Œçš„æ¥æ”¶å™¨ã€‚</p><h3 id="2-å‘é€å™¨ï¼ˆSenderï¼‰"><a href="#2-å‘é€å™¨ï¼ˆSenderï¼‰" class="headerlink" title="2. å‘é€å™¨ï¼ˆSenderï¼‰"></a>2. å‘é€å™¨ï¼ˆSenderï¼‰</h3><p>å‘é€ä¿¡å·çš„å¯¹è±¡ï¼Œé€šå¸¸æ˜¯Djangoæ¨¡å‹ç±»æˆ–Noneï¼ˆè¡¨ç¤ºä»»ä½•å‘é€å™¨ï¼‰ã€‚</p><h3 id="3-æ¥æ”¶å™¨ï¼ˆReceiverï¼‰"><a href="#3-æ¥æ”¶å™¨ï¼ˆReceiverï¼‰" class="headerlink" title="3. æ¥æ”¶å™¨ï¼ˆReceiverï¼‰"></a>3. æ¥æ”¶å™¨ï¼ˆReceiverï¼‰</h3><p>å“åº”ä¿¡å·çš„å‡½æ•°æˆ–æ–¹æ³•ï¼Œå½“ä¿¡å·è¢«å‘é€æ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p><h3 id="4-è¿æ¥ï¼ˆConnectï¼‰"><a href="#4-è¿æ¥ï¼ˆConnectï¼‰" class="headerlink" title="4. è¿æ¥ï¼ˆConnectï¼‰"></a>4. è¿æ¥ï¼ˆConnectï¼‰</h3><p>å°†æ¥æ”¶å™¨æ³¨å†Œåˆ°ç‰¹å®šä¿¡å·çš„è¿‡ç¨‹ã€‚</p><h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h2><h3 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> æ³¨å†Œé˜¶æ®µï¼ˆconnectï¼‰<br>   ç”¨æˆ·å®šä¹‰å¤„ç†å‡½æ•° â†’ è¿æ¥åˆ°ä¿¡å· â†’ å­˜å‚¨åˆ°æ¥æ”¶å™¨åˆ—è¡¨<br><br><span class="hljs-bullet">2.</span> è§¦å‘é˜¶æ®µï¼ˆsendï¼‰<br>   äº‹ä»¶å‘ç”Ÿ â†’ Djangoå‘é€ä¿¡å· â†’ æŸ¥æ‰¾æ¥æ”¶å™¨ â†’ è°ƒç”¨å¤„ç†å‡½æ•°<br></code></pre></td></tr></table></figure><h3 id="æ ¸å¿ƒæœºåˆ¶"><a href="#æ ¸å¿ƒæœºåˆ¶" class="headerlink" title="æ ¸å¿ƒæœºåˆ¶"></a>æ ¸å¿ƒæœºåˆ¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç®€åŒ–çš„ä¿¡å·ç³»ç»Ÿå®ç°</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleSignal</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.receivers = []  <span class="hljs-comment"># å­˜å‚¨ (lookup_key, receiver_ref) å¯¹</span><br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params">self, receiver, sender=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-comment"># 1. ç”ŸæˆæŸ¥æ‰¾é”®</span><br>        lookup_key = (<span class="hljs-built_in">id</span>(receiver), <span class="hljs-built_in">id</span>(sender))<br>        <span class="hljs-comment"># 2. åˆ›å»ºå¼±å¼•ç”¨</span><br>        receiver_ref = weakref.ref(receiver)<br>        <span class="hljs-comment"># 3. å­˜å‚¨</span><br>        <span class="hljs-variable language_">self</span>.receivers.append((lookup_key, receiver_ref))<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">self, sender, **kwargs</span>):<br>        <span class="hljs-comment"># 1. æŸ¥æ‰¾åŒ¹é…çš„æ¥æ”¶å™¨</span><br>        <span class="hljs-comment"># 2. ä»å¼±å¼•ç”¨è·å–çœŸå®å‡½æ•°</span><br>        <span class="hljs-comment"># 3. è°ƒç”¨å‡½æ•°å¹¶è¿”å›ç»“æœ</span><br>        results = []<br>        <span class="hljs-keyword">for</span> key, ref <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.receivers:<br>            <span class="hljs-keyword">if</span> key[<span class="hljs-number">1</span>] == <span class="hljs-built_in">id</span>(sender):<br>                receiver = ref()  <span class="hljs-comment"># è·å–çœŸå®å‡½æ•°</span><br>                <span class="hljs-keyword">if</span> receiver:<br>                    result = receiver(sender=sender, **kwargs)<br>                    results.append((receiver, result))<br>        <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure><h2 id="Djangoå†…ç½®ä¿¡å·"><a href="#Djangoå†…ç½®ä¿¡å·" class="headerlink" title="Djangoå†…ç½®ä¿¡å·"></a>Djangoå†…ç½®ä¿¡å·</h2><h3 id="æ¨¡å‹ä¿¡å·"><a href="#æ¨¡å‹ä¿¡å·" class="headerlink" title="æ¨¡å‹ä¿¡å·"></a>æ¨¡å‹ä¿¡å·</h3><h4 id="pre-save-post-save"><a href="#pre-save-post-save" class="headerlink" title="pre_save &#x2F; post_save"></a>pre_save &#x2F; post_save</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> pre_save, post_save<br><span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">user_pre_save</span>(<span class="hljs-params">sender, instance, **kwargs</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å³å°†ä¿å­˜ç”¨æˆ·: <span class="hljs-subst">&#123;instance.username&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">user_post_save</span>(<span class="hljs-params">sender, instance, created, **kwargs</span>):<br>    <span class="hljs-keyword">if</span> created:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ–°ç”¨æˆ·åˆ›å»º: <span class="hljs-subst">&#123;instance.username&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”¨æˆ·æ›´æ–°: <span class="hljs-subst">&#123;instance.username&#125;</span>&quot;</span>)<br><br>pre_save.connect(user_pre_save, sender=User)<br>post_save.connect(user_post_save, sender=User)<br></code></pre></td></tr></table></figure><h4 id="pre-delete-post-delete"><a href="#pre-delete-post-delete" class="headerlink" title="pre_delete &#x2F; post_delete"></a>pre_delete &#x2F; post_delete</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> pre_delete, post_delete<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">user_pre_delete</span>(<span class="hljs-params">sender, instance, **kwargs</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å³å°†åˆ é™¤ç”¨æˆ·: <span class="hljs-subst">&#123;instance.username&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">user_post_delete</span>(<span class="hljs-params">sender, instance, **kwargs</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”¨æˆ·å·²åˆ é™¤: <span class="hljs-subst">&#123;instance.username&#125;</span>&quot;</span>)<br><br>pre_delete.connect(user_pre_delete, sender=User)<br>post_delete.connect(user_post_delete, sender=User)<br></code></pre></td></tr></table></figure><h4 id="m2m-changed"><a href="#m2m-changed" class="headerlink" title="m2m_changed"></a>m2m_changed</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> m2m_changed<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">groups_changed</span>(<span class="hljs-params">sender, instance, action, pk_set, **kwargs</span>):<br>    <span class="hljs-keyword">if</span> action == <span class="hljs-string">&quot;post_add&quot;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”¨æˆ· <span class="hljs-subst">&#123;instance.username&#125;</span> åŠ å…¥äº†æ–°ç»„&quot;</span>)<br>    <span class="hljs-keyword">elif</span> action == <span class="hljs-string">&quot;post_remove&quot;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”¨æˆ· <span class="hljs-subst">&#123;instance.username&#125;</span> ç¦»å¼€äº†ç»„&quot;</span>)<br><br>m2m_changed.connect(groups_changed, sender=User.groups.through)<br></code></pre></td></tr></table></figure><h3 id="è¯·æ±‚-å“åº”ä¿¡å·"><a href="#è¯·æ±‚-å“åº”ä¿¡å·" class="headerlink" title="è¯·æ±‚&#x2F;å“åº”ä¿¡å·"></a>è¯·æ±‚&#x2F;å“åº”ä¿¡å·</h3><h4 id="request-started-request-finished"><a href="#request-started-request-finished" class="headerlink" title="request_started &#x2F; request_finished"></a>request_started &#x2F; request_finished</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.core.signals <span class="hljs-keyword">import</span> request_started, request_finished<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">request_start_handler</span>(<span class="hljs-params">sender, environ, **kwargs</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯·æ±‚å¼€å§‹å¤„ç†&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">request_finish_handler</span>(<span class="hljs-params">sender, **kwargs</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯·æ±‚å¤„ç†å®Œæˆ&quot;</span>)<br><br>request_started.connect(request_start_handler)<br>request_finished.connect(request_finish_handler)<br></code></pre></td></tr></table></figure><h2 id="å®ç°ç»†èŠ‚"><a href="#å®ç°ç»†èŠ‚" class="headerlink" title="å®ç°ç»†èŠ‚"></a>å®ç°ç»†èŠ‚</h2><h3 id="1-æ•°æ®ç»“æ„"><a href="#1-æ•°æ®ç»“æ„" class="headerlink" title="1. æ•°æ®ç»“æ„"></a>1. æ•°æ®ç»“æ„</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Signal</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.receivers = []  <span class="hljs-comment"># [(lookup_key, receiver_ref), ...]</span><br>        <span class="hljs-variable language_">self</span>.lock = threading.RLock()  <span class="hljs-comment"># çº¿ç¨‹å®‰å…¨é”</span><br>        <span class="hljs-variable language_">self</span>.sender_receivers_cache = weakref.WeakKeyDictionary()  <span class="hljs-comment"># æ€§èƒ½ç¼“å­˜</span><br></code></pre></td></tr></table></figure><h3 id="2-è¿æ¥å™¨å®ç°"><a href="#2-è¿æ¥å™¨å®ç°" class="headerlink" title="2. è¿æ¥å™¨å®ç°"></a>2. è¿æ¥å™¨å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params">self, receiver, sender=<span class="hljs-literal">None</span>, weak=<span class="hljs-literal">True</span>, dispatch_uid=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-comment"># å‚æ•°éªŒè¯</span><br>    <span class="hljs-keyword">if</span> settings.DEBUG:<br>        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">callable</span>(receiver), <span class="hljs-string">&quot;æ¥æ”¶å™¨å¿…é¡»æ˜¯å¯è°ƒç”¨å¯¹è±¡&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> func_accepts_kwargs(receiver):<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;æ¥æ”¶å™¨å¿…é¡»æ¥å—å…³é”®å­—å‚æ•°&quot;</span>)<br>    <br>    <span class="hljs-comment"># ç”ŸæˆæŸ¥æ‰¾é”®</span><br>    <span class="hljs-keyword">if</span> dispatch_uid:<br>        lookup_key = (dispatch_uid, _make_id(sender))<br>    <span class="hljs-keyword">else</span>:<br>        lookup_key = (_make_id(receiver), _make_id(sender))<br>    <br>    <span class="hljs-comment"># å¤„ç†å¼±å¼•ç”¨</span><br>    <span class="hljs-keyword">if</span> weak:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(receiver, <span class="hljs-string">&#x27;__self__&#x27;</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">hasattr</span>(receiver, <span class="hljs-string">&#x27;__func__&#x27;</span>):<br>            receiver_ref = WeakMethod(receiver)  <span class="hljs-comment"># ç»‘å®šæ–¹æ³•ç‰¹æ®Šå¤„ç†</span><br>        <span class="hljs-keyword">else</span>:<br>            receiver_ref = weakref.ref(receiver, <span class="hljs-variable language_">self</span>._remove_receiver)<br>    <span class="hljs-keyword">else</span>:<br>        receiver_ref = receiver<br>    <br>    <span class="hljs-comment"># çº¿ç¨‹å®‰å…¨åœ°æ·»åŠ </span><br>    <span class="hljs-keyword">with</span> <span class="hljs-variable language_">self</span>.lock:<br>        <span class="hljs-comment"># æ£€æŸ¥é‡å¤</span><br>        <span class="hljs-keyword">for</span> r_key, _ <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.receivers:<br>            <span class="hljs-keyword">if</span> r_key == lookup_key:<br>                <span class="hljs-keyword">return</span>  <span class="hljs-comment"># å·²å­˜åœ¨</span><br>        <br>        <span class="hljs-comment"># æ·»åŠ æ–°æ¥æ”¶å™¨</span><br>        <span class="hljs-variable language_">self</span>.receivers.append((lookup_key, receiver_ref))<br>        <span class="hljs-variable language_">self</span>.sender_receivers_cache.clear()  <span class="hljs-comment"># æ¸…ç©ºç¼“å­˜</span><br></code></pre></td></tr></table></figure><h3 id="3-å‘é€å™¨å®ç°"><a href="#3-å‘é€å™¨å®ç°" class="headerlink" title="3. å‘é€å™¨å®ç°"></a>3. å‘é€å™¨å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">self, sender, **named</span>):<br>    <span class="hljs-comment"># å¿«é€Ÿæ£€æŸ¥</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.receivers <span class="hljs-keyword">or</span> <span class="hljs-variable language_">self</span>.sender_receivers_cache.get(sender) <span class="hljs-keyword">is</span> NO_RECEIVERS:<br>        <span class="hljs-keyword">return</span> []<br>    <br>    <span class="hljs-comment"># è·å–æ´»è·ƒæ¥æ”¶å™¨å¹¶è°ƒç”¨</span><br>    <span class="hljs-keyword">return</span> [<br>        (receiver, receiver(signal=<span class="hljs-variable language_">self</span>, sender=sender, **named))<br>        <span class="hljs-keyword">for</span> receiver <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>._live_receivers(sender)<br>    ]<br></code></pre></td></tr></table></figure><h3 id="4-å¼±å¼•ç”¨æœºåˆ¶"><a href="#4-å¼±å¼•ç”¨æœºåˆ¶" class="headerlink" title="4. å¼±å¼•ç”¨æœºåˆ¶"></a>4. å¼±å¼•ç”¨æœºåˆ¶</h3><h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨ï¼Ÿ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é—®é¢˜ï¼šå¼ºå¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handler</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>obj = MyClass()<br>signal.connect(obj.handler)  <span class="hljs-comment"># å¼ºå¼•ç”¨é˜»æ­¢objè¢«å›æ”¶</span><br><span class="hljs-keyword">del</span> obj  <span class="hljs-comment"># objæ— æ³•è¢«åˆ é™¤ï¼Œé€ æˆå†…å­˜æ³„æ¼</span><br><br><span class="hljs-comment"># è§£å†³ï¼šå¼±å¼•ç”¨å…è®¸æ­£å¸¸å›æ”¶</span><br>signal.connect(obj.handler, weak=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># ä½¿ç”¨å¼±å¼•ç”¨</span><br><span class="hljs-keyword">del</span> obj  <span class="hljs-comment"># objå¯ä»¥æ­£å¸¸è¢«å›æ”¶</span><br></code></pre></td></tr></table></figure><h4 id="ç»‘å®šæ–¹æ³•çš„ç‰¹æ®Šå¤„ç†"><a href="#ç»‘å®šæ–¹æ³•çš„ç‰¹æ®Šå¤„ç†" class="headerlink" title="ç»‘å®šæ–¹æ³•çš„ç‰¹æ®Šå¤„ç†"></a>ç»‘å®šæ–¹æ³•çš„ç‰¹æ®Šå¤„ç†</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ™®é€šå‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_function</span>():<br>    <span class="hljs-keyword">pass</span><br>ref = weakref.ref(my_function)  <span class="hljs-comment"># æ­£å¸¸å·¥ä½œ</span><br><br><span class="hljs-comment"># ç»‘å®šæ–¹æ³•çš„é—®é¢˜</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">my_method</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>obj = MyClass()<br>method = obj.my_method  <span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªä¸´æ—¶å¯¹è±¡</span><br>ref = weakref.ref(method)  <span class="hljs-comment"># ä¼šç«‹å³å¤±æ•ˆï¼</span><br><br><span class="hljs-comment"># è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨WeakMethod</span><br>ref = WeakMethod(obj.my_method)  <span class="hljs-comment"># æ­£ç¡®å¤„ç†ç»‘å®šæ–¹æ³•</span><br></code></pre></td></tr></table></figure><h3 id="5-æ€§èƒ½ä¼˜åŒ–"><a href="#5-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="5. æ€§èƒ½ä¼˜åŒ–"></a>5. æ€§èƒ½ä¼˜åŒ–</h3><h4 id="ç¼“å­˜æœºåˆ¶"><a href="#ç¼“å­˜æœºåˆ¶" class="headerlink" title="ç¼“å­˜æœºåˆ¶"></a>ç¼“å­˜æœºåˆ¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_live_receivers</span>(<span class="hljs-params">self, sender</span>):<br>    <span class="hljs-comment"># æ£€æŸ¥ç¼“å­˜</span><br>    receivers = <span class="hljs-variable language_">self</span>.sender_receivers_cache.get(sender)<br>    <span class="hljs-keyword">if</span> receivers <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># ç¼“å­˜æœªå‘½ä¸­ï¼Œé‡æ–°æ„å»º</span><br>        receivers = []<br>        sender_id = _make_id(sender)<br>        <br>        <span class="hljs-keyword">for</span> (r_key, r_ref) <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.receivers:<br>            <span class="hljs-keyword">if</span> r_key[<span class="hljs-number">1</span>] == sender_id <span class="hljs-keyword">or</span> r_key[<span class="hljs-number">1</span>] == _make_id(<span class="hljs-literal">None</span>):<br>                receiver = <span class="hljs-variable language_">self</span>._get_receiver(r_ref)<br>                <span class="hljs-keyword">if</span> receiver:<br>                    receivers.append(receiver)<br>        <br>        <span class="hljs-comment"># ç¼“å­˜ç»“æœ</span><br>        <span class="hljs-keyword">if</span> receivers:<br>            <span class="hljs-variable language_">self</span>.sender_receivers_cache[sender] = receivers<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-variable language_">self</span>.sender_receivers_cache[sender] = NO_RECEIVERS<br>    <br>    <span class="hljs-keyword">return</span> receivers<br></code></pre></td></tr></table></figure><h4 id="æ—©æœŸé€€å‡º"><a href="#æ—©æœŸé€€å‡º" class="headerlink" title="æ—©æœŸé€€å‡º"></a>æ—©æœŸé€€å‡º</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">self, sender, **named</span>):<br>    <span class="hljs-comment"># ä¸¤å±‚æ£€æŸ¥ï¼Œå¿«é€Ÿé€€å‡º</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.receivers:<br>        <span class="hljs-keyword">return</span> []  <span class="hljs-comment"># æ²¡æœ‰ä»»ä½•æ¥æ”¶å™¨</span><br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.sender_receivers_cache.get(sender) <span class="hljs-keyword">is</span> NO_RECEIVERS:<br>        <span class="hljs-keyword">return</span> []  <span class="hljs-comment"># è¯¥å‘é€å™¨æ²¡æœ‰æ¥æ”¶å™¨</span><br>    <br>    <span class="hljs-comment"># ç»§ç»­å¤„ç†...</span><br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨æ¨¡å¼"><a href="#ä½¿ç”¨æ¨¡å¼" class="headerlink" title="ä½¿ç”¨æ¨¡å¼"></a>ä½¿ç”¨æ¨¡å¼</h2><h3 id="1-åŸºæœ¬ç”¨æ³•"><a href="#1-åŸºæœ¬ç”¨æ³•" class="headerlink" title="1. åŸºæœ¬ç”¨æ³•"></a>1. åŸºæœ¬ç”¨æ³•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> post_save<br><span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> User<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">welcome_new_user</span>(<span class="hljs-params">sender, instance, created, **kwargs</span>):<br>    <span class="hljs-keyword">if</span> created:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ¬¢è¿æ–°ç”¨æˆ·: <span class="hljs-subst">&#123;instance.username&#125;</span>&quot;</span>)<br>        <span class="hljs-comment"># å‘é€æ¬¢è¿é‚®ä»¶</span><br>        <span class="hljs-comment"># åˆ›å»ºç”¨æˆ·é…ç½®æ–‡ä»¶</span><br>        <span class="hljs-comment"># è®°å½•æ—¥å¿—</span><br><br>post_save.connect(welcome_new_user, sender=User)<br></code></pre></td></tr></table></figure><h3 id="2-ä½¿ç”¨è£…é¥°å™¨"><a href="#2-ä½¿ç”¨è£…é¥°å™¨" class="headerlink" title="2. ä½¿ç”¨è£…é¥°å™¨"></a>2. ä½¿ç”¨è£…é¥°å™¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.dispatch <span class="hljs-keyword">import</span> receiver<br><br><span class="hljs-meta">@receiver(<span class="hljs-params">post_save, sender=User</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">user_post_save_handler</span>(<span class="hljs-params">sender, instance, created, **kwargs</span>):<br>    <span class="hljs-keyword">if</span> created:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ–°ç”¨æˆ·åˆ›å»º: <span class="hljs-subst">&#123;instance.username&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="3-é˜²æ­¢é‡å¤è¿æ¥"><a href="#3-é˜²æ­¢é‡å¤è¿æ¥" class="headerlink" title="3. é˜²æ­¢é‡å¤è¿æ¥"></a>3. é˜²æ­¢é‡å¤è¿æ¥</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">post_save.connect(<br>    welcome_new_user, <br>    sender=User, <br>    dispatch_uid=<span class="hljs-string">&quot;welcome_new_user_unique&quot;</span><br>)<br><br><span class="hljs-comment"># å³ä½¿å¤šæ¬¡è°ƒç”¨ï¼Œä¹Ÿåªä¼šè¿æ¥ä¸€æ¬¡</span><br>post_save.connect(<br>    welcome_new_user, <br>    sender=User, <br>    dispatch_uid=<span class="hljs-string">&quot;welcome_new_user_unique&quot;</span>  <span class="hljs-comment"># ç›¸åŒIDï¼Œä¸ä¼šé‡å¤</span><br>)<br></code></pre></td></tr></table></figure><h3 id="4-æ‰‹åŠ¨æ–­å¼€è¿æ¥"><a href="#4-æ‰‹åŠ¨æ–­å¼€è¿æ¥" class="headerlink" title="4. æ‰‹åŠ¨æ–­å¼€è¿æ¥"></a>4. æ‰‹åŠ¨æ–­å¼€è¿æ¥</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è¿æ¥</span><br>post_save.connect(my_handler, sender=User)<br><br><span class="hljs-comment"># æ–­å¼€</span><br>post_save.disconnect(my_handler, sender=User)<br><br><span class="hljs-comment"># ä½¿ç”¨dispatch_uidæ–­å¼€</span><br>post_save.disconnect(sender=User, dispatch_uid=<span class="hljs-string">&quot;my_unique_handler&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="5-è‡ªå®šä¹‰ä¿¡å·"><a href="#5-è‡ªå®šä¹‰ä¿¡å·" class="headerlink" title="5. è‡ªå®šä¹‰ä¿¡å·"></a>5. è‡ªå®šä¹‰ä¿¡å·</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> django.dispatch<br><br><span class="hljs-comment"># å®šä¹‰è‡ªå®šä¹‰ä¿¡å·</span><br>user_logged_in = django.dispatch.Signal()<br><br><span class="hljs-comment"># è¿æ¥å¤„ç†å™¨</span><br><span class="hljs-meta">@receiver(<span class="hljs-params">user_logged_in</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_user_login</span>(<span class="hljs-params">sender, user, ip_address, **kwargs</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”¨æˆ· <span class="hljs-subst">&#123;user.username&#125;</span> ä» <span class="hljs-subst">&#123;ip_address&#125;</span> ç™»å½•&quot;</span>)<br><br><span class="hljs-comment"># åœ¨è§†å›¾ä¸­å‘é€ä¿¡å·</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login_view</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># ... ç™»å½•é€»è¾‘ ...</span><br>    user_logged_in.send(<br>        sender=<span class="hljs-literal">None</span>,<br>        user=request.user,<br>        ip_address=request.META.get(<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>)<br>    )<br></code></pre></td></tr></table></figure><h2 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h2><h3 id="send-vs-send-robust"><a href="#send-vs-send-robust" class="headerlink" title="send vs send_robust"></a>send vs send_robust</h3><h4 id="sendæ–¹æ³•ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰"><a href="#sendæ–¹æ³•ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰" class="headerlink" title="sendæ–¹æ³•ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰"></a>sendæ–¹æ³•ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">self, sender, **named</span>):<br>    <span class="hljs-comment"># ä»»ä½•æ¥æ”¶å™¨æŠ›å‡ºå¼‚å¸¸éƒ½ä¼šä¸­æ–­æ•´ä¸ªè¿‡ç¨‹</span><br>    <span class="hljs-keyword">return</span> [<br>        (receiver, receiver(signal=<span class="hljs-variable language_">self</span>, sender=sender, **named))<br>        <span class="hljs-keyword">for</span> receiver <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>._live_receivers(sender)<br>    ]<br></code></pre></td></tr></table></figure><h4 id="send-robustæ–¹æ³•ï¼ˆå®¹é”™å¤„ç†ï¼‰"><a href="#send-robustæ–¹æ³•ï¼ˆå®¹é”™å¤„ç†ï¼‰" class="headerlink" title="send_robustæ–¹æ³•ï¼ˆå®¹é”™å¤„ç†ï¼‰"></a>send_robustæ–¹æ³•ï¼ˆå®¹é”™å¤„ç†ï¼‰</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_robust</span>(<span class="hljs-params">self, sender, **named</span>):<br>    <span class="hljs-comment"># æ•è·å¼‚å¸¸ï¼Œç»§ç»­æ‰§è¡Œå…¶ä»–æ¥æ”¶å™¨</span><br>    responses = []<br>    <span class="hljs-keyword">for</span> receiver <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>._live_receivers(sender):<br>        <span class="hljs-keyword">try</span>:<br>            response = receiver(signal=<span class="hljs-variable language_">self</span>, sender=sender, **named)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err:<br>            response = err<br>        responses.append((receiver, response))<br>    <span class="hljs-keyword">return</span> responses<br></code></pre></td></tr></table></figure><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><h3 id="1-æ¥æ”¶å™¨è®¾è®¡åŸåˆ™"><a href="#1-æ¥æ”¶å™¨è®¾è®¡åŸåˆ™" class="headerlink" title="1. æ¥æ”¶å™¨è®¾è®¡åŸåˆ™"></a>1. æ¥æ”¶å™¨è®¾è®¡åŸåˆ™</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">good_receiver</span>(<span class="hljs-params">sender, instance, created, **kwargs</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    è‰¯å¥½çš„æ¥æ”¶å™¨è®¾è®¡ï¼š</span><br><span class="hljs-string">    1. æ¥å—**kwargså‚æ•°</span><br><span class="hljs-string">    2. å¤„ç†ä¸šåŠ¡é€»è¾‘ç®€æ´</span><br><span class="hljs-string">    3. é¿å…ä¿®æ”¹ä¼ å…¥çš„å¯¹è±¡</span><br><span class="hljs-string">    4. å¼‚å¸¸å¤„ç†å¾—å½“</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> created:<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># ä¸šåŠ¡é€»è¾‘</span><br>            send_welcome_email(instance)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            logger.error(<span class="hljs-string">f&quot;å‘é€æ¬¢è¿é‚®ä»¶å¤±è´¥: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>            <span class="hljs-comment"># ä¸è¦é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œé™¤éå¿…è¦</span><br></code></pre></td></tr></table></figure><h3 id="2-é¿å…å¾ªç¯è°ƒç”¨"><a href="#2-é¿å…å¾ªç¯è°ƒç”¨" class="headerlink" title="2. é¿å…å¾ªç¯è°ƒç”¨"></a>2. é¿å…å¾ªç¯è°ƒç”¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å±é™©ï¼šå¯èƒ½å¯¼è‡´æ— é™é€’å½’</span><br><span class="hljs-meta">@receiver(<span class="hljs-params">post_save, sender=User</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_user_profile</span>(<span class="hljs-params">sender, instance, **kwargs</span>):<br>    instance.last_updated = timezone.now()<br>    instance.save()  <span class="hljs-comment"># è¿™ä¼šå†æ¬¡è§¦å‘post_saveä¿¡å·ï¼</span><br><br><span class="hljs-comment"># å®‰å…¨ï¼šä½¿ç”¨updateé¿å…è§¦å‘ä¿¡å·</span><br><span class="hljs-meta">@receiver(<span class="hljs-params">post_save, sender=User</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_user_profile</span>(<span class="hljs-params">sender, instance, **kwargs</span>):<br>    User.objects.<span class="hljs-built_in">filter</span>(pk=instance.pk).update(<br>        last_updated=timezone.now()<br>    )  <span class="hljs-comment"># updateä¸ä¼šè§¦å‘ä¿¡å·</span><br></code></pre></td></tr></table></figure><h3 id="3-æ€§èƒ½è€ƒè™‘"><a href="#3-æ€§èƒ½è€ƒè™‘" class="headerlink" title="3. æ€§èƒ½è€ƒè™‘"></a>3. æ€§èƒ½è€ƒè™‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é¿å…åœ¨ä¿¡å·å¤„ç†å™¨ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ</span><br><span class="hljs-meta">@receiver(<span class="hljs-params">post_save, sender=User</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">heavy_task_handler</span>(<span class="hljs-params">sender, instance, created, **kwargs</span>):<br>    <span class="hljs-keyword">if</span> created:<br>        <span class="hljs-comment"># ä¸å¥½ï¼šåŒæ­¥æ‰§è¡Œè€—æ—¶ä»»åŠ¡</span><br>        send_complex_email(instance)  <span class="hljs-comment"># å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ</span><br>        <br>        <span class="hljs-comment"># å¥½ï¼šå¼‚æ­¥æ‰§è¡Œ</span><br>        <span class="hljs-keyword">from</span> celery <span class="hljs-keyword">import</span> current_app<br>        current_app.send_task(<span class="hljs-string">&#x27;send_welcome_email&#x27;</span>, [instance.<span class="hljs-built_in">id</span>])<br></code></pre></td></tr></table></figure><h3 id="4-æµ‹è¯•ä¿¡å·"><a href="#4-æµ‹è¯•ä¿¡å·" class="headerlink" title="4. æµ‹è¯•ä¿¡å·"></a>4. æµ‹è¯•ä¿¡å·</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.test <span class="hljs-keyword">import</span> TestCase<br><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> post_save<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SignalTestCase</span>(<span class="hljs-title class_ inherited__">TestCase</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_user_creation_signal</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># æ–¹æ³•1ï¼šæ£€æŸ¥ä¿¡å·æ˜¯å¦è¢«æ­£ç¡®å‘é€</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-variable language_">self</span>.assertSignalSent(post_save, sender=User):<br>            User.objects.create_user(username=<span class="hljs-string">&#x27;test&#x27;</span>)<br>        <br>        <span class="hljs-comment"># æ–¹æ³•2ï¼šä¸´æ—¶æ–­å¼€ä¿¡å·è¿›è¡Œæµ‹è¯•</span><br>        post_save.disconnect(welcome_new_user, sender=User)<br>        <span class="hljs-keyword">try</span>:<br>            user = User.objects.create_user(username=<span class="hljs-string">&#x27;test&#x27;</span>)<br>            <span class="hljs-comment"># æµ‹è¯•ä¸ä¾èµ–ä¿¡å·çš„é€»è¾‘</span><br>        <span class="hljs-keyword">finally</span>:<br>            post_save.connect(welcome_new_user, sender=User)<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Djangoä¿¡å·ç³»ç»Ÿçš„æ ¸å¿ƒæœºåˆ¶ï¼š</p><ol><li><strong>æ³¨å†Œé˜¶æ®µ</strong>ï¼š<code>connect</code>æ–¹æ³•å°†æ¥æ”¶å™¨å‡½æ•°ä¸ä¿¡å·å…³è”ï¼Œå­˜å‚¨ä¸ºå¼±å¼•ç”¨</li><li><strong>è§¦å‘é˜¶æ®µ</strong>ï¼š<code>send</code>æ–¹æ³•æ ¹æ®å‘é€è€…æŸ¥æ‰¾å¯¹åº”æ¥æ”¶å™¨å¹¶è°ƒç”¨</li><li><strong>å†…å­˜ç®¡ç†</strong>ï¼šå¼±å¼•ç”¨ç¡®ä¿å¯¹è±¡å¯ä»¥æ­£å¸¸è¢«åƒåœ¾å›æ”¶</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šç¼“å­˜æœºåˆ¶å’Œæ—©æœŸé€€å‡ºæé«˜æ‰§è¡Œæ•ˆç‡</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šä½¿ç”¨é”ä¿æŠ¤å…±äº«æ•°æ®ç»“æ„</li></ol><p>ä¿¡å·ç³»ç»Ÿå®ç°äº†æ¾è€¦åˆçš„äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œæ˜¯Djangoæ¡†æ¶ä¸­ä¼˜é›…çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚æ­£ç¡®ä½¿ç”¨ä¿¡å·å¯ä»¥è®©ä»£ç æ›´åŠ æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django WSGI æ¶æ„è§£æ</title>
    <link href="/2025/06/26/Django-WSGI-%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/"/>
    <url>/2025/06/26/Django-WSGI-%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æœ¬æ–‡æ¡£è¯¦ç»†è§£æäº†Djangoçš„WSGIæ¶æ„ï¼ŒåŒ…æ‹¬å¼€å‘ç¯å¢ƒçš„<code>runserver</code>å‘½ä»¤ã€<code>WSGIHandler</code>è¯·æ±‚å¤„ç†å™¨ã€<code>WSGIServer</code>æœåŠ¡å™¨ï¼Œä»¥åŠç”Ÿäº§ç¯å¢ƒçš„æœåŠ¡å™¨é€‰æ‹©ã€‚</p><h2 id="1-Django-runserver-å‘½ä»¤è§£æ"><a href="#1-Django-runserver-å‘½ä»¤è§£æ" class="headerlink" title="1. Django runserver å‘½ä»¤è§£æ"></a>1. Django runserver å‘½ä»¤è§£æ</h2><h3 id="1-1-å‘½ä»¤æ¦‚è¿°"><a href="#1-1-å‘½ä»¤æ¦‚è¿°" class="headerlink" title="1.1 å‘½ä»¤æ¦‚è¿°"></a>1.1 å‘½ä»¤æ¦‚è¿°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Command</span>(<span class="hljs-title class_ inherited__">BaseCommand</span>):<br>    <span class="hljs-built_in">help</span> = <span class="hljs-string">&quot;Starts a lightweight Web server for development.&quot;</span><br></code></pre></td></tr></table></figure><p><code>runserver</code>æ˜¯Djangoæä¾›çš„<strong>è½»é‡çº§å¼€å‘æœåŠ¡å™¨</strong>ï¼Œä¸“é—¨ç”¨äºå¼€å‘ç¯å¢ƒï¼Œ<strong>ä¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ</strong>ã€‚</p><h3 id="1-2-å‘½ä»¤è¡Œå‚æ•°"><a href="#1-2-å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="1.2 å‘½ä»¤è¡Œå‚æ•°"></a>1.2 å‘½ä»¤è¡Œå‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_arguments</span>(<span class="hljs-params">self, parser</span>):<br>    parser.add_argument(<br>        <span class="hljs-string">&#x27;addrport&#x27;</span>, nargs=<span class="hljs-string">&#x27;?&#x27;</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;Optional port number, or ipaddr:port&#x27;</span><br>    )<br>    parser.add_argument(<br>        <span class="hljs-string">&#x27;--ipv6&#x27;</span>, <span class="hljs-string">&#x27;-6&#x27;</span>, action=<span class="hljs-string">&#x27;store_true&#x27;</span>, dest=<span class="hljs-string">&#x27;use_ipv6&#x27;</span>, default=<span class="hljs-literal">False</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;Tells Django to use an IPv6 address.&#x27;</span>,<br>    )<br>    parser.add_argument(<br>        <span class="hljs-string">&#x27;--nothreading&#x27;</span>, action=<span class="hljs-string">&#x27;store_false&#x27;</span>, dest=<span class="hljs-string">&#x27;use_threading&#x27;</span>, default=<span class="hljs-literal">True</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;Tells Django to NOT use threading.&#x27;</span>,<br>    )<br>    parser.add_argument(<br>        <span class="hljs-string">&#x27;--noreload&#x27;</span>, action=<span class="hljs-string">&#x27;store_false&#x27;</span>, dest=<span class="hljs-string">&#x27;use_reloader&#x27;</span>, default=<span class="hljs-literal">True</span>,<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;Tells Django to NOT use the auto-reloader.&#x27;</span>,<br>    )<br></code></pre></td></tr></table></figure><h3 id="1-3-å¯åŠ¨æµç¨‹"><a href="#1-3-å¯åŠ¨æµç¨‹" class="headerlink" title="1.3 å¯åŠ¨æµç¨‹"></a>1.3 å¯åŠ¨æµç¨‹</h3><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs elm">ç”¨æˆ·æ‰§è¡Œ: python manage.py runserver<br>    â†“<br><span class="hljs-number">1.</span> è§£æå‘½ä»¤è¡Œå‚æ•°<br>    â”œâ”€ addr<span class="hljs-keyword">port</span> (åœ°å€:ç«¯å£)<br>    â”œâ”€ <span class="hljs-comment">--ipv6 (IPv6æ”¯æŒ)</span><br>    â”œâ”€ <span class="hljs-comment">--nothreading (ç¦ç”¨çº¿ç¨‹)</span><br>    â””â”€ <span class="hljs-comment">--noreload (ç¦ç”¨é‡è½½)</span><br>    â†“<br><span class="hljs-number">2.</span> éªŒè¯é…ç½®<br>    â”œâ”€ æ£€æŸ¥ <span class="hljs-type">DEBUG</span> å’Œ <span class="hljs-type">ALLOWED_HOSTS</span><br>    â”œâ”€ éªŒè¯ <span class="hljs-type">IPv6</span> æ”¯æŒ<br>    â””â”€ è§£æåœ°å€å’Œç«¯å£<br>    â†“<br><span class="hljs-number">3.</span> é€‰æ‹©è¿è¡Œæ¨¡å¼<br>    â”œâ”€ è‡ªåŠ¨é‡è½½æ¨¡å¼ (é»˜è®¤)<br>    â”‚   â”œâ”€ å¯åŠ¨ç›‘æ§çº¿ç¨‹<br>    â”‚   â”œâ”€ æ£€æµ‹æ–‡ä»¶å˜åŒ–<br>    â”‚   â””â”€ è‡ªåŠ¨é‡å¯æœåŠ¡å™¨<br>    â””â”€ ç›´æ¥è¿è¡Œæ¨¡å¼<br>    â†“<br><span class="hljs-number">4.</span> ç³»ç»Ÿæ£€æŸ¥<br>    â”œâ”€ æ¨¡å‹éªŒè¯<br>    â”œâ”€ è¿ç§»æ£€æŸ¥<br>    â””â”€ é…ç½®éªŒè¯<br>    â†“<br><span class="hljs-number">5.</span> å¯åŠ¨<span class="hljs-type">Web</span>æœåŠ¡å™¨<br>    â”œâ”€ è·å–<span class="hljs-type">WSGI</span>å¤„ç†å™¨<br>    â”œâ”€ åˆ›å»ºsocketç›‘å¬<br>    â”œâ”€ å¯åŠ¨è¯·æ±‚å¤„ç†å¾ªç¯<br>    â””â”€ å¤„ç†<span class="hljs-type">HTTP</span>è¯·æ±‚<br></code></pre></td></tr></table></figure><h3 id="1-4-è‡ªåŠ¨é‡è½½æœºåˆ¶"><a href="#1-4-è‡ªåŠ¨é‡è½½æœºåˆ¶" class="headerlink" title="1.4 è‡ªåŠ¨é‡è½½æœºåˆ¶"></a>1.4 è‡ªåŠ¨é‡è½½æœºåˆ¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self, **options</span>):<br>    use_reloader = options[<span class="hljs-string">&#x27;use_reloader&#x27;</span>]<br>    <br>    <span class="hljs-keyword">if</span> use_reloader:<br>        autoreload.main(<span class="hljs-variable language_">self</span>.inner_run, <span class="hljs-literal">None</span>, options)  <span class="hljs-comment"># è‡ªåŠ¨é‡è½½æ¨¡å¼</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-variable language_">self</span>.inner_run(<span class="hljs-literal">None</span>, **options)  <span class="hljs-comment"># ç›´æ¥è¿è¡Œæ¨¡å¼</span><br></code></pre></td></tr></table></figure><p>è‡ªåŠ¨é‡è½½é€šè¿‡ä»¥ä¸‹æ–¹å¼å·¥ä½œï¼š</p><ol><li><strong>æ–‡ä»¶ç›‘æ§</strong>: ç›‘æ§Pythonæ–‡ä»¶çš„å˜åŒ–</li><li><strong>è¿›ç¨‹é‡å¯</strong>: æ£€æµ‹åˆ°å˜åŒ–æ—¶é‡å¯æ•´ä¸ªè¿›ç¨‹</li><li><strong>æ— ç¼åˆ‡æ¢</strong>: ç”¨æˆ·æ— æ„ŸçŸ¥çš„æœåŠ¡å™¨é‡å¯</li></ol><h2 id="2-WSGIHandler-è¯·æ±‚å¤„ç†å™¨"><a href="#2-WSGIHandler-è¯·æ±‚å¤„ç†å™¨" class="headerlink" title="2. WSGIHandler è¯·æ±‚å¤„ç†å™¨"></a>2. WSGIHandler è¯·æ±‚å¤„ç†å™¨</h2><h3 id="2-1-æœ¬è´¨ç†è§£"><a href="#2-1-æœ¬è´¨ç†è§£" class="headerlink" title="2.1 æœ¬è´¨ç†è§£"></a>2.1 æœ¬è´¨ç†è§£</h3><p><strong>é‡è¦æ¦‚å¿µ</strong>: <code>WSGIHandler</code> <strong>ä¸æ˜¯æœåŠ¡å™¨ï¼Œè€Œæ˜¯è¯·æ±‚å¤„ç†å™¨</strong>ï¼Œè´Ÿè´£å¤„ç†å•ä¸ªè¯·æ±‚ã€‚</p><h3 id="2-2-æ ¸å¿ƒèŒè´£"><a href="#2-2-æ ¸å¿ƒèŒè´£" class="headerlink" title="2.2 æ ¸å¿ƒèŒè´£"></a>2.2 æ ¸å¿ƒèŒè´£</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WSGIHandler</span>(base.BaseHandler):<br>    request_class = WSGIRequest<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self, environ, start_response</span>):<br>        <span class="hljs-comment"># 1. è®¾ç½®è„šæœ¬å‰ç¼€</span><br>        set_script_prefix(get_script_name(environ))<br>        <br>        <span class="hljs-comment"># 2. å‘é€è¯·æ±‚å¼€å§‹ä¿¡å·</span><br>        signals.request_started.send(sender=<span class="hljs-variable language_">self</span>.__class__, environ=environ)<br>        <br>        <span class="hljs-comment"># 3. åˆ›å»ºDjangoè¯·æ±‚å¯¹è±¡</span><br>        request = <span class="hljs-variable language_">self</span>.request_class(environ)<br>        <br>        <span class="hljs-comment"># 4. è·å–å“åº”</span><br>        response = <span class="hljs-variable language_">self</span>.get_response(request)<br>        <br>        <span class="hljs-comment"># 5. è®¾ç½®å“åº”å¤´</span><br>        status = <span class="hljs-string">&#x27;%d %s&#x27;</span> % (response.status_code, response.reason_phrase)<br>        response_headers = [(<span class="hljs-built_in">str</span>(k), <span class="hljs-built_in">str</span>(v)) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> response.items()]<br>        <br>        <span class="hljs-comment"># 6. å¤„ç†Cookie</span><br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> response.cookies.values():<br>            response_headers.append((<span class="hljs-built_in">str</span>(<span class="hljs-string">&#x27;Set-Cookie&#x27;</span>), <span class="hljs-built_in">str</span>(c.output(header=<span class="hljs-string">&#x27;&#x27;</span>))))<br>        <br>        <span class="hljs-comment"># 7. è°ƒç”¨WSGIçš„start_response</span><br>        start_response(force_str(status), response_headers)<br>        <br>        <span class="hljs-comment"># 8. è¿”å›å“åº”å†…å®¹</span><br>        <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h3 id="2-3-ä¸‰ä¸ªæ ¸å¿ƒèŒè´£"><a href="#2-3-ä¸‰ä¸ªæ ¸å¿ƒèŒè´£" class="headerlink" title="2.3 ä¸‰ä¸ªæ ¸å¿ƒèŒè´£"></a>2.3 ä¸‰ä¸ªæ ¸å¿ƒèŒè´£</h3><h4 id="èŒè´£1-ç¯å¢ƒå­—å…¸-â†’-Djangoè¯·æ±‚å¯¹è±¡"><a href="#èŒè´£1-ç¯å¢ƒå­—å…¸-â†’-Djangoè¯·æ±‚å¯¹è±¡" class="headerlink" title="èŒè´£1: ç¯å¢ƒå­—å…¸ â†’ Djangoè¯·æ±‚å¯¹è±¡"></a>èŒè´£1: ç¯å¢ƒå­—å…¸ â†’ Djangoè¯·æ±‚å¯¹è±¡</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è¾“å…¥: WSGIç¯å¢ƒå­—å…¸</span><br>environ = &#123;<br>    <span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>: <span class="hljs-string">&#x27;GET&#x27;</span>,<br>    <span class="hljs-string">&#x27;PATH_INFO&#x27;</span>: <span class="hljs-string">&#x27;/hello/&#x27;</span>,<br>    <span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>: <span class="hljs-string">&#x27;name=world&#x27;</span>,<br>    <span class="hljs-string">&#x27;HTTP_HOST&#x27;</span>: <span class="hljs-string">&#x27;localhost:8000&#x27;</span>,<br>    <span class="hljs-string">&#x27;wsgi.input&#x27;</span>: &lt;file-like <span class="hljs-built_in">object</span>&gt;,<br>    <span class="hljs-comment"># ... å…¶ä»–ç¯å¢ƒå˜é‡</span><br>&#125;<br><br><span class="hljs-comment"># WSGIHandler è½¬æ¢</span><br>request = WSGIRequest(environ)<br><span class="hljs-comment"># ç»“æœ: Django HttpRequest å¯¹è±¡</span><br></code></pre></td></tr></table></figure><h4 id="èŒè´£2-èµ°Djangoä¸­é—´ä»¶æµç¨‹"><a href="#èŒè´£2-èµ°Djangoä¸­é—´ä»¶æµç¨‹" class="headerlink" title="èŒè´£2: èµ°Djangoä¸­é—´ä»¶æµç¨‹"></a>èŒè´£2: èµ°Djangoä¸­é—´ä»¶æµç¨‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_response</span>(<span class="hljs-params">self, request</span>):<br>    <span class="hljs-comment"># 1. ä¸­é—´ä»¶ process_request</span><br>    <span class="hljs-keyword">for</span> middleware <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>._request_middleware:<br>        response = middleware.process_request(request)<br>        <span class="hljs-keyword">if</span> response:<br>            <span class="hljs-keyword">return</span> response<br>    <br>    <span class="hljs-comment"># 2. è·¯ç”±è§£æ</span><br>    resolver_match = resolver.resolve(request.path_info)<br>    request.resolver_match = resolver_match<br>    <br>    <span class="hljs-comment"># 3. ä¸­é—´ä»¶ process_view</span><br>    <span class="hljs-keyword">for</span> middleware <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>._view_middleware:<br>        response = middleware.process_view(request, callback, callback_args, callback_kwargs)<br>        <span class="hljs-keyword">if</span> response:<br>            <span class="hljs-keyword">return</span> response<br>    <br>    <span class="hljs-comment"># 4. æ‰§è¡Œè§†å›¾å‡½æ•°</span><br>    response = callback(request, *callback_args, **callback_kwargs)<br>    <br>    <span class="hljs-comment"># 5. ä¸­é—´ä»¶ process_response</span><br>    <span class="hljs-keyword">for</span> middleware <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(<span class="hljs-variable language_">self</span>._response_middleware):<br>        response = middleware.process_response(request, response)<br>    <br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h4 id="èŒè´£3-Djangoå“åº”-â†’-WSGIå“åº”"><a href="#èŒè´£3-Djangoå“åº”-â†’-WSGIå“åº”" class="headerlink" title="èŒè´£3: Djangoå“åº” â†’ WSGIå“åº”"></a>èŒè´£3: Djangoå“åº” â†’ WSGIå“åº”</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è¾“å…¥: Django HttpResponse</span><br>response = HttpResponse(<span class="hljs-string">&quot;Hello World&quot;</span>)<br>response.status_code = <span class="hljs-number">200</span><br>response[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] = <span class="hljs-string">&#x27;text/html&#x27;</span><br><br><span class="hljs-comment"># WSGIHandler è½¬æ¢</span><br>status = <span class="hljs-string">&#x27;200 OK&#x27;</span><br>response_headers = [(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;text/html&#x27;</span>), (<span class="hljs-string">&#x27;Content-Length&#x27;</span>, <span class="hljs-string">&#x27;11&#x27;</span>)]<br>start_response(status, response_headers)<br><span class="hljs-keyword">return</span> [<span class="hljs-string">b&quot;Hello World&quot;</span>]<br></code></pre></td></tr></table></figure><h3 id="2-4-å®Œæ•´çš„è¯·æ±‚å¤„ç†æµç¨‹"><a href="#2-4-å®Œæ•´çš„è¯·æ±‚å¤„ç†æµç¨‹" class="headerlink" title="2.4 å®Œæ•´çš„è¯·æ±‚å¤„ç†æµç¨‹"></a>2.4 å®Œæ•´çš„è¯·æ±‚å¤„ç†æµç¨‹</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs scss">HTTPè¯·æ±‚åˆ°è¾¾<br>    â†“<br>WSGIServer æ¥æ”¶è¯·æ±‚<br>    â†“<br>è°ƒç”¨ WSGIHandler<span class="hljs-selector-class">.__call__</span>(environ, start_response)<br>    â†“<br>åˆ›å»º WSGIRequest å¯¹è±¡ï¼ˆä»environå­—å…¸ï¼‰<br>    â†“<br>è°ƒç”¨ self<span class="hljs-selector-class">.get_response</span>(request)<br>    â†“<br>ç»è¿‡ä¸­é—´ä»¶å¤„ç†<br>    â†“<br>è·¯ç”±åˆ°å¯¹åº”çš„è§†å›¾å‡½æ•°<br>    â†“<br>è¿”å› HttpResponse å¯¹è±¡<br>    â†“<br>WSGIHandler å°†å“åº”è½¬æ¢ä¸ºWSGIæ ¼å¼<br>    â†“<br>è°ƒç”¨ <span class="hljs-built_in">start_response</span>(status, headers)<br>    â†“<br>è¿”å›å“åº”å†…å®¹<br></code></pre></td></tr></table></figure><h2 id="3-WSGIServer-SocketæœåŠ¡å™¨"><a href="#3-WSGIServer-SocketæœåŠ¡å™¨" class="headerlink" title="3. WSGIServer SocketæœåŠ¡å™¨"></a>3. WSGIServer SocketæœåŠ¡å™¨</h2><h3 id="3-1-ç»§æ‰¿å…³ç³»"><a href="#3-1-ç»§æ‰¿å…³ç³»" class="headerlink" title="3.1 ç»§æ‰¿å…³ç³»"></a>3.1 ç»§æ‰¿å…³ç³»</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># django/core/servers/basehttp.py</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WSGIServer</span>(simple_server.WSGIServer, <span class="hljs-built_in">object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;BaseHTTPServer that implements the Python WSGI protocol&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># wsgiref/simple_server.py (Pythonæ ‡å‡†åº“)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WSGIServer</span>(<span class="hljs-title class_ inherited__">HTTPServer</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;BaseHTTPServer that implements the Python WSGI protocol&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># http/server.py (Pythonæ ‡å‡†åº“)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HTTPServer</span>(socketserver.TCPServer):<br>    <span class="hljs-string">&quot;&quot;&quot;HTTP server that implements the Python WSGI protocol&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># socketserver.py (Pythonæ ‡å‡†åº“)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TCPServer</span>(socketserver.BaseServer):<br>    <span class="hljs-string">&quot;&quot;&quot;TCP server class&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><p><strong>ç»§æ‰¿é“¾</strong>:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">WSGIServer</span> â†’ simple_server.WSGIServer â†’ HTTPServer â†’ TCPServer â†’ BaseServer<br></code></pre></td></tr></table></figure><h3 id="3-2-SocketæœåŠ¡å™¨æœ¬è´¨"><a href="#3-2-SocketæœåŠ¡å™¨æœ¬è´¨" class="headerlink" title="3.2 SocketæœåŠ¡å™¨æœ¬è´¨"></a>3.2 SocketæœåŠ¡å™¨æœ¬è´¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">serve_forever</span>(<span class="hljs-params">self, poll_interval=<span class="hljs-number">0.5</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Handle one request at a time until shutdown.&quot;&quot;&quot;</span><br>        <span class="hljs-variable language_">self</span>.__is_shut_down.clear()<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># <span class="hljs-doctag">XXX:</span> Consider using another file descriptor or connecting to the</span><br>            <span class="hljs-comment"># socket to wake this up instead of polling. Polling reduces our</span><br>            <span class="hljs-comment"># responsiveness to a shutdown request and wastes cpu at all other</span><br>            <span class="hljs-comment"># times.</span><br>            <span class="hljs-comment"># ä½¿ç”¨ selectors è¿›è¡Œéé˜»å¡ I/O</span><br>            <span class="hljs-keyword">with</span> _ServerSelector() <span class="hljs-keyword">as</span> selector:<br>                selector.register(<span class="hljs-variable language_">self</span>, selectors.EVENT_READ)  <span class="hljs-comment"># ç›‘å¬è¯»äº‹ä»¶</span><br><br>                <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.__shutdown_request:<br>                    ready = selector.select(poll_interval)  <span class="hljs-comment"># ç­‰å¾… socket å¯è¯»</span><br>                    <span class="hljs-comment"># bpo-35017: shutdown() called during select(), exit immediately.</span><br>                    <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.__shutdown_request:  <span class="hljs-comment"># å¦‚æœéœ€è¦å…³é—­ï¼Œåˆ™é€€å‡ºå¾ªç¯</span><br>                        <span class="hljs-keyword">break</span><br>                    <span class="hljs-keyword">if</span> ready:<br>                        <span class="hljs-variable language_">self</span>._handle_request_noblock()  <span class="hljs-comment"># å¤„ç†æ–°è¯·æ±‚</span><br><br>                    <span class="hljs-variable language_">self</span>.service_actions()  <span class="hljs-comment"># å¤„ç†å…¶ä»–æ“ä½œ</span><br>        <span class="hljs-keyword">finally</span>:<br>            <span class="hljs-variable language_">self</span>.__shutdown_request = <span class="hljs-literal">False</span><br>            <span class="hljs-variable language_">self</span>.__is_shut_down.<span class="hljs-built_in">set</span>()<br></code></pre></td></tr></table></figure><h3 id="3-3-SocketæœåŠ¡å™¨å·¥ä½œæµç¨‹"><a href="#3-3-SocketæœåŠ¡å™¨å·¥ä½œæµç¨‹" class="headerlink" title="3.3 SocketæœåŠ¡å™¨å·¥ä½œæµç¨‹"></a>3.3 SocketæœåŠ¡å™¨å·¥ä½œæµç¨‹</h3><h4 id="1-åˆ›å»ºSocket"><a href="#1-åˆ›å»ºSocket" class="headerlink" title="1. åˆ›å»ºSocket"></a>1. åˆ›å»ºSocket</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åœ¨ WSGIServer åˆå§‹åŒ–æ—¶</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, server_address, RequestHandlerClass, bind_and_activate=<span class="hljs-literal">True</span></span>):<br>    <span class="hljs-comment"># åˆ›å»º TCP socket</span><br>    <span class="hljs-variable language_">self</span>.socket = socket.socket(<span class="hljs-variable language_">self</span>.address_family, <span class="hljs-variable language_">self</span>.socket_type)<br>    <span class="hljs-variable language_">self</span>.socket.setsockopt(socket.SOL_SOCKIT, socket.SO_REUSEADDR, <span class="hljs-number">1</span>)<br>    <span class="hljs-variable language_">self</span>.socket.bind(server_address)  <span class="hljs-comment"># ç»‘å®šåœ°å€å’Œç«¯å£</span><br>    <span class="hljs-variable language_">self</span>.socket.listen(<span class="hljs-variable language_">self</span>.request_queue_size)  <span class="hljs-comment"># å¼€å§‹ç›‘å¬</span><br></code></pre></td></tr></table></figure><h4 id="2-ç›‘å¬å¾ªç¯"><a href="#2-ç›‘å¬å¾ªç¯" class="headerlink" title="2. ç›‘å¬å¾ªç¯"></a>2. ç›‘å¬å¾ªç¯</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æŒç»­ç›‘å¬è¿æ¥</span><br><span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.__shutdown_request:<br>    ready = selector.select(poll_interval)  <span class="hljs-comment"># ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</span><br>    <span class="hljs-keyword">if</span> ready:<br>        <span class="hljs-variable language_">self</span>._handle_request_noblock()  <span class="hljs-comment"># å¤„ç†æ–°è¿æ¥</span><br></code></pre></td></tr></table></figure><h4 id="3-å¤„ç†è¯·æ±‚"><a href="#3-å¤„ç†è¯·æ±‚" class="headerlink" title="3. å¤„ç†è¯·æ±‚"></a>3. å¤„ç†è¯·æ±‚</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_handle_request_noblock</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">try</span>:<br>        request, client_address = <span class="hljs-variable language_">self</span>.socket.accept()  <span class="hljs-comment"># æ¥å—è¿æ¥</span><br>        <span class="hljs-variable language_">self</span>.process_request(request, client_address)   <span class="hljs-comment"># å¤„ç†è¯·æ±‚</span><br>    <span class="hljs-keyword">except</span> socket.error:<br>        <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h3 id="3-4-å®Œæ•´çš„HTTPå¤„ç†æµç¨‹"><a href="#3-4-å®Œæ•´çš„HTTPå¤„ç†æµç¨‹" class="headerlink" title="3.4 å®Œæ•´çš„HTTPå¤„ç†æµç¨‹"></a>3.4 å®Œæ•´çš„HTTPå¤„ç†æµç¨‹</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> Socket ç›‘å¬ (8000ç«¯å£)<br>   â†“<br><span class="hljs-bullet">2.</span> å®¢æˆ·ç«¯è¿æ¥ (æµè§ˆå™¨)<br>   â†“<br><span class="hljs-bullet">3.</span> Socket.accept() æ¥å—è¿æ¥<br>   â†“<br><span class="hljs-bullet">4.</span> åˆ›å»º RequestHandler å¤„ç† HTTP è¯·æ±‚<br>   â†“<br><span class="hljs-bullet">5.</span> è§£æ HTTP è¯·æ±‚å¤´<br>   â†“<br><span class="hljs-bullet">6.</span> åˆ›å»º WSGI ç¯å¢ƒå­—å…¸<br>   â†“<br><span class="hljs-bullet">7.</span> è°ƒç”¨ WSGIHandler(environ, start<span class="hljs-emphasis">_response)</span><br><span class="hljs-emphasis">   â†“</span><br><span class="hljs-emphasis">8. WSGIHandler å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”</span><br><span class="hljs-emphasis">   â†“</span><br><span class="hljs-emphasis">9. å‘é€ HTTP å“åº”ç»™å®¢æˆ·ç«¯</span><br><span class="hljs-emphasis">   â†“</span><br><span class="hljs-emphasis">10. å…³é—­è¿æ¥ï¼Œç»§ç»­ç›‘å¬ä¸‹ä¸€ä¸ªè¯·æ±‚</span><br></code></pre></td></tr></table></figure><h2 id="4-å¼€å‘ç¯å¢ƒ-vs-ç”Ÿäº§ç¯å¢ƒ"><a href="#4-å¼€å‘ç¯å¢ƒ-vs-ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="4. å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒ"></a>4. å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒ</h2><h3 id="4-1-å¼€å‘ç¯å¢ƒ-runserver"><a href="#4-1-å¼€å‘ç¯å¢ƒ-runserver" class="headerlink" title="4.1 å¼€å‘ç¯å¢ƒ (runserver)"></a>4.1 å¼€å‘ç¯å¢ƒ (runserver)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># django/core/management/commands/runserver.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inner_run</span>(<span class="hljs-params">self, *args, **options</span>):<br>    handler = <span class="hljs-variable language_">self</span>.get_handler(*args, **options)  <span class="hljs-comment"># è·å– WSGIHandler</span><br>    run(<span class="hljs-variable language_">self</span>.addr, <span class="hljs-built_in">int</span>(<span class="hljs-variable language_">self</span>.port), handler,       <span class="hljs-comment"># å¯åŠ¨ WSGIServer</span><br>        ipv6=<span class="hljs-variable language_">self</span>.use_ipv6, threading=threading, server_cls=<span class="hljs-variable language_">self</span>.server_cls) <span class="hljs-comment"># server_clså°±æ˜¯WSGIServer</span><br></code></pre></td></tr></table></figure><p><strong>æ¶æ„</strong>:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">æµè§ˆå™¨ â†’ WSGIServer â†’ WSGIHandler â†’ Djangoåº”ç”¨<br></code></pre></td></tr></table></figure><h3 id="4-2-ç”Ÿäº§ç¯å¢ƒ"><a href="#4-2-ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="4.2 ç”Ÿäº§ç¯å¢ƒ"></a>4.2 ç”Ÿäº§ç¯å¢ƒ</h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä½¿ç”¨ä¸“ä¸šçš„ WSGI æœåŠ¡å™¨ï¼š</p><h4 id="Gunicorn"><a href="#Gunicorn" class="headerlink" title="Gunicorn"></a>Gunicorn</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯åŠ¨å‘½ä»¤</span><br>gunicorn myproject.wsgi:application<br><br><span class="hljs-comment"># æ¶æ„</span><br>æµè§ˆå™¨ â†’ Nginx â†’ Gunicorn â†’ WSGIHandler â†’ Djangoåº”ç”¨<br></code></pre></td></tr></table></figure><h4 id="uWSGI"><a href="#uWSGI" class="headerlink" title="uWSGI"></a>uWSGI</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯åŠ¨å‘½ä»¤</span><br>uwsgi --http :8000 --module myproject.wsgi:application<br><br><span class="hljs-comment"># æ¶æ„</span><br>æµè§ˆå™¨ â†’ Nginx â†’ uWSGI â†’ WSGIHandler â†’ Djangoåº”ç”¨<br></code></pre></td></tr></table></figure><h4 id="mod-wsgi-Apache"><a href="#mod-wsgi-Apache" class="headerlink" title="mod_wsgi (Apache)"></a>mod_wsgi (Apache)</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># Apache é…ç½®</span><br><span class="hljs-attribute">LoadModule</span> wsgi_module modules/mod_wsgi.so<br><span class="hljs-attribute">WSGIScriptAlias</span> / /path/to/myproject/wsgi.py<br><br><span class="hljs-comment"># æ¶æ„</span><br>æµè§ˆå™¨ â†’ <span class="hljs-attribute">Apache</span> â†’ mod_wsgi â†’ WSGIHandler â†’ Djangoåº”ç”¨<br></code></pre></td></tr></table></figure><h3 id="4-3-Djangoçš„WSGIå…¥å£"><a href="#4-3-Djangoçš„WSGIå…¥å£" class="headerlink" title="4.3 Djangoçš„WSGIå…¥å£"></a>4.3 Djangoçš„WSGIå…¥å£</h3><p>æ— è®ºä½¿ç”¨å“ªç§æœåŠ¡å™¨ï¼ŒDjangoçš„å…¥å£éƒ½æ˜¯ç›¸åŒçš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># myproject/wsgi.py</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> django.core.wsgi <span class="hljs-keyword">import</span> get_wsgi_application<br><br>os.environ.setdefault(<span class="hljs-string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="hljs-string">&#x27;myproject.settings&#x27;</span>)<br>application = get_wsgi_application()  <span class="hljs-comment"># è¿”å› WSGIHandler å®ä¾‹</span><br></code></pre></td></tr></table></figure><h3 id="4-4-å…³é”®åŒºåˆ«"><a href="#4-4-å…³é”®åŒºåˆ«" class="headerlink" title="4.4 å…³é”®åŒºåˆ«"></a>4.4 å…³é”®åŒºåˆ«</h3><h4 id="å¼€å‘ç¯å¢ƒ"><a href="#å¼€å‘ç¯å¢ƒ" class="headerlink" title="å¼€å‘ç¯å¢ƒ"></a>å¼€å‘ç¯å¢ƒ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Django è‡ªå·±å¯åŠ¨æœåŠ¡å™¨</span><br><span class="hljs-keyword">from</span> django.core.servers.basehttp <span class="hljs-keyword">import</span> WSGIServer, run<br><br>handler = get_wsgi_application()  <span class="hljs-comment"># WSGIHandler</span><br>run(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">8000</span>, handler, server_cls=WSGIServer)  <span class="hljs-comment"># Django å¯åŠ¨ WSGIServer</span><br></code></pre></td></tr></table></figure><h4 id="ç”Ÿäº§ç¯å¢ƒ"><a href="#ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ"></a>ç”Ÿäº§ç¯å¢ƒ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¤–éƒ¨æœåŠ¡å™¨å¯åŠ¨ï¼ŒDjango åªæä¾› WSGI åº”ç”¨</span><br><span class="hljs-comment"># gunicorn/uwsgi/apache å¯åŠ¨</span><br>application = get_wsgi_application()  <span class="hljs-comment"># åªè¿”å› WSGIHandlerï¼Œä¸å¯åŠ¨æœåŠ¡å™¨</span><br></code></pre></td></tr></table></figure><h2 id="5-ç”Ÿäº§çº§WSGIæœåŠ¡å™¨"><a href="#5-ç”Ÿäº§çº§WSGIæœåŠ¡å™¨" class="headerlink" title="5. ç”Ÿäº§çº§WSGIæœåŠ¡å™¨"></a>5. ç”Ÿäº§çº§WSGIæœåŠ¡å™¨</h2><h3 id="5-1-Gunicorn-Socketå®ç°"><a href="#5-1-Gunicorn-Socketå®ç°" class="headerlink" title="5.1 Gunicorn Socketå®ç°"></a>5.1 Gunicorn Socketå®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Gunicorn Master è¿›ç¨‹ (ç®€åŒ–ç‰ˆ)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Master</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, bind_addr, workers=<span class="hljs-number">4</span></span>):<br>        <span class="hljs-comment"># åˆ›å»ºä¸» Socket</span><br>        <span class="hljs-variable language_">self</span>.socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>        <span class="hljs-variable language_">self</span>.socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="hljs-number">1</span>)<br>        <span class="hljs-variable language_">self</span>.socket.bind(bind_addr)  <span class="hljs-comment"># ç»‘å®šåœ°å€å’Œç«¯å£</span><br>        <span class="hljs-variable language_">self</span>.socket.listen(<span class="hljs-number">1024</span>)     <span class="hljs-comment"># å¼€å§‹ç›‘å¬</span><br>        <br>        <span class="hljs-comment"># å¯åŠ¨å¤šä¸ª Worker è¿›ç¨‹</span><br>        <span class="hljs-variable language_">self</span>.workers = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(workers):<br>            worker = Worker(<span class="hljs-variable language_">self</span>.socket)  <span class="hljs-comment"># ä¼ é€’ Socket ç»™ Worker</span><br>            worker.start()<br>            <span class="hljs-variable language_">self</span>.workers.append(worker)<br></code></pre></td></tr></table></figure><h3 id="5-2-Gunicornæ¶æ„"><a href="#5-2-Gunicornæ¶æ„" class="headerlink" title="5.2 Gunicornæ¶æ„"></a>5.2 Gunicornæ¶æ„</h3><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                    <span class="hljs-variable">Gunicorn</span> æ¶æ„                            â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚  <span class="hljs-variable">Master</span> <span class="hljs-variable">Process</span> <span class="hljs-punctuation">(</span>ä¸»è¿›ç¨‹<span class="hljs-punctuation">)</span>                                    â”‚<br>â”‚  â”œâ”€ ç›‘å¬ <span class="hljs-built_in">Socket</span> <span class="hljs-punctuation">(</span>ä¸» <span class="hljs-built_in">Socket</span><span class="hljs-punctuation">)</span>                                â”‚<br>â”‚  â”œâ”€ ç®¡ç† <span class="hljs-variable">Worker</span> è¿›ç¨‹                                       â”‚<br>â”‚  â””â”€ è´Ÿè½½å‡è¡¡                                               â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚  <span class="hljs-variable">Worker</span> <span class="hljs-built_in">Processes</span> <span class="hljs-punctuation">(</span>å·¥ä½œè¿›ç¨‹<span class="hljs-punctuation">)</span>                                â”‚<br>â”‚  â”œâ”€ <span class="hljs-variable">Worker</span> <span class="hljs-number">1</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Socket</span> <span class="hljs-operator">+</span> <span class="hljs-variable">WSGIHandler</span>                        â”‚<br>â”‚  â”œâ”€ <span class="hljs-variable">Worker</span> <span class="hljs-number">2</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Socket</span> <span class="hljs-operator">+</span> <span class="hljs-variable">WSGIHandler</span>                        â”‚<br>â”‚  â”œâ”€ <span class="hljs-variable">Worker</span> <span class="hljs-number">3</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Socket</span> <span class="hljs-operator">+</span> <span class="hljs-variable">WSGIHandler</span>                        â”‚<br>â”‚  â””â”€ <span class="hljs-variable">Worker</span> <span class="hljs-built_in">N</span><span class="hljs-operator">:</span> <span class="hljs-built_in">Socket</span> <span class="hljs-operator">+</span> <span class="hljs-variable">WSGIHandler</span>                        â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h3 id="5-3-ä¸Django-WSGIServerçš„å¯¹æ¯”"><a href="#5-3-ä¸Django-WSGIServerçš„å¯¹æ¯”" class="headerlink" title="5.3 ä¸Django WSGIServerçš„å¯¹æ¯”"></a>5.3 ä¸Django WSGIServerçš„å¯¹æ¯”</h3><h4 id="Django-WSGIServer-ç®€å•Socket"><a href="#Django-WSGIServer-ç®€å•Socket" class="headerlink" title="Django WSGIServer (ç®€å•Socket)"></a>Django WSGIServer (ç®€å•Socket)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å•è¿›ç¨‹ï¼Œå•çº¿ç¨‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WSGIServer</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">serve_forever</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            client, addr = <span class="hljs-variable language_">self</span>.socket.accept()  <span class="hljs-comment"># é˜»å¡ç­‰å¾…</span><br>            <span class="hljs-variable language_">self</span>.handle_request(client)          <span class="hljs-comment"># å¤„ç†è¯·æ±‚</span><br>            client.close()                       <span class="hljs-comment"># å…³é—­è¿æ¥</span><br></code></pre></td></tr></table></figure><h4 id="Gunicorn-é«˜çº§Socket"><a href="#Gunicorn-é«˜çº§Socket" class="headerlink" title="Gunicorn (é«˜çº§Socket)"></a>Gunicorn (é«˜çº§Socket)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¤šè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹å¯ä»¥å¤šçº¿ç¨‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GunicornMaster</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># 1. åˆ›å»ºä¸» Socket</span><br>        <span class="hljs-variable language_">self</span>.socket = socket.socket()<br>        <span class="hljs-variable language_">self</span>.socket.bind((<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-number">8000</span>))<br>        <span class="hljs-variable language_">self</span>.socket.listen(<span class="hljs-number">1024</span>)<br>        <br>        <span class="hljs-comment"># 2. å¯åŠ¨å¤šä¸ª Worker è¿›ç¨‹</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            worker = Process(target=<span class="hljs-variable language_">self</span>.worker_process)<br>            worker.start()<br></code></pre></td></tr></table></figure><h3 id="5-4-ç”Ÿäº§çº§æœåŠ¡å™¨çš„ä¼˜åŠ¿"><a href="#5-4-ç”Ÿäº§çº§æœåŠ¡å™¨çš„ä¼˜åŠ¿" class="headerlink" title="5.4 ç”Ÿäº§çº§æœåŠ¡å™¨çš„ä¼˜åŠ¿"></a>5.4 ç”Ÿäº§çº§æœåŠ¡å™¨çš„ä¼˜åŠ¿</h3><ol><li><strong>å¤šè¿›ç¨‹&#x2F;å¤šçº¿ç¨‹</strong>: å¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚</li><li><strong>é«˜æ€§èƒ½</strong>: ä¼˜åŒ–çš„ C å®ç°</li><li><strong>è´Ÿè½½å‡è¡¡</strong>: è‡ªåŠ¨åˆ†å‘è¯·æ±‚</li><li><strong>è¿›ç¨‹ç®¡ç†</strong>: è‡ªåŠ¨é‡å¯ã€å¥åº·æ£€æŸ¥</li><li><strong>å®‰å…¨ç‰¹æ€§</strong>: è¯·æ±‚é™åˆ¶ã€è¶…æ—¶æ§åˆ¶</li></ol><h2 id="6-å®é™…éƒ¨ç½²ç¤ºä¾‹"><a href="#6-å®é™…éƒ¨ç½²ç¤ºä¾‹" class="headerlink" title="6. å®é™…éƒ¨ç½²ç¤ºä¾‹"></a>6. å®é™…éƒ¨ç½²ç¤ºä¾‹</h2><h3 id="6-1-ä½¿ç”¨Gunicorn"><a href="#6-1-ä½¿ç”¨Gunicorn" class="headerlink" title="6.1 ä½¿ç”¨Gunicorn"></a>6.1 ä½¿ç”¨Gunicorn</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®‰è£…</span><br>pip install gunicorn<br><br><span class="hljs-comment"># å¯åŠ¨</span><br>gunicorn --workers 4 --<span class="hljs-built_in">bind</span> 127.0.0.1:8000 myproject.wsgi:application<br><br><span class="hljs-comment"># é…ç½®æ–‡ä»¶ gunicorn.conf.py</span><br><span class="hljs-built_in">bind</span> = <span class="hljs-string">&quot;127.0.0.1:8000&quot;</span><br>workers = 4<br>worker_class = <span class="hljs-string">&quot;sync&quot;</span><br>max_requests = 1000<br>max_requests_jitter = 100<br><span class="hljs-built_in">timeout</span> = 30<br></code></pre></td></tr></table></figure><h3 id="6-2-ä½¿ç”¨uWSGI"><a href="#6-2-ä½¿ç”¨uWSGI" class="headerlink" title="6.2 ä½¿ç”¨uWSGI"></a>6.2 ä½¿ç”¨uWSGI</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®‰è£…</span><br>pip install uwsgi<br><br><span class="hljs-comment"># å¯åŠ¨</span><br>uwsgi --http :8000 --module myproject.wsgi:application --processes 4 --threads 2<br><br><span class="hljs-comment"># é…ç½®æ–‡ä»¶ uwsgi.ini</span><br>[uwsgi]<br>http = :8000<br>module = myproject.wsgi:application<br>processes = 4<br>threads = 2<br>master = <span class="hljs-literal">true</span><br>vacuum = <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h3 id="6-3-Nginxé…ç½®"><a href="#6-3-Nginxé…ç½®" class="headerlink" title="6.3 Nginxé…ç½®"></a>6.3 Nginxé…ç½®</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span> example.com;<br>    <br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:8000;  <span class="hljs-comment"># è½¬å‘åˆ° Gunicorn</span><br>        <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>    &#125;<br>    <br>    <span class="hljs-section">location</span> /static/ &#123;<br>        <span class="hljs-attribute">alias</span> /path/to/static/;  <span class="hljs-comment"># ç›´æ¥æœåŠ¡é™æ€æ–‡ä»¶</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-4-ç”Ÿäº§ç¯å¢ƒå®Œæ•´æ¶æ„"><a href="#6-4-ç”Ÿäº§ç¯å¢ƒå®Œæ•´æ¶æ„" class="headerlink" title="6.4 ç”Ÿäº§ç¯å¢ƒå®Œæ•´æ¶æ„"></a>6.4 ç”Ÿäº§ç¯å¢ƒå®Œæ•´æ¶æ„</h3><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚   æµè§ˆå™¨     â”‚â”€â”€â”€â–¶â”‚    Nginx     â”‚â”€â”€â”€â–¶â”‚  Gunicorn   â”‚â”€â”€â”€â–¶â”‚ WSGIHandler â”‚<br>â”‚             â”‚    â”‚  (åå‘ä»£ç†)   â”‚    â”‚ (WSGIæœåŠ¡å™¨) â”‚    â”‚ (Django)    â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><h3 id="7-1-æ ¸å¿ƒæ¦‚å¿µ"><a href="#7-1-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="7.1 æ ¸å¿ƒæ¦‚å¿µ"></a>7.1 æ ¸å¿ƒæ¦‚å¿µ</h3><ol><li><strong>WSGIHandler</strong>: ä¸æ˜¯æœåŠ¡å™¨ï¼Œè€Œæ˜¯è¯·æ±‚å¤„ç†å™¨ï¼Œè´Ÿè´£å°†WSGIç¯å¢ƒè½¬æ¢ä¸ºDjangoè¯·æ±‚å¯¹è±¡ï¼Œå¹¶èµ°Djangoä¸­é—´ä»¶æµç¨‹</li><li><strong>WSGIServer</strong>: åŸºäºSocketçš„ç®€å•WebæœåŠ¡å™¨ï¼Œç”¨äºå¼€å‘ç¯å¢ƒ</li><li><strong>runserver</strong>: Djangoçš„ç®¡ç†å‘½ä»¤ï¼Œå¯åŠ¨WSGIServerå¹¶è°ƒç”¨WSGIHandler</li><li><strong>ç”Ÿäº§çº§æœåŠ¡å™¨</strong>: Gunicornã€uWSGIç­‰ï¼ŒåŸºäºSocketä½†æä¾›é«˜çº§ç‰¹æ€§</li></ol><h3 id="7-2-æ¶æ„å¯¹æ¯”"><a href="#7-2-æ¶æ„å¯¹æ¯”" class="headerlink" title="7.2 æ¶æ„å¯¹æ¯”"></a>7.2 æ¶æ„å¯¹æ¯”</h3><table><thead><tr><th>ç»„ä»¶</th><th>å¼€å‘ç¯å¢ƒ</th><th>ç”Ÿäº§ç¯å¢ƒ</th></tr></thead><tbody><tr><td>æœåŠ¡å™¨</td><td>WSGIServer</td><td>Gunicorn&#x2F;uWSGI&#x2F;Apache</td></tr><tr><td>è¯·æ±‚å¤„ç†å™¨</td><td>WSGIHandler</td><td>WSGIHandler</td></tr><tr><td>å¹¶å‘èƒ½åŠ›</td><td>å•è¿›ç¨‹å•çº¿ç¨‹</td><td>å¤šè¿›ç¨‹å¤šçº¿ç¨‹</td></tr><tr><td>æ€§èƒ½</td><td>ä½</td><td>é«˜</td></tr><tr><td>åŠŸèƒ½</td><td>ç®€å•</td><td>ä¸°å¯Œ</td></tr></tbody></table><h3 id="7-3-å…³é”®ç†è§£"><a href="#7-3-å…³é”®ç†è§£" class="headerlink" title="7.3 å…³é”®ç†è§£"></a>7.3 å…³é”®ç†è§£</h3><ul><li><strong>Djangoå†…éƒ¨å¤„ç†è¯·æ±‚çš„å§‹ç»ˆæ˜¯WSGIHandler</strong></li><li><strong>å¼€å‘ç¯å¢ƒä½¿ç”¨WSGIServerï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸“ä¸šWSGIæœåŠ¡å™¨</strong></li><li><strong>æ‰€æœ‰WSGIæœåŠ¡å™¨éƒ½åŸºäºSocketå®ç°ï¼Œä½†å¤æ‚åº¦ä¸åŒ</strong></li><li><strong>WSGIåè®®è®©Djangoèƒ½å¤Ÿè¿è¡Œåœ¨ä»»ä½•WSGIæœåŠ¡å™¨ä¸Š</strong></li></ul><p>è¿™ç§è®¾è®¡è®©Djangoï¼š</p><ol><li><strong>ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘</strong>: ä¸å…³å¿ƒç½‘ç»œå’Œå¹¶å‘å¤„ç†</li><li><strong>ä¸æœåŠ¡å™¨è§£è€¦</strong>: å¯ä»¥è¿è¡Œåœ¨ä»»ä½•WSGIæœåŠ¡å™¨ä¸Š</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>: ä½¿ç”¨ä¸“ä¸šçš„WSGIæœåŠ¡å™¨å¤„ç†å¹¶å‘</li><li><strong>éƒ¨ç½²çµæ´»</strong>: å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©ä¸åŒçš„æœåŠ¡å™¨</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django 1.11 æºç å­¦ä¹ è®¡åˆ’</title>
    <link href="/2025/06/26/Django%201.11%20%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/"/>
    <url>/2025/06/26/Django%201.11%20%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/</url>
    
    <content type="html"><![CDATA[<p>å»å¹´å°±æ‰“ç®—çœ‹ä¸‹Djangoçš„æºç ï¼Œçœ‹çš„3çš„ç‰ˆæœ¬ï¼Œçœ‹ä¸å¤ªæ‡‚ï¼Œäºæ˜¯åŒäº‹å»ºè®®æˆ‘çœ‹1ç‰ˆæœ¬çš„ï¼Œè¿™å‡ å¤©ä¸å¤ªå¿™ï¼Œä¹Ÿæ˜¯æ­£å¼æŠŠæºç çš„é˜…è¯»æä¸Šæ—¥ç¨‹äº†ã€‚</p><p>ç¯å¢ƒï¼š</p><ul><li><p>Django 1.11</p></li><li><p>Python 2.7</p></li><li><p>PyCharmã€Cursor</p></li></ul><p>ä¸‹é¢çš„å­¦ä¹ è®¡åˆ’æ˜¯æˆ‘è®© Cursor åŸºäºæœ¬åœ°çš„Djangoæºç ç”Ÿæˆçš„ä¸ºæœŸä¸€ä¸ªåŠæœˆçš„é˜…è¯»è®¡åˆ’ï¼Œå¹³å‡æ¯å¤©æŠ•å…¥1.5-2Hï¼Œåé¢æœ‰ç¬”è®°æˆ‘ä¹Ÿä¼šåŒæ­¥è¿‡æ¥ï¼Œæœ€ç»ˆæºç ä¸­å†™çš„æ³¨é‡Šæˆ‘ä¼šæ¨åˆ°githubä¸Šã€‚</p><h2 id="å­¦ä¹ ç›®æ ‡"><a href="#å­¦ä¹ ç›®æ ‡" class="headerlink" title="å­¦ä¹ ç›®æ ‡"></a>å­¦ä¹ ç›®æ ‡</h2><ul><li>æ·±å…¥ç†è§£Djangoæ¡†æ¶çš„è®¾è®¡æ€æƒ³å’Œæ¶æ„æ¨¡å¼</li><li>æŒæ¡Djangoæ ¸å¿ƒæ¨¡å—çš„å®ç°åŸç†</li><li>å­¦ä¹ ä¼˜ç§€çš„Pythonä»£ç è®¾è®¡å’Œæœ€ä½³å®è·µ</li><li>æå‡ä»£ç é˜…è¯»èƒ½åŠ›å’Œæ¶æ„è®¾è®¡æ€ç»´</li></ul><h2 id="å­¦ä¹ æ—¶é—´å®‰æ’"><a href="#å­¦ä¹ æ—¶é—´å®‰æ’" class="headerlink" title="å­¦ä¹ æ—¶é—´å®‰æ’"></a>å­¦ä¹ æ—¶é—´å®‰æ’</h2><ul><li><strong>æ¯æ—¥æŠ•å…¥æ—¶é—´</strong>: 1.5-2å°æ—¶</li><li><strong>æ€»å­¦ä¹ å‘¨æœŸ</strong>: 6å‘¨ï¼ˆ42å¤©ï¼‰</li><li><strong>å­¦ä¹ æ–¹å¼</strong>: æºç é˜…è¯» + ç¬”è®°è®°å½• + å®è·µéªŒè¯</li></ul><hr><h2 id="ç¬¬ä¸€å‘¨ï¼šDjangoåŸºç¡€æ¶æ„ä¸æ ¸å¿ƒæ¦‚å¿µ"><a href="#ç¬¬ä¸€å‘¨ï¼šDjangoåŸºç¡€æ¶æ„ä¸æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="ç¬¬ä¸€å‘¨ï¼šDjangoåŸºç¡€æ¶æ„ä¸æ ¸å¿ƒæ¦‚å¿µ"></a>ç¬¬ä¸€å‘¨ï¼šDjangoåŸºç¡€æ¶æ„ä¸æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="Day-1-2-Djangoé¡¹ç›®ç»“æ„ä¸åˆå§‹åŒ–"><a href="#Day-1-2-Djangoé¡¹ç›®ç»“æ„ä¸åˆå§‹åŒ–" class="headerlink" title="Day 1-2: Djangoé¡¹ç›®ç»“æ„ä¸åˆå§‹åŒ–"></a>Day 1-2: Djangoé¡¹ç›®ç»“æ„ä¸åˆå§‹åŒ–</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/__init__.py</code> - Djangoæ¡†æ¶å…¥å£</li><li><code>django/__main__.py</code> - å‘½ä»¤è¡Œå…¥å£</li><li><code>django/apps/</code> - åº”ç”¨æ³¨å†Œæœºåˆ¶</li><li><code>django/conf/</code> - é…ç½®ç®¡ç†</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>Djangoçš„æ¨¡å—åŒ–è®¾è®¡</li><li>åº”ç”¨æ³¨å†Œå’Œé…ç½®åŠ è½½æœºåˆ¶</li><li>æ¡†æ¶åˆå§‹åŒ–æµç¨‹</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>åˆ›å»ºä¸€ä¸ªç®€å•çš„Djangoé¡¹ç›®ï¼Œè·Ÿè¸ªå¯åŠ¨è¿‡ç¨‹</li><li>åˆ†æ<code>manage.py</code>å’ŒDjangoå¯åŠ¨çš„å®Œæ•´æµç¨‹</li></ul><h3 id="Day-3-4-æ ¸å¿ƒå¼‚å¸¸å¤„ç†ä¸ä¿¡å·ç³»ç»Ÿ"><a href="#Day-3-4-æ ¸å¿ƒå¼‚å¸¸å¤„ç†ä¸ä¿¡å·ç³»ç»Ÿ" class="headerlink" title="Day 3-4: æ ¸å¿ƒå¼‚å¸¸å¤„ç†ä¸ä¿¡å·ç³»ç»Ÿ"></a>Day 3-4: æ ¸å¿ƒå¼‚å¸¸å¤„ç†ä¸ä¿¡å·ç³»ç»Ÿ</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/core/exceptions.py</code> - å¼‚å¸¸ç±»å®šä¹‰</li><li><code>django/core/signals.py</code> - ä¿¡å·ç³»ç»Ÿ</li><li><code>django/dispatch/</code> - ä¿¡å·åˆ†å‘æœºåˆ¶</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>Djangoå¼‚å¸¸ä½“ç³»è®¾è®¡</li><li>ä¿¡å·ç³»ç»Ÿçš„å®ç°åŸç†</li><li>è§‚å¯Ÿè€…æ¨¡å¼åœ¨Djangoä¸­çš„åº”ç”¨</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>ç¼–å†™è‡ªå®šä¹‰ä¿¡å·å’Œæ¥æ”¶å™¨</li><li>åˆ†æDjangoå†…ç½®ä¿¡å·çš„ä½¿ç”¨åœºæ™¯</li></ul><h3 id="Day-5-7-é…ç½®ç®¡ç†ä¸éªŒè¯ç³»ç»Ÿ"><a href="#Day-5-7-é…ç½®ç®¡ç†ä¸éªŒè¯ç³»ç»Ÿ" class="headerlink" title="Day 5-7: é…ç½®ç®¡ç†ä¸éªŒè¯ç³»ç»Ÿ"></a>Day 5-7: é…ç½®ç®¡ç†ä¸éªŒè¯ç³»ç»Ÿ</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/core/validators.py</code> - æ•°æ®éªŒè¯å™¨</li><li><code>django/core/signing.py</code> - æ•°æ®ç­¾å</li><li><code>django/core/paginator.py</code> - åˆ†é¡µå™¨</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>éªŒè¯å™¨çš„è®¾è®¡æ¨¡å¼å’Œæ‰©å±•æ€§</li><li>æ•°æ®ç­¾åçš„å®‰å…¨æœºåˆ¶</li><li>åˆ†é¡µç®—æ³•çš„å®ç°</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>ç¼–å†™è‡ªå®šä¹‰éªŒè¯å™¨</li><li>å®ç°æ•°æ®ç­¾åå’ŒéªŒè¯</li><li>åˆ†æåˆ†é¡µå™¨çš„æ€§èƒ½ä¼˜åŒ–</li></ul><hr><h2 id="ç¬¬äºŒå‘¨ï¼šHTTPå¤„ç†ä¸ä¸­é—´ä»¶ç³»ç»Ÿ"><a href="#ç¬¬äºŒå‘¨ï¼šHTTPå¤„ç†ä¸ä¸­é—´ä»¶ç³»ç»Ÿ" class="headerlink" title="ç¬¬äºŒå‘¨ï¼šHTTPå¤„ç†ä¸ä¸­é—´ä»¶ç³»ç»Ÿ"></a>ç¬¬äºŒå‘¨ï¼šHTTPå¤„ç†ä¸ä¸­é—´ä»¶ç³»ç»Ÿ</h2><h3 id="Day-8-10-HTTPè¯·æ±‚å¤„ç†æµç¨‹"><a href="#Day-8-10-HTTPè¯·æ±‚å¤„ç†æµç¨‹" class="headerlink" title="Day 8-10: HTTPè¯·æ±‚å¤„ç†æµç¨‹"></a>Day 8-10: HTTPè¯·æ±‚å¤„ç†æµç¨‹</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/http/</code> - HTTPè¯·æ±‚&#x2F;å“åº”å¤„ç†</li><li><code>django/core/handlers/</code> - è¯·æ±‚å¤„ç†å™¨</li><li><code>django/core/wsgi.py</code> - WSGIæ¥å£</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>HTTPè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ</li><li>WSGIåè®®åœ¨Djangoä¸­çš„å®ç°</li><li>è¯·æ±‚&#x2F;å“åº”å¯¹è±¡çš„å°è£…</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>è·Ÿè¸ªä¸€ä¸ªHTTPè¯·æ±‚çš„å®Œæ•´å¤„ç†æµç¨‹</li><li>åˆ†æè¯·æ±‚&#x2F;å“åº”å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•</li></ul><h3 id="Day-11-13-ä¸­é—´ä»¶ç³»ç»Ÿ"><a href="#Day-11-13-ä¸­é—´ä»¶ç³»ç»Ÿ" class="headerlink" title="Day 11-13: ä¸­é—´ä»¶ç³»ç»Ÿ"></a>Day 11-13: ä¸­é—´ä»¶ç³»ç»Ÿ</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/middleware/</code> - å†…ç½®ä¸­é—´ä»¶</li><li>ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºå’Œæœºåˆ¶</li><li>è‡ªå®šä¹‰ä¸­é—´ä»¶çš„å¼€å‘</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>ä¸­é—´ä»¶çš„è®¾è®¡æ¨¡å¼</li><li>è¯·æ±‚&#x2F;å“åº”å¤„ç†ç®¡é“</li><li>ä¸­é—´ä»¶çš„æ€§èƒ½å½±å“</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>ç¼–å†™è‡ªå®šä¹‰ä¸­é—´ä»¶</li><li>åˆ†æDjangoå†…ç½®ä¸­é—´ä»¶çš„ä½œç”¨</li><li>æµ‹è¯•ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåº</li></ul><h3 id="Day-14-URLè·¯ç”±ç³»ç»Ÿ"><a href="#Day-14-URLè·¯ç”±ç³»ç»Ÿ" class="headerlink" title="Day 14: URLè·¯ç”±ç³»ç»Ÿ"></a>Day 14: URLè·¯ç”±ç³»ç»Ÿ</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/urls/</code> - URLé…ç½®å’Œè§£æ</li><li><code>django/core/urlresolvers.py</code> - URLè§£æå™¨</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>URLæ¨¡å¼åŒ¹é…ç®—æ³•</li><li>åå‘URLè§£ææœºåˆ¶</li><li>è·¯ç”±ç³»ç»Ÿçš„æ‰©å±•æ€§</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>åˆ†æå¤æ‚çš„URLé…ç½®</li><li>å®ç°è‡ªå®šä¹‰URLå¤„ç†å™¨</li></ul><hr><h2 id="ç¬¬ä¸‰å‘¨ï¼šæ•°æ®åº“å±‚ä¸ORMç³»ç»Ÿ"><a href="#ç¬¬ä¸‰å‘¨ï¼šæ•°æ®åº“å±‚ä¸ORMç³»ç»Ÿ" class="headerlink" title="ç¬¬ä¸‰å‘¨ï¼šæ•°æ®åº“å±‚ä¸ORMç³»ç»Ÿ"></a>ç¬¬ä¸‰å‘¨ï¼šæ•°æ®åº“å±‚ä¸ORMç³»ç»Ÿ</h2><h3 id="Day-15-17-æ•°æ®åº“è¿æ¥ä¸é…ç½®"><a href="#Day-15-17-æ•°æ®åº“è¿æ¥ä¸é…ç½®" class="headerlink" title="Day 15-17: æ•°æ®åº“è¿æ¥ä¸é…ç½®"></a>Day 15-17: æ•°æ®åº“è¿æ¥ä¸é…ç½®</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/db/</code> - æ•°æ®åº“æŠ½è±¡å±‚</li><li>æ•°æ®åº“è¿æ¥æ± ç®¡ç†</li><li>å¤šæ•°æ®åº“æ”¯æŒ</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>æ•°æ®åº“æŠ½è±¡çš„è®¾è®¡æ€æƒ³</li><li>è¿æ¥æ± çš„å®ç°æœºåˆ¶</li><li>äº‹åŠ¡ç®¡ç†</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>é…ç½®å¤šæ•°æ®åº“ç¯å¢ƒ</li><li>åˆ†ææ•°æ®åº“è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸ</li></ul><h3 id="Day-18-20-ORMæŸ¥è¯¢ç³»ç»Ÿ"><a href="#Day-18-20-ORMæŸ¥è¯¢ç³»ç»Ÿ" class="headerlink" title="Day 18-20: ORMæŸ¥è¯¢ç³»ç»Ÿ"></a>Day 18-20: ORMæŸ¥è¯¢ç³»ç»Ÿ</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/db/models/</code> - æ¨¡å‹å®šä¹‰</li><li><code>django/db/models/query.py</code> - æŸ¥è¯¢é›†å®ç°</li><li><code>django/db/models/sql/</code> - SQLç”Ÿæˆ</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>QuerySetçš„æƒ°æ€§åŠ è½½æœºåˆ¶</li><li>SQLæŸ¥è¯¢çš„æ„å»ºè¿‡ç¨‹</li><li>æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>åˆ†æå¤æ‚æŸ¥è¯¢çš„SQLç”Ÿæˆ</li><li>ä½¿ç”¨Django Debug Toolbaråˆ†ææŸ¥è¯¢æ€§èƒ½</li></ul><h3 id="Day-21-æ•°æ®åº“è¿ç§»ç³»ç»Ÿ"><a href="#Day-21-æ•°æ®åº“è¿ç§»ç³»ç»Ÿ" class="headerlink" title="Day 21: æ•°æ®åº“è¿ç§»ç³»ç»Ÿ"></a>Day 21: æ•°æ®åº“è¿ç§»ç³»ç»Ÿ</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/db/migrations/</code> - è¿ç§»æ¡†æ¶</li><li>è¿ç§»æ–‡ä»¶çš„ç”Ÿæˆå’Œæ‰§è¡Œ</li><li>æ•°æ®è¿ç§»ç­–ç•¥</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>è¿ç§»ç³»ç»Ÿçš„è®¾è®¡åŸç†</li><li>ç‰ˆæœ¬æ§åˆ¶å’Œå›æ»šæœºåˆ¶</li><li>æ•°æ®å®Œæ•´æ€§ä¿è¯</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>åˆ›å»ºå¤æ‚çš„æ•°æ®åº“è¿ç§»</li><li>åˆ†æè¿ç§»æ–‡ä»¶çš„ç”Ÿæˆé€»è¾‘</li></ul><hr><h2 id="ç¬¬å››å‘¨ï¼šæ¨¡æ¿ç³»ç»Ÿä¸è¡¨å•å¤„ç†"><a href="#ç¬¬å››å‘¨ï¼šæ¨¡æ¿ç³»ç»Ÿä¸è¡¨å•å¤„ç†" class="headerlink" title="ç¬¬å››å‘¨ï¼šæ¨¡æ¿ç³»ç»Ÿä¸è¡¨å•å¤„ç†"></a>ç¬¬å››å‘¨ï¼šæ¨¡æ¿ç³»ç»Ÿä¸è¡¨å•å¤„ç†</h2><h3 id="Day-22-24-æ¨¡æ¿å¼•æ“"><a href="#Day-22-24-æ¨¡æ¿å¼•æ“" class="headerlink" title="Day 22-24: æ¨¡æ¿å¼•æ“"></a>Day 22-24: æ¨¡æ¿å¼•æ“</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/template/</code> - æ¨¡æ¿å¼•æ“æ ¸å¿ƒ</li><li><code>django/templatetags/</code> - æ¨¡æ¿æ ‡ç­¾</li><li>æ¨¡æ¿åŠ è½½å’Œæ¸²æŸ“æœºåˆ¶</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>æ¨¡æ¿ç¼–è¯‘å’Œæ¸²æŸ“æµç¨‹</li><li>æ¨¡æ¿æ ‡ç­¾å’Œè¿‡æ»¤å™¨çš„å®ç°</li><li>æ¨¡æ¿ç¼“å­˜æœºåˆ¶</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>ç¼–å†™è‡ªå®šä¹‰æ¨¡æ¿æ ‡ç­¾å’Œè¿‡æ»¤å™¨</li><li>åˆ†ææ¨¡æ¿æ¸²æŸ“çš„æ€§èƒ½ä¼˜åŒ–</li></ul><h3 id="Day-25-27-è¡¨å•ç³»ç»Ÿ"><a href="#Day-25-27-è¡¨å•ç³»ç»Ÿ" class="headerlink" title="Day 25-27: è¡¨å•ç³»ç»Ÿ"></a>Day 25-27: è¡¨å•ç³»ç»Ÿ</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/forms/</code> - è¡¨å•å¤„ç†æ¡†æ¶</li><li>è¡¨å•éªŒè¯å’Œæ¸…ç†</li><li>è¡¨å•æ¸²æŸ“å’ŒCSRFä¿æŠ¤</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>è¡¨å•çš„ç”Ÿå‘½å‘¨æœŸ</li><li>éªŒè¯å™¨çš„é“¾å¼è°ƒç”¨</li><li>CSRFä¿æŠ¤æœºåˆ¶</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>åˆ›å»ºå¤æ‚çš„è¡¨å•éªŒè¯é€»è¾‘</li><li>åˆ†æCSRFä»¤ç‰Œçš„ç”Ÿæˆå’ŒéªŒè¯</li></ul><h3 id="Day-28-è§†å›¾ç³»ç»Ÿ"><a href="#Day-28-è§†å›¾ç³»ç»Ÿ" class="headerlink" title="Day 28: è§†å›¾ç³»ç»Ÿ"></a>Day 28: è§†å›¾ç³»ç»Ÿ</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/views/</code> - è§†å›¾åŸºç±»</li><li><code>django/shortcuts.py</code> - å¸¸ç”¨å¿«æ·å‡½æ•°</li><li>ç±»è§†å›¾å’Œå‡½æ•°è§†å›¾</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>è§†å›¾çš„è®¾è®¡æ¨¡å¼</li><li>è¯·æ±‚å¤„ç†çš„é€šç”¨æµç¨‹</li><li>è§†å›¾çš„å¤ç”¨å’Œæ‰©å±•</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>å®ç°è‡ªå®šä¹‰çš„ç±»è§†å›¾</li><li>åˆ†æDjangoå†…ç½®è§†å›¾çš„å®ç°</li></ul><hr><h2 id="ç¬¬äº”å‘¨ï¼šè®¤è¯æˆæƒä¸Adminç³»ç»Ÿ"><a href="#ç¬¬äº”å‘¨ï¼šè®¤è¯æˆæƒä¸Adminç³»ç»Ÿ" class="headerlink" title="ç¬¬äº”å‘¨ï¼šè®¤è¯æˆæƒä¸Adminç³»ç»Ÿ"></a>ç¬¬äº”å‘¨ï¼šè®¤è¯æˆæƒä¸Adminç³»ç»Ÿ</h2><h3 id="Day-29-31-è®¤è¯ç³»ç»Ÿ"><a href="#Day-29-31-è®¤è¯ç³»ç»Ÿ" class="headerlink" title="Day 29-31: è®¤è¯ç³»ç»Ÿ"></a>Day 29-31: è®¤è¯ç³»ç»Ÿ</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/contrib/auth/</code> - ç”¨æˆ·è®¤è¯</li><li>ç”¨æˆ·æ¨¡å‹å’Œæƒé™ç³»ç»Ÿ</li><li>ä¼šè¯ç®¡ç†</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>è®¤è¯æµç¨‹çš„è®¾è®¡</li><li>æƒé™ç³»ç»Ÿçš„å®ç°</li><li>å¯†ç åŠ å¯†å’ŒéªŒè¯</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>å®ç°è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹</li><li>åˆ›å»ºå¤æ‚çš„æƒé™æ§åˆ¶é€»è¾‘</li></ul><h3 id="Day-32-34-Adminç®¡ç†ç•Œé¢"><a href="#Day-32-34-Adminç®¡ç†ç•Œé¢" class="headerlink" title="Day 32-34: Adminç®¡ç†ç•Œé¢"></a>Day 32-34: Adminç®¡ç†ç•Œé¢</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/contrib/admin/</code> - Adminç³»ç»Ÿ</li><li>Adminé…ç½®å’Œè‡ªå®šä¹‰</li><li>Adminæƒé™æ§åˆ¶</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>Adminç³»ç»Ÿçš„æ¶æ„è®¾è®¡</li><li>è‡ªåŠ¨ç”Ÿæˆç®¡ç†ç•Œé¢çš„æœºåˆ¶</li><li>Adminçš„æ‰©å±•æ€§</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>è‡ªå®šä¹‰Adminç•Œé¢</li><li>å®ç°Adminçš„æ‰¹é‡æ“ä½œ</li></ul><h3 id="Day-35-å…¶ä»–Contribåº”ç”¨"><a href="#Day-35-å…¶ä»–Contribåº”ç”¨" class="headerlink" title="Day 35: å…¶ä»–Contribåº”ç”¨"></a>Day 35: å…¶ä»–Contribåº”ç”¨</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/contrib/sessions/</code> - ä¼šè¯ç®¡ç†</li><li><code>django/contrib/messages/</code> - æ¶ˆæ¯æ¡†æ¶</li><li><code>django/contrib/staticfiles/</code> - é™æ€æ–‡ä»¶å¤„ç†</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>ä¼šè¯å­˜å‚¨æœºåˆ¶</li><li>æ¶ˆæ¯ç³»ç»Ÿçš„è®¾è®¡</li><li>é™æ€æ–‡ä»¶çš„æœåŠ¡ç­–ç•¥</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>é…ç½®ä¼šè¯å­˜å‚¨åç«¯</li><li>å®ç°è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹</li></ul><hr><h2 id="ç¬¬å…­å‘¨ï¼šé«˜çº§ç‰¹æ€§ä¸æ€§èƒ½ä¼˜åŒ–"><a href="#ç¬¬å…­å‘¨ï¼šé«˜çº§ç‰¹æ€§ä¸æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="ç¬¬å…­å‘¨ï¼šé«˜çº§ç‰¹æ€§ä¸æ€§èƒ½ä¼˜åŒ–"></a>ç¬¬å…­å‘¨ï¼šé«˜çº§ç‰¹æ€§ä¸æ€§èƒ½ä¼˜åŒ–</h2><h3 id="Day-36-38-ç¼“å­˜ç³»ç»Ÿ"><a href="#Day-36-38-ç¼“å­˜ç³»ç»Ÿ" class="headerlink" title="Day 36-38: ç¼“å­˜ç³»ç»Ÿ"></a>Day 36-38: ç¼“å­˜ç³»ç»Ÿ</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/core/cache/</code> - ç¼“å­˜æ¡†æ¶</li><li>ç¼“å­˜åç«¯å®ç°</li><li>ç¼“å­˜ç­–ç•¥å’Œæ€§èƒ½ä¼˜åŒ–</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>ç¼“å­˜ç³»ç»Ÿçš„æŠ½è±¡è®¾è®¡</li><li>ä¸åŒç¼“å­˜åç«¯çš„ç‰¹æ€§</li><li>ç¼“å­˜å¤±æ•ˆç­–ç•¥</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>é…ç½®å¤šç§ç¼“å­˜åç«¯</li><li>å®ç°ç¼“å­˜è£…é¥°å™¨</li></ul><h3 id="Day-39-40-å›½é™…åŒ–ä¸æœ¬åœ°åŒ–"><a href="#Day-39-40-å›½é™…åŒ–ä¸æœ¬åœ°åŒ–" class="headerlink" title="Day 39-40: å›½é™…åŒ–ä¸æœ¬åœ°åŒ–"></a>Day 39-40: å›½é™…åŒ–ä¸æœ¬åœ°åŒ–</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/utils/translation/</code> - ç¿»è¯‘ç³»ç»Ÿ</li><li>æ—¶åŒºå’Œæœ¬åœ°åŒ–å¤„ç†</li><li>å¤šè¯­è¨€æ”¯æŒ</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>å›½é™…åŒ–æ¡†æ¶çš„è®¾è®¡</li><li>ç¿»è¯‘æ–‡ä»¶çš„å¤„ç†æœºåˆ¶</li><li>æ—¶åŒºè½¬æ¢çš„å®ç°</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>åˆ›å»ºå¤šè¯­è¨€åº”ç”¨</li><li>å®ç°æ—¶åŒºæ„ŸçŸ¥çš„æ—¥æœŸå¤„ç†</li></ul><h3 id="Day-41-42-æµ‹è¯•æ¡†æ¶ä¸éƒ¨ç½²"><a href="#Day-41-42-æµ‹è¯•æ¡†æ¶ä¸éƒ¨ç½²" class="headerlink" title="Day 41-42: æµ‹è¯•æ¡†æ¶ä¸éƒ¨ç½²"></a>Day 41-42: æµ‹è¯•æ¡†æ¶ä¸éƒ¨ç½²</h3><p><strong>å­¦ä¹ å†…å®¹</strong>:</p><ul><li><code>django/test/</code> - æµ‹è¯•æ¡†æ¶</li><li>æµ‹è¯•å·¥å…·å’Œæœ€ä½³å®è·µ</li><li>éƒ¨ç½²å’Œæ€§èƒ½ç›‘æ§</li></ul><p><strong>é‡ç‚¹ç†è§£</strong>:</p><ul><li>æµ‹è¯•æ¡†æ¶çš„è®¾è®¡æ€æƒ³</li><li>æµ‹è¯•æ•°æ®åº“çš„ç®¡ç†</li><li>æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–</li></ul><p><strong>å®è·µä»»åŠ¡</strong>:</p><ul><li>ç¼–å†™å®Œæ•´çš„æµ‹è¯•å¥—ä»¶</li><li>åˆ†æåº”ç”¨çš„æ€§èƒ½ç“¶é¢ˆ</li></ul><hr><h2 id="å­¦ä¹ å»ºè®®"><a href="#å­¦ä¹ å»ºè®®" class="headerlink" title="å­¦ä¹ å»ºè®®"></a>å­¦ä¹ å»ºè®®</h2><h3 id="æ¯æ—¥å­¦ä¹ æµç¨‹"><a href="#æ¯æ—¥å­¦ä¹ æµç¨‹" class="headerlink" title="æ¯æ—¥å­¦ä¹ æµç¨‹"></a>æ¯æ—¥å­¦ä¹ æµç¨‹</h3><ol><li><strong>é¢„ä¹ </strong> (15åˆ†é’Ÿ): äº†è§£å½“å¤©è¦å­¦ä¹ çš„æ¨¡å—åŠŸèƒ½</li><li><strong>æºç é˜…è¯»</strong> (60-75åˆ†é’Ÿ): æ·±å…¥é˜…è¯»æ ¸å¿ƒä»£ç </li><li><strong>ç¬”è®°æ•´ç†</strong> (15-30åˆ†é’Ÿ): è®°å½•å…³é”®è®¾è®¡æ€æƒ³å’Œå®ç°ç»†èŠ‚</li><li><strong>å®è·µéªŒè¯</strong> (15-30åˆ†é’Ÿ): ç¼–å†™ç¤ºä¾‹ä»£ç éªŒè¯ç†è§£</li></ol><h3 id="å­¦ä¹ å·¥å…·"><a href="#å­¦ä¹ å·¥å…·" class="headerlink" title="å­¦ä¹ å·¥å…·"></a>å­¦ä¹ å·¥å…·</h3><ul><li><strong>IDE</strong>: PyCharmæˆ–VS Codeï¼Œæ”¯æŒä»£ç è·³è½¬å’Œè°ƒè¯•</li><li><strong>æ–‡æ¡£</strong>: Djangoå®˜æ–¹æ–‡æ¡£ä½œä¸ºå‚è€ƒ</li><li><strong>è°ƒè¯•å·¥å…·</strong>: Django Debug Toolbar</li><li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>: Gitï¼Œè®°å½•å­¦ä¹ è¿›åº¦</li></ul><h3 id="é‡ç‚¹å…³æ³¨çš„ä»£ç æ¨¡å¼"><a href="#é‡ç‚¹å…³æ³¨çš„ä»£ç æ¨¡å¼" class="headerlink" title="é‡ç‚¹å…³æ³¨çš„ä»£ç æ¨¡å¼"></a>é‡ç‚¹å…³æ³¨çš„ä»£ç æ¨¡å¼</h3><ol><li><strong>è®¾è®¡æ¨¡å¼</strong>: è§‚å¯Ÿè€…æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ç­‰</li><li><strong>ä»£ç ç»„ç»‡</strong>: æ¨¡å—åŒ–è®¾è®¡ã€æ¥å£æŠ½è±¡ã€ä¾èµ–æ³¨å…¥</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>: ç¼“å­˜ç­–ç•¥ã€æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ã€å†…å­˜ç®¡ç†</li><li><strong>å®‰å…¨æœºåˆ¶</strong>: CSRFä¿æŠ¤ã€SQLæ³¨å…¥é˜²æŠ¤ã€XSSé˜²æŠ¤</li></ol><h3 id="å­¦ä¹ è¾“å‡º"><a href="#å­¦ä¹ è¾“å‡º" class="headerlink" title="å­¦ä¹ è¾“å‡º"></a>å­¦ä¹ è¾“å‡º</h3><ul><li><strong>ä»£ç ç¬”è®°</strong>: è®°å½•å…³é”®å®ç°ç»†èŠ‚</li><li><strong>æ¶æ„å›¾</strong>: ç»˜åˆ¶æ¨¡å—å…³ç³»å›¾</li><li><strong>å®è·µé¡¹ç›®</strong>: åŸºäºå­¦ä¹ å†…å®¹å¼€å‘å°é¡¹ç›®</li><li><strong>æŠ€æœ¯åšå®¢</strong>: åˆ†äº«å­¦ä¹ å¿ƒå¾—å’Œå‘ç°</li></ul><hr><h2 id="é¢„æœŸæ”¶è·"><a href="#é¢„æœŸæ”¶è·" class="headerlink" title="é¢„æœŸæ”¶è·"></a>é¢„æœŸæ”¶è·</h2><p>é€šè¿‡è¿™ä¸ªå­¦ä¹ è®¡åˆ’ï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š</p><ul><li>æ·±å…¥ç†è§£Djangoçš„æ¶æ„è®¾è®¡æ€æƒ³</li><li>æŒæ¡Webæ¡†æ¶å¼€å‘çš„æ ¸å¿ƒæŠ€æœ¯</li><li>æå‡ä»£ç é˜…è¯»å’Œæ¶æ„è®¾è®¡èƒ½åŠ›</li><li>ä¸ºåç»­çš„æŠ€æœ¯é€‰å‹å’Œç³»ç»Ÿè®¾è®¡æä¾›å‚è€ƒ</li><li>åœ¨é¢è¯•ä¸­å±•ç¤ºå¯¹æ¡†æ¶åŸç†çš„æ·±åº¦ç†è§£</li></ul><p>è®°ä½ï¼Œæºç å­¦ä¹ æ˜¯ä¸€ä¸ªæ¸è¿›çš„è¿‡ç¨‹ï¼Œä¸è¦æ€¥äºæ±‚æˆã€‚é‡ç‚¹åœ¨äºç†è§£è®¾è®¡æ€æƒ³ï¼Œè€Œä¸æ˜¯è®°ä½æ¯ä¸€è¡Œä»£ç ã€‚ç¥æ‚¨å­¦ä¹ æ„‰å¿«ï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Huey æ¶æ„</title>
    <link href="/2025/05/20/Huey-%E6%9E%B6%E6%9E%84/"/>
    <url>/2025/05/20/Huey-%E6%9E%B6%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<p>Huey æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ä»»åŠ¡é˜Ÿåˆ—ï¼ˆTask Queueï¼‰ï¼Œé€‚åˆä¸­å°å‹é¡¹ç›®ä½¿ç”¨ã€‚å®ƒçš„æ¶æ„è™½ç„¶ç®€å•ï¼Œä½†éå¸¸ä¼˜é›…ï¼Œæ ¸å¿ƒç»„æˆåŒ…æ‹¬ï¼š</p><ul><li><strong>ä»»åŠ¡å®šä¹‰ï¼ˆ@task &#x2F; @periodic_taskï¼‰</strong></li><li><strong>ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰</strong></li><li><strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong></li><li><strong>å·¥ä½œè¿›ç¨‹ï¼ˆWorkerï¼‰</strong></li><li><strong>å­˜å‚¨ï¼ˆBrokerï¼šRedis &#x2F; Sqliteï¼‰</strong></li></ul><hr><h2 id="âœ…-Huey-çš„æ•´ä½“æ¶æ„å›¾"><a href="#âœ…-Huey-çš„æ•´ä½“æ¶æ„å›¾" class="headerlink" title="âœ… Huey çš„æ•´ä½“æ¶æ„å›¾"></a>âœ… Huey çš„æ•´ä½“æ¶æ„å›¾</h2><p>æˆ‘å…ˆç”»ä¸ªå›¾ä½ ä¸€ç›®äº†ç„¶åœ°çœ‹æ¸…æ¶æ„å…³ç³»ï¼Œå†è¯¦ç»†è®²è§£æ¯ä¸ªæ¨¡å—ï¼š</p><h3 id="ğŸŒ-Huey-æ¶æ„å›¾"><a href="#ğŸŒ-Huey-æ¶æ„å›¾" class="headerlink" title="ğŸŒ Huey æ¶æ„å›¾"></a>ğŸŒ Huey æ¶æ„å›¾</h3><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs latex">                        +------------------+<br>                        |  ç”¨æˆ·ä»£ç æ³¨å†Œä»»åŠ¡  |<br>                        |  @huey.task()     |<br>                        +--------+---------+<br>                                 |<br>                +-----------------------------+<br>                |        Huey å®ä¾‹            |<br>                |  å°è£…è°ƒåº¦å™¨/ä»»åŠ¡æ³¨å†Œæ¥å£     |<br>                +-----------------------------+<br>                                 |<br>       +-------------------------+-------------------------+<br>       |                                                   |<br>+---------------+                                +------------------+<br>|   Scheduler   |  &lt;- å‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦              |     Consumer      |<br>|   (å®šæ—¶æ¨ä»»åŠ¡) |                                |  (æ¶ˆè´¹ä»»åŠ¡ä¸»æ§å™¨) |<br>+-------+-------+                                +--------+---------+<br>        |                                                  |<br>        v                                                  v<br>+-------------------+                        +--------------------------+<br>|     Redis/Sqlite  | &lt;-- ä»»åŠ¡å…¥é˜Ÿ/å‡ºé˜Ÿ --&gt;  |         Worker(s)        |<br>|     ä»»åŠ¡ä¸­é—´ä»¶     |                        |  (æ‰§è¡Œä»»åŠ¡çš„å¤šè¿›ç¨‹/çº¿ç¨‹) |<br>+-------------------+                        +--------------------------+<br></code></pre></td></tr></table></figure><hr><h2 id="ğŸ§©-å„éƒ¨åˆ†ä½œç”¨è¯¦è§£"><a href="#ğŸ§©-å„éƒ¨åˆ†ä½œç”¨è¯¦è§£" class="headerlink" title="ğŸ§© å„éƒ¨åˆ†ä½œç”¨è¯¦è§£"></a>ğŸ§© å„éƒ¨åˆ†ä½œç”¨è¯¦è§£</h2><h3 id="1-ä»»åŠ¡æ³¨å†Œ-Huey-å®ä¾‹"><a href="#1-ä»»åŠ¡æ³¨å†Œ-Huey-å®ä¾‹" class="headerlink" title="1. ä»»åŠ¡æ³¨å†Œ &amp; Huey å®ä¾‹"></a>1. <strong>ä»»åŠ¡æ³¨å†Œ &amp; Huey å®ä¾‹</strong></h3><p>ä½ é€šè¿‡è£…é¥°å™¨ <code>@huey.task()</code> æˆ– <code>@huey.periodic_task()</code> æ³¨å†Œä»»åŠ¡ã€‚è¿™äº›ä»»åŠ¡è¢«æ³¨å†Œåˆ° <code>Huey</code> å®ä¾‹ä¸­ï¼Œä¾›è°ƒåº¦å™¨æˆ– consumer æ‰§è¡Œã€‚</p><hr><h3 id="2-Schedulerï¼šè°ƒåº¦å™¨"><a href="#2-Schedulerï¼šè°ƒåº¦å™¨" class="headerlink" title="2. Schedulerï¼šè°ƒåº¦å™¨"></a>2. <strong>Schedulerï¼šè°ƒåº¦å™¨</strong></h3><ul><li>ä¸“é—¨å¤„ç† <code>@periodic_task(crontab(...))</code> ä»»åŠ¡ã€‚</li><li>ä¼šæ ¹æ®æ—¶é—´æ¡ä»¶ï¼Œå°†å‘¨æœŸæ€§ä»»åŠ¡â€œæ¨â€å…¥é˜Ÿåˆ—ï¼ˆå³å†™å…¥ Redis&#x2F;Sqliteï¼‰ã€‚</li><li><strong>æ˜¯ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹ï¼ˆæˆ–è¿›ç¨‹ï¼‰åœ¨ Consumer ä¸­è¿è¡Œ</strong>ã€‚</li></ul><hr><h3 id="3-Consumerï¼šæ¶ˆè´¹è€…ä¸»æ§å™¨"><a href="#3-Consumerï¼šæ¶ˆè´¹è€…ä¸»æ§å™¨" class="headerlink" title="3. Consumerï¼šæ¶ˆè´¹è€…ä¸»æ§å™¨"></a>3. <strong>Consumerï¼šæ¶ˆè´¹è€…ä¸»æ§å™¨</strong></h3><p>è¿™æ˜¯å…³é”®æ¨¡å—ï¼Œå®ƒï¼š</p><ul><li>å¯åŠ¨å¤šä¸ª Workerï¼›</li><li>æ‹‰èµ· Schedulerï¼›</li><li>ç®¡ç† Worker çš„ç”Ÿå‘½å‘¨æœŸï¼ˆå¥åº·æ£€æŸ¥ã€é‡å¯ï¼‰ï¼›</li><li>æ‹‰ä»»åŠ¡ç»™ Worker æ‰§è¡Œã€‚</li></ul><p>Consumer å°±åƒä¸ªâ€œç­ä¸»ä»»â€ï¼ŒæŒ‡æŒ¥æ‰€æœ‰ Worker å¹²æ´»ã€‚</p><hr><h3 id="4-Workerï¼šçœŸæ­£æ‰§è¡Œä»»åŠ¡çš„è¿›ç¨‹æˆ–çº¿ç¨‹"><a href="#4-Workerï¼šçœŸæ­£æ‰§è¡Œä»»åŠ¡çš„è¿›ç¨‹æˆ–çº¿ç¨‹" class="headerlink" title="4. Workerï¼šçœŸæ­£æ‰§è¡Œä»»åŠ¡çš„è¿›ç¨‹æˆ–çº¿ç¨‹"></a>4. <strong>Workerï¼šçœŸæ­£æ‰§è¡Œä»»åŠ¡çš„è¿›ç¨‹æˆ–çº¿ç¨‹</strong></h3><p>Worker æ˜¯ Huey ä¸­å®é™… <strong>æ‰§è¡Œä»»åŠ¡çš„å®ä½“</strong>ï¼Œå®ƒå¾ªç¯ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ï¼Œå¤„ç†æ‰§è¡Œã€å¼‚å¸¸ã€ç»“æœå­˜å‚¨ç­‰å¤šä¸ªç¯èŠ‚ï¼Œæ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š</p><hr><h4 id="ğŸ§±-1-ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æ‹‰å–ä»»åŠ¡ï¼ˆdequeueï¼‰"><a href="#ğŸ§±-1-ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æ‹‰å–ä»»åŠ¡ï¼ˆdequeueï¼‰" class="headerlink" title="ğŸ§± 1. ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æ‹‰å–ä»»åŠ¡ï¼ˆdequeueï¼‰"></a>ğŸ§± 1. ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æ‹‰å–ä»»åŠ¡ï¼ˆdequeueï¼‰</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">task = <span class="hljs-variable language_">self</span>.huey.dequeue()<br></code></pre></td></tr></table></figure><ul><li><code>huey.dequeue()</code> ä¼šè¿æ¥åç«¯å­˜å‚¨ï¼ˆRedis &#x2F; Sqliteï¼‰å»è¯»å–ä¸€æ¡å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚</li><li>é˜Ÿåˆ—ä¸­ä¿å­˜çš„æ˜¯åºåˆ—åŒ–åçš„ä»»åŠ¡æ¶ˆæ¯ï¼Œå†…å®¹åŒ…æ‹¬ä»»åŠ¡IDã€å‡½æ•°åç§°ã€å‚æ•°ç­‰ã€‚</li></ul><hr><h4 id="ğŸ§°-2-ååºåˆ—åŒ–æ¶ˆæ¯ï¼Œè§£æä»»åŠ¡å‡½æ•°å’Œå‚æ•°"><a href="#ğŸ§°-2-ååºåˆ—åŒ–æ¶ˆæ¯ï¼Œè§£æä»»åŠ¡å‡½æ•°å’Œå‚æ•°" class="headerlink" title="ğŸ§° 2. ååºåˆ—åŒ–æ¶ˆæ¯ï¼Œè§£æä»»åŠ¡å‡½æ•°å’Œå‚æ•°"></a>ğŸ§° 2. ååºåˆ—åŒ–æ¶ˆæ¯ï¼Œè§£æä»»åŠ¡å‡½æ•°å’Œå‚æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-variable language_">self</span>.huey.execute(task)<br></code></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥ä¼šè§£æä»»åŠ¡æ¶ˆæ¯ï¼ˆTaskå¯¹è±¡ï¼‰ï¼š</p><ul><li>ç¡®å®šå¯¹åº”çš„ä»»åŠ¡å‡½æ•°ï¼ˆé€šè¿‡ <code>Huey</code> æ³¨å†Œçš„ task æ˜ å°„ï¼‰</li><li>è·å–å‡½æ•°å‚æ•°ï¼ˆargsã€kwargsï¼‰</li><li>è¿˜åŸ task çš„ä¸Šä¸‹æ–‡ï¼ˆæ¯”å¦‚ä»»åŠ¡IDã€é‡è¯•æ¬¡æ•°ç­‰ï¼‰</li></ul><p>Huey åœ¨ä»»åŠ¡æ³¨å†Œæ—¶å†…éƒ¨åšäº†å‡½æ•°å°è£…ï¼Œååºåˆ—åŒ–èƒ½è¿˜åŸå‡ºçœŸæ­£è¦æ‰§è¡Œçš„ Python å‡½æ•°ã€‚</p><hr><h4 id="ğŸ§ -3-æ‰§è¡Œä»»åŠ¡å‡½æ•°çš„ä¸šåŠ¡é€»è¾‘"><a href="#ğŸ§ -3-æ‰§è¡Œä»»åŠ¡å‡½æ•°çš„ä¸šåŠ¡é€»è¾‘" class="headerlink" title="ğŸ§  3. æ‰§è¡Œä»»åŠ¡å‡½æ•°çš„ä¸šåŠ¡é€»è¾‘"></a>ğŸ§  3. æ‰§è¡Œä»»åŠ¡å‡½æ•°çš„ä¸šåŠ¡é€»è¾‘</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">result = func(*args, **kwargs)<br></code></pre></td></tr></table></figure><ul><li>ä»»åŠ¡å‡½æ•°è¢«è°ƒç”¨ï¼›</li><li>æ‰§è¡Œä¸­å¯ä»¥è°ƒç”¨æ•°æ®åº“ã€APIã€å‘é€é‚®ä»¶ç­‰ï¼›</li><li>æ”¯æŒè¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥è¿”å› <code>None</code>ï¼›</li><li>Worker æ˜¯å¼‚æ­¥æ‹‰ä»»åŠ¡ã€åŒæ­¥æ‰§è¡Œã€‚</li></ul><p>Huey æœ¬è´¨ä¸Šæ˜¯<strong>åŒæ­¥æ‰§è¡Œ</strong>ä»»åŠ¡ï¼Œä½†æ”¯æŒå¹¶å‘ worker å®ç°å¹¶è¡Œæ‰§è¡Œã€‚</p><hr><h4 id="ğŸš¨-4-å¼‚å¸¸å¤„ç†æœºåˆ¶"><a href="#ğŸš¨-4-å¼‚å¸¸å¤„ç†æœºåˆ¶" class="headerlink" title="ğŸš¨ 4. å¼‚å¸¸å¤„ç†æœºåˆ¶"></a>ğŸš¨ 4. å¼‚å¸¸å¤„ç†æœºåˆ¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    result = func(*args, **kwargs)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    logger.exception(<span class="hljs-string">&#x27;Unhandled error during task %s&#x27;</span>, task.<span class="hljs-built_in">id</span>)<br></code></pre></td></tr></table></figure><ul><li><p>å¦‚æœä»»åŠ¡æ‰§è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼ŒWorker ä¼šï¼š</p></li><li><ul><li>è®°å½•é”™è¯¯æ—¥å¿—ï¼›</li><li>è®¾ç½®ä»»åŠ¡çŠ¶æ€ä¸ºå¤±è´¥ï¼›</li><li>ï¼ˆå¯é€‰ï¼‰æ”¯æŒè‡ªåŠ¨é‡è¯•ï¼ˆé€šè¿‡ <code>@task(retries=n)</code> è®¾ç½®ï¼‰ï¼›</li></ul></li><li><p>æœ‰äº›åç«¯æ”¯æŒå¤±è´¥ä»»åŠ¡è®°å½•ï¼Œå¦‚ Redis å¯è®°å½•åˆ°é”™è¯¯é˜Ÿåˆ—ã€‚</p></li></ul><hr><h4 id="ğŸ“-5-å­˜å‚¨ä»»åŠ¡ç»“æœï¼ˆå¯é€‰ï¼‰"><a href="#ğŸ“-5-å­˜å‚¨ä»»åŠ¡ç»“æœï¼ˆå¯é€‰ï¼‰" class="headerlink" title="ğŸ“ 5. å­˜å‚¨ä»»åŠ¡ç»“æœï¼ˆå¯é€‰ï¼‰"></a>ğŸ“ 5. å­˜å‚¨ä»»åŠ¡ç»“æœï¼ˆå¯é€‰ï¼‰</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-variable language_">self</span>.huey.store_result(task, result)<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœä»»åŠ¡å‡½æ•°æœ‰è¿”å›å€¼ï¼ŒHuey å¯ä»¥å°†å…¶å­˜å…¥ç»“æœåç«¯ï¼›</li><li>é»˜è®¤ Redis æ˜¯æ”¯æŒç»“æœå­˜å‚¨çš„ï¼ˆå¯ç”¨ <code>result_store=True</code>ï¼‰ï¼›</li><li>å­˜å‚¨ç»“æœåï¼Œå…¶ä»–ç»„ä»¶ï¼ˆæ¯”å¦‚ Web ç«¯ï¼‰å¯ä»¥æŸ¥ç»“æœã€‚</li></ul><p>ä¹Ÿæ”¯æŒè®¾ç½®ä»»åŠ¡æ˜¯å¦éœ€è¦ç»“æœï¼Œæ¯”å¦‚ <code>@task(store_result=False)</code> å¯ä»¥å…³é—­å­˜å‚¨ã€‚</p><hr><h4 id="ğŸ’¤-6-ç­‰å¾…ä¸‹ä¸€è½®ä»»åŠ¡ï¼ˆä»»åŠ¡è°ƒåº¦æ§åˆ¶ï¼‰"><a href="#ğŸ’¤-6-ç­‰å¾…ä¸‹ä¸€è½®ä»»åŠ¡ï¼ˆä»»åŠ¡è°ƒåº¦æ§åˆ¶ï¼‰" class="headerlink" title="ğŸ’¤ 6. ç­‰å¾…ä¸‹ä¸€è½®ä»»åŠ¡ï¼ˆä»»åŠ¡è°ƒåº¦æ§åˆ¶ï¼‰"></a>ğŸ’¤ 6. ç­‰å¾…ä¸‹ä¸€è½®ä»»åŠ¡ï¼ˆä»»åŠ¡è°ƒåº¦æ§åˆ¶ï¼‰</h4><ul><li>å¦‚æœæ²¡æ‹‰åˆ°ä»»åŠ¡ï¼Œä¼šè°ƒç”¨ <code>self.sleep()</code> è¿›è¡Œå»¶è¿Ÿç­‰å¾…ï¼›</li><li>æ”¯æŒå»¶è¿Ÿç­–ç•¥ï¼ˆdefault_delayã€max_delayã€backoffï¼‰ï¼›</li><li>é¿å…æ­»å¾ªç¯ + CPU ç©ºè½¬ï¼›</li><li>å¦‚æœé˜Ÿåˆ—æ˜¯ blockingï¼ˆé˜»å¡å¼ï¼Œæ¯”å¦‚ Redis BRPOPï¼‰ï¼Œåˆ™ç›´æ¥é˜»å¡ç­‰å¾…ä»»åŠ¡ã€‚</li></ul><hr><h4 id="ğŸŒªï¸-æ€»ç»“å®Œæ•´æµç¨‹å›¾"><a href="#ğŸŒªï¸-æ€»ç»“å®Œæ•´æµç¨‹å›¾" class="headerlink" title="ğŸŒªï¸ æ€»ç»“å®Œæ•´æµç¨‹å›¾"></a>ğŸŒªï¸ æ€»ç»“å®Œæ•´æµç¨‹å›¾</h4><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs latex">+---------------------+<br>|     Worker å¯åŠ¨     |<br>+----------+----------+<br>           |<br>           v<br>+--------------------------+<br>| æ‹‰å–ä»»åŠ¡ huey.dequeue()  |<br>+--------------------------+<br>           |<br>           v<br>+-------------------------------+<br>| ååºåˆ—åŒ–ï¼šè·å–å‡½æ•°+å‚æ•°       |<br>+-------------------------------+<br>           |<br>           v<br>+-----------------------------+<br>| æ‰§è¡Œä»»åŠ¡å‡½æ•° func(*args)   |<br>+-----------------------------+<br>           |<br>      +----+----+<br>      |         |<br>      v         v<br> æˆåŠŸæ‰§è¡Œ     æŠ›å‡ºå¼‚å¸¸<br>   |              |<br>   v              v<br> ä¿å­˜ç»“æœ     æ—¥å¿—è®°å½•/é‡è¯•<br>   |<br>   v<br> ç¡çœ /ç­‰å¾…ä¸‹ä¸€ä»»åŠ¡<br></code></pre></td></tr></table></figure><hr><h4 id="ğŸ§©-å…¶ä»–ç»†èŠ‚æ‹“å±•ï¼ˆé«˜çº§ç‰¹æ€§ï¼‰"><a href="#ğŸ§©-å…¶ä»–ç»†èŠ‚æ‹“å±•ï¼ˆé«˜çº§ç‰¹æ€§ï¼‰" class="headerlink" title="ğŸ§© å…¶ä»–ç»†èŠ‚æ‹“å±•ï¼ˆé«˜çº§ç‰¹æ€§ï¼‰"></a>ğŸ§© å…¶ä»–ç»†èŠ‚æ‹“å±•ï¼ˆé«˜çº§ç‰¹æ€§ï¼‰</h4><ul><li><strong>ä»»åŠ¡é‡è¯•æœºåˆ¶</strong>ï¼šé€šè¿‡ <code>@task(retries=3, retry_delay=10)</code> è‡ªåŠ¨é‡è¯•å¤±è´¥ä»»åŠ¡ï¼›</li><li><strong>ä¼˜å…ˆçº§é˜Ÿåˆ—æ”¯æŒ</strong>ï¼šä½¿ç”¨ <code>PriorityRedisHuey</code> æ”¯æŒä»»åŠ¡ä¼˜å…ˆçº§è°ƒåº¦ï¼›</li><li><strong>å®šæ—¶ä»»åŠ¡éš”ç¦»</strong>ï¼š<code>Scheduler</code> æ¨é€çš„æ˜¯ periodic_taskï¼ŒWorker å¯¹å…¶ç»Ÿä¸€å¤„ç†ï¼›</li><li><strong>å¤šè¿›ç¨‹&#x2F;çº¿ç¨‹æ¨¡å¼</strong>ï¼šé€šè¿‡ Consumer çš„ <code>worker_type</code> æ§åˆ¶æ˜¯å¤šçº¿ç¨‹è¿˜æ˜¯å¤šè¿›ç¨‹æ‰§è¡Œ Workerï¼›</li><li><strong>æœ€å¤§ä»»åŠ¡é™åˆ¶</strong>ï¼ˆä½ ç”¨åˆ°çš„ï¼‰ï¼šWorker è¾¾åˆ° <code>max_tasks</code> é™åˆ¶åè‡ªåŠ¨é€€å‡ºï¼›</li><li><strong>ä»»åŠ¡ç»“æœè¿‡æœŸ</strong>ï¼šå¯é…ç½® Redis ç»“æœ TTLï¼Œé¿å…ç»“æœé•¿æ—¶é—´å ç”¨å†…å­˜ã€‚</li></ul><hr><h3 id="5-Brokerï¼šä»»åŠ¡é˜Ÿåˆ—çš„å­˜å‚¨ä»‹è´¨"><a href="#5-Brokerï¼šä»»åŠ¡é˜Ÿåˆ—çš„å­˜å‚¨ä»‹è´¨" class="headerlink" title="5. Brokerï¼šä»»åŠ¡é˜Ÿåˆ—çš„å­˜å‚¨ä»‹è´¨"></a>5. <strong>Brokerï¼šä»»åŠ¡é˜Ÿåˆ—çš„å­˜å‚¨ä»‹è´¨</strong></h3><ul><li>æ”¯æŒ Redisã€Sqlite ç­‰ï¼›</li><li>æ‰€æœ‰ä»»åŠ¡éƒ½è¦å†™å…¥&#x2F;è¯»å–è¿™é‡Œï¼›</li><li>Scheduler å’Œ Worker éƒ½æ˜¯å›´ç»• Broker å·¥ä½œã€‚</li></ul><hr><h2 id="ğŸ”„-è¿è¡Œæµç¨‹ç®€è¦å›¾ç¤º"><a href="#ğŸ”„-è¿è¡Œæµç¨‹ç®€è¦å›¾ç¤º" class="headerlink" title="ğŸ”„ è¿è¡Œæµç¨‹ç®€è¦å›¾ç¤º"></a>ğŸ”„ è¿è¡Œæµç¨‹ç®€è¦å›¾ç¤º</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs latex">@huey.task() -&gt; æ³¨å†Œä»»åŠ¡åˆ° Huey<br><br>å‘¨æœŸæ€§ä»»åŠ¡:<br>Scheduler -&gt; æ£€æŸ¥æ—¶é—´ -&gt; æ¨å…¥ Redis/Sqlite<br><br>æ™®é€šä»»åŠ¡:<br>ç”¨æˆ·è°ƒç”¨ task(...) -&gt; ç«‹å³æ¨å…¥ Redis/Sqlite<br><br>Consumer -&gt; æ‹‰ä»»åŠ¡ -&gt; åˆ†å‘ç»™å¤šä¸ª Worker<br><br>Worker -&gt; çœŸå®æ‰§è¡Œä»»åŠ¡<br></code></pre></td></tr></table></figure><hr><h2 id="ğŸ¯-Consumer-å’Œ-Worker-çš„å…·ä½“å…³ç³»"><a href="#ğŸ¯-Consumer-å’Œ-Worker-çš„å…·ä½“å…³ç³»" class="headerlink" title="ğŸ¯ Consumer å’Œ Worker çš„å…·ä½“å…³ç³»"></a>ğŸ¯ Consumer å’Œ Worker çš„å…·ä½“å…³ç³»</h2><table><thead><tr><th>é¡¹ç›®</th><th>æè¿°</th></tr></thead><tbody><tr><td>ç®¡ç†è€…</td><td>Consumer æ˜¯æ€»æ§ï¼Œå¯åŠ¨ Scheduler å’Œå¤šä¸ª Worker</td></tr><tr><td>å¯åŠ¨æ–¹å¼</td><td>Worker å¯åŠ¨æ˜¯ç”± Consumer <code>create_worker()</code> æ–¹æ³•ç”Ÿæˆ</td></tr><tr><td>å¥åº·æ£€æŸ¥</td><td>Worker å¦‚æœæŒ‚äº†ï¼ŒConsumer ä¼šæ£€æµ‹å¹¶è‡ªåŠ¨é‡å¯</td></tr><tr><td>æ‰§è¡ŒèŒè´£</td><td>Worker è´Ÿè´£ä» Broker ä¸­æ‹‰ä»»åŠ¡å¹¶æ‰§è¡Œï¼›Consumer ä¸æ‰§è¡Œä»»åŠ¡æœ¬èº«</td></tr><tr><td>å¹¶å‘æ¨¡å‹</td><td>Worker æ”¯æŒçº¿ç¨‹&#x2F;è¿›ç¨‹æ¨¡å‹ï¼Œç”± <code>worker_type</code> å‚æ•°æŒ‡å®š</td></tr><tr><td>ç”Ÿå‘½å‘¨æœŸæ§åˆ¶</td><td>Worker å¯é…ç½®æ‰§è¡Œæœ€å¤§ä»»åŠ¡æ•°&#x2F;è¶…æ—¶ç­‰é€€å‡ºæ¡ä»¶ï¼Œç”± Consumer è´Ÿè´£æ§åˆ¶</td></tr></tbody></table><hr><h2 id="ğŸ§ -æ€»ç»“ä¸€ä¸‹"><a href="#ğŸ§ -æ€»ç»“ä¸€ä¸‹" class="headerlink" title="ğŸ§  æ€»ç»“ä¸€ä¸‹"></a>ğŸ§  æ€»ç»“ä¸€ä¸‹</h2><ul><li><strong>Huey æ¶æ„ç®€å•è€Œæ¸…æ™°ï¼šProducer â†’ Broker â†’ Consumer â†’ Worker</strong></li><li><strong>Consumer æ˜¯ orchestratorï¼Œè°ƒåº¦å’Œç®¡ç†ä¸€åˆ‡è¿è¡Œçš„å•å…ƒ</strong></li><li><strong>Worker æ˜¯å¹²æ´»çš„å®ä½“ï¼ŒçœŸæ­£è´Ÿè´£æ‰§è¡Œç”¨æˆ·å®šä¹‰çš„ä»»åŠ¡å‡½æ•°</strong></li><li><strong>Scheduler åªå‚ä¸å‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦ï¼Œå±äº Consumer ç®¡è¾–ä¸‹çš„ä¸€ä¸ªçº¿ç¨‹</strong></li></ul><hr><h2 id="Consumerå§‹ç»ˆæ˜¯è¿›ç¨‹ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ˜¯å½“workeræ˜¯çº¿ç¨‹æ—¶ï¼Œç”¨çº¿ç¨‹"><a href="#Consumerå§‹ç»ˆæ˜¯è¿›ç¨‹ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ˜¯å½“workeræ˜¯çº¿ç¨‹æ—¶ï¼Œç”¨çº¿ç¨‹" class="headerlink" title="Consumerå§‹ç»ˆæ˜¯è¿›ç¨‹ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ˜¯å½“workeræ˜¯çº¿ç¨‹æ—¶ï¼Œç”¨çº¿ç¨‹"></a>Consumerå§‹ç»ˆæ˜¯è¿›ç¨‹ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ˜¯å½“workeræ˜¯çº¿ç¨‹æ—¶ï¼Œç”¨çº¿ç¨‹</h2><h3 id="ğŸ¯-é—®é¢˜æœ¬è´¨"><a href="#ğŸ¯-é—®é¢˜æœ¬è´¨" class="headerlink" title="ğŸ¯ é—®é¢˜æœ¬è´¨"></a>ğŸ¯ é—®é¢˜æœ¬è´¨</h3><p>ä½ é—®çš„æ˜¯ï¼š</p><p>åœ¨ <code>worker_type=&quot;thread&quot;</code> æ—¶ï¼Œ<strong>Consumer ä¸ºå•¥è¿˜æ˜¯è¿›ç¨‹</strong>ï¼Œè€Œä¸æ˜¯ä¹Ÿä½œä¸ºçº¿ç¨‹è¿è¡Œï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼š</p><p><strong>å› ä¸º Consumer æ˜¯ Huey çš„â€œè°ƒåº¦ä¸»æ§å™¨â€ï¼Œæœ¬è´¨å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„ä¸»è¿›ç¨‹</strong>ï¼Œå®ƒçš„èŒè´£æ˜¯åˆ›å»ºã€ç®¡ç†å¤šä¸ª workerï¼ˆçº¿ç¨‹æˆ–è¿›ç¨‹ï¼‰ï¼Œè¿™ä¸ªè§’è‰²<strong>å¤©ç„¶å°±éœ€è¦ä»¥è¿›ç¨‹å½¢å¼å¯åŠ¨</strong>ã€‚</p><hr><h3 id="ğŸ”§-æ‹†è§£è§’è‰²èŒè´£"><a href="#ğŸ”§-æ‹†è§£è§’è‰²èŒè´£" class="headerlink" title="ğŸ”§ æ‹†è§£è§’è‰²èŒè´£"></a>ğŸ”§ æ‹†è§£è§’è‰²èŒè´£</h3><h4 id="ğŸ§ -1-Consumer-çš„èŒè´£æ˜¯ï¼š"><a href="#ğŸ§ -1-Consumer-çš„èŒè´£æ˜¯ï¼š" class="headerlink" title="ğŸ§  1. Consumer çš„èŒè´£æ˜¯ï¼š"></a>ğŸ§  1. <code>Consumer</code> çš„èŒè´£æ˜¯ï¼š</h4><ul><li>å¯åŠ¨å¤šä¸ª Workerï¼ˆçº¿ç¨‹&#x2F;è¿›ç¨‹ï¼‰</li><li>å®šæ—¶æ‰«æä»»åŠ¡ï¼ˆå®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ï¼‰</li><li>å¥åº·æ£€æŸ¥ï¼šç›‘æ§ worker æ˜¯å¦å­˜æ´»ï¼Œå´©äº†å°±é‡å¯</li><li>ç»´æŠ¤å…±äº«é˜Ÿåˆ—ã€åŒæ­¥æ—¥å¿—</li></ul><p>è¿™äº›éƒ½éœ€è¦<strong>é˜»å¡å¼çš„æ§åˆ¶å¾ªç¯ï¼ˆevent loopï¼‰</strong>ã€è°ƒåº¦å™¨ã€çº¿ç¨‹&#x2F;è¿›ç¨‹ç®¡ç†èƒ½åŠ›ï¼Œä¸é€‚åˆç”¨çº¿ç¨‹å½¢å¼æ‰˜ç®¡åœ¨å…¶ä»–ç¨‹åºé‡Œã€‚</p><hr><h4 id="ğŸ§©-2-Consumer-â‰ -æŸä¸ª-Worker"><a href="#ğŸ§©-2-Consumer-â‰ -æŸä¸ª-Worker" class="headerlink" title="ğŸ§© 2. Consumer â‰  æŸä¸ª Worker"></a>ğŸ§© 2. <code>Consumer</code> â‰  æŸä¸ª Worker</h4><p><code>Consumer</code> å¹¶ä¸ä¼šè‡ªå·±æ‰§è¡Œä»»åŠ¡ï¼Œå®ƒåªæ˜¯ï¼š</p><ul><li>åˆ›å»º N ä¸ª Worker å®ä¾‹</li><li>æŠŠä»»åŠ¡ä»é˜Ÿåˆ—ä¸­åˆ†å‘ä¸‹å»</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå“ªæ€• Worker æ˜¯çº¿ç¨‹ï¼Œ<code>Consumer</code> æœ¬èº«ä¹Ÿä¸ä¼šæ˜¯å…¶ä¸­ä¹‹ä¸€ â€”â€” å®ƒæ˜¯ä¸Šçº§æ§åˆ¶å™¨ã€‚</p><hr><h4 id="ğŸš§-3-ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯çº¿ç¨‹ï¼Ÿ"><a href="#ğŸš§-3-ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯çº¿ç¨‹ï¼Ÿ" class="headerlink" title="ğŸš§ 3. ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯çº¿ç¨‹ï¼Ÿ"></a>ğŸš§ 3. ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯çº¿ç¨‹ï¼Ÿ</h4><p>å‡è®¾æˆ‘ä»¬æŠŠ <code>Consumer</code> åšæˆçº¿ç¨‹ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><table><thead><tr><th>é—®é¢˜ç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ä¸æ˜“ç‹¬ç«‹éƒ¨ç½²</strong></td><td>Huey æ˜¯ä¸ªè°ƒåº¦ç³»ç»Ÿï¼ŒConsumer å¿…é¡»ç‹¬ç«‹è¿è¡Œï¼Œçº¿ç¨‹ä¸æ–¹ä¾¿è„±ç¦»ä¸»ç¨‹åºç‹¬ç«‹è¿è¡Œ</td></tr><tr><td><strong>èµ„æº&#x2F;æ§åˆ¶å†²çª</strong></td><td>çº¿ç¨‹æ— æ³•å¯¹å­çº¿ç¨‹è¿›è¡Œè¿›ç¨‹çº§èµ„æºå›æ”¶å’Œç‹¬ç«‹å´©æºƒæ¢å¤</td></tr><tr><td><strong>å¥åº·æ£€æŸ¥å¤±æ•ˆ</strong></td><td>å¥åº·æ£€æŸ¥æœºåˆ¶éœ€è¦è¿›ç¨‹é—´é€šä¿¡ï¼Œçº¿ç¨‹åšä¸åˆ°éš”ç¦»é‡å¯</td></tr><tr><td><strong>è°ƒåº¦ä¸å‡†ç¡®</strong></td><td>å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨å†…éƒ¨åŸºäº event loop å’Œ timerï¼Œä¼šè¢«ä¸»çº¿ç¨‹é˜»å¡å¹²æ‰°</td></tr><tr><td><strong>å…¼å®¹æ€§é—®é¢˜</strong></td><td>æ¯”å¦‚å¤šçº¿ç¨‹ä¸‹çš„ GILï¼ˆå…¨å±€è§£é‡Šå™¨é”ï¼‰ä¼šé™åˆ¶å¹¶å‘æ•ˆç‡ï¼Œè€Œè¿›ç¨‹ä¸ä¼šå—å½±å“</td></tr></tbody></table><hr><h3 id="âœ…-æ­£ç¡®çš„æ¶æ„è§†è§’å›¾"><a href="#âœ…-æ­£ç¡®çš„æ¶æ„è§†è§’å›¾" class="headerlink" title="âœ… æ­£ç¡®çš„æ¶æ„è§†è§’å›¾"></a>âœ… æ­£ç¡®çš„æ¶æ„è§†è§’å›¾</h3><p>ä¸ç®¡ Worker æ˜¯çº¿ç¨‹è¿˜æ˜¯è¿›ç¨‹ï¼ŒConsumer éƒ½æ˜¯å¦‚ä¸‹ç»“æ„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">            [Consumer ä¸»è¿›ç¨‹]<br>                   |<br>     +-------------+-------------+<br>     |                           |<br>[Worker Thread]           [Worker Thread]<br>[Thread #1]               [Thread #2]<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">            [Consumer ä¸»è¿›ç¨‹]<br>                   |<br>     +-------------+-------------+<br>     |                           |<br>[Worker Process]           [Worker Process]<br>[Process #1]               [Process #2]<br></code></pre></td></tr></table></figure><hr><h3 id="ğŸ¯-æ€»ç»“ä¸€å¥è¯ï¼š"><a href="#ğŸ¯-æ€»ç»“ä¸€å¥è¯ï¼š" class="headerlink" title="ğŸ¯ æ€»ç»“ä¸€å¥è¯ï¼š"></a>ğŸ¯ æ€»ç»“ä¸€å¥è¯ï¼š</h3><p><strong>Consumer æ°¸è¿œæ˜¯ä¸»è¿›ç¨‹</strong>ï¼Œå®ƒå°±æ˜¯æ•´ä¸ªè°ƒåº¦ç³»ç»Ÿçš„æ ¸å¿ƒæ§åˆ¶å™¨ï¼Œçº¿ç¨‹æˆ–è¿›ç¨‹åªæ˜¯å®ƒæ‰€å¯åŠ¨çš„ Worker çš„æ‰§è¡Œæ–¹å¼ã€‚è®© Consumer æˆä¸ºçº¿ç¨‹åè€Œä¼šå‰Šå¼±å®ƒçš„ç‹¬ç«‹æ€§ã€ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</p><hr><p>å¦‚æœä½ æœªæ¥è¦éƒ¨ç½² Huey æœåŠ¡ï¼Œæ¨èæŠŠ Consumer ä½œä¸ºä¸€ä¸ª<strong>ç‹¬ç«‹æœåŠ¡è¿›ç¨‹éƒ¨ç½²</strong>ï¼Œé€šè¿‡ supervisor æˆ– systemd æ¥å®ˆæŠ¤å®ƒçš„è¿è¡Œã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python åç¨‹</title>
    <link href="/2025/04/30/Python-%E5%8D%8F%E7%A8%8B/"/>
    <url>/2025/04/30/Python-%E5%8D%8F%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Python ä¸­çš„åç¨‹æ˜¯é€šè¿‡ <code>async</code> å’Œ <code>await</code> å…³é”®å­—å®ç°çš„ï¼Œå®ƒä»¬ä½¿ä½ èƒ½å¤Ÿç¼–å†™å¹¶å‘ä»£ç ï¼Œå°±åƒç¼–å†™æ™®é€šçš„åŒæ­¥ä»£ç ä¸€æ ·ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨åç¨‹æ¥å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ã€‚</p><p>é¦–å…ˆï¼Œç¡®ä¿ä½ æœ‰ Python 3.5 æˆ–æ›´é«˜çš„ç‰ˆæœ¬ï¼Œå› ä¸º <code>async</code> å’Œ <code>await</code> æ˜¯ä» Python 3.5 å¼€å§‹å¼•å…¥çš„ã€‚</p><h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h2><h3 id="å•ä¸ªä»»åŠ¡"><a href="#å•ä¸ªä»»åŠ¡" class="headerlink" title="å•ä¸ªä»»åŠ¡"></a>å•ä¸ªä»»åŠ¡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œé€šè¿‡ async å…³é”®å­—å®šä¹‰</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_data</span>(<span class="hljs-params">delay</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¼€å§‹è·å–æ•°æ®ï¼ˆè€—æ—¶ï¼š<span class="hljs-subst">&#123;delay&#125;</span>ç§’ï¼‰...&quot;</span>)<br>    <span class="hljs-comment"># æ¨¡æ‹Ÿ IO ä»»åŠ¡ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼Œä½¿ç”¨ asyncio.sleep æ›¿ä»£ time.sleep</span><br>    <span class="hljs-keyword">await</span> asyncio.sleep(delay)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ•°æ®è·å–å®Œæˆï¼&quot;</span>)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&#x27;data&#x27;</span>: <span class="hljs-string">&#x27;some data&#x27;</span>&#125;  <span class="hljs-comment"># æ¨¡æ‹Ÿè¿”å›çš„æ•°æ®</span><br><br><span class="hljs-comment"># è¿™æ˜¯å¦ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œç”¨äºå¤„ç†æ•°æ®</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¼€å§‹å¤„ç†æ•°æ®...&quot;</span>)<br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">2</span>)  <span class="hljs-comment"># æ¨¡æ‹Ÿæ•°æ®å¤„ç†æ‰€éœ€çš„æ—¶é—´</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ•°æ®å¤„ç†å®Œæˆ: <span class="hljs-subst">&#123;data&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># ä¸»å‡½æ•°ï¼Œç”¨äºè¿è¡Œåç¨‹</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># å¯åŠ¨ fetch_data åç¨‹ï¼Œç­‰å¾…å®ƒå®Œæˆ</span><br>    data = <span class="hljs-keyword">await</span> fetch_data(<span class="hljs-number">3</span>)<br>    <span class="hljs-comment"># æ¥ç€å¤„ç†æ•°æ®</span><br>    <span class="hljs-keyword">await</span> process_data(data)<br><br><span class="hljs-comment"># è¿è¡Œä¸»å‡½æ•°åç¨‹</span><br>asyncio.run(main())<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>fetch_data</code> å‡½æ•°æ¨¡æ‹Ÿäº†ä¸€ä¸ªéœ€è¦ 3 ç§’é’Ÿå®Œæˆçš„æ•°æ®è·å–ä»»åŠ¡ï¼Œå®ƒä½¿ç”¨ <code>asyncio.sleep</code> æ¥å¼‚æ­¥ç­‰å¾…ï¼Œè€Œä¸ä¼šé˜»å¡æ•´ä¸ªäº‹ä»¶å¾ªç¯ã€‚<code>process_data</code> å‡½æ•°æ¨¡æ‹Ÿå¯¹è·å–çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè€—æ—¶ 2 ç§’ã€‚</p><p>æœ€åï¼Œåœ¨ <code>main</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>await</code> æ¥è°ƒç”¨è¿™äº›å¼‚æ­¥å‡½æ•°ï¼Œè¿™æ ·å¯ä»¥ä¸€æ­¥ä¸€æ­¥åœ°æ‰§è¡Œå®ƒä»¬ï¼Œ<code>asyncio.run(main())</code> ç”¨äºå¯åŠ¨äº‹ä»¶å¾ªç¯å¹¶è¿è¡Œ <code>main</code> å‡½æ•°ã€‚</p><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼Œå±•ç¤ºäº†ç¨‹åºçš„æ‰§è¡Œé¡ºåºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">å¼€å§‹è·å–æ•°æ®ï¼ˆè€—æ—¶ï¼š3ç§’ï¼‰...<br>æ•°æ®è·å–å®Œæˆï¼<br>å¼€å§‹å¤„ç†æ•°æ®...<br>æ•°æ®å¤„ç†å®Œæˆ: &#123;&#x27;data&#x27;: &#x27;some data&#x27;&#125;<br></code></pre></td></tr></table></figure><p>æ­¤ä¾‹å­å±•ç¤ºäº†åç¨‹çš„åŸºæœ¬ç”¨æ³•ï¼Œä½†å®é™…ä¸Šåç¨‹çš„å¨åŠ›åœ¨äºèƒ½å¤Ÿä½¿å¤šä¸ª IO å¯†é›†å‹ä»»åŠ¡å¹¶å‘è¿è¡Œï¼Œå¤§å¤§æé«˜ç¨‹åºæ•ˆç‡ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åˆ›å»ºå¤šä¸ª<code>fetch_data</code>ä»»åŠ¡å¹¶åŒæ—¶è¿è¡Œå®ƒä»¬ï¼Œç„¶åç­‰å¾…æ‰€æœ‰ç»“æœå‡†å¤‡å°±ç»ªï¼Œä»è€Œå……åˆ†åˆ©ç”¨ç­‰å¾…æ—¶é—´ã€‚</p><h3 id="å¤šä¸ªä»»åŠ¡"><a href="#å¤šä¸ªä»»åŠ¡" class="headerlink" title="å¤šä¸ªä»»åŠ¡"></a>å¤šä¸ªä»»åŠ¡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-comment"># å®šä¹‰å¼‚æ­¥å‡½æ•°</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_data</span>(<span class="hljs-params">delay, data_id</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¼€å§‹è·å–æ•°æ® <span class="hljs-subst">&#123;data_id&#125;</span>ï¼ˆè€—æ—¶ï¼š<span class="hljs-subst">&#123;delay&#125;</span>ç§’ï¼‰...&quot;</span>)<br>    <span class="hljs-keyword">await</span> asyncio.sleep(delay)  <span class="hljs-comment"># æ¨¡æ‹Ÿç­‰å¾… IO æ“ä½œ</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ•°æ® <span class="hljs-subst">&#123;data_id&#125;</span> è·å–å®Œæˆï¼&quot;</span>)<br>    <span class="hljs-keyword">return</span> &#123;data_id: <span class="hljs-string">&#x27;some data&#x27;</span>&#125;  <span class="hljs-comment"># æƒ³è±¡æˆä»ç½‘ä¸Šè·å¾—äº†ä¸€äº›æ•°æ®</span><br><br><span class="hljs-comment"># ä¸»å‡½æ•°ï¼Œç”¨äºè¿è¡Œåç¨‹</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># åˆ›å»ºä¸‰ä¸ª fetch_data åç¨‹ä»»åŠ¡</span><br>    task1 = fetch_data(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;Data1&#x27;</span>)<br>    task2 = fetch_data(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;Data2&#x27;</span>)<br>    task3 = fetch_data(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;Data3&#x27;</span>)<br>    <br>    <span class="hljs-comment"># ä½¿ç”¨ asyncio.gather å¹¶è¡Œè¿è¡Œæ‰€æœ‰ä»»åŠ¡</span><br>    results = <span class="hljs-keyword">await</span> asyncio.gather(task1, task2, task3)<br>    <br>    <span class="hljs-comment"># results ä¸ºæ‰€æœ‰ä»»åŠ¡çš„è¿”å›å€¼åˆ—è¡¨</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ‰€æœ‰æ•°æ®å·²è·å–ï¼š<span class="hljs-subst">&#123;results&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># è¿è¡Œä¸»å‡½æ•°åç¨‹</span><br>asyncio.run(main())<br></code></pre></td></tr></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ<code>fetch_data</code> å‡½æ•°è¢«ä¿®æ”¹ï¼Œå¢åŠ äº†ä¸€ä¸ª <code>data_id</code> å‚æ•°ï¼Œä»¥ä¾¿åŒºåˆ†ä¸åŒçš„ä»»åŠ¡ã€‚<code>main</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸‰ä¸ª <code>fetch_data</code> åç¨‹ï¼Œæ¯ä¸ªéƒ½æœ‰ä¸åŒçš„ç­‰å¾…æ—¶é—´å’Œæ•°æ® IDã€‚ç„¶åä½¿ç”¨ <code>asyncio.gather</code> ä¸€æ¬¡æ€§å¯åŠ¨æ‰€æœ‰åç¨‹ä»»åŠ¡ã€‚<code>asyncio.gather</code> ä¼šç­‰å¾…ä¼ é€’ç»™å®ƒçš„æ‰€æœ‰åç¨‹å®Œæˆï¼Œå¹¶è¿”å›å®ƒä»¬çš„ç»“æœï¼ˆæŒ‰ä¼ é€’ç»™ <code>asyncio.gather</code> çš„é¡ºåºï¼‰ã€‚</p><p>å‡è®¾æ¯ä¸ª <code>fetch_data</code> çš„æ‰§è¡Œè€—æ—¶éƒ½ä¸ä¸€æ ·ï¼Œå› ä¸º <code>asyncio.gather</code> è¿è¡Œå®ƒä»¬æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œæ‰€ä»¥æ€»çš„æ‰§è¡Œæ—¶é—´å°†æ˜¯ä¸‰ä¸ªåç¨‹ä¸­è€—æ—¶æœ€é•¿çš„é‚£ä¸ªï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„æ€»å’Œã€‚</p><p>è¿è¡Œä¸Šè¿°ä»£ç ï¼Œä½ å°†çœ‹åˆ°æ‰€æœ‰çš„ <code>fetch_data</code> å‡ ä¹åŒæ—¶å¼€å§‹ï¼Œä½†æŒ‰ç…§å®ƒä»¬å„è‡ªçš„è€—æ—¶ä¾æ¬¡å®Œæˆã€‚å½“æ‰€æœ‰åç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åï¼Œ<code>main</code> å‡½æ•°æ‰“å°å‡ºæ‰€æœ‰æ•°æ®å·²è·å–çš„ä¿¡æ¯å’Œç»“æœåˆ—è¡¨ã€‚</p><h3 id="asyncio-get-event-loop"><a href="#asyncio-get-event-loop" class="headerlink" title="asyncio.get_event_loop()"></a>asyncio.get_event_loop()</h3><p>åœ¨Python 3.7ä¹‹å‰ï¼Œ<code>asyncio.get_event_loop()</code>æ–¹æ³•ç»å¸¸ç”¨æ¥è·å–å½“å‰ä¸Šä¸‹æ–‡çš„äº‹ä»¶å¾ªç¯ã€‚ä»Python 3.7å¼€å§‹ï¼Œå®˜æ–¹æ–‡æ¡£æ¨èä½¿ç”¨<code>asyncio.run()</code>æ¥è¿è¡Œæœ€é¡¶å±‚çš„åç¨‹ï¼Œå¹¶ä¸”åœ¨åç¨‹ä¸­é€šå¸¸ä¸éœ€è¦ç›´æ¥ä¸äº‹ä»¶å¾ªç¯äº¤äº’ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹æˆ–è€…æ˜¯Python 3.7ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¦‚æœéœ€è¦æ˜¾å¼è®¿é—®äº‹ä»¶å¾ªç¯ï¼Œ<code>asyncio.get_event_loop()</code>ä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå±•ç¤ºäº†åœ¨Python 3.7ä¹‹å‰å¦‚ä½•ä½¿ç”¨<code>asyncio.get_event_loop()</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">periodic</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hello every two seconds&#x27;</span>)<br>        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">2</span>)<br><br>loop = asyncio.get_event_loop()  <span class="hljs-comment"># è·å–å½“å‰ä¸Šä¸‹æ–‡ä¸­çš„äº‹ä»¶å¾ªç¯</span><br><span class="hljs-keyword">try</span>:<br>    asyncio.ensure_future(periodic())  <span class="hljs-comment"># å°†åç¨‹åŒ…è£…æˆTaskå¹¶å®‰æ’å…¶åœ¨äº‹ä»¶å¾ªç¯ä¸­è¿è¡Œ</span><br>    loop.run_forever()  <span class="hljs-comment"># è¿è¡Œäº‹ä»¶å¾ªç¯ï¼Œç›´åˆ°stop()è¢«è°ƒç”¨ã€‚äº‹ä»¶å¾ªç¯ä¼šæŒç»­è¿è¡Œå‘¨æœŸæ€§çš„periodic()å‡½æ•°</span><br><span class="hljs-keyword">except</span> KeyboardInterrupt:<br>    <span class="hljs-keyword">pass</span><br><span class="hljs-keyword">finally</span>:<br>    loop.close()  <span class="hljs-comment"># å…³é—­äº‹ä»¶å¾ªç¯</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆé€šè¿‡<code>asyncio.get_event_loop()</code>è·å–äº†å½“å‰ä¸Šä¸‹æ–‡çš„äº‹ä»¶å¾ªç¯ã€‚æ¥ç€ç”¨<code>asyncio.ensure_future()</code>å°†<code>periodic</code>è¿™ä¸ªåç¨‹å‡½æ•°å°è£…ä¸º<code>Task</code>å¹¶å®‰æ’åœ¨äº‹ä»¶å¾ªç¯ä¸­è¿è¡Œã€‚<code>run_forever()</code>æ–¹æ³•å¼€å§‹æ— é™å¾ªç¯åœ°è¿è¡Œäº‹ä»¶å¾ªç¯ï¼ŒçŸ¥é“<code>loop.stop()</code>è¢«è°ƒç”¨ã€‚å½“æƒ³è¦ä¸­æ­¢ç¨‹åºæ—¶ï¼ˆä¾‹å¦‚é€šè¿‡<code>KeyboardInterrupt</code>ï¼Œå¸¸è§äºæŒ‰ä¸‹<code>Ctrl+C</code>ï¼‰ï¼Œäº‹ä»¶å¾ªç¯é€šè¿‡è°ƒç”¨<code>finally</code>è¯­å¥å—ä¸­çš„<code>loop.close()</code>æ¥åœæ­¢å¹¶å…³é—­ã€‚</p><p>ä»Python 3.7åŠä»¥åç‰ˆæœ¬ï¼Œä½ å¯ä»¥ç®€åŒ–ä¸Šé¢çš„ä»£ç ï¼Œä½¿ç”¨<code>asyncio.run()</code>ä»£æ›¿ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">periodic</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hello every two seconds&#x27;</span>)<br>        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">2</span>)<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    task = asyncio.create_task(periodic())<br>    <span class="hljs-keyword">await</span> task  <span class="hljs-comment"># è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿™è¡Œå®é™…ä¸Šæ°¸è¿œä¸ä¼šç»“æŸï¼Œå› ä¸ºperiodicæ˜¯æ— é™å¾ªç¯çš„ã€‚</span><br><br><span class="hljs-comment"># ç›´æ¥è¿è¡Œmainåç¨‹æ–¹æ³•è€Œä¸éœ€è¦è·å–äº‹ä»¶å¾ªç¯</span><br>asyncio.run(main())<br></code></pre></td></tr></table></figure><p>åœ¨æ­¤é‡æ„åçš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>main</code>å¼‚æ­¥å‡½æ•°ï¼Œç„¶åä½¿ç”¨<code>asyncio.run(main())</code>å¯åŠ¨äº‹ä»¶å¾ªç¯å¹¶æ‰§è¡Œ<code>main</code>ã€‚è¿™æ ·å°±é¿å…äº†ç›´æ¥ä¸äº‹ä»¶å¾ªç¯APIäº¤äº’çš„éœ€è¦ã€‚</p><h3 id="asyncio-create-task"><a href="#asyncio-create-task" class="headerlink" title="asyncio.create_task()"></a>asyncio.create_task()</h3><p>æ˜¯ç”¨æ¥è°ƒåº¦æ‰§è¡Œä¸€ä¸ªåç¨‹ä»»åŠ¡ï¼ˆcoroutineï¼‰çš„å‡½æ•°ã€‚å½“ä½ æœ‰ä¸€ä¸ªåç¨‹å‡½æ•°ï¼Œä¸”ä½ æƒ³è¦å®ƒåœ¨åå°å¹¶å‘ï¼ˆasynchronouslyï¼‰è¿è¡Œæ—¶ï¼Œä½ å¯ä»¥é€šè¿‡ <code>asyncio.create_task()</code> å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼ˆTaskï¼‰ã€‚</p><p>ä»»åŠ¡æ˜¯å¯¹åç¨‹çš„ä¸€ç§åŒ…è£…ï¼Œå®ƒå…è®¸åç¨‹åœ¨äº‹ä»¶å¾ªç¯ä¸­å¹¶å‘æ‰§è¡Œã€‚å½“ä¸€ä¸ªä»»åŠ¡è¢«åˆ›å»ºæ—¶ï¼Œå®ƒå°†ä¼šè¢«ç«‹å³è°ƒåº¦æ‰§è¡Œï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ‰‹åŠ¨çš„æŒ‚èµ·æ“ä½œï¼ˆä¾‹å¦‚ä½¿ç”¨ <code>await</code> å…³é”®å­—ï¼‰ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥åœ¨ä¸é˜»å¡å½“å‰æ‰§è¡Œçš„åç¨‹çš„æƒ…å†µä¸‹å¯åŠ¨æ–°ä»»åŠ¡ã€‚</p><p>ä¸‹é¢æ˜¯ä½¿ç”¨ <code>asyncio.create_task()</code> çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">some_coroutine_function</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Do something asynchronously&#x27;</span>)<br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)  <span class="hljs-comment"># æ¨¡æ‹ŸI/Oæ“ä½œ</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Done&#x27;</span>)<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># åˆ›å»ºå¹¶å¼€å§‹ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡ä¼šè¿è¡Œ some_coroutine_function åç¨‹</span><br>    task = asyncio.create_task(some_coroutine_function())<br><br>    <span class="hljs-comment"># æ­¤å¤„å¯ä»¥æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œä»»åŠ¡å°†åœ¨åå°å¹¶å‘è¿è¡Œ</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Other code running concurrently&#x27;</span>)<br><br>    <span class="hljs-comment"># ç¨åï¼Œä¹Ÿè®¸åœ¨æŸä¸ªç‰¹å®šçš„æ—¶åˆ»ï¼Œä½ å¯èƒ½éœ€è¦ç­‰å¾…ä»»åŠ¡å®Œæˆ</span><br>    <span class="hljs-keyword">await</span> task<br><br><span class="hljs-comment"># è¿è¡Œmainå‡½æ•°æ¥æ‰§è¡Œåç¨‹</span><br>asyncio.run(main())<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>some_coroutine_function</code> æ˜¯ä¸€ä¸ªåç¨‹å‡½æ•°ã€‚åœ¨ <code>main</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>asyncio.create_task()</code> æ¥åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡åŒ…è£…äº† <code>some_coroutine_function</code> åç¨‹ã€‚<code>some_coroutine_function</code> å°†ä¼šå¹¶å‘æ‰§è¡Œï¼Œè¿™æ„å‘³ç€ <code>main</code> åŠŸèƒ½ä¸­ <code>print(&#39;Other code running concurrently&#39;)</code> çš„æ‰§è¡Œä¸ä¼šè¢«å»¶è¿Ÿã€‚æˆ‘ä»¬è¿˜å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™é€šè¿‡ <code>await task</code> æ¥ç­‰å¾…ä»»åŠ¡å®Œæˆã€‚</p><p><code>asyncio.create_task()</code> æ˜¯ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„æ–¹å¼æ¥å®ç°ä»£ç çš„å¹¶è¡Œæ‰§è¡Œï¼Œç‰¹åˆ«æ˜¯å½“ä½ æœ‰å¤šä¸ªåç¨‹éœ€è¦è¿è¡Œï¼Œå¹¶ä¸”ä¸å¸Œæœ›å®ƒä»¬ç›¸äº’é˜»å¡æ—¶ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-comment"># å®šä¹‰ç¬¬ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å‡½æ•°</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">task1</span>():<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Task 1 - Iteration &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(i))<br>        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># å®šä¹‰ç¬¬äºŒä¸ªå¼‚æ­¥ä»»åŠ¡å‡½æ•°</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">task2</span>():<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Task 2 - Iteration &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(i))<br>        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># å®šä¹‰ä¸»å‡½æ•°ï¼Œå®ƒå°†åˆ›å»ºå¹¶è¿è¡Œä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªä»»åŠ¡</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># åˆ›å»ºä»»åŠ¡ä½†ä¸ç­‰å¾…å®ƒå®Œæˆ</span><br>    task_1 = asyncio.create_task(task1())<br>    task_2 = asyncio.create_task(task2())<br><br>    <span class="hljs-comment"># ç­‰å¾…ä»»åŠ¡1å®Œæˆ</span><br>    <span class="hljs-keyword">await</span> task_1<br>    <span class="hljs-comment"># ç­‰å¾…ä»»åŠ¡2å®Œæˆ</span><br>    <span class="hljs-keyword">await</span> task_2<br><br><span class="hljs-comment"># ä½¿ç”¨asyncio.run()æ¥è¿è¡Œä¸»å‡½æ•°ï¼Œå¹¶å¯åŠ¨æ‰€æœ‰åç¨‹</span><br>asyncio.run(main())<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼š</p><ul><li><code>task1()</code> å’Œ <code>task2()</code> éƒ½æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œå®ƒä»¬ä½¿ç”¨<code>await asyncio.sleep(1)</code>æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œä¾‹å¦‚I&#x2F;Oæ“ä½œï¼Œä½¿å¾—æ¯ä¸ªè¿­ä»£ä¹‹é—´æœ‰1ç§’çš„å»¶è¿Ÿã€‚</li><li>åœ¨<code>main()</code>å†…éƒ¨ï¼Œæˆ‘ä»¬é€šè¿‡<code>asyncio.create_task()</code>å‡½æ•°åˆ›å»ºäº†ä¸¤ä¸ªä»»åŠ¡ï¼Œå¹¶ç«‹åˆ»å¯åŠ¨å®ƒä»¬ã€‚è¿™ä¸¤ä¸ªä»»åŠ¡ä¼šåœ¨äº‹ä»¶å¾ªç¯ä¸­å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œã€‚</li><li>æœ€åæˆ‘ä»¬ä½¿ç”¨<code>await</code>ï¼Œåœ¨<code>main()</code>å‡½æ•°ä¸­ç­‰å¾…æ¯ä¸ªä»»åŠ¡å®Œæˆã€‚è¯·æ³¨æ„ï¼Œåœ¨ä»»åŠ¡åˆ›å»ºåï¼Œå®ƒä»¬å·²ç»ç«‹å³å¼€å§‹æ‰§è¡Œäº†ï¼Œå³ä½¿æˆ‘ä»¬åœ¨<code>main()</code>åé¢çš„ä»£ç è¿˜æ²¡æœ‰åˆ°è¾¾<code>await</code>ã€‚</li></ul><p>åœ¨è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼Œä½ ä¼šæ³¨æ„åˆ°â€Task 1â€å’Œâ€Task 2â€çš„è¾“å‡ºæ˜¯äº¤é”™çš„ï¼Œå› ä¸ºä¸¤ä¸ªä»»åŠ¡æ˜¯åŒæ—¶è¿è¡Œçš„ï¼Œå®ƒä»¬å„è‡ªçš„è¿­ä»£ä¸ä¼šç›¸äº’é˜»å¡ã€‚</p><h3 id="asyncio-gather"><a href="#asyncio-gather" class="headerlink" title="asyncio.gather()"></a>asyncio.gather()</h3><p><code>asyncio.gather()</code> æ˜¯ä¸€ä¸ªç”¨æ¥å¹¶å‘è¿è¡Œå¤šä¸ªåç¨‹çš„å‡½æ•°ï¼Œå¹¶ä¸”ç­‰å¾…æ‰€æœ‰åç¨‹å®Œæˆã€‚è¿™ä¸ªå‡½æ•°æ¥å—ä¸€ç³»åˆ—çš„åç¨‹æˆ–futureå¯¹è±¡ï¼Œç„¶ååŒæ—¶ï¼ˆconcurrentlyï¼‰è¿è¡Œå®ƒä»¬ã€‚å½“æ‰€æœ‰çš„åç¨‹å‡è¿è¡Œå®Œæ¯•åï¼Œ<code>gather()</code> ä¼šæ”¶é›†å¹¶è¿”å›æ‰€æœ‰åç¨‹çš„ç»“æœã€‚</p><p>åˆ©ç”¨ <code>asyncio.gather()</code> æ¥é‡å†™ä¸Šé¢çš„ä¾‹å­ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">task1</span>():<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Task 1 - Iteration &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(i))<br>        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">task2</span>():<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Task 2 - Iteration &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(i))<br>        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># ä½¿ç”¨ asyncio.gather() æ¥å¹¶å‘è¿è¡Œä¸¤ä¸ªåç¨‹</span><br>    <span class="hljs-keyword">await</span> asyncio.gather(<br>        task1(),<br>        task2()<br>    )<br><br><span class="hljs-comment"># ä½¿ç”¨ asyncio.run() è¿è¡Œä¸»å‡½æ•°</span><br>asyncio.run(main())<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸å‰é¢ä½¿ç”¨ <code>asyncio.create_task()</code> çš„ä¾‹å­ç›¸æ¯”ï¼Œæœ€å¤§çš„ä¸åŒåœ¨äºè¿™é‡Œæˆ‘ä»¬ç›´æ¥å°†ä¸¤ä¸ªåç¨‹ä¼ é€’ç»™äº† <code>asyncio.gather()</code>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼åˆ›å»ºä»»åŠ¡ï¼Œ<code>asyncio.gather()</code> å†…éƒ¨ä¼šå¤„ç†è¿™äº›ã€‚</p><p>æ­¤ç§æ–¹å¼ä¹Ÿä¼šä½¿å¾—â€Task 1â€å’Œâ€Task 2â€çš„è¾“å‡ºæ˜¯äº¤é”™çš„ï¼Œå› ä¸º<code>task1()</code>å’Œ<code>task2()</code>åç¨‹ä¼šè¢«å¹¶å‘æ‰§è¡Œã€‚</p><p><code>asyncio.gather()</code> ä¸ä»…èƒ½å¼‚æ­¥æ‰§è¡Œåç¨‹ï¼Œè¿˜èƒ½ç­‰å¾…æ‰€æœ‰åç¨‹å®Œæˆå¹¶ä¸”å¯ä»¥è·å–æ¯ä¸ªåç¨‹è¿”å›çš„ç»“æœã€‚è¿™åœ¨ä½ éœ€è¦æ”¶é›†å¤šä¸ª<strong>åç¨‹è¿”å›å€¼æ—¶ç‰¹åˆ«æœ‰ç”¨</strong>ã€‚</p><h3 id="asyncioå¦å¤–æ¯”è¾ƒé‡è¦çš„å‡½æ•°"><a href="#asyncioå¦å¤–æ¯”è¾ƒé‡è¦çš„å‡½æ•°" class="headerlink" title="asyncioå¦å¤–æ¯”è¾ƒé‡è¦çš„å‡½æ•°"></a>asyncioå¦å¤–æ¯”è¾ƒé‡è¦çš„å‡½æ•°</h3><p><code>asyncio</code> æ¨¡å—æä¾›äº†è®¸å¤šæœ‰ç”¨çš„å‡½æ•°å’Œç‰¹æ€§æ¥ç¼–å†™å¼‚æ­¥ä»£ç ã€‚é™¤äº† <code>asyncio.create_task()</code> å’Œ <code>asyncio.gather()</code> ä¹‹å¤–ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å…¶ä»–é‡è¦çš„ <code>asyncio</code> å‡½æ•°:</p><ol><li><strong>asyncio.run(coro)</strong>: è¿™æ˜¯å¯åŠ¨é«˜å±‚çº§å¼‚æ­¥ç¨‹åºçš„ä¸»å…¥å£ç‚¹ã€‚å®ƒè¿è¡Œä¼ å…¥çš„åç¨‹(coroutine)ï¼Œè´Ÿè´£ç®¡ç†äº‹ä»¶å¾ªç¯ï¼Œæœ€åå…³é—­äº‹ä»¶å¾ªç¯ã€‚ä» Python 3.7 ç‰ˆæœ¬å¼€å§‹å¼•å…¥ã€‚</li><li><strong>asyncio.sleep(delay, result&#x3D;None)</strong>: ä¼‘çœ æŒ‡å®šçš„ç§’æ•°ã€‚<code>result</code> å‚æ•°æ˜¯åœ¨ä¼‘çœ ç»“æŸæ—¶è¿”å›çš„å€¼ï¼Œé€šå¸¸ç”¨äºæ¨¡æ‹Ÿ IO ç»‘å®šæ“ä½œæˆ–è€…ç®€å•çš„è¿›è¡Œæ—¶é—´å»¶è¿Ÿã€‚</li><li><strong>asyncio.wait(fs, *, timeout&#x3D;None, return_when&#x3D;ALL_COMPLETED)</strong>: å¹¶å‘è¿è¡Œä¼ å…¥çš„åç¨‹æˆ– Future å®ä¾‹(fs)ï¼Œç›´åˆ°æ»¡è¶³æŒ‡å®šæ¡ä»¶ã€‚<code>return_when</code> å‚æ•°å¯ä»¥è‡ªå®šä¹‰ä¸º <code>FIRST_COMPLETED</code>, <code>FIRST_EXCEPTION</code>, æˆ– <code>ALL_COMPLETED</code> ç­‰ã€‚</li><li><strong>asyncio.wait_for(fut, timeout, *, loop&#x3D;None)</strong>: å¯¹ä¸€ä¸ªåç¨‹æˆ– future å®ä¾‹è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚å¦‚æœè¶…å‡ºè®¾å®šæ—¶é—´ï¼Œä»»åŠ¡å°†è¢«å–æ¶ˆã€‚</li><li><strong>asyncio.as_completed(fs, *, timeout&#x3D;None, loop&#x3D;None)</strong>: ç”¨äºå¼‚æ­¥è¿­ä»£ä¼ å…¥çš„åç¨‹æˆ– future å®ä¾‹ï¼Œä¸€æ—¦å…¶ä¸­ä¸€ä¸ªå®Œæˆäº†ï¼Œå®ƒå°±ä¼šè¢« yield å‡ºæ¥ã€‚</li><li><strong>asyncio.get_event_loop()</strong>: è·å–å½“å‰ä¸Šä¸‹æ–‡çš„äº‹ä»¶å¾ªç¯ã€‚</li><li><strong>asyncio.set_event_loop(loop)</strong>: è®¾ç½®å½“å‰ä¸Šä¸‹æ–‡çš„äº‹ä»¶å¾ªç¯ã€‚</li><li><strong>asyncio.open_connection(host&#x3D;None, port&#x3D;None, <em>, loop&#x3D;None, limit&#x3D;None,</em> kwds)</strong>: æ‰“å¼€ TCP è¿æ¥å¹¶å›ä¼ ä¸€ä¸ªäºŒå…ƒç»„ <code>(reader, writer)</code>ï¼Œè¿™å¯ä»¥ç”¨æ¥è¿›è¡Œéé˜»å¡çš„ç½‘ç»œé€šä¿¡ã€‚</li><li><strong>asyncio.run_coroutine_threadsafe(coro, loop)</strong>: å®‰æ’åœ¨ç”± <code>loop</code> æŒ‡å®šçš„äº‹ä»¶å¾ªç¯ä¸­è¿è¡Œ <code>coro</code>ï¼Œå¹¶ä¸”é€‚åˆäºä»ä¸åŒçº¿ç¨‹è°ƒç”¨ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ã€‚è¿”å›ä¸€ä¸ª <code>concurrent.futures.Future</code>ï¼Œå¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­ç­‰å¾…åç¨‹çš„ç»“æœã€‚</li><li><strong>asyncio.Lock</strong>&#x2F;<strong>asyncio.Event</strong>&#x2F;<strong>asyncio.Condition</strong>&#x2F;<strong>asyncio.Semaphore</strong>: è¿™äº›æ˜¯ asyncio ç‰ˆçš„åŒæ­¥åŸè¯­(synchronization primitives) ç±»ï¼Œå¯ä»¥ç”¨æ¥åœ¨ä¸åŒåç¨‹ä¸­è¿›è¡ŒåŒæ­¥ã€‚</li></ol><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨äº† <code>asyncio.wait</code> å’Œ <code>asyncio.as_completed</code> çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">my_coroutine</span>(<span class="hljs-params">i</span>):<br>    <span class="hljs-keyword">await</span> asyncio.sleep(i)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;coroutine <span class="hljs-subst">&#123;i&#125;</span> has finished&quot;</span><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªåç¨‹åˆ—è¡¨</span><br>    coroutines = [my_coroutine(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)]<br><br>    <span class="hljs-comment"># ä½¿ç”¨ asyncio.wait å¹¶å‘è¿è¡Œï¼Œå¹¶ç­‰å¾…æ‰€æœ‰å®Œæˆ</span><br>    done, pending = <span class="hljs-keyword">await</span> asyncio.wait(coroutines)<br>    <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> done:<br>        <span class="hljs-built_in">print</span>(task.result())<br><br>    <span class="hljs-comment"># ä½¿ç”¨ asyncio.as_completed è·å–æ¯ä¸ªåç¨‹çš„å®Œæˆé¡ºåº</span><br>    <span class="hljs-keyword">for</span> coro <span class="hljs-keyword">in</span> asyncio.as_completed(coroutines):<br>        result = <span class="hljs-keyword">await</span> coro<br>        <span class="hljs-built_in">print</span>(result)<br><br><span class="hljs-comment"># è¿è¡Œ main å‡½æ•°</span><br>asyncio.run(main())<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­é¦–å…ˆå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>asyncio.wait</code> å¹¶å‘è¿è¡Œåç¨‹å¹¶ç­‰å¾…æ‰€æœ‰å®Œæˆã€‚æ¥ç€ï¼Œç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>asyncio.as_completed</code> æŒ‰å®Œæˆé¡ºåºè·å–åç¨‹ç»“æœã€‚</p><h2 id="pythonçš„åç¨‹å‘å¾ˆå¤š"><a href="#pythonçš„åç¨‹å‘å¾ˆå¤š" class="headerlink" title="pythonçš„åç¨‹å‘å¾ˆå¤š"></a>pythonçš„åç¨‹å‘å¾ˆå¤š</h2><p>åœ¨åç¨‹ä¸­ç”¨åˆ°aiohttpå»è·å–æ•°æ®ï¼Œç„¶ååˆ†æï¼Œåˆ†ææ˜¯è€—æ—¶çš„ï¼Œè¿™æœ‰å¯èƒ½å¯¼è‡´aiohttpè‡ªåŠ¨è¶…æ—¶ï¼</p><p>åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨asyncioæ—¶ï¼Œæ‰€æœ‰çš„åç¨‹éƒ½æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ä¸Šè¿è¡Œçš„ã€‚è¿™ä¸ªäº‹ä»¶å¾ªç¯è´Ÿè´£è°ƒåº¦å’Œæ‰§è¡Œæ‰€æœ‰çš„åç¨‹ã€‚å½“ä¸€ä¸ªåç¨‹æ­£åœ¨è¿è¡Œæ—¶ï¼Œå®ƒå¿…é¡»åœ¨æŸä¸ªç‚¹ä¸Šè®©æ­¥ç»™å…¶å®ƒåç¨‹ï¼Œä½¿å¾—å®ƒä»¬ä¹Ÿæœ‰æœºä¼šæ‰§è¡Œã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡awaitè¡¨è¾¾å¼å®ç°çš„ï¼Œæ­¤æ—¶äº‹ä»¶å¾ªç¯å¯ä»¥æŒ‚èµ·å½“å‰åç¨‹ï¼Œå¹¶æ¢å¤å¦ä¸€ä¸ªã€‚</p><p>å¦‚æœä¸€ä¸ªåç¨‹ä¸­æœ‰ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„éå¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚å¤æ‚çš„åŒæ­¥æ•°æ®å¤„ç†æˆ–è®¡ç®—ï¼Œå®ƒå°†ä¿æŒå¯¹å½“å‰çº¿ç¨‹çš„å ç”¨ï¼Œå› ä¸ºå®ƒæ²¡æœ‰æš‚åœæˆ–è®©å‡ºæ§åˆ¶æƒç»™äº‹ä»¶å¾ªç¯ã€‚åœ¨è¿™ä¸€é•¿æœŸæ“ä½œå®Œæˆå‰ï¼Œä¸ä¼šæœ‰å…¶ä»–ä»»ä½•åç¨‹å¾—åˆ°æ‰§è¡Œâ€”â€”åŒ…æ‹¬ç½‘ç»œI&#x2F;Oæ“ä½œã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæ‰§è¡Œhttpè¯·æ±‚çš„åç¨‹ç­‰å¾…è¢«å¤„ç†ï¼Œå®ƒå°†è¢«æ¨è¿Ÿï¼Œç›´åˆ°è€—æ—¶çš„åç¨‹å®Œæˆå…¶æ“ä½œå¹¶æš‚åœæˆ–ç»“æŸã€‚</p><p><strong>å› æ­¤ï¼Œå¦‚æœä½ åœ¨è¯·æ±‚å“åº”åˆ°æ¥åç«‹å³è¿›è¡Œä¸€ä¸ªè€—æ—¶çš„æ“ä½œï¼Œå¹¶ä¸”ä½ æ­£åœ¨ç­‰å¾…çš„å¦ä¸€ä¸ªå¼‚æ­¥httpè¯·æ±‚ï¼ˆå®ƒä¾èµ–äºäº‹ä»¶å¾ªç¯æ¥æ£€æµ‹ä»€ä¹ˆæ—¶å€™æ¥æ”¶åˆ°å“åº”æ•°æ®ï¼‰ï¼Œç”±äºäº‹ä»¶å¾ªç¯æ­£å¿™äºè¿è¡Œè€—æ—¶çš„ä»»åŠ¡ï¼Œè¯·æ±‚å¯èƒ½ä¼šè¶…æ—¶ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è¶³å¤Ÿå¿«åœ°é‡æ–°è·å¾—äº‹ä»¶å¾ªç¯çš„æ§åˆ¶æƒæ¥å¤„ç†å“åº”ã€‚</strong></p><p>è¦é¿å…è¿™ç§æƒ…å†µï¼Œä½ å¯ä»¥å°†è€—æ—¶çš„å¤„ç†æ“ä½œç§»å‡ºå…³é”®çš„å¼‚æ­¥è·¯å¾„ï¼Œæ¯”å¦‚ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼æ¥å¤„ç†æ•°æ®ã€æŠŠå®ƒä»¬æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¾›å¦ä¸€ä¸ªåç¨‹å¤„ç†ï¼Œæˆ–è€…ä½¿ç”¨ <strong>asyncio.run_in_executor</strong> å°†å®ƒä»¬ç§»å…¥å¦ä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹ã€‚è¿™æ ·å°±ä½¿äº‹ä»¶å¾ªç¯å¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–åç¨‹ï¼Œæ¯”å¦‚å‘èµ·å’Œæ¥æ”¶httpè¯·æ±‚ï¼Œä»è€Œé¿å…äº†è¶…æ—¶é—®é¢˜ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python å†…å­˜åˆ†æ</title>
    <link href="/2025/04/30/Python-%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90/"/>
    <url>/2025/04/30/Python-%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p><code>memory_profiler</code> æ˜¯ä¸€ä¸ª Python æ¨¡å—ï¼Œç”¨äºç›‘æ§å’Œåˆ†æ Python ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨ <code>memory_profiler</code> çš„åŸºæœ¬ç¤ºä¾‹ã€‚</p><h3 id="å®‰è£…-memory-profiler"><a href="#å®‰è£…-memory-profiler" class="headerlink" title="å®‰è£… memory_profiler"></a>å®‰è£… <code>memory_profiler</code></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦å®‰è£… <code>memory_profiler</code> æ¨¡å—ã€‚ä½ å¯ä»¥ä½¿ç”¨ pip æ¥å®‰è£…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install memory_profiler<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>memory_profiler</code> æ¥åˆ†æå‡½æ•°çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> memory_profiler <span class="hljs-keyword">import</span> profile<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-meta">@profile</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_function</span>():<br>    a = [<span class="hljs-number">1</span>] * (<span class="hljs-number">10</span>**<span class="hljs-number">6</span>)<br>    time.sleep(<span class="hljs-number">2</span>)<br>    b = [<span class="hljs-number">2</span>] * (<span class="hljs-number">2</span> * <span class="hljs-number">10</span>**<span class="hljs-number">7</span>)<br>    time.sleep(<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">del</span> b<br>    time.sleep(<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">return</span> a<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    my_function()<br></code></pre></td></tr></table></figure><h3 id="è¿è¡Œç¤ºä¾‹"><a href="#è¿è¡Œç¤ºä¾‹" class="headerlink" title="è¿è¡Œç¤ºä¾‹"></a>è¿è¡Œç¤ºä¾‹</h3><p>ä¿å­˜ä¸Šé¢çš„ä»£ç åˆ°ä¸€ä¸ª Python æ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚ <code>memory_test.py</code>ï¼‰ï¼Œç„¶åè¿è¡Œè¯¥æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python memory_test.py<br></code></pre></td></tr></table></figure><h3 id="è§£é‡Šè¾“å‡º"><a href="#è§£é‡Šè¾“å‡º" class="headerlink" title="è§£é‡Šè¾“å‡º"></a>è§£é‡Šè¾“å‡º</h3><p><code>memory_profiler</code> ä¼šç”Ÿæˆç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plain">Filename: memory_test.py<br><br>Line #    Mem usage    Increment  Occurrences   Line Contents<br>=============================================================<br>     4     17.4 MiB     17.4 MiB           1   @profile<br>     5                                         def my_function():<br>     6     24.6 MiB      7.2 MiB           1       a = [1] * (10**6)<br>     7     24.6 MiB      0.0 MiB           1       time.sleep(2)<br>     8    176.0 MiB    151.4 MiB           1       b = [2] * (2 * 10**7)<br>     9    176.0 MiB      0.0 MiB           1       time.sleep(2)<br>    10     24.6 MiB   -151.4 MiB           1       del b<br>    11     24.6 MiB      0.0 MiB           1       time.sleep(2)<br>    12     24.6 MiB      0.0 MiB           1       return a<br></code></pre></td></tr></table></figure><h3 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h3><ul><li><strong>Mem usage</strong>: å†…å­˜ä½¿ç”¨é‡</li><li><strong>Increment</strong>: å†…å­˜å¢é‡</li><li><strong>Occurrences</strong>: è¯¥è¡Œä»£ç æ‰§è¡Œçš„æ¬¡æ•°</li><li><strong>Line Contents</strong>: ä»£ç è¡Œ</li></ul><p>è¿™ä¸ªè¾“å‡ºæ˜¾ç¤ºäº†æ¯è¡Œä»£ç æ‰§è¡Œå‰åçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠæ¯è¡Œä»£ç çš„å†…å­˜ä½¿ç”¨å¢é‡ã€‚è¿™å¯¹äºè¯†åˆ«å†…å­˜æ³„æ¼å’Œä¼˜åŒ–å†…å­˜ä½¿ç”¨éå¸¸æœ‰ç”¨ã€‚</p><h3 id="å®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨"><a href="#å®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨" class="headerlink" title="å®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨"></a>å®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨</h3><p>é™¤äº†ä½¿ç”¨è£…é¥°å™¨å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>memory_profiler</code> è¿›è¡Œå®æ—¶å†…å­˜ä½¿ç”¨ç›‘æ§ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> memory_profiler <span class="hljs-keyword">import</span> memory_usage<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_function</span>():<br>    a = [<span class="hljs-number">1</span>] * (<span class="hljs-number">10</span>**<span class="hljs-number">6</span>)<br>    time.sleep(<span class="hljs-number">2</span>)<br>    b = [<span class="hljs-number">2</span>] * (<span class="hljs-number">2</span> * <span class="hljs-number">10</span>**<span class="hljs-number">7</span>)<br>    time.sleep(<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">del</span> b<br>    time.sleep(<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">return</span> a<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    mem_usage = memory_usage(my_function)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Memory usage over time: <span class="hljs-subst">&#123;mem_usage&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸Šè¿°ä»£ç ï¼Œä¼šæ‰“å°å‡º <code>my_function</code> æ‰§è¡ŒæœŸé—´çš„å†…å­˜ä½¿ç”¨æƒ…å†µåˆ—è¡¨ã€‚</p><p>è¿™äº›ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>memory_profiler</code> æ¥åˆ†æå’Œç›‘æ§ Python ç¨‹åºçš„å†…å­˜ä½¿ç”¨ã€‚æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨è£…é¥°å™¨æˆ–å®æ—¶ç›‘æ§æ–¹æ³•ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nc å‘½ä»¤</title>
    <link href="/2025/04/28/nc-%E5%91%BD%E4%BB%A4/"/>
    <url>/2025/04/28/nc-%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<p><code>nc</code> å‘½ä»¤ï¼ˆä¹Ÿç§°ä¸º â€œnetcatâ€ï¼‰æ˜¯ä¸€ä¸ªç½‘ç»œå·¥å…·ï¼Œä¸»è¦ç”¨äºè¯»å†™ç½‘ç»œè¿æ¥ã€‚å®ƒå¯ä»¥åœ¨ TCP æˆ– UDP åè®®ä¸Šè¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œå…·æœ‰å¤šç§ç”¨é€”ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„åŠŸèƒ½ï¼š</p><h3 id="ä¸»è¦åŠŸèƒ½"><a href="#ä¸»è¦åŠŸèƒ½" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a>ä¸»è¦åŠŸèƒ½</h3><ol><li><strong>ç«¯å£æ‰«æ</strong>:</li></ol><ul><li><ul><li>å¯ä»¥ç”¨æ¥æ‰«æç½‘ç»œä¸Šçš„å¼€æ”¾ç«¯å£ã€‚</li></ul></li></ul><ol><li><strong>æ•°æ®ä¼ è¾“</strong>:</li></ol><ul><li><ul><li>å…è®¸åœ¨ä¸¤ä¸ªä¸»æœºä¹‹é—´ä¼ è¾“æ•°æ®ï¼Œé€‚åˆç®€å•çš„æ–‡ä»¶ä¼ è¾“ã€‚</li></ul></li></ul><ol><li><strong>åˆ›å»ºåå‘ Shell</strong>:</li></ol><ul><li><ul><li>å¯ä»¥ç”¨äºåˆ›å»ºåå‘ shellï¼Œå¸¸ç”¨äºæµ‹è¯•å’Œè°ƒè¯•ã€‚</li></ul></li></ul><ol><li><strong>ç½‘ç»œè°ƒè¯•</strong>:</li></ol><ul><li><ul><li>å¯ç”¨äºæµ‹è¯•æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„è¿æ¥ã€‚</li></ul></li></ul><ol><li><strong>èŠå¤©åº”ç”¨</strong>:</li></ol><ul><li><ul><li>å¯ä»¥ç”¨ä½œç®€å•çš„èŠå¤©å·¥å…·ã€‚</li></ul></li></ul><h3 id="å¸¸è§ç”¨æ³•ç¤ºä¾‹"><a href="#å¸¸è§ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="å¸¸è§ç”¨æ³•ç¤ºä¾‹"></a>å¸¸è§ç”¨æ³•ç¤ºä¾‹</h3><ol><li><strong>å»ºç«‹ TCP è¿æ¥</strong>:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc &lt;hostname&gt; &lt;port&gt;<br></code></pre></td></tr></table></figure><ol><li><strong>ç›‘å¬ç«¯å£</strong>:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -l -p &lt;port&gt;<br></code></pre></td></tr></table></figure><ol><li><strong>ä¼ è¾“æ–‡ä»¶</strong>:</li></ol><ul><li><ul><li>åœ¨å‘é€æ–¹ï¼š</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -w 3 &lt;receiver_ip&gt; &lt;port&gt; &lt; filename<br></code></pre></td></tr></table></figure><ul><li><ul><li>åœ¨æ¥æ”¶æ–¹ï¼š</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -l -p &lt;port&gt; &gt; filename<br></code></pre></td></tr></table></figure><ol><li><strong>ç«¯å£æ‰«æ</strong>:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -zv &lt;hostname&gt; &lt;start_port&gt;-&lt;end_port&gt;<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>nc</code> æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œé€‚ç”¨äºç½‘ç»œè°ƒè¯•å’Œæ•°æ®ä¼ è¾“ï¼Œä½†è¯·æ³¨æ„ï¼Œä½¿ç”¨æ—¶è¦éµå¾ªç½‘ç»œå®‰å…¨å’Œåˆè§„æ€§è§„èŒƒã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux å¼€æœºæµç¨‹</title>
    <link href="/2025/04/14/Linux-%E5%BC%80%E6%9C%BA%E6%B5%81%E7%A8%8B/"/>
    <url>/2025/04/14/Linux-%E5%BC%80%E6%9C%BA%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h3 id="ğŸ§ -Linux-å¼€æœºæµç¨‹æ€»ä½“åˆ†ä¸º-4-ä¸ªé˜¶æ®µï¼š"><a href="#ğŸ§ -Linux-å¼€æœºæµç¨‹æ€»ä½“åˆ†ä¸º-4-ä¸ªé˜¶æ®µï¼š" class="headerlink" title="ğŸ§  Linux å¼€æœºæµç¨‹æ€»ä½“åˆ†ä¸º 4 ä¸ªé˜¶æ®µï¼š"></a>ğŸ§  <strong>Linux å¼€æœºæµç¨‹æ€»ä½“åˆ†ä¸º 4 ä¸ªé˜¶æ®µï¼š</strong></h3><hr><h4 id="ç¬¬ä¸€é˜¶æ®µï¼šBIOS-UEFI-åˆå§‹åŒ–"><a href="#ç¬¬ä¸€é˜¶æ®µï¼šBIOS-UEFI-åˆå§‹åŒ–" class="headerlink" title="ç¬¬ä¸€é˜¶æ®µï¼šBIOS&#x2F;UEFI åˆå§‹åŒ–"></a><strong>ç¬¬ä¸€é˜¶æ®µï¼šBIOS&#x2F;UEFI åˆå§‹åŒ–</strong></h4><ul><li><p>ğŸ”Œ <strong>è§¦å‘ç‚¹</strong>ï¼šæŒ‰ä¸‹ç”µæºé”®</p></li><li><p>ğŸ“¦ <strong>å·¥ä½œå†…å®¹</strong>ï¼š</p></li><li><ul><li>åŠ è½½ <strong>BIOS&#x2F;UEFI</strong>ï¼Œæ‰§è¡Œç¡¬ä»¶è‡ªæ£€ï¼ˆPOSTï¼‰</li><li>è¯»å–å¯åŠ¨é¡ºåºï¼Œæ‰¾åˆ°<strong>ç¬¬ä¸€ä¸ªå¯å¯åŠ¨è®¾å¤‡</strong></li></ul></li><li><p>ğŸ’¥ <strong>å¸¸è§é—®é¢˜ç‚¹</strong>ï¼š</p></li><li><ul><li>æ‰¾ä¸åˆ°å¯åŠ¨è®¾å¤‡ï¼ˆBIOS è®¾ç½®é”™ï¼‰</li><li>ç¡¬ä»¶æ£€æµ‹å¤±è´¥ï¼ˆå†…å­˜æ¡æ²¡æ’å¥½ç­‰ï¼‰</li></ul></li></ul><hr><h4 id="ç¬¬äºŒé˜¶æ®µï¼šBoot-Loaderï¼ˆå¦‚-grub2ï¼‰åŠ è½½"><a href="#ç¬¬äºŒé˜¶æ®µï¼šBoot-Loaderï¼ˆå¦‚-grub2ï¼‰åŠ è½½" class="headerlink" title="ç¬¬äºŒé˜¶æ®µï¼šBoot Loaderï¼ˆå¦‚ grub2ï¼‰åŠ è½½"></a><strong>ç¬¬äºŒé˜¶æ®µï¼šBoot Loaderï¼ˆå¦‚ grub2ï¼‰åŠ è½½</strong></h4><ul><li><p>ğŸ” <strong>ä»å¯åŠ¨è®¾å¤‡è¯»å– MBR æˆ– EFI åŒºå—</strong></p></li><li><p>ğŸš€ <strong>Boot Loader åŠŸèƒ½</strong>ï¼š</p></li><li><ul><li>æä¾›å¯åŠ¨èœå•</li><li>é€‰æ‹©å¹¶åŠ è½½å¯¹åº”çš„ Linux <strong>å†…æ ¸ï¼ˆvmlinuzï¼‰</strong></li></ul></li><li><p>ğŸ’¥ <strong>å¸¸è§é—®é¢˜ç‚¹</strong>ï¼š</p></li><li><ul><li>grub é…ç½®é”™è¯¯</li><li>MBR æŸåæˆ–è¢«è¦†ç›–ï¼ˆå®‰è£… Windows åï¼‰</li></ul></li></ul><hr><h4 id="ç¬¬ä¸‰é˜¶æ®µï¼šå†…æ ¸åŠ è½½ï¼ˆKernelï¼‰"><a href="#ç¬¬ä¸‰é˜¶æ®µï¼šå†…æ ¸åŠ è½½ï¼ˆKernelï¼‰" class="headerlink" title="ç¬¬ä¸‰é˜¶æ®µï¼šå†…æ ¸åŠ è½½ï¼ˆKernelï¼‰"></a><strong>ç¬¬ä¸‰é˜¶æ®µï¼šå†…æ ¸åŠ è½½ï¼ˆKernelï¼‰</strong></h4><ul><li><p>ğŸ§¬ <strong>åŠŸèƒ½</strong>ï¼š</p></li><li><ul><li>å†…æ ¸è§£å‹ç¼©åˆ°å†…å­˜ä¸­ï¼Œå¼€å§‹è¿è¡Œ</li><li>è¯†åˆ«ç¡¬ä»¶ä¿¡æ¯ï¼ŒåŠ è½½ç›¸åº”é©±åŠ¨</li></ul></li><li><p>ğŸ”§ <strong>è¾“å‡º</strong>ï¼šè¿›å…¥ä¸€ä¸ªã€Œæœ€ç²¾ç®€çš„æ“ä½œç³»ç»Ÿã€</p></li><li><p>ğŸ’¥ <strong>å¸¸è§é—®é¢˜ç‚¹</strong>ï¼š</p></li><li><ul><li>æ‰¾ä¸åˆ°æ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆrootfsï¼‰</li><li>initramfs é”™è¯¯å¯¼è‡´å†…æ ¸ panic</li></ul></li></ul><hr><h4 id="ç¬¬å››é˜¶æ®µï¼šç”¨æˆ·ç©ºé—´åˆå§‹åŒ–ï¼ˆsystemdï¼‰"><a href="#ç¬¬å››é˜¶æ®µï¼šç”¨æˆ·ç©ºé—´åˆå§‹åŒ–ï¼ˆsystemdï¼‰" class="headerlink" title="ç¬¬å››é˜¶æ®µï¼šç”¨æˆ·ç©ºé—´åˆå§‹åŒ–ï¼ˆsystemdï¼‰"></a><strong>ç¬¬å››é˜¶æ®µï¼šç”¨æˆ·ç©ºé—´åˆå§‹åŒ–ï¼ˆsystemdï¼‰</strong></h4><ul><li>ğŸ§© <strong>ç”±å†…æ ¸å¯åŠ¨</strong> systemdï¼ˆä»¥å‰æ˜¯ initï¼‰</li><li>ğŸ§­ <strong>æ‰§è¡Œæµç¨‹</strong>ï¼ˆtarget æ˜¯ systemd çš„é˜¶æ®µå®šä¹‰ï¼‰ï¼š</li></ul><ol><li><ol><li><code>sysinit.target</code>ï¼šåŸºç¡€åˆå§‹åŒ–ï¼ˆæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€è®¾ç½®æ—¶é’Ÿï¼‰</li><li><code>basic.target</code>ï¼šå‡†å¤‡ç³»ç»ŸåŸºç¡€åŠŸèƒ½ï¼ˆç½‘ç»œç­‰ï¼‰</li><li><code>multi-user.target</code>ï¼šå¯åŠ¨æœåŠ¡å™¨æœåŠ¡ï¼Œå¦‚ sshdã€network ç­‰</li><li><code>/etc/rc.local</code>ï¼šç”¨æˆ·è‡ªå®šä¹‰å¯åŠ¨è„šæœ¬</li><li><code>getty.target</code>ï¼šå¯åŠ¨ç»ˆç«¯ç™»å½•æœåŠ¡</li><li><code>graphical.target</code>ï¼šå›¾å½¢ç•Œé¢ï¼ˆè‹¥å®‰è£…æ¡Œé¢ç¯å¢ƒï¼‰</li></ol></li></ol><ul><li><p>ğŸ’¥ <strong>å¸¸è§é—®é¢˜ç‚¹</strong>ï¼š</p></li><li><ul><li>systemd é…ç½®é”™ã€æœåŠ¡å¯åŠ¨å¤±è´¥</li><li>æœåŠ¡ä¾èµ–é…ç½®é”™ï¼ˆå¯åŠ¨é¡ºåºé”™ï¼‰</li></ul></li></ul><hr><h3 id="âœ…-æ€»ç»“æˆä¸€å¥è¯ï¼š"><a href="#âœ…-æ€»ç»“æˆä¸€å¥è¯ï¼š" class="headerlink" title="âœ… æ€»ç»“æˆä¸€å¥è¯ï¼š"></a>âœ… <strong>æ€»ç»“æˆä¸€å¥è¯ï¼š</strong></h3><p>å¼€æœºæµç¨‹æ˜¯ä» BIOS â†’ Boot Loader â†’ å†…æ ¸åŠ è½½ â†’ systemd åˆå§‹åŒ–ï¼Œä¸€ç¯æ‰£ä¸€ç¯ï¼Œsystemd åœ¨åæœŸå æ¯”æœ€å¤§ï¼Œæ˜¯ç³»ç»Ÿèƒ½å¦æ­£å¸¸å¯åŠ¨çš„å…³é”®ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonå’ŒJava å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹çš„ä½¿ç”¨åœºæ™¯</title>
    <link href="/2025/04/12/Python%E5%92%8CJava-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E3%80%81%E5%A4%9A%E8%BF%9B%E7%A8%8B%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/"/>
    <url>/2025/04/12/Python%E5%92%8CJava-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E3%80%81%E5%A4%9A%E8%BF%9B%E7%A8%8B%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/</url>
    
    <content type="html"><![CDATA[<h2 id="ğŸ§ -ä¸€ã€Python-ä½¿ç”¨å¤šçº¿ç¨‹-or-å¤šè¿›ç¨‹çš„åˆ¤æ–­ä¾æ®"><a href="#ğŸ§ -ä¸€ã€Python-ä½¿ç”¨å¤šçº¿ç¨‹-or-å¤šè¿›ç¨‹çš„åˆ¤æ–­ä¾æ®" class="headerlink" title="ğŸ§  ä¸€ã€Python ä½¿ç”¨å¤šçº¿ç¨‹ or å¤šè¿›ç¨‹çš„åˆ¤æ–­ä¾æ®"></a>ğŸ§  ä¸€ã€Python ä½¿ç”¨å¤šçº¿ç¨‹ or å¤šè¿›ç¨‹çš„åˆ¤æ–­ä¾æ®</h2><table><thead><tr><th>åº”ç”¨åœºæ™¯</th><th>å»ºè®®ä½¿ç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>I&#x2F;O å¯†é›†å‹ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ã€æ•°æ®åº“æ“ä½œï¼‰</td><td>âœ… å¤šçº¿ç¨‹</td><td>çº¿ç¨‹åˆ‡æ¢å¼€é”€å°ï¼Œé€‚åˆç­‰å¾…å‹æ“ä½œ</td></tr><tr><td>CPU å¯†é›†å‹ï¼ˆå¦‚å‹ç¼©ã€åŠ å¯†ã€å›¾åƒå¤„ç†ã€ç®—æ³•ï¼‰</td><td>âœ… å¤šè¿›ç¨‹</td><td>é¿å¼€ GILï¼Œå¤šä¸ªè¿›ç¨‹å¯å¹¶å‘å æ»¡å¤šä¸ª CPU æ ¸å¿ƒ</td></tr><tr><td>ä»»åŠ¡éœ€éš”ç¦»ï¼ˆå¦‚è¿è¡Œä¸å—æ§åˆ¶çš„å·¥å…·&#x2F;è„šæœ¬ï¼‰</td><td>âœ… å¤šè¿›ç¨‹</td><td>ç‹¬ç«‹å†…å­˜ç©ºé—´ï¼Œæ›´å®‰å…¨ï¼Œäº’ä¸å½±å“</td></tr><tr><td>å¯åŠ¨å¤–éƒ¨ç¨‹åºï¼ˆå¦‚è°ƒç”¨ jarã€shellã€å·¥å…·ï¼‰</td><td>âœ… å¤šè¿›ç¨‹</td><td>å¤–éƒ¨ç¨‹åºæœ¬è´¨æ˜¯ç³»ç»Ÿè¿›ç¨‹ï¼Œæ— æ³•ç”¨çº¿ç¨‹è¡¨ç¤º</td></tr><tr><td>çŠ¶æ€å…±äº«å¤šï¼Œä»»åŠ¡é—´è€¦åˆé«˜</td><td>âœ… å¤šçº¿ç¨‹</td><td>å¯ç”¨å…±äº«å˜é‡ã€å¯¹è±¡åä½œå¤„ç†ä»»åŠ¡</td></tr><tr><td>å´©æºƒå½±å“å¤§ï¼Œå¸Œæœ›é”™è¯¯éš”ç¦»</td><td>âœ… å¤šè¿›ç¨‹</td><td>æŸä¸ªå­è¿›ç¨‹å´©æ‰ä¸ä¼šå½±å“ä¸»è¿›ç¨‹å’Œå…¶ä»–ä»»åŠ¡</td></tr></tbody></table><hr><h2 id="ğŸ§µ-äºŒã€è¯­è¨€å·®å¼‚å¯¹æ¯”ï¼šPython-vs-Java"><a href="#ğŸ§µ-äºŒã€è¯­è¨€å·®å¼‚å¯¹æ¯”ï¼šPython-vs-Java" class="headerlink" title="ğŸ§µ äºŒã€è¯­è¨€å·®å¼‚å¯¹æ¯”ï¼šPython vs Java"></a>ğŸ§µ äºŒã€è¯­è¨€å·®å¼‚å¯¹æ¯”ï¼šPython vs Java</h2><h3 id="1-Python"><a href="#1-Python" class="headerlink" title="1. Python"></a>1. <strong>Python</strong></h3><table><thead><tr><th>åœºæ™¯</th><th>å¤šçº¿ç¨‹è¡¨ç°</th><th>å¤šè¿›ç¨‹è¡¨ç°</th></tr></thead><tbody><tr><td>I&#x2F;O å¯†é›†å‹ä»»åŠ¡</td><td>âœ… é€‚åˆï¼Œèƒ½å……åˆ†åˆ©ç”¨çº¿ç¨‹åˆ‡æ¢</td><td>âŒ è¿›ç¨‹åˆ‡æ¢å¼€é”€å¤§ï¼Œæµªè´¹èµ„æº</td></tr><tr><td>CPU å¯†é›†å‹ä»»åŠ¡</td><td>âŒ GIL é™åˆ¶ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå­—èŠ‚ç </td><td>âœ… å¯å¼€å¯å¤šä¸ªè¿›ç¨‹ç»•è¿‡ GILï¼Œå ç”¨å¤šä¸ªæ ¸å¿ƒ</td></tr><tr><td>è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼ˆå¦‚ jar åŒ…ï¼‰</td><td>âœ… ç”¨çº¿ç¨‹è°ƒåº¦ï¼Œä½†æœ¬è´¨è¿˜æ˜¯å¼€è¿›ç¨‹</td><td>âœ… ç”¨ <code>multiprocessing</code> æ§åˆ¶å¤–éƒ¨è¿›ç¨‹æ•°æ›´å®‰å…¨</td></tr><tr><td>ä»»åŠ¡éš”ç¦»ã€é”™è¯¯å®¹å¿</td><td>âŒ çº¿ç¨‹å‡ºé”™å¯èƒ½å½±å“ä¸»ç¨‹åº</td><td>âœ… å¤šè¿›ç¨‹å¤©ç”Ÿéš”ç¦»ï¼Œé€‚åˆä»»åŠ¡å´©æºƒå®¹é”™</td></tr></tbody></table><p>ğŸ”¹ Python çš„çº¿ç¨‹é€‚åˆ <strong>I&#x2F;Oå‹ä»»åŠ¡</strong>ï¼Œå¤šè¿›ç¨‹é€‚åˆ <strong>CPUå‹ + å·¥å…·éš”ç¦»è°ƒç”¨</strong><br>ğŸ”¹ GILï¼ˆå…¨å±€è§£é‡Šå™¨é”ï¼‰æ˜¯å†³å®šå› ç´ </p><hr><h3 id="2-Java"><a href="#2-Java" class="headerlink" title="2. Java"></a>2. <strong>Java</strong></h3><table><thead><tr><th>åœºæ™¯</th><th>å¤šçº¿ç¨‹è¡¨ç°</th><th>å¤šè¿›ç¨‹è¡¨ç°</th></tr></thead><tbody><tr><td>I&#x2F;O å¯†é›†å‹ä»»åŠ¡</td><td>âœ… éé˜»å¡ NIO &#x2F; å¤šçº¿ç¨‹çº¿ç¨‹æ± å¾ˆå¥½ç”¨</td><td>âŒ å¤šè¿›ç¨‹å¼€é”€å¤§ï¼Œä¸€èˆ¬ä¸ç”¨</td></tr><tr><td>CPU å¯†é›†å‹ä»»åŠ¡</td><td>âœ… æ—  GILï¼ŒJava çš„å¤šçº¿ç¨‹æ˜¯çœŸæ­£çš„å¤šæ ¸å¹¶è¡Œ</td><td>âŒ ç”¨å¤šè¿›ç¨‹é™¤éå¿…è¦ï¼ˆå¦‚è°ƒç”¨å¤–éƒ¨å‘½ä»¤ï¼‰</td></tr><tr><td>è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼ˆå¦‚ jar åŒ…ï¼‰</td><td>âœ… ç”¨çº¿ç¨‹æ§åˆ¶ä»»åŠ¡ï¼Œå†…éƒ¨è¿˜æ˜¯å¯åŠ¨å­è¿›ç¨‹</td><td>âœ… <code>ProcessBuilder</code> å¯åŠ¨å­è¿›ç¨‹</td></tr><tr><td>ä»»åŠ¡éš”ç¦»ã€å®¹é”™</td><td>âŒ å¼‚å¸¸å¯èƒ½ä¼ é€’å½±å“ä¸»çº¿ç¨‹</td><td>âœ… ç”¨å­è¿›ç¨‹å¯ä»¥å®ç°æ›´å¼ºçš„éš”ç¦»æ€§ï¼Œä½†ä¸€èˆ¬ä¸æ¨èè¿™ä¹ˆåš</td></tr></tbody></table><p>ğŸ”¹ Java æ²¡æœ‰ GILï¼Œ<strong>å¤šçº¿ç¨‹å°±èƒ½è·‘æ»¡å¤šæ ¸</strong>ï¼Œæ€§èƒ½å¥½<br>ğŸ”¹ å¤šè¿›ç¨‹ç”¨äºè°ƒç”¨å¤–éƒ¨ç¨‹åºï¼Œæˆ–è¿›ç¨‹éš”ç¦»éœ€æ±‚ï¼ˆä½†å°‘è§ï¼‰ï¼Œæˆ–è€…å¤šæœºåˆ†å¸ƒ</p><hr><h2 id="ğŸ§©-ä¸‰ã€ä½ çš„é¡¹ç›®ä¸­çš„è®¾è®¡åˆ†æå›é¡¾"><a href="#ğŸ§©-ä¸‰ã€ä½ çš„é¡¹ç›®ä¸­çš„è®¾è®¡åˆ†æå›é¡¾" class="headerlink" title="ğŸ§© ä¸‰ã€ä½ çš„é¡¹ç›®ä¸­çš„è®¾è®¡åˆ†æå›é¡¾"></a>ğŸ§© ä¸‰ã€ä½ çš„é¡¹ç›®ä¸­çš„è®¾è®¡åˆ†æå›é¡¾</h2><table><thead><tr><th>åŸè®¾è®¡</th><th>å­˜åœ¨é—®é¢˜</th><th>æ”¹è¿›å»ºè®®</th></tr></thead><tbody><tr><td>SpringBoot ä¸­ç”¨çº¿ç¨‹æ± è°ƒç”¨ <code>java -jar jplag.jar</code></td><td>æ¯æ¬¡éƒ½å¯åŠ¨ä¸€ä¸ªå¤–éƒ¨è¿›ç¨‹ï¼Œèµ„æºæ¶ˆè€—å¤§ã€ç›‘æ§éš¾</td><td>âœ… å°è£… JPlag ä¸ºå†…éƒ¨ç±»&#x2F;æ¨¡å—ï¼Œç›´æ¥æ–¹æ³•è°ƒç”¨</td></tr><tr><td>Python ç”¨å¤šè¿›ç¨‹æ–¹å¼æ‰¹é‡è°ƒç”¨ JPlag.jar</td><td>âœ… åˆç†ï¼ŒPython å¤šè¿›ç¨‹å¯ç»•å¼€ GILï¼Œéš”ç¦»ä»»åŠ¡</td><td>å¯ç»§ç»­ä¼˜åŒ–è¿›ç¨‹æ± ã€ä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜²æ­¢èµ„æºæ‰“æ»¡</td></tr></tbody></table><hr><h2 id="âœ¨-æœ€åæ€»ç»“å£è¯€"><a href="#âœ¨-æœ€åæ€»ç»“å£è¯€" class="headerlink" title="âœ¨ æœ€åæ€»ç»“å£è¯€"></a>âœ¨ æœ€åæ€»ç»“å£è¯€</h2><p><strong>Pythonï¼šçº¿ç¨‹ I&#x2F;Oï¼Œå¤šè¿›ç¨‹ CPUï¼›Javaï¼šçº¿ç¨‹å…¨èƒ½ï¼Œå¤šè¿›ç¨‹å¤–è°ƒã€‚</strong></p><hr>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Unix Socket å’Œ TCP/IP Socker</title>
    <link href="/2025/04/09/Unix-Socket-%E5%92%8C-TCP-IP-Socker/"/>
    <url>/2025/04/09/Unix-Socket-%E5%92%8C-TCP-IP-Socker/</url>
    
    <content type="html"><![CDATA[<h3 id="ğŸ§±-ä¸€ã€é€šä¿¡æœºåˆ¶åŒºåˆ«"><a href="#ğŸ§±-ä¸€ã€é€šä¿¡æœºåˆ¶åŒºåˆ«" class="headerlink" title="ğŸ§± ä¸€ã€é€šä¿¡æœºåˆ¶åŒºåˆ«"></a>ğŸ§± ä¸€ã€é€šä¿¡æœºåˆ¶åŒºåˆ«</h3><table><thead><tr><th>é¡¹ç›®</th><th>Unix Domain Socket</th><th>TCP&#x2F;IP Socket</th></tr></thead><tbody><tr><td><strong>é€šä¿¡ç±»å‹</strong></td><td>æœ¬åœ°é€šä¿¡ï¼ˆåŒä¸€å°ä¸»æœºï¼‰</td><td>ç½‘ç»œé€šä¿¡ï¼ˆæœ¬åœ°æˆ–è¿œç¨‹ï¼‰</td></tr><tr><td><strong>ä¼ è¾“åè®®</strong></td><td>ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ä½œä¸ºåœ°å€æ ‡è¯†ï¼Œæ— éœ€ IP å’Œç«¯å£</td><td>ä½¿ç”¨ IP å’Œç«¯å£ä½œä¸ºåœ°å€æ ‡è¯†</td></tr><tr><td><strong>åè®®æ ˆ</strong></td><td>ä¸èµ°ç½‘ç»œåè®®æ ˆï¼Œç›´æ¥é€šè¿‡å†…æ ¸å†…å­˜ä¼ è¾“</td><td>èµ°å®Œæ•´çš„ç½‘ç»œåè®®æ ˆï¼ˆå¦‚ TCP&#x2F;IPï¼‰</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>éå¸¸é«˜ï¼ˆå°‘äº†åè®®æ ˆå¼€é”€ï¼‰</td><td>ç›¸å¯¹è¾ƒä½ï¼ˆåè®®æ ˆå¤„ç†ã€æ•°æ®å°åŒ…è§£æï¼‰</td></tr></tbody></table><hr><h3 id="ğŸš€-äºŒã€ä½¿ç”¨åœºæ™¯åŒºåˆ«"><a href="#ğŸš€-äºŒã€ä½¿ç”¨åœºæ™¯åŒºåˆ«" class="headerlink" title="ğŸš€ äºŒã€ä½¿ç”¨åœºæ™¯åŒºåˆ«"></a>ğŸš€ äºŒã€ä½¿ç”¨åœºæ™¯åŒºåˆ«</h3><table><thead><tr><th>é¡¹ç›®</th><th>Unix Domain Socket</th><th>TCP&#x2F;IP Socket</th></tr></thead><tbody><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰å¦‚ Nginx å’Œ PHP-FPM</td><td>è·¨ä¸»æœºé€šä¿¡ï¼Œå¦‚å®¢æˆ·ç«¯ä¸è¿œç¨‹æœåŠ¡å™¨é€šä¿¡</td></tr><tr><td><strong>å…¸å‹ä½¿ç”¨</strong></td><td>Docker å®¹å™¨å†…éƒ¨é€šä¿¡ã€æ•°æ®åº“æœ¬åœ°è¿æ¥ï¼ˆå¦‚ PostgreSQLï¼‰</td><td>WebæœåŠ¡ã€åˆ†å¸ƒå¼ç³»ç»Ÿé€šä¿¡</td></tr></tbody></table><hr><h3 id="ğŸ”’-ä¸‰ã€å®‰å…¨ä¸éƒ¨ç½²åŒºåˆ«"><a href="#ğŸ”’-ä¸‰ã€å®‰å…¨ä¸éƒ¨ç½²åŒºåˆ«" class="headerlink" title="ğŸ”’ ä¸‰ã€å®‰å…¨ä¸éƒ¨ç½²åŒºåˆ«"></a>ğŸ”’ ä¸‰ã€å®‰å…¨ä¸éƒ¨ç½²åŒºåˆ«</h3><table><thead><tr><th>é¡¹ç›®</th><th>Unix Domain Socket</th><th>TCP&#x2F;IP Socket</th></tr></thead><tbody><tr><td><strong>è®¿é—®æ§åˆ¶</strong></td><td>å¯é€šè¿‡æ–‡ä»¶æƒé™æ§åˆ¶ï¼ˆå¦‚ <code>/tmp/socket.sock</code>ï¼‰</td><td>éœ€è¦é…ç½®é˜²ç«å¢™ã€ç›‘å¬åœ°å€æ¥é™åˆ¶è®¿é—®</td></tr><tr><td><strong>éƒ¨ç½²å¤æ‚åº¦</strong></td><td>ç®€å•ï¼ˆä»…éœ€è¦æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼‰</td><td>éœ€è¦ç›‘å¬ IPã€é…ç½®ç«¯å£ã€é˜²ç«å¢™ã€å®‰å…¨ç­–ç•¥</td></tr></tbody></table><hr><h3 id="ğŸ“Š-å››ã€å¼€å‘å¯¹æ¯”"><a href="#ğŸ“Š-å››ã€å¼€å‘å¯¹æ¯”" class="headerlink" title="ğŸ“Š å››ã€å¼€å‘å¯¹æ¯”"></a>ğŸ“Š å››ã€å¼€å‘å¯¹æ¯”</h3><table><thead><tr><th>é¡¹ç›®</th><th>Unix Domain Socket</th><th>TCP&#x2F;IP Socket</th></tr></thead><tbody><tr><td><strong>åœ°å€ç»“æ„</strong></td><td><code>sockaddr_un</code>ï¼ˆæŒ‡å®šè·¯å¾„ï¼‰</td><td><code>sockaddr_in</code>ï¼ˆæŒ‡å®š IP+ç«¯å£ï¼‰</td></tr><tr><td><strong>å¼€å‘æ¥å£</strong></td><td><code>socket()ã€bind()ã€listen()ã€accept()</code> ç›¸åŒï¼Œåªæ˜¯åœ°å€ç»“æ„ä¸åŒ</td><td>åŒä¸Š</td></tr><tr><td><strong>è°ƒè¯•å·¥å…·</strong></td><td>ä¸€èˆ¬çœ‹ä¸åˆ°æµé‡ï¼ˆä¸èµ°ç½‘ç»œï¼‰ï¼Œå¯ä»¥ç”¨ <code>lsof</code> æŸ¥çœ‹</td><td>å¯ä»¥ç”¨ <code>tcpdump</code>ã€<code>netstat</code>ã€<code>wireshark</code> æŠ“åŒ…åˆ†æ</td></tr></tbody></table><hr><p>âœ… æ€»ç»“ä¸€å¥è¯</p><ul><li>å¦‚æœ <strong>ä¸¤ä¸ªè¿›ç¨‹åœ¨åŒä¸€å°æœºå™¨ä¸Šé€šä¿¡</strong>ï¼Œé€‰ <strong>Unix Domain Socket</strong>ï¼Œé€Ÿåº¦å¿«ã€å®‰å…¨æ€§é«˜ã€‚</li><li>å¦‚æœ <strong>éœ€è¦è·¨ä¸»æœºé€šä¿¡</strong>ï¼Œåªèƒ½ç”¨ <strong>TCP&#x2F;IP Socket</strong>ã€‚</li></ul><hr><h3 id="ğŸ§ -äº”ã€Unix-Domain-Socket-çš„é€šä¿¡åŸç†"><a href="#ğŸ§ -äº”ã€Unix-Domain-Socket-çš„é€šä¿¡åŸç†" class="headerlink" title="ğŸ§  äº”ã€Unix Domain Socket çš„é€šä¿¡åŸç†"></a>ğŸ§  äº”ã€Unix Domain Socket çš„é€šä¿¡åŸç†</h3><h4 id="ğŸ“Œ-æ ¸å¿ƒåŸç†ï¼šå†…æ ¸ç©ºé—´å†…å­˜æ‹·è´-å†…å­˜é˜Ÿåˆ—ï¼ˆsocket-bufferï¼‰"><a href="#ğŸ“Œ-æ ¸å¿ƒåŸç†ï¼šå†…æ ¸ç©ºé—´å†…å­˜æ‹·è´-å†…å­˜é˜Ÿåˆ—ï¼ˆsocket-bufferï¼‰" class="headerlink" title="ğŸ“Œ æ ¸å¿ƒåŸç†ï¼šå†…æ ¸ç©ºé—´å†…å­˜æ‹·è´ + å†…å­˜é˜Ÿåˆ—ï¼ˆsocket bufferï¼‰"></a>ğŸ“Œ æ ¸å¿ƒåŸç†ï¼šå†…æ ¸ç©ºé—´å†…å­˜æ‹·è´ + å†…å­˜é˜Ÿåˆ—ï¼ˆsocket bufferï¼‰</h4><ol><li><strong>ä¸ç»è¿‡ç½‘ç»œåè®®æ ˆï¼ˆTCP&#x2F;IPï¼‰</strong></li></ol><ul><li><ul><li>æ•°æ®åœ¨ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´ä¼ é€’æ—¶ï¼Œå®Œå…¨åœ¨æœ¬æœºå†…æ ¸ä¸­å®Œæˆï¼Œä¸èµ°ç½‘å¡ã€ä¸å°åŒ…ã€ä¸è·¯ç”±ã€‚</li></ul></li></ul><ol><li><strong>ä½¿ç”¨å†…æ ¸çš„ Socket ç¼“å†²åŒº</strong></li></ol><ul><li><ul><li>ç±»ä¼¼äºä¸€å¯¹ç®¡é“ï¼šæ¯ä¸ª Unix socket å¯¹åº”ä¸€å¯¹ç¼“å­˜é˜Ÿåˆ—ï¼ˆsend buffer å’Œ recv bufferï¼‰ã€‚</li><li>å‘é€æ–¹ <code>write()</code> æ•°æ®ï¼Œå†…æ ¸æ‹·è´åˆ° socket bufferï¼›</li><li>æ¥æ”¶æ–¹ <code>read()</code> æ—¶ï¼Œä» buffer ä¸­å–å‡ºæ•°æ®ã€‚</li></ul></li></ul><ol><li><strong>æ‹·è´æ¬¡æ•°</strong></li></ol><ul><li><ul><li>é»˜è®¤æ˜¯ä¸¤æ¬¡æ‹·è´ï¼š</li></ul></li><li><ul><li><ul><li>ç”¨æˆ·æ€ â†’ å†…æ ¸æ€ï¼ˆwriteï¼‰</li><li>å†…æ ¸æ€ â†’ ç”¨æˆ·æ€ï¼ˆreadï¼‰</li></ul></li></ul></li></ul><ol><li><strong>Zero-Copyï¼ˆé›¶æ‹·è´ï¼‰ä¼˜åŒ–ï¼š</strong></li></ol><ul><li><ul><li>æŸäº›æ–°ç‰ˆæœ¬å†…æ ¸å¯å¯¹ Unix Socket å¼€å¯â€œé›¶æ‹·è´â€ä¼˜åŒ–ï¼ˆæ¯”å¦‚ <code>splice</code>ï¼‰ï¼Œè¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚</li></ul></li></ul><ol><li><strong>æ•ˆç‡ä¼˜åŠ¿</strong></li></ol><ul><li><ul><li>ç”±äºæ— éœ€å°åŒ…ã€æ ¡éªŒã€åºåˆ—å·ç­‰æ“ä½œï¼Œé€Ÿåº¦éå¸¸å¿«ï¼Œå»¶è¿Ÿéå¸¸ä½ã€‚</li></ul></li></ul><p>âœ… æ€»ç»“ï¼š<strong>Unix Domain Socket æœ¬è´¨æ˜¯å€ŸåŠ©å†…æ ¸çš„å†…å­˜æœºåˆ¶å®ç°æœ¬åœ°è¿›ç¨‹é€šä¿¡ï¼Œæ•ˆç‡é«˜ã€å»¶è¿Ÿä½ã€‚</strong></p><hr><h3 id="ğŸŒ-å…­ã€TCP-IP-Socket-çš„é€šä¿¡åŸç†"><a href="#ğŸŒ-å…­ã€TCP-IP-Socket-çš„é€šä¿¡åŸç†" class="headerlink" title="ğŸŒ å…­ã€TCP&#x2F;IP Socket çš„é€šä¿¡åŸç†"></a>ğŸŒ å…­ã€TCP&#x2F;IP Socket çš„é€šä¿¡åŸç†</h3><h4 id="ğŸ“Œ-æ ¸å¿ƒåŸç†ï¼šèµ°å®Œæ•´-TCP-IP-åè®®æ ˆ-ç½‘ç»œç¼“å†²åŒº-å¯èƒ½è·¨ä¸»æœº"><a href="#ğŸ“Œ-æ ¸å¿ƒåŸç†ï¼šèµ°å®Œæ•´-TCP-IP-åè®®æ ˆ-ç½‘ç»œç¼“å†²åŒº-å¯èƒ½è·¨ä¸»æœº" class="headerlink" title="ğŸ“Œ æ ¸å¿ƒåŸç†ï¼šèµ°å®Œæ•´ TCP&#x2F;IP åè®®æ ˆ + ç½‘ç»œç¼“å†²åŒº + å¯èƒ½è·¨ä¸»æœº"></a>ğŸ“Œ æ ¸å¿ƒåŸç†ï¼šèµ°å®Œæ•´ TCP&#x2F;IP åè®®æ ˆ + ç½‘ç»œç¼“å†²åŒº + å¯èƒ½è·¨ä¸»æœº</h4><ol><li><strong>åè®®æ ˆå¤„ç†</strong></li></ol><ul><li><ul><li>å‘é€æ•°æ®æ—¶ï¼š</li></ul></li><li><ul><li><ul><li>ç”¨æˆ·æ€ â†’ å†…æ ¸æ€ â†’ TCPå±‚ â†’ IPå±‚ â†’ ç½‘å¡é©±åŠ¨ â†’ å‘é€åˆ°ç½‘ç»œ</li></ul></li></ul></li><li><ul><li>æ¥æ”¶æ•°æ®æ—¶ï¼š</li></ul></li><li><ul><li><ul><li>ç½‘å¡æ¥æ”¶ â†’ IPå±‚ â†’ TCPå±‚ â†’ socket buffer â†’ ç”¨æˆ·æ€è¯»å–</li></ul></li></ul></li></ul><ol><li><strong>å°åŒ…ä¸æ ¡éªŒ</strong></li></ol><ul><li><ul><li>æ¯ä¸ªæ•°æ®åŒ…è¦åŠ ä¸Š TCP å¤´ã€IP å¤´ã€è¿›è¡Œåºåˆ—å·ç®¡ç†ã€é‡ä¼ æœºåˆ¶ç­‰ï¼›</li><li>TCP çš„ä¸‰æ¬¡æ¡æ‰‹ã€æµæ§ã€æ‹¥å¡æ§åˆ¶ç­‰éƒ½åœ¨è¿™é‡Œè¿›è¡Œã€‚</li></ul></li></ul><ol><li><strong>æ‹·è´æ¬¡æ•°</strong></li></ol><ul><li><ul><li>é€šå¸¸è‡³å°‘ä¸¤æ¬¡ï¼ˆå¯èƒ½æ›´å¤šï¼‰ï¼š</li></ul></li><li><ul><li><ul><li>ç”¨æˆ·æ€ â†’ å†…æ ¸æ€ï¼ˆwriteï¼‰</li><li>å†…æ ¸æ€ â†’ ç”¨æˆ·æ€ï¼ˆreadï¼‰</li></ul></li></ul></li><li><ul><li>è¿˜æœ‰ç½‘å¡ DMA çš„ç¡¬ä»¶æ‹·è´è¿‡ç¨‹ã€‚</li></ul></li></ul><ol><li><strong>å¯èƒ½çš„ç½‘ç»œç“¶é¢ˆ</strong></li></ol><ul><li><ul><li>ç½‘ç»œå»¶è¿Ÿã€ä¸¢åŒ…é‡ä¼ ã€å¸¦å®½é™åˆ¶éƒ½ä¼šå½±å“é€šä¿¡æ•ˆç‡ã€‚</li></ul></li></ul><p>âœ… æ€»ç»“ï¼š<strong>TCP&#x2F;IP Socket é€‚ç”¨äºè·¨ä¸»æœºé€šä¿¡ï¼Œä½†ç”±äºåè®®æ ˆå’Œç½‘ç»œç¯å¢ƒï¼Œæ•ˆç‡è¿œä¸å¦‚ Unix Socketã€‚</strong></p><hr><h3 id="ğŸš©-ä¸€å¥è¯å¯¹æ¯”æ€»ç»“"><a href="#ğŸš©-ä¸€å¥è¯å¯¹æ¯”æ€»ç»“" class="headerlink" title="ğŸš© ä¸€å¥è¯å¯¹æ¯”æ€»ç»“"></a>ğŸš© ä¸€å¥è¯å¯¹æ¯”æ€»ç»“</h3><table><thead><tr><th>é¡¹ç›®</th><th>Unix Domain Socket</th><th>TCP&#x2F;IP Socket</th></tr></thead><tbody><tr><td>æ˜¯å¦è·¨ä¸»æœº</td><td>âŒ æœ¬åœ°è¿›ç¨‹é—´</td><td>âœ… å¯è·¨ä¸»æœº</td></tr><tr><td>æ•°æ®è·¯å¾„</td><td>ç”¨æˆ·æ€ â†’ å†…æ ¸æ€ï¼ˆå†…æ ¸å†…å­˜ä¼ é€’ï¼‰</td><td>ç”¨æˆ·æ€ â†’ å†…æ ¸æ€ â†’ åè®®æ ˆ â†’ ç½‘å¡&#x2F;ç½‘ç»œ</td></tr><tr><td>åè®®æ ˆå¤„ç†</td><td>âŒ æ— </td><td>âœ… æœ‰ï¼ˆTCP&#x2F;IPï¼‰</td></tr><tr><td>æ‹·è´æ¬¡æ•°</td><td>é€šå¸¸ 2 æ¬¡ï¼ˆæˆ– 0 æ‹·è´ï¼‰</td><td>é€šå¸¸ 2 æ¬¡ï¼ˆåŠ åè®®å¤„ç†ï¼‰</td></tr><tr><td>æ•ˆç‡</td><td>âœ… æé«˜</td><td>âŒ è¾ƒä½</td></tr></tbody></table><hr><p><a href="https://imgse.com/i/pEHYPne"><img src="https://s21.ax1x.com/2025/04/30/pEHYPne.md.png" alt="pEHYPne.md.png"></a><br>è¿™æ˜¯ Unix Domain Socket å’Œ TCP&#x2F;IP Socket çš„æ•°æ®ä¼ è¾“æµç¨‹å›¾ï¼Œå¹¶é…å¥—ä¸€ä¸ªç®€å•çš„ Python ç¤ºä¾‹å¯¹ç…§ä¸¤ç§é€šä¿¡æ–¹å¼ã€‚</p><hr><h2 id="ğŸ–¼ï¸-æµç¨‹å›¾è¯´æ˜"><a href="#ğŸ–¼ï¸-æµç¨‹å›¾è¯´æ˜" class="headerlink" title="ğŸ–¼ï¸ æµç¨‹å›¾è¯´æ˜"></a>ğŸ–¼ï¸ æµç¨‹å›¾è¯´æ˜</h2><p>å·¦è¾¹ä¸º <strong>Unix Domain Socket</strong>ï¼š  </p><ul><li>æ•°æ®ä»åº”ç”¨å±‚é€šè¿‡ <code>write()</code> è¿›å…¥å†…æ ¸çš„ socket buffer  </li><li>å¦ä¸€ç«¯ <code>read()</code> ç›´æ¥è¯»å–ï¼Œ<strong>æ•´ä¸ªè¿‡ç¨‹åœ¨å†…æ ¸ä¸­å®Œæˆï¼Œä¸èµ°ç½‘ç»œ</strong></li></ul><p>å³è¾¹ä¸º <strong>TCP&#x2F;IP Socket</strong>ï¼š  </p><ul><li>æ•°æ®éœ€ç»è¿‡ TCP&#x2F;IP åè®®æ ˆå¤„ç†ï¼Œç»è¿‡ç½‘å¡ã€å¯èƒ½ä¼ è¾“åˆ°è¿œç¨‹æœºå™¨  </li><li>ä¸­é—´æ¶‰åŠå°åŒ…ã€è·¯ç”±ã€æµæ§ç­‰å¤šä¸ªé˜¶æ®µ</li></ul><p>ğŸ‘‰ å›¾åƒå±•ç¤ºäº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ¸…æ™°æ•°æ®è·¯å¾„å¯¹æ¯”ã€‚</p><hr><h2 id="ğŸ§ª-Python-ç¤ºä¾‹"><a href="#ğŸ§ª-Python-ç¤ºä¾‹" class="headerlink" title="ğŸ§ª Python ç¤ºä¾‹"></a>ğŸ§ª Python ç¤ºä¾‹</h2><p>ä¸‹é¢åˆ†åˆ«æ¼”ç¤º Unix Domain Socket å’Œ TCP&#x2F;IP Socket çš„åŸºæœ¬ç”¨æ³•ã€‚</p><h3 id="âœ…-1-Unix-Domain-Socket-ç¤ºä¾‹ï¼ˆæœ¬åœ°é€šä¿¡ï¼‰"><a href="#âœ…-1-Unix-Domain-Socket-ç¤ºä¾‹ï¼ˆæœ¬åœ°é€šä¿¡ï¼‰" class="headerlink" title="âœ… 1. Unix Domain Socket ç¤ºä¾‹ï¼ˆæœ¬åœ°é€šä¿¡ï¼‰"></a>âœ… 1. Unix Domain Socket ç¤ºä¾‹ï¼ˆæœ¬åœ°é€šä¿¡ï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># server_unix.py</span><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> os<br><br>SOCKET_PATH = <span class="hljs-string">&quot;/tmp/demo_socket&quot;</span><br><br><span class="hljs-keyword">if</span> os.path.exists(SOCKET_PATH):<br>    os.remove(SOCKET_PATH)<br><br>server = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)<br>server.bind(SOCKET_PATH)<br>server.listen(<span class="hljs-number">1</span>)<br>conn, _ = server.accept()<br><br>data = conn.recv(<span class="hljs-number">1024</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ”¶åˆ°ï¼š&quot;</span>, data.decode())<br>conn.send(<span class="hljs-string">b&quot;ä½ å¥½ï¼Œå®¢æˆ·ç«¯ï¼&quot;</span>)<br>conn.close()<br>server.close()<br><span class="hljs-comment"># client_unix.py</span><br><span class="hljs-keyword">import</span> socket<br><br>SOCKET_PATH = <span class="hljs-string">&quot;/tmp/demo_socket&quot;</span><br><br>client = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)<br>client.connect(SOCKET_PATH)<br>client.send(<span class="hljs-string">b&quot;ä½ å¥½ï¼ŒæœåŠ¡ç«¯ï¼&quot;</span>)<br>data = client.recv(<span class="hljs-number">1024</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ”¶åˆ°ï¼š&quot;</span>, data.decode())<br>client.close()<br></code></pre></td></tr></table></figure><hr><h3 id="âœ…-2-TCP-IP-Socket-ç¤ºä¾‹ï¼ˆç½‘ç»œé€šä¿¡ï¼‰"><a href="#âœ…-2-TCP-IP-Socket-ç¤ºä¾‹ï¼ˆç½‘ç»œé€šä¿¡ï¼‰" class="headerlink" title="âœ… 2. TCP&#x2F;IP Socket ç¤ºä¾‹ï¼ˆç½‘ç»œé€šä¿¡ï¼‰"></a>âœ… 2. TCP&#x2F;IP Socket ç¤ºä¾‹ï¼ˆç½‘ç»œé€šä¿¡ï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># server_tcp.py</span><br><span class="hljs-keyword">import</span> socket<br><br>server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>server.bind((<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">8888</span>))<br>server.listen(<span class="hljs-number">1</span>)<br>conn, addr = server.accept()<br><br>data = conn.recv(<span class="hljs-number">1024</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ”¶åˆ°ï¼š&quot;</span>, data.decode())<br>conn.send(<span class="hljs-string">b&quot;ä½ å¥½ï¼ŒTCPå®¢æˆ·ç«¯ï¼&quot;</span>)<br>conn.close()<br>server.close()<br><span class="hljs-comment"># client_tcp.py</span><br><span class="hljs-keyword">import</span> socket<br><br>client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>client.connect((<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">8888</span>))<br>client.send(<span class="hljs-string">b&quot;ä½ å¥½ï¼ŒTCPæœåŠ¡ç«¯ï¼&quot;</span>)<br>data = client.recv(<span class="hljs-number">1024</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ”¶åˆ°ï¼š&quot;</span>, data.decode())<br>client.close()<br></code></pre></td></tr></table></figure><hr><p>è¿™ä¸¤æ®µä»£ç é€»è¾‘ä¸€æ ·ï¼Œåªæ˜¯ä½¿ç”¨çš„ socket ç±»å‹ä¸åŒï¼ˆ<code>AF_UNIX</code> vs <code>AF_INET</code>ï¼‰ï¼Œä½ å¯ä»¥å®é™…è·‘ä¸€ä¸‹å¯¹æ¯”å·®å¼‚ï¼ˆå¦‚ CPU ä½¿ç”¨ç‡ã€å»¶è¿Ÿç­‰ï¼‰ã€‚</p><p>å¦‚æœä½ è¿˜æƒ³æ·±å…¥äº†è§£â€œé›¶æ‹·è´ä¼˜åŒ–â€æˆ–è€…â€œè¿›ç¨‹é—´é€šä¿¡å¯¹æ¯”â€ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç»§ç»­è¡¥å……ï½</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RAID ç£ç›˜é˜µåˆ—</title>
    <link href="/2025/03/28/RAID-%E7%A3%81%E7%9B%98%E9%98%B5%E5%88%97/"/>
    <url>/2025/03/28/RAID-%E7%A3%81%E7%9B%98%E9%98%B5%E5%88%97/</url>
    
    <content type="html"><![CDATA[<h3 id="RAID-ä»‹ç»"><a href="#RAID-ä»‹ç»" class="headerlink" title="RAID ä»‹ç»"></a><strong>RAID ä»‹ç»</strong></h3><p>RAIDï¼ˆRedundant Array of Independent Disksï¼Œç‹¬ç«‹ç£ç›˜å†—ä½™é˜µåˆ—ï¼‰æ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æŠ€æœ¯ï¼Œåˆ©ç”¨å¤šä¸ªç¡¬ç›˜ç»„åˆæˆä¸€ä¸ªé€»è¾‘å­˜å‚¨å•å…ƒï¼Œä»¥æé«˜<strong>æ•°æ®å†—ä½™æ€§</strong>ã€<strong>æ€§èƒ½</strong>æˆ–<strong>ä¸¤è€…å…¼é¡¾</strong>ã€‚  </p><p>RAID ä¸»è¦åˆ†ä¸º <strong>ç¡¬ä»¶ RAID</strong> å’Œ <strong>è½¯ä»¶ RAID</strong>ï¼Œä¸åŒçº§åˆ«çš„ RAID æä¾›ä¸åŒçš„æ€§èƒ½ã€å®¹é”™èƒ½åŠ›å’Œå­˜å‚¨æ•ˆç‡ã€‚</p><hr><h2 id="1-RAID-çš„åˆ†ç±»"><a href="#1-RAID-çš„åˆ†ç±»" class="headerlink" title="1. RAID çš„åˆ†ç±»"></a><strong>1. RAID çš„åˆ†ç±»</strong></h2><p>RAID ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç§å¸¸è§çº§åˆ«ï¼š</p><table><thead><tr><th>RAID çº§åˆ«</th><th>ç‰¹ç‚¹</th><th>å®¹é”™æ€§</th><th>è¯»å†™æ€§èƒ½</th><th>ç£ç›˜åˆ©ç”¨ç‡</th></tr></thead><tbody><tr><td>RAID 0</td><td>æ•°æ®æ¡å¸¦åŒ–ï¼Œæ— å†—ä½™</td><td>âŒ æ— </td><td>ğŸ”¼ è¯»å†™åŠ é€Ÿ</td><td>100%</td></tr><tr><td>RAID 1</td><td>é•œåƒå­˜å‚¨ï¼Œæ•°æ®å®Œæ•´æ€§é«˜</td><td>âœ… å…è®¸ 1 å—ç£ç›˜æ•…éšœ</td><td>è¯»æ€§èƒ½é«˜ï¼Œå†™å…¥å—é™</td><td>50%</td></tr><tr><td>RAID 5</td><td>æ¡å¸¦åŒ– + å¥‡å¶æ ¡éªŒ</td><td>âœ… å…è®¸ 1 å—ç£ç›˜æ•…éšœ</td><td>è¯»é«˜ï¼Œå†™ç¨æ…¢</td><td>(n-1)&#x2F;n</td></tr><tr><td>RAID 6</td><td>åŒå¥‡å¶æ ¡éªŒï¼Œå¢å¼ºå¯é æ€§</td><td>âœ… å…è®¸ 2 å—ç£ç›˜æ•…éšœ</td><td>è¯»é«˜ï¼Œå†™ç¨æ…¢</td><td>(n-2)&#x2F;n</td></tr><tr><td>RAID 10</td><td>RAID 1 + RAID 0ï¼ˆé•œåƒ + æ¡å¸¦ï¼‰</td><td>âœ… å…è®¸æ¯ç»„ 1 å—ç£ç›˜æ•…éšœ</td><td>è¯»é«˜ï¼Œå†™é«˜</td><td>50%</td></tr></tbody></table><p>âœ… <strong>RAID 0ï¼ˆæ¡å¸¦åŒ–ï¼Œæå‡é€Ÿåº¦ï¼Œæ— å†—ä½™ï¼‰</strong></p><p><img src="https://s21.ax1x.com/2025/04/30/pEHJNeH.png"></p><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šæ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªç£ç›˜ä¸Šï¼Œæé«˜è¯»å†™æ€§èƒ½ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šé€Ÿåº¦æœ€å¿«ï¼Œç£ç›˜åˆ©ç”¨ç‡æœ€é«˜ï¼ˆ100%ï¼‰ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼š<strong>æ— å†—ä½™</strong>ï¼Œä»»æ„ä¸€å—ç£ç›˜æŸåéƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¯¹æ€§èƒ½è¦æ±‚æé«˜ä½†ä¸å…³å¿ƒæ•°æ®å®‰å…¨æ€§çš„åœºæ™¯ï¼Œå¦‚<strong>ç¼“å­˜ç›˜ã€ä¸´æ—¶å­˜å‚¨</strong>ã€‚</li></ul><p>âœ… <strong>RAID 1ï¼ˆé•œåƒï¼Œæ•°æ®å®‰å…¨é«˜ï¼‰</strong></p><p><img src="https://s21.ax1x.com/2025/04/30/pEHJJyD.png"></p><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šæ•°æ®åœ¨ä¸¤å—ç£ç›˜ä¸Šä¿æŒå®Œå…¨ä¸€è‡´ï¼Œä¸€å—æŸåä»å¯ä½¿ç”¨ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<strong>å†—ä½™åº¦é«˜ï¼Œå¯é æ€§å¼º</strong>ï¼Œè¯»æ€§èƒ½æé«˜ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šç£ç›˜åˆ©ç”¨ç‡<strong>åªæœ‰ 50%</strong>ï¼ˆå­˜ä¸¤ä»½ï¼‰ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç³»ç»Ÿç›˜ã€é‡è¦æ•°æ®å­˜å‚¨ã€‚</li></ul><p>âœ… <strong>RAID 5ï¼ˆå¥‡å¶æ ¡éªŒï¼Œæé«˜å®‰å…¨æ€§å’Œæ€§èƒ½ï¼‰</strong></p><p><img src="https://s21.ax1x.com/2025/04/30/pEHJUwd.png"></p><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šé‡‡ç”¨ <strong>æ¡å¸¦åŒ– + å•ä¸€å¥‡å¶æ ¡éªŒ</strong>ï¼Œæ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªç£ç›˜ä¸Šã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<strong>æ”¯æŒ 1 å—ç£ç›˜æŸå</strong>ï¼Œç£ç›˜åˆ©ç”¨ç‡è¾ƒé«˜ï¼ˆ<code>(n-1)/n</code>ï¼‰ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå†™å…¥éœ€è¦è®¡ç®—æ ¡éªŒä¿¡æ¯ï¼Œå†™æ€§èƒ½è¾ƒ RAID 0 ä½ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<strong>æ•°æ®åº“ã€æ–‡ä»¶æœåŠ¡å™¨</strong>ã€‚</li></ul><p>âœ… <strong>RAID 6ï¼ˆåŒé‡å¥‡å¶æ ¡éªŒï¼Œæé«˜å¯é æ€§ï¼‰</strong></p><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šç±»ä¼¼ RAID 5ï¼Œä½†æœ‰ <strong>åŒå¥‡å¶æ ¡éªŒ</strong>ï¼Œæé«˜å®¹é”™èƒ½åŠ›ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<strong>æ”¯æŒ 2 å—ç£ç›˜åŒæ—¶æŸå</strong>ï¼Œæ¯” RAID 5 æ›´å¯é ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå†™å…¥æ€§èƒ½æ¯” RAID 5 ä½ï¼Œç£ç›˜åˆ©ç”¨ç‡æ›´ä½ï¼ˆ<code>(n-2)/n</code>ï¼‰ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šéœ€è¦<strong>æ›´é«˜å®‰å…¨æ€§</strong>çš„æ•°æ®å­˜å‚¨ï¼Œå¦‚ä¼ä¸šçº§å­˜å‚¨ç³»ç»Ÿã€‚</li></ul><p>âœ… <strong>RAID 10ï¼ˆRAID 1 + RAID 0ï¼Œå…¼é¡¾æ€§èƒ½å’Œå®‰å…¨ï¼‰</strong></p><p><img src="https://s21.ax1x.com/2025/04/30/pEHJYOe.png"></p><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šRAID 1ï¼ˆé•œåƒï¼‰+ RAID 0ï¼ˆæ¡å¸¦ï¼‰ï¼Œè‡³å°‘ 4 å—ç£ç›˜ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<strong>è¯»å†™æ€§èƒ½é«˜ï¼Œå®‰å…¨æ€§é«˜</strong>ï¼Œæ”¯æŒå¤šä¸ªç£ç›˜æŸåï¼ˆä½†å¿…é¡»åˆ†å¸ƒåœ¨ä¸åŒé•œåƒç»„ï¼‰ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šç£ç›˜åˆ©ç”¨ç‡ 50%ï¼Œæˆæœ¬è¾ƒé«˜ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ•°æ®åº“ã€è™šæ‹Ÿæœºå­˜å‚¨ç­‰éœ€è¦<strong>é«˜æ€§èƒ½+é«˜å®‰å…¨</strong>çš„åœºæ™¯ã€‚</li></ul><hr><h2 id="2-ç¡¬ä»¶-RAID-vs-è½¯ä»¶-RAID"><a href="#2-ç¡¬ä»¶-RAID-vs-è½¯ä»¶-RAID" class="headerlink" title="2. ç¡¬ä»¶ RAID vs. è½¯ä»¶ RAID"></a><strong>2. ç¡¬ä»¶ RAID vs. è½¯ä»¶ RAID</strong></h2><p>RAID æ—¢å¯ä»¥é€šè¿‡ <strong>ç¡¬ä»¶</strong> å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <strong>è½¯ä»¶</strong> å®ç°ã€‚</p><h3 id="ç¡¬ä»¶-RAID"><a href="#ç¡¬ä»¶-RAID" class="headerlink" title="ç¡¬ä»¶ RAID"></a><strong>ç¡¬ä»¶ RAID</strong></h3><p><img src="https://s21.ax1x.com/2025/04/30/pEHJaTA.png"></p><ul><li><p><strong>é€šè¿‡ RAID æ§åˆ¶å™¨ï¼ˆRAID å¡ï¼‰ç®¡ç†ç£ç›˜</strong>ï¼Œç‹¬ç«‹äºæ“ä½œç³»ç»Ÿè¿è¡Œã€‚</p></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼š</p></li><li><ul><li>RAID æ“ä½œç”±<strong>ä¸“ç”¨ç¡¬ä»¶</strong>å®Œæˆï¼Œä¸å ç”¨ CPU èµ„æºã€‚</li><li>å…·æœ‰ <strong>ä¸“ç”¨ç¼“å­˜</strong>ï¼Œæé«˜ RAID 5&#x2F;6 å†™å…¥æ€§èƒ½ã€‚</li><li>é€‚ç”¨äº <strong>ä¼ä¸šçº§å­˜å‚¨</strong>ï¼Œå¦‚æœåŠ¡å™¨ã€NASã€‚</li></ul></li><li><p><strong>ç¼ºç‚¹</strong>ï¼š</p></li><li><ul><li><strong>æˆæœ¬é«˜</strong>ï¼ŒRAID å¡ä»·æ ¼æ˜‚è´µã€‚</li><li>RAID å¡æ•…éšœåï¼Œå¯èƒ½å¯¼è‡´ RAID ä¸èƒ½æ¢å¤ã€‚</li></ul></li></ul><h3 id="è½¯ä»¶-RAID"><a href="#è½¯ä»¶-RAID" class="headerlink" title="è½¯ä»¶ RAID"></a><strong>è½¯ä»¶ RAID</strong></h3><ul><li><p><strong>é€šè¿‡æ“ä½œç³»ç»Ÿï¼ˆLinux mdadmã€Windows Storage Spacesï¼‰å®ç° RAID</strong>ï¼Œä¸éœ€è¦ä¸“ç”¨ RAID ç¡¬ä»¶ã€‚</p></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼š</p></li><li><ul><li><strong>æˆæœ¬ä½</strong>ï¼Œä»…ä¾èµ–æ“ä½œç³»ç»Ÿå’Œ CPU è®¡ç®—ã€‚</li><li><strong>çµæ´»æ€§é«˜</strong>ï¼Œå¯åœ¨ä¸åŒç¡¬ä»¶ä¸Šè¿ç§»ã€‚</li><li>é€‚ç”¨äº <strong>ä¸ªäººç”¨æˆ·ã€ä½æˆæœ¬å­˜å‚¨æ–¹æ¡ˆ</strong>ã€‚</li></ul></li><li><p><strong>ç¼ºç‚¹</strong>ï¼š</p></li><li><ul><li><strong>å ç”¨ CPU èµ„æº</strong>ï¼Œå½±å“æ•´ä½“æ€§èƒ½ã€‚</li><li>RAID 5&#x2F;6 <strong>å†™å…¥æ€§èƒ½è¾ƒå·®</strong>ï¼Œå›  CPU éœ€è¦è®¡ç®—æ ¡éªŒä¿¡æ¯ã€‚</li></ul></li></ul><h3 id="ç¡¬ä»¶-RAID-vs-è½¯ä»¶-RAID-å¯¹æ¯”"><a href="#ç¡¬ä»¶-RAID-vs-è½¯ä»¶-RAID-å¯¹æ¯”" class="headerlink" title="ç¡¬ä»¶ RAID vs. è½¯ä»¶ RAID å¯¹æ¯”"></a><strong>ç¡¬ä»¶ RAID vs. è½¯ä»¶ RAID å¯¹æ¯”</strong></h3><table><thead><tr><th>æ–¹æ¡ˆ</th><th>æ€§èƒ½</th><th>æˆæœ¬</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>ç¡¬ä»¶ RAID</strong></td><td>ğŸš€ é«˜</td><td>ğŸ’° é«˜</td><td>ä¼ä¸šçº§å­˜å‚¨ï¼Œæ•°æ®ä¸­å¿ƒ</td></tr><tr><td><strong>è½¯ä»¶ RAID</strong></td><td>âš¡ é€‚ä¸­</td><td>âœ… ä½</td><td>ä¸ªäººå­˜å‚¨ï¼ŒæœåŠ¡å™¨</td></tr></tbody></table><hr><h2 id="3-RAID-é€‰æ‹©æŒ‡å—"><a href="#3-RAID-é€‰æ‹©æŒ‡å—" class="headerlink" title="3. RAID é€‰æ‹©æŒ‡å—"></a><strong>3. RAID é€‰æ‹©æŒ‡å—</strong></h2><ul><li><strong>é«˜æ€§èƒ½</strong>ï¼Œä½†ä¸å…³å¿ƒæ•°æ®å®‰å…¨æ€§ï¼ŸğŸ‘‰ RAID 0</li><li><strong>æ•°æ®å®‰å…¨æ€§æœ€é‡è¦</strong>ï¼Œå¯æ¥å—ç£ç›˜åˆ©ç”¨ç‡é™ä½ï¼ŸğŸ‘‰ RAID 1</li><li><strong>éœ€è¦æ€§èƒ½+å†—ä½™ï¼Œæ€§ä»·æ¯”é«˜</strong>ï¼ŸğŸ‘‰ RAID 5</li><li><strong>æé«˜çš„å¯é æ€§ï¼Œæ”¯æŒ 2 å—ç£ç›˜æ•…éšœ</strong>ï¼ŸğŸ‘‰ RAID 6</li><li><strong>æ€§èƒ½+å®‰å…¨æ€§å…¼é¡¾ï¼Œé¢„ç®—å……è¶³</strong>ï¼ŸğŸ‘‰ RAID 10</li></ul><hr><h2 id="4-Linux-åˆ›å»ºè½¯ä»¶-RAIDï¼ˆmdadmï¼‰"><a href="#4-Linux-åˆ›å»ºè½¯ä»¶-RAIDï¼ˆmdadmï¼‰" class="headerlink" title="4. Linux åˆ›å»ºè½¯ä»¶ RAIDï¼ˆmdadmï¼‰"></a><strong>4. Linux åˆ›å»ºè½¯ä»¶ RAIDï¼ˆmdadmï¼‰</strong></h2><p>åœ¨ <code>Linux</code> ä¸Šï¼Œä½¿ç”¨ <code>mdadm</code> å‘½ä»¤ç®¡ç†è½¯ä»¶ RAIDã€‚ä¾‹å¦‚ï¼Œåˆ›å»º <code>RAID 1</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># root @ debian in ~ [20:21:45] </span><br>$ lsblk -f<br>NAME   FSTYPE  FSVER            LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINT<br>sda                                                                                       <br>â””â”€sda1 ext4    1.0                    f34f1c4a-fb45-4145-b526-1a9985598ea4  305.4G    17% /<br>sdb                                                                                       <br>sdc                                                                                       <br>sdd                                                                                       <br>sr0    iso9660 Joliet Extension CDROM 2023-04-19-20-36-49-00                              <br><br><span class="hljs-comment"># root @ debian in ~ [20:22:15] </span><br>$ lsblk<br>NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT<br>sda      8:0    0   400G  0 disk <br>â””â”€sda1   8:1    0   400G  0 part /<br>sdb      8:16   0   100G  0 disk <br>sdc      8:32   0   100G  0 disk <br>sdd      8:48   0   100G  0 disk <br>sr0     11:0    1 445.7M  0 rom  <br><br><span class="hljs-comment"># root @ debian in ~ [20:22:17] </span><br>$ fdisk -l<br>Disk /dev/sdd: 100 GiB, 107374182400 bytes, 209715200 sectors<br>Disk model: Virtual disk    <br>Units: sectors of 1 * 512 = 512 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disklabel <span class="hljs-built_in">type</span>: gpt<br>Disk identifier: BAF1E3D6-56AC-49CB-A007-04A885EC8176<br><br><br>Disk /dev/sdc: 100 GiB, 107374182400 bytes, 209715200 sectors<br>Disk model: Virtual disk    <br>Units: sectors of 1 * 512 = 512 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disklabel <span class="hljs-built_in">type</span>: gpt<br>Disk identifier: 6B28F12E-298C-444B-9280-B193950BC24F<br><br><br>Disk /dev/sda: 400 GiB, 429496729600 bytes, 838860800 sectors<br>Disk model: Virtual disk    <br>Units: sectors of 1 * 512 = 512 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disklabel <span class="hljs-built_in">type</span>: dos<br>Disk identifier: 0x61522629<br><br>Device     Boot Start       End   Sectors  Size Id Type<br>/dev/sda1  *     2048 838858751 838856704  400G 83 Linux<br><br><br>Disk /dev/sdb: 100 GiB, 107374182400 bytes, 209715200 sectors<br>Disk model: Virtual disk    <br>Units: sectors of 1 * 512 = 512 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disklabel <span class="hljs-built_in">type</span>: gpt<br>Disk identifier: 9324FD1A-EAE8-7E49-B548-C613E8D4D282<br><br><span class="hljs-comment"># root @ debian in ~ [20:22:20] </span><br>$ mdadm --create --verbose /dev/md0 --level=1 --raid-devices=2 /dev/sdc /dev/sdd<br>mdadm: partition table exists on /dev/sdc<br>mdadm: partition table exists on /dev/sdc but will be lost or<br>       meaningless after creating array<br>mdadm: Note: this array has metadata at the start and<br>    may not be suitable as a boot device.  If you plan to<br>    store <span class="hljs-string">&#x27;/boot&#x27;</span> on this device please ensure that<br>    your boot-loader understands md/v1.x metadata, or use<br>    --metadata=0.90<br>mdadm: partition table exists on /dev/sdd<br>mdadm: partition table exists on /dev/sdd but will be lost or<br>       meaningless after creating array<br>mdadm: size <span class="hljs-built_in">set</span> to 104791040K<br>Continue creating array? <br>Continue creating array? (y/n) y<br>mdadm: Defaulting to version 1.2 metadata<br>mdadm: array /dev/md0 started.<br><br><span class="hljs-comment"># root @ debian in ~ [20:22:30] </span><br>$ <span class="hljs-built_in">cat</span> /proc/mdstat <span class="hljs-comment"># æŸ¥çœ‹raidçŠ¶æ€</span><br>Personalities : [raid1] <br>md0 : active raid1 sdd[1] sdc[0]<br>      104791040 blocks super 1.2 [2/2] [UU]<br>      [&gt;....................]  resync =  0.3% (377728/104791040) finish=46.0min speed=37772K/sec<br>      <br>unused devices: &lt;none&gt;<br><br><span class="hljs-comment"># root @ debian in ~ [20:22:40] </span><br>$ mdadm --detail /dev/md0<br>/dev/md0:<br>           Version : 1.2<br>     Creation Time : Fri Mar 28 20:22:30 2025<br>        Raid Level : raid1<br>        Array Size : 104791040 (99.94 GiB 107.31 GB)<br>     Used Dev Size : 104791040 (99.94 GiB 107.31 GB)<br>      Raid Devices : 2<br>     Total Devices : 2<br>       Persistence : Superblock is persistent<br><br>       Update Time : Fri Mar 28 20:22:30 2025<br>             State : clean, resyncing <br>    Active Devices : 2<br>   Working Devices : 2<br>    Failed Devices : 0<br>     Spare Devices : 0<br><br>Consistency Policy : resync<br><br>     Resync Status : 1% complete<br><br>              Name : debian:0  (<span class="hljs-built_in">local</span> to host debian)<br>              UUID : 5a3e483d:dcc3f33d:3ffdbae7:7f4a41a7<br>            Events : 0<br><br>    Number   Major   Minor   RaidDevice State<br>       0       8       32        0      active <span class="hljs-built_in">sync</span>   /dev/sdc<br>       1       8       48        1      active <span class="hljs-built_in">sync</span>   /dev/sdd<br><br><span class="hljs-comment"># root @ debian in ~ [20:23:01] </span><br>$ mkfs.ext4 /dev/md0<br>mke2fs 1.46.2 (28-Feb-2021)<br>Creating filesystem with 26197760 4k blocks and 6553600 inodes<br>Filesystem UUID: f3ee7c5d-c9a7-429a-91e8-58d6301ed7dc<br>Superblock backups stored on blocks: <br>32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, <br>4096000, 7962624, 11239424, 20480000, 23887872<br><br>Allocating group tables: <span class="hljs-keyword">done</span>                            <br>Writing inode tables: <span class="hljs-keyword">done</span>                            <br>Creating journal (131072 blocks): <br><span class="hljs-keyword">done</span><br>Writing superblocks and filesystem accounting information: <span class="hljs-keyword">done</span>   <br><br><span class="hljs-comment"># root @ debian in ~ [20:23:17] </span><br>$ <span class="hljs-built_in">mkdir</span> -p /mnt/raid1<br><br><span class="hljs-comment"># root @ debian in ~ [20:23:23] </span><br>$ mount /dev/md0 /mnt/raid1<br><br><span class="hljs-comment"># root @ debian in ~ [20:23:27] </span><br>$ <span class="hljs-built_in">df</span> -h | grep md0<br>/dev/md0         98G   24K   93G    1% /mnt/raid1<br><br><span class="hljs-comment"># root @ debian in ~ [20:23:31] </span><br>$ mdadm --detail --scan &gt;&gt; /etc/mdadm/mdadm.conf<br><br><span class="hljs-comment"># root @ debian in ~ [20:23:53] </span><br>$ update-initramfs -u<br>update-initramfs: Generating /boot/initrd.img-5.10.0-20-amd64<br><br><span class="hljs-comment"># root @ debian in ~ [20:24:10] </span><br>$ vim /dev/md0  /mnt/raid1  ext4  defaults  0  0<br><br><span class="hljs-comment"># root @ debian in ~ [20:24:15] C:130</span><br>$ vim /etc/fstab <br><br><span class="hljs-comment"># root @ debian in ~ [20:24:30] </span><br>$ mount -a<br><br><span class="hljs-comment"># root @ debian in ~ [20:24:34] </span><br>$ lsblk<br>NAME   MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT<br>sda      8:0    0   400G  0 disk  <br>â””â”€sda1   8:1    0   400G  0 part  /<br>sdb      8:16   0   100G  0 disk  <br>sdc      8:32   0   100G  0 disk  <br>â””â”€md0    9:0    0  99.9G  0 raid1 /mnt/raid1<br>sdd      8:48   0   100G  0 disk  <br>â””â”€md0    9:0    0  99.9G  0 raid1 /mnt/raid1<br>sr0     11:0    1 445.7M  0 rom  <br></code></pre></td></tr></table></figure><hr><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>æ˜¯çš„ï¼<strong>å¦‚æœä½ æ˜¯é€šè¿‡ RAID å¡ï¼ˆç¡¬ä»¶ RAIDï¼‰æ¥åˆ›å»º RAID é˜µåˆ—ï¼Œç³»ç»Ÿå°±ä¸ä¼šåœ¨</strong> <code>/proc/mdstat</code> <strong>é‡Œçœ‹åˆ° RAID ä¿¡æ¯ã€‚</strong></p><hr><h3 id="ä¸ºä»€ä¹ˆç¡¬ä»¶-RAID-åœ¨-proc-mdstat-é‡Œçœ‹ä¸åˆ°ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆç¡¬ä»¶-RAID-åœ¨-proc-mdstat-é‡Œçœ‹ä¸åˆ°ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆç¡¬ä»¶ RAID åœ¨ /proc/mdstat é‡Œçœ‹ä¸åˆ°ï¼Ÿ"></a>ä¸ºä»€ä¹ˆç¡¬ä»¶ RAID åœ¨ <code>/proc/mdstat</code> é‡Œçœ‹ä¸åˆ°ï¼Ÿ</h3><p><code>/proc/mdstat</code> åªä¼šæ˜¾ç¤º <strong>è½¯ä»¶ RAIDï¼ˆmdadm ç»„çš„é˜µåˆ—ï¼‰</strong> çš„çŠ¶æ€ï¼Œç¡¬ä»¶ RAID æ˜¯ç”± RAID æ§åˆ¶å™¨ï¼ˆRAID å¡ï¼‰ç›´æ¥ç®¡ç†ç£ç›˜ï¼Œå¹¶å‘æ“ä½œç³»ç»Ÿæš´éœ²ä¸€ä¸ª<strong>å•ç‹¬çš„è™šæ‹Ÿç£ç›˜</strong>ï¼Œç³»ç»Ÿä¼šæŠŠå®ƒå½“ä½œä¸€ä¸ªæ™®é€šçš„ç£ç›˜ï¼Œè€Œä¸æ˜¯å¤šä¸ªç£ç›˜çš„ RAID ç»„åˆã€‚</p><p>ğŸ“Œ <strong>ç®€å•ç†è§£ï¼š</strong></p><ul><li><strong>è½¯ä»¶ RAIDï¼ˆmdadmï¼‰</strong> ğŸ‘‰ åœ¨ <code>/proc/mdstat</code> å¯ä»¥çœ‹åˆ° RAID è®¾å¤‡ï¼ˆå¦‚ <code>/dev/md0</code>ï¼‰ã€‚</li><li><strong>ç¡¬ä»¶ RAIDï¼ˆRAID å¡ï¼‰</strong> ğŸ‘‰ <code>/proc/mdstat</code> çœ‹ä¸åˆ°ï¼Œç³»ç»Ÿé‡Œåªä¼šçœ‹åˆ°ä¸€ä¸ª RAID å¡åˆ›å»ºçš„è™šæ‹Ÿç£ç›˜ï¼ˆå¦‚ <code>/dev/sda</code>ï¼‰ã€‚</li></ul><hr><h3 id="å¦‚ä½•æ£€æŸ¥ç¡¬ä»¶-RAID-çŠ¶æ€ï¼Ÿ"><a href="#å¦‚ä½•æ£€æŸ¥ç¡¬ä»¶-RAID-çŠ¶æ€ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ£€æŸ¥ç¡¬ä»¶ RAID çŠ¶æ€ï¼Ÿ"></a>å¦‚ä½•æ£€æŸ¥ç¡¬ä»¶ RAID çŠ¶æ€ï¼Ÿ</h3><p>å¦‚æœä½ æ˜¯ç”¨ RAID å¡ç»„çš„ RAIDï¼Œå¯ä»¥ä½¿ç”¨ <strong>RAID å¡çš„ç®¡ç†å·¥å…·</strong> æ¥æŸ¥çœ‹ RAID çŠ¶æ€ï¼š</p><h4 id="lsblk-æŸ¥çœ‹-RAID-è®¾å¤‡"><a href="#lsblk-æŸ¥çœ‹-RAID-è®¾å¤‡" class="headerlink" title="lsblk æŸ¥çœ‹ RAID è®¾å¤‡"></a><code>lsblk</code> æŸ¥çœ‹ RAID è®¾å¤‡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsblk<br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ç¡¬ä»¶ RAIDï¼Œå¯èƒ½ä¼šçœ‹åˆ°ä¸€ä¸ªå¤§å®¹é‡çš„ RAID è®¾å¤‡ï¼ˆæ¯”å¦‚ <code>/dev/sda</code>ï¼‰ï¼Œä½†çœ‹ä¸åˆ°åŸå§‹çš„ç‰©ç†ç£ç›˜ï¼ˆ<code>/dev/sdc</code>ã€<code>/dev/sdd</code>ï¼‰ã€‚</p><hr><h4 id="lsscsi-æŸ¥çœ‹-RAID-ç£ç›˜"><a href="#lsscsi-æŸ¥çœ‹-RAID-ç£ç›˜" class="headerlink" title="lsscsi æŸ¥çœ‹ RAID ç£ç›˜"></a><code>lsscsi</code> æŸ¥çœ‹ RAID ç£ç›˜</h4><p>å¦‚æœç³»ç»Ÿé‡Œæœ‰ <code>lsscsi</code>ï¼Œå¯ä»¥ç”¨å®ƒæ£€æŸ¥ RAID è®¾å¤‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsscsi<br></code></pre></td></tr></table></figure><p>å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">[0:0:0:0]    disk    DELL     PERC H730 Mini    4.27  /dev/sda<br></code></pre></td></tr></table></figure><p>è¿™é‡Œ <code>/dev/sda</code> å…¶å®å°±æ˜¯ RAID è®¾å¤‡ï¼Œè€Œä¸æ˜¯æ™®é€šçš„ç‰©ç†ç£ç›˜ã€‚</p><hr><h3 id="ä½¿ç”¨-RAID-å¡å‚å•†æä¾›çš„ç®¡ç†å·¥å…·"><a href="#ä½¿ç”¨-RAID-å¡å‚å•†æä¾›çš„ç®¡ç†å·¥å…·" class="headerlink" title="ä½¿ç”¨ RAID å¡å‚å•†æä¾›çš„ç®¡ç†å·¥å…·"></a><strong>ä½¿ç”¨ RAID å¡å‚å•†æä¾›çš„ç®¡ç†å·¥å…·</strong></h3><p>ä¸åŒå“ç‰Œçš„ RAID å¡æœ‰ä¸åŒçš„ç®¡ç†å·¥å…·ï¼Œä½ å¯ä»¥å°è¯•ä»¥ä¸‹å·¥å…·ï¼š</p><h4 id="MegaRAIDï¼ˆLSIã€DELL-PERCï¼‰"><a href="#MegaRAIDï¼ˆLSIã€DELL-PERCï¼‰" class="headerlink" title="MegaRAIDï¼ˆLSIã€DELL PERCï¼‰"></a><strong>MegaRAIDï¼ˆLSIã€DELL PERCï¼‰</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> megacli -LDInfo -Lall -aAll<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> storcli64 /c0 show<br></code></pre></td></tr></table></figure><h4 id="HP-Smart-Array"><a href="#HP-Smart-Array" class="headerlink" title="HP Smart Array"></a><strong>HP Smart Array</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> hpssacli ctrl all show config<br></code></pre></td></tr></table></figure><h4 id="Dell-iDRACï¼ˆPERC-RAID-å¡ï¼‰"><a href="#Dell-iDRACï¼ˆPERC-RAID-å¡ï¼‰" class="headerlink" title="Dell iDRACï¼ˆPERC RAID å¡ï¼‰"></a><strong>Dell iDRACï¼ˆPERC RAID å¡ï¼‰</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> omreport storage controller<br></code></pre></td></tr></table></figure><hr><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>âœ… <strong>è½¯ä»¶ RAIDï¼ˆmdadmï¼‰</strong> ğŸ‘‰ å¯ä»¥ç”¨ <code>/proc/mdstat</code> æŸ¥çœ‹ã€‚<br>âœ… <strong>ç¡¬ä»¶ RAIDï¼ˆRAID å¡ï¼‰</strong> ğŸ‘‰ <code>/proc/mdstat</code> çœ‹ä¸åˆ° RAID è¯¦æƒ…ï¼Œéœ€è¦ç”¨ RAID ç®¡ç†å·¥å…·æ£€æŸ¥ã€‚</p><p>ğŸ’¡ ä½ å¯ä»¥è¯•è¯•çœ‹ <code>lsblk</code> å’Œ <code>lsscsi</code>ï¼Œçœ‹çœ‹ RAID è®¾å¤‡çš„æƒ…å†µï¼Œç„¶åå‘Šè¯‰æˆ‘ä½ çš„ RAID å¡æ˜¯ä»€ä¹ˆå‹å·ï¼Œæˆ‘å¯ä»¥å¸®ä½ æ‰¾åˆ°å¯¹åº”çš„ç®¡ç†å·¥å…·ï¼ ğŸš€</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h2><ol><li><strong>RAID ä¸»è¦åˆ†ä¸º RAID 0&#x2F;1&#x2F;5&#x2F;6&#x2F;10</strong>ï¼Œä¸åŒçº§åˆ«æä¾›ä¸åŒçš„<strong>å®‰å…¨æ€§ã€æ€§èƒ½å’Œç£ç›˜åˆ©ç”¨ç‡</strong>ã€‚</li><li><strong>ç¡¬ä»¶ RAID ä¾èµ– RAID å¡ï¼Œé€Ÿåº¦å¿«ä½†æˆæœ¬é«˜</strong>ï¼Œé€‚åˆä¼ä¸šå­˜å‚¨ã€‚</li><li><strong>è½¯ä»¶ RAID ä¾èµ–æ“ä½œç³»ç»Ÿç®¡ç†ï¼Œæˆæœ¬ä½ä½†å ç”¨ CPU èµ„æº</strong>ï¼Œé€‚åˆä¸ªäººå’Œä¸­å°å‹å­˜å‚¨ã€‚</li><li><strong>Linux å¯ä»¥ä½¿ç”¨</strong> <code>mdadm</code> <strong>é…ç½®è½¯ä»¶ RAID</strong>ï¼Œæ”¯æŒ RAID 0&#x2F;1&#x2F;5&#x2F;6&#x2F;10ã€‚</li></ol><p>å¦‚æœä½ æƒ³åœ¨ Debian 11 ä¸Š <strong>å®è·µ RAID é…ç½®</strong>ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„ç£ç›˜æƒ…å†µï¼Œæˆ‘å¯ä»¥æä¾›å…·ä½“çš„ <code>mdadm</code> é…ç½®æ­¥éª¤ï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GPTåˆ†åŒºè¡¨æ ¼å¼çš„ä¸¤ç§åˆ›å»ºæ–¹å¼</title>
    <link href="/2025/03/28/GPT%E5%88%86%E5%8C%BA%E8%A1%A8%E6%A0%BC%E5%BC%8F%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F/"/>
    <url>/2025/03/28/GPT%E5%88%86%E5%8C%BA%E8%A1%A8%E6%A0%BC%E5%BC%8F%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h3 id="MBRå’ŒGPTåˆ†åŒºè¡¨çš„ä¿¡æ¯"><a href="#MBRå’ŒGPTåˆ†åŒºè¡¨çš„ä¿¡æ¯" class="headerlink" title="MBRå’ŒGPTåˆ†åŒºè¡¨çš„ä¿¡æ¯"></a>MBRå’ŒGPTåˆ†åŒºè¡¨çš„ä¿¡æ¯</h3><h4 id="MBRï¼ˆMaster-Boot-Recordï¼‰"><a href="#MBRï¼ˆMaster-Boot-Recordï¼‰" class="headerlink" title="MBRï¼ˆMaster Boot Recordï¼‰"></a>MBRï¼ˆMaster Boot Recordï¼‰</h4><ul><li><strong>åˆ†åŒºè¡¨ç±»å‹</strong>ï¼š<code>fdisk</code> é»˜è®¤ä½¿ç”¨ MBR åˆ†åŒºè¡¨ã€‚</li><li><strong>æœ€å¤§åˆ†åŒºæ•°é‡</strong>ï¼šMBR æ”¯æŒæœ€å¤š 4 ä¸ªä¸»åˆ†åŒºï¼Œæˆ–è€… 3 ä¸ªä¸»åˆ†åŒºåŠ  1 ä¸ªæ‰©å±•åˆ†åŒºï¼ˆå¯ä»¥åŒ…å«å¤šä¸ªé€»è¾‘åˆ†åŒºï¼‰ã€‚</li><li><strong>æœ€å¤§ç£ç›˜å¤§å°</strong>ï¼šMBR æ”¯æŒçš„æœ€å¤§ç£ç›˜å¤§å°ä¸º 2TBã€‚</li><li><strong>å¯åŠ¨ä¿¡æ¯</strong>ï¼šMBR åœ¨ç£ç›˜çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºä¸­å­˜å‚¨å¼•å¯¼åŠ è½½ç¨‹åºå’Œåˆ†åŒºè¡¨ä¿¡æ¯ã€‚</li></ul><h4 id="GPTï¼ˆGUID-Partition-Tableï¼‰"><a href="#GPTï¼ˆGUID-Partition-Tableï¼‰" class="headerlink" title="GPTï¼ˆGUID Partition Tableï¼‰"></a>GPTï¼ˆGUID Partition Tableï¼‰</h4><ul><li><strong>åˆ†åŒºè¡¨ç±»å‹</strong>ï¼š<code>parted</code> é»˜è®¤åˆ›å»º GPT åˆ†åŒºè¡¨ã€‚  ã€‚</li><li><strong>æœ€å¤§åˆ†åŒºæ•°é‡</strong>ï¼š GPT æœ€å¤šæ”¯æŒ 128 ä¸ªåˆ†åŒº  ã€‚</li><li><strong>æœ€å¤§ç£ç›˜å¤§å°</strong>ï¼š GPT æœ€å¤§æ”¯æŒ 9.4 ZB  ã€‚</li><li><strong>å¯åŠ¨ä¿¡æ¯</strong>ï¼šä½¿ç”¨ UEFI è¿›è¡Œå¼•å¯¼ï¼Œå…·æœ‰å†—ä½™çš„åˆ†åŒºè¡¨å­˜å‚¨ã€‚</li></ul><h3 id="ä¸¤ç§æ–¹å¼åˆ›å»ºGPTåˆ†åŒº"><a href="#ä¸¤ç§æ–¹å¼åˆ›å»ºGPTåˆ†åŒº" class="headerlink" title="ä¸¤ç§æ–¹å¼åˆ›å»ºGPTåˆ†åŒº"></a>ä¸¤ç§æ–¹å¼åˆ›å»ºGPTåˆ†åŒº</h3><h4 id="ä½¿ç”¨fdisk-åˆ›å»ºGPTåˆ†åŒº"><a href="#ä½¿ç”¨fdisk-åˆ›å»ºGPTåˆ†åŒº" class="headerlink" title="ä½¿ç”¨fdisk åˆ›å»ºGPTåˆ†åŒº"></a>ä½¿ç”¨fdisk åˆ›å»ºGPTåˆ†åŒº</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># root @ debian in ~ [17:51:36] </span><br>$ lsblk<br>NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT<br>sda      8:0    0   400G  0 disk <br>â””â”€sda1   8:1    0   400G  0 part /<br>sdb      8:16   0   100G  0 disk <br>sdc      8:32   0   100G  0 disk <br>sdd      8:48   0   100G  0 disk <br>sr0     11:0    1 445.7M  0 rom  <br><span class="hljs-comment"># root @ debian in ~ [17:56:34] C:130</span><br>$ fdisk /dev/sdb<br><br>Welcome to fdisk (util-linux 2.36.1).<br>Changes will remain <span class="hljs-keyword">in</span> memory only, <span class="hljs-keyword">until</span> you decide to write them.<br>Be careful before using the write <span class="hljs-built_in">command</span>.<br><br>Device does not contain a recognized partition table.<br>Created a new DOS disklabel with disk identifier 0x829a598b.<br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): m<br><br>Help:<br><br>  DOS (MBR)<br>   a   toggle a bootable flag<br>   b   edit nested BSD disklabel<br>   c   toggle the dos compatibility flag<br><br>  Generic<br>   d   delete a partition<br>   F   list free unpartitioned space<br>   l   list known partition types<br>   n   add a new partition<br>   p   <span class="hljs-built_in">print</span> the partition table<br>   t   change a partition <span class="hljs-built_in">type</span><br>   v   verify the partition table<br>   i   <span class="hljs-built_in">print</span> information about a partition<br><br>  Misc<br>   m   <span class="hljs-built_in">print</span> this menu<br>   u   change display/entry units<br>   x   extra functionality (experts only)<br><br>  Script<br>   I   load disk layout from sfdisk script file<br>   O   dump disk layout to sfdisk script file<br><br>  Save &amp; Exit<br>   w   write table to disk and <span class="hljs-built_in">exit</span><br>   q   quit without saving changes<br><br>  Create a new label<br>   g   create a new empty GPT partition table<br>   G   create a new empty SGI (IRIX) partition table<br>   o   create a new empty DOS partition table<br>   s   create a new empty Sun partition table<br><br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): g  <span class="hljs-comment">#é»˜è®¤æ˜¯mbrï¼ŒæŒ‰gæ‰ä¼šä½¿ç”¨gpt</span><br>Created a new GPT disklabel (GUID: 9324FD1A-EAE8-7E49-B548-C613E8D4D282).<br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): n<br>Partition number (1-128, default 1): 1<br>First sector (2048-209715166, default 2048):  <span class="hljs-comment"># èµ·å§‹æ‰‡åŒº</span><br>Last sector, +/-sectors or +/-size&#123;K,M,G,T,P&#125; (2048-209715166, default 209715166): 109715666 <span class="hljs-comment"># ç»“æŸæ‰‡åŒº</span><br><br>Created a new partition 1 of <span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;Linux filesystem&#x27;</span> and of size 52.3 GiB.<br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): w<br>The partition table has been altered.<br>Calling ioctl() to re-read partition table.<br>Syncing disks.<br><br><br><span class="hljs-comment"># root @ debian in ~ [17:57:45] </span><br>$ fdisk -l /dev/sdb   <span class="hljs-comment"># æŸ¥çœ‹ç£ç›˜çš„åˆ†åŒºä¿¡æ¯ï¼ŒåŒ…æ‹¬åˆ†åŒºè¡¨</span><br>Disk /dev/sdb: 100 GiB, 107374182400 bytes, 209715200 sectors<br>Disk model: Virtual disk    <br>Units: sectors of 1 * 512 = 512 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disklabel <span class="hljs-built_in">type</span>: gpt  <span class="hljs-comment"># åˆ†åŒºè¡¨æ˜¯gpt</span><br>Disk identifier: 9324FD1A-EAE8-7E49-B548-C613E8D4D282<br><br>Device     Start       End   Sectors  Size Type<br>/dev/sdb1   2048 109715666 109713619 52.3G Linux filesystem<br><br><span class="hljs-comment"># root @ debian in ~ [17:58:10] </span><br>$ lsblk -f<br>NAME   FSTYPE  FSVER            LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINT<br>sda                                                                                       <br>â””â”€sda1 ext4    1.0                    f34f1c4a-fb45-4145-b526-1a9985598ea4  305.5G    17% /<br>sdb                                                                                       <br>â””â”€sdb1                                                                                    <br>sdc                                                                                       <br>sdd                                                                                       <br>sr0    iso9660 Joliet Extension CDROM 2023-04-19-20-36-49-00                              <br><br><span class="hljs-comment"># root @ debian in ~ [17:58:20] </span><br>$ mkfs.ext4 /dev/sdb1<br>mke2fs 1.46.2 (28-Feb-2021)<br>Creating filesystem with 13714202 4k blocks and 3432448 inodes<br>Filesystem UUID: 571028b4-f5db-4f0d-86f0-7faca53b9af9<br>Superblock backups stored on blocks: <br>32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, <br>4096000, 7962624, 11239424<br><br>Allocating group tables: <span class="hljs-keyword">done</span>                            <br>Writing inode tables: <span class="hljs-keyword">done</span>                            <br>Creating journal (65536 blocks): <span class="hljs-keyword">done</span><br>Writing superblocks and filesystem accounting information:        <br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># root @ debian in ~ [17:58:41] </span><br>$ lsblk   <br>NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT<br>sda      8:0    0   400G  0 disk <br>â””â”€sda1   8:1    0   400G  0 part /<br>sdb      8:16   0   100G  0 disk <br>â””â”€sdb1   8:17   0  52.3G  0 part <br>sdc      8:32   0   100G  0 disk <br>sdd      8:48   0   100G  0 disk <br>sr0     11:0    1 445.7M  0 rom  <br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨parted-åˆ›å»ºGPTåˆ†åŒº"><a href="#ä½¿ç”¨parted-åˆ›å»ºGPTåˆ†åŒº" class="headerlink" title="ä½¿ç”¨parted åˆ›å»ºGPTåˆ†åŒº"></a>ä½¿ç”¨parted åˆ›å»ºGPTåˆ†åŒº</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># root @ debian in ~ [19:01:58] </span><br>$ lsblk<br>NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT<br>sda      8:0    0   400G  0 disk <br>â””â”€sda1   8:1    0   400G  0 part /<br>sdb      8:16   0   100G  0 disk <br>â””â”€sdb1   8:17   0  52.3G  0 part /sdb1_gpt<br>sdc      8:32   0   100G  0 disk <br>sdd      8:48   0   100G  0 disk <br>sr0     11:0    1 445.7M  0 rom  <br><br><span class="hljs-comment"># root @ debian in ~ [19:02:42] </span><br>$ parted /dev/sdc <span class="hljs-comment"># è¿›å…¥ parted äº¤äº’æ¨¡å¼</span><br>GNU Parted 3.4<br>Using /dev/sdc<br>Welcome to GNU Parted! Type <span class="hljs-string">&#x27;help&#x27;</span> to view a list of commands.<br>(parted) mklabel gpt <span class="hljs-comment"># åˆ›å»º GPT åˆ†åŒºè¡¨</span><br>(parted) mkpart primary ext4 1MiB 100%  <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªæ–°åˆ†åŒº primaryï¼šä¸»åˆ†åŒº  ext4ï¼šæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆå¯é€‰ï¼Œåç»­æ ¼å¼åŒ–æ—¶å¯ä»¥æ›´æ”¹ï¼‰ 1MiBï¼šèµ·å§‹ä½ç½®ï¼ˆè·³è¿‡å‰ 1MB ä»¥å¯¹é½ï¼‰ 100%ï¼šä½¿ç”¨æ•´ä¸ªç£ç›˜ç©ºé—´                               </span><br>(parted) <span class="hljs-built_in">print</span>                                                            <br>  align-check TYPE N                       check partition N <span class="hljs-keyword">for</span> TYPE(min|opt) alignment<br>  <span class="hljs-built_in">help</span> [COMMAND]                           <span class="hljs-built_in">print</span> general <span class="hljs-built_in">help</span>, or <span class="hljs-built_in">help</span> on COMMAND<br>  mklabel,mktable LABEL-TYPE               create a new disklabel (partition table)<br>  mkpart PART-TYPE [FS-TYPE] START END     make a partition<br>  name NUMBER NAME                         name partition NUMBER as NAME<br>  <span class="hljs-built_in">print</span> [devices|free|list,all|NUMBER]     display the partition table, available devices, free space, all found partitions, or a particular partition<br>  quit                                     <span class="hljs-built_in">exit</span> program<br>  rescue START END                         rescue a lost partition near START and END<br>  resizepart NUMBER END                    resize partition NUMBER<br>  <span class="hljs-built_in">rm</span> NUMBER                                delete partition NUMBER<br>  <span class="hljs-keyword">select</span> DEVICE                            choose the device to edit<br>  disk_set FLAG STATE                      change the FLAG on selected device<br>  disk_toggle [FLAG]                       toggle the state of FLAG on selected device<br>  <span class="hljs-built_in">set</span> NUMBER FLAG STATE                    change the FLAG on partition NUMBER<br>  toggle [NUMBER [FLAG]]                   toggle the state of FLAG on partition NUMBER<br>  unit UNIT                                <span class="hljs-built_in">set</span> the default unit to UNIT<br>  version                                  display the version number and copyright information of GNU Parted<br>(parted) quit                                                             <br>Information: You may need to update /etc/fstab.<br><br><br><span class="hljs-comment"># root @ debian in ~ [19:09:36] </span><br>$ partprobe /dev/sdb  <span class="hljs-comment"># é‡æ–°åŠ è½½åˆ†åŒºè¡¨</span><br><br><span class="hljs-comment"># root @ debian in ~ [19:09:48] </span><br>$ lsblk<br>NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT<br>sda      8:0    0   400G  0 disk <br>â””â”€sda1   8:1    0   400G  0 part /<br>sdb      8:16   0   100G  0 disk <br>â””â”€sdb1   8:17   0  52.3G  0 part /sdb1_gpt<br>sdc      8:32   0   100G  0 disk <br>â””â”€sdc1   8:33   0   100G  0 part <br>sdd      8:48   0   100G  0 disk <br>sr0     11:0    1 445.7M  0 rom  <br><br><span class="hljs-comment"># root @ debian in ~ [19:09:51] </span><br>$ lsblk -f<br>NAME   FSTYPE  FSVER            LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINT<br>sda                                                                                       <br>â””â”€sda1 ext4    1.0                    f34f1c4a-fb45-4145-b526-1a9985598ea4  305.5G    17% /<br>sdb                                                                                       <br>â””â”€sdb1 ext4    1.0                    571028b4-f5db-4f0d-86f0-7faca53b9af9   48.6G     0% /sdb1_gpt<br>sdc                                                                                       <br>â””â”€sdc1                                                                                    <br>sdd                                                                                       <br>sr0    iso9660 Joliet Extension CDROM 2023-04-19-20-36-49-00<br><span class="hljs-comment"># root @ debian in ~ [19:10:29] </span><br>$ parted /dev/sdc <span class="hljs-built_in">print</span> <span class="hljs-comment"># æŸ¥çœ‹ç£ç›˜çš„åˆ†åŒºä¿¡æ¯</span><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdc: 107GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt<br>Disk Flags: <br><br>Number  Start   End    Size   File system  Name     Flags<br> 1      1049kB  107GB  107GB               primary<br></code></pre></td></tr></table></figure><h3 id="åˆ é™¤åˆ†åŒº"><a href="#åˆ é™¤åˆ†åŒº" class="headerlink" title="åˆ é™¤åˆ†åŒº"></a>åˆ é™¤åˆ†åŒº</h3><h4 id="ä½¿ç”¨fdisk"><a href="#ä½¿ç”¨fdisk" class="headerlink" title="ä½¿ç”¨fdisk"></a>ä½¿ç”¨fdisk</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># root @ debian in ~ [19:19:10] </span><br>$ fdisk /dev/sdb<br><br>Welcome to fdisk (util-linux 2.36.1).<br>Changes will remain <span class="hljs-keyword">in</span> memory only, <span class="hljs-keyword">until</span> you decide to write them.<br>Be careful before using the write <span class="hljs-built_in">command</span>.<br><br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): m<br><br>Help:<br><br>  GPT<br>   M   enter protective/hybrid MBR<br><br>  Generic<br>   d   delete a partition<br>   F   list free unpartitioned space<br>   l   list known partition types<br>   n   add a new partition<br>   p   <span class="hljs-built_in">print</span> the partition table<br>   t   change a partition <span class="hljs-built_in">type</span><br>   v   verify the partition table<br>   i   <span class="hljs-built_in">print</span> information about a partition<br><br>  Misc<br>   m   <span class="hljs-built_in">print</span> this menu<br>   x   extra functionality (experts only)<br><br>  Script<br>   I   load disk layout from sfdisk script file<br>   O   dump disk layout to sfdisk script file<br><br>  Save &amp; Exit<br>   w   write table to disk and <span class="hljs-built_in">exit</span><br>   q   quit without saving changes<br><br>  Create a new label<br>   g   create a new empty GPT partition table<br>   G   create a new empty SGI (IRIX) partition table<br>   o   create a new empty DOS partition table<br>   s   create a new empty Sun partition table<br><br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): d<br>Selected partition 1<br>Partition 1 has been deleted.<br><br>Command (m <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>): w<br>The partition table has been altered.<br>Calling ioctl() to re-read partition table.<br>Syncing disks.<br><br><br><span class="hljs-comment"># root @ debian in ~ [19:19:47] </span><br>$ lsblk -f      <br>NAME   FSTYPE  FSVER            LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINT<br>sda                                                                                       <br>â””â”€sda1 ext4    1.0                    f34f1c4a-fb45-4145-b526-1a9985598ea4  305.5G    17% /<br>sdb                                                                                       <br>sdc                                                                                       <br>sdd                                                                                       <br>sr0    iso9660 Joliet Extension CDROM 2023-04-19-20-36-49-00   <br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨parted"><a href="#ä½¿ç”¨parted" class="headerlink" title="ä½¿ç”¨parted"></a>ä½¿ç”¨parted</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># root @ debian in ~ [19:15:48] </span><br>$ parted /dev/sdc<br>GNU Parted 3.4<br>Using /dev/sdc<br>Welcome to GNU Parted! Type <span class="hljs-string">&#x27;help&#x27;</span> to view a list of commands.<br>(parted) <span class="hljs-built_in">print</span>                                                            <br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdc: 107GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt<br>Disk Flags: <br><br>Number  Start   End    Size   File system  Name     Flags<br> 1      1049kB  107GB  107GB               primary<br><br>(parted) <span class="hljs-built_in">help</span>                                                             <br>  align-check TYPE N                       check partition N <span class="hljs-keyword">for</span> TYPE(min|opt) alignment<br>  <span class="hljs-built_in">help</span> [COMMAND]                           <span class="hljs-built_in">print</span> general <span class="hljs-built_in">help</span>, or <span class="hljs-built_in">help</span> on COMMAND<br>  mklabel,mktable LABEL-TYPE               create a new disklabel (partition table)<br>  mkpart PART-TYPE [FS-TYPE] START END     make a partition<br>  name NUMBER NAME                         name partition NUMBER as NAME<br>  <span class="hljs-built_in">print</span> [devices|free|list,all|NUMBER]     display the partition table, available devices, free space, all found partitions, or a particular partition<br>  quit                                     <span class="hljs-built_in">exit</span> program<br>  rescue START END                         rescue a lost partition near START and END<br>  resizepart NUMBER END                    resize partition NUMBER<br>  <span class="hljs-built_in">rm</span> NUMBER                                delete partition NUMBER<br>  <span class="hljs-keyword">select</span> DEVICE                            choose the device to edit<br>  disk_set FLAG STATE                      change the FLAG on selected device<br>  disk_toggle [FLAG]                       toggle the state of FLAG on selected device<br>  <span class="hljs-built_in">set</span> NUMBER FLAG STATE                    change the FLAG on partition NUMBER<br>  toggle [NUMBER [FLAG]]                   toggle the state of FLAG on partition NUMBER<br>  unit UNIT                                <span class="hljs-built_in">set</span> the default unit to UNIT<br>  version                                  display the version number and copyright information of GNU Parted<br>(parted) <span class="hljs-built_in">rm</span> 1                                                             <br>(parted) <span class="hljs-built_in">print</span>                                                            <br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdc: 107GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt<br>Disk Flags: <br><br>Number  Start  End  Size  File system  Name  Flags<br><br>(parted) quit                                                             <br>Information: You may need to update /etc/fstab.<br><br><br><span class="hljs-comment"># root @ debian in ~ [19:17:23] </span><br>$ parted /dev/sdc <span class="hljs-built_in">print</span><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdc: 107GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt<br>Disk Flags: <br><br>Number  Start  End  Size  File system  Name  Flags<br><br><br><span class="hljs-comment"># root @ debian in ~ [19:17:29] </span><br>$ lsblk -f<br>NAME   FSTYPE  FSVER            LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINT<br>sda                                                                                       <br>â””â”€sda1 ext4    1.0                    f34f1c4a-fb45-4145-b526-1a9985598ea4  305.5G    17% /<br>sdb                                                                                       <br>â””â”€sdb1 ext4    1.0                    571028b4-f5db-4f0d-86f0-7faca53b9af9   48.6G     0% /sdb1_gpt<br>sdc                                                                                       <br>sdd                                                                                       <br>sr0    iso9660 Joliet Extension CDROM 2023-04-19-20-36-49-00    <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux ç£ç›˜IOè¯»å†™æ€§èƒ½æ’æŸ¥æŒ‡å—</title>
    <link href="/2025/03/13/Linux-%E7%A3%81%E7%9B%98IO%E8%AF%BB%E5%86%99%E6%80%A7%E8%83%BD%E6%8E%92%E6%9F%A5%E6%8C%87%E5%8D%97/"/>
    <url>/2025/03/13/Linux-%E7%A3%81%E7%9B%98IO%E8%AF%BB%E5%86%99%E6%80%A7%E8%83%BD%E6%8E%92%E6%9F%A5%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>ç¡®ä¿ç³»ç»Ÿä¸­å·²å®‰è£…ä¸‹åˆ—å·¥å…·ï¼š</p><ul><li><strong>sysstat</strong>ï¼ˆåŒ…å« <code>iostat</code>ï¼‰</li><li><strong>smartmontools</strong>ï¼ˆåŒ…å« <code>smartctl</code>ï¼‰</li><li><strong>hdparm</strong></li><li><strong>dd</strong>ï¼ˆè‡ªå¸¦ï¼Œä¸€èˆ¬Linuxé»˜è®¤å®‰è£…ï¼‰</li></ul><p>å®‰è£…ç¤ºä¾‹ï¼ˆåŸºäºDebian&#x2F;Ubuntuï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt-get install sysstat smartmontools hdparm<br></code></pre></td></tr></table></figure><h2 id="æ’æŸ¥æ­¥éª¤"><a href="#æ’æŸ¥æ­¥éª¤" class="headerlink" title="æ’æŸ¥æ­¥éª¤"></a>æ’æŸ¥æ­¥éª¤</h2><h3 id="1-æ£€æŸ¥ç³»ç»Ÿæ•´ä½“è´Ÿè½½"><a href="#1-æ£€æŸ¥ç³»ç»Ÿæ•´ä½“è´Ÿè½½" class="headerlink" title="1. æ£€æŸ¥ç³»ç»Ÿæ•´ä½“è´Ÿè½½"></a>1. æ£€æŸ¥ç³»ç»Ÿæ•´ä½“è´Ÿè½½</h3><p>é¦–å…ˆï¼Œä½¿ç”¨ <code>top</code> æˆ– <code>htop</code> æŸ¥çœ‹ç³»ç»Ÿæ•´ä½“è´Ÿè½½æƒ…å†µï¼Œå…³æ³¨ï¼š</p><ul><li>CPU åˆ©ç”¨ç‡ä¸­æ˜¯å¦æœ‰è¾ƒé«˜çš„ <strong>iowait</strong> æ—¶é—´</li><li>æ˜¯å¦å­˜åœ¨å¼‚å¸¸è¿›ç¨‹å ç”¨å¤§é‡IOèµ„æºã€</li></ul><p> åœ¨ top çš„ç¬¬ä¸€å±ä¸­ï¼Œä¼šæœ‰ä¸€è¡Œæ˜¾ç¤º CPU çš„æ•´ä½“åˆ©ç”¨ç‡ï¼Œé€šå¸¸æ ¼å¼ç±»ä¼¼äºï¼š  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">%Cpu(s):  3.0 us,  1.0 sy,  0.0 ni, 95.0 <span class="hljs-built_in">id</span>,  1.0 wa,  0.0 hi,  0.0 si,  0.0 st<br></code></pre></td></tr></table></figure><ul><li><strong>us (user)</strong>ï¼šç”¨æˆ·ç©ºé—´å ç”¨çš„ CPU æ—¶é—´ã€‚</li><li><strong>sy (system)</strong>ï¼šå†…æ ¸ç©ºé—´å ç”¨çš„ CPU æ—¶é—´ã€‚</li><li><strong>ni (nice)</strong>ï¼šä½ä¼˜å…ˆçº§è¿›ç¨‹å ç”¨çš„ CPU æ—¶é—´ã€‚</li><li><strong>id (idle)</strong>ï¼šç©ºé—²æ—¶é—´ã€‚</li><li><strong>wa (iowait)</strong>ï¼šç­‰å¾… I&#x2F;O å®Œæˆçš„ CPU æ—¶é—´ã€‚</li><li><strong>hi&#x2F;si</strong>ï¼šç¡¬ä¸­æ–­&#x2F;è½¯ä¸­æ–­å ç”¨çš„ CPU æ—¶é—´ã€‚</li><li><strong>st</strong>ï¼šè¢«è™šæ‹Ÿæœºå·å–çš„ CPU æ—¶é—´ã€‚</li></ul><h3 id="1-1-æŸ¥çœ‹-iowait-æŒ‡æ ‡"><a href="#1-1-æŸ¥çœ‹-iowait-æŒ‡æ ‡" class="headerlink" title="1.1 æŸ¥çœ‹ iowait æŒ‡æ ‡"></a>1.1 æŸ¥çœ‹ iowait æŒ‡æ ‡</h3><ul><li><p><strong>iowait (wa)</strong> è¡¨ç¤º CPU ç­‰å¾…ç£ç›˜ I&#x2F;O æ“ä½œå®Œæˆçš„æ—¶é—´æ¯”ä¾‹ã€‚ </p></li><li><ul><li>æ­£å¸¸æƒ…å†µä¸‹ï¼Œwa æ•°å€¼è¾ƒä½ï¼ˆä¾‹å¦‚ 3%ï½5%ï¼‰ï¼Œè¯´æ˜ç£ç›˜ I&#x2F;O å“åº”è¾ƒå¿«ã€‚</li><li>å¦‚æœå‘ç° wa å€¼æŒç»­è¾ƒé«˜ï¼ˆå¦‚ 10% ä»¥ä¸Šï¼‰ï¼Œåˆ™å¯èƒ½å­˜åœ¨ç£ç›˜è¯»å†™ç“¶é¢ˆæˆ–å“åº”ç¼“æ…¢çš„é—®é¢˜ã€‚</li></ul></li></ul><p>ä¾‹å¦‚ï¼Œä½ æåˆ°çš„ wa ä¸º <strong>3.6%</strong>ï¼Œæ€»ä½“æ¥è¯´å¤„äºæ­£å¸¸æ°´å¹³ï¼Œä½†ä»éœ€ç»“åˆå…¶å®ƒæŒ‡æ ‡è¿›ä¸€æ­¥ç¡®è®¤ç³»ç»Ÿçš„æ•´ä½“ I&#x2F;O çŠ¶æ€ã€‚</p><h3 id="1-2-æ£€æŸ¥è¿›ç¨‹çŠ¶æ€"><a href="#1-2-æ£€æŸ¥è¿›ç¨‹çŠ¶æ€" class="headerlink" title="1.2 æ£€æŸ¥è¿›ç¨‹çŠ¶æ€"></a>1.2 æ£€æŸ¥è¿›ç¨‹çŠ¶æ€</h3><p>åœ¨ top çš„è¿›ç¨‹åˆ—è¡¨ä¸­ï¼Œé‡ç‚¹å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><p><strong>è¿›ç¨‹çŠ¶æ€ï¼ˆSTAT åˆ—ï¼‰</strong>ï¼š</p></li><li><ul><li><strong>D çŠ¶æ€</strong>ï¼šè¡¨ç¤ºè¿›ç¨‹å¤„äºä¸å¯ä¸­æ–­ç¡çœ çŠ¶æ€ï¼Œé€šå¸¸ä¸ç­‰å¾… I&#x2F;O æœ‰å…³ã€‚å¦‚æœæœ‰è¿›ç¨‹é•¿æ—¶é—´å¤„äº D çŠ¶æ€ï¼Œå¯èƒ½æ­£åœ¨ç­‰å¾…ç£ç›˜æ“ä½œã€‚</li></ul></li><li><p><strong>CPU å ç”¨ï¼ˆ%CPU åˆ—ï¼‰</strong>ï¼š</p></li><li><ul><li>æ£€æŸ¥æ˜¯å¦æœ‰æŸä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å ç”¨å¼‚å¸¸é«˜çš„ CPU èµ„æºã€‚é«˜ CPU å ç”¨æœ¬èº«ä¸ä¸€å®šè¡¨ç¤º I&#x2F;O é—®é¢˜ï¼Œä½†å¦‚æœç»“åˆé«˜ iowaitï¼Œåˆ™å¯èƒ½æ˜¯ I&#x2F;O å¯†é›†å‹è¿›ç¨‹åœ¨ç­‰å¾…ç£ç›˜å“åº”ã€‚</li></ul></li><li><p><strong>ç´¯è®¡æ—¶é—´ï¼ˆTIME+ åˆ—ï¼‰</strong>ï¼š</p></li><li><ul><li>è¡¨ç¤ºè¿›ç¨‹è‡ªå¯åŠ¨ä»¥æ¥ç´¯è®¡ä½¿ç”¨çš„ CPU æ—¶é—´ï¼Œå¯¹äºé•¿æ—¶é—´è¿è¡Œä¸” I&#x2F;O å¯†é›†çš„è¿›ç¨‹ï¼Œå¯ä»¥å¸®åŠ©åˆ¤æ–­å…¶è´Ÿè½½æƒ…å†µã€‚</li></ul></li></ul><p>ä¾‹å¦‚ï¼Œåœ¨è¿›ç¨‹åˆ—è¡¨ä¸­çœ‹åˆ°å¦‚ä¸‹è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND<br>1234 root      20   0  123456   7890   2345 D   0.0   0.1   0:00.12 some_process<br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œè¿›ç¨‹ <code>some_process</code> çš„çŠ¶æ€ä¸º <strong>D</strong>ï¼Œè¡¨ç¤º<strong>å®ƒå¯èƒ½æ­£åœ¨ç­‰å¾…ç£ç›˜ I&#x2F;O æ“ä½œ</strong>ã€‚å¦‚æœè¿™ç§çŠ¶æ€çš„è¿›ç¨‹æ•°é‡è¾ƒå¤šæˆ–æŒç»­æ—¶é—´è¾ƒé•¿ï¼Œåˆ™éœ€è¦é‡ç‚¹æ’æŸ¥ã€‚</p><h3 id="2-ä½¿ç”¨-iostat-æŸ¥çœ‹ç£ç›˜åˆ©ç”¨ç‡"><a href="#2-ä½¿ç”¨-iostat-æŸ¥çœ‹ç£ç›˜åˆ©ç”¨ç‡" class="headerlink" title="2. ä½¿ç”¨ iostat æŸ¥çœ‹ç£ç›˜åˆ©ç”¨ç‡"></a>2. ä½¿ç”¨ iostat æŸ¥çœ‹ç£ç›˜åˆ©ç”¨ç‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@luffy ~]# iostat --<span class="hljs-built_in">help</span><br>Usage: iostat [ options ] [ &lt;interval&gt; [ &lt;count&gt; ] ]<br>Options are:<br>[ -c ] [ -d ] [ -h ] [ -k | -m ] [ -N ] [ -t ] [ -V ] [ -x ] [ -y ] [ -z ]<br>[ -j &#123; ID | LABEL | PATH | UUID | ... &#125; ]<br>[ [ -T ] -g &lt;group_name&gt; ] [ -p [ &lt;device&gt; [,...] | ALL ] ]<br>[ &lt;device&gt; [...] | ALL ]<br></code></pre></td></tr></table></figure><p>é€‰é¡¹ï¼š</p><ul><li>-cï¼šä»…æ˜¾ç¤º CPU ä½¿ç”¨æƒ…å†µï¼›</li><li>-dï¼šä»…æ˜¾ç¤ºè®¾å¤‡åˆ©ç”¨ç‡ï¼›</li><li>-kï¼šæ˜¾ç¤ºçŠ¶æ€ä»¥åƒå­—èŠ‚æ¯ç§’ä¸ºå•ä½ï¼Œè€Œä¸ä½¿ç”¨å—æ¯ç§’ï¼›</li><li>-mï¼šæ˜¾ç¤ºçŠ¶æ€ä»¥å…†å­—èŠ‚æ¯ç§’ä¸ºå•ä½ï¼›</li><li>-pï¼šä»…æ˜¾ç¤ºå—è®¾å¤‡å’Œæ‰€æœ‰è¢«ä½¿ç”¨çš„å…¶ä»–åˆ†åŒºçš„çŠ¶æ€ï¼›</li><li>-tï¼šæ˜¾ç¤ºæ¯ä¸ªæŠ¥å‘Šäº§ç”Ÿæ—¶çš„æ—¶é—´ï¼›</li><li>-Vï¼šæ˜¾ç¤ºç‰ˆå·å¹¶é€€å‡ºï¼›</li><li>-xï¼šæ˜¾ç¤ºæ‰©å±•çŠ¶æ€ã€‚</li></ul><p>å‚æ•°ï¼š</p><p>é—´éš”æ—¶é—´ï¼šæ¯æ¬¡æŠ¥å‘Šçš„é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰ï¼›</p><p>æ¬¡æ•°ï¼šæ˜¾ç¤ºæŠ¥å‘Šçš„æ¬¡æ•°ã€‚</p><h4 id="2-1-ä½¿ç”¨ç¤ºä¾‹"><a href="#2-1-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="2.1 ä½¿ç”¨ç¤ºä¾‹"></a>2.1 ä½¿ç”¨ç¤ºä¾‹</h4><p>-d å‚æ•°</p><p>å‚æ•° -d è¡¨ç¤ºï¼Œæ˜¾ç¤ºè®¾å¤‡ï¼ˆç£ç›˜ï¼‰ä½¿ç”¨çŠ¶æ€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@luffy ~]# iostat -d 10<br>Linux 3.10.0-1160.105.1.el7.x86_64 (luffy.super) 03/13/2025 _x86_64_(16 CPU)<br><br>Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn<br>sdb               0.00         0.00         0.00      10929       2048<br>sda              28.07         2.73       257.90    6566161  619903894<br>scd0              0.47        17.33         0.00   41664468          0<br>dm-0             30.26         2.72       257.89    6531997  619895566<br>dm-1              0.00         0.00         0.00       2312       6240<br></code></pre></td></tr></table></figure><p>è¾“å‡ºä¿¡æ¯çš„å«ä¹‰ï¼š</p><ul><li>tpsï¼šè¯¥è®¾å¤‡æ¯ç§’çš„ä¼ è¾“æ¬¡æ•°ã€‚â€ä¸€æ¬¡ä¼ è¾“â€ æ„æ€æ˜¯ â€œä¸€æ¬¡ I&#x2F;O è¯·æ±‚â€ã€‚å¤šä¸ªé€»è¾‘è¯·æ±‚å¯èƒ½ä¼šè¢«åˆå¹¶ä¸º â€œä¸€æ¬¡ I&#x2F;O è¯·æ±‚â€ã€‚â€ä¸€æ¬¡ä¼ è¾“â€ è¯·æ±‚çš„å¤§å°æ˜¯æœªçŸ¥çš„ã€‚</li><li>kB_read&#x2F;sï¼šæ¯ç§’ä»è®¾å¤‡è¯»å–çš„æ•°æ®é‡ï¼›</li><li>kB_wrtn&#x2F;sï¼šæ¯ç§’å‘è®¾å¤‡å†™å…¥çš„æ•°æ®é‡ï¼›</li><li>kB_readï¼šè¯»å–çš„æ€»æ•°æ®é‡ï¼›</li><li>kB_wrtnï¼šå†™å…¥çš„æ€»æ•°é‡æ•°æ®é‡ã€‚</li></ul><p>è¿™äº›å•ä½éƒ½ä¸º Kilobytesã€‚</p><h5 id="c-å‚æ•°"><a href="#c-å‚æ•°" class="headerlink" title="-c å‚æ•°"></a>-c å‚æ•°</h5><p>-c å‚æ•°æ˜¾ç¤º CPU ä½¿ç”¨æƒ…å†µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@luffy ~]#  iostat -c<br>Linux 3.10.0-1160.105.1.el7.x86_64 (luffy.super) 03/13/2025 _x86_64_(16 CPU)<br><br>avg-cpu:  %user   %<span class="hljs-built_in">nice</span> %system %iowait  %steal   %idle<br>           0.37    0.00    0.18    0.02    0.00   99.43<br></code></pre></td></tr></table></figure><p>è¾“å‡ºä¿¡æ¯çš„å«ä¹‰ï¼š</p><ul><li>% userï¼šCPU å¤„åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹çš„æ—¶é—´ç™¾åˆ†æ¯”ã€‚</li><li>% niceï¼šCPU å¤„åœ¨å¸¦ NICE å€¼çš„ç”¨æˆ·æ¨¡å¼ä¸‹çš„æ—¶é—´ç™¾åˆ†æ¯”ã€‚</li><li>% systemï¼šCPU å¤„åœ¨ç³»ç»Ÿæ¨¡å¼ä¸‹çš„æ—¶é—´ç™¾åˆ†æ¯”ã€‚</li><li>% iowaitï¼šCPU ç­‰å¾…è¾“å…¥è¾“å‡ºå®Œæˆæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚</li><li>% stealï¼šç®¡ç†ç¨‹åºç»´æŠ¤å¦ä¸€ä¸ªè™šæ‹Ÿå¤„ç†å™¨æ—¶ï¼Œè™šæ‹Ÿ CPU çš„æ— æ„è¯†ç­‰å¾…æ—¶é—´ç™¾åˆ†æ¯”ã€‚</li><li>% idleï¼šCPU ç©ºé—²æ—¶é—´ç™¾åˆ†æ¯”ã€‚</li></ul><p>å¤‡æ³¨ï¼šå¦‚æœ % iowait çš„å€¼è¿‡é«˜ï¼Œè¡¨ç¤ºç¡¬ç›˜å­˜åœ¨ I&#x2F;O ç“¶é¢ˆï¼Œ% idle å€¼é«˜ï¼Œè¡¨ç¤º CPU è¾ƒç©ºé—²ï¼Œå¦‚æœ % idle å€¼é«˜ä½†ç³»ç»Ÿå“åº”æ…¢æ—¶ï¼Œæœ‰å¯èƒ½æ˜¯ CPU ç­‰å¾…åˆ†é…å†…å­˜ï¼Œæ­¤æ—¶åº”åŠ å¤§å†…å­˜å®¹é‡ã€‚% idle å€¼å¦‚æœæŒç»­ä½äº 10ï¼Œé‚£ä¹ˆç³»ç»Ÿçš„ CPU å¤„ç†èƒ½åŠ›ç›¸å¯¹è¾ƒä½ï¼Œè¡¨æ˜ç³»ç»Ÿä¸­æœ€éœ€è¦è§£å†³çš„èµ„æºæ˜¯ CPUã€‚</p><h5 id="x-å‚æ•°"><a href="#x-å‚æ•°" class="headerlink" title="-x å‚æ•°"></a>-x å‚æ•°</h5><p>æ¯éš”ä¸‰ç§’æŸ¥çœ‹ä¸€æ¬¡å®Œæ•´ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@luffy ~]# iostat -x 3<br>Linux 3.10.0-1160.105.1.el7.x86_64 (luffy.super) 03/13/2025 _x86_64_(16 CPU)<br><br>avg-cpu:  %user   %<span class="hljs-built_in">nice</span> %system %iowait  %steal   %idle<br>           0.37    0.00    0.18    0.02    0.00   99.43<br><br>Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util<br>sdb               0.00     0.00    0.00    0.00     0.00     0.00   104.24     0.00    3.22    3.03   15.00   2.40   0.00<br>sda               0.00     2.19    0.03   28.04     2.73   257.98    18.57     0.53   19.00   34.10   18.98   0.34   0.96<br>scd0              0.00     0.00    0.47    0.00    17.33     0.00    74.29     0.00    0.10    0.10    0.00   0.08   0.00<br>dm-0              0.00     0.00    0.03   30.23     2.72   257.97    17.23     0.62   20.42   34.30   20.40   0.32   0.96<br>dm-1              0.00     0.00    0.00    0.00     0.00     0.00    10.21     0.00   32.21   11.90   33.71   1.18   0.00<br><br>avg-cpu:  %user   %<span class="hljs-built_in">nice</span> %system %iowait  %steal   %idle<br>           0.60    0.00    0.40    0.19    0.00   98.81<br><br>Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util<br>sdb               0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00<br>sda               0.00    51.00    0.00  304.00     0.00  2977.33    19.59     8.30   27.30    0.00   27.30   0.32   9.77<br>scd0              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00<br>dm-0              0.00     0.00    0.00  355.00     0.00  2977.33    16.77    11.77   33.14    0.00   33.14   0.28   9.77<br>dm-1              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00<br></code></pre></td></tr></table></figure><p><strong>è¾“å‡ºä¿¡æ¯çš„å«ä¹‰ï¼š</strong></p><ul><li>rrqm&#x2F;sï¼šæ¯ç§’è¿™ä¸ªè®¾å¤‡ç›¸å…³çš„è¯»å–è¯·æ±‚æœ‰å¤šå°‘è¢« Merge äº†ï¼ˆå½“ç³»ç»Ÿè°ƒç”¨éœ€è¦è¯»å–æ•°æ®çš„æ—¶å€™ï¼ŒVFS å°†è¯·æ±‚å‘åˆ°å„ä¸ª FSï¼Œå¦‚æœ FS å‘ç°ä¸åŒçš„è¯»å–è¯·æ±‚è¯»å–çš„æ˜¯ç›¸åŒ Block çš„æ•°æ®ï¼ŒFS ä¼šå°†è¿™ä¸ªè¯·æ±‚åˆå¹¶ Mergeï¼‰ï¼›</li><li>wrqm&#x2F;sï¼šæ¯ç§’è¿™ä¸ªè®¾å¤‡ç›¸å…³çš„å†™å…¥è¯·æ±‚æœ‰å¤šå°‘è¢« Merge äº†ã€‚</li><li>r&#x2F;sï¼šæ¯ç§’è¯»å–çš„æ‰‡åŒºæ•°ï¼›</li><li>w&#x2F;sï¼šæ¯ç§’å†™å…¥çš„æ‰‡åŒºæ•°ã€‚</li><li>rKB&#x2F;sï¼šæ¯ç§’å‘é€åˆ°è®¾å¤‡çš„è¯»å–è¯·æ±‚æ•°ã€‚</li><li>wKB&#x2F;sï¼šæ¯ç§’å‘è®¾å¤‡å‘å‡ºçš„å†™è¯·æ±‚æ•°ã€‚</li><li>avgrq-sz å¹³å‡è¯·æ±‚æ‰‡åŒºçš„å¤§å°</li><li>avgqu-sz æ˜¯å¹³å‡è¯·æ±‚é˜Ÿåˆ—çš„é•¿åº¦ã€‚æ¯«æ— ç–‘é—®ï¼Œé˜Ÿåˆ—é•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚</li><li>awaitï¼š æ¯ä¸€ä¸ª IO è¯·æ±‚çš„å¤„ç†çš„å¹³å‡æ—¶é—´ï¼ˆå•ä½æ˜¯å¾®ç§’æ¯«ç§’ï¼‰ã€‚è¿™é‡Œå¯ä»¥ç†è§£ä¸º IO çš„å“åº”æ—¶é—´ï¼Œä¸€èˆ¬åœ°ç³»ç»Ÿ IO å“åº”æ—¶é—´åº”è¯¥ä½äº 5msï¼Œå¦‚æœå¤§äº 10ms å°±æ¯”è¾ƒå¤§äº†ã€‚è¿™ä¸ªæ—¶é—´åŒ…æ‹¬äº†é˜Ÿåˆ—æ—¶é—´å’ŒæœåŠ¡æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œawait å¤§äº svctmï¼Œå®ƒä»¬çš„å·®å€¼è¶Šå°ï¼Œåˆ™è¯´æ˜é˜Ÿåˆ—æ—¶é—´è¶ŠçŸ­ï¼Œåä¹‹å·®å€¼è¶Šå¤§ï¼Œé˜Ÿåˆ—æ—¶é—´è¶Šé•¿ï¼Œè¯´æ˜ç³»ç»Ÿå‡ºäº†é—®é¢˜ã€‚</li><li>svctm è¡¨ç¤ºå¹³å‡æ¯æ¬¡è®¾å¤‡ I&#x2F;O æ“ä½œçš„æœåŠ¡æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚å¦‚æœ svctm çš„å€¼ä¸ await å¾ˆæ¥è¿‘ï¼Œè¡¨ç¤ºå‡ ä¹æ²¡æœ‰ I&#x2F;O ç­‰å¾…ï¼Œç£ç›˜æ€§èƒ½å¾ˆå¥½ï¼Œå¦‚æœ await çš„å€¼è¿œé«˜äº svctm çš„å€¼ï¼Œåˆ™è¡¨ç¤º I&#x2F;O é˜Ÿåˆ—ç­‰å¾…å¤ªé•¿ï¼Œ ç³»ç»Ÿä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºå°†å˜æ…¢ã€‚</li><li>% utilï¼š åœ¨ç»Ÿè®¡æ—¶é—´å†…æ‰€æœ‰å¤„ç† IO æ—¶é—´ï¼Œé™¤ä»¥æ€»å…±ç»Ÿè®¡æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç»Ÿè®¡é—´éš” 1 ç§’ï¼Œè¯¥è®¾å¤‡æœ‰ 0.8 ç§’åœ¨å¤„ç† IOï¼Œè€Œ 0.2 ç§’é—²ç½®ï¼Œé‚£ä¹ˆè¯¥è®¾å¤‡çš„ % util &#x3D; 0.8&#x2F;1 &#x3D; 80%ï¼Œæ‰€ä»¥è¯¥å‚æ•°æš—ç¤ºäº†è®¾å¤‡çš„ç¹å¿™ç¨‹åº¦ã€‚ä¸€èˆ¬åœ°ï¼Œå¦‚æœè¯¥å‚æ•°æ˜¯ 100% è¡¨ç¤ºè®¾å¤‡å·²ç»æ¥è¿‘æ»¡è´Ÿè·è¿è¡Œäº†ï¼ˆå½“ç„¶å¦‚æœæ˜¯å¤šç£ç›˜ï¼Œå³ä½¿ % util æ˜¯ 100%ï¼Œå› ä¸ºç£ç›˜çš„å¹¶å‘èƒ½åŠ›ï¼Œæ‰€ä»¥ç£ç›˜ä½¿ç”¨æœªå¿…å°±åˆ°äº†ç“¶é¢ˆï¼‰ã€‚</li></ul><p> iostat -x 1 10  æ˜¯æŒ‡æ‰§è¡Œ 10 æ¬¡ï¼Œæ¯ç§’è¾“å‡ºä¸€æ¬¡ä¿¡æ¯ï¼Œé€‚åˆå¿«é€ŸæŸ¥çœ‹ä¸€å®šæ—¶é—´å†…çš„æ€§èƒ½æ•° </p><p> iostat -x 1  æ¯ç§’è¾“å‡ºä¸€æ¬¡ä¿¡æ¯ï¼ŒæŒç»­è¾“å‡ºï¼Œé€‚åˆé•¿æœŸç›‘æ§å’Œè§‚å¯Ÿç³»ç»Ÿæ€§èƒ½ï¼Œç›´åˆ°æ‰‹åŠ¨ç»“æŸ  </p><h3 id="3-è¿›è¡Œè¯»å†™æ€§èƒ½æµ‹è¯•"><a href="#3-è¿›è¡Œè¯»å†™æ€§èƒ½æµ‹è¯•" class="headerlink" title="3. è¿›è¡Œè¯»å†™æ€§èƒ½æµ‹è¯•"></a>3. è¿›è¡Œè¯»å†™æ€§èƒ½æµ‹è¯•</h3><p><strong>dd å‘½ä»¤</strong></p><ul><li><code>**if**</code><strong>ï¼šæŒ‡å®šè¾“å…¥æ–‡ä»¶ï¼ˆ</strong><code>**input file**</code><strong>ï¼‰ã€‚</strong></li><li><code>**of**</code><strong>ï¼šæŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼ˆ</strong><code>**output file**</code><strong>ï¼‰</strong></li></ul><h4 id="å†™å…¥æµ‹è¯•"><a href="#å†™å…¥æµ‹è¯•" class="headerlink" title="å†™å…¥æµ‹è¯•"></a>å†™å…¥æµ‹è¯•</h4><p>ä½¿ç”¨ <code>dd</code> å‘½ä»¤æµ‹è¯•å†™å…¥é€Ÿåº¦ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=testfile bs=1G count=1 oflag=dsync<br></code></pre></td></tr></table></figure><ul><li><code>if=/dev/zero</code>ï¼šè¾“å…¥æ¥è‡ªä¸€ä¸ªç‰¹æ®Šè®¾å¤‡ï¼Œäº§ç”ŸæŒç»­çš„é›¶ã€‚</li><li><code>bs=1G</code>ï¼šè®¾ç½®å—å¤§å°ä¸º 1 GBã€‚</li><li><code>count=1</code>ï¼šåªå†™å…¥ä¸€ä¸ªå—ã€‚</li></ul><p>å¸¸è§æ­£å¸¸è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">1+0 records in<br>1+0 records out<br>1073741824 bytes (1.1 GB) copied, 10.1 s, 106 MB/s<br></code></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼šå¯¹äºæœºæ¢°ç¡¬ç›˜ï¼Œé€Ÿåº¦å¯èƒ½åœ¨50-150 MB&#x2F;sä¹‹é—´ï¼›å¯¹äºSSDï¼Œé€Ÿåº¦å¾€å¾€æ›´é«˜ã€‚</p><h4 id="è¯»å–æµ‹è¯•"><a href="#è¯»å–æµ‹è¯•" class="headerlink" title="è¯»å–æµ‹è¯•"></a>è¯»å–æµ‹è¯•</h4><p>æµ‹è¯•å†™å…¥åæ–‡ä»¶çš„è¯»å–é€Ÿåº¦ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=testfile of=/dev/null bs=1G count=1<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">1073741824 bytes (1.1 GB) copied, 4.2 s, 256 MB/s<br></code></pre></td></tr></table></figure><h4 id="å…¶ä»–å·¥å…·"><a href="#å…¶ä»–å·¥å…·" class="headerlink" title="å…¶ä»–å·¥å…·"></a>å…¶ä»–å·¥å…·</h4><p>å¯ä»¥åˆ©ç”¨ <code>hdparm</code> æµ‹è¯•ç¼“å­˜è¯»å–ä¸ç£ç›˜å®é™…è¯»å–é€Ÿåº¦ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hdparm -tT /dev/sda<br></code></pre></td></tr></table></figure><p>æ­£å¸¸æƒ…å†µä¸‹è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">Timing cached reads:<br>    12000 MB in  2.00 seconds = 6000.00 MB/sec<br>Timing buffered disk reads:<br>     150 MB in  3.00 seconds = 50.00 MB/sec<br></code></pre></td></tr></table></figure><h3 id="4-æ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€"><a href="#4-æ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€" class="headerlink" title="4. æ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€"></a>4. æ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€</h3><p>ä½¿ç”¨ <code>smartctl</code> æ£€æŸ¥ç¡¬ç›˜å¥åº·ä¿¡æ¯ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨é”™è¯¯æˆ–é¢„è­¦ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> smartctl -a /dev/sda<br></code></pre></td></tr></table></figure><p>å…³æ³¨é¡¹ï¼š</p><ul><li>Reallocated_Sector_Ctï¼ˆé‡æ–°åˆ†é…æ‰‡åŒºæ•°ï¼‰</li><li>Current_Pending_Sectorï¼ˆå¾…å¤„ç†æ‰‡åŒºï¼‰</li><li>SMARTæ•´ä½“çŠ¶æ€ï¼ˆé€šå¸¸æ˜¾ç¤ºä¸º PASSED è¡¨ç¤ºæ­£å¸¸ï¼‰</li></ul><h3 id="5-æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—"><a href="#5-æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—" class="headerlink" title="5. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—"></a>5. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—</h3><p>é€šè¿‡ <code>dmesg</code> æˆ–æŸ¥çœ‹ <code>/var/log/syslog</code>ã€<code>/var/log/messages</code> ç­‰æ—¥å¿—æ–‡ä»¶ï¼Œå…³æ³¨ç£ç›˜ç›¸å…³é”™è¯¯ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dmesg | grep -i error<br></code></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep -i <span class="hljs-string">&#x27;sda&#x27;</span> /var/log/syslog<br></code></pre></td></tr></table></figure><h2 id="æ­£å¸¸æƒ…å†µä¸‹çš„è¾“å‡ºç¤ºä¾‹"><a href="#æ­£å¸¸æƒ…å†µä¸‹çš„è¾“å‡ºç¤ºä¾‹" class="headerlink" title="æ­£å¸¸æƒ…å†µä¸‹çš„è¾“å‡ºç¤ºä¾‹"></a>æ­£å¸¸æƒ…å†µä¸‹çš„è¾“å‡ºç¤ºä¾‹</h2><ul><li><strong>iostat -x è¾“å‡ºç¤ºä¾‹</strong>ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">avg-cpu:  %user   %nice %system %iowait  %steal   %idle<br>           5.13    0.00    2.34    1.02    0.00   91.51<br><br>Device             r/s     w/s     rMB/s   wMB/s  avgrq-sz  avgqu-sz   await  svctm  %util<br>sda                2.00    1.00    0.20    0.10    64.00      0.00     3.00   1.00   0.30<br></code></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼šä½iowaitã€ä½é˜Ÿåˆ—é•¿åº¦å’Œè¾ƒä½çš„%utilè¡¨æ˜ç£ç›˜å¤„äºç©ºé—²çŠ¶æ€ã€‚</p><ul><li><strong>dd å†™å…¥æµ‹è¯•ç¤ºä¾‹</strong>ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">1+0 records in<br>1+0 records out<br>1073741824 bytes (1.1 GB) copied, 10.1 s, 106 MB/s<br></code></pre></td></tr></table></figure><ul><li><strong>dd è¯»å–æµ‹è¯•ç¤ºä¾‹</strong>ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">1073741824 bytes (1.1 GB) copied, 4.2 s, 256 MB/s<br></code></pre></td></tr></table></figure><ul><li><strong>hdparm æµ‹è¯•ç¤ºä¾‹</strong>ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">Timing cached reads:<br>    12000 MB in  2.00 seconds = 6000.00 MB/sec<br>Timing buffered disk reads:<br>     150 MB in  3.00 seconds = 50.00 MB/sec<br></code></pre></td></tr></table></figure><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><ul><li><strong>æ•°æ®å¤‡ä»½</strong>ï¼šåœ¨è¿›è¡Œç£ç›˜è°ƒè¯•å’Œæµ‹è¯•ä¹‹å‰ï¼Œè¯·ç¡®ä¿é‡è¦æ•°æ®å·²ç»å¤‡ä»½ã€‚</li><li><strong>æµ‹è¯•ç¯å¢ƒ</strong>ï¼šå°½é‡åœ¨ä¸šåŠ¡ä½å³°æœŸæˆ–éç”Ÿäº§ç¯å¢ƒä¸‹è¿›è¡Œæ€§èƒ½æµ‹è¯•ï¼Œä»¥å…å½±å“æ­£å¸¸ä¸šåŠ¡ã€‚</li><li><strong>æŒ‚è½½å‚æ•°</strong>ï¼šæ£€æŸ¥ç£ç›˜æŒ‚è½½å‚æ•°æ˜¯å¦åˆç†ï¼ˆå¦‚ noatime é€‰é¡¹ï¼‰ã€‚</li><li><strong>è´Ÿè½½å½±å“</strong>ï¼šæµ‹è¯•è¿‡ç¨‹ä¸­å…³é—­æˆ–æš‚åœå…¶å®ƒå¤§IOæ“ä½œï¼Œç¡®ä¿æµ‹è¯•ç»“æœå‡†ç¡®ã€‚</li><li><strong>ç¡¬ä»¶çŠ¶æ€</strong>ï¼šè‹¥ç¡¬ç›˜å¥åº·çŠ¶æ€å‡ºç°è­¦å‘Šï¼Œå»ºè®®åŠæ—¶æ›´æ¢ç¡¬ç›˜ä»¥é˜²æ•°æ®ä¸¢å¤±ã€‚</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œä½ å¯ä»¥è¾ƒä¸ºå…¨é¢åœ°æ’æŸ¥Linuxç³»ç»Ÿç£ç›˜IOæ€§èƒ½é—®é¢˜ã€‚ä»æ•´ä½“è´Ÿè½½ã€iostatç›‘æ§ã€ddæµ‹è¯•åˆ°ç¡¬ç›˜å¥åº·æ£€æŸ¥ï¼Œå„é¡¹æŒ‡æ ‡æ­£å¸¸æ—¶ï¼Œç³»ç»Ÿè¯»å†™æ€§èƒ½åº”åœ¨é¢„æœŸèŒƒå›´å†…ï¼ˆä¾‹å¦‚æœºæ¢°ç¡¬ç›˜å†™å…¥é€Ÿåº¦åœ¨50-150 MB&#x2F;sï¼ŒSSDåˆ™æ›´å¿«ï¼‰ã€‚å¦‚å‘ç°æŸé¡¹æŒ‡æ ‡å¼‚å¸¸ï¼Œåˆ™å¯è¿›ä¸€æ­¥å®šä½é—®é¢˜åŸå› ï¼Œä¾‹å¦‚ç¡¬ä»¶æ•…éšœã€ç³»ç»Ÿé…ç½®é—®é¢˜æˆ–IOèµ„æºäº‰ç”¨ç­‰ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pgrep å‘½ä»¤å­¦ä¹ æ€»ç»“</title>
    <link href="/2025/03/10/pgrep-%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
    <url>/2025/03/10/pgrep-%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p><code>pgrep</code> æ˜¯ä¸€ä¸ªåœ¨ Linux å’Œ Unix ç³»ç»Ÿä¸­ä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæŸ¥æ‰¾ä¸ç»™å®šæ¨¡å¼åŒ¹é…çš„è¿›ç¨‹ã€‚å®ƒæ ¹æ®è¿›ç¨‹åç§°æˆ–å…¶ä»–å±æ€§è¿”å›è¿›ç¨‹ IDï¼ˆPIDï¼‰ã€‚</p><h2 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pgrep [é€‰é¡¹] æ¨¡å¼<br></code></pre></td></tr></table></figure><h2 id="å¸¸ç”¨é€‰é¡¹"><a href="#å¸¸ç”¨é€‰é¡¹" class="headerlink" title="å¸¸ç”¨é€‰é¡¹"></a>å¸¸ç”¨é€‰é¡¹</h2><ul><li><code>-l</code>ï¼šæ˜¾ç¤ºè¿›ç¨‹çš„åç§°å’Œ PIDã€‚</li><li><code>-n</code>ï¼šåªè¿”å›æœ€è¿‘å¯åŠ¨çš„åŒ¹é…è¿›ç¨‹ã€‚</li><li><code>-o</code>ï¼šåªè¿”å›æœ€æ—©å¯åŠ¨çš„åŒ¹é…è¿›ç¨‹ã€‚</li><li><code>-u ç”¨æˆ·å</code>ï¼šä»…åŒ¹é…å±äºæŒ‡å®šç”¨æˆ·çš„è¿›ç¨‹ã€‚</li><li><code>-P çˆ¶PID</code>ï¼šä»…åŒ¹é…æŒ‡å®šçˆ¶è¿›ç¨‹çš„å­è¿›ç¨‹ã€‚</li><li><code>-f</code>ï¼šåŒ¹é…æ•´ä¸ªå‘½ä»¤è¡Œï¼Œè€Œä¸ä»…ä»…æ˜¯è¿›ç¨‹åã€‚</li><li><code>-c</code>ï¼šè¾“å‡ºåŒ¹é…çš„è¿›ç¨‹æ•°é‡ã€‚</li></ul><h2 id="ç¤ºä¾‹ç”¨æ³•"><a href="#ç¤ºä¾‹ç”¨æ³•" class="headerlink" title="ç¤ºä¾‹ç”¨æ³•"></a>ç¤ºä¾‹ç”¨æ³•</h2><h3 id="1-æŸ¥æ‰¾è¿›ç¨‹-ID"><a href="#1-æŸ¥æ‰¾è¿›ç¨‹-ID" class="headerlink" title="1. æŸ¥æ‰¾è¿›ç¨‹ ID"></a>1. æŸ¥æ‰¾è¿›ç¨‹ ID</h3><p>æŸ¥æ‰¾åä¸º <code>bash</code> çš„è¿›ç¨‹ IDï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pgrep bash<br></code></pre></td></tr></table></figure><h3 id="2-æ˜¾ç¤ºè¿›ç¨‹åç§°å’Œ-PID"><a href="#2-æ˜¾ç¤ºè¿›ç¨‹åç§°å’Œ-PID" class="headerlink" title="2. æ˜¾ç¤ºè¿›ç¨‹åç§°å’Œ PID"></a>2. æ˜¾ç¤ºè¿›ç¨‹åç§°å’Œ PID</h3><p>ä½¿ç”¨ <code>-l</code> é€‰é¡¹æ˜¾ç¤ºè¿›ç¨‹åç§°å’Œ PIDï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pgrep -l bash<br></code></pre></td></tr></table></figure><h3 id="3-æŸ¥æ‰¾æœ€è¿‘å¯åŠ¨çš„è¿›ç¨‹"><a href="#3-æŸ¥æ‰¾æœ€è¿‘å¯åŠ¨çš„è¿›ç¨‹" class="headerlink" title="3. æŸ¥æ‰¾æœ€è¿‘å¯åŠ¨çš„è¿›ç¨‹"></a>3. æŸ¥æ‰¾æœ€è¿‘å¯åŠ¨çš„è¿›ç¨‹</h3><p>æŸ¥æ‰¾æœ€è¿‘å¯åŠ¨çš„ <code>ssh</code> è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pgrep -n ssh<br></code></pre></td></tr></table></figure><h3 id="4-æŸ¥æ‰¾æœ€æ—©å¯åŠ¨çš„è¿›ç¨‹"><a href="#4-æŸ¥æ‰¾æœ€æ—©å¯åŠ¨çš„è¿›ç¨‹" class="headerlink" title="4. æŸ¥æ‰¾æœ€æ—©å¯åŠ¨çš„è¿›ç¨‹"></a>4. æŸ¥æ‰¾æœ€æ—©å¯åŠ¨çš„è¿›ç¨‹</h3><p>æŸ¥æ‰¾æœ€æ—©å¯åŠ¨çš„ <code>httpd</code> è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pgrep -o httpd<br></code></pre></td></tr></table></figure><h3 id="5-ä»…æŸ¥æ‰¾ç‰¹å®šç”¨æˆ·çš„è¿›ç¨‹"><a href="#5-ä»…æŸ¥æ‰¾ç‰¹å®šç”¨æˆ·çš„è¿›ç¨‹" class="headerlink" title="5. ä»…æŸ¥æ‰¾ç‰¹å®šç”¨æˆ·çš„è¿›ç¨‹"></a>5. ä»…æŸ¥æ‰¾ç‰¹å®šç”¨æˆ·çš„è¿›ç¨‹</h3><p>æŸ¥æ‰¾ç”¨æˆ· <code>john</code> çš„æ‰€æœ‰è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pgrep -u john<br></code></pre></td></tr></table></figure><h3 id="6-æŸ¥æ‰¾ç‰¹å®šçˆ¶è¿›ç¨‹çš„å­è¿›ç¨‹"><a href="#6-æŸ¥æ‰¾ç‰¹å®šçˆ¶è¿›ç¨‹çš„å­è¿›ç¨‹" class="headerlink" title="6. æŸ¥æ‰¾ç‰¹å®šçˆ¶è¿›ç¨‹çš„å­è¿›ç¨‹"></a>6. æŸ¥æ‰¾ç‰¹å®šçˆ¶è¿›ç¨‹çš„å­è¿›ç¨‹</h3><p>æŸ¥æ‰¾çˆ¶è¿›ç¨‹ PID ä¸º <code>1234</code> çš„å­è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pgrep -P 1234<br></code></pre></td></tr></table></figure><h3 id="7-åŒ¹é…æ•´ä¸ªå‘½ä»¤è¡Œ"><a href="#7-åŒ¹é…æ•´ä¸ªå‘½ä»¤è¡Œ" class="headerlink" title="7. åŒ¹é…æ•´ä¸ªå‘½ä»¤è¡Œ"></a>7. åŒ¹é…æ•´ä¸ªå‘½ä»¤è¡Œ</h3><p>æŸ¥æ‰¾åŒ…å« <code>python myscript.py</code> çš„è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pgrep -f <span class="hljs-string">&quot;python myscript.py&quot;</span><br></code></pre></td></tr></table></figure><h3 id="8-è¾“å‡ºåŒ¹é…çš„è¿›ç¨‹æ•°é‡"><a href="#8-è¾“å‡ºåŒ¹é…çš„è¿›ç¨‹æ•°é‡" class="headerlink" title="8. è¾“å‡ºåŒ¹é…çš„è¿›ç¨‹æ•°é‡"></a>8. è¾“å‡ºåŒ¹é…çš„è¿›ç¨‹æ•°é‡</h3><p>è¾“å‡ºåä¸º <code>nginx</code> çš„è¿›ç¨‹æ•°é‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pgrep -c nginx<br></code></pre></td></tr></table></figure><h3 id="9-æ€æ‰åŒ¹é…åˆ°çš„è¿›ç¨‹"><a href="#9-æ€æ‰åŒ¹é…åˆ°çš„è¿›ç¨‹" class="headerlink" title="9.æ€æ‰åŒ¹é…åˆ°çš„è¿›ç¨‹"></a>9.æ€æ‰åŒ¹é…åˆ°çš„è¿›ç¨‹</h3><p>æ€æ‰é€šè¿‡ flow æŸ¥è¯¢å¾—åˆ°çš„è¿›ç¨‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">kill</span> $(pgrep -f flow) <br></code></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><code>pgrep</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°æŸ¥æ‰¾å’Œç®¡ç†è¿›ç¨‹ã€‚é€šè¿‡ç»“åˆä¸åŒçš„é€‰é¡¹ï¼Œç”¨æˆ·å¯ä»¥çµæ´»åœ°è·å–æ‰€éœ€çš„è¿›ç¨‹ä¿¡æ¯ï¼Œæ–¹ä¾¿ç³»ç»Ÿç›‘æ§å’Œç®¡ç†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CPUæ˜¯å¦æ”¯æŒAVXæŒ‡ä»¤é›†</title>
    <link href="/2025/03/05/CPU%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81AVX%E6%8C%87%E4%BB%A4%E9%9B%86/"/>
    <url>/2025/03/05/CPU%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81AVX%E6%8C%87%E4%BB%A4%E9%9B%86/</url>
    
    <content type="html"><![CDATA[<p>èƒŒæ™¯ï¼š mongDB5.0+å¿…é¡»å®‰è£…åœ¨æ”¯æŒAVXæŒ‡ä»¤é›†çš„CPUä¸Š  </p><h3 id="æ–¹æ³•-1ï¼šä½¿ç”¨-lscpu-å‘½ä»¤"><a href="#æ–¹æ³•-1ï¼šä½¿ç”¨-lscpu-å‘½ä»¤" class="headerlink" title="æ–¹æ³• 1ï¼šä½¿ç”¨ lscpu å‘½ä»¤"></a>æ–¹æ³• 1ï¼šä½¿ç”¨ <code>lscpu</code> å‘½ä»¤</h3><p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ <code>lscpu</code> å‘½ä»¤æ¥æ£€æŸ¥ CPU çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ”¯æŒçš„æŒ‡ä»¤é›†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lscpu | grep -i avx<br></code></pre></td></tr></table></figure><p>å¦‚æœè¾“å‡ºä¸­åŒ…å« <code>avx</code> å­—æ ·ï¼Œè¯´æ˜ä½ çš„ CPU æ”¯æŒ AVX æŒ‡ä»¤é›†ã€‚</p><h3 id="æ–¹æ³•-2ï¼šæŸ¥çœ‹-proc-cpuinfo"><a href="#æ–¹æ³•-2ï¼šæŸ¥çœ‹-proc-cpuinfo" class="headerlink" title="æ–¹æ³• 2ï¼šæŸ¥çœ‹ /proc/cpuinfo"></a>æ–¹æ³• 2ï¼šæŸ¥çœ‹ <code>/proc/cpuinfo</code></h3><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥æŸ¥çœ‹ <code>/proc/cpuinfo</code> æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /proc/cpuinfo | grep -i avx<br></code></pre></td></tr></table></figure><p>å¦‚æœ CPU æ”¯æŒ AVXï¼Œè¾“å‡ºä¸­ä¼šåŒ…å« <code>avx</code>ã€‚</p><h3 id="æ–¹æ³•-3ï¼šä½¿ç”¨-cpuid-å·¥å…·"><a href="#æ–¹æ³•-3ï¼šä½¿ç”¨-cpuid-å·¥å…·" class="headerlink" title="æ–¹æ³• 3ï¼šä½¿ç”¨ cpuid å·¥å…·"></a>æ–¹æ³• 3ï¼šä½¿ç”¨ <code>cpuid</code> å·¥å…·</h3><p>å¦‚æœä½ çš„ç³»ç»Ÿä¸­å®‰è£…äº† <code>cpuid</code> å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–è¯¦ç»†ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cpuid | grep -i avx<br></code></pre></td></tr></table></figure><h3 id="æ–¹æ³•-4ï¼šä½¿ç”¨-getconf-å‘½ä»¤"><a href="#æ–¹æ³•-4ï¼šä½¿ç”¨-getconf-å‘½ä»¤" class="headerlink" title="æ–¹æ³• 4ï¼šä½¿ç”¨ getconf å‘½ä»¤"></a>æ–¹æ³• 4ï¼šä½¿ç”¨ <code>getconf</code> å‘½ä»¤</h3><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>getconf</code> å‘½ä»¤æ£€æŸ¥ CPU çš„é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">getconf _NPROCESSORS_ONLN<br></code></pre></td></tr></table></figure><p>è™½ç„¶è¿™ä¸ªå‘½ä»¤æœ¬èº«ä¸ä¼šç›´æ¥å‘Šè¯‰ä½ æ˜¯å¦æ”¯æŒ AVXï¼Œä½†å®ƒå¯ä»¥è®©ä½ äº†è§£ CPU æ ¸å¿ƒæ•°çš„ä¿¡æ¯ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux è¿›ç¨‹çŠ¶æ€</title>
    <link href="/2025/01/08/Linux-%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81/"/>
    <url>/2025/01/08/Linux-%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ Linux ä¸­ï¼Œè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿçš„åŸºæœ¬å•ä½ï¼Œè¿›ç¨‹çš„çŠ¶æ€åæ˜ äº†è¿›ç¨‹å½“å‰çš„æ‰§è¡Œæƒ…å†µã€‚äº†è§£è¿›ç¨‹çš„ä¸åŒçŠ¶æ€ï¼Œæœ‰åŠ©äºæˆ‘ä»¬åœ¨å¼€å‘å’Œè¿ç»´ä¸­æ›´å¥½åœ°è¿›è¡Œè¿›ç¨‹ç®¡ç†ã€‚</p><h2 id="å¸¸è§çš„è¿›ç¨‹çŠ¶æ€"><a href="#å¸¸è§çš„è¿›ç¨‹çŠ¶æ€" class="headerlink" title="å¸¸è§çš„è¿›ç¨‹çŠ¶æ€"></a>å¸¸è§çš„è¿›ç¨‹çŠ¶æ€</h2><p>è¿›ç¨‹çš„çŠ¶æ€å¯ä»¥é€šè¿‡ <code>ps</code> å‘½ä»¤æˆ– <code>top</code> å‘½ä»¤æŸ¥çœ‹ã€‚Linux ä¸­çš„è¿›ç¨‹çŠ¶æ€é€šè¿‡å•ä¸ªå­—æ¯æ¥è¡¨ç¤ºï¼Œå¸¸è§çš„è¿›ç¨‹çŠ¶æ€åŠå…¶å«ä¹‰å¦‚ä¸‹ï¼š</p><h3 id="1-R-Running-è¿è¡ŒçŠ¶æ€"><a href="#1-R-Running-è¿è¡ŒçŠ¶æ€" class="headerlink" title="1. R (Running) - è¿è¡ŒçŠ¶æ€"></a>1. <strong>R (Running)</strong> - è¿è¡ŒçŠ¶æ€</h3><ul><li><strong>å«ä¹‰</strong>ï¼šè¿›ç¨‹æ­£åœ¨ CPU ä¸Šè¿è¡Œï¼Œæˆ–è€…æ­£åœ¨ç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚</li><li><strong>åŸå› </strong>ï¼šè¿›ç¨‹æ­£åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œå¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ²¡æœ‰å¿…è¦è¿›è¡Œæ“ä½œï¼Œè¿™ç§çŠ¶æ€è¡¨ç¤ºè¿›ç¨‹æ­£åœ¨æ­£å¸¸å·¥ä½œã€‚</li></ul><h3 id="2-S-Sleeping-ç¡çœ çŠ¶æ€"><a href="#2-S-Sleeping-ç¡çœ çŠ¶æ€" class="headerlink" title="2. S (Sleeping) - ç¡çœ çŠ¶æ€"></a>2. <strong>S (Sleeping)</strong> - ç¡çœ çŠ¶æ€</h3><ul><li><strong>å«ä¹‰</strong>ï¼šè¿›ç¨‹åœ¨ç­‰å¾…æŸäº›äº‹ä»¶æˆ–èµ„æºï¼Œä¾‹å¦‚ç­‰å¾… I&#x2F;O å®Œæˆã€‚</li><li><strong>åŸå› </strong>ï¼šè¿›ç¨‹æš‚æ—¶æ— æ³•æ‰§è¡Œï¼Œå¯èƒ½æ˜¯ç”±äºç­‰å¾…ç£ç›˜ I&#x2F;Oã€ç½‘ç»œå“åº”ç­‰ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šé€šå¸¸è¿™ç§çŠ¶æ€æ˜¯æ­£å¸¸çš„ï¼Œè¿›ç¨‹ä¼šåœ¨æ¡ä»¶æ»¡è¶³æ—¶æ¢å¤æ‰§è¡Œã€‚å¦‚æœè¿›ç¨‹é•¿æœŸå¤„äºç¡çœ çŠ¶æ€ï¼Œå¯èƒ½éœ€è¦æ£€æŸ¥ç³»ç»Ÿèµ„æºæˆ–ç¨‹åºæ˜¯å¦æœ‰æ­»é”ã€‚</li></ul><h3 id="3-D-Uninterruptible-Sleep-ä¸å¯ä¸­æ–­ç¡çœ çŠ¶æ€"><a href="#3-D-Uninterruptible-Sleep-ä¸å¯ä¸­æ–­ç¡çœ çŠ¶æ€" class="headerlink" title="3. D (Uninterruptible Sleep) - ä¸å¯ä¸­æ–­ç¡çœ çŠ¶æ€"></a>3. <strong>D (Uninterruptible Sleep)</strong> - ä¸å¯ä¸­æ–­ç¡çœ çŠ¶æ€</h3><ul><li><strong>å«ä¹‰</strong>ï¼šè¿›ç¨‹å¤„äºä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€ï¼Œé€šå¸¸æ˜¯ç­‰å¾…æŸäº›ç¡¬ä»¶æ“ä½œï¼ˆå¦‚ç£ç›˜ I&#x2F;Oï¼‰ï¼Œå¹¶ä¸”æ— æ³•è¢«å¤–éƒ¨ä¿¡å·ä¸­æ–­ã€‚</li><li><strong>åŸå› </strong>ï¼šé€šå¸¸å‘ç”Ÿåœ¨ç­‰å¾…ç£ç›˜æ“ä½œæˆ–å…¶ä»–ç¡¬ä»¶æ“ä½œæ—¶ã€‚è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œè¿›ç¨‹æ— æ³•è¢« <code>SIGKILL</code> ç­‰ä¿¡å·ä¸­æ–­ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå¦‚æœè¿›ç¨‹é•¿æ—¶é—´å¤„äºæ­¤çŠ¶æ€ï¼Œå¯èƒ½æ˜¯ç³»ç»Ÿç¡¬ä»¶æˆ–é©±åŠ¨çš„é—®é¢˜ï¼Œæˆ–è€…ç¡¬ä»¶è®¾å¤‡ç¹å¿™ã€‚éœ€è¦æ£€æŸ¥ç¡¬ä»¶çŠ¶å†µã€é©±åŠ¨ç¨‹åºå’Œ I&#x2F;O ç³»ç»Ÿã€‚</li></ul><h3 id="4-Z-Zombie-åƒµå°¸çŠ¶æ€"><a href="#4-Z-Zombie-åƒµå°¸çŠ¶æ€" class="headerlink" title="4. Z (Zombie) - åƒµå°¸çŠ¶æ€"></a>4. <strong>Z (Zombie)</strong> - åƒµå°¸çŠ¶æ€</h3><ul><li><strong>å«ä¹‰</strong>ï¼šè¿›ç¨‹å·²ç»“æŸæ‰§è¡Œï¼Œä½†å…¶çˆ¶è¿›ç¨‹å°šæœªè¯»å–å…¶é€€å‡ºçŠ¶æ€ï¼Œå¯¼è‡´è¿›ç¨‹ä¿¡æ¯ä»åœ¨è¿›ç¨‹è¡¨ä¸­ä¿ç•™ã€‚</li><li><strong>åŸå› </strong>ï¼šè¿›ç¨‹å·²ç»ˆæ­¢ï¼Œä½†å…¶çˆ¶è¿›ç¨‹æœªè°ƒç”¨ <code>wait()</code> æ¥å›æ”¶è¯¥å­è¿›ç¨‹çš„ä¿¡æ¯ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šçˆ¶è¿›ç¨‹éœ€è¦é€šè¿‡è°ƒç”¨ <code>wait()</code> æˆ– <code>waitpid()</code> æ¥æ¸…ç†å·²ç»“æŸçš„å­è¿›ç¨‹ã€‚åƒµå°¸è¿›ç¨‹æœ¬èº«ä¸ä¼šå ç”¨ç³»ç»Ÿèµ„æºï¼Œä½†ä¼šå ç”¨è¿›ç¨‹è¡¨é¡¹ã€‚å¦‚æœçˆ¶è¿›ç¨‹æ— æ³•æ¸…ç†ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æ€æ­»çˆ¶è¿›ç¨‹ï¼Œè¿›è€Œæ¸…ç†åƒµå°¸è¿›ç¨‹ã€‚</li></ul><h3 id="5-T-Stopped-åœæ­¢çŠ¶æ€"><a href="#5-T-Stopped-åœæ­¢çŠ¶æ€" class="headerlink" title="5. T (Stopped) - åœæ­¢çŠ¶æ€"></a>5. <strong>T (Stopped)</strong> - åœæ­¢çŠ¶æ€</h3><ul><li><strong>å«ä¹‰</strong>ï¼šè¿›ç¨‹ç”±äºæ¥æ”¶åˆ°ä¿¡å·ï¼ˆå¦‚ <code>SIGSTOP</code> æˆ– <code>SIGTSTP</code>ï¼‰è€Œè¢«æš‚åœæ‰§è¡Œã€‚</li><li><strong>åŸå› </strong>ï¼šç”¨æˆ·æˆ–ç³»ç»Ÿé€šè¿‡ <code>kill -STOP</code> æˆ–ç±»ä¼¼å‘½ä»¤æš‚åœäº†è¿›ç¨‹ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå¯ä»¥ä½¿ç”¨ <code>kill -CONT </code> æ¥æ¢å¤è¿›ç¨‹çš„æ‰§è¡Œã€‚</li></ul><h3 id="6-I-Idle-ç©ºé—²çŠ¶æ€"><a href="#6-I-Idle-ç©ºé—²çŠ¶æ€" class="headerlink" title="6. I (Idle) - ç©ºé—²çŠ¶æ€"></a>6. <strong>I (Idle)</strong> - ç©ºé—²çŠ¶æ€</h3><ul><li><strong>å«ä¹‰</strong>ï¼šè¿›ç¨‹å¤„äºç©ºé—²çŠ¶æ€ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æ‰§è¡Œã€‚</li><li><strong>åŸå› </strong>ï¼šé€šå¸¸ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨æ§åˆ¶ï¼Œè¡¨ç¤ºè¯¥è¿›ç¨‹å¹¶ä¸éœ€è¦ç«‹å³æ‰§è¡Œï¼Œæ­£åœ¨ç­‰å¾…è°ƒåº¦ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ²¡æœ‰ç‰¹åˆ«çš„è§£å†³æ–¹æ³•ï¼Œç©ºé—²çŠ¶æ€æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨çš„ä¸€éƒ¨åˆ†ã€‚</li></ul><h3 id="7-Foreground-process-å‰å°è¿›ç¨‹"><a href="#7-Foreground-process-å‰å°è¿›ç¨‹" class="headerlink" title="7. + (Foreground process) - å‰å°è¿›ç¨‹"></a>7. <strong>+ (Foreground process)</strong> - å‰å°è¿›ç¨‹</h3><ul><li><strong>å«ä¹‰</strong>ï¼šè¿›ç¨‹åœ¨å‰å°è¿è¡Œã€‚</li><li><strong>åŸå› </strong>ï¼šå½“å‰ç”¨æˆ·ä¼šè¯ä¸­çš„è¿›ç¨‹ï¼Œé€šå¸¸æ˜¯ç”¨æˆ·ç›´æ¥å¯åŠ¨çš„è¿›ç¨‹ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè¿™ç§çŠ¶æ€ä¸éœ€è¦ç‰¹åˆ«å¤„ç†ã€‚å¦‚æœéœ€è¦å°†è¿›ç¨‹åˆ‡æ¢åˆ°åå°ï¼Œå¯ä»¥ä½¿ç”¨ <code>Ctrl + Z</code> æš‚åœè¿›ç¨‹ï¼Œç„¶åä½¿ç”¨ <code>bg</code> å‘½ä»¤å°†å…¶é€åˆ°åå°ã€‚</li></ul><h3 id="8-W-Paging-é¡µäº¤æ¢çŠ¶æ€"><a href="#8-W-Paging-é¡µäº¤æ¢çŠ¶æ€" class="headerlink" title="8. W (Paging) - é¡µäº¤æ¢çŠ¶æ€"></a>8. <strong>W (Paging)</strong> - é¡µäº¤æ¢çŠ¶æ€</h3><ul><li><strong>å«ä¹‰</strong>ï¼šè¿›ç¨‹åœ¨ç­‰å¾…å†…å­˜é¡µäº¤æ¢ã€‚</li><li><strong>åŸå› </strong>ï¼šå½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œè¿›ç¨‹å¯èƒ½ä¼šè¢«æ¢å‡ºåˆ°ç¡¬ç›˜ï¼Œç„¶åç­‰å¾…è¢«æ¢å›å†…å­˜ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ­¤çŠ¶æ€é€šå¸¸æ˜¯ç”±äºç³»ç»Ÿå†…å­˜ç´§å¼ æˆ–äº¤æ¢ç©ºé—´ä¸è¶³å¼•èµ·çš„ã€‚å¯ä»¥è€ƒè™‘å¢åŠ ç‰©ç†å†…å­˜æˆ–è°ƒæ•´äº¤æ¢ç©ºé—´çš„å¤§å°ã€‚</li></ul><h2 id="å­¤å„¿è¿›ç¨‹ï¼ˆOrphan-Processï¼‰"><a href="#å­¤å„¿è¿›ç¨‹ï¼ˆOrphan-Processï¼‰" class="headerlink" title="å­¤å„¿è¿›ç¨‹ï¼ˆOrphan Processï¼‰"></a>å­¤å„¿è¿›ç¨‹ï¼ˆOrphan Processï¼‰</h2><h3 id="å­¤å„¿è¿›ç¨‹-å®šä¹‰"><a href="#å­¤å„¿è¿›ç¨‹-å®šä¹‰" class="headerlink" title="å­¤å„¿è¿›ç¨‹ - å®šä¹‰"></a><strong>å­¤å„¿è¿›ç¨‹</strong> - å®šä¹‰</h3><ul><li><strong>å«ä¹‰</strong>ï¼šå½“ä¸€ä¸ªçˆ¶è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œå…¶å­è¿›ç¨‹æ²¡æœ‰å¾—åˆ°åŠæ—¶çš„å›æ”¶ï¼Œå­è¿›ç¨‹å˜æˆå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ä¼šè¢« <code>init</code> è¿›ç¨‹ï¼ˆè¿›ç¨‹ ID ä¸º 1ï¼‰æ”¶å…»ï¼Œç”± <code>init</code> è¿›ç¨‹æ¥è´Ÿè´£æ¸…ç†è¿™äº›å­¤å„¿è¿›ç¨‹ã€‚</li><li><strong>åŸå› </strong>ï¼šçˆ¶è¿›ç¨‹é€€å‡ºåï¼Œå…¶å­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œå­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å·²ç»ä¸å­˜åœ¨ï¼Œå› æ­¤å®ƒä¼šè¢«ç³»ç»Ÿä¸­çš„ <code>init</code> è¿›ç¨‹æ”¶å…»ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå­¤å„¿è¿›ç¨‹é€šå¸¸ä¸ä¼šé€ æˆç³»ç»Ÿèµ„æºæµªè´¹ï¼Œå› ä¸º <code>init</code> è¿›ç¨‹ä¼šè´Ÿè´£å›æ”¶å®ƒä»¬ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å¸Œæœ›é˜²æ­¢å­¤å„¿è¿›ç¨‹çš„äº§ç”Ÿï¼Œå¯ä»¥é€šè¿‡ç¡®ä¿çˆ¶è¿›ç¨‹æ­£ç¡®ç®¡ç†å­è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Œæˆ–è€…é€šè¿‡ <code>wait()</code> ç­‰æ–¹å¼æ‰‹åŠ¨æ¸…ç†å­è¿›ç¨‹ã€‚</li></ul><h2 id="å¦‚ä½•æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€"><a href="#å¦‚ä½•æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€"></a>å¦‚ä½•æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€</h2><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹è¿›ç¨‹çš„çŠ¶æ€ï¼š</p><h3 id="1-ps-å‘½ä»¤"><a href="#1-ps-å‘½ä»¤" class="headerlink" title="1. ps å‘½ä»¤"></a>1. <strong>ps å‘½ä»¤</strong></h3><ul><li><code>ps aux</code>ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›ç¨‹çŠ¶æ€ã€‚</li><li><code>ps -eo pid,state,command</code>ï¼šä»…æ˜¾ç¤ºè¿›ç¨‹çš„ PIDã€çŠ¶æ€å’Œå‘½ä»¤ã€‚</li></ul><h3 id="2-top-å‘½ä»¤"><a href="#2-top-å‘½ä»¤" class="headerlink" title="2. top å‘½ä»¤"></a>2. <strong>top å‘½ä»¤</strong></h3><ul><li><code>top</code>ï¼šå®æ—¶æŸ¥çœ‹ç³»ç»Ÿä¸­çš„è¿›ç¨‹çŠ¶æ€ã€‚åœ¨ <code>top</code> ç•Œé¢ä¸­ï¼Œ<code>S</code> åˆ—æ˜¾ç¤ºè¿›ç¨‹çš„çŠ¶æ€ã€‚</li><li><code>htop</code>ï¼šæ˜¯ <code>top</code> å‘½ä»¤çš„å¢å¼ºç‰ˆï¼Œæä¾›æ›´å‹å¥½çš„å›¾å½¢ç•Œé¢å’Œäº¤äº’æ“ä½œã€‚</li></ul><h3 id="3-æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„çŠ¶æ€"><a href="#3-æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„çŠ¶æ€" class="headerlink" title="3. æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„çŠ¶æ€"></a>3. <strong>æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„çŠ¶æ€</strong></h3><ul><li><code>ps -p  -o state</code>ï¼šæŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„çŠ¶æ€ã€‚</li></ul><h2 id="å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ³•"><a href="#å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ³•" class="headerlink" title="å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ³•"></a>å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ³•</h2><h3 id="1-è¿›ç¨‹é•¿æ—¶é—´å¤„äº-D-çŠ¶æ€"><a href="#1-è¿›ç¨‹é•¿æ—¶é—´å¤„äº-D-çŠ¶æ€" class="headerlink" title="1. è¿›ç¨‹é•¿æ—¶é—´å¤„äº D çŠ¶æ€"></a>1. <strong>è¿›ç¨‹é•¿æ—¶é—´å¤„äº D çŠ¶æ€</strong></h3><ul><li><strong>å¯èƒ½åŸå› </strong>ï¼šè¿›ç¨‹ç­‰å¾…ç£ç›˜ I&#x2F;O æ“ä½œï¼Œå¯èƒ½æ˜¯ç£ç›˜è®¾å¤‡å‡ºç°é—®é¢˜æˆ– I&#x2F;O è¯·æ±‚è¿‡äºç¹å¿™ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</li></ul><ol><li><ol><li>æ£€æŸ¥ç£ç›˜ I&#x2F;O æ€§èƒ½ï¼Œä½¿ç”¨å·¥å…·å¦‚ <code>iostat</code>ã€<code>vmstat</code> æŸ¥çœ‹ç£ç›˜çš„è¯»å†™çŠ¶å†µã€‚</li><li>æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼ˆå¦‚ <code>/var/log/messages</code> æˆ– <code>dmesg</code>ï¼‰æ˜¯å¦æœ‰ç¡¬ä»¶ç›¸å…³çš„é”™è¯¯ã€‚</li></ol></li></ol><h3 id="2-åƒµå°¸è¿›ç¨‹å ç”¨è¿‡å¤š"><a href="#2-åƒµå°¸è¿›ç¨‹å ç”¨è¿‡å¤š" class="headerlink" title="2. åƒµå°¸è¿›ç¨‹å ç”¨è¿‡å¤š"></a>2. <strong>åƒµå°¸è¿›ç¨‹å ç”¨è¿‡å¤š</strong></h3><ul><li><strong>å¯èƒ½åŸå› </strong>ï¼šè¿›ç¨‹ç»ˆæ­¢åï¼Œçˆ¶è¿›ç¨‹æ²¡æœ‰æ¸…ç†åƒµå°¸è¿›ç¨‹ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šç¡®ä¿çˆ¶è¿›ç¨‹æ­£ç¡®å›æ”¶å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ã€‚å¦‚æœçˆ¶è¿›ç¨‹æ— æ³•æ¸…ç†ï¼Œå¯ä»¥å°è¯•æ‰‹åŠ¨ç»“æŸçˆ¶è¿›ç¨‹æˆ–é€šè¿‡ <code>init</code> è¿›ç¨‹æ¸…ç†ã€‚</li></ul><h3 id="3-å­¤å„¿è¿›ç¨‹çš„å¤„ç†"><a href="#3-å­¤å„¿è¿›ç¨‹çš„å¤„ç†" class="headerlink" title="3. å­¤å„¿è¿›ç¨‹çš„å¤„ç†"></a>3. <strong>å­¤å„¿è¿›ç¨‹çš„å¤„ç†</strong></h3><ul><li><strong>å¯èƒ½åŸå› </strong>ï¼šçˆ¶è¿›ç¨‹ç»ˆæ­¢åï¼Œå­è¿›ç¨‹å˜æˆå­¤å„¿è¿›ç¨‹ï¼Œç³»ç»Ÿä¼šç”± <code>init</code> è¿›ç¨‹è‡ªåŠ¨æ”¶å…»ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šé€šå¸¸æ— éœ€ç‰¹åˆ«å¤„ç†ï¼Œ<code>init</code> è¿›ç¨‹ä¼šè‡ªåŠ¨æ”¶å…»å¹¶ç®¡ç†è¿™äº›è¿›ç¨‹ã€‚å¦‚æœ <code>init</code> è¿›ç¨‹æ²¡æœ‰æ¸…ç†æˆ–å‡ºç°å¼‚å¸¸æƒ…å†µï¼Œå¯ä»¥æŸ¥çœ‹è¿›ç¨‹çš„çˆ¶è¿›ç¨‹çŠ¶æ€ã€‚</li></ul><h3 id="4-è¿›ç¨‹è¢«æš‚åœæˆ–åœæ­¢"><a href="#4-è¿›ç¨‹è¢«æš‚åœæˆ–åœæ­¢" class="headerlink" title="4. è¿›ç¨‹è¢«æš‚åœæˆ–åœæ­¢"></a>4. <strong>è¿›ç¨‹è¢«æš‚åœæˆ–åœæ­¢</strong></h3><ul><li><strong>å¯èƒ½åŸå› </strong>ï¼šè¿›ç¨‹å¯èƒ½è¢«ç”¨æˆ·æˆ–å…¶ä»–è¿›ç¨‹é€šè¿‡ä¿¡å·æš‚åœï¼ˆä¾‹å¦‚ <code>kill -STOP</code>ï¼‰ã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå¯ä»¥ä½¿ç”¨ <code>kill -CONT </code> æ¢å¤è¿›ç¨‹çš„æ‰§è¡Œã€‚</li></ul><h3 id="çŠ¶æ€ç»„åˆï¼š"><a href="#çŠ¶æ€ç»„åˆï¼š" class="headerlink" title="çŠ¶æ€ç»„åˆï¼š"></a>çŠ¶æ€ç»„åˆï¼š</h3><p>æœ‰æ—¶ï¼Œè¿›ç¨‹çŠ¶æ€å¯èƒ½ä¼šç»„åˆæ˜¾ç¤ºï¼Œä¾‹å¦‚ <code>Ss</code>ã€<code>R+</code> ç­‰ã€‚</p><ul><li><strong>Ss</strong>ï¼šè¡¨ç¤ºè¿›ç¨‹å½“å‰åœ¨ <strong>ä¼‘çœ </strong> çŠ¶æ€ï¼ˆ<code>S</code>ï¼‰ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ª <strong>ä¼šè¯é¢†å¯¼è¿›ç¨‹</strong>ï¼Œè€Œä¸”å®ƒæ˜¯ä¸€ä¸ª<strong>ä¼šè¯é¢†å¯¼è€…</strong>æˆ–è¿›ç¨‹ç»„é¢†å¯¼è€…ï¼ˆä¾‹å¦‚ä¸€ä¸ªç»ˆç«¯çš„ shellï¼‰ã€‚</li><li><strong>R+</strong>ï¼šè¡¨ç¤ºè¿›ç¨‹åœ¨ <strong>è¿è¡Œ</strong> çŠ¶æ€ï¼ˆ<code>R</code>ï¼‰ï¼Œå¹¶ä¸”å®ƒæ˜¯å½“å‰ <strong>å‰å°è¿›ç¨‹ç»„çš„ä¸€éƒ¨åˆ†</strong>ã€‚è¿™ä¸ªçŠ¶æ€è¡¨ç¤ºè¿›ç¨‹æ­£åœ¨è¿è¡Œå¹¶ä¸”æ˜¯ç”¨æˆ·å½“å‰ä¼šè¯çš„ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸æ˜¯ç”¨æˆ·ç›´æ¥æ“ä½œçš„è¿›ç¨‹ã€‚</li></ul><h3 id="çŠ¶æ€çš„å®é™…æ„ä¹‰ï¼š"><a href="#çŠ¶æ€çš„å®é™…æ„ä¹‰ï¼š" class="headerlink" title="çŠ¶æ€çš„å®é™…æ„ä¹‰ï¼š"></a>çŠ¶æ€çš„å®é™…æ„ä¹‰ï¼š</h3><ul><li><strong>S</strong>ï¼šè¿›ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œèµ„æºä½¿ç”¨å°‘ï¼ŒCPUå ç”¨ä½ã€‚</li><li><strong>R</strong>ï¼šè¿›ç¨‹æ­£åœ¨æ‰§è¡Œï¼Œæ¶ˆè€—CPUèµ„æºã€‚</li><li><strong>+</strong>ï¼šè¿›ç¨‹æ˜¯å½“å‰å‰å°è¿›ç¨‹ï¼Œé€šå¸¸æ˜¯ä½ ä¸ä¹‹äº¤äº’çš„è¿›ç¨‹ã€‚</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Linux è¿›ç¨‹çŠ¶æ€æä¾›äº†éå¸¸é‡è¦çš„ä¿¡æ¯ï¼Œæœ‰åŠ©äºç³»ç»Ÿç®¡ç†å‘˜å’Œå¼€å‘è€…ç†è§£å’Œç®¡ç†ç³»ç»Ÿä¸­çš„è¿›ç¨‹ã€‚äº†è§£è¿™äº›çŠ¶æ€åŠå…¶å«</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux LVMé€»è¾‘å·çš„åˆ›å»º</title>
    <link href="/2025/01/08/Linux-LVM%E9%80%BB%E8%BE%91%E5%8D%B7%E7%9A%84%E5%88%9B%E5%BB%BA/"/>
    <url>/2025/01/08/Linux-LVM%E9%80%BB%E8%BE%91%E5%8D%B7%E7%9A%84%E5%88%9B%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ¡£ä»‹ç»äº†å¦‚ä½•åœ¨ CentOS 7.9 ç³»ç»Ÿä¸­ï¼Œå°† <code>sdb</code>ã€<code>sdc</code> å’Œ <code>sdd</code> ä¸‰å—ç£ç›˜é€šè¿‡ LVM åˆå¹¶æˆä¸€ä¸ªé€»è¾‘å·ï¼Œå¹¶æŒ‚è½½åˆ° <code>/data_v2</code> ç›®å½•ï¼ŒåŒæ—¶ç¡®ä¿æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ä¸å½“å‰ç³»ç»Ÿä¸»åˆ†åŒºä¸€è‡´ï¼Œé¿å…å‡ºç°ä¸å¿…è¦çš„é—®é¢˜ã€‚</p><h2 id="1-æŸ¥çœ‹å½“å‰ç£ç›˜æƒ…å†µ"><a href="#1-æŸ¥çœ‹å½“å‰ç£ç›˜æƒ…å†µ" class="headerlink" title="1. æŸ¥çœ‹å½“å‰ç£ç›˜æƒ…å†µ"></a>1. <strong>æŸ¥çœ‹å½“å‰ç£ç›˜æƒ…å†µ</strong></h2><p>é¦–å…ˆï¼ŒæŸ¥çœ‹å½“å‰ç£ç›˜å’Œåˆ†åŒºä¿¡æ¯ï¼Œç¡®ä¿ç£ç›˜æ˜¯æœªåˆ†åŒºçŠ¶æ€ï¼Œæˆ–è€…å·²ç»åšå¥½äº†æ•°æ®å¤‡ä»½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsblk<br></code></pre></td></tr></table></figure><h2 id="2-æ£€æŸ¥å½“å‰ç³»ç»Ÿä¸»åˆ†åŒºæ–‡ä»¶ç³»ç»Ÿæ ¼å¼"><a href="#2-æ£€æŸ¥å½“å‰ç³»ç»Ÿä¸»åˆ†åŒºæ–‡ä»¶ç³»ç»Ÿæ ¼å¼" class="headerlink" title="2. æ£€æŸ¥å½“å‰ç³»ç»Ÿä¸»åˆ†åŒºæ–‡ä»¶ç³»ç»Ÿæ ¼å¼"></a>2. <strong>æ£€æŸ¥å½“å‰ç³»ç»Ÿä¸»åˆ†åŒºæ–‡ä»¶ç³»ç»Ÿæ ¼å¼</strong></h2><p>åœ¨åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿä¹‹å‰ï¼Œæœ€å¥½å…ˆæ£€æŸ¥å½“å‰ç³»ç»Ÿä¸»åˆ†åŒºï¼ˆå¦‚ <code>/</code> æˆ– <code>/boot</code>ï¼‰çš„æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼Œä»¥ç¡®ä¿æ–°åˆ›å»ºçš„é€»è¾‘å·æ ¼å¼ä¸€è‡´ï¼Œé¿å…ä¸å…¼å®¹é—®é¢˜ã€‚</p><p>å¯ä»¥é€šè¿‡ <code>lsblk -f</code> å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸»åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsblk -f<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">NAME            FSTYPE      LABEL           UUID                                 MOUNTPOINT<br>sda                                                             <br>â”œâ”€sda1          ext4        boot            e91f23ad-2d0e-4e4b-9d5a-bc61c3a56ef7 /boot<br>â””â”€sda2          xfs                          19c48a6c-e663-4010-a28c-4b98e29c768d /  <br>sdb                                                            <br>sdc                                                            <br>sdd                                                            <br></code></pre></td></tr></table></figure><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œç³»ç»Ÿçš„ä¸»åˆ†åŒº <code>/</code> ä½¿ç”¨äº† <code>xfs</code> æ–‡ä»¶ç³»ç»Ÿã€‚å¦‚æœä½ çš„ç³»ç»Ÿä¸»åˆ†åŒºä½¿ç”¨çš„æ˜¯ <code>xfs</code>ï¼Œä½ å¯ä»¥é€‰æ‹©å°†æ–°é€»è¾‘å·æ ¼å¼åŒ–ä¸º <code>xfs</code> æ ¼å¼ï¼›å¦‚æœæ˜¯ <code>ext4</code>ï¼Œåˆ™é€‰æ‹© <code>ext4</code> æ ¼å¼ã€‚</p><h2 id="3-åˆ›å»ºç‰©ç†å·ï¼ˆPVï¼‰"><a href="#3-åˆ›å»ºç‰©ç†å·ï¼ˆPVï¼‰" class="headerlink" title="3. åˆ›å»ºç‰©ç†å·ï¼ˆPVï¼‰"></a>3. <strong>åˆ›å»ºç‰©ç†å·ï¼ˆPVï¼‰</strong></h2><p>å°† <code>sdb</code>ã€<code>sdc</code> å’Œ <code>sdd</code> ä¸‰å—ç£ç›˜åˆ›å»ºä¸ºç‰©ç†å·ï¼ˆPVï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pvcreate /dev/sdb /dev/sdc /dev/sdd<br></code></pre></td></tr></table></figure><h2 id="4-åˆ›å»ºå·ç»„ï¼ˆVGï¼‰"><a href="#4-åˆ›å»ºå·ç»„ï¼ˆVGï¼‰" class="headerlink" title="4. åˆ›å»ºå·ç»„ï¼ˆVGï¼‰"></a>4. <strong>åˆ›å»ºå·ç»„ï¼ˆVGï¼‰</strong></h2><p>å°†è¿™ä¸‰å—ç‰©ç†å·åˆå¹¶ä¸ºä¸€ä¸ªå·ç»„ï¼Œå‘½åä¸º <code>vg_data</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vgcreate vg_data /dev/sdb /dev/sdc /dev/sdd<br></code></pre></td></tr></table></figure><h2 id="5-åˆ›å»ºé€»è¾‘å·ï¼ˆLVï¼‰"><a href="#5-åˆ›å»ºé€»è¾‘å·ï¼ˆLVï¼‰" class="headerlink" title="5. åˆ›å»ºé€»è¾‘å·ï¼ˆLVï¼‰"></a>5. <strong>åˆ›å»ºé€»è¾‘å·ï¼ˆLVï¼‰</strong></h2><p>åœ¨ <code>vg_data</code> å·ç»„å†…åˆ›å»ºä¸€ä¸ªé€»è¾‘å·ï¼Œå‘½åä¸º <code>lv_data</code>ï¼Œå¹¶æŒ‡å®šä½¿ç”¨å·ç»„ä¸­çš„å…¨éƒ¨å‰©ä½™ç©ºé—´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lvcreate -l 100%FREE -n lv_data vg_data<br></code></pre></td></tr></table></figure><h2 id="6-æŸ¥çœ‹å·ç»„å’Œé€»è¾‘å·"><a href="#6-æŸ¥çœ‹å·ç»„å’Œé€»è¾‘å·" class="headerlink" title="6. æŸ¥çœ‹å·ç»„å’Œé€»è¾‘å·"></a>6. <strong>æŸ¥çœ‹å·ç»„å’Œé€»è¾‘å·</strong></h2><p>ç¡®è®¤å·ç»„å’Œé€»è¾‘å·åˆ›å»ºæˆåŠŸã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vgdisplay<br>lvdisplay<br></code></pre></td></tr></table></figure><h2 id="7-æ ¼å¼åŒ–é€»è¾‘å·"><a href="#7-æ ¼å¼åŒ–é€»è¾‘å·" class="headerlink" title="7. æ ¼å¼åŒ–é€»è¾‘å·"></a>7. <strong>æ ¼å¼åŒ–é€»è¾‘å·</strong></h2><p>å¯¹åˆ›å»ºçš„é€»è¾‘å·è¿›è¡Œæ ¼å¼åŒ–ã€‚ç¡®ä¿æ ¼å¼åŒ–ä¸ºä¸ä½ å½“å‰ç³»ç»Ÿä¸»åˆ†åŒºæ–‡ä»¶ç³»ç»Ÿç›¸åŒçš„æ ¼å¼ï¼ˆä¾‹å¦‚ <code>xfs</code> æˆ– <code>ext4</code>ï¼‰ã€‚</p><p>å¦‚æœç³»ç»Ÿä¸»åˆ†åŒºä¸º <code>xfs</code>ï¼Œæ ¼å¼åŒ–ä¸º <code>xfs</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkfs.xfs /dev/vg_data/lv_data<br></code></pre></td></tr></table></figure><p>å¦‚æœç³»ç»Ÿä¸»åˆ†åŒºä¸º <code>ext4</code>ï¼Œæ ¼å¼åŒ–ä¸º <code>ext4</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkfs.ext4 /dev/vg_data/lv_data<br></code></pre></td></tr></table></figure><h2 id="8-åˆ›å»ºæŒ‚è½½ç‚¹"><a href="#8-åˆ›å»ºæŒ‚è½½ç‚¹" class="headerlink" title="8. åˆ›å»ºæŒ‚è½½ç‚¹"></a>8. <strong>åˆ›å»ºæŒ‚è½½ç‚¹</strong></h2><p>åˆ›å»ºæŒ‚è½½ç›®å½• <code>/data_v2</code>ï¼Œç”¨æ¥æŒ‚è½½é€»è¾‘å·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> /data_v2<br></code></pre></td></tr></table></figure><h2 id="9-æŒ‚è½½é€»è¾‘å·"><a href="#9-æŒ‚è½½é€»è¾‘å·" class="headerlink" title="9. æŒ‚è½½é€»è¾‘å·"></a>9. <strong>æŒ‚è½½é€»è¾‘å·</strong></h2><p>å°†é€»è¾‘å·æŒ‚è½½åˆ° <code>/data_v2</code> ç›®å½•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount /dev/vg_data/lv_data /data_v2<br></code></pre></td></tr></table></figure><h2 id="10-éªŒè¯æŒ‚è½½"><a href="#10-éªŒè¯æŒ‚è½½" class="headerlink" title="10. éªŒè¯æŒ‚è½½"></a>10. <strong>éªŒè¯æŒ‚è½½</strong></h2><p>é€šè¿‡ <code>df</code> å‘½ä»¤éªŒè¯æ˜¯å¦æˆåŠŸæŒ‚è½½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">df</span> -h<br></code></pre></td></tr></table></figure><p>ä½ åº”è¯¥èƒ½çœ‹åˆ° <code>/data_v2</code> å·²ç»æˆåŠŸæŒ‚è½½äº†æ–°åˆ›å»ºçš„é€»è¾‘å·ã€‚</p><h2 id="11-é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½"><a href="#11-é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½" class="headerlink" title="11. é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½"></a>11. <strong>é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½</strong></h2><p>ä¸ºäº†ç¡®ä¿æ¯æ¬¡é‡å¯åè¯¥é€»è¾‘å·èƒ½å¤Ÿè‡ªåŠ¨æŒ‚è½½ï¼Œéœ€è¦å°†æŒ‚è½½ä¿¡æ¯æ·»åŠ åˆ° <code>/etc/fstab</code> æ–‡ä»¶ä¸­ã€‚</p><p>é¦–å…ˆï¼Œè·å–é€»è¾‘å·çš„ UUIDï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">blkid /dev/vg_data/lv_data<br></code></pre></td></tr></table></figure><p>ä¼šè¿”å›ç±»ä¼¼ä»¥ä¸‹çš„å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">/dev/vg_data/lv_data: UUID=&quot;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&quot; TYPE=&quot;ext4&quot;<br></code></pre></td></tr></table></figure><p>å¤åˆ¶è¿”å›çš„ <code>UUID</code>ï¼Œç„¶åç¼–è¾‘ <code>/etc/fstab</code> æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nano /etc/fstab<br></code></pre></td></tr></table></figure><p>åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å¦‚ä¸‹è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">UUID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  /data_v2  ext4  defaults  0  0<br></code></pre></td></tr></table></figure><p>å°† <code>xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</code> æ›¿æ¢ä¸ºä½ è·å–çš„å®é™… UUIDã€‚å¦‚æœä½ çš„ç³»ç»Ÿä½¿ç”¨çš„æ˜¯ <code>xfs</code>ï¼Œåˆ™å°† <code>ext4</code> æ›¿æ¢ä¸º <code>xfs</code>ã€‚</p><p>ä¿å­˜å¹¶é€€å‡ºï¼ˆæŒ‰ <code>Ctrl + X</code>ï¼Œç„¶åæŒ‰ <code>Y</code> ç¡®è®¤ä¿å­˜ï¼‰ã€‚</p><h2 id="12-éªŒè¯-fstab-é…ç½®"><a href="#12-éªŒè¯-fstab-é…ç½®" class="headerlink" title="12. éªŒè¯ fstab é…ç½®"></a>12. <strong>éªŒè¯</strong> <code>fstab</code> <strong>é…ç½®</strong></h2><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯ <code>/etc/fstab</code> é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿åœ¨ç³»ç»Ÿé‡å¯åè‡ªåŠ¨æŒ‚è½½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount -a<br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰é”™è¯¯æç¤ºï¼Œåˆ™è¯´æ˜é…ç½®æ­£ç¡®ã€‚</p><h2 id="13-æœ€åæ£€æŸ¥æŒ‚è½½"><a href="#13-æœ€åæ£€æŸ¥æŒ‚è½½" class="headerlink" title="13. æœ€åæ£€æŸ¥æŒ‚è½½"></a>13. <strong>æœ€åæ£€æŸ¥æŒ‚è½½</strong></h2><p>å†ä¸€æ¬¡é€šè¿‡ <code>df -h</code> æ£€æŸ¥ <code>/data_v2</code> æ˜¯å¦å·²æŒ‚è½½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">df</span> -h<br></code></pre></td></tr></table></figure><p>ä½ åº”è¯¥å¯ä»¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼Œè¡¨ç¤ºæŒ‚è½½æˆåŠŸï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">Filesystem                    Size  Used Avail Use% Mounted on<br>/dev/vg_data/lv_data           150G  2.0G  148G   2% /data_v2<br></code></pre></td></tr></table></figure><p>å¯ä»¥é‡å¯å†æ¬¡æ£€æŸ¥ï¼Œæ­£å¸¸å¼€æœºä¸”é€šè¿‡<code>df -h</code> æ£€æŸ¥ <code>/data_v2</code> å·²æŒ‚è½½</p><p><strong>å®Œæ•´çš„æ“ä½œè®°å½•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@duyuhan ~]# lsblk -f<br>NAME            FSTYPE      LABEL           UUID                                   MOUNTPOINT<br>sda                                                                                <br>â”œâ”€sda1          xfs                         ae58994c-ec22-4e22-b3ea-02b560d19525   /boot<br>â””â”€sda2          LVM2_member                 IGKL1x-X3MF-jMr6-Ueyc-oazi-A8WC-xdDQGC <br>  â”œâ”€centos-root xfs                         0d74a73d-3837-4424-9b4b-1a4f532b2bb5   /<br>  â””â”€centos-swap swap                        2b0f03cb-d2fc-46f7-85e6-af2bc28060ca   [SWAP]<br>sdb                                                                                <br>sdc                                                                                <br>sdd                                                                                <br>sr0             iso9660     CentOS 7 x86_64 2020-11-03-14-55-29-00                 <br>[root@duyuhan ~]# lsblk<br>NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT<br>sda               8:0    0   500G  0 disk <br>â”œâ”€sda1            8:1    0     1G  0 part /boot<br>â””â”€sda2            8:2    0   499G  0 part <br>  â”œâ”€centos-root 253:0    0 491.1G  0 lvm  /<br>  â””â”€centos-swap 253:1    0   7.9G  0 lvm  [SWAP]<br>sdb               8:16   0    50G  0 disk <br>sdc               8:32   0    50G  0 disk <br>sdd               8:48   0    50G  0 disk <br>sr0              11:0    1   973M  0 rom  <br>[root@duyuhan ~]# <span class="hljs-built_in">mkdir</span> /data_v2<br>[root@duyuhan ~]# pvcreate /dev/sdb /dev/sdc /dev/sdd<br>  Physical volume <span class="hljs-string">&quot;/dev/sdb&quot;</span> successfully created.<br>  Physical volume <span class="hljs-string">&quot;/dev/sdc&quot;</span> successfully created.<br>  Physical volume <span class="hljs-string">&quot;/dev/sdd&quot;</span> successfully created.<br>[root@duyuhan ~]# lsblk<br>NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT<br>sda               8:0    0   500G  0 disk <br>â”œâ”€sda1            8:1    0     1G  0 part /boot<br>â””â”€sda2            8:2    0   499G  0 part <br>  â”œâ”€centos-root 253:0    0 491.1G  0 lvm  /<br>  â””â”€centos-swap 253:1    0   7.9G  0 lvm  [SWAP]<br>sdb               8:16   0    50G  0 disk <br>sdc               8:32   0    50G  0 disk <br>sdd               8:48   0    50G  0 disk <br>sr0              11:0    1   973M  0 rom  <br>[root@duyuhan ~]# vgcreate vg_data /dev/sdb /dev/sdc /dev/sdd<br>  Volume group <span class="hljs-string">&quot;vg_data&quot;</span> successfully created<br>[root@duyuhan ~]# lvcreate -l 100%FREE -n lv_data vg_data<br>  Logical volume <span class="hljs-string">&quot;lv_data&quot;</span> created.<br>[root@duyuhan ~]# vgdisplay<br>  --- Volume group ---<br>  VG Name               centos<br>  System ID             <br>  Format                lvm2<br>  Metadata Areas        1<br>  Metadata Sequence No  3<br>  VG Access             <span class="hljs-built_in">read</span>/write<br>  VG Status             resizable<br>  MAX LV                0<br>  Cur LV                2<br>  Open LV               2<br>  Max PV                0<br>  Cur PV                1<br>  Act PV                1<br>  VG Size               &lt;499.00 GiB<br>  PE Size               4.00 MiB<br>  Total PE              127743<br>  Alloc PE / Size       127742 / 498.99 GiB<br>  Free  PE / Size       1 / 4.00 MiB<br>  VG UUID               KszzR2-nz69-cgfQ-WwhE-ZK8B-yccI-irtLye<br>   <br>  --- Volume group ---<br>  VG Name               vg_data<br>  System ID             <br>  Format                lvm2<br>  Metadata Areas        3<br>  Metadata Sequence No  2<br>  VG Access             <span class="hljs-built_in">read</span>/write<br>  VG Status             resizable<br>  MAX LV                0<br>  Cur LV                1<br>  Open LV               0<br>  Max PV                0<br>  Cur PV                3<br>  Act PV                3<br>  VG Size               &lt;149.99 GiB<br>  PE Size               4.00 MiB<br>  Total PE              38397<br>  Alloc PE / Size       38397 / &lt;149.99 GiB<br>  Free  PE / Size       0 / 0   <br>  VG UUID               4snrZc-bvum-VrTF-ZuYF-PzH4-yVSx-DGdUUZ<br>   <br>[root@duyuhan ~]# lvdisplay<br>  --- Logical volume ---<br>  LV Path                /dev/centos/root<br>  LV Name                root<br>  VG Name                centos<br>  LV UUID                CBKigD-9AmJ-IEwv-AMF1-QKlt-bC5G-gQzX6x<br>  LV Write Access        <span class="hljs-built_in">read</span>/write<br>  LV Creation host, <span class="hljs-keyword">time</span> moulunli-dev, 2024-05-23 11:55:13 +0800<br>  LV Status              available<br>  <span class="hljs-comment"># open                 1</span><br>  LV Size                &lt;491.12 GiB<br>  Current LE             125726<br>  Segments               1<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently <span class="hljs-built_in">set</span> to     8192<br>  Block device           253:0<br>   <br>  --- Logical volume ---<br>  LV Path                /dev/centos/swap<br>  LV Name                swap<br>  VG Name                centos<br>  LV UUID                dQePJF-edyv-YCxr-Z30d-bmKq-x3Lp-jlEfBE<br>  LV Write Access        <span class="hljs-built_in">read</span>/write<br>  LV Creation host, <span class="hljs-keyword">time</span> moulunli-dev, 2024-05-23 11:55:44 +0800<br>  LV Status              available<br>  <span class="hljs-comment"># open                 2</span><br>  LV Size                &lt;7.88 GiB<br>  Current LE             2016<br>  Segments               1<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently <span class="hljs-built_in">set</span> to     8192<br>  Block device           253:1<br>   <br>  --- Logical volume ---<br>  LV Path                /dev/vg_data/lv_data<br>  LV Name                lv_data<br>  VG Name                vg_data<br>  LV UUID                nnb8dw-Pwo7-F0uj-72NO-nkPG-fAv9-yOvLhh<br>  LV Write Access        <span class="hljs-built_in">read</span>/write<br>  LV Creation host, <span class="hljs-keyword">time</span> duyuhan, 2025-01-08 11:25:10 +0800<br>  LV Status              available<br>  <span class="hljs-comment"># open                 0</span><br>  LV Size                &lt;149.99 GiB<br>  Current LE             38397<br>  Segments               3<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently <span class="hljs-built_in">set</span> to     8192<br>  Block device           253:2<br>   <br>[root@duyuhan ~]# lsblk -f<br>NAME              FSTYPE      LABEL           UUID                                   MOUNTPOINT<br>sda                                                                                  <br>â”œâ”€sda1            xfs                         ae58994c-ec22-4e22-b3ea-02b560d19525   /boot<br>â””â”€sda2            LVM2_member                 IGKL1x-X3MF-jMr6-Ueyc-oazi-A8WC-xdDQGC <br>  â”œâ”€centos-root   xfs                         0d74a73d-3837-4424-9b4b-1a4f532b2bb5   /<br>  â””â”€centos-swap   swap                        2b0f03cb-d2fc-46f7-85e6-af2bc28060ca   [SWAP]<br>sdb               LVM2_member                 S6ZOQv-Hxzp-GL3i-julm-NfoW-Ub9p-YmhHuG <br>â””â”€vg_data-lv_data                                                                    <br>sdc               LVM2_member                 ZbS77S-Z3FK-lCRe-bOuG-0xyr-A4eo-n8KTEA <br>â””â”€vg_data-lv_data                                                                    <br>sdd               LVM2_member                 PdVcLw-ggU3-6COK-QXhG-jvHa-yDi7-vol7uL <br>â””â”€vg_data-lv_data                                                                    <br>sr0               iso9660     CentOS 7 x86_64 2020-11-03-14-55-29-00                 <br>[root@duyuhan ~]# mkfs.xfs /dev/vg_data/lv_data<br>meta-data=/dev/vg_data/lv_data   isize=512    agcount=4, agsize=9829632 blks<br>         =                       sectsz=512   attr=2, projid32bit=1<br>         =                       crc=1        finobt=0, sparse=0<br>data     =                       bsize=4096   blocks=39318528, imaxpct=25<br>         =                       sunit=0      swidth=0 blks<br>naming   =version 2              bsize=4096   ascii-ci=0 ftype=1<br><span class="hljs-built_in">log</span>      =internal <span class="hljs-built_in">log</span>           bsize=4096   blocks=19198, version=2<br>         =                       sectsz=512   sunit=0 blks, lazy-count=1<br>realtime =none                   extsz=4096   blocks=0, rtextents=0<br>[root@duyuhan ~]# mount /dev/vg_data/lv_data /data_v2<br>[root@duyuhan ~]# <span class="hljs-built_in">df</span> -h<br>æ–‡ä»¶ç³»ç»Ÿ                     å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹<br>devtmpfs                     7.8G     0  7.8G    0% /dev<br>tmpfs                        7.8G     0  7.8G    0% /dev/shm<br>tmpfs                        7.8G  9.2M  7.8G    1% /run<br>tmpfs                        7.8G     0  7.8G    0% /sys/fs/cgroup<br>/dev/mapper/centos-root      491G   26G  466G    6% /<br>/dev/sda1                   1014M  195M  820M   20% /boot<br>overlay                      491G   26G  466G    6% /var/lib/docker/overlay2/195a33dd1977f7da3efffbbcd3f0ccd7dcf0a91b31e686c81378ebcc162bdccb/merged<br>overlay                      491G   26G  466G    6% /var/lib/docker/overlay2/a13806f6ff062846a0f4d0eedbe041a9c407e7206b8bd6b54967e2ecd05e1f82/merged<br>overlay                      491G   26G  466G    6% /var/lib/docker/overlay2/9d7e1a5f51d5b79a70c1c688cb22cffa0ffac4a5447bbe86bf278046e38b97c0/merged<br>overlay                      491G   26G  466G    6% /var/lib/docker/overlay2/768569a96e74265b89dbc2b59f45b42fc684f4e57abc4dfe8a8abd62b7d248c4/merged<br>tmpfs                        1.6G     0  1.6G    0% /run/user/0<br>/dev/mapper/vg_data-lv_data  150G   33M  150G    1% /data_v2<br>[root@duyuhan ~]# blkid /dev/vg_data/lv_data<br>/dev/vg_data/lv_data: UUID=<span class="hljs-string">&quot;d64c8e66-5a31-4ee9-810b-3ba872c27d75&quot;</span> TYPE=<span class="hljs-string">&quot;xfs&quot;</span> <br>[root@duyuhan ~]# vi /etc/fstab <br>[root@duyuhan ~]# mount -a<br>[root@duyuhan ~]# <span class="hljs-built_in">df</span> -h<br>æ–‡ä»¶ç³»ç»Ÿ                     å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹<br>devtmpfs                     7.8G     0  7.8G    0% /dev<br>tmpfs                        7.8G     0  7.8G    0% /dev/shm<br>tmpfs                        7.8G  9.2M  7.8G    1% /run<br>tmpfs                        7.8G     0  7.8G    0% /sys/fs/cgroup<br>/dev/mapper/centos-root      491G   26G  466G    6% /<br>/dev/sda1                   1014M  195M  820M   20% /boot<br>overlay                      491G   26G  466G    6% /var/lib/docker/overlay2/195a33dd1977f7da3efffbbcd3f0ccd7dcf0a91b31e686c81378ebcc162bdccb/merged<br>overlay                      491G   26G  466G    6% /var/lib/docker/overlay2/a13806f6ff062846a0f4d0eedbe041a9c407e7206b8bd6b54967e2ecd05e1f82/merged<br>overlay                      491G   26G  466G    6% /var/lib/docker/overlay2/9d7e1a5f51d5b79a70c1c688cb22cffa0ffac4a5447bbe86bf278046e38b97c0/merged<br>overlay                      491G   26G  466G    6% /var/lib/docker/overlay2/768569a96e74265b89dbc2b59f45b42fc684f4e57abc4dfe8a8abd62b7d248c4/merged<br>tmpfs                        1.6G     0  1.6G    0% /run/user/0<br>/dev/mapper/vg_data-lv_data  150G   33M  150G    1% /data_v2<br>[root@duyuhan ~]# lsblk<br>NAME              MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT<br>sda                 8:0    0   500G  0 disk <br>â”œâ”€sda1              8:1    0     1G  0 part /boot<br>â””â”€sda2              8:2    0   499G  0 part <br>  â”œâ”€centos-root   253:0    0 491.1G  0 lvm  /<br>  â””â”€centos-swap   253:1    0   7.9G  0 lvm  [SWAP]<br>sdb                 8:16   0    50G  0 disk <br>â””â”€vg_data-lv_data 253:2    0   150G  0 lvm  /data_v2<br>sdc                 8:32   0    50G  0 disk <br>â””â”€vg_data-lv_data 253:2    0   150G  0 lvm  /data_v2<br>sdd                 8:48   0    50G  0 disk <br>â””â”€vg_data-lv_data 253:2    0   150G  0 lvm  /data_v2<br>sr0                11:0    1   973M  0 rom  <br>[root@duyuhan ~]# reboot<br>Connection closing...Socket close.<br><br>Connection closed by foreign host.<br><br>Disconnected from remote host(10.67.44.168) at 11:28:53.<br><br>Type `<span class="hljs-built_in">help</span><span class="hljs-string">&#x27; to learn how to use Xshell prompt.</span><br><span class="hljs-string">[C:\~]$ </span><br><span class="hljs-string"></span><br><span class="hljs-string">Connecting to 10.67.xx.xx:22...</span><br><span class="hljs-string">Connection established.</span><br><span class="hljs-string">To escape to local shell, press &#x27;</span>Ctrl+Alt+]<span class="hljs-string">&#x27;.</span><br><span class="hljs-string"></span><br><span class="hljs-string">WARNING! The remote SSH server rejected X11 forwarding request.</span><br><span class="hljs-string">Last login: Wed Jan  8 11:19:47 2025 from 10.67.xx.xx</span><br><span class="hljs-string">[root@duyuhan ~]# df -h</span><br><span class="hljs-string">æ–‡ä»¶ç³»ç»Ÿ                     å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹</span><br><span class="hljs-string">devtmpfs                     7.8G     0  7.8G    0% /dev</span><br><span class="hljs-string">tmpfs                        7.8G     0  7.8G    0% /dev/shm</span><br><span class="hljs-string">tmpfs                        7.8G  9.2M  7.8G    1% /run</span><br><span class="hljs-string">tmpfs                        7.8G     0  7.8G    0% /sys/fs/cgroup</span><br><span class="hljs-string">/dev/mapper/centos-root      491G   26G  466G    6% /</span><br><span class="hljs-string">/dev/sda1                   1014M  195M  820M   20% /boot</span><br><span class="hljs-string">/dev/mapper/vg_data-lv_data  150G   33M  150G    1% /data_v2</span><br><span class="hljs-string">overlay                      491G   26G  466G    6% /var/lib/docker/overlay2/768569a96e74265b89dbc2b59f45b42fc684f4e57abc4dfe8a8abd62b7d248c4/merged</span><br><span class="hljs-string">overlay                      491G   26G  466G    6% /var/lib/docker/overlay2/a13806f6ff062846a0f4d0eedbe041a9c407e7206b8bd6b54967e2ecd05e1f82/merged</span><br><span class="hljs-string">overlay                      491G   26G  466G    6% /var/lib/docker/overlay2/195a33dd1977f7da3efffbbcd3f0ccd7dcf0a91b31e686c81378ebcc162bdccb/merged</span><br><span class="hljs-string">overlay                      491G   26G  466G    6% /var/lib/docker/overlay2/9d7e1a5f51d5b79a70c1c688cb22cffa0ffac4a5447bbe86bf278046e38b97c0/merged</span><br><span class="hljs-string">tmpfs                        1.6G     0  1.6G    0% /run/user/0</span><br><span class="hljs-string">[root@duyuhan ~]# lsblk</span><br><span class="hljs-string">NAME              MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="hljs-string">sda                 8:0    0   500G  0 disk </span><br><span class="hljs-string">â”œâ”€sda1              8:1    0     1G  0 part /boot</span><br><span class="hljs-string">â””â”€sda2              8:2    0   499G  0 part </span><br><span class="hljs-string">  â”œâ”€centos-root   253:0    0 491.1G  0 lvm  /</span><br><span class="hljs-string">  â””â”€centos-swap   253:1    0   7.9G  0 lvm  [SWAP]</span><br><span class="hljs-string">sdb                 8:16   0    50G  0 disk </span><br><span class="hljs-string">â””â”€vg_data-lv_data 253:2    0   150G  0 lvm  /data_v2</span><br><span class="hljs-string">sdc                 8:32   0    50G  0 disk </span><br><span class="hljs-string">â””â”€vg_data-lv_data 253:2    0   150G  0 lvm  /data_v2</span><br><span class="hljs-string">sdd                 8:48   0    50G  0 disk </span><br><span class="hljs-string">â””â”€vg_data-lv_data 253:2    0   150G  0 lvm  /data_v2</span><br><span class="hljs-string">sr0                11:0    1   973M  0 rom  </span><br><span class="hljs-string">[root@duyuhan ~]# cd //data_v2</span><br><span class="hljs-string">[root@duyuhan data_v2]# </span><br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ æˆåŠŸåœ°å°† <code>sdb</code>ã€<code>sdc</code> å’Œ <code>sdd</code> ä¸‰å—ç£ç›˜åˆå¹¶æˆä¸€ä¸ªé€»è¾‘å·ï¼Œå¹¶å°†å…¶æŒ‚è½½åˆ° <code>/data_v2</code> ç›®å½•ã€‚åŒæ—¶ï¼Œä½ ç¡®ä¿äº†æ–°é€»è¾‘å·çš„æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ä¸å½“å‰ç³»ç»Ÿä¸»åˆ†åŒºä¸€è‡´ï¼Œé¿å…äº†ä¸å…¼å®¹é—®é¢˜ï¼Œå¹¶é…ç½®äº†å¼€æœºè‡ªåŠ¨æŒ‚è½½ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux ä¸­æŸ¥æ‰¾å ç”¨ç‰¹å®šç«¯å£çš„è¿›ç¨‹</title>
    <link href="/2025/01/06/Linux-%E4%B8%AD%E6%9F%A5%E6%89%BE%E5%8D%A0%E7%94%A8%E7%89%B9%E5%AE%9A%E7%AB%AF%E5%8F%A3%E7%9A%84%E8%BF%9B%E7%A8%8B/"/>
    <url>/2025/01/06/Linux-%E4%B8%AD%E6%9F%A5%E6%89%BE%E5%8D%A0%E7%94%A8%E7%89%B9%E5%AE%9A%E7%AB%AF%E5%8F%A3%E7%9A%84%E8%BF%9B%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå¦‚æœä½ å·²çŸ¥æŸä¸ªç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹æ³•æŸ¥æ‰¾å¯¹åº”çš„è¿›ç¨‹ IDï¼ˆPIDï¼‰ä»¥åŠè·å–è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h2 id="æ–¹æ³•-1ï¼šä½¿ç”¨-netstat"><a href="#æ–¹æ³•-1ï¼šä½¿ç”¨-netstat" class="headerlink" title="æ–¹æ³• 1ï¼šä½¿ç”¨ netstat"></a>æ–¹æ³• 1ï¼šä½¿ç”¨ <code>netstat</code></h2><p>ä½¿ç”¨ <code>netstat</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç½‘ç»œè¿æ¥å’Œç›‘å¬ç«¯å£çš„ä¿¡æ¯ã€‚</p><h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -tulnp | grep &lt;ç«¯å£å·&gt;<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æŸ¥æ‰¾ 6379 ç«¯å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -tulnp | grep 6379<br></code></pre></td></tr></table></figure><h3 id="è¾“å‡ºç¤ºä¾‹"><a href="#è¾“å‡ºç¤ºä¾‹" class="headerlink" title="è¾“å‡ºç¤ºä¾‹"></a>è¾“å‡ºç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">tcp        0      0 0.0.0.0:6379            0.0.0.0:*               LISTEN      2448/docker-proxy   <br>tcp6       0      0 :::6379                 :::*                    LISTEN      2454/docker-proxy<br></code></pre></td></tr></table></figure><h2 id="æ–¹æ³•-2ï¼šä½¿ç”¨-lsof"><a href="#æ–¹æ³•-2ï¼šä½¿ç”¨-lsof" class="headerlink" title="æ–¹æ³• 2ï¼šä½¿ç”¨ lsof"></a>æ–¹æ³• 2ï¼šä½¿ç”¨ <code>lsof</code></h2><p><code>lsof</code> å‘½ä»¤ç”¨äºåˆ—å‡ºæ‰“å¼€çš„æ–‡ä»¶åŠå…¶å¯¹åº”çš„è¿›ç¨‹ã€‚</p><h3 id="å‘½ä»¤-1"><a href="#å‘½ä»¤-1" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsof -i :&lt;ç«¯å£å·&gt;<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æŸ¥æ‰¾ 6379 ç«¯å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsof -i:6379<br></code></pre></td></tr></table></figure><h3 id="è¾“å‡ºç¤ºä¾‹-1"><a href="#è¾“å‡ºç¤ºä¾‹-1" class="headerlink" title="è¾“å‡ºç¤ºä¾‹"></a>è¾“å‡ºç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">COMMAND    PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME<br>docker-pr 2448 root    4u  IPv4  38430      0t0  TCP *:6379 (LISTEN)<br>docker-pr 2454 root    4u  IPv6  23712      0t0  TCP *:6379 (LISTEN)<br></code></pre></td></tr></table></figure><h2 id="æ–¹æ³•-3ï¼šä½¿ç”¨-ss"><a href="#æ–¹æ³•-3ï¼šä½¿ç”¨-ss" class="headerlink" title="æ–¹æ³• 3ï¼šä½¿ç”¨ ss"></a>æ–¹æ³• 3ï¼šä½¿ç”¨ <code>ss</code></h2><p><code>ss</code> æ˜¯ä¸€ä¸ªæ›´ç°ä»£çš„ç½‘ç»œå·¥å…·ï¼Œç”¨äºæŸ¥çœ‹ socket çŠ¶æ€ã€‚</p><h3 id="å‘½ä»¤-2"><a href="#å‘½ä»¤-2" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ss -tulnp | grep &lt;ç«¯å£å·&gt;<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æŸ¥æ‰¾ 6379 ç«¯å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ss -tulnp | grep 6379<br></code></pre></td></tr></table></figure><h3 id="è¾“å‡ºç¤ºä¾‹-2"><a href="#è¾“å‡ºç¤ºä¾‹-2" class="headerlink" title="è¾“å‡ºç¤ºä¾‹"></a>è¾“å‡ºç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">tcp    LISTEN     0      128     *:6379                  *:*                     users:((&quot;docker-proxy&quot;,pid=2448,fd=4))<br>tcp    LISTEN     0      128      [::]:6379                   [::]:*                     users:((&quot;docker-proxy&quot;,pid=2454,fd=4))<br></code></pre></td></tr></table></figure><h2 id="è·å–è¿›ç¨‹è¯¦ç»†ä¿¡æ¯"><a href="#è·å–è¿›ç¨‹è¯¦ç»†ä¿¡æ¯" class="headerlink" title="è·å–è¿›ç¨‹è¯¦ç»†ä¿¡æ¯"></a>è·å–è¿›ç¨‹è¯¦ç»†ä¿¡æ¯</h2><p>ä¸€æ—¦ä½ è·å¾—äº† PIDï¼Œå¯ä»¥ä½¿ç”¨ <code>ps</code> å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="å‘½ä»¤-3"><a href="#å‘½ä»¤-3" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps -p &lt;PID&gt; -o pid,<span class="hljs-built_in">comm</span>,args<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æŸ¥æ‰¾ PID ä¸º 2448 çš„è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@luffy ~]# ps -p 2448 -o pid,<span class="hljs-built_in">comm</span>,args<br>  PID COMMAND         COMMAND<br> 2448 docker-proxy    /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 6379 -container-ip 172.24.0.2 -container-port 6379<br>[root@luffy ~]# ps -a 2448<br>  PID TTY      STAT   TIME COMMAND<br> 2448 ?        Sl     0:00 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 6379 -container-ip 172.24.0.2 -container-port 6379<br>14505 pts/0    R+     0:00 ps -a 2448<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä¸Šè¿°ä¸‰ç§æ–¹æ³•ï¼Œä½ å¯ä»¥æˆåŠŸæŸ¥æ‰¾å ç”¨ç‰¹å®šç«¯å£çš„è¿›ç¨‹åŠå…¶ PIDï¼Œå¹¶è¿›ä¸€æ­¥è·å–è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™åœ¨è¿›è¡Œç½‘ç»œæ•…éšœæ’é™¤æˆ–ç®¡ç†ç›‘å¬æœåŠ¡æ—¶éå¸¸æœ‰ç”¨ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux æŸ¥çœ‹å½“å‰æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è¢«å“ªäº›è¿›ç¨‹å ç”¨</title>
    <link href="/2025/01/06/Linux-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E5%A4%B9%E8%A2%AB%E5%93%AA%E4%BA%9B%E8%BF%9B%E7%A8%8B%E5%8D%A0%E7%94%A8/"/>
    <url>/2025/01/06/Linux-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E5%A4%B9%E8%A2%AB%E5%93%AA%E4%BA%9B%E8%BF%9B%E7%A8%8B%E5%8D%A0%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå¦‚æœä½ æƒ³æŸ¥çœ‹æŸä¸ªæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è¢«å“ªäº›è¿›ç¨‹æˆ–ç¨‹åºå ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹æ³•ã€‚</p><h2 id="æ–¹æ³•-1ï¼šä½¿ç”¨-lsof"><a href="#æ–¹æ³•-1ï¼šä½¿ç”¨-lsof" class="headerlink" title="æ–¹æ³• 1ï¼šä½¿ç”¨ lsof"></a>æ–¹æ³• 1ï¼šä½¿ç”¨ <code>lsof</code></h2><p><code>lsof</code>ï¼ˆlist open filesï¼‰æ˜¯æœ€å¸¸ç”¨çš„å·¥å…·ä¹‹ä¸€ï¼Œå¯ä»¥åˆ—å‡ºæ‰“å¼€çš„æ–‡ä»¶åŠå…¶å¯¹åº”çš„è¿›ç¨‹ã€‚</p><h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsof &lt;æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è·¯å¾„&gt;<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æŸ¥çœ‹ <code>/path/to/file</code> æ–‡ä»¶è¢«å“ªäº›è¿›ç¨‹å ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsof /path/to/file<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ <code>/path/to/directory</code> æ–‡ä»¶å¤¹è¢«å“ªäº›è¿›ç¨‹å ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsof +D /path/to/directory<br></code></pre></td></tr></table></figure><h3 id="è¾“å‡ºç¤ºä¾‹"><a href="#è¾“å‡ºç¤ºä¾‹" class="headerlink" title="è¾“å‡ºç¤ºä¾‹"></a>è¾“å‡ºç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">COMMAND    PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME<br>process_name 1234 user   4u  REG  8,1  12345  6789 /path/to/file<br></code></pre></td></tr></table></figure><h2 id="æ–¹æ³•-2ï¼šä½¿ç”¨-fuser"><a href="#æ–¹æ³•-2ï¼šä½¿ç”¨-fuser" class="headerlink" title="æ–¹æ³• 2ï¼šä½¿ç”¨ fuser"></a>æ–¹æ³• 2ï¼šä½¿ç”¨ <code>fuser</code></h2><p><code>fuser</code> å‘½ä»¤ç”¨äºæ˜¾ç¤ºæ­£åœ¨ä½¿ç”¨æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„è¿›ç¨‹ IDã€‚</p><h3 id="å‘½ä»¤-1"><a href="#å‘½ä»¤-1" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">fuser &lt;æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è·¯å¾„&gt;<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æŸ¥çœ‹ <code>/path/to/file</code> æ–‡ä»¶è¢«å“ªäº›è¿›ç¨‹å ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">fuser /path/to/file<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ <code>/path/to/directory</code> æ–‡ä»¶å¤¹è¢«å“ªäº›è¿›ç¨‹å ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">fuser -m /path/to/directory<br></code></pre></td></tr></table></figure><h3 id="è¾“å‡ºç¤ºä¾‹-1"><a href="#è¾“å‡ºç¤ºä¾‹-1" class="headerlink" title="è¾“å‡ºç¤ºä¾‹"></a>è¾“å‡ºç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">/path/to/file: 1234 5678<br></code></pre></td></tr></table></figure><h2 id="æ–¹æ³•-3ï¼šä½¿ç”¨-lsof-å’Œ-grep-ç»„åˆ"><a href="#æ–¹æ³•-3ï¼šä½¿ç”¨-lsof-å’Œ-grep-ç»„åˆ" class="headerlink" title="æ–¹æ³• 3ï¼šä½¿ç”¨ lsof å’Œ grep ç»„åˆ"></a>æ–¹æ³• 3ï¼šä½¿ç”¨ <code>lsof</code> å’Œ <code>grep</code> ç»„åˆ</h2><p>å¦‚æœä½ æƒ³è¦è¿‡æ»¤ç‰¹å®šçš„è¿›ç¨‹æˆ–ç¨‹åºï¼Œå¯ä»¥ç»“åˆ <code>lsof</code> å’Œ <code>grep</code> ä½¿ç”¨ã€‚</p><h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æŸ¥æ‰¾ç‰¹å®šç±»å‹çš„è¿›ç¨‹å ç”¨æŸä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsof | grep &lt;æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è·¯å¾„&gt;<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä¸Šè¿°å‡ ç§æ–¹æ³•ï¼Œä½ å¯ä»¥è½»æ¾æŸ¥çœ‹å½“å‰æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è¢«å“ªäº›è¿›ç¨‹æˆ–ç¨‹åºå ç”¨ã€‚è¿™å¯¹äºæ’æŸ¥æ–‡ä»¶æˆ–ç›®å½•è¢«é”å®šçš„é—®é¢˜éå¸¸æœ‰ç”¨ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨ tc å‘½ä»¤æ¨¡æ‹ŸLinux ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…</title>
    <link href="/2024/10/30/%E4%BD%BF%E7%94%A8-tc-%E5%91%BD%E4%BB%A4%E6%A8%A1%E6%8B%9FLinux-%E7%BD%91%E7%BB%9C%E5%BB%B6%E8%BF%9F%E5%92%8C%E4%B8%A2%E5%8C%85/"/>
    <url>/2024/10/30/%E4%BD%BF%E7%94%A8-tc-%E5%91%BD%E4%BB%A4%E6%A8%A1%E6%8B%9FLinux-%E7%BD%91%E7%BB%9C%E5%BB%B6%E8%BF%9F%E5%92%8C%E4%B8%A2%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>åœ¨ç³»ç»Ÿä¸­æœ‰éœ€è¦è®¿é—®å…¬ç½‘èµ„æºçš„æƒ…å†µæ—¶ï¼Œéœ€è¦è€ƒè™‘ç½‘ç»œå¼‚å¸¸çš„æƒ…å†µï¼Œå¦‚å»¶è¿Ÿé«˜ï¼Œä¸¢åŒ…ç‡é«˜çš„æƒ…å†µï¼Œä»£ç ä¸­éœ€è¦åšå¥½å¼‚å¸¸å¤„ç†ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨æµ‹è¯•çš„æ—¶å€™æ¨¡æ‹Ÿç½‘ç»œæƒ…å†µå¼‚å¸¸æƒ…å†µå‘¢ï¼Ÿä¸‹é¢ä»¥centos 7.9ä¸ºä¾‹å­</p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><p><strong>å®‰è£…</strong> <code>iproute</code> <strong>å·¥å…·</strong>ï¼šç¡®ä¿ä½ çš„ CentOS ä¸Šå®‰è£…äº† <code>iproute</code>ï¼Œé€šå¸¸å®ƒä¼šé»˜è®¤å®‰è£…ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> yum install -y iproute<br></code></pre></td></tr></table></figure><p><strong>æŸ¥æ‰¾ç½‘ç»œæ¥å£</strong>ï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºç½‘ç»œæ¥å£ï¼Œå¹¶ç¡®å®šä½ è¦æ§åˆ¶çš„æ¥å£ï¼ˆå¦‚ <code>eth0</code>ã€<code>enp0s3</code> ç­‰ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ip <span class="hljs-built_in">link</span> show<br></code></pre></td></tr></table></figure><p><strong>é…ç½®ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…</strong>ï¼šä½¿ç”¨ <code>tc</code> å‘½ä»¤é…ç½®ç½‘ç»œæ¨¡æ‹Ÿã€‚ä¾‹å¦‚ï¼Œæ·»åŠ  99% çš„ä¸¢åŒ…ç‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> tc qdisc add dev eth0 root netem loss 99%<br></code></pre></td></tr></table></figure><p>è¯·ç¡®ä¿å°† <code>eth0</code> æ›¿æ¢ä¸ºä½ çš„å®é™…ç½‘ç»œæ¥å£åç§°ã€‚</p><ol><li><strong>æ‰§è¡Œä¸‹è½½æµ‹è¯•</strong>ï¼šè¿›è¡Œä¸‹è½½æ“ä½œï¼Œè§‚å¯Ÿåœ¨ç½‘ç»œä¸­æ–­æ¡ä»¶ä¸‹çš„è¡¨ç°ã€‚</li></ol><p><strong>æ¢å¤æ­£å¸¸ç½‘ç»œ</strong>ï¼šæµ‹è¯•å®Œæˆåï¼Œæ¸…é™¤ç½‘ç»œé…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> tc qdisc del dev eth0 root<br></code></pre></td></tr></table></figure><p>é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œä½ å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šæœ‰æ•ˆåœ°æ§åˆ¶ç½‘ç»œæ¡ä»¶ï¼Œæ¨¡æ‹Ÿä¸‹è½½è¿‡ç¨‹ä¸­çš„ç½‘ç»œä¸­æ–­ã€‚å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œç¡®ä¿æ£€æŸ¥æ¥å£åç§°å’Œæ‰§è¡Œæƒé™ã€‚</p><h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h2><p>å¦‚æœæœåŠ¡æ˜¯ä»¥dockerå®¹å™¨çš„æ–¹å¼è¿è¡Œï¼Œé€šå¸¸åœ¨å®¹å™¨ä¸­ç›´æ¥ä¸‹è½½tcå·¥å…·ï¼Œæ¨¡æ‹Ÿç½‘ç»œå¼‚å¸¸æ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œå› ä¸ºå®¹å™¨ä¸­çš„ç½‘ç»œæ¥å£æ˜¯è™šæ‹Ÿå‡ºæ¥çš„ï¼Œä½ åªèƒ½æŠŠé…ç½®è™šæ‹Ÿç½‘ç»œæ¥å£ï¼Œä½†æ˜¯æœ€ç»ˆè¿˜æ˜¯ä¼šé€šè¿‡docker0è½¬å‘ç»™å®¿ä¸»æœºï¼Œç­‰äºè¯´è¿˜æ˜¯ç”¨çš„å®¿ä¸»æœºçš„ç½‘ç»œï¼Œä¸æ§åˆ¶å®¿ä¸»æœºçš„ç½‘ç»œæ˜¯ä¸èƒ½å®ç°æ•ˆæœçš„ï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤šç½‘å£è¿é€šæ€§æµ‹è¯•</title>
    <link href="/2024/09/24/%E5%A4%9A%E7%BD%91%E5%8F%A3%E8%BF%9E%E9%80%9A%E6%80%A7%E6%B5%8B%E8%AF%95/"/>
    <url>/2024/09/24/%E5%A4%9A%E7%BD%91%E5%8F%A3%E8%BF%9E%E9%80%9A%E6%80%A7%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@NSFOCUS-SDA ~]# nmcli connection show  <span class="hljs-comment"># æŸ¥çœ‹ç½‘ç»œè¿æ¥</span><br>NAME             UUID                                  TYPE      DEVICE          <br>p13p1            de2205fc-4913-4927-a2da-1891a01aa8c8  ethernet  p13p1           <br>br-bb7dacad31d5  848d9b45-ea7b-47ca-adbf-edc3f0511dbd  bridge    br-bb7dacad31d5 <br>enp0s20f0u5u3c2  79100f5d-10fc-45de-8499-789377470103  ethernet  --              <br>p13p2            1c6c15c1-a4c6-4db9-9902-1f4b92d36277  ethernet  --              <br>[root@NSFOCUS-SDA ~]# ping -I p13p1 8.8.8.8 <span class="hljs-comment"># æŒ‡å®šç½‘å£å‘åŒ…æµ‹è¯• </span><br>PING 8.8.8.8 (8.8.8.8) from 10.67.6.124 p13p1: 56(84) bytes of data.<br>64 bytes from 8.8.8.8: icmp_seq=1 ttl=52 <span class="hljs-keyword">time</span>=51.1 ms<br>64 bytes from 8.8.8.8: icmp_seq=2 ttl=52 <span class="hljs-keyword">time</span>=50.4 ms<br>64 bytes from 8.8.8.8: icmp_seq=3 ttl=52 <span class="hljs-keyword">time</span>=50.2 ms<br>64 bytes from 8.8.8.8: icmp_seq=4 ttl=52 <span class="hljs-keyword">time</span>=50.1 ms<br>64 bytes from 8.8.8.8: icmp_seq=5 ttl=52 <span class="hljs-keyword">time</span>=50.2 ms<br>^C<br>--- 8.8.8.8 ping statistics ---<br>5 packets transmitted, 5 received, 0% packet loss, <span class="hljs-keyword">time</span> 4005ms<br>rtt min/avg/max/mdev = 50.077/50.382/51.054/0.347 ms<br>[root@NSFOCUS-SDA ~]# nmcli connection down em1 <span class="hljs-comment"># downæ‰em1</span><br>[root@NSFOCUS-SDA ~]# nmcli connection up em1  <span class="hljs-comment"># up em1</span><br></code></pre></td></tr></table></figure><p>æŒ‡å®šç½‘å£æµ‹è¯•è¿˜æœ‰ä»¥ä¸‹å‘½ä»¤ï¼š</p><ol><li><strong>ä½¿ç”¨</strong><code>traceroute</code><strong>æ£€æŸ¥è·¯ç”±</strong>ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">traceroute -i em1 8.8.8.8<br></code></pre></td></tr></table></figure><ol><li><strong>ä½¿ç”¨</strong><code>**curl**</code><strong>æˆ–</strong><code>**wget**</code>ï¼š ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·å‘é€HTTPè¯·æ±‚ï¼ŒæŒ‡å®šç½‘å¡ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl --interface em1 http://www.example.com<br></code></pre></td></tr></table></figure><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>ç¡®ä¿<code>em1</code>ç½‘å¡å·²å¯ç”¨ä¸”é…ç½®æ­£ç¡®ï¼Œå¹¶ä¸”ç³»ç»Ÿæœ‰æƒé™ä½¿ç”¨è¯¥ç½‘å¡è¿›è¡Œå‘åŒ…ã€‚é€šè¿‡è¿™äº›å‘½ä»¤ï¼Œä½ å¯ä»¥ç¡®å®š<code>em1</code>æ˜¯å¦èƒ½å¤Ÿè¿æ¥å¤–ç½‘ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python zipfileå‹ç¼©å¯¹æ–‡ä»¶æ—¶é—´çš„è¦æ±‚</title>
    <link href="/2024/08/30/Python-zipfile%E5%8E%8B%E7%BC%A9%E5%AF%B9%E6%96%87%E4%BB%B6%E6%97%B6%E9%97%B4%E7%9A%84%E8%A6%81%E6%B1%82/"/>
    <url>/2024/08/30/Python-zipfile%E5%8E%8B%E7%BC%A9%E5%AF%B9%E6%96%87%E4%BB%B6%E6%97%B6%E9%97%B4%E7%9A%84%E8%A6%81%E6%B1%82/</url>
    
    <content type="html"><![CDATA[<p>ZIP æ ¼å¼å¯¹æ–‡ä»¶æ—¶é—´æˆ³çš„é™åˆ¶ä¸»è¦æ˜¯å†å²åŸå› ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®ç‚¹ï¼š</p><ol><li><strong>æ—¶é—´æˆ³æ ¼å¼</strong>ï¼š</li></ol><ul><li><ul><li>ZIP æ–‡ä»¶ä½¿ç”¨çš„æ—¶é—´æˆ³æ ¼å¼åŸºäº DOS æ—¶é—´æ ¼å¼ï¼Œé€šå¸¸ç”¨ 2 å­—èŠ‚æ¥å­˜å‚¨æ—¥æœŸå’Œæ—¶é—´ã€‚</li><li>è¿™ç§æ ¼å¼æ”¯æŒçš„æœ€æ—©æ—¥æœŸæ˜¯ 1980 å¹´ 1 æœˆ 1 æ—¥ï¼Œå› æ­¤æ— æ³•å¤„ç†æ—©äºè¿™ä¸ªæ—¥æœŸçš„æ–‡ä»¶ã€‚</li></ul></li></ul><ol><li><strong>å…¼å®¹æ€§</strong>ï¼š</li></ol><ul><li><ul><li>ZIP æ ¼å¼è®¾è®¡ä¹‹åˆä¸»è¦ç”¨äº DOS å’Œæ—©æœŸ Windows ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿçš„æ–‡ä»¶æ—¶é—´æˆ³ä¹Ÿæœ‰ç±»ä¼¼çš„é™åˆ¶ã€‚</li><li>ä¸ºäº†ç¡®ä¿è·¨å¹³å°çš„å…¼å®¹æ€§ï¼ŒZIP æ ¼å¼ä¿æŒäº†è¿™ä¸€é™åˆ¶ã€‚</li></ul></li></ul><ol><li><strong>ç°ä»£éœ€æ±‚</strong>ï¼š</li></ol><ul><li><ul><li>å°½ç®¡ç°ä»£æ“ä½œç³»ç»Ÿï¼ˆå¦‚ Linux å’Œ macOSï¼‰æ”¯æŒæ›´æ—©çš„æ—¶é—´æˆ³ï¼Œä½†ä¸ºäº†ä¸æ—§ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºä¿æŒå…¼å®¹ï¼ŒZIP æ ¼å¼æ²¡æœ‰è¿›è¡Œæ›´æ”¹ã€‚</li></ul></li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç”±äºå†å²å’Œå…¼å®¹æ€§åŸå› ï¼ŒZIP æ ¼å¼æ— æ³•æ”¯æŒæ—©äº 1980 å¹´çš„æ—¶é—´æˆ³ã€‚è¿™æ„å‘³ç€åœ¨å¤„ç†æ—©æœŸæ–‡ä»¶æ—¶ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘ä½¿ç”¨å…¶ä»–æ ¼å¼ï¼ˆå¦‚ tarï¼‰æˆ–ä¿®æ”¹æ–‡ä»¶æ—¶é—´æˆ³ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸¤å°LinuxæœåŠ¡å™¨é…ç½®å…å¯†ç™»å½•</title>
    <link href="/2024/08/07/%E4%B8%A4%E5%8F%B0Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/"/>
    <url>/2024/08/07/%E4%B8%A4%E5%8F%B0Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>ä¸ºäº†æ–¹ä¾¿åŒæ­¥æ“ä½œï¼Œå¯ä»¥é…ç½®AæœåŠ¡å™¨åˆ°BæœåŠ¡å™¨çš„SSHå…å¯†ç ç™»å½•ã€‚</p><p><strong>åœ¨AæœåŠ¡å™¨ä¸Šç”ŸæˆSSHå¯†é’¥ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh-keygen -t rsa -b 4096 -C <span class="hljs-string">&quot;your_email@example.com&quot;</span><br></code></pre></td></tr></table></figure><p>æŒ‰ç…§æç¤ºå®Œæˆå¯†é’¥ç”Ÿæˆåï¼Œå°†å…¬é’¥å¤åˆ¶åˆ°BæœåŠ¡å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh-copy-id user@b_server_ip<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æŸ¥çœ‹linuxæ—¶åŒºå’Œä¿®æ”¹æ—¶åŒº</title>
    <link href="/2024/08/07/%E6%9F%A5%E7%9C%8Blinux%E6%97%B6%E5%8C%BA%E5%92%8C%E4%BF%AE%E6%94%B9%E6%97%B6%E5%8C%BA/"/>
    <url>/2024/08/07/%E6%9F%A5%E7%9C%8Blinux%E6%97%B6%E5%8C%BA%E5%92%8C%E4%BF%AE%E6%94%B9%E6%97%B6%E5%8C%BA/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ Linux ç³»ç»Ÿä¸­æŸ¥çœ‹å’Œä¿®æ”¹æ—¶åŒºçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><h3 id="æŸ¥çœ‹å½“å‰æ—¶åŒº"><a href="#æŸ¥çœ‹å½“å‰æ—¶åŒº" class="headerlink" title="æŸ¥çœ‹å½“å‰æ—¶åŒº"></a>æŸ¥çœ‹å½“å‰æ—¶åŒº</h3><ol><li><strong>ä½¿ç”¨</strong> <code>date</code> <strong>å‘½ä»¤æŸ¥çœ‹å½“å‰æ—¶é—´å’Œæ—¶åŒºï¼š</strong></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">date<br></code></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šæ˜¾ç¤ºå½“å‰æ—¥æœŸã€æ—¶é—´å’Œæ—¶åŒºä¿¡æ¯ã€‚</p><ol><li><strong>æŸ¥çœ‹å½“å‰æ—¶åŒºè®¾ç½®æ–‡ä»¶ï¼š</strong></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -l /etc/localtime<br></code></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šæ˜¾ç¤º <code>/etc/localtime</code> æ–‡ä»¶çš„ç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘å½“å‰ä½¿ç”¨çš„æ—¶åŒºæ–‡ä»¶ã€‚</p><ol><li><strong>ä½¿ç”¨</strong> <code>timedatectl</code> <strong>å‘½ä»¤æŸ¥çœ‹è¯¦ç»†çš„æ—¶é—´å’Œæ—¶åŒºä¿¡æ¯ï¼š</strong></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">timedatectl<br></code></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šæ˜¾ç¤ºç³»ç»Ÿæ—¶é—´ã€UTC æ—¶é—´ã€RTC æ—¶é—´ã€æ—¶åŒºç­‰è¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="ä¿®æ”¹æ—¶åŒº"><a href="#ä¿®æ”¹æ—¶åŒº" class="headerlink" title="ä¿®æ”¹æ—¶åŒº"></a>ä¿®æ”¹æ—¶åŒº</h3><ol><li><strong>ä½¿ç”¨</strong> <code>timedatectl</code> <strong>å‘½ä»¤ä¿®æ”¹æ—¶åŒºï¼š</strong></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">timedatectl set-timezone &lt;æ—¶åŒº&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œè¦å°†æ—¶åŒºè®¾ç½®ä¸ºä¸Šæµ·æ—¶é—´ï¼ˆAsia&#x2F;Shanghaiï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">timedatectl set-timezone Asia/Shanghai<br></code></pre></td></tr></table></figure><ol><li><p><strong>æ‰‹åŠ¨ä¿®æ”¹æ—¶åŒºï¼š</strong><br>å¦‚æœç³»ç»Ÿä¸æ”¯æŒ <code>timedatectl</code> å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ‰‹åŠ¨ä¿®æ”¹æ—¶åŒºï¼š</p></li><li><ol><li>åˆ é™¤ç°æœ‰çš„ <code>/etc/localtime</code> æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ç¬¦å·é“¾æ¥ï¼‰ï¼š</li></ol></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo rm -f /etc/localtime<br></code></pre></td></tr></table></figure><ol><li><ol><li>åˆ›å»ºæŒ‡å‘æ‰€éœ€æ—¶åŒºæ–‡ä»¶çš„ç¬¦å·é“¾æ¥ï¼š</li></ol></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo ln -s /usr/share/zoneinfo/&lt;æ—¶åŒº&gt; /etc/localtime<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œè¦å°†æ—¶åŒºè®¾ç½®ä¸ºä¸Šæµ·æ—¶é—´ï¼ˆAsia&#x2F;Shanghaiï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<br></code></pre></td></tr></table></figure><ol><li><strong>éªŒè¯æ—¶åŒºä¿®æ”¹ï¼š</strong><br>å†æ¬¡ä½¿ç”¨ <code>date</code> æˆ– <code>timedatectl</code> å‘½ä»¤æ£€æŸ¥å½“å‰æ—¶åŒºæ˜¯å¦å·²æ›´æ”¹ä¸ºé¢„æœŸçš„æ—¶åŒºã€‚</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">date<br></code></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">timedatectl<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥æŸ¥çœ‹å’Œä¿®æ”¹ Linux ç³»ç»Ÿçš„æ—¶åŒºäº†ã€‚å¦‚æœæœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python çº¿ç¨‹é«˜CPUå ç”¨æ’æŸ¥æ€»ç»“</title>
    <link href="/2024/07/15/Python-%E7%BA%BF%E7%A8%8B%E9%AB%98CPU%E5%8D%A0%E7%94%A8%E6%8E%92%E6%9F%A5%E6%80%BB%E7%BB%93/"/>
    <url>/2024/07/15/Python-%E7%BA%BF%E7%A8%8B%E9%AB%98CPU%E5%8D%A0%E7%94%A8%E6%8E%92%E6%9F%A5%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h2 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1. èƒŒæ™¯"></a>1. èƒŒæ™¯</h2><ul><li>çº¿ä¸Šè¿›ç¨‹CPUå ç”¨å¼‚å¸¸åé«˜ã€‚</li><li>å¸Œæœ›å¿«é€Ÿå®šä½åˆ°<strong>æ˜¯å“ªä¸€ä¸ªçº¿ç¨‹</strong>å¯¼è‡´çš„é—®é¢˜ï¼Œå¹¶è¿›ä¸€æ­¥è¿½è¸ªåˆ°<strong>å…·ä½“Pythonä»£ç ä½ç½®</strong>ã€‚</li></ul><hr><h2 id="2-æ’æŸ¥æ­¥éª¤"><a href="#2-æ’æŸ¥æ­¥éª¤" class="headerlink" title="2. æ’æŸ¥æ­¥éª¤"></a>2. æ’æŸ¥æ­¥éª¤</h2><h3 id="ï¼ˆ1ï¼‰ç¡®è®¤CPUå¼‚å¸¸çš„è¿›ç¨‹"><a href="#ï¼ˆ1ï¼‰ç¡®è®¤CPUå¼‚å¸¸çš„è¿›ç¨‹" class="headerlink" title="ï¼ˆ1ï¼‰ç¡®è®¤CPUå¼‚å¸¸çš„è¿›ç¨‹"></a>ï¼ˆ1ï¼‰ç¡®è®¤CPUå¼‚å¸¸çš„è¿›ç¨‹</h3><p>é€šè¿‡å¸¸è§„ <code>top</code> æˆ– <code>htop</code> å·¥å…·ï¼Œæ‰¾åˆ°é«˜CPUå ç”¨çš„è¿›ç¨‹PIDï¼Œæ¯”å¦‚ <code>2608</code>ã€‚</p><hr><h3 id="ï¼ˆ2ï¼‰ç¡®è®¤çº¿ç¨‹è§†è§’ä¸‹çš„æƒ…å†µ"><a href="#ï¼ˆ2ï¼‰ç¡®è®¤çº¿ç¨‹è§†è§’ä¸‹çš„æƒ…å†µ" class="headerlink" title="ï¼ˆ2ï¼‰ç¡®è®¤çº¿ç¨‹è§†è§’ä¸‹çš„æƒ…å†µ"></a>ï¼ˆ2ï¼‰ç¡®è®¤çº¿ç¨‹è§†è§’ä¸‹çš„æƒ…å†µ</h3><p>æ‰§è¡Œ  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">top -H -p 2608<br></code></pre></td></tr></table></figure><p>æˆ–  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps -mp 2608 -o THREAD,tid,<span class="hljs-keyword">time</span><br></code></pre></td></tr></table></figure><p>åˆ‡æ¢åˆ°<strong>çº¿ç¨‹çº§åˆ«è§†è§’</strong>ï¼ŒæŸ¥çœ‹å“ªä¸ªTIDï¼ˆçº¿ç¨‹IDï¼‰CPUå ç”¨æœ€é«˜ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>  </p><ul><li><code>top -H</code>æ˜¯åŠ¨æ€å®æ—¶ç›‘æ§ã€‚</li><li><code>ps</code>æ˜¯é™æ€ä¸€æ¬¡æ€§å¿«ç…§ã€‚</li></ul><hr><h3 id="ï¼ˆ3ï¼‰å°†çº¿ç¨‹TIDè½¬æˆåå…­è¿›åˆ¶"><a href="#ï¼ˆ3ï¼‰å°†çº¿ç¨‹TIDè½¬æˆåå…­è¿›åˆ¶" class="headerlink" title="ï¼ˆ3ï¼‰å°†çº¿ç¨‹TIDè½¬æˆåå…­è¿›åˆ¶"></a>ï¼ˆ3ï¼‰å°†çº¿ç¨‹TIDè½¬æˆåå…­è¿›åˆ¶</h3><p>å› ä¸ºPythonè§£é‡Šå™¨å†…éƒ¨ä½¿ç”¨åå…­è¿›åˆ¶TIDï¼Œéœ€è¦è½¬æ¢ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;%x\n&quot;</span> çº¿ç¨‹å·<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚çº¿ç¨‹IDæ˜¯ <code>3245</code>ï¼Œè½¬æ¢åæ˜¯ <code>0xca5</code>ã€‚</p><hr><h3 id="ï¼ˆ4ï¼‰ç”¨GDB-attachåˆ°ç›®æ ‡è¿›ç¨‹"><a href="#ï¼ˆ4ï¼‰ç”¨GDB-attachåˆ°ç›®æ ‡è¿›ç¨‹" class="headerlink" title="ï¼ˆ4ï¼‰ç”¨GDB attachåˆ°ç›®æ ‡è¿›ç¨‹"></a>ï¼ˆ4ï¼‰ç”¨GDB attachåˆ°ç›®æ ‡è¿›ç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gdb -p 2608<br></code></pre></td></tr></table></figure><p>æˆåŠŸåï¼Œæ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">thread apply all bt<br></code></pre></td></tr></table></figure><p>æˆ–è€…é’ˆå¯¹å•ä¸€çº¿ç¨‹ï¼Œåˆ‡æ¢åˆ°æŒ‡å®šçº¿ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">thread çº¿ç¨‹å·<br>bt<br></code></pre></td></tr></table></figure><p>pstackè¾“å‡ºçš„æ˜¯cpythonçš„è°ƒç”¨ï¼ŒæŸ¥çœ‹å¾ˆä¸ä¼˜åŒ–</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@luffy</span> <span class="hljs-string">~</span>]<span class="hljs-comment"># pstack 2607</span><br><span class="hljs-attr">Thread 3 (Thread 0x7fc78e1a0700 (LWP 2608)):</span><br><span class="hljs-comment">#0  0x00000000004243ec in _PyEval_EvalFrameDefault (f=&lt;optimized out&gt;, throwflag=&lt;optimized out&gt;) at Python/ceval.c:2759</span><br><span class="hljs-comment">#1  0x0000000000420098 in function_code_fastcall (co=co@entry=0x7fc795c31300, args=&lt;optimized out&gt;, args@entry=0x7fc795ca6068, nargs=nargs@entry=0, globals=globals@entry=0x7fc795c5cc30) at Objects/call.c:283</span><br><span class="hljs-comment">#2  0x000000000043b186 in _PyFunction_FastCallDict (func=0x7fc795b8e050, args=args@entry=0x7fc795ca6068, nargs=0, kwargs=kwargs@entry=0x7fc795c1bd70) at Objects/call.c:322</span><br><span class="hljs-comment">#3  0x000000000043c763 in PyObject_Call (callable=callable@entry=0x7fc795b8e050, args=args@entry=0x7fc795ca6050, kwargs=kwargs@entry=0x7fc795c1bd70) at Objects/call.c:226</span><br><span class="hljs-comment">#4  0x0000000000422469 in do_call_core (kwdict=0x7fc795c1bd70, callargs=0x7fc795ca6050, func=0x7fc795b8e050) at Python/ceval.c:4645</span><br><span class="hljs-comment">#5  _PyEval_EvalFrameDefault (f=&lt;optimized out&gt;, throwflag=&lt;optimized out&gt;) at Python/ceval.c:3191</span><br><span class="hljs-comment">#6  0x0000000000420098 in function_code_fastcall (co=&lt;optimized out&gt;, args=&lt;optimized out&gt;, nargs=1, globals=&lt;optimized out&gt;) at Objects/call.c:283</span><br><span class="hljs-comment">#7  0x000000000043b316 in _PyFunction_FastCallKeywords (func=&lt;optimized out&gt;, stack=&lt;optimized out&gt;, nargs=&lt;optimized out&gt;, kwnames=&lt;optimized out&gt;) at Objects/call.c:415</span><br><span class="hljs-comment">#8  0x00000000004280e2 in call_function (kwnames=0x0, oparg=&lt;optimized out&gt;, pp_stack=&lt;synthetic pointer&gt;) at Python/ceval.c:4616</span><br><span class="hljs-comment">#9  _PyEval_EvalFrameDefault (f=&lt;optimized out&gt;, throwflag=&lt;optimized out&gt;) at Python/ceval.c:3110</span><br><span class="hljs-comment">#10 0x0000000000420098 in function_code_fastcall (co=&lt;optimized out&gt;, args=&lt;optimized out&gt;, nargs=1, globals=&lt;optimized out&gt;) at Objects/call.c:283</span><br><span class="hljs-comment">#11 0x000000000043b316 in _PyFunction_FastCallKeywords (func=&lt;optimized out&gt;, stack=&lt;optimized out&gt;, nargs=&lt;optimized out&gt;, kwnames=&lt;optimized out&gt;) at Objects/call.c:415</span><br><span class="hljs-comment">#12 0x00000000004280e2 in call_function (kwnames=0x0, oparg=&lt;optimized out&gt;, pp_stack=&lt;synthetic pointer&gt;) at Python/ceval.c:4616</span><br><span class="hljs-comment">#13 _PyEval_EvalFrameDefault (f=&lt;optimized out&gt;, throwflag=&lt;optimized out&gt;) at Python/ceval.c:3110</span><br><span class="hljs-comment">#14 0x0000000000420098 in function_code_fastcall (co=co@entry=0x7fc78e2541e0, args=&lt;optimized out&gt;, args@entry=0x7fc78e19fe20, nargs=nargs@entry=1, globals=globals@entry=0x7fc78e249640) at Objects/call.c:283</span><br><span class="hljs-comment">#15 0x000000000043b186 in _PyFunction_FastCallDict (func=func@entry=0x7fc78e1d1710, args=args@entry=0x7fc78e19fe20, nargs=nargs@entry=1, kwargs=kwargs@entry=0x0) at Objects/call.c:322</span><br><span class="hljs-comment">#16 0x000000000043e3e9 in _PyObject_FastCallDict (kwargs=0x0, nargs=1, args=0x7fc78e19fe20, callable=0x7fc78e1d1710) at Objects/call.c:98</span><br><span class="hljs-comment">#17 _PyObject_Call_Prepend (callable=0x7fc78e1d1710, obj=&lt;optimized out&gt;, args=0x7fc795ca6050, kwargs=0x0) at Objects/call.c:906</span><br><span class="hljs-comment">#18 0x000000000043c688 in PyObject_Call (callable=0x7fc795c9d320, args=&lt;optimized out&gt;, kwargs=&lt;optimized out&gt;) at Objects/call.c:245</span><br><span class="hljs-comment">#19 0x0000000000580bb3 in t_bootstrap (boot_raw=boot_raw@entry=0x7fc795b989c0) at ./Modules/_threadmodule.c:994</span><br><span class="hljs-comment">#20 0x0000000000537187 in pythread_wrapper (arg=&lt;optimized out&gt;) at Python/thread_pthread.h:174</span><br><span class="hljs-comment">#21 0x00007fc795689ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="hljs-comment">#22 0x00007fc794ca9b0d in clone () from /lib64/libc.so.6</span><br><span class="hljs-attr">Thread 2 (Thread 0x7fc78d99f700 (LWP 2609)):</span><br><span class="hljs-comment">#0  0x00007fc794ca0b43 in select () from /lib64/libc.so.6</span><br><span class="hljs-comment">#1  0x000000000057f742 in pysleep (secs=&lt;optimized out&gt;) at ./Modules/timemodule.c:1843</span><br><span class="hljs-comment">#2  time_sleep (self=self@entry=0x7fc78e2578f0, obj=&lt;optimized out&gt;) at ./Modules/timemodule.c:371</span><br><span class="hljs-comment">#3  0x000000000043be56 in _PyMethodDef_RawFastCallKeywords (kwnames=0x0, nargs=0, args=0x7fc78e1c0d98, self=0x7fc78e2578f0, method=0x8e51e0 &lt;time_methods+288&gt;) at Objects/call.c:647</span><br><span class="hljs-comment">#4  _PyCFunction_FastCallKeywords (func=0x7fc78e25b0f0, args=args@entry=0x7fc78e1c0d98, nargs=nargs@entry=1, kwnames=kwnames@entry=0x0) at Objects/call.c:732</span><br><span class="hljs-comment">#5  0x000000000042801d in call_function (kwnames=0x0, oparg=1, pp_stack=&lt;synthetic pointer&gt;) at Python/ceval.c:4568</span><br><span class="hljs-comment">#6  _PyEval_EvalFrameDefault (f=&lt;optimized out&gt;, throwflag=&lt;optimized out&gt;) at Python/ceval.c:3093</span><br><span class="hljs-comment">#7  0x0000000000420098 in function_code_fastcall (co=co@entry=0x7fc795c25390, args=&lt;optimized out&gt;, args@entry=0x7fc795ca6068, nargs=nargs@entry=0, globals=globals@entry=0x7fc795c5cc30) at Objects/call.c:283</span><br><span class="hljs-comment">#8  0x000000000043b186 in _PyFunction_FastCallDict (func=0x7fc78e233560, args=args@entry=0x7fc795ca6068, nargs=0, kwargs=kwargs@entry=0x7fc78e2564b0) at Objects/call.c:322</span><br><span class="hljs-comment">#9  0x000000000043c763 in PyObject_Call (callable=callable@entry=0x7fc78e233560, args=args@entry=0x7fc795ca6050, kwargs=kwargs@entry=0x7fc78e2564b0) at Objects/call.c:226</span><br><span class="hljs-comment">#10 0x0000000000422469 in do_call_core (kwdict=0x7fc78e2564b0, callargs=0x7fc795ca6050, func=0x7fc78e233560) at Python/ceval.c:4645</span><br><span class="hljs-comment">#11 _PyEval_EvalFrameDefault (f=&lt;optimized out&gt;, throwflag=&lt;optimized out&gt;) at Python/ceval.c:3191</span><br><span class="hljs-comment">#12 0x0000000000420098 in function_code_fastcall (co=&lt;optimized out&gt;, args=&lt;optimized out&gt;, nargs=1, globals=&lt;optimized out&gt;) at Objects/call.c:283</span><br><span class="hljs-comment">#13 0x000000000043b316 in _PyFunction_FastCallKeywords (func=&lt;optimized out&gt;, stack=&lt;optimized out&gt;, nargs=&lt;optimized out&gt;, kwnames=&lt;optimized out&gt;) at Objects/call.c:415</span><br><span class="hljs-comment">#14 0x00000000004280e2 in call_function (kwnames=0x0, oparg=&lt;optimized out&gt;, pp_stack=&lt;synthetic pointer&gt;) at Python/ceval.c:4616</span><br><span class="hljs-comment">#15 _PyEval_EvalFrameDefault (f=&lt;optimized out&gt;, throwflag=&lt;optimized out&gt;) at Python/ceval.c:3110</span><br><span class="hljs-comment">#16 0x0000000000420098 in function_code_fastcall (co=&lt;optimized out&gt;, args=&lt;optimized out&gt;, nargs=1, globals=&lt;optimized out&gt;) at Objects/call.c:283</span><br><span class="hljs-comment">#17 0x000000000043b316 in _PyFunction_FastCallKeywords (func=&lt;optimized out&gt;, stack=&lt;optimized out&gt;, nargs=&lt;optimized out&gt;, kwnames=&lt;optimized out&gt;) at Objects/call.c:415</span><br><span class="hljs-comment">#18 0x00000000004280e2 in call_function (kwnames=0x0, oparg=&lt;optimized out&gt;, pp_stack=&lt;synthetic pointer&gt;) at Python/ceval.c:4616</span><br><span class="hljs-comment">#19 _PyEval_EvalFrameDefault (f=&lt;optimized out&gt;, throwflag=&lt;optimized out&gt;) at Python/ceval.c:3110</span><br><span class="hljs-comment">#20 0x0000000000420098 in function_code_fastcall (co=co@entry=0x7fc78e2541e0, args=&lt;optimized out&gt;, args@entry=0x7fc78d99ee20, nargs=nargs@entry=1, globals=globals@entry=0x7fc78e249640) at Objects/call.c:283</span><br><span class="hljs-comment">#21 0x000000000043b186 in _PyFunction_FastCallDict (func=func@entry=0x7fc78e1d1710, args=args@entry=0x7fc78d99ee20, nargs=nargs@entry=1, kwargs=kwargs@entry=0x0) at Objects/call.c:322</span><br><span class="hljs-comment">#22 0x000000000043e3e9 in _PyObject_FastCallDict (kwargs=0x0, nargs=1, args=0x7fc78d99ee20, callable=0x7fc78e1d1710) at Objects/call.c:98</span><br><span class="hljs-comment">#23 _PyObject_Call_Prepend (callable=0x7fc78e1d1710, obj=&lt;optimized out&gt;, args=0x7fc795ca6050, kwargs=0x0) at Objects/call.c:906</span><br><span class="hljs-comment">#24 0x000000000043c688 in PyObject_Call (callable=0x7fc795bb83c0, args=&lt;optimized out&gt;, kwargs=&lt;optimized out&gt;) at Objects/call.c:245</span><br><span class="hljs-comment">#25 0x0000000000580bb3 in t_bootstrap (boot_raw=boot_raw@entry=0x7fc78e239ea0) at ./Modules/_threadmodule.c:994</span><br><span class="hljs-comment">#26 0x0000000000537187 in pythread_wrapper (arg=&lt;optimized out&gt;) at Python/thread_pthread.h:174</span><br><span class="hljs-comment">#27 0x00007fc795689ea5 in start_thread () from /lib64/libpthread.so.0</span><br><span class="hljs-comment">#28 0x00007fc794ca9b0d in clone () from /lib64/libc.so.6</span><br><span class="hljs-attr">Thread 1 (Thread 0x7fc795ce6740 (LWP 2607)):</span><br><span class="hljs-comment">#0  0x00007fc794ca0b43 in select () from /lib64/libc.so.6</span><br><span class="hljs-comment">#1  0x000000000057f742 in pysleep (secs=&lt;optimized out&gt;) at ./Modules/timemodule.c:1843</span><br><span class="hljs-comment">#2  time_sleep (self=self@entry=0x7fc78e2578f0, obj=&lt;optimized out&gt;) at ./Modules/timemodule.c:371</span><br><span class="hljs-comment">#3  0x000000000043be56 in _PyMethodDef_RawFastCallKeywords (kwnames=0x0, nargs=0, args=0x7fc795bf35c8, self=0x7fc78e2578f0, method=0x8e51e0 &lt;time_methods+288&gt;) at Objects/call.c:647</span><br><span class="hljs-comment">#4  _PyCFunction_FastCallKeywords (func=0x7fc78e25b0f0, args=args@entry=0x7fc795bf35c8, nargs=nargs@entry=1, kwnames=kwnames@entry=0x0) at Objects/call.c:732</span><br><span class="hljs-comment">#5  0x000000000042801d in call_function (kwnames=0x0, oparg=1, pp_stack=&lt;synthetic pointer&gt;) at Python/ceval.c:4568</span><br><span class="hljs-comment">#6  _PyEval_EvalFrameDefault (f=&lt;optimized out&gt;, throwflag=&lt;optimized out&gt;) at Python/ceval.c:3093</span><br><span class="hljs-comment">#7  0x00000000004ed8a7 in PyEval_EvalFrameEx (throwflag=0, f=0x7fc795bf3450) at Python/ceval.c:547</span><br><span class="hljs-comment">#8  _PyEval_EvalCodeWithName (_co=_co@entry=0x7fc795b71660, globals=globals@entry=0x7fc795c651b0, locals=locals@entry=0x7fc795b6ce10, args=args@entry=0x0, argcount=argcount@entry=0, kwnames=kwnames@entry=0x0, kwargs=kwargs@entry=0x0, kwcount=kwcount@entry=0, kwstep=kwstep@entry=2, defs=defs@entry=0x0, defcount=defcount@entry=0, kwdefs=kwdefs@entry=0x0, closure=closure@entry=0x0, name=name@entry=0x0, qualname=qualname@entry=0x0) at Python/ceval.c:3930</span><br><span class="hljs-comment">#9  0x00000000004ed9d0 in PyEval_EvalCodeEx (closure=0x0, kwdefs=0x0, defcount=0, defs=0x0, kwcount=0, kws=0x0, argcount=0, args=0x0, locals=locals@entry=0x7fc795b6ce10, globals=globals@entry=0x7fc795c651b0, _co=_co@entry=0x7fc795b71660) at Python/ceval.c:3959</span><br><span class="hljs-comment">#10 PyEval_EvalCode (co=co@entry=0x7fc795b71660, globals=globals@entry=0x7fc795c5cc30, locals=locals@entry=0x7fc795c5cc30) at Python/ceval.c:524</span><br><span class="hljs-comment">#11 0x0000000000528648 in run_mod (arena=0x7fc795c73770, flags=0x7ffc619def20, locals=0x7fc795c5cc30, globals=0x7fc795c5cc30, filename=0x7fc795b6ce10, mod=0x1cb9610) at Python/pythonrun.c:1035</span><br><span class="hljs-comment">#12 PyRun_FileExFlags (fp=0x1d04d10, filename_str=&lt;optimized out&gt;, start=&lt;optimized out&gt;, globals=0x7fc795c5cc30, locals=0x7fc795c5cc30, closeit=1, flags=0x7ffc619def20) at Python/pythonrun.c:988</span><br><span class="hljs-comment">#13 0x000000000052882d in PyRun_SimpleFileExFlags (fp=0x1d04d10, filename=&lt;optimized out&gt;, closeit=1, flags=0x7ffc619def20) at Python/pythonrun.c:429</span><br><span class="hljs-comment">#14 0x000000000042fe0d in pymain_run_file (p_cf=0x7ffc619def20, filename=0x1c7e460 L&quot;/root/vscode-work/daily_code/busy_thread.py&quot;, fp=0x1d04d10) at Modules/main.c:456</span><br><span class="hljs-comment">#15 pymain_run_filename (cf=0x7ffc619def20, pymain=0x7ffc619df000) at Modules/main.c:1646</span><br><span class="hljs-comment">#16 pymain_run_python (pymain=0x7ffc619df000) at Modules/main.c:2907</span><br><span class="hljs-comment">#17 pymain_main (pymain=pymain@entry=0x7ffc619df000) at Modules/main.c:3068</span><br><span class="hljs-comment">#18 0x00000000004300dd in _Py_UnixMain (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at Modules/main.c:3103</span><br><span class="hljs-comment">#19 0x00007fc794bcd555 in __libc_start_main () from /lib64/libc.so.6</span><br><span class="hljs-comment">#20 0x0000000000429de4 in _start ()</span><br></code></pre></td></tr></table></figure><h3 id="ï¼ˆ5ï¼‰åŠ è½½Pythonè°ƒè¯•è„šæœ¬ï¼Œå‹å¥½æŸ¥çœ‹Pythonå †æ ˆ"><a href="#ï¼ˆ5ï¼‰åŠ è½½Pythonè°ƒè¯•è„šæœ¬ï¼Œå‹å¥½æŸ¥çœ‹Pythonå †æ ˆ" class="headerlink" title="ï¼ˆ5ï¼‰åŠ è½½Pythonè°ƒè¯•è„šæœ¬ï¼Œå‹å¥½æŸ¥çœ‹Pythonå †æ ˆ"></a>ï¼ˆ5ï¼‰åŠ è½½Pythonè°ƒè¯•è„šæœ¬ï¼Œå‹å¥½æŸ¥çœ‹Pythonå †æ ˆ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">source /root/.pyenv/versions/3.7.10/lib/python3.7/python-gdb.py<br>py-bt<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½çœ‹åˆ°<strong>Pythonçº§åˆ«çš„è°ƒç”¨æ ˆäº†</strong>ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">(gdb)</span> <span class="hljs-string">source</span> <span class="hljs-string">/root/.pyenv/versions/3.7.10/lib/python3.7/python-gdb.py</span><br><span class="hljs-string">(gdb)</span> <span class="hljs-string">py-bt</span><br><span class="hljs-attr">Traceback (most recent call first):</span><br>  <span class="hljs-string">File</span> <span class="hljs-string">&quot;/root/vscode-work/daily_code/busy_thread.py&quot;</span><span class="hljs-string">,</span> <span class="hljs-string">line</span> <span class="hljs-number">18</span><span class="hljs-string">,</span> <span class="hljs-string">in</span> <span class="hljs-string">busy_thread</span><br>    <span class="hljs-string">pass</span>  <span class="hljs-comment"># æ­»å¾ªç¯ï¼Œå æ»¡CPU</span><br>  <span class="hljs-string">File</span> <span class="hljs-string">&quot;/root/.pyenv/versions/3.7.10/lib/python3.7/threading.py&quot;</span><span class="hljs-string">,</span> <span class="hljs-string">line</span> <span class="hljs-number">870</span><span class="hljs-string">,</span> <span class="hljs-string">in</span> <span class="hljs-string">run</span><br>    <span class="hljs-string">self._target(*self._args,</span> <span class="hljs-string">**self._kwargs)</span><br>  <span class="hljs-string">File</span> <span class="hljs-string">&quot;/root/.pyenv/versions/3.7.10/lib/python3.7/threading.py&quot;</span><span class="hljs-string">,</span> <span class="hljs-string">line</span> <span class="hljs-number">926</span><span class="hljs-string">,</span> <span class="hljs-string">in</span> <span class="hljs-string">_bootstrap_inner</span><br>    <span class="hljs-string">self.run()</span><br>  <span class="hljs-string">File</span> <span class="hljs-string">&quot;/root/.pyenv/versions/3.7.10/lib/python3.7/threading.py&quot;</span><span class="hljs-string">,</span> <span class="hljs-string">line</span> <span class="hljs-number">890</span><span class="hljs-string">,</span> <span class="hljs-string">in</span> <span class="hljs-string">_bootstrap</span><br>    <span class="hljs-string">self._bootstrap_inner()</span><br><span class="hljs-string">(gdb)</span><br></code></pre></td></tr></table></figure><h2 id="3-æœ¬æ¬¡æœ€ç»ˆç»“æœ"><a href="#3-æœ¬æ¬¡æœ€ç»ˆç»“æœ" class="headerlink" title="3. æœ¬æ¬¡æœ€ç»ˆç»“æœ"></a>3. æœ¬æ¬¡æœ€ç»ˆç»“æœ</h2><ul><li><p>æœ€åé€šè¿‡ <code>py-bt</code> æˆåŠŸå®šä½åˆ°äº†ä»£ç ä½ç½®ï¼š</p></li><li><ul><li><code>/root/vscode-work/daily_code/busy_thread.py</code> <strong>ç¬¬18è¡Œ</strong> </li><li>å¤„äº <code>busy_thread()</code> å‡½æ•°ä¸­</li><li>æ­£åœ¨æ‰§è¡Œ <code>pass</code> æ­»å¾ªç¯ï¼Œå æ»¡CPU</li></ul></li></ul><hr><h2 id="4-ç»éªŒæ€»ç»“"><a href="#4-ç»éªŒæ€»ç»“" class="headerlink" title="4. ç»éªŒæ€»ç»“"></a>4. ç»éªŒæ€»ç»“</h2><table><thead><tr><th>é¡¹ç›®</th><th>ç»éªŒ</th></tr></thead><tbody><tr><td>é—®é¢˜å½’å› </td><td>é«˜CPUå ç”¨é—®é¢˜ï¼Œå¸¸ç”±æ­»å¾ªç¯ã€é¢‘ç¹IOã€ç«äº‰é”ç­‰å¼•èµ·</td></tr><tr><td>å·¥å…·é“¾æŒæ¡</td><td>ç†Ÿç»ƒä½¿ç”¨ <code>top -H</code>ã€<code>ps -mp</code>ã€<code>gdb -p</code>ã€<code>py-bt</code></td></tr><tr><td>æ³¨æ„äº‹é¡¹</td><td>è®°å¾—TIDéœ€è¦è½¬16è¿›åˆ¶ï¼›Pythonè¦æœ‰å¯¹åº”çš„<code>python-gdb.py</code>è„šæœ¬</td></tr><tr><td>å°æŠ€å·§</td><td><code>py-bt</code>èƒ½ç›´æ¥å®šä½åˆ°Pythonä»£ç å±‚ï¼Œæ¯”Cå±‚btå‹å¥½å¤šäº†</td></tr></tbody></table><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>æˆ‘è‡ªå·±ç”¨pyenvå®‰è£…çš„python3.7æ²¡å¸¦ python-gdb.py  </p><p> æ­£å¸¸æ¥è¯´ï¼Œ<code>python-gdb.py</code> æ˜¯ Python æºç å®‰è£…ååœ¨ <code>lib-dynload/</code> æ—è¾¹çš„ï¼Œåƒ <code>/usr/lib/debug/...</code> æˆ– <code>/usr/lib/python3.x/</code> ç›®å½•ä¸­ã€‚<br>ä½†æ˜¯å¦‚æœä½ ç”¨ pyenv è£¸å®‰è£…ï¼Œé»˜è®¤æ˜¯ä¸ä¼šå¸¦è¿™ä¸ªè°ƒè¯•è„šæœ¬çš„ï¼ˆé™¤éä½ è‡ªå·±åŠ äº†å‚æ•° <code>--with-pydebug</code> ç¼–è¯‘ï¼‰ã€‚  </p><p>è§£å†³æ–¹æ³•æ˜¯ï¼š</p><p> æ‰‹åŠ¨ä¸‹è½½ä¸€ä»½ python-gdb.py è„šæœ¬è¿‡æ¥ç”¨ã€‚  </p><p> Python 3.7.10 å¯¹åº”çš„ <code>python-gdb.py</code> å®˜æ–¹åœ°å€åœ¨ GitHubæºç é‡Œï¼š<br>ğŸ‘‰ <a href="https://github.com/python/cpython/blob/3.7/Tools/gdb/libpython.py">https://github.com/python/cpython/blob/3.7/Tools/gdb/libpython.py</a></p><p> æ­¥éª¤ï¼š  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /root/.pyenv/versions/3.7.10/lib/python3.7/<br>wget https://raw.githubusercontent.com/python/cpython/3.7/Tools/gdb/libpython.py -O python-gdb.py<br></code></pre></td></tr></table></figure><p> ç„¶ååœ¨ gdb é‡Œæ‰§è¡Œï¼š  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">(gdb) <span class="hljs-built_in">source</span> /root/.pyenv/versions/3.7.10/lib/python3.7/python-gdb.py<br>(gdb) py-bt<br></code></pre></td></tr></table></figure><p> å°±å¯ä»¥æ‹¿åˆ° Python ä»£ç çº§çš„è°ƒç”¨æ ˆäº†ï¼ï¼  </p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django ä¿¡å·çš„ä½¿ç”¨</title>
    <link href="/2024/07/09/Django-%E4%BF%A1%E5%8F%B7%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/07/09/Django-%E4%BF%A1%E5%8F%B7%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>Django æä¾›äº†å‡ ä¸ªå†…ç½®çš„ä¿¡å·ï¼Œå…è®¸åœ¨ä¸åŒäº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œç‰¹å®šçš„ä»£ç ã€‚è¿™äº›ä¿¡å·ä¸»è¦ç”¨äºæ¨¡å‹ã€è¯·æ±‚&#x2F;å“åº”å¤„ç†ä»¥åŠæ•°æ®åº“æ“ä½œã€‚ä»¥ä¸‹æ˜¯Djangoä¸­å¸¸ç”¨çš„ä¿¡å·åˆ†ç±»å’Œå…·ä½“ä¿¡å·ï¼š</p><h3 id="1-æ¨¡å‹ä¿¡å·"><a href="#1-æ¨¡å‹ä¿¡å·" class="headerlink" title="1. æ¨¡å‹ä¿¡å·"></a>1. æ¨¡å‹ä¿¡å·</h3><p>è¿™äº›ä¿¡å·ä¸Djangoæ¨¡å‹ç›¸å…³è”ï¼Œç”¨äºåœ¨æ¨¡å‹çš„åˆ›å»ºã€ä¿å­˜ã€åˆ é™¤ç­‰æ“ä½œæ—¶è§¦å‘ã€‚</p><ul><li><code>pre_save</code>ï¼šåœ¨æ¨¡å‹çš„<code>save</code>æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰å‘é€ã€‚</li><li><code>post_save</code>ï¼šåœ¨æ¨¡å‹çš„<code>save</code>æ–¹æ³•è¢«è°ƒç”¨ä¹‹åå‘é€ã€‚</li><li><code>pre_delete</code>ï¼šåœ¨æ¨¡å‹çš„<code>delete</code>æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰å‘é€ã€‚</li><li><code>post_delete</code>ï¼šåœ¨æ¨¡å‹çš„<code>delete</code>æ–¹æ³•è¢«è°ƒç”¨ä¹‹åå‘é€ã€‚</li><li><code>m2m_changed</code>ï¼šåœ¨å¤šå¯¹å¤šå…³ç³»çš„<code>add</code>ã€<code>remove</code>ã€<code>clear</code>æ“ä½œæ—¶å‘é€ã€‚</li><li><code>class_prepared</code>ï¼šåœ¨æ¨¡å‹ç±»è¢«åˆ›å»ºä¹‹åå‘é€ã€‚</li></ul><h3 id="2-è¯·æ±‚-å“åº”ä¿¡å·"><a href="#2-è¯·æ±‚-å“åº”ä¿¡å·" class="headerlink" title="2. è¯·æ±‚&#x2F;å“åº”ä¿¡å·"></a>2. è¯·æ±‚&#x2F;å“åº”ä¿¡å·</h3><p>è¿™äº›ä¿¡å·ä¸Djangoçš„è¯·æ±‚å’Œå“åº”å‘¨æœŸç›¸å…³è”ï¼Œç”¨äºåœ¨å¤„ç†HTTPè¯·æ±‚æ—¶è§¦å‘ã€‚</p><ul><li><code>request_started</code>ï¼šåœ¨Djangoå¼€å§‹å¤„ç†è¯·æ±‚æ—¶å‘é€ã€‚</li><li><code>request_finished</code>ï¼šåœ¨Djangoå®Œæˆè¯·æ±‚å¤„ç†æ—¶å‘é€ã€‚</li><li><code>got_request_exception</code>ï¼šåœ¨è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æ—¶å‘é€ã€‚</li></ul><h3 id="3-æ•°æ®åº“ä¿¡å·"><a href="#3-æ•°æ®åº“ä¿¡å·" class="headerlink" title="3. æ•°æ®åº“ä¿¡å·"></a>3. æ•°æ®åº“ä¿¡å·</h3><p>è¿™äº›ä¿¡å·ä¸Djangoçš„æ•°æ®åº“æ“ä½œç›¸å…³è”ï¼Œç”¨äºåœ¨æ•°æ®åº“è¿æ¥æˆ–å…³é—­æ—¶è§¦å‘ã€‚</p><ul><li><code>connection_created</code>ï¼šåœ¨æ•°æ®åº“è¿æ¥è¢«åˆ›å»ºæ—¶å‘é€ã€‚</li></ul><h3 id="4-è‡ªå®šä¹‰ä¿¡å·"><a href="#4-è‡ªå®šä¹‰ä¿¡å·" class="headerlink" title="4. è‡ªå®šä¹‰ä¿¡å·"></a>4. è‡ªå®šä¹‰ä¿¡å·</h3><p>é™¤äº†å†…ç½®ä¿¡å·ï¼ŒDjangoè¿˜å…è®¸ä½ å®šä¹‰è‡ªå·±çš„ä¿¡å·ï¼Œç”¨äºåœ¨ç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘ä¸­è§¦å‘ã€‚è‡ªå®šä¹‰ä¿¡å·é€šå¸¸ç”¨äºæ¨¡å—ä¹‹é—´çš„è§£è€¦å’Œè·¨æ¨¡å—é€šä¿¡ã€‚</p><h3 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨æ¨¡å‹ä¿¡å·å’Œè‡ªå®šä¹‰ä¿¡å·çš„ç¤ºä¾‹ä»£ç ï¼š</p><h4 id="æ¨¡å‹ä¿¡å·ç¤ºä¾‹"><a href="#æ¨¡å‹ä¿¡å·ç¤ºä¾‹" class="headerlink" title="æ¨¡å‹ä¿¡å·ç¤ºä¾‹"></a>æ¨¡å‹ä¿¡å·ç¤ºä¾‹</h4><p>åœ¨æ¨¡å‹ä¿å­˜åå‘é€é€šçŸ¥é‚®ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># models.py</span><br><br><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Article</span>(models.Model):<br>    title = models.CharField(max_length=<span class="hljs-number">100</span>)<br>    content = models.TextField()<br>    published_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.title<br><span class="hljs-comment"># signals.py</span><br><br><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> post_save<br><span class="hljs-keyword">from</span> django.dispatch <span class="hljs-keyword">import</span> receiver<br><span class="hljs-keyword">from</span> django.core.mail <span class="hljs-keyword">import</span> send_mail<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article<br><br><span class="hljs-meta">@receiver(<span class="hljs-params">post_save, sender=Article</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_notification_email</span>(<span class="hljs-params">sender, instance, created, **kwargs</span>):<br>    <span class="hljs-keyword">if</span> created:<br>        subject = <span class="hljs-string">f&#x27;New Article Published: <span class="hljs-subst">&#123;instance.title&#125;</span>&#x27;</span><br>        message = <span class="hljs-string">f&#x27;A new article has been published.\n\nTitle: <span class="hljs-subst">&#123;instance.title&#125;</span>\n\nContent: <span class="hljs-subst">&#123;instance.content&#125;</span>&#x27;</span><br>        from_email = <span class="hljs-string">&#x27;no-reply@example.com&#x27;</span><br>        recipient_list = [<span class="hljs-string">&#x27;admin@example.com&#x27;</span>]<br>        send_mail(subject, message, from_email, recipient_list)<br></code></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰ä¿¡å·ç¤ºä¾‹"><a href="#è‡ªå®šä¹‰ä¿¡å·ç¤ºä¾‹" class="headerlink" title="è‡ªå®šä¹‰ä¿¡å·ç¤ºä¾‹"></a>è‡ªå®šä¹‰ä¿¡å·ç¤ºä¾‹</h4><p>å®šä¹‰å¹¶ä½¿ç”¨è‡ªå®šä¹‰ä¿¡å·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># signals.py</span><br><br><span class="hljs-keyword">from</span> django.dispatch <span class="hljs-keyword">import</span> Signal, receiver<br><br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰ä¿¡å·</span><br>my_custom_signal = Signal(providing_args=[<span class="hljs-string">&quot;arg1&quot;</span>, <span class="hljs-string">&quot;arg2&quot;</span>])<br><br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªä¿¡å·å¤„ç†å™¨</span><br><span class="hljs-meta">@receiver(<span class="hljs-params">my_custom_signal</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_custom_signal_handler</span>(<span class="hljs-params">sender, **kwargs</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Custom signal received with arg1: <span class="hljs-subst">&#123;kwargs[<span class="hljs-string">&#x27;arg1&#x27;</span>]&#125;</span> and arg2: <span class="hljs-subst">&#123;kwargs[<span class="hljs-string">&#x27;arg2&#x27;</span>]&#125;</span>&quot;</span>)<br><span class="hljs-comment"># åœ¨å…¶ä»–åœ°æ–¹è§¦å‘è‡ªå®šä¹‰ä¿¡å·</span><br><span class="hljs-keyword">from</span> .signals <span class="hljs-keyword">import</span> my_custom_signal<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">some_function</span>():<br>    my_custom_signal.send(sender=some_function, arg1=<span class="hljs-string">&quot;value1&quot;</span>, arg2=<span class="hljs-string">&quot;value2&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="è¿æ¥ä¿¡å·çš„æ–¹å¼"><a href="#è¿æ¥ä¿¡å·çš„æ–¹å¼" class="headerlink" title="è¿æ¥ä¿¡å·çš„æ–¹å¼"></a>è¿æ¥ä¿¡å·çš„æ–¹å¼</h3><p>ä¿¡å·å¯ä»¥é€šè¿‡è£…é¥°å™¨æˆ–æ‰‹åŠ¨è¿æ¥ï¼š</p><h4 id="ä½¿ç”¨è£…é¥°å™¨è¿æ¥"><a href="#ä½¿ç”¨è£…é¥°å™¨è¿æ¥" class="headerlink" title="ä½¿ç”¨è£…é¥°å™¨è¿æ¥"></a>ä½¿ç”¨è£…é¥°å™¨è¿æ¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> post_save<br><span class="hljs-keyword">from</span> django.dispatch <span class="hljs-keyword">import</span> receiver<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article<br><br><span class="hljs-meta">@receiver(<span class="hljs-params">post_save, sender=Article</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_notification_email</span>(<span class="hljs-params">sender, instance, created, **kwargs</span>):<br>    <span class="hljs-comment"># ä¿¡å·å¤„ç†ä»£ç </span><br></code></pre></td></tr></table></figure><h4 id="æ‰‹åŠ¨è¿æ¥"><a href="#æ‰‹åŠ¨è¿æ¥" class="headerlink" title="æ‰‹åŠ¨è¿æ¥"></a>æ‰‹åŠ¨è¿æ¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> post_save<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article<br><span class="hljs-keyword">from</span> .signals <span class="hljs-keyword">import</span> send_notification_email<br><br>post_save.connect(send_notification_email, sender=Article)<br></code></pre></td></tr></table></figure><p>é€šè¿‡è¿™äº›ä¿¡å·æœºåˆ¶ï¼ŒDjangoåº”ç”¨å¯ä»¥åœ¨ä¸åŒçš„äº‹ä»¶å‘ç”Ÿæ—¶çµæ´»åœ°æ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œå¢å¼ºäº†åº”ç”¨çš„å¯æ‰©å±•æ€§å’Œæ¨¡å—åŒ–ã€‚</p><h3 id="ä¸´æ—¶å–æ¶ˆä¿¡å·"><a href="#ä¸´æ—¶å–æ¶ˆä¿¡å·" class="headerlink" title="ä¸´æ—¶å–æ¶ˆä¿¡å·"></a>ä¸´æ—¶å–æ¶ˆä¿¡å·</h3><p>åœ¨Djangoä¸­ï¼Œä¸´æ—¶å–æ¶ˆä¿¡å·å¤„ç†å™¨æœ‰å‡ ç§æ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸ç”¨çš„æ–¹æ³•ï¼š</p><h3 id="1-æ‰‹åŠ¨æ–­å¼€ä¿¡å·"><a href="#1-æ‰‹åŠ¨æ–­å¼€ä¿¡å·" class="headerlink" title="1. æ‰‹åŠ¨æ–­å¼€ä¿¡å·"></a>1. æ‰‹åŠ¨æ–­å¼€ä¿¡å·</h3><p>ä½ å¯ä»¥æ‰‹åŠ¨æ–­å¼€ä¿¡å·å¤„ç†å™¨ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™é‡æ–°è¿æ¥ã€‚è¿™éœ€è¦ä½ ä¿å­˜ä¿¡å·å¤„ç†å™¨çš„å¼•ç”¨ï¼Œä»¥ä¾¿ç¨åé‡æ–°è¿æ¥ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -1"><a href="#ç¤ºä¾‹ä»£ç -1" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä¿¡å·å¤„ç†å™¨<code>send_notification_email</code>è¿æ¥åˆ°<code>post_save</code>ä¿¡å·ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># signals.py</span><br><br><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> post_save<br><span class="hljs-keyword">from</span> django.dispatch <span class="hljs-keyword">import</span> receiver<br><span class="hljs-keyword">from</span> django.core.mail <span class="hljs-keyword">import</span> send_mail<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article<br><br><span class="hljs-meta">@receiver(<span class="hljs-params">post_save, sender=Article</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_notification_email</span>(<span class="hljs-params">sender, instance, created, **kwargs</span>):<br>    <span class="hljs-keyword">if</span> created:<br>        subject = <span class="hljs-string">f&#x27;New Article Published: <span class="hljs-subst">&#123;instance.title&#125;</span>&#x27;</span><br>        message = <span class="hljs-string">f&#x27;A new article has been published.\n\nTitle: <span class="hljs-subst">&#123;instance.title&#125;</span>\n\nContent: <span class="hljs-subst">&#123;instance.content&#125;</span>&#x27;</span><br>        from_email = <span class="hljs-string">&#x27;no-reply@example.com&#x27;</span><br>        recipient_list = [<span class="hljs-string">&#x27;admin@example.com&#x27;</span>]<br>        send_mail(subject, message, from_email, recipient_list)<br></code></pre></td></tr></table></figure><p>æ–­å¼€å’Œé‡æ–°è¿æ¥ä¿¡å·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åœ¨éœ€è¦çš„åœ°æ–¹</span><br><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> post_save<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article<br><span class="hljs-keyword">from</span> .signals <span class="hljs-keyword">import</span> send_notification_email<br><br><span class="hljs-comment"># æ–­å¼€ä¿¡å·</span><br>post_save.disconnect(send_notification_email, sender=Article)<br><br><span class="hljs-comment"># ...æ‰§è¡Œä¸€äº›æ“ä½œ</span><br><br><span class="hljs-comment"># é‡æ–°è¿æ¥ä¿¡å·</span><br>post_save.connect(send_notification_email, sender=Article)<br></code></pre></td></tr></table></figure><h3 id="2-ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨"><a href="#2-ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨" class="headerlink" title="2. ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨"></a>2. ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨</h3><p>ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨æ¥ä¸´æ—¶æ–­å¼€ä¿¡å·å¤„ç†å™¨ã€‚åœ¨æ‰§è¡Œç‰¹å®šæ“ä½œæ—¶ï¼Œä¿¡å·å¤„ç†å™¨ä¼šè¢«æ–­å¼€ï¼Œæ“ä½œå®Œæˆåä¿¡å·å¤„ç†å™¨ä¼šé‡æ–°è¿æ¥ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -2"><a href="#ç¤ºä¾‹ä»£ç -2" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># utils.py</span><br><br><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> Signal<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SignalDisconnect</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, signal, receiver, sender=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-variable language_">self</span>.signal = signal<br>        <span class="hljs-variable language_">self</span>.receiver = receiver<br>        <span class="hljs-variable language_">self</span>.sender = sender<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.signal.disconnect(<span class="hljs-variable language_">self</span>.receiver, sender=<span class="hljs-variable language_">self</span>.sender)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, exc_type, exc_val, exc_tb</span>):<br>        <span class="hljs-variable language_">self</span>.signal.connect(<span class="hljs-variable language_">self</span>.receiver, sender=<span class="hljs-variable language_">self</span>.sender)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸´æ—¶æ–­å¼€ä¿¡å·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åœ¨éœ€è¦çš„åœ°æ–¹</span><br><span class="hljs-keyword">from</span> .utils <span class="hljs-keyword">import</span> SignalDisconnect<br><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> post_save<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article<br><span class="hljs-keyword">from</span> .signals <span class="hljs-keyword">import</span> send_notification_email<br><br><span class="hljs-comment"># ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸´æ—¶æ–­å¼€ä¿¡å·</span><br><span class="hljs-keyword">with</span> SignalDisconnect(post_save, send_notification_email, sender=Article):<br>    <span class="hljs-comment"># åœ¨è¿™é‡Œæ‰§è¡Œä¸æƒ³è§¦å‘ä¿¡å·å¤„ç†å™¨çš„æ“ä½œ</span><br>    Article.objects.create(title=<span class="hljs-string">&quot;Temporary Article&quot;</span>, content=<span class="hljs-string">&quot;This will not send an email&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="3-ä½¿ç”¨æ ‡å¿—ä½"><a href="#3-ä½¿ç”¨æ ‡å¿—ä½" class="headerlink" title="3. ä½¿ç”¨æ ‡å¿—ä½"></a>3. ä½¿ç”¨æ ‡å¿—ä½</h3><p>ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå…¨å±€æ ‡å¿—ä½æ¥æ§åˆ¶æ˜¯å¦æ‰§è¡Œä¿¡å·å¤„ç†å™¨ä¸­çš„é€»è¾‘ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -3"><a href="#ç¤ºä¾‹ä»£ç -3" class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># signals.py</span><br><br><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> post_save<br><span class="hljs-keyword">from</span> django.dispatch <span class="hljs-keyword">import</span> receiver<br><span class="hljs-keyword">from</span> django.core.mail <span class="hljs-keyword">import</span> send_mail<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article<br><br><span class="hljs-comment"># å…¨å±€æ ‡å¿—ä½</span><br>ENABLE_EMAIL_NOTIFICATIONS = <span class="hljs-literal">True</span><br><br><span class="hljs-meta">@receiver(<span class="hljs-params">post_save, sender=Article</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_notification_email</span>(<span class="hljs-params">sender, instance, created, **kwargs</span>):<br>    <span class="hljs-keyword">if</span> created <span class="hljs-keyword">and</span> ENABLE_EMAIL_NOTIFICATIONS:<br>        subject = <span class="hljs-string">f&#x27;New Article Published: <span class="hljs-subst">&#123;instance.title&#125;</span>&#x27;</span><br>        message = <span class="hljs-string">f&#x27;A new article has been published.\n\nTitle: <span class="hljs-subst">&#123;instance.title&#125;</span>\n\nContent: <span class="hljs-subst">&#123;instance.content&#125;</span>&#x27;</span><br>        from_email = <span class="hljs-string">&#x27;no-reply@example.com&#x27;</span><br>        recipient_list = [<span class="hljs-string">&#x27;admin@example.com&#x27;</span>]<br>        send_mail(subject, message, from_email, recipient_list)<br></code></pre></td></tr></table></figure><p>æ§åˆ¶æ ‡å¿—ä½ä»¥ä¸´æ—¶ç¦ç”¨ä¿¡å·å¤„ç†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åœ¨éœ€è¦çš„åœ°æ–¹</span><br><span class="hljs-keyword">from</span> .signals <span class="hljs-keyword">import</span> ENABLE_EMAIL_NOTIFICATIONS<br><br><span class="hljs-comment"># ç¦ç”¨ä¿¡å·å¤„ç†å™¨</span><br>ENABLE_EMAIL_NOTIFICATIONS = <span class="hljs-literal">False</span><br><br><span class="hljs-comment"># ...æ‰§è¡Œä¸€äº›æ“ä½œ</span><br><br><span class="hljs-comment"># å¯ç”¨ä¿¡å·å¤„ç†å™¨</span><br>ENABLE_EMAIL_NOTIFICATIONS = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œä½ å¯ä»¥çµæ´»åœ°æ§åˆ¶Djangoä¸­çš„ä¿¡å·å¤„ç†å™¨ï¼Œç¡®ä¿åœ¨éœ€è¦æ—¶èƒ½å¤Ÿä¸´æ—¶å–æ¶ˆä¿¡å·å¤„ç†ï¼Œè€Œä¸å½±å“å…¶ä»–éƒ¨åˆ†çš„åŠŸèƒ½ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ssh å…å¯†ç™»å½•é…ç½®</title>
    <link href="/2023/12/28/ssh-%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95%E9%85%8D%E7%BD%AE/"/>
    <url>/2023/12/28/ssh-%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> ~/.ssh/id_rsa.pub<br></code></pre></td></tr></table></figure><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim ~/.ssh/authorized_keys<br>systemctl restart sshd<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LinuxæŠŠä¸€ä¸ªå‰å°è¿è¡Œçš„è¿›ç¨‹æ”¾åœ¨åå°æ‰§è¡Œ</title>
    <link href="/2023/09/07/Linux%E6%8A%8A%E4%B8%80%E4%B8%AA%E5%89%8D%E5%8F%B0%E8%BF%90%E8%A1%8C%E7%9A%84%E8%BF%9B%E7%A8%8B%E6%94%BE%E5%9C%A8%E5%90%8E%E5%8F%B0%E6%89%A7%E8%A1%8C/"/>
    <url>/2023/09/07/Linux%E6%8A%8A%E4%B8%80%E4%B8%AA%E5%89%8D%E5%8F%B0%E8%BF%90%E8%A1%8C%E7%9A%84%E8%BF%9B%E7%A8%8B%E6%94%BE%E5%9C%A8%E5%90%8E%E5%8F%B0%E6%89%A7%E8%A1%8C/</url>
    
    <content type="html"><![CDATA[<ol><li>å¯¹äºæ­£å¸¸æ‰§è¡Œçš„å‰å°ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨ctrl + zï¼Œè®©ç¨‹åºåœæ­¢ï¼Œç„¶åé€šè¿‡bg %job_id æŠŠç¨‹åºæ”¾å…¥åå°è¿è¡Œ</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@luffy study]# bash sleep500S.sh <br>^Z<br>[1]+  å·²åœæ­¢               bash sleep500S.sh<br>[root@luffy study]# <span class="hljs-built_in">jobs</span><br>[1]+  å·²åœæ­¢               bash sleep500S.sh<br>[root@luffy study]# <span class="hljs-built_in">jobs</span>; <span class="hljs-built_in">bg</span> %1 ; <span class="hljs-built_in">jobs</span><br>[1]+  å·²åœæ­¢               bash sleep500S.sh<br>[1]+ bash sleep500S.sh &amp;<br>[1]+  è¿è¡Œä¸­               bash sleep500S.sh &amp;<br>[root@luffy study]# ps aux | grep <span class="hljs-built_in">sleep</span><br>root     15527  0.0  0.0 113280  1204 pts/5    S    18:10   0:00 bash sleep500S.sh<br>root     15528  0.0  0.0 108052   360 pts/5    S    18:10   0:00 <span class="hljs-built_in">sleep</span> 500s<br>root     15826  0.0  0.0 112824   984 pts/5    S+   18:11   0:00 grep --color=auto <span class="hljs-built_in">sleep</span><br></code></pre></td></tr></table></figure><ol><li>ä½¿ç”¨nohup ç¨‹åºæ‰§è¡Œå‘½ä»¤ &amp;ï¼Œç›´æ¥è®©ç¨‹åºåå°æ‰§è¡Œ</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@luffy study]# <span class="hljs-built_in">nohup</span> bash sleep500S.sh &amp;<br>[2] 16007<br>[root@luffy study]# <span class="hljs-built_in">nohup</span>: å¿½ç•¥è¾“å…¥å¹¶æŠŠè¾“å‡ºè¿½åŠ åˆ°<span class="hljs-string">&quot;nohup.out&quot;</span><br><br>[root@luffy study]# <span class="hljs-built_in">jobs</span><br>[1]-  è¿è¡Œä¸­               bash sleep500S.sh &amp;<br>[2]+  è¿è¡Œä¸­               <span class="hljs-built_in">nohup</span> bash sleep500S.sh &amp;<br></code></pre></td></tr></table></figure><ol><li>ä½¿ç”¨fg è®©ç¨‹åºé‡æ–°å›åˆ°å‰å°æ‰§è¡Œã€‚æ¯”å¦‚vi ç¼–è¾‘æ–‡ä»¶çš„æ—¶å€™ï¼Œæƒ³é€€å‡ºäº†æŸ¥ä¸ªä¸œè¥¿ï¼Œç„¶åå†è¿›å…¥ç¼–è¾‘ã€‚å°±å¯ä»¥åœ¨ç¼–è¾‘çš„æ—¶å€™ ctrl + zï¼Œç„¶åäº‹æƒ…åŠå®Œåï¼Œå†é€šè¿‡fg %job_idè¿›å»</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@luffy study]# vi a<br><br>[3]+  å·²åœæ­¢               vi a<br>[root@luffy study]# <span class="hljs-built_in">jobs</span><br>[1]+  å·²åœæ­¢               bash sleep500S.sh<br>[2]   è¿è¡Œä¸­               <span class="hljs-built_in">nohup</span> bash sleep500S.sh &amp;<br>[3]-  å·²åœæ­¢               vi a<br>[root@luffy study]# <span class="hljs-built_in">fg</span> %3<br>vi a<br><span class="hljs-comment"># åˆè¿›å…¥vi é‡æ–°ç¼–è¾‘æ–‡ä»¶äº†</span><br>[root@luffy study]# <br></code></pre></td></tr></table></figure><ol><li>å¯¹äºéƒ¨åˆ†jobä¸èƒ½åœæ‰çš„ï¼Œå¯ä»¥ä½¿ç”¨kill å‘½ä»¤ï¼Œæ ¼å¼ï¼škill -signal %jobnumber</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@study ~]# <span class="hljs-built_in">kill</span> -signal %jobnumber<br>[root@study ~]# <span class="hljs-built_in">kill</span> -l<br>é€‰é¡¹ä¸å‚æ•°ï¼š<br>-l ï¼šè¿™ä¸ªæ˜¯ L çš„å°å†™ï¼Œåˆ—å‡ºç›®å‰ <span class="hljs-built_in">kill</span> èƒ½å¤Ÿä½¿ç”¨çš„è®¯å· (signal) æœ‰å“ªäº›ï¼Ÿ<br>signal ï¼šä»£è¡¨ç»™äºˆåé¢æ¥çš„é‚£ä¸ªå·¥ä½œä»€ä¹ˆæ ·çš„æŒ‡ç¤ºå•°ï¼ç”¨ man 7 signal å¯çŸ¥ï¼š<br> -1 ï¼šé‡æ–°è¯»å–ä¸€æ¬¡å‚æ•°çš„é…ç½®æ–‡ä»¶ (ç±»ä¼¼ reload)ï¼›<br> -2 ï¼šä»£è¡¨ä¸ç”±é”®ç›˜è¾“å…¥ [ctrl]-c åŒæ ·çš„åŠ¨ä½œï¼›<br> -9 ï¼šç«‹åˆ»å¼ºåˆ¶åˆ é™¤ä¸€ä¸ªå·¥ä½œï¼›<br> -15ï¼šä»¥æ­£å¸¸çš„è¿›ç¨‹æ–¹å¼ç»ˆæ­¢ä¸€é¡¹å·¥ä½œã€‚ä¸ -9 æ˜¯ä¸ä¸€æ ·çš„ã€‚<br> <br>root@luffy study]# <span class="hljs-built_in">jobs</span><br>[1]+  å·²åœæ­¢               bash sleep500S.sh<br>[root@luffy study]# <span class="hljs-built_in">kill</span> -15 %1<br><br>[1]+  å·²åœæ­¢               bash sleep500S.sh<br>[root@luffy study]# <span class="hljs-built_in">jobs</span><br>[1]+  å·²ç»ˆæ­¢               bash sleep500S.sh<br>[root@luffy study]# <span class="hljs-built_in">jobs</span><br>[root@luffy study]# <br></code></pre></td></tr></table></figure><p>å½“ç„¶ä½¿ç”¨kill -9 ä¹Ÿè¡Œï¼Œè¿™ç§æ¯”è¾ƒæš´åŠ›ï¼Œ-9 è¿™ä¸ª signal é€šå¸¸æ˜¯ç”¨åœ¨ã€å¼ºåˆ¶åˆ é™¤ä¸€ä¸ªä¸æ­£å¸¸çš„å·¥ä½œã€æ—¶æ‰€ä½¿ç”¨çš„ï¼Œ -15 åˆ™æ˜¯ ä»¥æ­£å¸¸æ­¥éª¤ç»“æŸä¸€é¡¹å·¥ä½œ(15 ä¹Ÿæ˜¯é»˜è®¤å€¼)ï¼Œä¸¤è€…ä¹‹é—´å¹¶ä¸ç›¸åŒå‘¦ï¼ä¸¾ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œ æˆ‘ç”¨ vim çš„ æ—¶å€™ï¼Œä¸æ˜¯ä¼šäº§ç”Ÿä¸€ä¸ª .filename.swp çš„æ–‡ä»¶å—ï¼Ÿ é‚£ä¹ˆï¼Œå½“ä½¿ç”¨ -15 è¿™ä¸ª signal æ—¶ï¼Œ vim ä¼šå°è¯• ä»¥æ­£å¸¸çš„æ­¥éª¤æ¥ç»“æŸæ‰è¯¥ vi çš„å·¥ä½œï¼Œ æ‰€ä»¥ .filename.swp ä¼šä¸»åŠ¨çš„è¢«ç§»é™¤ã€‚ä½†è‹¥æ˜¯ä½¿ç”¨ -9 è¿™ä¸ª signal æ—¶ï¼Œç”±äºè¯¥ vim å·¥ä½œä¼šè¢«å¼ºåˆ¶ç§»é™¤æ‰ï¼Œå› æ­¤ï¼Œ .filename.swp å°±ä¼šç»§ç»­å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿå½“ä¸­</p><p>å¦‚æœæ— æ³•é€šè¿‡ kill -15 ç»“æŸjobï¼Œ å¯ä»¥ä½¿ç”¨kill -9 job</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>cp æƒé™çš„å®éªŒæµ‹è¯•</title>
    <link href="/2023/08/08/cp-%E6%9D%83%E9%99%90%E7%9A%84%E5%AE%9E%E9%AA%8C%E6%B5%8B%E8%AF%95/"/>
    <url>/2023/08/08/cp-%E6%9D%83%E9%99%90%E7%9A%84%E5%AE%9E%E9%AA%8C%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@luffy luffy2]# <span class="hljs-built_in">cp</span> --<span class="hljs-built_in">help</span><br>ç”¨æ³•ï¼š<span class="hljs-built_in">cp</span> [é€‰é¡¹]... [-T] æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶<br>ã€€æˆ–ï¼š<span class="hljs-built_in">cp</span> [é€‰é¡¹]... æºæ–‡ä»¶... ç›®å½•<br>ã€€æˆ–ï¼š<span class="hljs-built_in">cp</span> [é€‰é¡¹]... -t ç›®å½• æºæ–‡ä»¶...<br>Copy SOURCE to DEST, or multiple SOURCE(s) to DIRECTORY.<br><br>Mandatory arguments to long options are mandatory <span class="hljs-keyword">for</span> short options too.<br>  -a, --archive                 ç­‰äº-dR --preserve=all<br>      --attributes-only ä»…å¤åˆ¶å±æ€§è€Œä¸å¤åˆ¶æ•°æ®      --backup[=CONTROL           ä¸ºæ¯ä¸ªå·²å­˜åœ¨çš„ç›®æ ‡æ–‡ä»¶åˆ›å»ºå¤‡ä»½<br>  -b                            ç±»ä¼¼--backup ä½†ä¸æ¥å—å‚æ•°<br>      --copy-contents           åœ¨é€’å½’å¤„ç†æ˜¯å¤åˆ¶ç‰¹æ®Šæ–‡ä»¶å†…å®¹<br>  -d                            ç­‰äº--no-dereference --preserve=links<br>  -f, --force                  <span class="hljs-keyword">if</span> an existing destination file cannot be<br>                                 opened, remove it and try again (this option<br>                                 is ignored when the -n option is also used)<br>  -i, --interactive            prompt before overwrite (overrides a previous -n<br>                                  option)<br>  -H                           follow command-line symbolic links <span class="hljs-keyword">in</span> SOURCE<br>  -l, --<span class="hljs-built_in">link</span>                   hard <span class="hljs-built_in">link</span> files instead of copying<br>  -L, --dereference            always follow symbolic links <span class="hljs-keyword">in</span> SOURCE<br>  -n, --no-clobber              ä¸è¦è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶(ä½¿å‰é¢çš„ -i é€‰é¡¹å¤±æ•ˆ)<br>  -P, --no-dereference          ä¸è·Ÿéšæºæ–‡ä»¶ä¸­çš„ç¬¦å·é“¾æ¥<br>  -p                            ç­‰äº--preserve=æ¨¡å¼,æ‰€æœ‰æƒ,æ—¶é—´æˆ³<br>      --preserve[=å±æ€§åˆ—è¡¨      ä¿æŒæŒ‡å®šçš„å±æ€§(é»˜è®¤ï¼šæ¨¡å¼,æ‰€æœ‰æƒ,æ—¶é—´æˆ³)ï¼Œå¦‚æœ<br>                                        å¯èƒ½ä¿æŒé™„åŠ å±æ€§ï¼šç¯å¢ƒã€é“¾æ¥ã€xattr ç­‰<br>  -c                           deprecated, same as --preserve=context<br>      --sno-preserve=å±æ€§åˆ—è¡¨   ä¸ä¿ç•™æŒ‡å®šçš„æ–‡ä»¶å±æ€§<br>      --parents                 å¤åˆ¶å‰åœ¨ç›®æ ‡ç›®å½•åˆ›å»ºæ¥æºæ–‡ä»¶è·¯å¾„ä¸­çš„æ‰€æœ‰ç›®å½•<br>  -R, -r, --recursive           é€’å½’å¤åˆ¶ç›®å½•åŠå…¶å­ç›®å½•å†…çš„æ‰€æœ‰å†…å®¹<br>      --reflink[=WHEN]          æ§åˆ¶å…‹éš†/CoW å‰¯æœ¬ã€‚è¯·æŸ¥çœ‹ä¸‹é¢çš„å†…å¦‚ã€‚<br>      --remove-destination      å°è¯•æ‰“å¼€ç›®æ ‡æ–‡ä»¶å‰å…ˆåˆ é™¤å·²å­˜åœ¨çš„ç›®çš„åœ°<br>                                        æ–‡ä»¶ (ç›¸å¯¹äº --force é€‰é¡¹)<br>      --sparse=WHEN             æ§åˆ¶åˆ›å»ºç¨€ç–æ–‡ä»¶çš„æ–¹å¼<br>      --strip-trailing-slashes  åˆ é™¤å‚æ•°ä¸­æ‰€æœ‰æºæ–‡ä»¶/ç›®å½•æœ«ç«¯çš„æ–œæ <br>  -s, --symbolic-link           åªåˆ›å»ºç¬¦å·é“¾æ¥è€Œä¸å¤åˆ¶æ–‡ä»¶<br>  -S, --suffix=åç¼€             è‡ªè¡ŒæŒ‡å®šå¤‡ä»½æ–‡ä»¶çš„åç¼€<br>  -t,  --target-directory=ç›®å½•  å°†æ‰€æœ‰å‚æ•°æŒ‡å®šçš„æºæ–‡ä»¶/ç›®å½•<br>                                           å¤åˆ¶è‡³ç›®æ ‡ç›®å½•<br>  -T, --no-target-directory     å°†ç›®æ ‡ç›®å½•è§†ä½œæ™®é€šæ–‡ä»¶<br>  -u, --update                  åªåœ¨æºæ–‡ä»¶æ¯”ç›®æ ‡æ–‡ä»¶æ–°ï¼Œæˆ–ç›®æ ‡æ–‡ä»¶<br>                                        ä¸å­˜åœ¨æ—¶æ‰è¿›è¡Œå¤åˆ¶<br>  -v, --verbose         æ˜¾ç¤ºè¯¦ç»†çš„è¿›è¡Œæ­¥éª¤<br>  -x, --one-file-system ä¸è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæ“ä½œ<br>  -Z                           <span class="hljs-built_in">set</span> SELinux security context of destination<br>                                 file to default <span class="hljs-built_in">type</span><br>      --context[=CTX]          like -Z, or <span class="hljs-keyword">if</span> CTX is specified <span class="hljs-keyword">then</span> <span class="hljs-built_in">set</span> the<br>                                 SELinux or SMACK security context to CTX<br>      --<span class="hljs-built_in">help</span>            æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º<br>      --version         æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡º<br></code></pre></td></tr></table></figure><p>æ—¥å¸¸ä¼šç”¨çš„çš„ç‰¹åˆ«é‡è¦çš„æœ‰ï¼Œ-a -d -f -i -l -p -r -s -u</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"> <span class="hljs-built_in">cp</span> [options] source1 source2 source3 .... directory<br>é€‰é¡¹ä¸å‚æ•°ï¼š<br>-a ï¼šç›¸å½“äº -dr --preserve=all çš„æ„æ€ï¼Œè‡³äº dr è¯·å‚è€ƒä¸‹åˆ—è¯´æ˜ï¼›(å¸¸ç”¨)<br>-d ï¼šè‹¥æ¥æºæ–‡ä»¶ä¸ºé“¾æ¥æ–‡ä»¶çš„å±æ€§(<span class="hljs-built_in">link</span> file)ï¼Œåˆ™å¤åˆ¶é“¾æ¥æ–‡ä»¶å±æ€§è€Œéæ–‡ä»¶æœ¬èº«ï¼›<br>-f ï¼šä¸ºå¼ºåˆ¶(force)çš„æ„æ€ï¼Œè‹¥ç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ä¸”æ— æ³•å¼€å¯ï¼Œåˆ™ç§»é™¤åå†å°è¯•ä¸€æ¬¡ï¼›<br>-i ï¼šè‹¥ç›®æ ‡æ–‡ä»¶(destination)å·²ç»å­˜åœ¨æ—¶ï¼Œåœ¨è¦†ç›–æ—¶ä¼šå…ˆè¯¢é—®åŠ¨ä½œçš„è¿›è¡Œ(å¸¸ç”¨)<br>-l ï¼šè¿›è¡Œç¡¬å¼è¿ç»“(hard <span class="hljs-built_in">link</span>)çš„è¿ç»“æ¡£å»ºç«‹ï¼Œè€Œéå¤åˆ¶æ–‡ä»¶æœ¬èº«ï¼›<br>-p ï¼šè¿åŒæ–‡ä»¶çš„å±æ€§(æƒé™ã€ç”¨æˆ·ã€æ—¶é—´)ä¸€èµ·å¤åˆ¶è¿‡å»ï¼Œè€Œéä½¿ç”¨é»˜è®¤å±æ€§(å¤‡ä»½å¸¸ç”¨)ï¼›<br>-r ï¼šé€’å½’æŒç»­å¤åˆ¶ï¼Œç”¨äºç›®å½•çš„å¤åˆ¶è¡Œä¸ºï¼›(å¸¸ç”¨)<br>-s ï¼šå¤åˆ¶æˆä¸ºç¬¦å·é“¾æ¥æ–‡ä»¶ (symbolic <span class="hljs-built_in">link</span>)ï¼Œäº¦å³ã€å¿«æ·æ–¹å¼ã€æ–‡ä»¶ï¼›<br>-u ï¼šdestination æ¯” <span class="hljs-built_in">source</span> æ—§æ‰æ›´æ–° destinationï¼Œæˆ– destination ä¸å­˜åœ¨çš„æƒ…å†µä¸‹æ‰å¤åˆ¶ã€‚<br>--preserve=all ï¼šé™¤äº† -p çš„æƒé™ç›¸å…³å‚æ•°å¤–ï¼Œè¿˜åŠ å…¥ SELinux çš„å±æ€§, links, xattr ç­‰ä¹Ÿå¤åˆ¶äº†ã€‚<br>æœ€åéœ€è¦æ³¨æ„çš„ï¼Œå¦‚æœæ¥æºæ¡£æœ‰ä¸¤ä¸ªä»¥ä¸Šï¼Œåˆ™æœ€åä¸€ä¸ªç›®çš„æ–‡ä»¶ä¸€å®šè¦æ˜¯ã€ç›®å½•ã€æ‰è¡Œï¼<br></code></pre></td></tr></table></figure><p><strong>-a</strong> <strong>ç›¸å½“äº â€œ-dã€-pã€-râ€ ï¼Œåœ¨è¿›è¡Œç›¸å…³åº”ç”¨çš„æ•°æ®è¿ç§»æ—¶ï¼Œå°±å¿…é¡»æŠŠæƒé™å¸¦ä¸Šï¼Œå› ä¸ºå¾ˆå¤šåº”ç”¨åœ¨å¯åŠ¨çš„æ—¶å€™ä¸ºäº†å®‰å…¨å¹¶ä¸æ˜¯ä»¥rootçš„è´¦å·å»è¿è¡Œï¼Œæ¯”å¦‚postgresï¼Œè¿™æ—¶è¦æ˜¯ä»¥rootçš„èº«ä»½å»cpï¼Œä¸å¸¦ä»»ä½•å‚æ•°ï¼Œæƒé™å°±å˜æˆåªæœ‰rootå’Œrootæ‰€åœ¨ç»„çš„ç”¨æˆ·å¯ä»¥è¿è¡Œäº†ï¼Œåˆ«çš„ç”¨æˆ·æ˜¯ä¸èƒ½è¿è¡Œçš„ï¼çœŸå®è¸©å‘ï¼</strong></p><p>è®°å½•ä¸‹å®éªŒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@luffy ~]# <span class="hljs-built_in">cd</span> /home/luffy2/<br>[root@luffy luffy2]# ll<br>æ€»ç”¨é‡ 0<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:04 luffy2<br>drwxrwxr-x 2 luffy2 luffy2 17 8æœˆ   8 17:06 luffy22<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx<br>[root@luffy luffy2]# <span class="hljs-built_in">cp</span> xxx ./xxx_root<br>[root@luffy luffy2]# ll<br>æ€»ç”¨é‡ 0<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:04 luffy2<br>drwxrwxr-x 2 luffy2 luffy2 17 8æœˆ   8 17:06 luffy22<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx<br>-rw-r--r-- 1 root   root    0 8æœˆ   8 17:08 xxx_root<br>[root@luffy luffy2]# <span class="hljs-built_in">cp</span> -a xxx ./xxx_root_a<br>[root@luffy luffy2]# ll<br>æ€»ç”¨é‡ 0<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:04 luffy2<br>drwxrwxr-x 2 luffy2 luffy2 17 8æœˆ   8 17:06 luffy22<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx<br>-rw-r--r-- 1 root   root    0 8æœˆ   8 17:08 xxx_root<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx_root_a<br>[root@luffy luffy2]# su - luffy2<br>ä¸Šä¸€æ¬¡ç™»å½•ï¼šäºŒ 8æœˆ  8 17:03:52 CST 2023pts/1 ä¸Š<br>[luffy2@luffy ~]$ ll<br>æ€»ç”¨é‡ 0<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:04 luffy2<br>drwxrwxr-x 2 luffy2 luffy2 17 8æœˆ   8 17:06 luffy22<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx<br>-rw-r--r-- 1 root   root    0 8æœˆ   8 17:08 xxx_root<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx_root_a<br>[luffy2@luffy ~]$ <span class="hljs-built_in">chmod</span> 754 xxx<br>[luffy2@luffy ~]$ ll<br>æ€»ç”¨é‡ 0<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:04 luffy2<br>drwxrwxr-x 2 luffy2 luffy2 17 8æœˆ   8 17:06 luffy22<br>-rwxr-xr-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx<br>-rw-r--r-- 1 root   root    0 8æœˆ   8 17:08 xxx_root<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx_root_a<br>[luffy2@luffy ~]$ su - root<br>å¯†ç ï¼š<br>ä¸Šä¸€æ¬¡ç™»å½•ï¼šäºŒ 8æœˆ  8 17:08:40 CST 2023pts/1 ä¸Š<br>[root@luffy ~]# <span class="hljs-built_in">cd</span> /home/luffy2/<br>[root@luffy luffy2]# ll<br>æ€»ç”¨é‡ 0<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:04 luffy2<br>drwxrwxr-x 2 luffy2 luffy2 17 8æœˆ   8 17:06 luffy22<br>-rwxr-xr-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx<br>-rw-r--r-- 1 root   root    0 8æœˆ   8 17:08 xxx_root<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx_root_a<br>[root@luffy luffy2]# <span class="hljs-built_in">cp</span> xxx xxx_root_x<br>[root@luffy luffy2]# ll<br>æ€»ç”¨é‡ 0<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:04 luffy2<br>drwxrwxr-x 2 luffy2 luffy2 17 8æœˆ   8 17:06 luffy22<br>-rwxr-xr-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx<br>-rw-r--r-- 1 root   root    0 8æœˆ   8 17:08 xxx_root<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx_root_a<br>-rwxr-xr-- 1 root   root    0 8æœˆ   8 17:11 xxx_root_x   <span class="hljs-comment"># åŸæœ¬luffy2 æ— æ‰§è¡Œæƒé™äº†ï¼ï¼</span><br>[root@luffy luffy2]# <span class="hljs-built_in">cp</span> -a xxx xxx_root_x_a<br>[root@luffy luffy2]# ll<br>æ€»ç”¨é‡ 0<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:04 luffy2<br>drwxrwxr-x 2 luffy2 luffy2 17 8æœˆ   8 17:06 luffy22<br>-rwxr-xr-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx<br>-rw-r--r-- 1 root   root    0 8æœˆ   8 17:08 xxx_root<br>-rw-rw-r-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx_root_a<br>-rwxr-xr-- 1 root   root    0 8æœˆ   8 17:11 xxx_root_x<br>-rwxr-xr-- 1 luffy2 luffy2  0 8æœˆ   8 17:07 xxx_root_x_a  <span class="hljs-comment"># è¿™æ ·æ‰æ˜¯okçš„ï¼ï¼ï¼</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux æ–‡ä»¶ç§ç±»ä¸æ‰©å±•å</title>
    <link href="/2023/08/01/Linux-%E6%96%87%E4%BB%B6%E7%A7%8D%E7%B1%BB%E4%B8%8E%E6%89%A9%E5%B1%95%E5%90%8D/"/>
    <url>/2023/08/01/Linux-%E6%96%87%E4%BB%B6%E7%A7%8D%E7%B1%BB%E4%B8%8E%E6%89%A9%E5%B1%95%E5%90%8D/</url>
    
    <content type="html"><![CDATA[<p>ä»»ä½•è£…ç½®åœ¨ Linux åº•ä¸‹éƒ½æ˜¯æ–‡ä»¶</p><h2 id="æ–‡ä»¶ç§ç±»"><a href="#æ–‡ä»¶ç§ç±»" class="headerlink" title="æ–‡ä»¶ç§ç±»"></a>æ–‡ä»¶ç§ç±»</h2><p>åˆ°ä½¿ç”¨ã€ls -lã€è§‚å¯Ÿåˆ°ç¬¬ä¸€æ é‚£åä¸ªå­—ç¬¦ä¸­ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºæ–‡ä»¶çš„ç±»å‹ã€‚é™¤äº†å¸¸è§çš„ä¸€èˆ¬æ–‡ä»¶(-)ä¸ç›®å½•æ–‡ä»¶(d)ä¹‹å¤–ã€‚</p><ul><li><strong>æ­£è§„æ–‡ä»¶(regular file )</strong>ï¼š</li></ul><p>æ˜¯ä¸€èˆ¬æˆ‘ä»¬åœ¨è¿›è¡Œå­˜å–çš„ç±»å‹çš„æ–‡ä»¶ï¼Œåœ¨ç”± ls -al æ‰€æ˜¾ç¤ºå‡ºæ¥çš„å±æ€§æ–¹é¢ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º [ - ]ï¼Œä¾‹å¦‚ </p><p>[-rwxrwxrwx ]ã€‚å¦å¤–ï¼Œä¾ç…§æ–‡ä»¶çš„å†…å®¹ï¼Œåˆå¤§ç•¥å¯ä»¥åˆ†ä¸ºï¼š</p><p>a. çº¯æ–‡æœ¬æ¡£(ASCII)ï¼šè¿™æ˜¯ Linux ç³»ç»Ÿä¸­æœ€å¤šçš„ä¸€ç§æ–‡ä»¶ç±»å‹å•°ï¼Œ ç§°ä¸ºçº¯æ–‡æœ¬æ¡£æ˜¯å› ä¸ºå†…å®¹ä¸ºæˆ‘ä»¬äºº </p><p>ç±»å¯ä»¥ç›´æ¥è¯»åˆ°çš„æ•°æ®ï¼Œä¾‹å¦‚æ•°å­—ã€å­—æ¯ç­‰ç­‰ã€‚ </p><p>b. äºŒè¿›åˆ¶æ–‡ä»¶(binary)ï¼šç³»ç»Ÿå…¶å®ä»…è®¤è¯†ä¸”å¯ä»¥æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶(binary file)</p><p>c. æ•°æ®æ ¼å¼æ–‡ä»¶(data)ï¼š æœ‰äº›ç¨‹åºåœ¨è¿ä½œçš„è¿‡ç¨‹å½“ä¸­ä¼šè¯»å–æŸäº›ç‰¹å®šæ ¼å¼çš„æ–‡ä»¶ï¼Œé‚£äº›ç‰¹å®šæ ¼å¼çš„æ–‡ </p><p>ä»¶å¯ä»¥è¢«ç§°ä¸ºæ•°æ®æ–‡ä»¶ (data file)ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬çš„ Linux åœ¨ä½¿ç”¨è€…ç™»å…¥æ—¶ï¼Œéƒ½ä¼šå°†ç™»å½•çš„æ•°æ®è®°å½•åœ¨ &#x2F;var&#x2F;log&#x2F;wtmp é‚£ä¸ªæ–‡ä»¶å†…ï¼Œè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ª data fileï¼Œä»–èƒ½å¤Ÿé€è¿‡ last è¿™ä¸ªæŒ‡ä»¤è¯»å‡ºæ¥ï¼ä½†æ˜¯ä½¿ç”¨ cat æ—¶ï¼Œä¼šè¯»å‡ºä¹±ç ï½å› ä¸ºä»–æ˜¯å±äºä¸€ç§ç‰¹æ®Šæ ¼å¼çš„æ–‡ä»¶ã€‚</p><ul><li><strong>ç›®å½•(directory)</strong></li></ul><p>ç›®å½•ï¼Œç¬¬ä¸€ä¸ªå±æ€§ä¸º [ d ]ï¼Œä¾‹å¦‚ [drwxrwxrwx]</p><ul><li><strong>è¿ç»“æ¡£(link)</strong></li></ul><p>ç±»ä¼¼ Windows ç³»ç»Ÿåº•ä¸‹çš„å¿«æ·æ–¹å¼å•¦ï¼ç¬¬ä¸€ä¸ªå±æ€§ä¸º [ l ](è‹±æ–‡ L çš„å°å†™)ï¼Œä¾‹å¦‚ [lrwxrwxrwx] ï¼›</p><ul><li><strong>è®¾å¤‡ä¸è£…ç½®æ–‡ä»¶(device)</strong></li></ul><p>ä¸ç³»ç»Ÿå‘¨è¾¹åŠå‚¨å­˜ç­‰ç›¸å…³çš„ä¸€äº›æ–‡ä»¶ï¼Œ é€šå¸¸éƒ½é›†ä¸­åœ¨&#x2F;dev è¿™ä¸ªç›®å½•ä¹‹ä¸‹ï¼é€šå¸¸åˆåˆ†ä¸ºä¸¤ç§ï¼š</p><p>a. åŒºå—(block)è®¾å¤‡æ¡£ ï¼šå°±æ˜¯ä¸€äº›å‚¨å­˜æ•°æ®ï¼Œ ä»¥æä¾›ç³»ç»Ÿéšæœºå­˜å–çš„æ¥å£è®¾å¤‡ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œç¡¬ç›˜ä¸è½¯ç›˜ç­‰å°±æ˜¯å•¦ï¼ä½ å¯ä»¥éšæœºçš„åœ¨ç¡¬ç›˜çš„ä¸åŒåŒºå—è¯»å†™ï¼Œè¿™ç§è£…ç½®å°±æ˜¯æˆç»„è®¾å¤‡å•°ï¼ä½ å¯ä»¥è‡ªè¡ŒæŸ¥ä¸€ä¸‹&#x2F;dev&#x2F;sda çœ‹çœ‹ï¼Œ ä¼šå‘ç°ç¬¬ä¸€ä¸ªå±æ€§ä¸º[ b ]</p><p>b. å­—ç¬¦(character)è®¾å¤‡æ–‡ä»¶ï¼šäº¦å³æ˜¯ä¸€äº›ä¸²è¡Œç«¯å£çš„æ¥å£è®¾å¤‡ï¼Œ ä¾‹å¦‚é”®ç›˜ã€é¼ æ ‡ç­‰ç­‰ï¼è¿™äº›è®¾å¤‡çš„ç‰¹ </p><p>è‰²å°±æ˜¯ã€ä¸€æ¬¡æ€§è¯»å–ã€çš„ï¼Œä¸èƒ½å¤Ÿæˆªæ–­è¾“å‡ºã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œä½ ä¸å¯èƒ½è®©é¼ æ ‡ã€è·³åˆ°ã€å¦ä¸€ä¸ªç”»é¢ï¼Œ </p><p>è€Œæ˜¯ã€è¿ç»­æ€§æ»‘åŠ¨ã€åˆ°å¦ä¸€ä¸ªåœ°æ–¹å•Šï¼ç¬¬ä¸€ä¸ªå±æ€§ä¸º [ c ]ã€‚</p><ul><li><strong>èµ„æ–™æ¥å£æ–‡ä»¶(sockets)</strong></li></ul><p>æ—¢ç„¶è¢«ç§°ä¸ºæ•°æ®æ¥å£æ–‡ä»¶ï¼Œ æƒ³å½“ç„¶å°”ï¼Œè¿™ç§ç±»å‹çš„æ–‡ä»¶é€šå¸¸è¢«ç”¨åœ¨ç½‘ç»œä¸Šçš„æ•°æ®æ‰¿æ¥äº†ã€‚ç¬¬ä¸€ä¸ªå±æ€§ä¸º [ s ]ï¼Œæœ€å¸¸åœ¨&#x2F;run æˆ–&#x2F;tmp è¿™äº›ä¸ªç›®å½•ä¸­çœ‹åˆ°è¿™ç§æ–‡ä»¶ç±»å‹äº†ã€‚</p><ul><li><strong>æ•°æ®è¾“é€æ–‡ä»¶(FIFO, pipe)</strong></li></ul><p>FIFO ä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ç±»å‹ï¼Œä»–ä¸»è¦çš„ç›®çš„åœ¨è§£å†³å¤šä¸ªç¨‹åºåŒæ—¶å­˜å–ä¸€ä¸ªæ–‡ä»¶æ‰€é€ æˆçš„é”™è¯¯é—®é¢˜ã€‚</p><p>FIFO æ˜¯ first-in-first-out çš„ç¼©å†™ã€‚ç¬¬ä¸€ä¸ªå±æ€§ä¸º[p] </p><h2 id="Linux-æ–‡ä»¶æ‰©å±•å"><a href="#Linux-æ–‡ä»¶æ‰©å±•å" class="headerlink" title="Linux æ–‡ä»¶æ‰©å±•å"></a>Linux æ–‡ä»¶æ‰©å±•å</h2><p>ä¸€ä¸ª Linux æ–‡ä»¶èƒ½ä¸èƒ½è¢«æ‰§è¡Œï¼Œä¸ä»–çš„ç¬¬ä¸€æ çš„åä¸ªå±æ€§æœ‰å…³ï¼Œ ä¸æ–‡ä»¶åæ ¹æœ¬ä¸€ç‚¹å…³ç³»ä¹Ÿæ²¡æœ‰ã€‚è¿™ä¸ªè§‚å¿µè·Ÿ Windows çš„æƒ…å†µä¸ç›¸åŒã€‚</p><p>x ä»£è¡¨è¿™ä¸ªæ–‡ä»¶å…·æœ‰å¯æ‰§è¡Œçš„èƒ½åŠ›ï¼Œ ä½†æ˜¯èƒ½ä¸èƒ½æ‰§è¡ŒæˆåŠŸï¼Œå½“ç„¶å°±å¾—è¦çœ‹è¯¥æ–‡ä»¶çš„å†…å®¹ã€‚</p><h2 id="Linux-æ–‡ä»¶é•¿åº¦é™åˆ¶"><a href="#Linux-æ–‡ä»¶é•¿åº¦é™åˆ¶" class="headerlink" title="Linux æ–‡ä»¶é•¿åº¦é™åˆ¶"></a>Linux æ–‡ä»¶é•¿åº¦é™åˆ¶</h2><p>åœ¨ Linux åº•ä¸‹ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„ Ext2&#x2F;Ext3&#x2F;Ext4 æ–‡ä»¶ç³»ç»Ÿä»¥åŠè¿‘æ¥è¢« CentOS 7 å½“ä½œé¢„è®¾æ–‡ä»¶ç³»ç»Ÿçš„ xfs è€Œè¨€ï¼Œé’ˆå¯¹æ–‡ä»¶çš„æ¡£åé•¿åº¦é™åˆ¶ä¸ºï¼š</p><p>å•ä¸€æ–‡ä»¶æˆ–ç›®å½•çš„æœ€å¤§å®¹è®¸æ–‡ä»¶åä¸º 255bytesï¼Œä»¥ä¸€ä¸ª ASCII è‹±æ–‡å ç”¨ä¸€ä¸ª bytes æ¥è¯´ï¼Œåˆ™å¤§çº¦å¯è¾¾ 255 ä¸ªå­—ç¬¦é•¿åº¦ã€‚è‹¥æ˜¯ä»¥æ¯ä¸ªä¸­æ–‡å­—å ç”¨ 2bytes æ¥è¯´ï¼Œ æœ€å¤§æ¡£åå°±æ˜¯å¤§çº¦åœ¨ 128 ä¸ªä¸­æ–‡å­—ã€‚</p><h2 id="Linux-æ–‡ä»¶åçš„é™åˆ¶"><a href="#Linux-æ–‡ä»¶åçš„é™åˆ¶" class="headerlink" title="Linux æ–‡ä»¶åçš„é™åˆ¶"></a>Linux æ–‡ä»¶åçš„é™åˆ¶</h2><p>ç”±äº Linux åœ¨æ–‡å­—æ¥å£ä¸‹çš„ä¸€äº›æŒ‡ä»¤æ“ä½œå…³ç³»ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä½ åœ¨è®¾å®š Linux åº•ä¸‹çš„æ–‡ä»¶åæ—¶ï¼Œ æœ€å¥½ </p><p>å¯ä»¥é¿å…ä¸€äº›ç‰¹æ®Šå­—ç¬¦æ¯”è¾ƒå¥½ï¼ä¾‹å¦‚åº•ä¸‹è¿™äº›ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">* ? &gt; &lt; ; &amp; ! [ ] | \ <span class="hljs-string">&#x27; &quot; ` ( ) &#123; &#125;</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºè¿™äº›ç¬¦å·åœ¨æ–‡å­—æ¥å£ä¸‹ï¼Œæ˜¯æœ‰ç‰¹æ®Šæ„ä¹‰çš„ï¼å¦å¤–ï¼Œæ–‡ä»¶åçš„å¼€å¤´ä¸ºå°æ•°ç‚¹ã€.ã€æ—¶ï¼Œ ä»£è¡¨è¿™ä¸ªæ–‡ ä»¶ä¸ºã€éšè—æ¡£ã€å–”ï¼åŒæ—¶ï¼Œç”±äºæŒ‡ä»¤ä¸‹è¾¾å½“ä¸­ï¼Œå¸¸å¸¸ä¼šä½¿ç”¨åˆ° -option ä¹‹ç±»çš„é€‰é¡¹ï¼Œ æ‰€ä»¥ä½ æœ€å¥½ä¹Ÿé¿å…å°†æ–‡ä»¶æ¡£åçš„å¼€å¤´ä»¥ - æˆ– + æ¥å‘½åå•Šï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python æ€§èƒ½åˆ†æ</title>
    <link href="/2023/06/13/Python-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/"/>
    <url>/2023/06/13/Python-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p>pythonæ€§èƒ½è°ƒè¯•è¿‡ç¨‹ä¸­æœ€çªå‡ºçš„é—®é¢˜å°±æ˜¯è€—æ—¶ï¼Œæ€§èƒ½æµ‹è¯•å·¥å…·æœ‰å¾ˆå¤šï¼Œåƒprofilerï¼Œcprofilerç­‰ç­‰ï¼Œéƒ½æ˜¯åªèƒ½è¿”å›å‡½æ•°æ•´ä½“çš„è€—æ—¶ï¼Œè€Œline_profilerå°±èƒ½å¤Ÿå¾ˆå¥½è§£å†³è¿™ä¸ªé—®é¢˜</p><p>é¡¹ç›®åœ°å€</p><p><a href="https://github.com/rkern/line_profiler">https://github.com/rkern/line_profiler</a></p><p>è¿™é‡Œè®°å½• line_profiler çš„ä¸¤ç§ç”¨æ³•</p><h2 id="é€šè¿‡è£…é¥°å™¨-profile"><a href="#é€šè¿‡è£…é¥°å™¨-profile" class="headerlink" title="é€šè¿‡è£…é¥°å™¨ @profile"></a>é€šè¿‡è£…é¥°å™¨ @profile</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">do_other_stuff</span>(<span class="hljs-params">numbers</span>):<br>    s = <span class="hljs-built_in">sum</span>(numbers)<br><br><span class="hljs-meta">@profile</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">do_stuff</span>(<span class="hljs-params">numbers</span>):<br>    do_other_stuff(numbers)<br>    l = [numbers[i] / <span class="hljs-number">43</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(numbers))]<br>    m = [<span class="hljs-string">&#x27;hello&#x27;</span> + <span class="hljs-built_in">str</span>(numbers[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(numbers))]<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    numbers = [random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>)]<br>    do_stuff(numbers)<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯å®˜æ–¹çš„æ¨èï¼Œä½†æ˜¯è¿™é‡Œå¯¹ç¬¬ä¸€æ¬¡ç”¨è¿™ä¸ªåº“çš„äººæ¥è¯´å¹¶ä¸å‹å¥½ï¼æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>ç»™éœ€è¦åˆ†æçš„å‡½æ•°åŠ ä¸Š @profileè£…é¥°å™¨ï¼ˆè¿™æ—¶ç¬¬ä¸€ååº”è‚¯å®šæ˜¯å¼•å…¥è£…é¥°å™¨çš„ä¾èµ–ï¼Œä¸ç„¶ä»£ç éƒ½æŠ¥é”™äº†ï¼Œä½†æ˜¯å®é™…ä¸Šè¿›è¡Œæ€§èƒ½åˆ†æä¸æ˜¯é€šè¿‡è¿è¡Œä»£ç çš„ï¼Œæ˜¯é€šè¿‡å‘½ä»¤è¡Œï¼‰</li><li>é€šè¿‡å‘½ä»¤ <strong>kernprof -l .\23.6.12\speed_test.py</strong>  ç”Ÿæˆ speed_test.py.lprofæ–‡ä»¶</li><li>æœ€åé€šè¿‡python è°ƒç”¨line_profilerå»åˆ†æspeed_test.py.lprofï¼Œå‘½ä»¤</li></ul><p><strong>python -m line_profiler .\speed_test.py.lprof</strong></p><p>åˆ†æç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">Timer unit: <span class="hljs-number">1e-06</span> s<br><br>Total time: <span class="hljs-number">0.0004925</span> s<br>File: .\<span class="hljs-number">23.6</span><span class="hljs-number">.12</span>\speed_test.py<br>Function: do_stuff at line <span class="hljs-number">7</span><br><br>Line <span class="hljs-comment">#      Hits         Time  Per Hit   % Time  Line Contents</span><br>==============================================================<br>     <span class="hljs-number">7</span>                                           @profile<br>     <span class="hljs-number">8</span>                                           <span class="hljs-keyword">def</span> <span class="hljs-title function_">do_stuff</span>(<span class="hljs-params">numbers</span>):<br>     <span class="hljs-number">9</span>         <span class="hljs-number">1</span>          <span class="hljs-number">9.3</span>      <span class="hljs-number">9.3</span>      <span class="hljs-number">1.9</span>      do_other_stuff(numbers)<br>    <span class="hljs-number">10</span>         <span class="hljs-number">1</span>        <span class="hljs-number">159.2</span>    <span class="hljs-number">159.2</span>     <span class="hljs-number">32.3</span>      l = [numbers[i] / <span class="hljs-number">43</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(numbers))]<br>    <span class="hljs-number">11</span>         <span class="hljs-number">1</span>        <span class="hljs-number">324.0</span>    <span class="hljs-number">324.0</span>     <span class="hljs-number">65.8</span>      m = [<span class="hljs-string">&#x27;hello&#x27;</span> + <span class="hljs-built_in">str</span>(numbers[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(numbers))]<br></code></pre></td></tr></table></figure><p>é€è¡Œæ˜¾ç¤ºå‡ºäº†å‡½æ•°çš„æºç åŠå…¶è€—æ—¶ä¿¡æ¯ã€‚å…±æœ‰å…­åˆ—ä¿¡æ¯ã€‚</p><ul><li>Line #: åœ¨æ–‡ä»¶ä¸­çš„è¡Œå·</li><li>Hits: è¯¥è¡Œè¢«æ‰§è¡Œçš„æ¬¡æ•°</li><li>Time: æ‰§è¡Œè¯¥è¡Œçš„æ€»æ—¶é—´ï¼Œä»¥å®šæ—¶å™¨ä¸ºå•ä½è¡¨ç¤ºã€‚åœ¨è¡¨æ ¼å‰çš„æ ‡é¢˜ä¿¡æ¯ä¸­ï¼Œæœ‰ä¸€è¡Œâ€œTimer unitï¼ˆå®šæ—¶å™¨å•ä½ï¼‰â€ï¼Œç»™å‡ºäº†ä¸ç§’çš„æ¢ç®—å…³ç³»ã€‚åœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šå¯èƒ½æœ‰æ‰€ä¸åŒã€‚</li><li>Per Hit: ä»¥å®šæ—¶å™¨ä¸ºå•ä½ï¼Œæ‰§è¡Œä¸€æ¬¡è¯¥è¡Œçš„å¹³å‡æ—¶é—´</li><li>% Time: è¯¥è¡Œæ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œåœ¨è¯¥å‡½æ•°çš„æ€»è®°å½•æ—¶é—´ä¸­æ‰€å çš„ç™¾åˆ†æ¯”</li><li>Line Contents: å®é™…çš„æºç ã€‚</li></ul><h2 id="å®ä¾‹åŒ–LineProfiler"><a href="#å®ä¾‹åŒ–LineProfiler" class="headerlink" title="å®ä¾‹åŒ–LineProfiler"></a>å®ä¾‹åŒ–LineProfiler</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> line_profiler <span class="hljs-keyword">import</span> LineProfiler<br><span class="hljs-keyword">import</span> random<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">do_other_stuff</span>(<span class="hljs-params">numbers</span>):<br>    s = <span class="hljs-built_in">sum</span>(numbers)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">do_stuff</span>(<span class="hljs-params">numbers</span>):<br>    do_other_stuff(numbers)<br>    l = [numbers[i] / <span class="hljs-number">43</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(numbers))]<br>    m = [<span class="hljs-string">&#x27;hello&#x27;</span> + <span class="hljs-built_in">str</span>(numbers[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(numbers))]<br><br><br>numbers = [random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>)]<br>lp = LineProfiler()<br>lp_wrapper = lp(do_stuff)<br>lp_wrapper(numbers)<br>lp.print_stats()<br></code></pre></td></tr></table></figure><p>é€šè¿‡å®ä¾‹åŒ–LineProfilerï¼Œlp_wrapper &#x3D; lp(do_stuff) ä¼ å…¥éœ€è¦åˆ†æçš„å‡½æ•°åï¼Œlp_wrapper(numbers)ä¼ å…¥éœ€è¦åˆ†æå‡½æ•°çš„å‚æ•°ï¼Œlp.print_stats()æœ€åæ‰“å°ç»“æœï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">Timer unit: <span class="hljs-number">1e-07</span> s<br><br>Total time: <span class="hljs-number">0.0005496</span> s<br>File: M:/code/example/daily-code/<span class="hljs-number">23.6</span><span class="hljs-number">.12</span>/speed_test.py<br>Function: do_stuff at line <span class="hljs-number">9</span><br><br>Line <span class="hljs-comment">#      Hits         Time  Per Hit   % Time  Line Contents</span><br>==============================================================<br>     <span class="hljs-number">9</span>                                           <span class="hljs-keyword">def</span> <span class="hljs-title function_">do_stuff</span>(<span class="hljs-params">numbers</span>):<br>    <span class="hljs-number">10</span>         <span class="hljs-number">1</span>        <span class="hljs-number">100.0</span>    <span class="hljs-number">100.0</span>      <span class="hljs-number">1.8</span>      do_other_stuff(numbers)<br>    <span class="hljs-number">11</span>         <span class="hljs-number">1</span>       <span class="hljs-number">2180.0</span>   <span class="hljs-number">2180.0</span>     <span class="hljs-number">39.7</span>      l = [numbers[i] / <span class="hljs-number">43</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(numbers))]<br>    <span class="hljs-number">12</span>         <span class="hljs-number">1</span>       <span class="hljs-number">3216.0</span>   <span class="hljs-number">3216.0</span>     <span class="hljs-number">58.5</span>      m = [<span class="hljs-string">&#x27;hello&#x27;</span> + <span class="hljs-built_in">str</span>(numbers[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(numbers))]<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªåªæ˜¯æœ€ç®€å•çš„ä½¿ç”¨ï¼Œå½“å‡½æ•°æœ‰åˆ«çš„å‡½æ•°è°ƒç”¨ï¼Œå°±ä¸èƒ½åˆ†è¾¨å‡ºå…·ä½“è€—æ—¶åœ¨å“ªå—ï¼Œè¿™æ—¶å¯ä»¥åŠ å…¥éœ€è¦åˆ†æçš„å‡½æ•°åç§°ï¼Œæœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> line_profiler <span class="hljs-keyword">import</span> LineProfiler<br><span class="hljs-keyword">import</span> random<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">do_other_stuff</span>(<span class="hljs-params">numbers</span>):<br>    s = <span class="hljs-built_in">sum</span>(numbers)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">do_stuff</span>(<span class="hljs-params">numbers</span>):<br>    do_other_stuff(numbers)<br>    l = [numbers[i] / <span class="hljs-number">43</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(numbers))]<br>    m = [<span class="hljs-string">&#x27;hello&#x27;</span> + <span class="hljs-built_in">str</span>(numbers[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(numbers))]<br><br><br>numbers = [random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>)]<br>lp = LineProfiler()<br>lp.add_function(do_other_stuff)  <span class="hljs-comment"># add additional function to profile</span><br>lp_wrapper = lp(do_stuff)<br>lp_wrapper(numbers)<br>lp.print_stats()<br></code></pre></td></tr></table></figure><p>åˆ†æç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">Timer unit: <span class="hljs-number">1e-07</span> s<br><br>Total time: <span class="hljs-number">6.3e-06</span> s<br>File: M:/code/example/daily-code/<span class="hljs-number">23.6</span><span class="hljs-number">.12</span>/speed_test.py<br>Function: do_other_stuff at line <span class="hljs-number">5</span><br><br>Line <span class="hljs-comment">#      Hits         Time  Per Hit   % Time  Line Contents</span><br>==============================================================<br>     <span class="hljs-number">5</span>                                           <span class="hljs-keyword">def</span> <span class="hljs-title function_">do_other_stuff</span>(<span class="hljs-params">numbers</span>):<br>     <span class="hljs-number">6</span>         <span class="hljs-number">1</span>         <span class="hljs-number">63.0</span>     <span class="hljs-number">63.0</span>    <span class="hljs-number">100.0</span>      s = <span class="hljs-built_in">sum</span>(numbers)<br><br>Total time: <span class="hljs-number">0.0005201</span> s<br>File: M:/code/example/daily-code/<span class="hljs-number">23.6</span><span class="hljs-number">.12</span>/speed_test.py<br>Function: do_stuff at line <span class="hljs-number">9</span><br><br>Line <span class="hljs-comment">#      Hits         Time  Per Hit   % Time  Line Contents</span><br>==============================================================<br>     <span class="hljs-number">9</span>                                           <span class="hljs-keyword">def</span> <span class="hljs-title function_">do_stuff</span>(<span class="hljs-params">numbers</span>):<br>    <span class="hljs-number">10</span>         <span class="hljs-number">1</span>        <span class="hljs-number">127.0</span>    <span class="hljs-number">127.0</span>      <span class="hljs-number">2.4</span>      do_other_stuff(numbers)<br>    <span class="hljs-number">11</span>         <span class="hljs-number">1</span>       <span class="hljs-number">1770.0</span>   <span class="hljs-number">1770.0</span>     <span class="hljs-number">34.0</span>      l = [numbers[i] / <span class="hljs-number">43</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(numbers))]<br>    <span class="hljs-number">12</span>         <span class="hljs-number">1</span>       <span class="hljs-number">3304.0</span>   <span class="hljs-number">3304.0</span>     <span class="hljs-number">63.5</span>      m = [<span class="hljs-string">&#x27;hello&#x27;</span> + <span class="hljs-built_in">str</span>(numbers[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(numbers))]<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠdo_other_stuffå‡½æ•°åŠ å…¥åˆ†æä¸­ï¼Œ<strong>line_profiler</strong>å¯ä»¥å¸®æˆ‘ä»¬æŠŠdo_other_stuffçš„æ‰§è¡Œæ—¶é—´ä¹Ÿæ‰“å°å‡ºæ¥</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘ç»œæ•…éšœæ’æŸ¥å‘½ä»¤</title>
    <link href="/2023/05/22/%E7%BD%91%E7%BB%9C%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E5%91%BD%E4%BB%A4/"/>
    <url>/2023/05/22/%E7%BD%91%E7%BB%9C%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h3 id="æŸ¥çœ‹ç½‘å…³"><a href="#æŸ¥çœ‹ç½‘å…³" class="headerlink" title="æŸ¥çœ‹ç½‘å…³"></a>æŸ¥çœ‹ç½‘å…³</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@luffy ~]# route -n<br>Kernel IP routing table<br>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>0.0.0.0         10.67.9.253     0.0.0.0         UG    100    0        0 ens192<br>10.67.8.0       0.0.0.0         255.255.252.0   U     100    0        0 ens192<br>172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0<br>172.18.0.0      0.0.0.0         255.255.0.0     U     0      0        0 br-c941541f478c<br>192.0.2.128     0.0.0.0         255.255.255.128 U     0      0        0 br-69a5ef1e769f<br></code></pre></td></tr></table></figure><h3 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@luffy ~]# ping 10.67.44.117<br>PING 10.67.44.117 (10.67.44.117) 56(84) bytes of data.<br>64 bytes from 10.67.44.117: icmp_seq=2 ttl=63 time=0.377 ms<br>64 bytes from 10.67.44.117: icmp_seq=3 ttl=63 time=0.372 ms<br>64 bytes from 10.67.44.117: icmp_seq=4 ttl=63 time=0.386 ms<br>64 bytes from 10.67.44.117: icmp_seq=5 ttl=63 time=0.361 ms<br>^C<br>--- 10.67.44.117 ping statistics ---<br>5 packets transmitted, 4 received, 20% packet loss, time 3999ms<br>rtt min/avg/max/mdev = 0.361/0.374/0.386/0.009 ms<br></code></pre></td></tr></table></figure><h3 id="traceroute-è¿½è¸ªè·¯ç”±"><a href="#traceroute-è¿½è¸ªè·¯ç”±" class="headerlink" title="traceroute è¿½è¸ªè·¯ç”±"></a>traceroute è¿½è¸ªè·¯ç”±</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@luffy ~]# traceroute -w 1 baidu.com<br>traceroute to baidu.com (39.156.66.10), 30 hops max, 60 byte packets<br> 1  gateway (10.67.9.253)  3.301 ms  3.596 ms  3.854 ms<br> 2  10.67.254.254 (10.67.254.254)  0.175 ms  0.169 ms  0.156 ms<br> 3  111.46.57.1 (111.46.57.1)  2.739 ms  2.786 ms  2.778 ms<br> 4  120.202.252.181 (120.202.252.181)  3.145 ms  3.306 ms 120.202.2.13 (120.202.2.13)  1.148 ms<br> 5  221.183.74.165 (221.183.74.165)  4.410 ms  3.952 ms  3.946 ms<br> 6  221.183.37.225 (221.183.37.225)  19.831 ms 221.183.37.141 (221.183.37.141)  25.085 ms 221.183.37.225 (221.183.37.225)  19.781 ms<br> 7  * 221.183.49.122 (221.183.49.122)  25.900 ms  24.989 ms<br> 8  * 111.13.188.38 (111.13.188.38)  22.599 ms  20.465 ms<br> 9  39.156.67.1 (39.156.67.1)  21.634 ms  21.592 ms 39.156.27.5 (39.156.27.5)  24.155 ms<br>10  * 39.156.67.17 (39.156.67.17)  28.742 ms  28.675 ms<br>11  * * *  # ä¸æ”¯æŒç”¨traceroute æŸ¥çœ‹ï¼Œä¼šä»¥* å±•ç¤º<br>12  * * *<br>13  * * *<br>14  * * *<br>15  * * *<br>16  * * *<br>17  * * *<br>18  * * *<br>19  * * *<br>20  * * *<br>21  * * *<br>22  * * *<br>23  * * *<br>24  * * *<br>25  * * *<br>26  * * *<br>27  * * *<br>28  * * *<br>29  * * *<br>30  * * *<br></code></pre></td></tr></table></figure><h3 id="mtr"><a href="#mtr" class="headerlink" title="mtr"></a>mtr</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">My traceroute  [v0.85]<br>luffy.super (::)                                                              Sun Jun 18 14:18:46 2023<br>Keys:  Help   Display mode   Restart statistics   Order of fields   quit<br>                                                              Packets               Pings<br> Host                                                       Loss%   Snt   Last   Avg  Best  Wrst StDev<br> 1. localhost                                                0.0%    41    0.1   0.0   0.0   0.1   0.0<br></code></pre></td></tr></table></figure><h3 id="nsloopup-åŸŸåè§£ææˆip"><a href="#nsloopup-åŸŸåè§£ææˆip" class="headerlink" title="nsloopup åŸŸåè§£ææˆip"></a>nsloopup åŸŸåè§£ææˆip</h3><p>æ²¡æœ‰è¿™ä¸ªå‘½ä»¤éœ€è¦ä¸‹è½½ bind-utils</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@luffy ~]# nslookup baidu.com<br>Server:         223.5.5.5  # é€šè¿‡è¿™ä¸ªåŸŸåæœåŠ¡å™¨è¿›è¡ŒåŸŸåè§£æçš„<br>Address:        223.5.5.5#53<br><br>Non-authoritative answer:<br>Name:   baidu.com  <br>Address: 39.156.66.10 # è§£æå‡ºçš„ip<br>Name:   baidu.com<br>Address: 110.242.68.66<br></code></pre></td></tr></table></figure><h3 id="telnet-æŸ¥çœ‹ä¸ä¸»æœºçš„ç«¯å£æ˜¯å¦ç•…é€š"><a href="#telnet-æŸ¥çœ‹ä¸ä¸»æœºçš„ç«¯å£æ˜¯å¦ç•…é€š" class="headerlink" title="telnet æŸ¥çœ‹ä¸ä¸»æœºçš„ç«¯å£æ˜¯å¦ç•…é€š"></a>telnet æŸ¥çœ‹ä¸ä¸»æœºçš„ç«¯å£æ˜¯å¦ç•…é€š</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@luffy ~]# telnet baidu.com 443<br>Trying 39.156.66.10...<br>Connected to baidu.com.<br>Escape character is &#x27;^]&#x27;.<br>^]<br>HTTP/1.1 302 Moved Temporarily<br>Server: bfe/1.0.8.18<br>Date: Sun, 18 Jun 2023 06:23:51 GMT<br>Content-Type: text/html<br>Content-Length: 161<br>Connection: close<br>Location: http://www.baidu.com/error.html<br><br>&lt;html&gt;<br>&lt;head&gt;&lt;title&gt;302 Found&lt;/title&gt;&lt;/head&gt;<br>&lt;body bgcolor=&quot;white&quot;&gt;<br>&lt;center&gt;&lt;h1&gt;302 Found&lt;/h1&gt;&lt;/center&gt;<br>&lt;hr&gt;&lt;center&gt;bfe/1.0.8.18&lt;/center&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br>Connection closed by foreign host.<br></code></pre></td></tr></table></figure><h3 id="tcpdump-æŠ“åŒ…å·¥å…·"><a href="#tcpdump-æŠ“åŒ…å·¥å…·" class="headerlink" title="tcpdump æŠ“åŒ…å·¥å…·"></a>tcpdump æŠ“åŒ…å·¥å…·</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@luffy ~]# tcpdump<br>tcpdump: verbose output suppressed, use -v or -vv for full protocol decode<br>listening on docker0, link-type EN10MB (Ethernet), capture size 262144 bytes<br>^C<br>0 packets captured<br>0 packets received by filter<br>0 packets dropped by kernel<br>[root@luffy ~]# tcpdump -i any -n port 80<br>tcpdump: verbose output suppressed, use -v or -vv for full protocol decode<br>listening on any, link-type LINUX_SLL (Linux cooked), capture size 262144 bytes<br>^C<br>0 packets captured<br>0 packets received by filter<br>0 packets dropped by kernel<br>[root@luffy ~]# tcpdump -i any -n host 10.44.118<br>tcpdump: verbose output suppressed, use -v or -vv for full protocol decode<br>listening on any, link-type LINUX_SLL (Linux cooked), capture size 262144 bytes<br>^C<br>0 packets captured<br>0 packets received by filter<br>0 packets dropped by kernel<br>[root@luffy ~]# tcpdump -i any -n host 10.44.118 and port 80 -w /temp/tcpdump.log2<br>tcpdump: listening on any, link-type LINUX_SLL (Linux cooked), capture size 262144 bytes<br></code></pre></td></tr></table></figure><h3 id="netstat-æŸ¥çœ‹æœåŠ¡ç›‘å¬åœ°å€"><a href="#netstat-æŸ¥çœ‹æœåŠ¡ç›‘å¬åœ°å€" class="headerlink" title="netstat æŸ¥çœ‹æœåŠ¡ç›‘å¬åœ°å€"></a>netstat æŸ¥çœ‹æœåŠ¡ç›‘å¬åœ°å€</h3><p>-n æ˜¾ç¤ºIPï¼Œä¸æ˜¾ç¤ºåŸŸå -t tcpåè®®çš„ -p è¿›ç¨‹ -l license</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@luffy ~]# netstat -ntpl<br>Active Internet connections (only servers)<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name<br>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1085/sshd<br>tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1304/master<br>tcp6       0      0 :::8080                 :::*                    LISTEN      1871/docker-proxy-c<br>tcp6       0      0 :::9009                 :::*                    LISTEN      850/clickhouse-serv<br>tcp6       0      0 :::8081                 :::*                    LISTEN      1884/docker-proxy-c<br>tcp6       0      0 :::22                   :::*                    LISTEN      1085/sshd<br>tcp6       0      0 ::1:25                  :::*                    LISTEN      1304/master<br>tcp6       0      0 :::8123                 :::*                    LISTEN      850/clickhouse-serv<br>tcp6       0      0 :::8000                 :::*                    LISTEN      7394/docker-proxy-c<br>tcp6       0      0 :::9000                 :::*                    LISTEN      850/clickhouse-serv<br>tcp6       0      0 :::9004                 :::*                    LISTEN      850/clickhouse-serv<br>tcp6       0      0 :::9005                 :::*                    LISTEN      850/clickhouse-serv<br></code></pre></td></tr></table></figure><h3 id="ss-å’Œ-netstat-ç±»ä¼¼"><a href="#ss-å’Œ-netstat-ç±»ä¼¼" class="headerlink" title="ss å’Œ netstat ç±»ä¼¼"></a>ss å’Œ netstat ç±»ä¼¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs plain">[root@luffy ~]# ss -ntpl<br>State       Recv-Q Send-Q      Local Address:Port                     Peer Address:Port<br>LISTEN      0      128                     *:22                                  *:*<br>users:((&quot;sshd&quot;,pid=1085,fd=3))<br>LISTEN      0      100             127.0.0.1:25                                  *:*<br>users:((&quot;master&quot;,pid=1304,fd=13))<br>LISTEN      0      128                  [::]:8080                             [::]:*<br>users:((&quot;docker-proxy-cu&quot;,pid=1871,fd=4))<br>LISTEN      0      128                  [::]:9009                             [::]:*<br>users:((&quot;clickhouse-serv&quot;,pid=850,fd=37))<br>LISTEN      0      128                  [::]:8081                             [::]:*<br>users:((&quot;docker-proxy-cu&quot;,pid=1884,fd=4))<br>LISTEN      0      128                  [::]:22                               [::]:*<br>users:((&quot;sshd&quot;,pid=1085,fd=4))<br>LISTEN      0      100                 [::1]:25                               [::]:*<br>users:((&quot;master&quot;,pid=1304,fd=14))<br>LISTEN      0      128                  [::]:8123                             [::]:*<br>users:((&quot;clickhouse-serv&quot;,pid=850,fd=35))<br>LISTEN      0      128                  [::]:8000                             [::]:*<br>users:((&quot;docker-proxy-cu&quot;,pid=7394,fd=4))<br>LISTEN      0      128                  [::]:9000                             [::]:*<br>users:((&quot;clickhouse-serv&quot;,pid=850,fd=36))<br>LISTEN      0      128                  [::]:9004                             [::]:*<br>users:((&quot;clickhouse-serv&quot;,pid=850,fd=38))<br>LISTEN      0      128                  [::]:9005                             [::]:*<br>users:((&quot;clickhouse-serv&quot;,pid=850,fd=39))<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django Rest Frameworkå…«å¤§ç»„ä»¶</title>
    <link href="/2022/08/21/Django-Rest-Framework%E5%85%AB%E5%A4%A7%E7%BB%84%E4%BB%B6/"/>
    <url>/2022/08/21/Django-Rest-Framework%E5%85%AB%E5%A4%A7%E7%BB%84%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<p>DRFæ•´åˆäº†éå¸¸å¤šçš„å¼€å‘å¸¸ç”¨ç»„ä»¶ï¼Œè®¤è¯ï¼Œæˆæƒã€é™æµç­‰ç­‰ï¼Œç®€å•é…ç½®å³å¯ä½¿ç”¨</p><h1 id="è®¤è¯å’Œæˆæƒ"><a href="#è®¤è¯å’Œæˆæƒ" class="headerlink" title="è®¤è¯å’Œæˆæƒ"></a>è®¤è¯å’Œæˆæƒ</h1><h2 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h2><p>å¼€å¯å…¨å±€é…ç½®ï¼Œåªè¦è¯·æ±‚åç«¯æ¥å£ï¼Œéƒ½éœ€è¦è¿›è¡Œè®¤è¯æ‰å¯ä»¥è¯·æ±‚æˆåŠŸ</p><p><code>settings.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># DRF ç»„ä»¶é…ç½®</span><br>REST\_FRAMEWORK = &#123;<br><span class="hljs-comment"># å†…éƒ¨å¾ªç¯éå†æ³¨å†Œçš„è®¤è¯ç±»ï¼Œä¸€æ—¦æˆåŠŸï¼Œç»“æŸå¾ªç¯</span><br><span class="hljs-string">&#x27;DEFAULT\_AUTHENTICATION\_CLASSES&#x27;</span>: (<br><span class="hljs-comment"># &#x27;dfdemo.authentication.CustomAuthentication&#x27;, # è‡ªå®šä¹‰è®¤è¯</span><br><span class="hljs-string">&#x27;rest\_framework.authentication.SessionAuthentication&#x27;</span>, <span class="hljs-comment"># session è®¤è¯</span><br><span class="hljs-string">&#x27;rest\_framework.authentication.BasicAuthentication&#x27;</span>, <span class="hljs-comment"># åŸºæœ¬è®¤è¯</span><br>),<br><span class="hljs-comment"># æƒé™é…ç½®</span><br><span class="hljs-string">&#x27;DEFAULT\_PERMISSION\_CLASSES&#x27;</span>: (<br><span class="hljs-comment"># è¦è®¤è¯æ‰èƒ½è¯·æ±‚</span><br><span class="hljs-string">&#x27;rest\_framework.permissions.IsAuthenticated&#x27;</span>,<br>),<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†å»è¯·æ±‚åç«¯æ¥å£ï¼Œåœ¨æ²¡æœ‰ç™»å½•çš„æƒ…å†µä¸‹æ˜¯æ— æ³•è¯·æ±‚æˆåŠŸçš„</p><p><a href="https://imgtu.com/i/qwhsg0"><img src="https://s1.ax1x.com/2022/03/27/qwhsg0.md.png"></a></p><p>ç™»å½•ç®¡ç†å‘˜åï¼Œå†å»è¯·æ±‚å°±æˆåŠŸäº†ï¼Œè·å¾—äº†ç™»å½•ä¿¡æ¯</p><p><a href="https://imgtu.com/i/qwhyvV"><img src="https://s1.ax1x.com/2022/03/27/qwhyvV.png"></a></p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯åç«¯æ‰€æœ‰æ¥å£éƒ½éœ€è¦è®¤è¯ï¼Œæ¯”å¦‚åœ¨ç™»å½•ä¸­çš„ç™»å½•æ¥å£å’ŒéªŒè¯ç æ¥å£å°±ä¸èƒ½è¦æ±‚è®¤è¯ï¼Œä¸ç„¶å°±æ˜¯å…ˆæœ‰é¸¡å…ˆæœ‰è›‹çš„é—®é¢˜å‡ºç°äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥è¿›è¡Œå±€éƒ¨è®¤è¯ï¼Œè®©è¿™ä¸¤ä¸ªæ¥å£ä¸éœ€è¦è¿›è¡Œè®¤è¯</p><h2 id="å±€éƒ¨é…ç½®"><a href="#å±€éƒ¨é…ç½®" class="headerlink" title="å±€éƒ¨é…ç½®"></a>å±€éƒ¨é…ç½®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å±€éƒ¨è®¤è¯</span><br><span class="hljs-comment"># ç™»å½•æ¥å£ï¼Œè¦å–æ¶ˆæ‰€æœ‰çš„è®¤è¯ä¸æƒé™è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¦åšå±€éƒ¨ç¦ç”¨æ“ä½œï¼ˆç©ºé…ç½®ï¼‰</span><br>authentication\_classes = []<br>permission\_classes = []<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬å†å»è¯·æ±‚ä¸éœ€è¦åšè®¤è¯çš„æ¥å£</p><p><a href="https://imgtu.com/i/qwhbDO"><img src="https://s1.ax1x.com/2022/03/27/qwhbDO.png"></a></p><p>å‘ç°ï¼Œæ²¡æœ‰è¿›è¡Œç™»å½•ä¹Ÿå¯ä»¥è®¿é—®ï¼Œè®¿é—®æ²¡æœ‰åšå±€éƒ¨é…ç½®çš„æ¥å£ï¼Œä¾æ—§éœ€è¦è®¤è¯</p><p>é™¤äº†éœ€è¦ç™»å½•è¿™ä¸ªè®¤è¯ï¼Œéƒ¨åˆ†æ¥å£æ˜¯åªæœ‰ç®¡ç†å‘˜æ‰èƒ½è®¿é—®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹ç®¡ç†å‘˜æ¥å£è¿›è¡Œå±€éƒ¨é…ç½®ï¼Œå³ä½¿ç™»é™†äº†ï¼Œä¸æ˜¯ç®¡ç†å‘˜ä¹Ÿä¸èƒ½è®¿é—®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å±€éƒ¨æƒé™é…ç½®æ–¹å¼ ç®¡ç†å‘˜</span><br>authentication\_classes = [SessionAuthentication]<br>permission\_classes = [IsAdminUser]<br></code></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2022/03/27/qwhyvV.png"></p><p>åˆ›å»ºçš„csqè´¦å·ï¼Œæ˜¯æ²¡æœ‰ç®¡ç†å‘˜æƒé™çš„ï¼Œæ‰€ä»¥å³ä½¿æ˜¯ç™»å½•ä¹Ÿä¸èƒ½è¯·æ±‚æˆåŠŸè¿™ä¸ªæ¥å£</p><p><a href="https://imgse.com/i/vyNYgf"><img src="https://s1.ax1x.com/2022/08/21/vyNYgf.png"></a></p><p>æ¢åšluffyå°±å¯ä»¥äº†</p><p>è¿˜å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªè®¤è¯ç±»ï¼Œå®ç°ä¸€ä¸ªæ¥å£çš„è‡ªå®šä¹‰è®¤è¯ï¼Œå¦‚ä¸‹</p><p><code>authentication.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomAuthentication</span>(<span class="hljs-title class_ inherited__">BaseAuthentication</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">è‡ªå®šä¹‰è®¤è¯</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">authenticate</span>(<span class="hljs-params">self, request</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">è®¤è¯æ–¹æ³•</span><br><span class="hljs-string">:param request: å®¢æˆ·ç«¯å‘æ¥çš„httpå¯¹è±¡</span><br><span class="hljs-string">:return:</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>user = request.query\_params.get(<span class="hljs-string">&#x27;user&#x27;</span>)<br>pwd = request.query\_params.get(<span class="hljs-string">&#x27;pwd&#x27;</span>)<br><span class="hljs-keyword">if</span> user != <span class="hljs-string">&#x27;root&#x27;</span> <span class="hljs-keyword">or</span> pwd != <span class="hljs-string">&#x27;123456&#x27;</span>:<br><span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><span class="hljs-comment"># get\_user\_model è·å–å½“å‰ç³»ç»Ÿä¸­å¯¹åº”çš„ç”¨æˆ·æ¨¡å‹ç±»</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰æƒé™ç±»&#x27;</span>)<br>user = get\_user\_model().objects.first()<br><span class="hljs-comment"># æŒ‰ç…§å›ºå®šçš„è¿”å›æ ¼å¼å¡«å†™ï¼ˆç”¨æˆ·æ¨¡å‹ï¼ŒNoneï¼‰</span><br><span class="hljs-keyword">return</span> (user,<span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><p>å†™çš„å¾ˆç®€å•ï¼Œå°±æ˜¯è¦å†åœ°å€æ æ‹¼æ¥ä¸Šç”¨æˆ·åå’Œå¯†ç </p><p>ç›®å‰åšäº†å…¨å±€è®¤è¯å’Œæƒé™é…ç½®ï¼Œå¿…é¡»ç™»å½•èƒ½è®¿é—®æ¥å£ï¼Œç°åœ¨æˆ‘ä»¬æŠŠè‡ªå®šä¹‰çš„é…ç½®ä¼ åˆ°æ¥å£ä¸­æµ‹è¯•ï¼Œæµ‹è¯•åœ¨æœªç™»å½•çš„æƒ…å†µä¸‹æ‹¼æ¥åœ°å€èƒ½ä¸èƒ½è¯·æ±‚æˆåŠŸã€‚</p><p><a href="https://imgse.com/i/vyNGCt"><img src="https://s1.ax1x.com/2022/08/21/vyNGCt.png"></a></p><p>å‘ç°è¯·æ±‚æˆåŠŸï¼Œæˆ‘ä»¬ä¸è¿™æ ·æ‹¼æ¥ï¼Œç›´æ¥ç™»å½•è¶…çº§ç®¡ç†å‘˜ç™»å½•åï¼Œå»è¯·æ±‚è¯¥æ¥å£</p><p><a href="https://imgtu.com/i/qwhr3q"><img src="https://s1.ax1x.com/2022/03/27/qwhr3q.png"></a></p><p>å‘ç°è¯·æ±‚å¤±è´¥ï¼Œæˆ‘ä»¬åœ¨PyCharmä¸­ä¹Ÿå‘ç°æ‰“å°ä¿¡æ¯ï¼š</p><p><a href="https://imgtu.com/i/qwh04s"><img src="https://s1.ax1x.com/2022/03/27/qwh04s.png"></a></p><p>åœ¨å…¨å±€é…ç½®ä¸­ï¼Œé…ç½®çš„æˆæƒä¿¡æ¯æ˜¯è®¤è¯å°±å¯ä»¥è®¿é—®ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æƒé™é…ç½®</p><p><code>permission.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IsXiaoMingPermissions</span>(<span class="hljs-title class_ inherited__">BasePermission</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">è‡ªå®šä¹‰æƒé™ï¼Œå¯å…¨å±€ï¼Œä¹Ÿå¯å±€éƒ¨</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">has</span>\_permission(<span class="hljs-variable language_">self</span>, request, view):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">è¯•å›¾æƒé™ True å¯ä»¥è®¿é—®</span><br><span class="hljs-string">:param request:</span><br><span class="hljs-string">:param view:</span><br><span class="hljs-string">:return:</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>role = request.query\_params.get(<span class="hljs-string">&#x27;role&#x27;</span>)<br><span class="hljs-keyword">return</span> role == <span class="hljs-string">&#x27;xiaoming&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">has</span>\_<span class="hljs-built_in">object</span>\_permission(<span class="hljs-variable language_">self</span>, request, view, obj):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">æ¨¡å‹æƒé™</span><br><span class="hljs-string">:param request:</span><br><span class="hljs-string">:param view:</span><br><span class="hljs-string">:param obj:</span><br><span class="hljs-string">:return:</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><p><code>view.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">permission\_classes = [IsXiaoMingPermissions] <span class="hljs-comment"># è‡ªå®šä¹‰æƒé™</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„å±€éƒ¨é…ç½®å®Œæˆåï¼Œè¦æ±‚è¯·æ±‚è¿™ä¸ªç±»çš„æ¥å£éƒ½è¦ç¬¦åˆ <code>IsXiaoMingPermissions.py</code>ï¼Œå¦åˆ™å³ä½¿æ˜¯è¶…çº§ç®¡ç†å‘˜ä¹Ÿæ— æ³•è¯·æ±‚ï¼Œæµ‹è¯•å¦‚ä¸‹ï¼š</p><p><a href="https://imgse.com/i/vyND5n"><img src="https://s1.ax1x.com/2022/08/21/vyND5n.png" alt="vyND5n.png"></a></p><p>ç”¨luffyè¿™ä¸ªè¶…çº§ç®¡ç†å‘˜è´¦æˆ·æµ‹è¯•</p><p><a href="https://imgtu.com/i/qwhr3q"><img src="https://s1.ax1x.com/2022/03/27/qwhr3q.png"></a></p><p>å³ä½¿ç™»å½•çš„æ˜¯è¶…çº§ç®¡ç†å‘˜ï¼Œä¹Ÿæ— æ³•è¯·æ±‚æˆåŠŸï¼å¿…é¡»æ˜¯é€šè¿‡è‡ªå®šä¹‰çš„æˆæƒç¨‹åºæ‰èƒ½è¯·æ±‚æˆåŠŸã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>å…¨å±€é…ç½®å†³å®šäº†ç¨‹åºæ‰€æœ‰æ¥å£çš„è®¤è¯å’Œæˆæƒä¿¡æ¯ï¼Œä½†å¯ä»¥é€šè¿‡å±€éƒ¨é…ç½®è¿›è¡Œè¦†ç›–ï¼Œç”Ÿæ•ˆçš„å°±æ˜¯å±€éƒ¨é…ç½®äº†</li><li>è®¤è¯å’Œæˆæƒè”ç³»ç´§å¯†ï¼Œåœ¨é…ç½®çš„æ—¶å€™è¦è€ƒè™‘ä¸¤è€…ä¹‹é—´çš„å…³ç³»</li></ol><h1 id="é™æµ"><a href="#é™æµ" class="headerlink" title="é™æµ"></a>é™æµ</h1><h3 id="å…¨å±€é…ç½®-1"><a href="#å…¨å±€é…ç½®-1" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h3><p><code>settings.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># èŠ‚æµçš„é…ç½®åˆ—è¡¨</span><br><span class="hljs-string">&#x27;DEFAULT\_THROTTLE\_CLASSES&#x27;</span>: (<br><span class="hljs-string">&#x27;rest\_framework.throttling.AnonRateThrottle&#x27;</span>, <span class="hljs-comment"># åŒ¿åæœªè®¤è¯ç”¨æˆ·ï¼Œä½¿ç”¨IPåŒºåˆ†ç”¨æˆ·</span><br><span class="hljs-string">&#x27;rest\_framework.throttling.UserRateThrottle&#x27;</span> <span class="hljs-comment"># ä½¿ç”¨User id æ¥åŒºåˆ†</span><br><span class="hljs-comment"># &#x27;rest\_framework.throttling.ScopeRateThrottle&#x27;, # ç‰¹å®šåŸŸé™æµ</span><br>),<br><span class="hljs-comment"># èŠ‚æµç‡</span><br><span class="hljs-string">&#x27;DEFAULT\_THROTTLE\_RATES&#x27;</span>: &#123;<br><span class="hljs-string">&#x27;anon&#x27;</span>: <span class="hljs-string">&#x27;3/day&#x27;</span>, <span class="hljs-comment"># åŒ¿åç”¨æˆ·æ¯å¤©ä¸‰æ¬¡</span><br><span class="hljs-string">&#x27;user&#x27;</span>: <span class="hljs-string">&#x27;5/day&#x27;</span>, <span class="hljs-comment"># ç™»å½•ç”¨æˆ·æ¯å¤©äº”æ¬¡</span><br>&#125;,<br></code></pre></td></tr></table></figure><p>æœªè®¤è¯ç”¨æˆ·ä½¿ç”¨IPåŒºåˆ†ï¼Œå·²è®¤è¯ç”¨æˆ·ä½¿ç”¨IDç”¨äºç”Ÿæˆå”¯ä¸€çš„å¯†é’¥ä»¥è¿›è¡Œé™åˆ¶ ã€‚</p><p>èŠ‚æµç‡çš„æ—¶é—´å¯ä»¥ç”¨å¤©ï¼Œå°æ—¶ï¼Œåˆ†ï¼Œç§’ç­‰æ¥è¿›è¡Œé™å®š</p><p>åˆ†åˆ«æµ‹è¯•æœªç™»å½•å’Œç™»å½•ç”¨æˆ·å»è¯·æ±‚</p><p><a href="https://imgtu.com/i/qwhDCn"><img src="https://s1.ax1x.com/2022/03/27/qwhDCn.png"></a></p><p>è¾¾åˆ°è¯·æ±‚ä¸Šé™ï¼Œå¾—åˆ°é¢„æœŸæ•ˆæœ</p><h3 id="å±€éƒ¨é…ç½®-1"><a href="#å±€éƒ¨é…ç½®-1" class="headerlink" title="å±€éƒ¨é…ç½®"></a>å±€éƒ¨é…ç½®</h3><p>å‡è®¾å…¨å±€å¹¶æ²¡æœ‰åšé™æµæ“ä½œï¼Œåªæ˜¯åœ¨æŸä¸ªæ¥å£ä¸­éœ€è¦åšé™æµï¼Œå¯ä»¥é‡‡ç”¨å±€éƒ¨é™æµçš„æ–¹æ³•ï¼Œåšæ³•æœ‰ä¸¤ç§</p><p>å–æ¶ˆå…¨å±€é™æµï¼Œä¿ç•™é™æµç‡ï¼Œå¯¹éœ€è¦åšé™æµçš„æ“ä½œè¿›è¡Œå±€éƒ¨é™æµå¤„ç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentReadOnlyModelViewSet</span>(<span class="hljs-title class_ inherited__">ReadOnlyModelViewSet</span>):<br>queryset = Student.objects.<span class="hljs-built_in">all</span>()<br>serializer\_<span class="hljs-keyword">class</span> = StudentModelSerializer<br><span class="hljs-comment"># å±€éƒ¨é™æµ</span><br>throttle\_classes = [AnonRateThrottle,UserRateThrottle]<br></code></pre></td></tr></table></figure><p>å‘ç°é…ç½®äº†å±€éƒ¨é™æµçš„æ¥å£ä¼šå—é™æµç‡çš„æ“ä½œï¼Œæ²¡æœ‰é…ç½®çš„æ¥å£åˆ™ä¸å—é™åˆ¶</p><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯ï¼Œåœ¨å…¨å±€ä»éœ€é™æµæ“ä½œçš„æƒ…å†µä¸‹ï¼Œéƒ¨åˆ†æ¥å£ä¸å…¨å±€é™æµç‡ä¸ä¸€è‡´ï¼Œè¿™æ˜¯éœ€è¦é…ç½®å±€éƒ¨é™æµç‡äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># èŠ‚æµçš„é…ç½®åˆ—è¡¨</span><br><span class="hljs-string">&#x27;DEFAULT\_THROTTLE\_CLASSES&#x27;</span>: (<br><span class="hljs-string">&#x27;rest\_framework.throttling.AnonRateThrottle&#x27;</span>, <span class="hljs-comment"># åŒ¿åæœªè®¤è¯ç”¨æˆ·ï¼Œä½¿ç”¨IPåŒºåˆ†ç”¨æˆ·</span><br><span class="hljs-string">&#x27;rest\_framework.throttling.UserRateThrottle&#x27;</span> <span class="hljs-comment"># ä½¿ç”¨User id æ¥åŒºåˆ†</span><br><span class="hljs-comment"># &#x27;rest\_framework.throttling.ScopeRateThrottle&#x27;, # è‡ªå®šä¹‰é™æµåŸŸ</span><br>),<br><span class="hljs-comment"># èŠ‚æµç‡</span><br><span class="hljs-string">&#x27;DEFAULT\_THROTTLE\_RATES&#x27;</span>: &#123;<br><span class="hljs-string">&#x27;anon&#x27;</span>: <span class="hljs-string">&#x27;3/day&#x27;</span>, <span class="hljs-comment"># åŒ¿åç”¨æˆ·æ¯å¤©ä¸‰æ¬¡</span><br><span class="hljs-string">&#x27;user&#x27;</span>: <span class="hljs-string">&#x27;5/day&#x27;</span>, <span class="hljs-comment"># ç™»å½•ç”¨æˆ·æ¯å¤©äº”æ¬¡</span><br><span class="hljs-string">&#x27;Hom&#x27;</span>: <span class="hljs-string">&#x27;10/day&#x27;</span>,<br>&#125;,<br></code></pre></td></tr></table></figure><p>å±€éƒ¨é™æµé…ç½®10æ¬¡&#x2F;dayï¼Œå…¨å±€é™æµé…ç½®ç™»å½•ç”¨æˆ·3æ¬¡&#x2F;day</p><p><code>view.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest\_framework.throttling <span class="hljs-keyword">import</span> ScopedRateThrottle<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentReadOnlyModelViewSet</span>(<span class="hljs-title class_ inherited__">ReadOnlyModelViewSet</span>):<br>queryset = Student.objects.<span class="hljs-built_in">all</span>()<br>serializer\_<span class="hljs-keyword">class</span> = StudentModelSerializer<br><span class="hljs-comment"># å±€éƒ¨é™æµ 10/day</span><br>throttle\_classes = [ScopedRateThrottle]<br>throttle\_scope = <span class="hljs-string">&#x27;Hom&#x27;</span><br></code></pre></td></tr></table></figure><h1 id="è¿‡æ»¤"><a href="#è¿‡æ»¤" class="headerlink" title="è¿‡æ»¤"></a>è¿‡æ»¤</h1><p><code>settings.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">INSTALLED\_APPS = [<br>....<br><span class="hljs-string">&#x27;django\_filters&#x27;</span>,<span class="hljs-comment"># æ³¨å†Œä¸»é”®</span><br>...<br>]<br><span class="hljs-comment"># è¿‡æ»¤æŸ¥è¯¢ï¼Œå…¨å±€é…ç½®[è¿‡æ»¤å’Œæ’åºå…¬ç”¨ä¸€ä¸ªé…ç½®é¡¹]</span><br><span class="hljs-string">&#x27;DEFAULT\_FILTER\_BACKENDS&#x27;</span>:<br>[<span class="hljs-string">&#x27;django\_filters.rest\_framework.DjangoFilterBackend&#x27;</span>],<br></code></pre></td></tr></table></figure><p><code>view.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">filter</span>\_fields = [<span class="hljs-string">&#x27;sex&#x27;</span>,<span class="hljs-string">&#x27;classmate&#x27;</span>]<br></code></pre></td></tr></table></figure><p>ç®€å•çš„é…ç½®å°±æ˜¯è¿™æ ·ï¼Œå…¨å±€å¼€å¯è¿‡æ»¤é…ç½®ï¼Œå…·å¤‡è®¾ç½®è¿‡æ»¤å­—æ®µï¼Œå°±å¯ä»¥å‘é€å¸¦å‚è¿‡æ»¤Getè¯·æ±‚äº†</p><p>è¿˜æœ‰å¾ˆå¤šå¼ºå¤§çš„é…ç½®ï¼Œç­‰åˆ°æ—¶å€™å·¥ä½œç”¨åˆ°äº†å†å»æ–‡æ¡£é‡Œçœ‹</p><h1 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h1><p><code>setting.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è¿‡æ»¤æŸ¥è¯¢ï¼Œå…¨å±€é…ç½®[è¿‡æ»¤å’Œæ’åºå…¬ç”¨ä¸€ä¸ªé…ç½®é¡¹]</span><br><span class="hljs-string">&#x27;DEFAULT\_FILTER\_BACKENDS&#x27;</span>:[<br><span class="hljs-string">&#x27;django\_filters.rest\_framework.DjangoFilterBackend&#x27;</span>, <span class="hljs-comment"># è¿‡æ»¤</span><br><span class="hljs-string">&#x27;rest\_framework.filters.OrderingFilter&#x27;</span>, <span class="hljs-comment"># æ’åº</span><br>],<br></code></pre></td></tr></table></figure><p><code>view.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å±€éƒ¨é…ç½®æ’åº</span><br><span class="hljs-comment"># è¯·æ±‚æ ¼å¼ ordering=-id - è¡¨ç¤ºå€’åº</span><br><span class="hljs-comment"># å¤šå­—æ®µæ’åº ?ordering = -id,age å¤šå­—æ®µæ’åº</span><br>ordering\_fields = [<span class="hljs-string">&#x27;id&#x27;</span>,<span class="hljs-string">&#x27;age&#x27;</span>]<br></code></pre></td></tr></table></figure><p><a href="https://imgtu.com/i/qwhWE4"><img src="https://s1.ax1x.com/2022/03/27/qwhWE4.png"></a></p><h1 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h1><h2 id="å…¨å±€é…ç½®-2"><a href="#å…¨å±€é…ç½®-2" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h2><p><code>settings.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å…¨å±€é…ç½®åˆ†é¡µ</span><br><span class="hljs-comment"># é¡µç åˆ†é¡µå™¨</span><br><span class="hljs-string">&#x27;DEFAULT\_PAGINATION\_CLASS&#x27;</span>: <span class="hljs-string">&#x27;rest\_framework.pagination.PageNumberPagination&#x27;</span>, <span class="hljs-comment"># page=é¡µç &amp;page\_size=å•é¡µæ•°æ®é‡</span><br><span class="hljs-comment"># åç§»é‡åˆ†é¡µå™¨</span><br><span class="hljs-comment"># &#x27;DEFAULT\_PAGINATION\_CLASS&#x27;: &#x27;rest\_framework.pagination.LimitOffsetPagination&#x27;, # limit=å•é¡µæ•°æ®é‡&amp;offset=é¡µç </span><br><span class="hljs-string">&#x27;PAGE\_SIZE&#x27;</span>: <span class="hljs-number">3</span>,<br></code></pre></td></tr></table></figure><p>è¿™æ ·é…ç½®ï¼Œè§†å›¾å±‚åªè¦æ˜¯è¿”å›listå°±ä¼šåˆ†é¡µ</p><p><a href="https://imgse.com/i/qwhgDU"><img src="https://s1.ax1x.com/2022/03/27/qwhgDU.png"></a></p><p>ä½†æ˜¯é€šå¸¸ä¸ä¼šè®¾ç½®å…¨å±€åˆ†é¡µï¼Œå› ä¸ºæœ‰å¾ˆå¤šä¸šåŠ¡æ˜¯ä¸éœ€è¦åˆ†é¡µçš„ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®å±€éƒ¨åˆ†é¡µ</p><h2 id="å±€éƒ¨é…ç½®-2"><a href="#å±€éƒ¨é…ç½®-2" class="headerlink" title="å±€éƒ¨é…ç½®"></a>å±€éƒ¨é…ç½®</h2><p>å±€éƒ¨é…ç½®å°±æ˜¯è‡ªå·±å†™ä¸ªè‡ªå·±çš„åˆ†é¡µå™¨ï¼Œç„¶ååœ¨éœ€è¦è¿›è¡Œåˆ†é¡µçš„æ—¶å€™å¼•å…¥å³å¯</p><p><code>pagiation.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentPageNumberPagination</span>(<span class="hljs-title class_ inherited__">PageNumberPagination</span>):<br>page\_size = <span class="hljs-number">10</span> <span class="hljs-comment"># é»˜è®¤åˆ†é¡µçš„æ¯ä¸€é¡µæ•°æ®é‡</span><br><span class="hljs-built_in">max</span>\_page\_size = <span class="hljs-number">20</span> <span class="hljs-comment"># å®¢æˆ·ç«¯å¯è°ƒæ•´æœ€å¤§å•é¡µæ•°æ®é‡</span><br>page\_query\_param = <span class="hljs-string">&#x27;page&#x27;</span> <span class="hljs-comment"># é¡µç </span><br>page\_size\_query\_param = <span class="hljs-string">&#x27;page\_size&#x27;</span> <span class="hljs-comment"># å•é¡µæ•°æ®é‡</span><br></code></pre></td></tr></table></figure><p>åœ¨ <code>view.py</code>ä¸­å¼•å…¥è‡ªå®šä¹‰åˆ†é¡µå™¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åˆ†é¡µå™¨å±€éƒ¨åˆ†é¡µ</span><br><span class="hljs-comment"># å£°æ˜è‡ªå®šä¹‰çš„åˆ†é¡µé…ç½®ç±»</span><br>pagination\_<span class="hljs-keyword">class</span> = StudentPageNumberPagination<br></code></pre></td></tr></table></figure><p><a href="https://imgse.com/i/vyN2KU"><img src="https://s1.ax1x.com/2022/08/21/vyN2KU.png"></a></p><p><strong>æ³¨æ„ï¼šå¦‚æœåœ¨è§†å›¾å†…å…³é—­åˆ†é¡µåŠŸèƒ½ï¼Œåªéœ€åœ¨è§†å›¾å†…è®¾ç½®</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pagination\_<span class="hljs-keyword">class</span> = <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure><h1 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h1><p>DRFçš„ <code>Respone</code>å·²ç»ç»™æˆ‘ä»¬å°è£…äº†å¾ˆå¤šé”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸‹é¢é™æµçš„</p><p>[<img src="https://s1.ax1x.com/2022/03/27/qwhDCn.png"></p><p>ä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰å¾ˆå¤šå¼‚å¸¸ä¸èƒ½å¤„ç†è¿”å›ï¼Œä¸€æ—¦æ²¡æœ‰å¤„ç†å°±ä¹‹é—´è¿”å›é”™è¯¯é¡µé¢ï¼Œå¯¹å‰ç«¯æ˜¯å¾ˆä¸å‹å¥½çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬åšä¸€ä¸ªé™¤0æ“ä½œ</p><p><a href="https://imgtu.com/i/qwhh59"><img src="https://s1.ax1x.com/2022/03/27/qwhh59.png"></a></p><p>æˆ‘ä»¬è¦å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œå°±è¦è‡ªå·±å»å†™ä¸ªç±»ï¼Œå»å¤„ç† <code>Response</code>æ— æ³•å¤„ç†çš„å¼‚å¸¸</p><p><code>execeptions.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest\_framework.views <span class="hljs-keyword">import</span> exception\_handler<br><span class="hljs-keyword">from</span> rest\_framework <span class="hljs-keyword">import</span> status<br><span class="hljs-keyword">from</span> rest\_framework.response <span class="hljs-keyword">import</span> Response<br><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> DatabaseError<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">custom</span>\_exception\_handle(exc,context):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">è‡ªå®šä¹‰å¼‚å¸¸å‡½æ•° è¦æ³¨å†Œåˆ°settingä¸­</span><br><span class="hljs-string">:param exc: å¼‚å¸¸å¯¹è±¡</span><br><span class="hljs-string">:param context: ä¸Šä¸‹æ–‡ï¼Œå­—å…¸</span><br><span class="hljs-string">:return:</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-comment"># å…ˆè®©drfå¤„ç†</span><br>response = exception\_handler(exc,context)<br><span class="hljs-comment"># drfæœªè¯†åˆ«çš„å†è‡ªå·±å¤„ç†</span><br><span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>view = context[<span class="hljs-string">&#x27;view&#x27;</span>]<br>request = context[<span class="hljs-string">&#x27;request&#x27;</span>]<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(exc,DatabaseError):<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[%s]:%s&#x27;</span>%(view,exc))<br>response = Response(&#123;<span class="hljs-string">&#x27;detail&#x27;</span>:<span class="hljs-string">&#x27;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯&#x27;</span>&#125;,status=status.HTTP\_507\_INSUFFICIENT\_STORAGE)<br><span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(exc,ZeroDivisionError):<br>response = Response(&#123;<span class="hljs-string">&#x27;detail&#x27;</span>: <span class="hljs-string">&#x27;ç®—æœ¯å¼‚å¸¸&#x27;</span>&#125;, status=status.HTTP\_500\_INTERNAL\_SERVER\_ERROR)<br><span class="hljs-keyword">else</span>:<br>response = Response(&#123;<span class="hljs-string">&#x27;detail&#x27;</span>: <span class="hljs-string">&#x27;æœªæ•è·å¼‚å¸¸&#x27;</span>&#125;, status=status.HTTP\_500\_INTERNAL\_SERVER\_ERROR)<br><span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå¼‚å¸¸å¤„ç†ç±»æœ€å¥½å†™åœ¨çˆ¶ç»„ä»¶ä¸‹ï¼Œå› ä¸ºæ‰€æœ‰ç»„ä»¶éƒ½éœ€è¦è¿™ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†</p><p>é…ç½®è‡ªå®šä¹‰å¼‚å¸¸å¤„ç† <code>setting.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†</span><br><span class="hljs-string">&#x27;EXCEPTION\_HANDLER&#x27;</span>: <span class="hljs-string">&#x27;drfdemo.exceptions.custom\_exception\_handle&#x27;</span>,<br></code></pre></td></tr></table></figure><p>æµ‹è¯•æ•ˆæœ</p><p><a href="https://imgtu.com/i/qwh5CR"><img src="https://s1.ax1x.com/2022/03/27/qwh5CR.png"></a></p><h1 id="è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£"><a href="#è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£" class="headerlink" title="è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£"></a>è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£</h1><h2 id="coreapi"><a href="#coreapi" class="headerlink" title="coreapi"></a>coreapi</h2><p>éœ€è¦å…ˆä¸‹è½½åº“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install coreapi<br></code></pre></td></tr></table></figure><p><code>settings.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£</span><br><span class="hljs-string">&#x27;DEFAULT\_SCHEMA\_CLASS&#x27;</span>:<span class="hljs-string">&#x27;rest\_framework.schemas.AutoSchema&#x27;</span>,<br></code></pre></td></tr></table></figure><p><code>urls.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">path(<span class="hljs-string">&#x27;docs/&#x27;</span>,include\_docs\_urls(title=<span class="hljs-string">&#x27;APIæ–‡æ¡£&#x27;</span>)),<br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—®<a href="http://127.0.0.1:8000/docs/%EF%BC%8C%E5%8D%B3%E5%8F%AF%E7%9C%8B%E5%88%B0%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E4%BA%86%EF%BC%8C%E8%BF%98%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95">http://127.0.0.1:8000/docs/ï¼Œå³å¯çœ‹åˆ°æ¥å£æ–‡æ¡£äº†ï¼Œè¿˜å¯ä»¥è¿›è¡Œæµ‹è¯•</a></p><p><a href="https://imgtu.com/i/qwhTv6"><img src="https://s1.ax1x.com/2022/03/27/qwhTv6.md.png"></a></p><p><a href="https://imgtu.com/i/qwhogx"><img src="https://s1.ax1x.com/2022/03/27/qwhogx.md.png"></a></p><h2 id="swagger"><a href="#swagger" class="headerlink" title="swagger"></a>swagger</h2><p>SpringBootå¸¸ç”¨çš„APIæ¥å£æ–‡æ¡£å°±æ˜¯Swaggerï¼ŒDRFä¹Ÿå¯ä»¥æ•´åˆSwagger</p><p>ä¸‹è½½åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install drf\_yasg<br></code></pre></td></tr></table></figure><p>æ·»åŠ ç»„ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">INSTALLED\_APPS = [<br>...<br><span class="hljs-string">&#x27;drf\_yasg&#x27;</span>,<br>...<br>]<br></code></pre></td></tr></table></figure><p><code>swagger_setting.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">schema\_view = get\_schema\_view(<br>openapi.Info(<br>title=<span class="hljs-string">&quot;æ¥å£æ–‡æ¡£å¹³å°&quot;</span>, <span class="hljs-comment"># å¿…ä¼ </span><br>default\_version=<span class="hljs-string">&#x27;v1&#x27;</span>, <span class="hljs-comment"># å¿…ä¼ </span><br>description=<span class="hljs-string">&quot;æ–‡æ¡£æè¿°&quot;</span>,<br>terms\_of\_service=<span class="hljs-string">&#x27;&#x27;</span>,<br>contact=openapi.Contact(email=<span class="hljs-string">&quot;389783961@qq.com&quot;</span>),<br>license=openapi.License(name=<span class="hljs-string">&quot;BSD LICENSE&quot;</span>)<br>),<br>public=<span class="hljs-literal">True</span>,<br><span class="hljs-comment"># permission\_classes=(rest\_framework.permissions.AllowAny) # æƒé™ç±»</span><br>)<br></code></pre></td></tr></table></figure><p><code>urls.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">urlpatterns = [<br>path(<span class="hljs-string">&#x27;admin/&#x27;</span>, admin.site.urls),<br>path(<span class="hljs-string">&#x27;stu/&#x27;</span>, include(<span class="hljs-string">&#x27;students.urls&#x27;</span>)),<br>path(<span class="hljs-string">&#x27;req/&#x27;</span>, include(<span class="hljs-string">&#x27;req.urls&#x27;</span>)),<br><span class="hljs-comment"># path(&#x27;docs/&#x27;,include\_docs\_urls(title=&#x27;APIæ–‡æ¡£&#x27;)),</span><br>path(<span class="hljs-string">&#x27;swagger/&#x27;</span>, schema\_view.<span class="hljs-keyword">with</span>\_ui(<span class="hljs-string">&#x27;swagger&#x27;</span>, cache\_timeout=<span class="hljs-number">0</span>), name=<span class="hljs-string">&#x27;schema-swagger&#x27;</span>),<br>path(<span class="hljs-string">&#x27;redoc/&#x27;</span>, schema\_view.<span class="hljs-keyword">with</span>\_ui(<span class="hljs-string">&#x27;redoc&#x27;</span>, cache\_timeout=<span class="hljs-number">0</span>), name=<span class="hljs-string">&#x27;schema-redoc&#x27;</span>),<br>]<br></code></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—®<a href="http://127.0.0.1:8000/swagger/">http://127.0.0.1:8000/swagger/</a></p><p><a href="https://imgtu.com/i/qwhI81"><img src="https://s1.ax1x.com/2022/03/27/qwhI81.png"></a></p><hr><h1 id="DRFç³»åˆ—æ€»ç»“"><a href="#DRFç³»åˆ—æ€»ç»“" class="headerlink" title="DRFç³»åˆ—æ€»ç»“"></a>DRFç³»åˆ—æ€»ç»“</h1><p>ä½œä¸ºDjangoçš„æ’ä»¶ï¼ŒDRFå¯¹APIçš„å°è£…éå¸¸å®Œç¾ï¼Œä½†æ˜¯æœ‰æ—¶å€™åˆæ˜¾å¾—å¾ˆé¸¡è‚‹ï¼Œä¸å¤Ÿç›¸æ¯”å®ƒå¸¦ç»™æˆ‘ä»¬çš„ä¾¿åˆ©ï¼Œå°±ä¸å€¼ä¸€æäº†ã€‚</p><p>drfdemoæºç </p><p><a href="https://q1mi.github.io/Django-REST-framework-documentation/#_3">DRFä¸­æ–‡å®˜æ–¹æ–‡æ¡£</a></p><p>2022å¹´3æœˆ27æ—¥10ç‚¹06åˆ†å®Œç»“ï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>DRF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django Rest Frameworkè¯·æ±‚å“åº”è§†å›¾è·¯ç”±</title>
    <link href="/2022/08/21/Django-Rest-Framework%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E8%A7%86%E5%9B%BE%E8%B7%AF%E7%94%B1/"/>
    <url>/2022/08/21/Django-Rest-Framework%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E8%A7%86%E5%9B%BE%E8%B7%AF%E7%94%B1/</url>
    
    <content type="html"><![CDATA[<p>DRFå°è£…äº†å¾ˆå¤šå…³äºè¯·æ±‚ä¿¡æ¯çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>request</code>è·å–ï¼Œå“åº” <code>Response</code> ä¹Ÿæœ‰ç€è§„å®šçš„æ¨¡æ¿ï¼Œè®©æ¥å£å“åº”æ›´åŠ è§„èŒƒã€‚</p><p>åœ¨è§†å›¾ä¸­ï¼Œå°è£…äº†éå¸¸å¤šçš„è§†å›¾ç±»ï¼Œä¾¿äºç®€åŒ–è§†å›¾å±‚æ“ä½œã€‚</p><ul><li><code>APIView</code>æ˜¯DRFä¸­æä¾›çš„æ‰€æœ‰è§†å›¾ç±»çš„ç§¯ç´¯ï¼Œå®ƒç»§æ‰¿äº<code>django.views.View</code>ï¼Œä¼ å…¥çš„è¯·æ±‚æ˜¯DRFçš„ <code>Request</code>å®ä¾‹ï¼Œä»»ä½•<code>APIException</code>å¼‚å¸¸éƒ½ä¼šè¢«æ•è·ï¼Œå¹¶ä¸”ä¼ é€’ç»™åˆé€‚çš„å“åº” ï¼Œä¸šåŠ¡ä»£ç éœ€è¦è‡ªå·±å†™</li><li><code>ViewSet</code>ï¼Œç»§æ‰¿è‡ª<code>APIView</code>ï¼Œæ²¡æœ‰ç»§æ‰¿æ‹“å±•ç±»ï¼Œä¸šåŠ¡é€»è¾‘è¿˜å¾—è‡ªå·±å»å†™ï¼Œæä¾›actionå‚æ•°ï¼Œè¿›è¡Œè§†å›¾å’Œè·¯ç”± çš„ç»‘å®šï¼Œä¸å†ä½¿ç”¨httpè¯·æ±‚ä½œä¸ºè§†å›¾æ–¹æ³• get post put delete å¯ä»¥è‡ªå·±æŒ‡å®šè·¯ç”±å’Œæ–¹æ³•ç»‘å®šï¼Œå®ç°æŠŠå…³äºä¸€ä¸ªæ¨¡å‹çš„æ“ä½œéƒ½å†™åœ¨ä¸€ä¸ªç±»é‡Œ</li><li><code>GenericViewSet</code>ï¼Œç»§æ‰¿è‡ª<code>GenericAPIView</code>ï¼Œæ²¡æœ‰ç»§æ‰¿æ‹“å±•ç±»ï¼Œä¸šåŠ¡é€»è¾‘è¿˜å¾—è‡ªå·±å»å†™ï¼ŒæŠŠéƒ¨åˆ†å…¬å…±ä»£ç å®ç°äº†æœç”¨ã€‚ä¸å†ä½¿ç”¨httpè¯·æ±‚ä½œä¸ºè§†å›¾æ–¹æ³• get post put delete å¯ä»¥è‡ªå·±æŒ‡å®šè·¯ç”±å’Œæ–¹æ³•ç»‘å®šï¼Œå®ç°æŠŠå…³äºä¸€ä¸ªæ¨¡å‹çš„æ“ä½œéƒ½å†™åœ¨ä¸€ä¸ªç±»é‡Œ</li></ul><p>ä¸¤ä¸ªæ‹“å±•è§†å›¾é›†ï¼š</p><ul><li><code>ModelViewSet</code>ï¼ˆå¢åˆ æ”¹æŸ¥éƒ½å¯ä»¥å®ç°äº†ï¼‰ï¼Œç»§æ‰¿äº†<code>GenericAPIView</code>ï¼Œç»§æ‰¿äº†äº”ä¸ªæ‹“å±•ç±»</li><li><code>ReadOnlyModelViewSet</code>ï¼ˆå®ç°äº†è·å–å¤šä¸ªæ•°æ®å¯¹è±¡å’Œè·å–å•ä¸€æ•°æ®å¯¹è±¡ï¼‰ï¼Œç»§æ‰¿äº†<code>GenericAPIView</code>ã€<code>ListModelMixin</code> å’Œ <code>RetrieveModelMixin</code>ã€‚</li></ul><p>è·¯ç”±â€¦</p><h1 id="è¯·æ±‚å“åº”"><a href="#è¯·æ±‚å“åº”" class="headerlink" title="è¯·æ±‚å“åº”"></a>è¯·æ±‚å“åº”</h1><h2 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h2><p>æ–°å»ºä¸€ä¸ªreqåº”ç”¨ï¼Œç”¨äºä¸“é—¨ç¼–å†™æœ¬æ¬¡å®éªŒçš„ä¾‹å­ï¼Œè§†å›¾å±‚ä»£ç å¦‚ä¸‹ï¼›</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self,request</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">requestï¼š&lt;rest\_framework.request.Request: GET &#x27;/req/s1&#x27;&gt; ç”¨çš„drf</span><br><span class="hljs-string">request.\_requestï¼š&lt;WSGIRequest: GET &#x27;/req/s1&#x27;&gt;</span><br><span class="hljs-string">:param request:</span><br><span class="hljs-string">:return:</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;requestï¼š<span class="hljs-subst">&#123;request&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;request.\_requestï¼š<span class="hljs-subst">&#123;request.\_request&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;drfæä¾›çš„requestå¸¸ç”¨æ“ä½œ-------------------------------------&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;ç”¨æˆ·ï¼š<span class="hljs-subst">&#123;request.user&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;åœ°å€æ å‚æ•°ï¼š<span class="hljs-subst">&#123;request.query\_params&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;åœ°å€æ å‚æ•°è½¬å­—å…¸ï¼š<span class="hljs-subst">&#123;request.query\_params.<span class="hljs-built_in">dict</span>()&#125;</span>&#x27;</span>)<br><span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;msg&#x27;</span>:<span class="hljs-string">&#x27;ok&#x27;</span>&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self,request</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">è¯·æ±‚ä½“ï¼š&lt;QueryDict: &#123;&#x27;name&#x27;: [&#x27;å°ç‹&#x27;], &#x27;files&#x27;: [&lt;InMemoryUploadedFile: 1\_Request.txt (text/plain)&gt;, &lt;InMemoryUploadedFile: 1\_Response.txt (text/plain)&gt;]&#125;&gt;</span><br><span class="hljs-string">è¯·æ±‚ä½“è½¬å­—å…¸ï¼š&#123;&#x27;name&#x27;: &#x27;å°ç‹&#x27;, &#x27;files&#x27;: &lt;InMemoryUploadedFile: 1\_Response.txt (text/plain)&gt;&#125;</span><br><span class="hljs-string">&#123;&lt;InMemoryUploadedFile: 1\_Response.txt (text/plain)&gt;&#125;</span><br><span class="hljs-string">è¯·æ±‚ä½“ä¸­çš„æ–‡ä»¶åˆ—è¡¨ï¼š&lt;MultiValueDict: &#123;&#x27;files&#x27;: [&lt;InMemoryUploadedFile: 1\_Request.txt (text/plain)&gt;, &lt;InMemoryUploadedFile: 1\_Response.txt (text/plain)&gt;]&#125;&gt;</span><br><span class="hljs-string">&#123;&#x27;ALLUSERSPROFILE&#x27;: &#x27;C:\\ProgramData&#x27;, &#x27;APPDATA&#x27;: &#x27;C:\\Users\\Luffy\\AppData\\Roaming&#x27;, çœç•¥&#125;</span><br><span class="hljs-string">NSFOCUS</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;è¯·æ±‚ä½“ï¼š<span class="hljs-subst">&#123;request.data&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;è¯·æ±‚ä½“è½¬å­—å…¸ï¼š<span class="hljs-subst">&#123;request.data.<span class="hljs-built_in">dict</span>()&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(&#123;request.data.<span class="hljs-built_in">dict</span>().get(<span class="hljs-string">&#x27;files&#x27;</span>)&#125;)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;è¯·æ±‚ä½“ä¸­çš„æ–‡ä»¶åˆ—è¡¨ï¼š<span class="hljs-subst">&#123;request.FILES&#125;</span>&#x27;</span>)<br><span class="hljs-comment"># è·å–è¯·æ±‚å¤´</span><br><span class="hljs-built_in">print</span>(request.\_request.META)<br><span class="hljs-comment"># è‡ªå®šä¹‰è¯·æ±‚å¤´ è¦ç”¨HTTP\_å¤§å†™å•è¯è·å–</span><br><span class="hljs-built_in">print</span>(request.\_request.META.get(<span class="hljs-string">&#x27;HTTP\_COMPANY&#x27;</span>))<br><span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;msg&#x27;</span>: <span class="hljs-string">&#x27;ok&#x27;</span>&#125;)<br></code></pre></td></tr></table></figure><p>è¯·æ±‚ä¸­å¾ˆå¤šé”®å€¼å¯¹çš„æ•°æ®ç±»å‹å¹¶ä¸æ˜¯ç”¨çš„Pythonçš„å­—å…¸ï¼Œæ‰€ä»¥éœ€è¦è·å–å€¼çš„æ—¶å€™è¦è½¬ä¸ºå­—å…¸å†è·å–</p><h2 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h2><p><code>Response(data, status=None, template_name=None, headers=None, content_type=None)</code></p><p>è¿”å›çš„æ¨¡æ¿å¦‚ä¸Šï¼Œä¸¾ä¸ªä¾‹å­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">return</span> Response(data=serializer.data,status=status.HTTP\_201\_CREATED,headers=&#123;<span class="hljs-string">&#x27;company&#x27;</span>:<span class="hljs-string">&#x27;NSFOCUS&#x27;</span>&#125;,content\_<span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;application/json&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ¯ä¸ªå›ºå®šçš„ï¼ŒçŸ¥é“é‡Œé¢éœ€è¦ä¼ çš„å‚æ•°å³å¯</p><h1 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h1><p>åœ¨å¼€ç¯‡ä¹Ÿå·²ç»è¯´åˆ°äº†å„ä¸ªè§†å›¾ç±»çš„åŸºæœ¬å†…å®¹ï¼Œç›´æ¥ä¸Šä»£ç ï¼š</p><h2 id="APIView"><a href="#APIView" class="headerlink" title="APIView"></a>APIView</h2><p><code>url.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">path(<span class="hljs-string">&#x27;stu3/&lt;int:pk&gt;/&#x27;</span>,TeacherInfoAPIView.<span class="hljs-keyword">as</span>\_view()), <span class="hljs-comment"># å•ä¸ª</span><br>path(<span class="hljs-string">&#x27;stu3/&#x27;</span>,TeacherListAPIView.<span class="hljs-keyword">as</span>\_view()), <span class="hljs-comment"># å¤šä¸ª</span><br></code></pre></td></tr></table></figure><p><code>views.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherListAPIView</span>(<span class="hljs-title class_ inherited__">APIView</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;APIViewä¸æ”¯æŒè‡ªå®šä¹‰æ–¹æ³•ï¼Œåªæ”¯æŒget post put deleteçš„httpsè¯·æ±‚&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self,request</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">è·å–list</span><br><span class="hljs-string">:param request:</span><br><span class="hljs-string">:return:</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>teacher = Teacher.objects.<span class="hljs-built_in">all</span>()<br>serializer = TeacherModelSerializer(instance=teacher, many=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">return</span> Response(data=serializer.data, status=status.HTTP\_200\_OK)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self,request</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">æ–°å¢æ•°æ®</span><br><span class="hljs-string">:param request:</span><br><span class="hljs-string">:return:</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>serializer = TeacherModelSerializer(data=request.data.<span class="hljs-built_in">dict</span>())<br>serializer.<span class="hljs-keyword">is</span>\_valid(<span class="hljs-keyword">raise</span>\_exception=<span class="hljs-literal">True</span>)<br>serializer.save()<br><span class="hljs-keyword">return</span> Response(data=serializer.data, status=status.HTTP\_201\_CREATED)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherInfoAPIView</span>(<span class="hljs-title class_ inherited__">APIView</span>):<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self,request,pk</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;æ ¹æ®idæŸ¥è¯¢è€å¸ˆä¿¡æ¯&#x27;&#x27;&#x27;</span><br>teacher = Teacher.objects.get(pk=pk)<br>serializer = TeacherModelSerializer(instance=teacher)<br><span class="hljs-keyword">return</span> Response(data=serializer.data, status=status.HTTP\_200\_OK)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">put</span>(<span class="hljs-params">self,request,pk</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;æ ¹æ®idæ›´æ–°&#x27;&#x27;&#x27;</span><br>data = request.data.<span class="hljs-built_in">dict</span>()<br>teacher = Teacher.objects.get(pk=pk)<br>serializer = TeacherModelSerializer(instance=teacher,data=data)<br>serializer.<span class="hljs-keyword">is</span>\_valid(<span class="hljs-keyword">raise</span>\_exception=<span class="hljs-literal">True</span>)<br>serializer.save()<br><span class="hljs-keyword">return</span> Response(data=serializer.data, status=status.HTTP\_200\_OK)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">self,request,pk</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;æ ¹æ®idåˆ é™¤ï¼Œè¿™é‡Œç›´æ¥åˆ äº†ï¼Œå› ä¸ºæ•°æ®åº“ä¸­æ²¡æœ‰isDeletedå­—æ®µ&#x27;&#x27;&#x27;</span><br>data = request.data.<span class="hljs-built_in">dict</span>()<br>teacher = Teacher.objects.get(pk=pk)<br>teacher.delete()<br><span class="hljs-keyword">return</span> Response(status=status.HTTP\_200\_OK)<br></code></pre></td></tr></table></figure><h2 id="ViewSet"><a href="#ViewSet" class="headerlink" title="ViewSet"></a>ViewSet</h2><p><code>url.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">path(<span class="hljs-string">&#x27;stu4&#x27;</span>,TeacherViewSet.<span class="hljs-keyword">as</span>\_view(actions=&#123;<span class="hljs-string">&#x27;get&#x27;</span>:<span class="hljs-string">&#x27;list&#x27;</span>,<br><span class="hljs-string">&#x27;post&#x27;</span>:<span class="hljs-string">&#x27;add&#x27;</span>,<br>&#125;)),<br>path(<span class="hljs-string">&#x27;stu4/&lt;int:pk&gt;/&#x27;</span>, TeacherViewSet.<span class="hljs-keyword">as</span>\_view(actions=&#123;<span class="hljs-string">&#x27;get&#x27;</span>: <span class="hljs-string">&#x27;get\_teacherById&#x27;</span>,<br>&#125;)),<br></code></pre></td></tr></table></figure><p><code>view.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherViewSet</span>(<span class="hljs-title class_ inherited__">ViewSet</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">æ²¡æœ‰ç»§æ‰¿æ‹“å±•ç±»ï¼Œä¸šåŠ¡é€»è¾‘è¿˜å¾—è‡ªå·±å»å†™ï¼Œæä¾›actionå‚æ•°ï¼Œè¿›è¡Œè§†å›¾å’Œè·¯ç”± çš„ç»‘å®šï¼Œ</span><br><span class="hljs-string">ä¸å†ä½¿ç”¨httpè¯·æ±‚ä½œä¸ºè§†å›¾æ–¹æ³• get post put delete å¯ä»¥è‡ªå·±æŒ‡å®šè·¯ç”±å’Œæ–¹æ³•ç»‘å®šï¼Œ</span><br><span class="hljs-string">å®ç°æŠŠå…³äºä¸€ä¸ªæ¨¡å‹çš„æ“ä½œéƒ½å†™åœ¨ä¸€ä¸ªç±»é‡Œ</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">list</span>(<span class="hljs-params">self,request</span>):<br>teacher = Teacher.objects.<span class="hljs-built_in">all</span>()<br>serializer = TeacherModelSerializer(instance=teacher, many=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">return</span> Response(data=serializer.data, status=status.HTTP\_200\_OK)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self,request</span>):<br>serializer = TeacherModelSerializer(data=request.data.<span class="hljs-built_in">dict</span>())<br>serializer.<span class="hljs-keyword">is</span>\_valid(<span class="hljs-keyword">raise</span>\_exception=<span class="hljs-literal">True</span>)<br>serializer.save()<br><span class="hljs-keyword">return</span> Response(data=serializer.data, status=status.HTTP\_201\_CREATED)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>\_teacherById(<span class="hljs-variable language_">self</span>,request,pk):<br><span class="hljs-string">&#x27;&#x27;&#x27;æ ¹æ®idæŸ¥è¯¢è€å¸ˆä¿¡æ¯&#x27;&#x27;&#x27;</span><br>teacher = Teacher.objects.get(pk=pk)<br>serializer = TeacherModelSerializer(instance=teacher)<br><span class="hljs-keyword">return</span> Response(data=serializer.data, status=status.HTTP\_200\_OK)<br></code></pre></td></tr></table></figure><p>å†™äº†å‡ ä¸ªï¼Œå°±æ˜¯å¯ä»¥è‡ªå®šä¹‰å‡½æ•°æ–¹æ³•äº†</p><h2 id="GenericViewSet"><a href="#GenericViewSet" class="headerlink" title="GenericViewSet"></a>GenericViewSet</h2><p>å¯ä»¥æŠŠæˆ‘ä»¬ç»å¸¸å†™çš„æ¨¡å‹å’Œåºåˆ—åŒ–å™¨ä»£ç æŠ½å–å‡ºæ¥</p><p><code>url.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">path(<span class="hljs-string">&#x27;stu5&#x27;</span>, TeacherGenericViewSet.<span class="hljs-keyword">as</span>\_view(actions=&#123;<span class="hljs-string">&#x27;get&#x27;</span>: <span class="hljs-string">&#x27;list&#x27;</span>,<br><span class="hljs-string">&#x27;post&#x27;</span>: <span class="hljs-string">&#x27;create&#x27;</span>,<br>&#125;)),<br>path(<span class="hljs-string">&#x27;stu5/&lt;int:pk&gt;/&#x27;</span>, TeacherGenericViewSet.<span class="hljs-keyword">as</span>\_view(actions=&#123;<span class="hljs-string">&#x27;get&#x27;</span>: <span class="hljs-string">&#x27;get\_one&#x27;</span>,<br>&#125;)),<br></code></pre></td></tr></table></figure><p><code>view.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherGenericViewSet</span>(<span class="hljs-title class_ inherited__">GenericViewSet</span>):<br>queryset = Teacher.objects.<span class="hljs-built_in">all</span>()<br>serializer\_<span class="hljs-keyword">class</span> = TeacherModelSerializer<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">list</span>(<span class="hljs-params">self, request</span>):<br>serializer = <span class="hljs-variable language_">self</span>.get\_serializer(instance=<span class="hljs-variable language_">self</span>.get\_queryset(), many=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">return</span> Response(serializer.data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">self, request</span>):<br>serializer = <span class="hljs-variable language_">self</span>.get\_serializer(data=request.data)<br>serializer.<span class="hljs-keyword">is</span>\_valid(<span class="hljs-keyword">raise</span>\_exception=<span class="hljs-literal">True</span>)<br>serializer.save()<br><span class="hljs-keyword">return</span> Response(serializer.data, status=status.HTTP\_201\_CREATED)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>\_one(<span class="hljs-variable language_">self</span>, request, pk):<br><span class="hljs-keyword">try</span>:<br>instance = <span class="hljs-variable language_">self</span>.get\_<span class="hljs-built_in">object</span>()<br><span class="hljs-comment"># å®ä¾‹åŒ–åºåˆ—åŒ–å™¨å¯¹è±¡</span><br>serializer = <span class="hljs-variable language_">self</span>.get\_serializer(instance=instance)<br><span class="hljs-keyword">return</span> Response(data=serializer.data, status=status.HTTP\_200\_OK)<br><span class="hljs-keyword">except</span> Student.DoesNotExist:<br><span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;msg&#x27;</span>: <span class="hljs-string">&#x27;è€å¸ˆä¸å­˜åœ¨&#x27;</span>&#125;, status=status.HTTP\_404\_NOT\_FOUND)<br></code></pre></td></tr></table></figure><h2 id="ModelViewSet"><a href="#ModelViewSet" class="headerlink" title="ModelViewSet"></a>ModelViewSet</h2><p>å®ç°äº†äº”ä¸ªæ‹“å±•ç±»ï¼Œæ‰€ä»¥å†™ä¸¤è¡Œä»£ç å³å¯æœ‰5ä¸ªhttpæ¥å£</p><p><code>url.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest\_framework.routers <span class="hljs-keyword">import</span> DefaultRouter,SimpleRouter<br>router = DefaultRouter()<br><span class="hljs-comment"># æ³¨å†Œè¯•å›¾ï¼ˆè®¿é—®å‰ç¼€ï¼Œè§†å›¾é›†ï¼Œè°ƒç”¨åˆ«åï¼‰</span><br>router.register(prefix=<span class="hljs-string">&#x27;s9&#x27;</span>,viewset=StudentMixinViewSet,basename=<span class="hljs-string">&#x27;s9&#x27;</span>)<br><span class="hljs-comment"># è·¯ç”±åˆ—è¡¨</span><br>urlpatterns += router.urls<br></code></pre></td></tr></table></figure><p><code>view.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentModelViewSet</span>(<span class="hljs-title class_ inherited__">ModelViewSet</span>):<br>queryset = Student.objects.<span class="hljs-built_in">all</span>()<br>serializer\_<span class="hljs-keyword">class</span> = StudentModelSerializer<br></code></pre></td></tr></table></figure><h2 id="ReadOnlyModelViewSet"><a href="#ReadOnlyModelViewSet" class="headerlink" title="ReadOnlyModelViewSet"></a>ReadOnlyModelViewSet</h2><p>åªèƒ½è¯»</p><p><code>url.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest\_framework.routers <span class="hljs-keyword">import</span> DefaultRouter,SimpleRouter<br>router = DefaultRouter()<br><span class="hljs-comment"># æ³¨å†Œè¯•å›¾ï¼ˆè®¿é—®å‰ç¼€ï¼Œè§†å›¾é›†ï¼Œè°ƒç”¨åˆ«åï¼‰</span><br>router.register(prefix=<span class="hljs-string">&#x27;stu6&#x27;</span>,viewset=StudentModelViewSet,basename=<span class="hljs-string">&#x27;stu6&#x27;</span>)<br>router.register(prefix=<span class="hljs-string">&#x27;stu7&#x27;</span>,viewset=StudentReadOnlyModelViewSet,basename=<span class="hljs-string">&#x27;stu7&#x27;</span>)<br><span class="hljs-comment"># è·¯ç”±åˆ—è¡¨</span><br>urlpatterns += router.urls<br></code></pre></td></tr></table></figure><p><code>view.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">ViewSet</span><br><span class="hljs-string">GenericViewSet</span><br><span class="hljs-string">ModelViewSet = GenericViewSet + ListModelMixin + CreateModelMixin + UpdateModelMixin+</span><br><span class="hljs-string">RetrieveModelMixin + DestoryModelMixin</span><br><span class="hljs-string">ReadOnlyModelViewSet = GenericViewSet + ListModelMixin + RetrieveModelMixin</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentReadOnlyModelViewSet</span>(<span class="hljs-title class_ inherited__">ReadOnlyModelViewSet</span>):<br>queryset = Student.objects.<span class="hljs-built_in">all</span>()<br>serializer\_<span class="hljs-keyword">class</span> = StudentModelSerializer<br></code></pre></td></tr></table></figure><h1 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h1><p>RESTæ¡†æ¶æ·»åŠ äº†å¯¹è‡ªåŠ¨URLè·¯ç”±åˆ°Djangoçš„æ”¯æŒï¼Œå¹¶ä¸ºä½ æä¾›äº†ä¸€ç§ç®€å•ã€å¿«é€Ÿå’Œä¸€è‡´çš„æ–¹å¼æ¥å°†è§†å›¾é€»è¾‘è¿æ¥åˆ°ä¸€ç»„URLã€‚</p><p>åœ¨ä¸Šé¢ç¼–å†™è§†å›¾ç”¨ä¾‹çš„å·²ç»å†™åˆ°äº†ä¸¤ç§è·¯ç”±ï¼Œç¬¬ä¸€ç§å’ŒDjangoç±»ä¼¼ï¼Œä½†æ˜¯é€šè¿‡ <code>as_view()</code>ï¼Œè‡ªé€‚åº”è·¯ç”±ï¼ˆæˆ‘è¿™æ ·ç†è§£çš„ï¼Œä¸æ¸…æ¥šå¯¹ä¸å¯¹ï¼‰ï¼Œå°±æ˜¯å¯ä»¥æ ¹æ®è¯•å›¾å±‚çš„httpæ¥å£è‡ªå·±ç”Ÿæˆè·¯ç”±ï¼Œåœ¨ <code>APIView</code>ä¸­ä¸éœ€è¦å†™å‚æ•°ã€‚ä½†åœ¨GenericViewSetä¸­æˆ–è€…ç»§æ‰¿äº†GenericViewSetçš„è§†å›¾æ¨¡æ¿ä¸­ï¼Œä¸ä»…ä»…æœ‰httpå€Ÿå£ï¼Œæ­¤æ—¶å°±å¯ä»¥æ·»åŠ å‚æ•°actionæ¥è¿›è¡Œè§†å›¾å’Œè·¯ç”±çš„åŒ¹é…ã€‚</p><p>å¯¹äºModelViewSetå’ŒReadOnlyModelViewSetå¯ä»¥ä½¿ç”¨DefaultRouterå’ŒSimpleRouterï¼ŒDefaultRouterå’ŒSimpleRouterä¸¤è€…ç®€å•çš„åŒºåˆ«å°±æ˜¯å‰è€…æä¾›APIé¡µé¢ï¼ŒSimpleRouteråè€…åªæ˜¯ç®€å•çš„æ•°æ®è¿”å›ã€‚</p><p>å…³äºDRFè·¯ç”±çš„å†™æ³•ï¼Œè¿˜æœ‰è‡ªå®šä¹‰è·¯ç”±ç­‰ç­‰ï¼Œå¯ä»¥å‚è€ƒä¸­æ–‡å®˜æ–¹æ–‡æ¡£</p><p><a href="https://q1mi.github.io/Django-REST-framework-documentation/api-guide/routers_zh/">Django REST framework ä¸­æ–‡æ–‡æ¡£</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>DRF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django Rest Frameworkåºåˆ—åŒ–å™¨</title>
    <link href="/2022/08/21/Django-Rest-Framework%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8/"/>
    <url>/2022/08/21/Django-Rest-Framework%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<p>åœ¨è¿”å›jsonæ•°æ®æ—¶ï¼Œæ•´åˆDRFåå¹¶æ²¡æœ‰å–å‡ºQuerySetä¸­çš„æ•°æ®ï¼Œå†è½¬å­—å…¸ï¼Œä¹Ÿèƒ½ç›´æ¥è¿”å›jsonï¼Œè¿™å°±æ˜¯åºåˆ—åŒ–å™¨çš„åŠŸåŠ³ã€‚</p><ul><li>åºåˆ—åŒ–ï¼Œåºåˆ—åŒ–å™¨ä¼šæŠŠæ¨¡å‹å¯¹è±¡è½¬æ¢æˆå­—å…¸ï¼Œç»è¿‡responseä»¥åå˜æˆjsonå­—ç¬¦ä¸²</li><li>ååºåˆ—åŒ–,æŠŠå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®,ç»è¿‡requestä»¥åå˜æˆå­—å…¸,åºåˆ—åŒ–å™¨å¯ä»¥æŠŠå­—å…¸è½¬æˆæ¨¡å‹</li><li>ååºåˆ—åŒ–,å®Œæˆæ•°æ®æ ¡éªŒåŠŸèƒ½</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentModelSerializer</span>(serializers.ModelSerializer):<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>model = Student<br><span class="hljs-comment"># åºåˆ—åŒ–å­—æ®µ</span><br><span class="hljs-comment"># å…¨éƒ¨</span><br>fields = <span class="hljs-string">&#x27;\_\_all\_\_&#x27;</span><br><span class="hljs-comment"># ä¸€ä¸ªä¸€ä¸ªå†™</span><br><span class="hljs-comment"># fields =[&#x27;id&#x27;,&#x27;name&#x27;]</span><br></code></pre></td></tr></table></figure><p>studentåºåˆ—åŒ–å™¨ç»§æ‰¿äº† <code>serializers.ModelSerializer</code>ï¼Œè¿™æ˜¯è½¬ä¸ºæ•°æ®åº“ä¸­çš„è¡¨è®¾è®¡çš„ï¼Œä¸€ä¸€å¯¹åº”ï¼Œå¸®æˆ‘ä»¬é‡å†™äº†create()å’Œupdate()æ–¹æ³•ï¼Œæ‰€ä»¥ä¸æ•°æ®åº“ä¸­çš„è¡¨ä¸€ä¸€å¯¹åº”çš„å­—æ®µæˆ‘ä»¬å¯ä»¥ç›´æ¥ç»§æ‰¿è¯¥ç±»ï¼Œç®€åŒ–ä»£ç </p><p>å¯¹äºä¸æ˜¯è¡¨å¯¹åº”çš„å­—æ®µï¼Œæˆ‘ä»¬åˆ™éœ€è¦ç»§æ‰¿ <code>serializers.Serializer</code></p><h2 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h2><p><strong>ModelSerializer</strong></p><p>å®šä¹‰çš„åºåˆ—åŒ–å™¨ï¼Œç»§æ‰¿ <code>serializers.ModelSerializer</code>ï¼Œåœ¨é‡Œé¢å£°æ˜Metaç±»ï¼Œé€šè¿‡æŒ‡å®šå¯¹åº”çš„æ¨¡å‹ç±»å’Œåºåˆ—åŒ–å­—æ®µå³å¯å®Œæˆæœ€ç®€å•çš„åºåˆ—åŒ–å™¨ç¼–å†™ã€‚</p><p>å¯¹äºå•è¡¨æŸ¥è¯¢è¿™æ˜¯éå¸¸å¿«çš„ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯éœ€è¦åœ¨å¤šä¸ªè¡¨ä¹‹é—´è¿›è¡Œè”åˆæŸ¥è¯¢ã€‚æˆ‘ä»¬å¯¹modelè¿›è¡Œè¡¥å……ï¼Œè®¾è®¡å¤–é”®è¿›è¡Œçº¦æŸï¼Œæ–¹ä¾¿è”åˆæŸ¥è¯¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(models.Model):<br>SEX\_OPTION = (<br>(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;ä¿å¯†&#x27;</span>),<br>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>),<br>(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>),<br>)<br>name = models.CharField(<span class="hljs-built_in">max</span>\_length=<span class="hljs-number">20</span>,verbose\_name=<span class="hljs-string">&#x27;å§“å&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;å§“å&#x27;</span>)<br>age = models.SmallIntegerField(verbose\_name=<span class="hljs-string">&#x27;å¹´é¾„&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;å¹´é¾„&#x27;</span>)<br>sex = models.SmallIntegerField(choices=SEX\_OPTION,verbose\_name=<span class="hljs-string">&#x27;æ€§åˆ«&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;æ€§åˆ«ï¼Œ0-&gt;ä¿å¯†ï¼Œ1-&gt;ç”·ï¼Œ2-&gt;å¥³ï¼Œ&#x27;</span>)<br>classmate = models.CharField(db\_column=<span class="hljs-string">&#x27;classmate&#x27;</span>,<span class="hljs-built_in">max</span>\_length=<span class="hljs-number">13</span>,verbose\_name=<span class="hljs-string">&#x27;ç­çº§&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;ç­çº§&#x27;</span>)<br>description = models.TextField(null=<span class="hljs-literal">True</span>,blank=<span class="hljs-literal">True</span>,verbose\_name=<span class="hljs-string">&#x27;ä¸ªæ€§ç­¾å&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;ä¸ªæ€§ç­¾åï¼Œå¯ä»¥ä¸ºç©º&#x27;</span>)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>db\_table = <span class="hljs-string">&#x27;db\_student&#x27;</span><br>verbose\_name = <span class="hljs-string">&#x27;å­¦ç”Ÿä¿¡æ¯&#x27;</span><br>verbose\_name\_plural = verbose\_name<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Course</span>(models.Model):<br>name = models.CharField(<span class="hljs-built_in">max</span>\_length=<span class="hljs-number">52</span>,verbose\_name=<span class="hljs-string">&#x27;è¯¾ç¨‹åç§°&#x27;</span>)<br>teacher = models.ForeignKey(<span class="hljs-string">&#x27;Teacher&#x27;</span>,on\_delete=models.DO\_NOTHING,related\_name=<span class="hljs-string">&#x27;course&#x27;</span>,db\_constraint=<span class="hljs-literal">False</span>)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meat</span>:<br>db\_stable = <span class="hljs-string">&#x27;db\_course&#x27;</span><br><span class="hljs-keyword">def</span> \_\_<span class="hljs-built_in">str</span>\_\_(<span class="hljs-variable language_">self</span>):<br><span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.name<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span>(models.Model):<br>name = models.CharField(<span class="hljs-built_in">max</span>\_length=<span class="hljs-number">50</span>,verbose\_name=<span class="hljs-string">&#x27;å§“å&#x27;</span>)<br>sex = models.BooleanField(default=<span class="hljs-literal">False</span>)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>db\_table = <span class="hljs-string">&#x27;db\_teacher&#x27;</span><br><span class="hljs-keyword">def</span> \_\_<span class="hljs-built_in">str</span>\_\_(<span class="hljs-variable language_">self</span>):<br><span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.name<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Achievement</span>(models.Model):<br>score = models.DecimalField(default=<span class="hljs-number">0</span>,<span class="hljs-built_in">max</span>\_digits=<span class="hljs-number">4</span>,decimal\_places=<span class="hljs-number">1</span>,verbose\_name=<span class="hljs-string">&#x27;æˆç»©&#x27;</span>)<br>student = models.ForeignKey(Student,on\_delete=models.DO\_NOTHING,related\_name=<span class="hljs-string">&#x27;s\_achievement&#x27;</span>,db\_constraint=<span class="hljs-literal">False</span>)<br>course = models.ForeignKey(Course,on\_delete=models.DO\_NOTHING,related\_name=<span class="hljs-string">&#x27;c\_achievement&#x27;</span>,db\_constraint=<span class="hljs-literal">False</span>)<br>create\_time = models.DateTimeField(auto\_created=datetime.now)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>db\_table = <span class="hljs-string">&#x27;db\_achievement&#x27;</span><br><span class="hljs-keyword">def</span> \_\_<span class="hljs-built_in">str</span>\_\_(<span class="hljs-variable language_">self</span>):<br><span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.score<br></code></pre></td></tr></table></figure><p>é‡æ–°è¿›è¡Œæ¨¡å‹è¿ç§»å’Œæ•°æ®å¯¼å…¥ï¼Œå†™å…¥å‡ æ¡æµ‹è¯•æ•°æ®</p><p><strong>åŠŸèƒ½ç¼–å†™ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CourseModelSerializer</span>(serializers.ModelSerializer):<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>model = Course<br>fields = [<span class="hljs-string">&#x27;name&#x27;</span>]<br><span class="hljs-comment"># ç¬¬ä¸€ç§å¤–é”®æŸ¥ å¤–é¢å†™ä¸ªåºåˆ—åŒ–å™¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherCourseModelSerializer</span>(serializers.ModelSerializer):<br>course = CourseModelSerializer(many=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>model = Teacher<br>fields = [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;course&#x27;</span>]<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>\_teacher\_course(<span class="hljs-variable language_">self</span>,request):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">æŸ¥è¯¢è€å¸ˆä»£è¯¾ä¿¡æ¯</span><br><span class="hljs-string">:param request:</span><br><span class="hljs-string">:return:</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>teacher = Teacher.objects.<span class="hljs-built_in">all</span>()<br>serializer = TeacherCourseModelSerializer(instance=teacher,many=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">return</span> Response(data=serializer.data,status=status.HTTP\_200\_OK)<br></code></pre></td></tr></table></figure><p><a href="https://imgse.com/i/vyYvOe"><img src="https://s1.ax1x.com/2022/08/21/vyYvOe.png"></a></p><p>è¿™æ˜¯ç¬¬ä¸€ç§ï¼Œéœ€è¦å¤–é¢å†™ä¸ªåºåˆ—åŒ–å™¨ï¼Œä»£ç æ˜¾å¾—å¾ˆå†—ä½™ï¼Œç¬¬äºŒç§ç›´æ¥å†™é‡Œé¢ï¼Œç¬¬ä¸‰ç§æ˜¯æŒ‡æ˜åµŒå¥—æ·±åº¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherCourseModelSerializer</span>(serializers.ModelSerializer):<br><span class="hljs-comment"># ç¬¬ä¸€ç§</span><br><span class="hljs-comment"># course = CourseModelSerializer(many=True)</span><br><span class="hljs-comment"># ç¬¬äºŒç§ç›´æ¥åœ¨é‡Œé¢å†™</span><br><span class="hljs-comment"># course =serializers.CharField(source=&#x27;course.name&#x27;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>model = Teacher<br>fields = [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;course&#x27;</span>]<br><span class="hljs-comment"># ç¬¬ä¸‰ç§ å†™ä¸ªåµŒå¥—æ·±åº¦å³å¯</span><br>depth = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>ç¬¬å››ç§æ˜¯é€šè¿‡å¤–é”®æŒ‡æ˜æ·±åº¦ï¼Œç›´æ¥è®¿é—®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç¬¬å››ç§</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudenAchievementModelSerializer</span>(serializers.ModelSerializer):<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>model = Student<br><span class="hljs-comment"># s\_achievement å¤–é”®åç§°</span><br>fields = [<span class="hljs-string">&#x27;id&#x27;</span>,<span class="hljs-string">&#x27;name&#x27;</span>,<span class="hljs-string">&#x27;s\_achievement&#x27;</span>]<br>depth = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>è¿™å››ç§å®ç°çš„æ•ˆæœç±»ä¼¼ï¼Œéƒ½æœ‰å±‚å±‚åµŒå¥—ï¼Œä¸å¥½è¯†åˆ«çš„é—®é¢˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(models.Model):<br>SEX\_OPTION = (<br>(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;ä¿å¯†&#x27;</span>),<br>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>),<br>(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>),<br>)<br>name = models.CharField(<span class="hljs-built_in">max</span>\_length=<span class="hljs-number">20</span>,verbose\_name=<span class="hljs-string">&#x27;å§“å&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;å§“å&#x27;</span>)<br>age = models.SmallIntegerField(verbose\_name=<span class="hljs-string">&#x27;å¹´é¾„&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;å¹´é¾„&#x27;</span>)<br>sex = models.SmallIntegerField(choices=SEX\_OPTION,verbose\_name=<span class="hljs-string">&#x27;æ€§åˆ«&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;æ€§åˆ«ï¼Œ0-&gt;ä¿å¯†ï¼Œ1-&gt;ç”·ï¼Œ2-&gt;å¥³ï¼Œ&#x27;</span>)<br>classmate = models.CharField(db\_column=<span class="hljs-string">&#x27;classmate&#x27;</span>,<span class="hljs-built_in">max</span>\_length=<span class="hljs-number">13</span>,verbose\_name=<span class="hljs-string">&#x27;ç­çº§&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;ç­çº§&#x27;</span>)<br>description = models.TextField(null=<span class="hljs-literal">True</span>,blank=<span class="hljs-literal">True</span>,verbose\_name=<span class="hljs-string">&#x27;ä¸ªæ€§ç­¾å&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;ä¸ªæ€§ç­¾åï¼Œå¯ä»¥ä¸ºç©º&#x27;</span>)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>db\_table = <span class="hljs-string">&#x27;db\_student&#x27;</span><br>verbose\_name = <span class="hljs-string">&#x27;å­¦ç”Ÿä¿¡æ¯&#x27;</span><br>verbose\_name\_plural = verbose\_name<br><span class="hljs-keyword">def</span> \_\_<span class="hljs-built_in">str</span>\_\_(<span class="hljs-variable language_">self</span>):<br><span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.name<br><span class="hljs-meta">@property</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">achievement</span>(<span class="hljs-params">self</span>):<br>queryset = <span class="hljs-variable language_">self</span>.s\_achievement.<span class="hljs-built_in">all</span>()<br>ret = [&#123;<span class="hljs-string">&#x27;score&#x27;</span>: item.score, <span class="hljs-string">&#x27;course&#x27;</span>: item.course.name, <span class="hljs-string">&#x27;teacher&#x27;</span>: item.course.teacher.name&#125; <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span><br>queryset]<br><span class="hljs-keyword">return</span> ret<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç¬¬äº”ç§æ–¹æ³• è‡ªå®šä¹‰å±æ€§ æ›´åŠ çµæ´» ä¸åƒä¸Šé¢åµŒå¥—å¤ªå¤šäº† å¥—å¨ƒ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentAchievement2ModelSerializer</span>(serializers.ModelSerializer):<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>model = Student<br>fields = [<span class="hljs-string">&#x27;id&#x27;</span>,<span class="hljs-string">&#x27;name&#x27;</span>,<span class="hljs-string">&#x27;achievement&#x27;</span>]<br></code></pre></td></tr></table></figure><p><a href="https://imgse.com/i/vyYzeH"><img src="https://s1.ax1x.com/2022/08/21/vyYzeH.png"></a></p><h2 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h2><p><strong>Serializer</strong></p><p>Serializerçš„æ•°æ®å¹¶ä¸æ˜¯æ¥è‡ªæ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨è¯¥ç±»æ—¶éœ€è¦è‡ªå·±å»å£°æ˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å£°æ˜åºåˆ—åŒ–å™¨ï¼Œæ‰€æœ‰çš„åºåˆ—åŒ–å™¨éƒ½è¦ç›´æ¥æˆ–è€…é—´æ¥ç»§æ‰¿äºSerializer</span><br><span class="hljs-comment"># å…¶ä¸­ï¼ŒModelSerializeræ˜¯Serializerçš„å­ç±»ï¼ŒModerlSerializeråœ¨Serializerçš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä»£ç ç®€åŒ–</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentSerializer</span>(serializers.Serializer):<br><span class="hljs-comment"># å­¦ç”Ÿåºåˆ—è½¬æ¢å™¨</span><br><span class="hljs-comment"># 1.éœ€è¦è¿›è¡Œæ•°æ®è½¬æ¢çš„å­—æ®µ</span><br><span class="hljs-built_in">id</span> = serializers.IntegerField(read\_only=<span class="hljs-literal">True</span>) <span class="hljs-comment"># ç”¨æˆ·æäº¤æ•°æ®è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼Œåºåˆ—åŒ–å™¨è¿›è¡Œåºåˆ—åŒ–è½¬æ¢æ•°æ®ç»™å®¢æˆ·ç«¯æ—¶æ‰è½¬ç»™å®¢æˆ·ç«¯</span><br>name = serializers.CharField(<span class="hljs-built_in">max</span>\_length=<span class="hljs-number">20</span>,required=<span class="hljs-literal">True</span>)<br>classmate = serializers.CharField(<span class="hljs-built_in">max</span>\_length=<span class="hljs-number">4</span>,required=<span class="hljs-literal">True</span>)<br>age = serializers.IntegerField()<br>sex = serializers.IntegerField(validators= [check\_sex,])<br>description = serializers.CharField(required=<span class="hljs-literal">False</span>,default=<span class="hljs-string">&#x27;è¿™å®¶ä¼™å¾ˆæ‡’ï¼Œä»€ä¹ˆä¹Ÿæ²¡å†™ï¼&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å’ŒModelSerializerç±»ä¼¼ï¼Œå› ä¸ºModelSerializerçš„æ•°æ®æ¥è‡ªæ•°æ®åº“ï¼Œæ‰€ä»¥ç›´æ¥ä¸modelå…³è”å³å¯ï¼Œä½†Serializerçš„æ•°æ®å¹¶ä¸æ˜¯æ¥è‡ªæ•°æ®åº“ï¼Œéœ€è¦æ‰‹åŠ¨å£°æ˜ã€‚</p><p>åœ¨è¿›è¡Œæ·»åŠ å’Œæ›´æ–°æ•°æ®æ“ä½œæ—¶ï¼ŒModelSerializerå·²ç»å¸®æˆ‘ä»¬å®ç°äº†create()å’Œupdate()æ–¹æ³•ï¼Œä½†Serializerå¹¶æ²¡æœ‰å®ç°ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å®ç°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#4. ç¼–å†™æ¨¡å‹çš„æ·»åŠ å’Œæ›´æ–°ä»£ç </span><br><span class="hljs-comment"># æ·»åŠ æ“ä½œ save() è¦å®ç°save</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">self, validated\_data</span>):<br><span class="hljs-comment"># æ·»åŠ æ•°æ®çš„å®ç°æ–¹æ³•</span><br>student = Student.objects.create(\*\*validated\_data)<br><span class="hljs-comment"># è¦æ˜¯å­—æ®µå¤šäº†ï¼Œä¸åŒ¹é…ï¼Œå°±è¦æ‹¿å‡ºæ¥</span><br><span class="hljs-comment"># student = Student.objects.create(</span><br><span class="hljs-comment"># name = validated\_data.get(&#x27;name&#x27;)</span><br><span class="hljs-comment"># .....</span><br><span class="hljs-comment"># )</span><br><span class="hljs-comment"># è¿”å›æ·»åŠ åçš„æ¨¡å‹</span><br><span class="hljs-keyword">return</span> student<br><span class="hljs-comment"># æ›´æ–°æ“ä½œè¦å®ç°update()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self, instance, validated\_data</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">:param instance: æ›´æ–°çš„æ¨¡å‹å¯¹è±¡æ•°æ®</span><br><span class="hljs-string">:param validated\_data: æ–°æ•°æ®</span><br><span class="hljs-string">:return:</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">if</span> validated\_data.get(<span class="hljs-string">&#x27;name&#x27;</span>):<br>instance.name = validated\_data.get(<span class="hljs-string">&#x27;name&#x27;</span>)<br><span class="hljs-keyword">if</span> validated\_data.get(<span class="hljs-string">&#x27;age&#x27;</span>):<br>instance.age = validated\_data.get(<span class="hljs-string">&#x27;age&#x27;</span>)<br><span class="hljs-keyword">if</span> validated\_data.get(<span class="hljs-string">&#x27;sex&#x27;</span>):<br>instance.sex = validated\_data.get(<span class="hljs-string">&#x27;sex&#x27;</span>)<br><span class="hljs-keyword">if</span> validated\_data.get(<span class="hljs-string">&#x27;classmate&#x27;</span>):<br>instance.classmate = validated\_data.get(<span class="hljs-string">&#x27;classmate&#x27;</span>)<br><span class="hljs-keyword">if</span> validated\_data.get(<span class="hljs-string">&#x27;description&#x27;</span>):<br>instance.description = validated\_data.get(<span class="hljs-string">&#x27;description&#x27;</span>)<br>instance.save()<br><span class="hljs-keyword">return</span> instance<br></code></pre></td></tr></table></figure><h2 id="æ•°æ®æ ¡éªŒ"><a href="#æ•°æ®æ ¡éªŒ" class="headerlink" title="æ•°æ®æ ¡éªŒ"></a>æ•°æ®æ ¡éªŒ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 3.éªŒè¯ä»£ç </span><br><span class="hljs-comment"># 3.1 å¯¹å•ä¸ªå­—æ®µè¿›è¡ŒéªŒè¯</span><br><span class="hljs-comment"># æ ¼å¼ï¼š æ–¹æ³•åå¿…é¡»ä»¥â€˜valiidate\_&lt;å­—æ®µå&gt;â€™ä½œä¸ºéªŒè¯æ–¹æ³•åï¼Œå¦åˆ™is\_validæ‰¾ä¸åˆ°</span><br><span class="hljs-comment"># éªŒè¯æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œis\_validä¼šæŠŠå½“å‰å®¢æˆ·ç«¯æäº¤çš„å­—æ®µä¼ é€’ç»™éªŒè¯æ–¹æ³•ï¼Œç„¶åæ ¡éªŒ</span><br><span class="hljs-comment"># éªŒè¯æ–¹æ³•æŠŠè¿”å›å€¼å›ä¼ ç»™åºåˆ—åŒ–ï¼Œå¦åˆ™æ•°æ®ä¼šä¸¢å¤±</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">validate</span>\_name(<span class="hljs-variable language_">self</span>,data):<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;éªŒè¯å‚æ•°ï¼š<span class="hljs-subst">&#123;data&#125;</span>&#x27;</span>)<br><span class="hljs-keyword">if</span> data == <span class="hljs-string">&#x27;Python&#x27;</span>:<br><span class="hljs-comment"># æŠ›å¼‚å¸¸</span><br><span class="hljs-keyword">raise</span> serializers.ValidationError(code=<span class="hljs-string">&#x27;name&#x27;</span>,detail=<span class="hljs-string">&#x27;å½“å‰è¾“å…¥å­˜åœ¨æ•æ„Ÿæ•°æ®&#x27;</span>)<br><span class="hljs-keyword">return</span> data<br><span class="hljs-comment"># 3.2 å¯¹å¤šä¸ªå­—æ®µçš„æ•°æ®è¿›è¡ŒéªŒè¯</span><br><span class="hljs-comment"># æ ¼å¼ï¼šä¸€ä¸ªåºåˆ—åŒ–å™¨åªèƒ½æœ‰0or1ä¸ªå¤šå­—æ®µæ ¡éªŒï¼Œæ–¹æ³•åä½äº</span><br><span class="hljs-comment"># æ–¹æ³•åå¿…é¡»å« validate(self,data)ï¼Œå¦åˆ™is\_validæ‰¾ä¸åˆ°</span><br><span class="hljs-comment"># æ­¥éª¤ï¼šæ¥æ”¶å‚æ•° éªŒè¯ è¿”å›</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params">self, attrs</span>):<br>age = attrs.get(<span class="hljs-string">&#x27;age&#x27;</span>)<br>classmate = attrs.get(<span class="hljs-string">&#x27;classmate&#x27;</span>)<br><span class="hljs-keyword">if</span> (age &lt; <span class="hljs-number">20</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">str</span>(classmate).startswith(<span class="hljs-string">&#x27;5&#x27;</span>):<br><span class="hljs-keyword">raise</span> serializers.ValidationError(<span class="hljs-string">&#x27;å¯¹ä¸èµ·ï¼å¹´é¾„20ä»¥ä¸‹ä¸èƒ½åŠ å…¥åˆ°5å­—å¼€å¤´çš„ç­çº§ä¸­&#x27;</span>)<br><span class="hljs-keyword">return</span> attrs<br></code></pre></td></tr></table></figure><p>åšæ ¡éªŒçš„æ•°æ®æ˜¯ä»å®¢æˆ·ç«¯å‘æ¥çš„ï¼Œæœ‰çš„å¹¶ä¸å’Œæ•°æ®åº“ä¸­å­—æ®µä¸€ä¸€å¯¹åº”ï¼Œæ‰€ä»¥å°±ä¸èƒ½ç”¨modelå£°æ˜çš„çº¦æŸå»æ§åˆ¶äº†ï¼Œéœ€è¦æ‰‹åŠ¨åˆ¤æ–­ã€‚</p><h2 id="åºåˆ—åŒ–å™¨çš„ä½¿ç”¨"><a href="#åºåˆ—åŒ–å™¨çš„ä½¿ç”¨" class="headerlink" title="åºåˆ—åŒ–å™¨çš„ä½¿ç”¨"></a>åºåˆ—åŒ–å™¨çš„ä½¿ç”¨</h2><p>å½“ç¼–å†™å®Œåºåˆ—åŒ–å™¨åï¼Œå¯ä»¥åœ¨è§†å›¾å±‚æ˜¯ç›´æ¥è§†å›¾</p><p><strong>æ›´æ–°å’Œåˆ é™¤</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">student = Student.objects.get(pk=pk)<br>serializer = StudentModelSerializer(instance=student,data=params)<br>serializer.<span class="hljs-keyword">is</span>\_valid(<span class="hljs-keyword">raise</span>\_exception=<span class="hljs-literal">True</span>)<br>serializer.save()<br></code></pre></td></tr></table></figure><p>è¿™æ®µæ˜¯æ›´æ–°studentçš„ä»£ç ï¼Œé€šè¿‡æ¥å—çš„idå»æŸ¥è¯¢åŸä¿¡æ¯ï¼Œç„¶åæŠŠåŸä¿¡æ¯å’Œå®¢æˆ·ç«¯æäº¤çš„ä¿¡æ¯æ”¾å…¥åºåˆ—åŒ–å™¨ï¼Œ<code>instance</code>ä¼ å…¥æ•°æ®åº“æŸ¥åˆ°çš„æ•°æ®ï¼Œ<code>data</code>ä¼ å…¥å®¢æˆ·ç«¯æäº¤çš„ä¿¡æ¯ï¼Œ<code>is_valid</code>è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œ<code>raise_exception=True</code>æ˜¯è®¾ç½®æŠ›å‡ºå¼‚å¸¸ï¼Œæœ€åè°ƒç”¨åºåˆ—åŒ–å™¨çš„<code>save</code>ä¿å­˜æ•°æ®ã€‚</p><p>å¯¹äºåˆ é™¤æ“ä½œï¼Œå¾ˆå¤šæ—¶å€™å¹¶ä¸æ˜¯åœ¨æ•°æ®åº“ä¸­æŠŠæ•°æ®ç»™åˆ é™¤æ‰ï¼Œç›¸åæ˜¯ä¿®æ”¹<code>IsDeleted</code>çš„å€¼ï¼Œä¸æ›´æ–°æ“ä½œç±»ä¼¼</p><p><strong>æŸ¥è¯¢listå’Œæ ¹æ®IDæŸ¥è¯¢</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">teacher = Teacher.objects.<span class="hljs-built_in">all</span>()<br>serializer = TeacherCourseModelSerializer(instance=teacher,many=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>éœ€è¦åœ¨æ”¾å…¥åºåˆ—åŒ–å™¨çš„æ—¶å€™ä¼ å…¥ <code>many=True</code>ï¼Œå†…éƒ¨ä¼šè°ƒç”¨å¾ªç¯è¿”å›æ‰€æœ‰æŸ¥è¯¢åˆ°çš„æ•°æ®</p><p>æ ¹æ®IDæŸ¥è¯¢æŸå•ä¸ªæ•°æ®ï¼Œä¸ä¼  <code>many</code>å³å¯ï¼Œé»˜è®¤æ˜¯ <code>False</code></p><p><strong>æ·»åŠ æ“ä½œ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">param = request.data.dict()<br>serializer = TeacherModelSerializer(data=param)<br>serializer.is\_valid(raise\_exception=True)<br>serializer.save()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>DRF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django Rest Frameworkå…¥é—¨</title>
    <link href="/2022/08/21/Django-Rest-Framework%E5%85%A5%E9%97%A8/"/>
    <url>/2022/08/21/Django-Rest-Framework%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<p>Pythonåº”ç”¨éå¸¸å¹¿æ³›ï¼Œäººå·¥æ™ºèƒ½é¢†åŸŸã€è‡ªåŠ¨åŒ–ã€Webå¼€å‘ä¸­éƒ½æœ‰ç€ä¸é”™çš„ç”Ÿæ€æ”¯æŒã€‚</p><p>åœ¨Webå¼€å‘é¢†åŸŸï¼ŒDjangå’ŒFlaskä½œä¸ºç›®å‰ä¸»æµçš„Webæ¡†æ¶ç¤¾åŒºçƒ­åº¦éå¸¸é«˜ï¼ŒDjangoæ¯”Flaskä½“ç§¯å¤§å¾ˆå¤šï¼Œå¯ä»¥æ­å»ºå¤§å‹çš„Webåº”ç”¨æœåŠ¡å™¨ï¼Œæ‰€ä»¥æœ€è¿‘ä¹Ÿåœ¨å­¦è¿™ä¸ªæ¡†æ¶ã€‚</p><p>å…¶å®Djangoä¸œè¥¿å¹¶ä¸å¤šï¼Œç›¸åå†™èµ·æ¥æœ‰ç‚¹å¤æ‚ã€‚Django REST frameworkï¼ˆåé¢ç®€ç§°DRFï¼‰å°±å‡ºç°äº†ï¼Œä»¥<strong>RESTful</strong>ä½œä¸ºæ¥å£å‘½åè§„èŒƒï¼Œåœ¨æ“ä½œæ•°æ®æ—¶åŠ å…¥åºåˆ—åŒ–å™¨ç®€åŒ–æ•°æ®æ ¡éªŒï¼Œå­—æ®µè¿”å›ç­‰æ“ä½œï¼Œå°è£…è§†å›¾å±‚ç®€åŒ–æ¥å£ç¼–å†™å’Œå‚æ•°è¿”å›ï¼Œæä¾›<strong>è®¤è¯ã€æƒé™ã€é™æµã€è¿‡æ»¤ã€æ’åºã€åˆ†é¡µã€å¼‚å¸¸å¤„ç†ã€APIæ¥å£æ–‡æ¡£</strong>ç­‰ç»„ä»¶ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¯ä»¥è¯´ä»…ä»…Djangoæ˜¯ä¸€ä¸ªåŸºçŸ³ï¼ŒDRFæ‰æ˜¯çœŸæ­£çš„å¼€å‘å¿…å¤‡ã€‚</p><p>ä¸‹é¢ä»0åˆ°1ï¼Œæ€»ç»“è‡ªå·±å­¦ä¹ DRFçš„è¿‡ç¨‹ã€‚</p><ul><li><strong>Django REST framework å…¥é—¨</strong></li><li><strong>Django REST framework åºåˆ—åŒ–å™¨</strong></li><li><strong>Django REST framework è¯·æ±‚å“åº” è§†å›¾ è·¯ç”±</strong></li><li><strong>Django REST framework å…«å¤§ç»„ä»¶</strong></li></ul><hr><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><ul><li>Windows 10</li><li>Python 3.6</li><li>Mysql 5.7</li><li>Django 3.2</li><li>Pycharm 2019.3</li></ul><p>å®‰è£…å¥½Python3.6åï¼Œå®‰è£…pipenvåšè™šæ‹Ÿç¯å¢ƒï¼Œä»¥åçš„åº“å°±æ”¾åœ¨è™šæ‹Ÿç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs shell">Microsoft Windows [ç‰ˆæœ¬ 10.0.18363.1556]<br>(c) 2019 Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚<br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»º<span class="hljs-built_in">env</span>ç›®å½•ä½œä¸ºè™šæ‹Ÿç¯å¢ƒåœ°å€</span><br>D:\Environment\env&gt;dir<br>é©±åŠ¨å™¨ D ä¸­çš„å·æ˜¯ Program<br>å·çš„åºåˆ—å·æ˜¯ 654B-777A<br>D:\Environment\env çš„ç›®å½•<br>2022/03/24 09:56 &lt;DIR&gt; .<br>2022/03/24 09:56 &lt;DIR&gt; ..<br>0 ä¸ªæ–‡ä»¶ 0 å­—èŠ‚<br>2 ä¸ªç›®å½• 283,803,500,544 å¯ç”¨å­—èŠ‚<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£…pipenv</span><br>D:\Environment\env&gt;pip install pipenv<br>Looking in indexes: http://pypi.douban.com/simple<br>Requirement already satisfied: pipenv in d:\python3.6\lib\site-packages (2022.1.8)<br>Requirement already satisfied: virtualenv-clone&gt;=0.2.5 in d:\python3.6\lib\site-packages (from pipenv) (0.5.7)<br>Requirement already satisfied: certifi in d:\python3.6\lib\site-packages (from pipenv) (2021.10.8)<br>Requirement already satisfied: pip&gt;=18.0 in d:\python3.6\lib\site-packages (from pipenv) (21.3.1)<br>Requirement already satisfied: virtualenv in d:\python3.6\lib\site-packages (from pipenv) (20.13.3)<br>Requirement already satisfied: setuptools&gt;=36.2.1 in d:\python3.6\lib\site-packages (from pipenv) (59.6.0)<br>Requirement already satisfied: importlib-metadata&gt;=0.12 in d:\python3.6\lib\site-packages (from virtualenv-&gt;pipenv) (4.8.3)<br>Requirement already satisfied: importlib-resources&gt;=1.0 in d:\python3.6\lib\site-packages (from virtualenv-&gt;pipenv) (5.4.0)<br>Requirement already satisfied: platformdirs&lt;3,&gt;=2 in d:\python3.6\lib\site-packages (from virtualenv-&gt;pipenv) (2.4.0)<br>Requirement already satisfied: filelock&lt;4,&gt;=3.2 in d:\python3.6\lib\site-packages (from virtualenv-&gt;pipenv) (3.4.1)<br>Requirement already satisfied: six&lt;2,&gt;=1.9.0 in d:\python3.6\lib\site-packages (from virtualenv-&gt;pipenv) (1.11.0)<br>Requirement already satisfied: distlib&lt;1,&gt;=0.3.1 in d:\python3.6\lib\site-packages (from virtualenv-&gt;pipenv) (0.3.4)<br>Requirement already satisfied: typing-extensions&gt;=3.6.4 in d:\python3.6\lib\site-packages (from importlib-metadata&gt;=0.12-&gt;virtualenv-&gt;pipenv) (4.1.1)<br>Requirement already satisfied: zipp&gt;=0.5 in d:\python3.6\lib\site-packages (from importlib-metadata&gt;=0.12-&gt;virtualenv-&gt;pipenv) (3.6.0)<br>D:\Environment\env&gt;pipenv graph<br>Warning: No virtualenv has been created for this project yet! Consider running `pipenv install` first to automatically generate one for you or see `pipenv install --help` for further instructions.<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£…Djangoï¼Œä¸åŠ ç‰ˆæœ¬å°±æ˜¯é»˜è®¤æœ€æ–°ç‰ˆ</span><br>D:\Environment\env&gt;pipenv install django<br>Creating a virtualenv for this project...<br>Pipfile: D:\Environment\env\Pipfile<br>Using D:/python3.6/python.exe (3.6.2) to create virtualenv...<br>[ =] Creating virtual environment...created virtual environment CPython3.6.2.final.0-64 in 3139ms<br>creator CPython3Windows(dest=C:\Users\Luffy\.virtualenvs\env-cX5X2ZN8, clear=False, no\_vcs\_ignore=False, global=False)<br>seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app\_data\_dir=C:\Users\Luffy\AppData\Local\pypa\virtualenv)<br>added seed packages: pip==21.3.1, setuptools==59.6.0, wheel==0.37.1<br>activators BashActivator,BatchActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator<br>Successfully created virtual environment!<br>Virtualenv location: C:\Users\Luffy\.virtualenvs\env-cX5X2ZN8<br>Creating a Pipfile for this project...<br>Installing django...<br>Adding django to Pipfile&#x27;s [packages]...<br>Installation Succeeded<br>Pipfile.lock not found, creating...<br>Locking [dev-packages] dependencies...<br>Locking [packages] dependencies...<br>Locking...Building requirements...<br>Resolving dependencies...<br>Success!<br>Updated Pipfile.lock (85c883)!<br>Installing dependencies from Pipfile.lock (85c883)...<br>================================ 0/0 - 00:00:00<br>To activate this project&#x27;s virtualenv, run pipenv shell.<br>Alternatively, run a command inside the virtualenv with pipenv run.<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…çš„åº“</span><br>D:\Environment\env&gt;pipenv graph<br>Django==3.2.12<br>- asgiref [required: &gt;=3.3.2,&lt;4, installed: 3.4.1]<br>- typing-extensions [required: Any, installed: 4.1.1]<br>- pytz [required: Any, installed: 2022.1]<br>- sqlparse [required: &gt;=0.2.2, installed: 0.4.2]<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿›å…¥è™šæ‹Ÿç¯å¢ƒ</span><br>D:\Environment\env&gt;pipenv shell<br>Launching subshell in virtual environment...<br>Microsoft Windows [ç‰ˆæœ¬ 10.0.18363.1556]<br>(c) 2019 Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒå®é™…ä½ç½®</span><br>(env-cX5X2ZN8) D:\Environment\env&gt;pipenv --venv<br>C:\Users\Luffy\.virtualenvs\env-cX5X2ZN8<br>(env-cX5X2ZN8) D:\Environment\env&gt;<br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h2><p>ç›´æ¥ä½¿ç”¨pipenvåˆ›å»ºDjangoé¡¹ç›®ï¼Œç„¶åç”¨PyCharmæ‰“å¼€å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">(env-cX5X2ZN8) D:\Environment\env&gt;django-admin startproject drfdemo<br>(env-cX5X2ZN8) D:\Environment\env&gt;dir<br>é©±åŠ¨å™¨ D ä¸­çš„å·æ˜¯ Program<br>å·çš„åºåˆ—å·æ˜¯ 654B-777A<br>D:\Environment\env çš„ç›®å½•<br>2022/03/24 10:53 &lt;DIR&gt; .<br>2022/03/24 10:53 &lt;DIR&gt; ..<br>2022/03/24 10:53 &lt;DIR&gt; drfdemo<br>2022/03/24 10:51 151 Pipfile<br>2022/03/24 10:51 2,069 Pipfile.lock<br>2 ä¸ªæ–‡ä»¶ 2,220 å­—èŠ‚<br>3 ä¸ªç›®å½• 283,753,816,064 å¯ç”¨å­—èŠ‚<br>(env-cX5X2ZN8) D:\Environment\env&gt;<br></code></pre></td></tr></table></figure><p><a href="https://imgse.com/i/vyJy8K"><img src="https://s1.ax1x.com/2022/08/21/vyJy8K.png"></a></p><p>åœ¨ <code>settings.py</code> ä¸­å¯¼å…¥osåŒ…ï¼Œå¯åŠ¨Djangoé¡¹ç›®ï¼Œå³å¯åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°å¯åŠ¨æˆåŠŸ</p><p><a href="https://imgse.com/i/vyJ6gO"><img src="https://s1.ax1x.com/2022/08/21/vyJ6gO.png"></a></p><h2 id="å¸¸è§„é…ç½®"><a href="#å¸¸è§„é…ç½®" class="headerlink" title="å¸¸è§„é…ç½®"></a>å¸¸è§„é…ç½®</h2><p><strong>è¯­è¨€å’Œæ—¶åŒº</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">LANGUAGE\_CODE = <span class="hljs-string">&#x27;zh-Hans&#x27;</span><br>TIME\_ZONE = <span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span><br></code></pre></td></tr></table></figure><p>å…³æ‰csrfé˜²å¾¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span><br></code></pre></td></tr></table></figure><p>æ•°æ®åº“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">DATABASES = &#123;<br><span class="hljs-string">&#x27;default&#x27;</span>: &#123;<br><span class="hljs-string">&#x27;ENGINE&#x27;</span>: <span class="hljs-string">&#x27;django.db.backends.mysql&#x27;</span>,<br><span class="hljs-string">&#x27;HOST&#x27;</span>: <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<br><span class="hljs-string">&#x27;PORT&#x27;</span>: <span class="hljs-number">3306</span>,<br><span class="hljs-string">&#x27;USER&#x27;</span>: <span class="hljs-string">&#x27;root&#x27;</span>,<br><span class="hljs-string">&#x27;PASSWORD&#x27;</span>: <span class="hljs-string">&#x27;123456&#x27;</span>,<br><span class="hljs-string">&#x27;NAME&#x27;</span>: <span class="hljs-string">&#x27;drf&#x27;</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿æ¥MySqlè¿˜éœ€è¦ä¸‹è½½åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pipenv install pymysql<br></code></pre></td></tr></table></figure><p>åœ¨ä¸»é¡¹ç›®ä¸‹çš„ <code>__init__.py</code>ä¸­åŠ å…¥è¿æ¥æ•°æ®åº“é…ç½®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<br>pymysql.install\_<span class="hljs-keyword">as</span>\_MySQLdb()<br></code></pre></td></tr></table></figure><p>åŸºæœ¬ä¸Šåˆ°ç°åœ¨ï¼Œä¸€ä¸ªDjangoé¡¹ç›®çš„å¸¸ç”¨é…ç½®å°±å¥½äº†</p><p><a href="https://imgse.com/i/vyJWbd"><img src="https://s1.ax1x.com/2022/08/21/vyJWbd.png"></a></p><h2 id="åˆ›å»ºåº”ç”¨"><a href="#åˆ›å»ºåº”ç”¨" class="headerlink" title="åˆ›å»ºåº”ç”¨"></a>åˆ›å»ºåº”ç”¨</h2><p>åˆ›å»ºä¸€ä¸ªstudentsçš„åº”ç”¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python manage.py startapp students<br></code></pre></td></tr></table></figure><p>æ³¨å†Œåº”ç”¨åˆ° <code>settings.py</code>ä¸­å»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">INSTALLED\_APPS = [<br><span class="hljs-string">&#x27;django.contrib.admin&#x27;</span>,<br><span class="hljs-string">&#x27;django.contrib.auth&#x27;</span>,<br><span class="hljs-string">&#x27;django.contrib.contenttypes&#x27;</span>,<br><span class="hljs-string">&#x27;django.contrib.sessions&#x27;</span>,<br><span class="hljs-string">&#x27;django.contrib.messages&#x27;</span>,<br><span class="hljs-string">&#x27;django.contrib.staticfiles&#x27;</span>,<br><span class="hljs-string">&#x27;students&#x27;</span>,<br>]<br></code></pre></td></tr></table></figure><p>ç¼–å†™modelç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(models.Model):<br>SEX\_OPTION = (<br>(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;ä¿å¯†&#x27;</span>),<br>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;ç”·&#x27;</span>),<br>(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;å¥³&#x27;</span>),<br>)<br>name = models.CharField(<span class="hljs-built_in">max</span>\_length=<span class="hljs-number">20</span>,verbose\_name=<span class="hljs-string">&#x27;å§“å&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;å§“å&#x27;</span>)<br>age = models.SmallIntegerField(verbose\_name=<span class="hljs-string">&#x27;å¹´é¾„&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;å¹´é¾„&#x27;</span>)<br>sex = models.SmallIntegerField(choices=SEX\_OPTION,verbose\_name=<span class="hljs-string">&#x27;æ€§åˆ«&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;æ€§åˆ«ï¼Œ0-&gt;ä¿å¯†ï¼Œ1-&gt;ç”·ï¼Œ2-&gt;å¥³ï¼Œ&#x27;</span>)<br>classmate = models.CharField(db\_column=<span class="hljs-string">&#x27;classmate&#x27;</span>,<span class="hljs-built_in">max</span>\_length=<span class="hljs-number">13</span>,verbose\_name=<span class="hljs-string">&#x27;ç­çº§&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;ç­çº§&#x27;</span>)<br>description = models.TextField(null=<span class="hljs-literal">True</span>,blank=<span class="hljs-literal">True</span>,verbose\_name=<span class="hljs-string">&#x27;ä¸ªæ€§ç­¾å&#x27;</span>,<span class="hljs-built_in">help</span>\_text=<span class="hljs-string">&#x27;ä¸ªæ€§ç­¾åï¼Œå¯ä»¥ä¸ºç©º&#x27;</span>)<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>db\_table = <span class="hljs-string">&#x27;db\_student&#x27;</span><br>verbose\_name = <span class="hljs-string">&#x27;å­¦ç”Ÿä¿¡æ¯&#x27;</span><br>verbose\_name\_plural = verbose\_name<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">è¿ç§»æ¨¡å‹<br>python manage.py makemigrations<br>æ•°æ®å¯¼å…¥<br>python manage.py migrate<br></code></pre></td></tr></table></figure><p>æ‰“å¡æ•°æ®åº“ï¼Œå¯ä»¥å‘ç°æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„è¡¨ï¼Œå¯¹äºå­—æ®µçš„ä¸€äº›é…ç½®å‚æ•°ï¼Œå°±ä¸è§£é‡Šäº†ï¼Œå¯ä»¥æŸ¥çœ‹å®˜ç½‘modelçš„ç¼–å†™</p><p>é€šè¿‡ä¸‹é¢å‘½ä»¤ï¼Œåˆ›å»ºè¶…çº§ç®¡ç†å‘˜ï¼Œå¯ä»¥ç”¨äºç™»å½•djangoè‡ªå¸¦çš„ç®¡ç†å‘˜ç•Œé¢</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python manage.py createsuperuser<br></code></pre></td></tr></table></figure><p><a href="https://imgse.com/i/vyJsC6"><img src="https://s1.ax1x.com/2022/08/21/vyJsC6.png"></a></p><h2 id="æµ‹è¯•æ¥å£"><a href="#æµ‹è¯•æ¥å£" class="headerlink" title="æµ‹è¯•æ¥å£"></a>æµ‹è¯•æ¥å£</h2><p>ç®€å•ç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¥å£ï¼Œæµ‹è¯•ä¸æ•°æ®åº“æ˜¯å¦è¿æ¥æˆåŠŸ</p><p><code>drfdemo/urls.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">urlpatterns = [<br>path(<span class="hljs-string">&#x27;admin/&#x27;</span>, admin.site.urls),<br>path(<span class="hljs-string">&#x27;stu/&#x27;</span>, include(<span class="hljs-string">&#x27;students.urls&#x27;</span>)),<br>]<br></code></pre></td></tr></table></figure><p><code>students/urls.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">urlpatterns = [<br>path(<span class="hljs-string">&#x27;test/&#x27;</span>,StudentsViews.test),<br>]<br></code></pre></td></tr></table></figure><p><code>views.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentsViews</span>(<span class="hljs-title class_ inherited__">View</span>):<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">self</span>):<br>stus = Student.objects.<span class="hljs-built_in">all</span>()<br><span class="hljs-keyword">for</span> stu <span class="hljs-keyword">in</span> stus:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;å§“åï¼š<span class="hljs-subst">&#123;stu.name&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;å§“åï¼š<span class="hljs-subst">&#123;stu.age&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;å§“åï¼š<span class="hljs-subst">&#123;stu.sex&#125;</span>&#x27;</span>)<br><span class="hljs-comment"># print(f&#x27;QuerrySetï¼š&#123;stu&#125;&#x27;)</span><br><span class="hljs-keyword">return</span> JsonResponse(data=&#123;<span class="hljs-string">&#x27;msg&#x27;</span>:<span class="hljs-string">&#x27;ok&#x27;</span>&#125;)<br></code></pre></td></tr></table></figure><p>è¯·æ±‚ç»“æœï¼Œæ‰“å°åœ¨æ§åˆ¶å°ï¼š</p><p><a href="https://imgse.com/i/vytmwj"><img src="https://s1.ax1x.com/2022/08/21/vytmwj.png" alt="vytmwj.png"></a></p><p>æµ‹è¯•é€šè¿‡</p><h2 id="æ•´åˆDRF"><a href="#æ•´åˆDRF" class="headerlink" title="æ•´åˆDRF"></a>æ•´åˆDRF</h2><p>DRFç®€åŒ–Djangoçš„æ“ä½œï¼Œæ²¡æœ‰DRFï¼ŒDjangoä¹Ÿèƒ½å®Œæˆï¼Œåªæ˜¯ç¼–ç ä¼šå¤æ‚ä¸€äº›ï¼Œè¿™é‡Œæ•´åˆDRFåšä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå…ˆä¸ç”¨ç†è§£é‡Œé¢çš„å†…å®¹ã€‚</p><p>å®‰è£…ä¾èµ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pipenv install djangorestframework django-filter<br></code></pre></td></tr></table></figure><p>æŠŠç»„ä»¶åŠ å…¥åˆ°<code>setting.py</code>ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">&#x27;rest\_framework&#x27;,<br>&#x27;django\_filters&#x27;,<br></code></pre></td></tr></table></figure><p>ç¼–å†™åºåˆ—åŒ–å™¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentModelSerializer</span>(serializers.ModelSerializer):<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>model = Student<br><span class="hljs-comment"># åºåˆ—åŒ–å­—æ®µ</span><br><span class="hljs-comment"># å…¨éƒ¨</span><br>fields = <span class="hljs-string">&#x27;\_\_all\_\_&#x27;</span><br><span class="hljs-comment"># ä¸€ä¸ªä¸€ä¸ªå†™</span><br><span class="hljs-comment"># fields =[&#x27;id&#x27;,&#x27;name&#x27;]</span><br></code></pre></td></tr></table></figure><p><code>urls.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">path(<span class="hljs-string">&#x27;stu/&#x27;</span>,StudentsGenericAPIView.<span class="hljs-keyword">as</span>\_view()),<br></code></pre></td></tr></table></figure><p><code>views.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentsGenericAPIView</span>(<span class="hljs-title class_ inherited__">GenericAPIView</span>):<br>queryset = Student.objects.<span class="hljs-built_in">all</span>()<br>serializer\_<span class="hljs-keyword">class</span> = StudentModelSerializer<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self, request</span>):<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">è·å–å¤šæ¡æ•°æ®</span><br><span class="hljs-string">:param request:</span><br><span class="hljs-string">:return:</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-comment"># è·å–æ¨¡å‹å¯¹è±¡åˆ—è¡¨ï¼Œå®ä¾‹åŒ–åºåˆ—åŒ–å™¨å¯¹è±¡</span><br>serializer = <span class="hljs-variable language_">self</span>.serializer\_<span class="hljs-keyword">class</span>(instance=<span class="hljs-variable language_">self</span>.get\_queryset(), many=<span class="hljs-literal">True</span>)<br><span class="hljs-comment"># è¿”å›åºåˆ—åŒ–çš„æ•°æ®åˆ—è¡¨</span><br><span class="hljs-keyword">return</span> Response(serializer.data)<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœ<br><a href="https://imgse.com/i/vyJD4x"><img src="https://s1.ax1x.com/2022/08/21/vyJD4x.png"></a></p><p>å¯ä»¥å‘ç°ï¼Œè‡ªå¸¦é¡µé¢ï¼Œè€Œä¸”ä»¥jsonæ ¼å¼è¿”å›ï¼Œå†™è¿‡Djangoçš„åŒå­¦çŸ¥é“è¦æ˜¯æ²¡ç”¨DRFï¼Œè¿”å›jsonæ ¼å¼æ˜¯ç‰¹åˆ«ç—›è‹¦çš„ä¸€ä»¶äº‹ï¼Œè¦å–å‡ºæ¥éå†æ”¾å…¥å­—å…¸å†è¿”å›ï¼Œä½†æ˜¯ç”¨äº†DRFé€šè¿‡åºåˆ—åŒ–å™¨ï¼Œå°±ç›´æ¥èƒ½è¿”å›jsonæ•°æ®ï¼Œç‰¹åˆ«æ–¹ä¾¿ï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>DRF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonç¯å¢ƒç›¸å…³çš„é—®é¢˜</title>
    <link href="/2022/03/16/Python%E7%8E%AF%E5%A2%83%E7%9B%B8%E5%85%B3%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2022/03/16/Python%E7%8E%AF%E5%A2%83%E7%9B%B8%E5%85%B3%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>å›°æ‰°æˆ‘å¾ˆå¤šå¤©çš„<strong>Pythonç¯å¢ƒé—®é¢˜</strong>ç»ˆäºå¾—åˆ°è§£å†³äº†ï¼Œä»Šå¤©æŠŠé‡åˆ°çš„é—®é¢˜åšä¸ªå¤ç›˜</p><h2 id="Pythonåº“å®‰è£…å¾ˆæ…¢"><a href="#Pythonåº“å®‰è£…å¾ˆæ…¢" class="headerlink" title="Pythonåº“å®‰è£…å¾ˆæ…¢"></a>Pythonåº“å®‰è£…å¾ˆæ…¢</h2><p>è¿™ä¸ªé—®é¢˜å…¶å®å¾ˆå¸¸è§ï¼Œå½“æˆ‘ä»¬åªæ˜¯å®‰è£…äº†Python3.Xçš„åŸºç¡€è¿è¡Œç¯å¢ƒï¼Œæ‰€æ‹‰å–åº“é•œåƒæ˜¯åœ¨å›½å¤–çš„ï¼Œå—ç½‘é€Ÿçš„å½±å“ï¼Œä¸‹ä¸€äº›å¤§ä¸€ç‚¹çš„å¯ä»¥å°±å¾ˆæ…¢ï¼Œå¸¸å¸¸ä¸‹è½½å¤±è´¥ã€‚</p><p>å¸¸é‡åˆ°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Could not fetch URL https://pypi.tuna.tsinghua.edu.cn/simple/numpy/<br></code></pre></td></tr></table></figure><p><strong>ç¬¬ä¸€ä¸ªè§£å†³åŠæ³•ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install xxx --index-url http://pypi.douban.com/simple/ --trusted-host pypi.douban.com<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸´æ—¶çš„ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥è§£ç‡ƒçœ‰ä¹‹æ€¥</p><p><strong>ç¬¬äºŒç§è§£å†³åŠæ³•ï¼š</strong></p><p>åœ¨æœ¬åœ°æœºå™¨æ–°å»ºé…ç½®æ–‡ä»¶ï¼ŒåŠ å…¥å›½å†…é•œåƒç½‘ç«™</p><p><img src="https://s2.loli.net/2022/03/16/7bKAuCNYwTdkzlh.png"></p><p>è¦åœ¨ç”¨æˆ·çš„ç›®å½•ä¸‹æ–°å»ºä¸ªpipæ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢æ–°å»ºä¸ªpip.iniï¼Œæ–‡ä»¶å†…å®¹é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[global]</span><br><span class="hljs-attr">index-url</span> = http://pypi.douban.com/simple<br><span class="hljs-section">[install]</span><br><span class="hljs-attr">trusted-host</span>=pypi.douban.com<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥æŠŠé•œåƒæ‹‰å–åœ°å€æ”¹åˆ°å›½å†…äº†ï¼Œå›½å†…å…¶ä»–çš„é•œåƒç½‘ç«™å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">æ¸…åï¼šhttps://pypi.tuna.tsinghua.edu.cn/simple<br>é˜¿é‡Œäº‘ï¼šhttp://mirrors.aliyun.com/pypi/simple/<br>ä¸­å›½ç§‘æŠ€å¤§å­¦ https://pypi.mirrors.ustc.edu.cn/simple/<br>åä¸­ç†å·¥å¤§å­¦ï¼šhttp://pypi.hustunique.com/<br>å±±ä¸œç†å·¥å¤§å­¦ï¼šhttp://pypi.sdutlinux.org/<br>è±†ç“£ï¼šhttp://pypi.douban.com/simple/<br></code></pre></td></tr></table></figure><p>é˜¿é‡Œäº‘çš„æœ‰ç‚¹æ…¢ï¼Œä¸ªäººæ„Ÿè§‰è±†ç“£å’Œæ¸…åçš„å¾ˆå¿«ï¼</p><h2 id="Pythonæ‰‹åŠ¨å®‰è£…åº“"><a href="#Pythonæ‰‹åŠ¨å®‰è£…åº“" class="headerlink" title="Pythonæ‰‹åŠ¨å®‰è£…åº“"></a>Pythonæ‰‹åŠ¨å®‰è£…åº“</h2><p>å¤§å¤šæ•°åº“ä¿®æ”¹äº†é•œåƒæ‹‰å»åœ°å€éƒ½å¯ä»¥å®‰è£…æˆåŠŸçš„ï¼Œè€Œä¸”é€Ÿåº¦ä¹Ÿå¾ˆå¿«ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šåº“ä¾æ—§æ— æ³•å®‰è£…ï¼Œæ¯”å¦‚mysqlclientè¿™ç§ï¼Œè¿™æ—¶å€™å°±éœ€è¦æ‰‹åŠ¨å®‰è£…äº†ï¼Œå…ˆå»ç½‘ä¸Šæ‰¾åˆ°whlæ–‡ä»¶ï¼Œä¸‹è½½ä¸‹æ¥å®‰è£…å³å¯</p><p>æœ‰ä¸¤ä¸ªä¸‹è½½ç½‘ç«™ï¼š</p><p><a href="https://pypi.org/">pypi.org</a> å’Œ <a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/">www.lfd.uci.edu</a></p><p>ç¬¬ä¸€ä¸ªç½‘ç«™å¹¶ä¸éœ€è¦æœºå‹ç‰ˆæœ¬çš„é€‰æ‹©ï¼Œç›´æ¥é€‰æ‹©åº“ç‰ˆæœ¬ä¸‹è½½å³å¯</p><p>ç¬¬äºŒä¸ªå°±éœ€è¦äº†ï¼Œæ‰€ä»¥éœ€è¦å…ˆæŸ¥çœ‹è‡ªå·±æœºå™¨é€‚åˆåº“çš„ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ç‰ˆæœ¬</span><br>pip debug --verbose<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2022/03/16/wy43AXIzb76GraH.png"></p><p>é€šè¿‡ç¬¬äºŒä¸ªç½‘ç«™è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ‰¾åˆ°åˆé€‚ç‰ˆæœ¬å³å¯ï¼Œè¿™é‡Œä»¥å®‰è£…mysqlclientä¸ºä¾‹</p><p><img src="https://s2.loli.net/2022/03/16/Cjg2FNAd4ySW3eZ.png"></p><p>ä¸‹è½½ä¸‹æ¥ï¼Œç›´æ¥åœ¨æŸä¸ªæ–‡ä»¶å¤¹å®‰è£…å³å¯ï¼Œå› ä¸ºpythonéƒ½æ˜¯åŠ å…¥ç¯å¢ƒå˜é‡äº†çš„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install XXX.whl<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä¹Ÿæœ‰å¾ˆå¤§ä¸æ˜¯whlæ ¼å¼çš„è€Œæ˜¯å‹ç¼©åŒ…æ ¼å¼çš„ï¼Œæ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å®‰è£…å‘½ä»¤ä¸ä¸€æ ·ï¼Œè¿™é‡Œä»¥snowNLPå®‰è£…ä¸ºä¾‹ï¼ˆsnowNLPç›´æ¥ç”¨pip installå®‰è£…ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰</p><p><img src="https://s2.loli.net/2022/03/16/U5IrExoZSpCi4d8.png"></p><p>æœ¬åœ°è§£å‹ï¼Œè¿›å…¥è§£å‹æ–‡ä»¶å¤¹ï¼Œå‘½ä»¤è¡Œå®‰è£…å³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python setup.py install<br></code></pre></td></tr></table></figure><h2 id="Pythonç¯å¢ƒå’ŒAnaconda3"><a href="#Pythonç¯å¢ƒå’ŒAnaconda3" class="headerlink" title="Pythonç¯å¢ƒå’ŒAnaconda3"></a>Pythonç¯å¢ƒå’ŒAnaconda3</h2><p>Anaconda3è‡ªå¸¦äº†ç»å¤§éƒ¨åˆ†Pythonå¸¸ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œéå¸¸æ–¹ä¾¿ï¼Œè€ŒPythonåœ¨åˆšå®‰è£…æ—¶æ˜¯æ²¡æœ‰ç¬¬ä¸‰æ–¹åº“çš„ï¼Œä¸‹è½½ä¼šé‡åˆ°ç½‘ç»œçš„é—®é¢˜ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™éƒ½ä¼šé€‰æ‹©Anaconda3ï¼Œä½¿ç”¨pip install æ˜¯ç”¨çš„Pythonçš„pipå·¥å…·ï¼Œç”¨conda installæ˜¯ç”¨çš„Anaconda3çš„pipå·¥å…·ï¼Œæœ‰æ—¶å€™æœ‰äº›ç¬¬ä¸‰æ–¹åº“å¹¶ä¸æ”¯æŒAnaconda3ï¼Œå°±éœ€è¦ä½¿ç”¨Pythonå»å®‰è£…ï¼Œæ¯”å¦‚å“ˆå·¥å¤§çš„åˆ†è¯å™¨pyltpï¼Œæˆ‘åœ¨é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡çš„æ—¶å€™ï¼ŒæŠŠAnaconda3çš„é…ç½®é¡ºåºå¼„åˆ°Pythonçš„å‰é¢å»äº†ï¼Œå¯¼è‡´æ¯æ¬¡æˆ‘pip intsalléƒ½æ˜¯ç”¨çš„Anaconda3å»å®‰è£…ã€‚</p><p>å¦‚ä½•åˆ‡æ¢æˆpythonçš„å‘¢ï¼Ÿå¾ˆç®€å•ï¼ŒæŠŠPythonåœ¨Pathä¸­çš„å˜é‡é…ç½®æåˆ°Anaconda3ä¹‹å‰å°±è¡Œäº†ã€‚</p><p>å…¶å®è¿™æ ·æ‰æ˜¯æœ€æ­£ç¡®çš„é€‰æ‹©ï¼Œpipç”¨pythonçš„ï¼Œè€ŒAnaconda3æœ‰è‡ªå·±çš„condaï¼Œå°±ä¸ä¼šå®‰è£…é”™äº†</p><h2 id="è™šæ‹Ÿç¯å¢ƒ"><a href="#è™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="è™šæ‹Ÿç¯å¢ƒ"></a>è™šæ‹Ÿç¯å¢ƒ</h2><p>pipenvæ˜¯ä¸€ä¸ªpythonåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒèƒ½åŒæ—¶ç®¡ç†pythonè™šæ‹Ÿç¯å¢ƒå’Œpythonä¾èµ–ï¼Œå®˜æ–¹æ¨èã€‚</p><p>è¿˜æœ‰virtuanenvï¼Œä½†æ˜¯æ¯”è¾ƒè€äº†ã€‚å¯ä»¥è¯´pipenv&#x3D;pip + virtualenvï¼Œä¸‹é¢ä»‹ç»pipenvæ­å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå®ç°æ¯ä¸ªé¡¹ç›®ä¸€ä¸ªç¯å¢ƒã€‚</p><p>ä¸‹é¢æˆ‘æ–°å»ºä¸ªæ–‡ä»¶å¤¹ï¼Œé‡æ–°æ­å»ºä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œæ•´åˆè¿›Pycharmåšç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs shell">Microsoft Windows [ç‰ˆæœ¬ 10.0.18363.1556]<br>(c) 2019 Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚<br><span class="hljs-meta prompt_"># </span><span class="language-bash">pipå®‰è£…pipenv</span><br>D:\&gt;pip install pipenv<br>Looking in indexes: http://pypi.douban.com/simple<br>Requirement already satisfied: pipenv in d:\python3.6\lib\site-packages (2022.1.8)<br>Requirement already satisfied: virtualenv-clone&gt;=0.2.5 in d:\python3.6\lib\site-packages (from pipenv) (0.5.7)<br>Requirement already satisfied: setuptools&gt;=36.2.1 in d:\python3.6\lib\site-packages (from pipenv) (59.6.0)<br>Requirement already satisfied: certifi in d:\python3.6\lib\site-packages (from pipenv) (2021.10.8)<br>Requirement already satisfied: pip&gt;=18.0 in d:\python3.6\lib\site-packages (from pipenv) (21.3.1)<br>Requirement already satisfied: virtualenv in d:\python3.6\lib\site-packages (from pipenv) (20.13.3)<br>Requirement already satisfied: importlib-resources&gt;=1.0 in d:\python3.6\lib\site-packages (from virtualenv-&gt;pipenv) (5.4.0)<br>Requirement already satisfied: six&lt;2,&gt;=1.9.0 in d:\python3.6\lib\site-packages (from virtualenv-&gt;pipenv) (1.11.0)<br>Requirement already satisfied: importlib-metadata&gt;=0.12 in d:\python3.6\lib\site-packages (from virtualenv-&gt;pipenv) (4.8.3)<br>Requirement already satisfied: platformdirs&lt;3,&gt;=2 in d:\python3.6\lib\site-packages (from virtualenv-&gt;pipenv) (2.4.0)<br>Requirement already satisfied: distlib&lt;1,&gt;=0.3.1 in d:\python3.6\lib\site-packages (from virtualenv-&gt;pipenv) (0.3.4)<br>Requirement already satisfied: filelock&lt;4,&gt;=3.2 in d:\python3.6\lib\site-packages (from virtualenv-&gt;pipenv) (3.4.1)<br>Requirement already satisfied: zipp&gt;=0.5 in d:\python3.6\lib\site-packages (from importlib-metadata&gt;=0.12-&gt;virtualenv-&gt;pipenv) (3.6.0)<br>Requirement already satisfied: typing-extensions&gt;=3.6.4 in d:\python3.6\lib\site-packages (from importlib-metadata&gt;=0.12-&gt;virtualenv-&gt;pipenv) (4.1.1)<br>D:\&gt;pip show pipenv<br>Name: pipenv<br>Version: 2022.1.8<br>Summary: Python Development Workflow for Humans.<br>Home-page: https://github.com/pypa/pipenv<br>Author: Pipenv maintainer team<br>Author-email: distutils-sig@python.org<br>License: MIT<br>Location: d:\python3.6\lib\site-packages<br>Requires: certifi, pip, setuptools, virtualenv, virtualenv-clone<br>Required-by:<br>D:\&gt;cd Environment<br>D:\Environment&gt;cd data-envs<br><span class="hljs-meta prompt_"># </span><span class="language-bash">åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­åˆ›å»ºpipenvé…ç½®æ–‡ä»¶ï¼Œä»¥åè¦é…ç½®è¯¥è™šæ‹Ÿç¯å¢ƒå°±ç›´æ¥è¿›å…¥è¿™ä¸ªç¯å¢ƒç”¨pipenvå‘½ä»¤å³å¯</span><br>D:\Environment\data-envs&gt;pipenv install<br>Creating a virtualenv for this project...<br>Pipfile: D:\Environment\data-envs\Pipfile<br>Using D:/python3.6/python.exe (3.6.2) to create virtualenv...<br>[ ==] Creating virtual environment...created virtual environment CPython3.6.2.final.0-64 in 2892ms<br>creator CPython3Windows(dest=C:\Users\Luffy\.virtualenvs\data-envs-EwQ4Zbmy, clear=False, no\_vcs\_ignore=False, global=False)<br>seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app\_data\_dir=C:\Users\Luffy\AppData\Local\pypa\virtualenv)<br>added seed packages: pip==21.3.1, setuptools==59.6.0, wheel==0.37.1<br>activators BashActivator,BatchActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator<br>Successfully created virtual environment!<br>Virtualenv location: C:\Users\Luffy\.virtualenvs\data-envs-EwQ4Zbmy<br>Creating a Pipfile for this project...<br>Pipfile.lock not found, creating...<br>Locking [dev-packages] dependencies...<br>Locking [packages] dependencies...<br>Updated Pipfile.lock (ca72e7)!<br>Installing dependencies from Pipfile.lock (ca72e7)...<br>================================ 0/0 - 00:00:00<br>To activate this project&#x27;s virtualenv, run pipenv shell.<br>Alternatively, run a command inside the virtualenv with pipenv run.<br>D:\Environment\data-envs&gt;dir<br>é©±åŠ¨å™¨ D ä¸­çš„å·æ˜¯ Program<br>å·çš„åºåˆ—å·æ˜¯ 654B-777A<br>D:\Environment\data-envs çš„ç›®å½•<br>2022/03/16 15:33 &lt;DIR&gt; .<br>2022/03/16 15:33 &lt;DIR&gt; ..<br>2022/03/16 15:33 138 Pipfile<br>2022/03/16 15:33 453 Pipfile.lock<br>2 ä¸ªæ–‡ä»¶ 591 å­—èŠ‚<br>2 ä¸ªç›®å½• 284,097,318,912 å¯ç”¨å­—èŠ‚<br><span class="hljs-meta prompt_"># </span><span class="language-bash">windows æ²¡æœ‰vi vimï¼Œæ‰€ä»¥ç›´æ¥è¿›æ–‡ä»¶å¤¹ç”¨è®°äº‹æœ¬æ‰“å¼€æŸ¥çœ‹å³å¯</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹è™šæ‹Ÿç¯å¢ƒä½ç½®</span><br>D:\Environment\data-envs&gt;pipenv --venv<br>C:\Users\Luffy\.virtualenvs\data-envs-EwQ4Zbmy<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å®‰è£…çš„åº“</span><br>D:\Environment\data-envs&gt;pipenv graph<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…åº“</span><br>D:\Environment\data-envs&gt;pipenv install pandas numpy<br>Installing pandas...<br>Adding pandas to Pipfile&#x27;s [packages]...<br>Installation Succeeded<br>Installing numpy...<br>Adding numpy to Pipfile&#x27;s [packages]...<br>Installation Succeeded<br>Pipfile.lock (ca72e7) out of date, updating to (e86322)...<br>Locking [dev-packages] dependencies...<br>Locking [packages] dependencies...<br>Locking...Building requirements...<br>Resolving dependencies...<br>Success!<br>Updated Pipfile.lock (e86322)!<br>Installing dependencies from Pipfile.lock (e86322)...<br>================================ 0/0 - 00:00:00<br>To activate this project&#x27;s virtualenv, run pipenv shell.<br>Alternatively, run a command inside the virtualenv with pipenv run.<br>D:\Environment\data-envs&gt;pipenv graph<br>pandas==1.1.5<br>- numpy [required: &gt;=1.15.4, installed: 1.19.5]<br>- python-dateutil [required: &gt;=2.7.3, installed: 2.8.2]<br>- six [required: &gt;=1.5, installed: 1.16.0]<br>- pytz [required: &gt;=2017.2, installed: 2021.3]<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¿€æ´»ç¯å¢ƒï¼Œè¿›å…¥ç¯å¢ƒï¼Œç¯å¢ƒä¸­å¯ä»¥ç›´æ¥è¿è¡Œpythonç¨‹åº</span><br>D:\Environment\data-envs&gt;pipenv shell<br>Launching subshell in virtual environment...<br>Microsoft Windows [ç‰ˆæœ¬ 10.0.18363.1556]<br>(c) 2019 Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚<br>(data-envs-EwQ4Zbmy) D:\Environment\data-envs&gt;exit<br>D:\Environment\data-envs&gt;pipenv --venv<br>C:\Users\Luffy\.virtualenvs\data-envs-EwQ4Zbmy<br>D:\Environment\data-envs&gt;<br></code></pre></td></tr></table></figure><p>C:\Users\Luffy.virtualenvs\data-envs-EwQ4Zbmy æ˜¯è™šæ‹Ÿç¯å¢ƒå‘½ä»¤ï¼Œæˆ‘ä»¬è¦æ•´åˆè¿›Pycharmåªéœ€è¦</p><p><img src="https://s2.loli.net/2022/03/16/5iVfWMFXZz3ud6H.png"></p><h2 id="è™šæ‹Ÿç¯å¢ƒå®‰è£…é…ç½®è¿è¡Œstreamlit"><a href="#è™šæ‹Ÿç¯å¢ƒå®‰è£…é…ç½®è¿è¡Œstreamlit" class="headerlink" title="è™šæ‹Ÿç¯å¢ƒå®‰è£…é…ç½®è¿è¡Œstreamlit"></a>è™šæ‹Ÿç¯å¢ƒå®‰è£…é…ç½®è¿è¡Œstreamlit</h2><p>streamlitå¯ä»¥å¿«é€Ÿæ­å»ºwebæœåŠ¡å™¨ï¼Œåœ¨åšæœºå™¨å­¦ä¹ å¯è§†åŒ–çš„æ—¶å€™éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯streamlitçš„å®‰è£…éå¸¸éš¾æï¼Œæœ¬äººæäº†ä¸¤å¤©æ‰æå¥½ã€‚</p><p>ä¹‹å‰æ˜¯åœ¨è‡ªå·±å°å¼æœºæ­å»ºå¥½äº†ç¯å¢ƒï¼Œstreamlitè¿™äº›éƒ½å¼„å¥½äº†ï¼Œä½†æ˜¯è¦æ¥å›¾ä¹¦é¦†ï¼Œæ‰€ä»¥è¦åœ¨è‡ªå·±ç¬”è®°æœ¬ä¹Ÿæ­å»ºä¸‹ç¯å¢ƒï¼Œè¦å­¦ä¹ Django+DRFï¼Œè¦æ•´åˆè™šæ‹Ÿç¯å¢ƒï¼Œå¹²è„†åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…streamlit</p><p>å®‰è£…é…ç½®è™šæ‹Ÿç¯å¢ƒï¼Œå‰é¢å·²ç»è¯´äº†ï¼Œç°åœ¨é‡ç‚¹æ˜¯å®‰è£…streamlitï¼Œè¿è¡Œstreamlitåšçš„åº”ç”¨</p><p>streamlitéå¸¸ä¸å¥½è£…ï¼Œç”¨åœ¨çº¿æ‹‰å»é•œåƒæ¯æ¬¡éƒ½å¤±è´¥ï¼Œåªèƒ½é€šè¿‡ç¦»çº¿ï¼ŒåŠ è½½whlçš„å½¢å¼è¿›è¡Œå®‰è£…ã€‚å®‰è£…å¥½åï¼ŒæŠŠè™šæ‹Ÿç¯å¢ƒæ•´åˆè¿›Pycharmï¼Œä½†æ˜¯æˆ‘å‘ç°ç”¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">streamlit run app.py<br></code></pre></td></tr></table></figure><p>æŠ¥é”™äº†ï¼Œä½†æ˜¯åœ¨å®‰è£…æˆåŠŸåè°ƒç”¨å®ä¾‹æ˜¯å¯ä»¥çš„ï¼Œæ‰€ä»¥æˆ‘å‘ç°åº”è¯¥æ˜¯è¿è¡Œåœ°æ–¹çš„é”™è¯¯ï¼Œç¢ç£¨äº†ä»¥åï¼Œè¿›å…¥è™šæ‹Ÿç¯å¢ƒï¼Œç”¨å‘½ä»¤å¯åŠ¨åº”ç”¨å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">D:\Environment\envs&gt;pipenv shell<br>Launching subshell in virtual environment...<br>Microsoft Windows [ç‰ˆæœ¬ 10.0.18363.1556]<br>(c) 2019 Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚<br>(envs-f-7jKLmf) D:\Environment\envs&gt;streamlit run D:/pycharm-code-2022/Test/app.py<br>You can now view your Streamlit app in your browser.<br>Local URL: http://localhost:8501<br>Network URL: http://10.176.178.83:8501<br>Stopping...<br>(envs-f-7jKLmf) D:\Environment\envs&gt;<br></code></pre></td></tr></table></figure><p>è¿è¡Œçš„æ–‡ä»¶éœ€è¦ç”¨ç»å¯¹è·¯å¾„ï¼Œåˆ°è¿™å°±æ­å»ºå¥½è™šæ‹Ÿç¯å¢ƒå»è¿è¡Œstreamlitåº”ç”¨äº†</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonç¯å¢ƒæ­å»º</title>
    <link href="/2021/12/23/Python%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <url>/2021/12/23/Python%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<p>Python æ˜¯ä¸€ç§è§£é‡Šå‹ã€é¢å‘å¯¹è±¡ã€åŠ¨æ€æ•°æ®ç±»å‹çš„é«˜çº§ç¨‹åºè®¾è®¡è¯­è¨€ã€‚</p><p>Python ç”± Guido van Rossum äº 1989 å¹´åº•å‘æ˜ï¼Œç¬¬ä¸€ä¸ªå…¬å¼€å‘è¡Œç‰ˆå‘è¡Œäº 1991 å¹´ã€‚</p><h1 id="ç‰ˆæœ¬é€‰æ‹©"><a href="#ç‰ˆæœ¬é€‰æ‹©" class="headerlink" title="ç‰ˆæœ¬é€‰æ‹©"></a>ç‰ˆæœ¬é€‰æ‹©</h1><p>Pythonä¸»è¦çš„ç‰ˆæœ¬åˆ†æ”¯æ˜¯3.Xå’Œ2.Xï¼Œ2.Xå’Œ3.Xåˆ†æ”¯æ˜¯ä¸å…¼å®¹çš„ï¼Œå¯ä»¥è¯´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥åœ¨å®‰è£…ç¯å¢ƒçš„æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„ç‰ˆæœ¬é—®é¢˜ã€‚</p><p>è¿™é‡Œæˆ‘é€‰çš„3.6è¿™ä¸ªå¤§ç‰ˆæœ¬</p><h1 id="Pythonå®‰è£…"><a href="#Pythonå®‰è£…" class="headerlink" title="Pythonå®‰è£…"></a>Pythonå®‰è£…</h1><p>è¿™é‡Œå¾ˆç®€å•ï¼Œè´´ä¸ªå®˜ç½‘è¿æ¥ï¼Œé€‰ä¸ªé€‚åˆè‡ªå·±ç”µè„‘ç³»ç»Ÿå’Œä½æ•°çš„æ–‡ä»¶å°±è¡Œäº†</p><p><a href="https://www.python.org/downloads/">Pythonå®‰è£…å®˜ç½‘</a></p><p>ä¸‹è½½ä¸‹æ¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨å®‰è£…ä¸­éœ€è¦å‹¾é€‰æŠŠPythonç¯å¢ƒåŠ å…¥PATHä¸­ï¼Œä¸€ç›´ç‚¹ä¸‹ä¸€æ­¥å°±è¡Œäº†ï¼Œå®‰è£…å®Œæˆåå¯ä»¥åœ¨å¼€å§‹ä¸­æ‰¾åˆ°æ–°å¢çš„å››ä¸ªæ¨¡å—ï¼š</p><p><img src="https://s2.loli.net/2021/12/24/vGYpIP4zVixt2Qh.png"></p><p>ä¹Ÿå¯ä»¥é€šè¿‡åœ¨CMDç•Œé¢ä¸­è¾“å…¥pythonæ£€éªŒæ˜¯å¦å®‰è£…æˆåŠŸ</p><p><img src="https://s2.loli.net/2021/12/24/sLdh7inaNrJVt4l.png"></p><p>ç‚¹å¼€IDLEï¼ŒPythonè‡ªå¸¦çš„IDEå°±å¯ä»¥ç¼–å†™Pythonç¨‹åºäº†ï¼Œä½†æˆ‘ä»¬é€šå¸¸ç¼–å†™ç¨‹åºè¿˜æ˜¯ç”¨çš„Pycharm</p><h1 id="Pycharmå®‰è£…ä¸é…ç½®"><a href="#Pycharmå®‰è£…ä¸é…ç½®" class="headerlink" title="Pycharmå®‰è£…ä¸é…ç½®"></a>Pycharmå®‰è£…ä¸é…ç½®</h1><p>Pycharmå’ŒIdeaéƒ½æ˜¯ JetBrainsçš„è½¯ä»¶ï¼Œéƒ½æ˜¯æ”¶è´¹çš„ï¼Œå½“ç„¶Pycharmçš„ç®€å•ç‰ˆæœ¬æ˜¯å…è´¹çš„ï¼Œä½†åé¢åšé¡¹ç›®æ˜¯éœ€è¦æ›´å¤šåŠŸèƒ½æ”¯æŒçš„ï¼Œè¿™é‡Œè¿˜æ˜¯éœ€è¦å®‰è£…ä¸“ä¸šç‰ˆã€‚</p><p>ç½‘ä¸Šæ‰¾ä¸ªä¸‹è½½é“¾æ¥ä¸‹è½½å®‰è£…ç ´è§£å°±è¡Œäº†ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°ã€‚</p><p>Pycharmå¾ˆé‡è¦çš„ä¸€ä¸ªé…ç½®å°±æ˜¯å¼€å‘ç¯å¢ƒçš„é…ç½®</p><p><img src="https://s2.loli.net/2021/12/24/wS7ebudlFsGnLYH.png"></p><p>å°±æ˜¯éœ€è¦æŠŠPythonçš„ç¼–è¯‘å™¨å‘Šè¯‰Pycharmçš„ä½ç½®ï¼Œä½†æ˜¯ä¼šå‘ç°æˆ‘å¹¶æ²¡æœ‰ç”¨Pythoné»˜è®¤çš„ç¼–è¯‘å™¨ï¼Œè€Œæ˜¯é€‰æ‹©çš„<strong>Anaconda3</strong>ã€‚</p><h1 id="Anacondaçš„å®‰è£…å’Œé…ç½®"><a href="#Anacondaçš„å®‰è£…å’Œé…ç½®" class="headerlink" title="Anacondaçš„å®‰è£…å’Œé…ç½®"></a>Anacondaçš„å®‰è£…å’Œé…ç½®</h1><p><strong>Anaconda</strong>æŒ‡çš„æ˜¯ä¸€ä¸ªå¼€æºçš„<a href="https://so.csdn.net/so/search?from=pc_blog_highlight&q=Python">Python</a>å‘è¡Œç‰ˆæœ¬ï¼Œå…¶åŒ…å«äº†condaã€Pythonç­‰180å¤šä¸ªç§‘å­¦åŒ…åŠå…¶ä¾èµ–é¡¹ã€‚ å› ä¸ºåŒ…å«äº†å¤§é‡çš„ç§‘å­¦åŒ…ï¼ŒAnaconda çš„ä¸‹è½½æ–‡ä»¶æ¯”è¾ƒå¤§ï¼ˆçº¦ 531 MBï¼‰ï¼Œå¦‚æœåªéœ€è¦æŸäº›åŒ…ï¼Œæˆ–è€…éœ€è¦èŠ‚çœå¸¦å®½æˆ–å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Minicondaè¿™ä¸ªè¾ƒå°çš„å‘è¡Œç‰ˆï¼ˆä»…åŒ…å«condaå’Œ Pythonï¼‰ã€‚</p><p>å› ä¸ºæˆ‘åœ¨å†™Pythonç¨‹åºçš„é€‚åˆï¼Œä¼šå®‰è£…ä¸€äº›å…¶ä»–çš„åº“ï¼Œä½†æ˜¯ç”¨pipå‘½ä»¤ç»å¸¸å®‰è£…å¤±è´¥ï¼ŒæŠ¥é”™ä¹Ÿè§£å†³ä¸äº†ï¼Œäºæ˜¯ç½‘ä¸Šçœ‹å°±æ¨èç”¨Anacondaï¼Œè‡ªå¸¦äº†å¾ˆå¤šåº“å‡½æ•°ï¼Œå¾ˆæ–¹ä¾¿ã€‚</p><p><a href="https://www.anaconda.com/">Anacondaå®˜ç½‘</a></p><p>é€‰ä¸ªç‰ˆæœ¬ä¸‹è½½å®‰è£…å°±è¡Œäº†ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»è£…ä¸ŠAnacondaï¼Œå¯ä»¥å‘ç°å®ƒè‡ªå¸¦äº†å¾ˆå¤šä¸œè¥¿ï¼Œå…¶ä¸­æœ‰å¾ˆå¸¸ç”¨çš„Jupyter Notebookï¼ŒPythonçš„äº¤äº’å¼ç¨‹åºè¿è¡Œæ ¼å¼ã€‚</p><p><img src="https://s2.loli.net/2021/12/24/JpZrz2FkPb35xgO.png" alt="image.png"></p><p>é‚£ä¹ˆå¦‚ä½•åœ¨Pycharmé…ç½®æˆ‘ä»¬çš„Anacondaå‘¢ï¼Ÿ</p><p>å¾ˆç®€å•ï¼Œæˆ‘ä»¬é…ç½®ä¸‹System Interpreterï¼Œç„¶åæŠŠå®ƒæ·»åŠ åˆ°ç¯å¢ƒä¸­å°±è¡Œäº†</p><p><img src="https://s2.loli.net/2021/12/24/vi67nEmXOVgLyjI.png"></p><p><img src="https://s2.loli.net/2021/12/24/BhUYy3D6ulpV4O7.png"></p><p>å°±è¿™æ ·ï¼Œæˆ‘ä»¬å°±æŠŠPycharmçš„è¿è¡Œç¯å¢ƒåˆ‡æ¢åˆ°Anacondaï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸ªç¨‹åºè¯•è¯•</p><p><img src="https://s2.loli.net/2021/12/24/6zWYITc2fNuLbtZ.png"></p><p>å¯ä»¥çœ‹åˆ°å·²ç»ä½¿ç”¨çš„Anacondaçš„python.exeå»è¿è¡Œç¨‹åºäº†ã€‚</p><p>å½“æˆ‘ä»¬éœ€è¦å®‰è£…Anacondaæ²¡æœ‰çš„åº“ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨Pycharmå»å®‰è£…</p><p><img src="https://s2.loli.net/2021/12/24/NhWAqLxHp7U2KsI.png"></p><p>å°±è¿™æ ·ï¼Œæˆ‘ä»¬Pythonçš„åŸºæœ¬ç¯å¢ƒå°±å®‰è£…å¥½äº†ï¼Œå¯ä»¥æ„‰å¿«çš„ç¼–å†™Pythonç¨‹åºäº†ï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»°æœ›æ˜Ÿç©ºï¼Œè„šè¸å®åœ°</title>
    <link href="/2021/10/23/%E4%BB%B0%E6%9C%9B%E6%98%9F%E7%A9%BA%EF%BC%8C%E8%84%9A%E8%B8%8F%E5%AE%9E%E5%9C%B0/"/>
    <url>/2021/10/23/%E4%BB%B0%E6%9C%9B%E6%98%9F%E7%A9%BA%EF%BC%8C%E8%84%9A%E8%B8%8F%E5%AE%9E%E5%9C%B0/</url>
    
    <content type="html"><![CDATA[<p>è¿™å‡ å¤©é—²çš„æ— èŠï¼Œåˆä¸æƒ³çœ‹è®ºæ–‡ï¼Œç´¢æ€§å°±æŠŠè‡ªå·±è¿™å¤§åŠå¹´çš„ç»å†è®°å½•ä¸‹æ¥å§ï¼Œå¸Œæœ›å¯¹ä»¥åè¦æ ¡æ‹›çš„åŒå­¦æœ‰ç”¨ï¼</p><p>åˆ†å››ä¸ªéƒ¨åˆ†ï¼šè€ƒç ”orå°±ä¸šï¼Œä¸“ä¸šç´ å…»çš„åŸ¹å…»ï¼Œæ±‚èŒå†ç¨‹å’Œæ€»ç»“ï¼ŒæŠ€æœ¯ç›¸å…³çš„æˆ‘å°±ä¸€ç¬”å¸¦è¿‡äº†ï¼Œè®©è¿™ç¯‡éšç¬”æ›´å…·å¤§ä¼—åŒ–ã€‚</p><h2 id="è€ƒç ”orå°±ä¸šï¼Ÿ"><a href="#è€ƒç ”orå°±ä¸šï¼Ÿ" class="headerlink" title="è€ƒç ”orå°±ä¸šï¼Ÿ"></a>è€ƒç ”orå°±ä¸šï¼Ÿ</h2><p>è¿™æ˜¯æ¯ä¸ªæœ¬ç§‘ç”Ÿéƒ½ä¼šé¢ä¸´çš„ä¸€ä¸ªé€‰æ‹©ï¼Œå¯èƒ½å¾ˆå¤šåŒå­¦åœ¨å¤§ä¸€éƒ½æŠ±ç€è€ƒç ”çš„å¿ƒæ€ï¼Œç”šè‡³æ˜¯æ›´æ—©ã€‚</p><p>é‚£æˆ‘æƒ³è¯´çš„å°±æ˜¯å‡å¦‚åˆ°å¤§ä¸‰äº†æœ‰è¿™ä¸ªå›°æƒ‘ï¼Œä¸å¾—ä¸åœ¨è€ƒç ”å’Œå°±ä¸šä¸­åšä¸ªé€‰æ‹©ï¼Œè¯´æ˜ä½ è¿˜æ˜¯æœ‰è‡ªå·±çš„æƒ³æ³•ï¼Œæ‡‚å¾—ä¸ºè‡ªå·±çš„å‰ç¨‹ç€æƒ³ï¼Œç»“æœéƒ½ä¸ä¼šå¤ªå·®ï¼</p><p>æˆ‘ä¹Ÿæ˜¯ç»å†è¿‡è¿™ä¸ªæ—¶æœŸï¼Œè€ƒè™‘äº†å¾ˆå¤šï¼Œæ¥ä¸‹æ¥å°±æŠŠæˆ‘è®¤ä¸ºé‡è¦çš„ä¸¤ä¸ªè¦ç´ åˆ—ä¸¾ä¸‹æ¥å§ï¼š</p><ul><li>æ—¶é—´çº¿</li><li>åŠ¨æœº</li></ul><p>æ—¶é—´çº¿çš„æ„æ€æ˜¯ä¸è¦è¿‡æ—©å»æƒ³è€ƒç ”è¿™ä»¶äº‹æƒ…ï¼Œç‰¹åˆ«æ˜¯å¾ˆå¤šåŒå­¦å¤§ä¸€å…¥æ ¡æ¥å°±æƒ³ç€è€ƒç ”ï¼Œå•¥æ´»åŠ¨ä¹Ÿä¸å‚åŠ ï¼ŒåªçŸ¥é“å­¦ä¹ ã€‚è¿™é‡Œæˆ‘ä»¥ä¸¤ä¸ªä¾‹å­æ¥è®ºè¯ï¼š</p><p>ç¬¬ä¸€ä¸ªå°±æ˜¯æˆ‘å¤§ä¸€çš„æ—¶å€™ï¼Œé‡‡è®¿äº†æˆ‘ä»¬å­¦é™¢çš„è€ƒç ”å¯å®¤ï¼Œå½“æ—¶æ˜¯ä½œä¸ºå­¦ç”Ÿä¼šçš„èº«ä»½å»é‡‡è®¿ä»–ï¼Œç„¶ååšä¸€æœŸæ¨æ–‡ï¼Œå› ä¸ºæ˜¯è‡ªå·±å’Œéƒ¨é•¿ä¸€èµ·å»çš„ï¼Œæ‰€ä»¥è®°å¿†éå¸¸æ·±åˆ»ï¼Œè¿™ç¯‡æ¨æ–‡è¿˜åœ¨ç®¡é™¢å¾®ä¿¡å‘å‡ºæ¥äº†ï¼Œé“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s/0Co7VAFDvp8VGIo91V0unA">ã€è€ƒç ”ã€‘æˆ‘ä¸æƒ³åšä¸€ä¸ªç©ºæƒ³å®¶</a>ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯è€ƒç ”æ—¶é—´çº¿çš„æŠŠæ¡ï¼Œ<strong>åº”è¯¥æ˜¯æ­£å¼è€ƒç ”çš„å‰ä¸€å¹´çš„9æœˆå¼€å§‹é€‰æ‹©å’Œå…³æ³¨è€ƒç ”ï¼Œç„¶åå½“å¹´3æœˆå¼€å§‹ï¼Œä¸€ç›´åˆ°12æœˆä¸Šæˆ˜åœº</strong>ã€‚å­¦é•¿å‘Šè¯«å°±æ˜¯ä¸è¦æŠŠæˆ˜çº¿æ‹‰çš„å¤ªé•¿äº†ï¼Œè¿™æ ·å¾ˆå°‘èƒ½åšæŒä¸‹æ¥ã€‚å¤§ä¸€å°±å¤šå‚åŠ äº›æ´»åŠ¨ï¼Œå……å®è‡ªå·±çš„å¤§å­¦ç”Ÿæ´»ã€‚</p><p>ç¬¬äºŒä¸ªå°±æ˜¯æˆ‘çš„å¥½æœ‹å‹ï¼Œæœ¬ç§‘åŒ—å¤–çš„ï¼Œä»Šå¹´ä¸Šå²¸çš„å•†åŠ¡éƒ¨ç›´å±ç ”ç©¶é™¢ï¼Œå½“ç„¶å¥¹çš„äº‹è¿¹æ²¡æœ‰å¹¿æ³›æ€§ï¼Œè¿™é‡Œåªæ˜¯æä¸€ä¸‹ã€‚å¥¹æœ¬ç§‘æ–°é—»çš„ï¼Œå› ä¸ºåŒ—äº¬ç–«æƒ…5æœˆæ‰å»å­¦ä¹ ï¼Œç„¶åæ‰å¼€å§‹å‡†å¤‡è€ƒç ”çš„ï¼Œè·¨è€ƒé‡‘èï¼Œè‡ªå­¦çº¿ä»£æ¦‚ç‡è®ºâ€¦â€¦ï¼Œå› ä¸ºæ–°é—»æ˜¯ä¸å­¦æ•°å­¦çš„ï¼Œè€ƒç ”å°±æ˜¯å®Œå…¨è‡ªå­¦çš„ã€‚é—®äº†ä¸‹å¥¹ï¼Œå¥¹è¯´å¯èƒ½è„‘è¢‹æ¯”è¾ƒèªæ˜å§ï¼Œæ¯•ç«Ÿå½“æ—¶é«˜è€ƒåˆ†æ•°æ˜¯å¯ä»¥å»985çš„ï¼Œå› ä¸ºå…´è¶£é€‰æ‹©äº†åŒ—å¤–ï¼Œåé¢ç¡®å®šè€ƒç ”æ–¹å‘ï¼Œå°±ä¸“å¿ƒé«˜æ•ˆç‡å¤‡è€ƒã€‚</p><p>æ€»çš„æ¥è¯´å°±æ˜¯æ—¶é—´çº¿ï¼Œä¸èƒ½æ‹‰å¤ªé•¿ï¼Œè¿™æ ·å¾ˆå°‘èƒ½æŠ—ä½é«˜å¼ºåº¦å­¦ä¹ çš„ï¼Œåˆ°çœŸæ­£å‡†å¤‡è€ƒç ”å†²åˆºé˜¶æ®µå°±å¿ƒæœ‰åŠ›è€ŒåŠ›ä¸è¶³äº†ã€‚</p><p>åŠ¨æœºï¼Œå…¶å®æˆ‘åˆšè¿›å­¦ä¹ å°±æ˜¯æŠ±ç€æ‰¾å·¥ä½œçš„å¿ƒæ€ï¼Œä¸æƒ³è€ƒç ”ï¼Œå› ä¸ºè‡ªå·±æœ‰ä¸¥é‡çš„è€ƒè¯•ç„¦è™‘ç—‡ï¼</p><p>ä½†çˆ¶æ¯å› ä¸ºæ–‡åŒ–ä¸é«˜ï¼Œå°±æƒ³ç€å¤šè¯»ç‚¹ä¹¦æ€»å½’æ˜¯å¥½çš„ï¼Œå°±è®©æˆ‘å†æƒ³æƒ³è€ƒç ”çš„äº‹æƒ…ã€‚å»å¹´10æœˆæˆ‘æƒ³äº†æ•´æ•´ä¸€ä¸ªæœˆå§ï¼Œå¤šæ–¹å’¨è¯¢ï¼Œæœ€ç»ˆé€‰æ‹©ç›´æ¥æ‰¾å·¥ä½œã€‚</p><p>æˆ‘å°±æ˜¯æŠŠè€ƒç ”çš„ä¼˜åŠ¿ï¼ŒåŠ£åŠ¿éƒ½åˆ—ä¸¾å‡ºæ¥ï¼Œç„¶åå»è¯·æ•™è€ƒç ”å’Œå°±ä¸šçš„å­¦é•¿å­¦å§ï¼Œç„¶åè‡ªå·±å†æŠŠå»ºè®®ç»¼åˆï¼Œå¯èƒ½æ–¹æ³•ç¬¨ç¬¨çš„ï¼Œä½†æ„Ÿè§‰å¾ˆæœ‰æ•ˆï¼</p><p><img src="https://i.loli.net/2021/10/23/YGRdlevNUO5JswH.png"></p><p>æœ€å¼€å§‹æ˜¯17çº§çš„å­¦é•¿å­¦å§ï¼Œå‡ ä¸ªéƒ½æ˜¯è€ƒç ”çš„ï¼Œéƒ½å«æˆ‘è€ƒç ”ã€‚ç„¶åé—®äº†16çº§åœ¨ç™¾åº¦å·¥ä½œçš„å­¦å§ï¼Œæˆ‘æŠŠæˆ‘çš„æƒ…å†µç»™å¥¹è¯´äº†ï¼Œå¥¹ä¹Ÿæ²¡ç›´æ¥è¯´è€ƒç ”è¿˜æ˜¯å°±ä¸šï¼Œä½†å¸¦ç€è€ƒè¯•ç„¦è™‘ç—‡å»è€ƒç ”é£é™©å¤ªå¤§äº†ï¼Œè¶è¿™ä¸ªæ—¶å€™å»å¤šåˆ·é¢˜ï¼Œåšåšé¡¹ç›®å¯èƒ½ä¼šæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚æˆ‘ä¹Ÿæ€è€ƒäº†å‡ å¤©ï¼Œæœ€ç»ˆå†³å®šä¸è€ƒç ”ï¼Œæ‰¾å·¥ä½œäº†ï¼</p><p>å…¶æ¬¡ï¼Œæˆ‘è¿˜äº†è§£åˆ°ä¸€äº›å…³äºè¿™å—çš„ä¿¡æ¯ï¼Œç°åœ¨985211é«˜æ ¡ä¿ç ”ç‡å¤ªé«˜äº†ï¼Œå åˆ°äº†60%~70%ï¼Œå¤–æ ¡æƒ³è€ƒè¿›å»ï¼Œéš¾åº¦å¾ˆå¤§ï¼Œä¸ªåˆ«ä¸“ä¸šå°±æ˜¯ç¥ä»™æ‰“æ¶ã€‚å¦å¤–ï¼Œè¦æ˜¯æƒ³å€ŸåŠ©è€ƒç ”ï¼Œæ¥æ‰¾åˆ°ä¸ªå¥½ä¸€ç‚¹çš„å·¥ä½œï¼Œè¿™åŠ¨æœºä¸å¼ºï¼Œå¾ˆå®¹æ˜“åœ¨ä¸­é€”å´©æºƒçš„ï¼å¯¹äºç”ŸåŒ–ç¯ææ–™åŒ»å­¦ç­‰ä¸“ä¸šï¼Œä¸è€ƒç ”ï¼ŒåŸºæœ¬ä¸Šæ²¡å‡ºè·¯ï¼Œå°±æ–­äº†æ‰¾å·¥ä½œçš„å¿µæƒ³ï¼Œå°±ä¸å¾—ä¸æ‹¿å‡ºç ´é‡œæ²‰èˆŸçš„å†³å¿ƒäº†ã€‚</p><h2 id="ä¸“ä¸šç´ å…»çš„åŸ¹å…»"><a href="#ä¸“ä¸šç´ å…»çš„åŸ¹å…»" class="headerlink" title="ä¸“ä¸šç´ å…»çš„åŸ¹å…»"></a>ä¸“ä¸šç´ å…»çš„åŸ¹å…»</h2><p>ä»€ä¹ˆå«ä¸“ä¸šç´ å…»ï¼Ÿè¯´é€šä¿—ç‚¹å°±æ˜¯å¤–äººå¬ä¸æ‡‚ï¼Œå†…è¡Œä¹‹é—´äº¤æµç”¨çš„ä¸œè¥¿ã€‚æˆ‘ä»¥ä¸ºä¸“ä¸šç´ å…»åŒ…æ‹¬ä¸“ä¸šæŠ€èƒ½çŸ¥è¯†å’Œè¡Œä¸šé¢†åŸŸçš„ä¿¡æ¯ï¼Œå°±æ¯”å¦‚äº’è”ç½‘çš„å†œæ°‘å·¥è‚¯å®šçŸ¥é“ä»€ä¹ˆå«è™šæ‹Ÿæœºï¼Œå¾®æœåŠ¡ï¼ŒDDDç­‰ç­‰ï¼Œè¿™äº›å¯ä»¥åœ¨å­¦ä¹ æŠ€æœ¯çš„æ—¶å€™å­¦åˆ°ã€‚</p><p>ä½†æ•´ä¸ªè¡Œä¸šé¢†åŸŸçš„æƒ…å†µä¿¡æ¯å°±ä¸ä¸€å®šèƒ½åœ¨å­¦ä¹ æŠ€èƒ½çš„æ—¶å€™çœ‹åˆ°äº†ï¼Œå°±æ¯”å¦‚ä»Šå¹´åŒå‡æ”¿ç­–å¯¹K12ä¼ä¸šå‘å±•çš„å½±å“ï¼Œæœ‰å¤šå°‘å…¬å¸è£å‘˜äº†ï¼Ÿè£å‘˜åçš„è¡¥å¿æªæ–½å¦‚ä½•ï¼Ÿå†æ¯”å¦‚ä¸€é—¨æŠ€æœ¯çš„å‘å±•å‰æ™¯ï¼Œå®¢æˆ·ç«¯å…¶å®ç°åœ¨å­¦çš„æ„ä¹‰å°±ä¸å¤§ï¼Œå®‰å“ä¹Ÿæ˜¯ï¼Œå› ä¸ºé¢å¤ªç‹­éš˜äº†ï¼Œå¯¹æ ‡å²—ä½å°‘ã€‚</p><p>æˆ‘å¹³æ—¶å¯¹è¡Œä¸šé¢†åŸŸä¿¡æ¯çš„æ‘„å–åŒ…æ‹¬å¾®ä¿¡å…¬ä¼—å·ï¼ŒçŸ¥ä¹å’Œæ˜é‡‘è¿™ç§è®ºå›ï¼Œå…¶å®æˆ‘ä¸æ€ä¹ˆçˆ±çœ‹é•¿ç¯‡å¤§è®ºï¼Œæ‰€ä»¥é€‰æ‹©æ¦‚æ‹¬æ€§å’Œæ€»ç»“æ€§æ¯•ç«Ÿå¼ºçš„å…¬ä¼—å·å»é˜…è¯»æ˜¯ä¸€ç§ä¸é”™çš„é€‰æ‹©ï¼Œæ¯”å¦‚36æ°ªç­‰ç­‰ã€‚</p><h2 id="æ±‚èŒå†ç¨‹"><a href="#æ±‚èŒå†ç¨‹" class="headerlink" title="æ±‚èŒå†ç¨‹"></a>æ±‚èŒå†ç¨‹</h2><p>åˆ†æ˜¥æ‹›å®ä¹ å’Œç§‹æ‹›å§</p><p>å› ä¸ºæˆ‘æ˜¯22å±Šæ¯•ä¸šç”Ÿï¼Œæ‰€ä»¥ä»Šå¹´çš„æ˜¥æ‹›åªèƒ½æŠ•å®ä¹ ï¼Œä¸èƒ½æŠ•æ­£å¼æ‰¹ï¼ˆæ­£å¼æ‰¹è¦æ±‚21å±Šï¼‰ï¼Œå…·ä½“å†…å®¹æˆ‘å°±ä¸å±•å¼€äº†ï¼Œå› ä¸ºç¡®å®è›®æ¯ç‡¥æ— å‘³ã€‚æ€»çš„æ¥è¯´å°±æ˜¯<strong>è§„åˆ’+è‡ªå¾‹</strong>ã€‚</p><p>éœ€è¦ç®€å•ä»‹ç»ä¸‹ç§‹æ‹›å’Œæ˜¥æ‹›ï¼Œç§‹æ‹›æ˜¯å½“å¹´çš„7-11æœˆï¼Œä¼ä¸šæœ€å¤šï¼Œå²—ä½æœ€å¤šï¼Œæ‹›è˜äººæ•°æœ€å¤šï¼Œæ‰€ä»¥ä¸€å®šè¦æŠŠæ¡å¥½ç§‹æ‹›ã€‚æ˜¥æ‹›æ˜¯æ¬¡å¹´çš„3-6æœˆï¼Œä¼ä¸šå’Œå²—ä½å°±è›®å°‘äº†ï¼Œæœ‰çš„ä¼ä¸šåœ¨ç§‹æ‹›æ‹›æ»¡çš„æƒ…å†µä¸‹ï¼Œå°±ä¸ä¼šè¿›è¡Œæ˜¥æ‹›äº†ã€‚</p><p>è§„åˆ’ï¼Œå› ä¸ºè‡ªå·±ä»20å¹´ä¸ŠåŠå¹´çš„ç–«æƒ…å°±å¼€å§‹åœ¨å®¶å­¦ä¹ ï¼Œå­¦äº†å¤§åŠå¹´ï¼Œä¹Ÿæœ‰ä¸€å®šæŠ€æœ¯æ²‰æ·€äº†ï¼Œå°±çŸ¥é“è‡ªå·±æ¥ä¸‹æ¥åº”è¯¥åšä»€ä¹ˆï¼Œæ˜¯ç»§ç»­å­¦è¿˜æ˜¯åšä¸ªé¡¹ç›®å‡ºæ¥æ£€éªŒä¸‹è‡ªå·±è¿™æ®µæ—¶é—´çš„æ”¶è·ã€‚</p><p>æˆ‘æ˜¯æ„å‘å²—ä½æ˜¯Javaç ”å‘å·¥ç¨‹å¸ˆï¼Œå‡†å¤‡çš„ä¸œè¥¿åŒ…æ‹¬ï¼š</p><ul><li>JavaåŸºç¡€</li><li>JVM</li><li>Mysql</li><li>Redis</li><li>Linux</li><li>æ“ä½œç³»ç»Ÿ</li><li>è®¡ç®—æœºç½‘ç»œ</li><li>æ•°æ®ç»“æ„å’Œç®—æ³•</li><li>é¡¹ç›®</li><li>æ¡†æ¶ï¼ŒåŒ…æ‹¬Springå…¨å®¶æ¡¶ï¼Œå¾®æœåŠ¡ç­‰ç­‰</li></ul><p>å“ˆå“ˆå“ˆï¼Œä¸Šé¢çš„ä¸œè¥¿è¦æ˜¯çœ‹ä¸æ‡‚å¯ä»¥ç›´æ¥è·³è¿‡ï¼Œå› ä¸ºæœ¯ä¸šæœ‰ä¸“æ”»ï¼Œä½ æ‡‚çš„ï¼Œå¯èƒ½æˆ‘ä¹Ÿä¸æ‡‚ï¼Œåšå¥½è‡ªå·±å°±å¥½äº†ï¼</p><p>å› ä¸º20å¹´æ—¶é—´å°±æŠ“çš„æ¯”è¾ƒç´§ï¼Œæ‰€ä»¥ä½¿ç”¨è¿™å—æ²¡å•¥å¤§é—®é¢˜ï¼Œä½†å› ä¸ºæ˜¯éç§‘ç­ï¼Œæ‰€ä»¥è®¡ç®—æœºåº•å±‚çŸ¥è¯†å°±éœ€è¦æ¶è¡¥äº†ï¼Œæ‰€ä»¥21å¹´å°±æ¶è¡¥åº•å±‚çŸ¥è¯†ï¼Œå†åˆ·ç®—æ³•é¢˜ï¼Œå‡†å¤‡é¡¹ç›®ï¼Œä¿®æ”¹ç®€å†ï¼ŒæŠ•é€’ç®€å†ã€‚</p><p><img src="https://i.loli.net/2021/10/23/i3HYbLJCzenq6BU.png"></p><p><img src="https://i.loli.net/2021/10/23/mjUVJd9RXwkB82T.png"></p><p>è‡ªå·±ä¹Ÿæœé›†äº†å¾ˆå¤šèµ„æºï¼Œå¤§éƒ¨åˆ†éƒ½çœ‹è¿‡ï¼Œå…¶ä¸­åŒ…æ‹¬bç«™å’Œæœ¬åœ°200å¤šGçš„ï¼Œä¹Ÿä¸çŸ¥é“å†™äº†å¤šå°‘è¡Œä»£ç â€¦â€¦</p><p>4æœˆ5æœˆå¼€å§‹æ‰¾å®ä¹ ï¼Œè‡ªå·±æŠ•çš„ç¬¬ä¸€å®¶å…¬å¸æ˜¯å­—èŠ‚è·³åŠ¨ï¼Œæ˜¯ä¸€ä½æœ‹å‹å†…æ¨çš„ï¼Œå¾ˆé—æ†¾ï¼Œç®€å†æ²¡è¿‡ï¼Œå“ˆå“ˆå“ˆå“ˆ</p><p>é˜¿é‡Œä¹ŸæŠ•äº†ï¼Œéƒ½ç¬”è¯•äº†ï¼Œä½†ç®€å†æ²¡è¿‡ã€‚ä¹ŸæŠŠå‰©ä¸‹çš„å¤§å‚æŠ•äº†ç»™éï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯çŸ³æ²‰å¤§æµ·æˆ–è€…æ”¶åˆ°æ„Ÿè°¢ä¿¡ï¼Œå¤ªéš¾äº†ã€‚</p><p><img src="https://i.loli.net/2021/10/23/vLqnhm54HGMA7oI.png"></p><p>è‡ªå·±å°±é—®äº†ä¸‹å·²ç»åœ¨å·¥ä½œçš„å­¦é•¿å­¦å§ï¼Œå«æˆ‘ä¸è¦ç›¯ç€å¤§å‚æŠ•ï¼Œæˆ‘ä»¬å­¦æ ¡ä¸å¥½ï¼Œå¾ˆéš¾ç»™é¢è¯•æœºä¼šçš„ï¼Œæ‰¾å®ä¹ å»è¯•è¯•ä¸­å°å‚å§ã€‚äºæ˜¯æ¢äº†ç»™æ–¹å‘ï¼Œæ‹¿äº†å‡ ä¸ªä¸­å°å‚çš„å®ä¹ offerï¼Œæœ€ç»ˆé€‰æ‹©äº†æ­¦æ±‰çš„ä¸€å®¶å…¬å¸å®ä¹ ã€‚</p><p>å®ä¹ ä¹Ÿå°±ä¸€ä¸ªæœˆå§ï¼Œæ„Ÿè§‰å’Œæˆ‘æƒ³å¾—ä¸ä¸€æ ·ï¼Œå°±è¾äº†ï¼Œå‡†å¤‡ç§‹æ‹›æå‰æ‰¹ã€‚</p><p>è‡ªå·±ä¹Ÿæ­å»ºäº†ä¸€ä¸ªåšå®¢ï¼Œæ²¡äº‹å°±å†™ä¸€äº›ä¸œè¥¿</p><p><img src="https://i.loli.net/2021/10/23/KhEBkwRY3uAlbLj.png"></p><p>æ¯å¤©éƒ½ä¼šåœ¨Leetcodeä¸Šåˆ·ç®—æ³•é¢˜ï¼Œç‰›å®¢ä¸Šåˆ·ç®—æ³•é¢˜ã€ç¼–ç¨‹åŸºç¡€å’ŒSQLè®­ç»ƒ</p><p>Leetcode</p><p><img src="https://i.loli.net/2021/10/23/vka5BXgMhHLQqb3.png"></p><p>ç‰›å®¢ç½‘</p><p><img src="https://i.loli.net/2021/10/23/mZAwB6RH3hDavuj.png"></p><p>æ‰¾å·¥ä½œçš„åŒå­¦ä¸€å®šè¦ä¸‹ä¸ªç‰›å®¢ç½‘ï¼Œé‡Œé¢å¾ˆå¤šå†…æ¨å’Œé¢ç»çš„ï¼Œæ¯”BOSSæ‹›è˜ç­‰APPæµç¨‹å¿«</p><p>è¯´å®è¯æˆ‘çœŸä»¥ä¸ºç§‹æ‹›çš„é»„é‡‘æ—¶é—´æ˜¯9æœˆå’Œ10æœˆï¼Œä½†å½“æˆ‘å…³æ³¨çš„ä¼ä¸šæ‹›è˜å…¬ä¼—å·ç»™æˆ‘æ¨é€æå‰æ‰¹å¼€å¯äº†ï¼Œè¿˜æ˜¯7æœˆåˆï¼Œæˆ‘äººå‚»äº†ï¼Œè¿™æ˜¯ä¸æ˜¯å¤ªæ—©äº†å•Šï¼Œç›¸ç»§æœ‰å¾ˆå¤šå®¶ä¼ä¸šéƒ½å¼€äº†æå‰æ‰¹ï¼Œäºæ˜¯æˆ‘ä¸å¾—ä¸åŠ å¿«æ­¥ä¼ï¼Œå‡†å¤‡æŠ•ç®€å†äº†ã€‚</p><p>7æœˆ8æœˆè‡ªå·±ç”³è¯·ç•™æ ¡å­¦ä¹ äº†ï¼Œå› ä¸ºç–«æƒ…ï¼Œå®Œå…¨å°æ ¡ï¼Œå‹æ ¹å‡ºä¸å»ï¼Œé£Ÿå ‚åªå¼€ä¸€æ¥¼ï¼Œå¤©å¤©éƒ½æ˜¯é‚£å‡ ä¸ªèœï¼Œå·®ç‚¹æŠŠæˆ‘åƒåäº†ã€‚</p><p>æ¯å¤©éƒ½æ˜¯åˆ·é¢˜ï¼ŒèƒŒé¢ç»ï¼Œåˆ·é¢˜ï¼ŒèƒŒé¢ç»ï¼Œæ™šä¸Šä¸€ä¸ŠåºŠéƒ½èƒ½ç¡ç€ï¼ŒçœŸçš„å¤ªç´¯äº†ï¼å½“æ—¶æ˜¯åœ¨513è‡ªä¹ å®¤ï¼Œå…¶å®é‡Œé¢éƒ½æ˜¯è€ƒç ”çš„ï¼Œå°±æˆ‘ä¸€ä¸ªæ‰¾å·¥ä½œçš„åœ¨é‡Œé¢è¹­ç©ºè°ƒï¼Œæ¯å¤©æ—©7æ™š9çš„ç”Ÿæ´»ï¼Œæ´»å¾—è·Ÿä¸ªè€ƒç ”äººä¸€æ ·ï¼Œå¯èƒ½ç›®æ ‡å¾ˆæ˜ç¡®å§ï¼Œå…¶å®æœ‰æ—¶å€™å¹¶æ„Ÿè§‰ä¸åˆ°ç´¯ã€‚</p><p><img src="https://i.loli.net/2021/10/23/Y5IJvazXsuqVhKF.png"></p><p>æˆ‘æ¯å‘¨äº”ä¸‹åˆå°±æ˜¯ä¸ªç–²æƒ«æœŸï¼Œæˆ‘é‚£ä¸ªæ—¶å€™ä¸ä¼šå­¦ä¹ ï¼Œå°±çœ‹çœ‹ç”µå½±ï¼Œæœ‰æ—¶å€™ä¸€çœ‹å°±æ˜¯ä¸€ä¸‹åˆå’Œä¸€æ™šä¸Šã€‚å› ä¸ºæˆ‘ä¸€ç›´åšä¿¡å­¦ä¹ ä¸æ˜¯æ‹¼æ—¶é—´ï¼Œè€Œæ˜¯æ‹¼æ•ˆç‡ï¼ŒçŠ¶æ€ä¸å¥½å°±è¦ä¼‘æ¯ä¸‹ã€‚</p><p><img src="https://i.loli.net/2021/10/23/w7G8xluM5hqVIAi.jpg"></p><p>æˆ‘ä¸ä»…ä»…æ˜¯ä¸€åJavaé€‰æ‰‹ï¼Œè¿˜æ˜¯ä¸€åæ„Ÿè°¢ä¿¡æ”¶å‰²æœºï¼</p><p><img src="https://i.loli.net/2021/10/23/zheERuj6MoXdf23.jpg"></p><p>è™½ç„¶å¾ˆç´¯ï¼ŒåšæŒä¸‹å»å°±ä¸€å®šä¼šæœ‰ç»“æœï¼Œè™½ç„¶ç¬”è¯•è¿™ä¹ˆå¤šä¹…ï¼Œå°±å‡ å®¶ç»™é¢äº†ï¼Œä½†ç»™é¢çš„åŸºæœ¬ä¸Šéƒ½æ‹¿ä¸‹äº†ï¼Œæœ€ç»ˆé€‰æ‹©äº†æ¯”è¾ƒå¿ƒä»ªçš„ä¸€å®¶ã€‚å…¶å®åé¢è¿˜åœ¨ç­‰å…¶å®ƒçš„ï¼Œä½†ä¸€ç›´æ²¡æœ‰æ¯”è¿™å®¶å¥½çš„ï¼Œç§‹æ‹›ä¹Ÿæ¥è¿‘å°¾å£°ï¼Œå‘ä½éƒ½æ»¡äº†ï¼Œè‡ªå·±ä¹Ÿæ²¡æ›´å¥½çš„é€‰æ‹©ï¼Œå°±èººå¹³äº†ã€‚</p><p><img src="https://i.loli.net/2021/10/23/Er3Q2BHOtUJDi45.png"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»ç¡®å®šèµ°è¿™ä¸ªæ–¹å‘ï¼Œå°±ä¸€ç›´æ²¡æœ‰æ”¹å˜è¿‡ï¼Œå¯èƒ½ä¸­é€”ä¼šæ€€ç–‘è‡ªå·±çš„èƒ½åŠ›ï¼Œä½†åŠæ—¶è°ƒæ•´æ–¹å‘å°±å¥½äº†ã€‚</p><p>å¯¹äºæˆ‘è¿™ä¸ªèŒä¸šï¼ŒæŠ€æœ¯æ›´æ–°è¿­ä»£éå¸¸å¿«ï¼Œéœ€è¦ä¸€ç›´å­¦ä¹ ã€‚è¿™å°±éœ€è¦ä¿æŒç»ˆç”Ÿå­¦ä¹ çš„å¥½ä¹ æƒ¯ï¼Œå…¶å®ç°åœ¨å¾ˆå¤šè¡Œä¸šéƒ½è¿™æ ·ï¼Œæ²¡æœ‰ä¸€é—¨æŠ€æœ¯ä»å…¥èŒåˆ°è€çš„ï¼Œéƒ½éœ€è¦ä¸æ–­å­¦ä¹ ï¼Œä¸æ–­æ”¹è¿›ã€‚</p><p>æœ€åï¼Œ<strong>å¸Œæœ›æ‰¾å·¥ä½œçš„åŒå­¦ä¸€åˆ‡é¡ºåˆ©ï¼Œè€ƒç ”çš„åŒå­¦ä¸€æˆ˜æˆç¡•ï¼</strong></p>]]></content>
    
    
    
    <tags>
      
      <tag>éšç¬”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç»¿ç›Ÿç ”å‘ä¸€äºŒä¸‰é¢ å·²OC</title>
    <link href="/2021/09/02/%E7%BB%BF%E7%9B%9F%E7%A0%94%E5%8F%91%E4%B8%80%E4%BA%8C%E4%B8%89%E9%9D%A2-%E5%B7%B2OC/"/>
    <url>/2021/09/02/%E7%BB%BF%E7%9B%9F%E7%A0%94%E5%8F%91%E4%B8%80%E4%BA%8C%E4%B8%89%E9%9D%A2-%E5%B7%B2OC/</url>
    
    <content type="html"><![CDATA[<h1 id="ç»¿ç›Ÿç§‘æŠ€"><a href="#ç»¿ç›Ÿç§‘æŠ€" class="headerlink" title="ç»¿ç›Ÿç§‘æŠ€"></a>ç»¿ç›Ÿç§‘æŠ€</h1><h2 id="ä¸€é¢"><a href="#ä¸€é¢" class="headerlink" title="ä¸€é¢"></a>ä¸€é¢</h2><blockquote><p>2021å¹´8æœˆ19æ—¥ 10:00-10:42 HRç”µè¯æå‰çº¦äº†é¢è¯•æ—¶é—´ï¼Œé€šè¿‡é‚®ç®±å‘äº†è…¾è®¯ä¼šè®®IDï¼Œé¢è¯•å®˜å¾ˆå‡†æ—¶ï¼Œè€Œä¸”æ˜¯ä¸ªå§å§ å“ˆå“ˆå“ˆ</p></blockquote><ol><li><p>è‡ªæˆ‘ä»‹ç»+é¡¹ç›®ï¼Œè¿™é‡Œè®²äº†å¾ˆä¹…ï¼Œè®²äº†è‡ªå·±åœ¨æ¯ä¸ªé¡¹ç›®çš„è§’è‰²å’Œä»»åŠ¡åˆ†å·¥ï¼Œæåˆ°äº†æ•°æ®åº“è®¾è®¡</p></li><li><p>å°±è®²äº†ä¸‹è‡ªå·±åœ¨å¼€å‘ä¸­é‡åˆ°çš„æ•°æ®åº“è®¾è®¡ï¼Œä»¥åŠè‡ªå·±å¼€å‘ä¸­é‡åˆ°æ•°æ®åº“è®¾è®¡é‡åˆ°çš„å‘</p></li><li><p>SQLä¼˜åŒ–ï¼Œé¢è¯•å¿…é—®â€”&gt;æŸ¥è¯¢å­—æ®µï¼Œæ•°æ®åº“è®¾è®¡ï¼Œèµ°ç´¢å¼•ï¼Œç´¢å¼•å¤±æ•ˆï¼Œåˆ›å»ºç´¢å¼•ï¼Œå•è¡¨æ•°æ®è¿‡å¤§è¦åˆ†è¡¨</p></li><li><p>ç»¿ç›Ÿä¸»è¦ä¸šåŠ¡ï¼Ÿå§æ§½ï¼Œè¿™ä¸ªçœŸä¸çŸ¥é“ï¼Œæµ·æŠ•çš„ï¼Œåé¢æŸ¥äº†ä¸‹æ˜¯å’Œé˜¿é‡Œäº‘ï¼Œå¥‡å®‰ä¿¡ï¼Œæ·±ä¿¡æœå¹¶åˆ—çš„ç½‘ç»œå®‰å…¨å…¬å¸</p></li><li><p>éƒ½æ˜¯SpringBooté¡¹ç›®å¯¹å§ï¼Œå¦‚ä½•è€ƒè™‘ä¸€ä¸ªSpringBooté¡¹ç›®çš„å®‰å…¨ï¼Ÿï¼ˆç»¿ç›Ÿå°±æ˜¯å›½å†…æ•°ä¸€æ•°äºŒçš„åšå®‰å…¨çš„ä¼ä¸šï¼‰ï¼Œæˆ‘å°±è¯´äº†ä¸‹å¹³æ—¶æ³¨æ„çš„ï¼š</p><ul><li>server.port ä¸ç”¨å¸¸ç”¨ç«¯å£</li><li>æ•°æ®åº“è§’è‰²ï¼Œä¸ç›´æ¥ä½¿ç”¨root</li><li>å¯†ç ï¼Œç”¨ç½‘ç«™éšæœºç”Ÿæˆ</li><li>token+æ‹¦æˆªå™¨</li><li>ç»Ÿä¸€å¼‚å¸¸è¿”å›</li><li>å‡å¦‚æœ‰å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è¾“å…¥ï¼Œè¦è½¬ä¹‰ï¼Œé˜²æ­¢XSS</li></ul></li><li><p>SpringBootå¦‚ä½•è§£å†³è·¨åŸŸï¼Ÿå¹³æ—¶å¼€å‘å¸¸å¸¸ç”¨ï¼Œè®²äº†ä¸‹è·¨åŸŸå°±æ˜¯å¯¹æºåœ°å€å’Œç«¯å£çš„é™å®šï¼Œä¸€èˆ¬è§£å†³æ–¹æ¡ˆæ˜¯åœ¨Controllerçš„æ¥å£é‚£åŠ ä¸Š@CorssOriginï¼ˆè‡ªå·±è¯•è¿‡ï¼Œæ²¡æˆåŠŸï¼‰ï¼Œè‡ªå·±ä¸€ç›´æ˜¯å†™çš„WebCorsConfigï¼Œé…ç½®å…¨å±€è·¨åŸŸè¯·æ±‚ï¼Œå°±æ˜¯è®¾ç½®æºåœ°å€ï¼Œè¯·æ±‚å¤´å’Œæ–¹æ³•çš„é…ç½®</p></li><li><p>é‚£è¯´è¯´CSRFå§ ï¼Ÿè§£å†³æ–¹æ¡ˆ? è·¨ç«™è¯·æ±‚ä¼ªé€ </p></li><li><p>Mybatisåˆ†é¡µæ’ä»¶ç”¨è¿‡å—ï¼Ÿåº•å±‚å®ç°çœ‹è¿‡æ²¡ï¼Ÿ PageHelperå˜›ï¼Œç”¨è¿‡ï¼Œä¸è¿‡æ²¡çœ‹è¿‡åº•å±‚ï¼Œä¸è¿‡çŸ¥é“Mysqlå¦‚ä½•åˆ†é¡µï¼š</p><ul><li>select * from table limit pageSize offset PageNo</li><li>è¡¨çš„æ•°æ®è¿‡å¤šï¼Œå€ŸåŠ©idåˆ†é¡µï¼Œselect * from table where id &gt; pageNo * pageSize limit pageSize</li></ul><p>PageHelperåº•å±‚åº”è¯¥ä¹Ÿæ˜¯è¿™æ ·çš„</p></li><li><p>å­˜å‚¨è¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘è¯´äº†ä¸‹ï¼Œè¿™ä¸ªä¸œè¥¿è¯´å®è¯åº”è¯¥æ˜¯ä¸ä¼šç”¨äº†å§ï¼Œæ‰€ä»¥å¤ä¹ çš„æ—¶å€™éƒ½æ²¡çœ‹ï¼Œä½†è‡ªå·±å†™è¿‡å­˜å‚¨è¿‡ç¨‹ï¼Œè¿˜æ˜¯çŸ¥é“ä¸€ç‚¹ï¼Œä¸‹é¢è¯¦ç»†è§£é‡Šä¸‹ï¼š</p><p>ä¸€ç»„ä¸ºäº†å®Œæˆç‰¹å®šåŠŸèƒ½çš„SOLè¯­å¥é›†ï¼Œå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œç»è¿‡ä¸€æ¬¡ç¼–è¯‘åä¸éœ€è¦å†æ¬¡ç¼–è¯‘ã€‚ç”¨æˆ·é€šè¿‡æŒ‡å®šå­˜å‚¨è¿‡ç¨‹çš„åå­—å¹¶ç»™å‡ºå‚æ•°æ¥æ‰§è¡Œå®ƒã€‚å­˜å‚¨è¿‡ç¨‹æ˜¯æ•°æ®åº“ä¸­çš„å¯¹è±¡ã€‚</p><p>å¯ä»¥é€šè¿‡ä¸€ä¸ªå‘½ä»¤å¯¹è±¡æ¥è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼›ä¹Ÿå¯ä»¥ä¾›å¤–éƒ¨è°ƒç”¨ï¼Œæ¯”å¦‚javaç¨‹åºã€‚</p><p>å…¶ä¼˜ç‚¹æ˜¯ï¼šç»è¿‡é¢„ç¼–è¯‘ï¼Œæ‰§è¡Œæ•ˆç‡é«˜ï¼›ä»£ç ç›´æ¥å­˜åœ¨æ•°æ®åº“ï¼Œé€šè¿‡å­˜å‚¨è¿‡ç¨‹åè°ƒç”¨ï¼Œå‡å°‘ç½‘ç»œé€šä¿¡ï¼›å®‰å…¨æ€§é«˜ï¼Œæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹éœ€è¦æœ‰ä¸€å®šæƒé™çš„ç”¨æˆ·ï¼›å¯é‡å¤ä½¿ç”¨ï¼Œå‡å°‘å¼€å‘äººå‘˜å·¥ä½œé‡ã€‚</p><p>å…¶ç¼ºç‚¹æ˜¯ç§»æ¤æ€§å·®ã€‚</p><p>å­˜å‚¨è¿‡ç¨‹ä¸­çš„ä¼˜åŒ–æ€è·¯æœ‰ï¼š</p><ul><li>å°½é‡åˆ©ç”¨sqlè¯­å¥æ›¿ä»£å°å¾ªç¯</li><li>ä¸­é—´ç»“æœå­˜æ”¾äºä¸´æ—¶è¡¨ï¼ŒåŠ ç´¢å¼•</li><li>å°‘ä½¿ç”¨æ¸¸æ ‡</li><li>äº‹åŠ¡è¶ŠçŸ­è¶Šå¥½ï¼Œäº‹åŠ¡è¿‡é•¿æˆ–éš”ç¦»çº§åˆ«è¿‡é«˜ä¼šé€ æˆå¹¶å‘æ“ä½œé˜»å¡ã€‚æ­»é”ï¼Œå¯¼è‡´æŸ¥è¯¢åŠæ…¢ã€CPUå ç”¨ç‡æä½</li><li>ä½¿ç”¨trycatchå¤„ç†é”™è¯¯å¼‚å¸¸</li><li>æŸ¥è¯¢è¯­å¥å°½é‡ä¸è¦æ”¾åœ¨å¾ªç¯å†…</li></ul></li><li><p>Redisç¼“å­˜é›ªå´©ï¼Ÿè§£å†³æ–¹æ¡ˆï¼Ÿ</p></li><li><p>è€ƒè™‘è½¬è¯­è¨€ï¼Ÿ å•¥æ„æ€ï¼Œé¢è¯•å®˜è¯´çœ‹è‡ªæ„¿ï¼Œå†™äº†å‡ å¹´Javaäº†ï¼Œæš‚æ—¶ä¸è€ƒè™‘è½¬ï¼Œä½†å…¬å¸éœ€è¦å¯ä»¥è€ƒè™‘</p></li><li><p>å¹³æ—¶å¼€å‘ç¯å¢ƒï¼Ÿ ä»£ç æ˜¯windowsä¸‹ç¼–å†™ï¼Œå‡å¦‚åªæ˜¯è‡ªå·±çš„demoï¼Œé‚£å°±åªæ˜¯ideaè¿è¡Œäº†ï¼Œå‡å¦‚è¦è®©å¤§å®¶è®¿é—®é‚£å°±éƒ¨ç½²æœåŠ¡å™¨äº†ã€‚ä»€ä¹ˆæœåŠ¡å™¨ï¼Ÿæœ€å¼€å§‹æ²¡å­¦Linuxçš„æ—¶å€™æ˜¯WindowsæœåŠ¡å™¨ï¼Œä½†ä¸€æ®µæ—¶é—´å°±å¾ˆå¡ï¼Œåé¢è‡ªå­¦äº†Linuxå°±ä¹°äº†é˜¿é‡Œäº‘çš„æœåŠ¡å™¨ã€‚è¯´è¯´Liunxå¸¸ç”¨å‘½ä»¤ï¼Ÿæ–°å»ºæ–‡ä»¶ï¼Œæ–‡ä»¶è´Ÿè´£ç­‰ç­‰ï¼Œå…¶å®éƒ¨ç½²ä¸»è¦æ˜¯Dockerï¼ŸDockerç”¨åˆ°ä»€ä¹ˆåœ°æ­¥ï¼Ÿä¼šDockerFileå—ï¼Ÿ è¿™ä¸ªè¿˜æ˜¯æ²¡é—®é¢˜ï¼Œä¹‹å‰å®ä¹ å°±æ˜¯DockerFileæ‰“åŒ…çš„ã€‚</p></li><li><p>ç°åœ¨éœ€è¦æŠŠåœ¨ä¸€å°æœåŠ¡å™¨çš„åº”ç”¨é•œåƒï¼Œè¿è¡Œåœ¨å¦ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œè¿™ä¹ˆåšï¼Ÿè‡ªå·±æ²¡è¯•è¿‡ï¼Œä¸è¿‡åº”è¯¥æ˜¯æŠŠé•œåƒä¸‹è½½ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åä¼ åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œdocker loadå³å¯ï¼Œæ„Ÿè§‰Dockerè¿˜æ˜¯éœ€è¦å¤šçœ‹çœ‹</p></li><li><p>è®²è®²è‡ªå·±è¿ç”¨ä¸“ä¸šçŸ¥è¯†è§£å†³çš„å®é™…é—®é¢˜ï¼Ÿè®²äº†æœªå¼€å§‹çš„è®¾ç½®æ•°æ®åº“è¿æ¥ç¼–ç UTF-8ï¼Œç„¶åå†å°†æœ€è¿‘æŠ¢çº¢åŒ…çš„ä¸€ä¸ªé¡¹ç›®</p></li></ol><p><strong>åé—®</strong></p><ol><li>é¢è¯•å®˜æ˜¯ä»€ä¹ˆéƒ¨é—¨çš„ï¼Œä»€ä¹ˆä¸šåŠ¡ï¼Ÿ</li><li>è¿˜æ˜¯è°ˆåˆ°è½¬è¯­è¨€ï¼Œè¯´Java Pythonéƒ½æœ‰ï¼Œå…¶å®æƒ³å…¨æ ˆï¼Œä½†è¿™å¯¹æ ¡æ‹›ç”Ÿè¦æ±‚å¤ªé«˜äº†ï¼Œæ‰€ä»¥å¯ä»¥åªç®¡åå°å¼€å‘</li><li>è¦æ˜¯è½¬ä¼šç»™æ—¶é—´å—ï¼Ÿé‚£è‚¯å®šï¼ŒJavaè½¬Pythonçš„ï¼Œé¢è¯•å®˜è¯´æ²¡è§è¿‡æ²¡è½¬æˆåŠŸçš„ï¼Œæˆ‘å°±è¯´äº†è‡ªå·±çš„æ¯•ä¸šè®¾è®¡æ˜¯åŸºäºæ·±åº¦å­¦ä¹ çš„TFå¼€å‘çš„æ¨èç³»ç»Ÿ</li><li>ç„¶åé¢è¯•å®˜æ˜¯åé¢ä¼šæœ‰äºŒé¢ï¼Œå¥½å¥½å‡†å¤‡ä¸‹ï¼Œæˆ‘è¯´å¥½ï¼Œç»§ç»­èŠäº†ä¼š</li><li>ä¸€å…±å‡ é¢ï¼Ÿ1-2è½®æŠ€æœ¯é¢ï¼Œä¸€è½®æ€»ç›‘é¢</li><li>åˆèŠäº†ä¼šï¼Œé¢è¯•é¢„å®šçš„æ˜¯åŠå°æ—¶ï¼Œå®é™…42åˆ†é’Ÿï¼Œé¢è¯•ä½“éªŒéå¸¸å¥½ï¼</li></ol><blockquote><p>PageHelperåŸç†</p></blockquote><ol><li>ä½¿ç”¨PageHelper.startPage()æ—¶åœ¨å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­è®¾ç½®ä¸€ä¸ªThreadLocalå˜é‡</li><li>åœ¨ ThreadLocalä¸­è®¾ç½®äº†åˆ†é¡µå‚æ•°ï¼Œä¹‹ååœ¨æŸ¥è¯¢æ‰§è¡Œçš„æ—¶å€™ï¼Œè·å–å½“å‰çº¿ç¨‹ä¸­çš„åˆ†é¡µå‚æ•°</li><li>æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™é€šè¿‡æ‹¦æˆªå™¨åœ¨sqlè¯­å¥ä¸­æ·»åŠ åˆ†é¡µå‚æ•°ï¼Œä¹‹åå®ç°åˆ†é¡µæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ç»“æŸååœ¨ finally è¯­å¥ä¸­æ¸…é™¤ThreadLocalä¸­çš„æŸ¥è¯¢å‚æ•°</li></ol><p>PageHelperæ–¹æ³•ä½¿ç”¨äº†é™æ€çš„ThreadLocalå‚æ•°ï¼Œåˆ†é¡µå‚æ•°å’Œçº¿ç¨‹æ˜¯ç»‘å®šçš„ã€‚åªè¦å¯ä»¥ä¿è¯åœ¨PageHelperæ–¹æ³•è°ƒç”¨åç´§è·Ÿ MyBatis æŸ¥è¯¢æ–¹æ³•ï¼Œè¿™å°±æ˜¯å®‰å…¨çš„ã€‚å› ä¸ºPageHelperåœ¨finallyä»£ç æ®µä¸­è‡ªåŠ¨æ¸…é™¤äº†ThreadLocalå­˜å‚¨çš„å¯¹è±¡ã€‚</p><h2 id="äºŒé¢"><a href="#äºŒé¢" class="headerlink" title="äºŒé¢"></a>äºŒé¢</h2><blockquote><p>2021å¹´8æœˆ23æ—¥ 14:35-15:09 é¢è¯•å®˜è¿Ÿåˆ°äº†å‡ åˆ†é’Ÿï¼Œå½“æ—¶æˆ‘æœ‰ç‚¹æ€¥ï¼Œå› ä¸ºé¢„å®šå°±æ˜¯åŠå°æ—¶ï¼Œç„¶åå¥‡å®‰ä¿¡15:00çš„ç¬”è¯•ï¼Œå“ˆå“ˆï¼Œå¥½åœ¨ä¹Ÿå°±å‡ åˆ†é’Ÿå°±æ¥äº†ï¼Œé¢è¯•ä½“éªŒéå¸¸å¥½ï¼</p></blockquote><ol><li>è‡ªæˆ‘ä»‹ç»ï¼ŸåŒ…æ‹¬å­¦æ ¡ï¼Œä¸“ä¸šï¼Œä¸»ä¿®è¯¾ç¨‹ï¼ŒæŒæ¡çš„æŠ€èƒ½ï¼Œæ¯æ¬¡éƒ½è¦å¼ºè°ƒä¸‹æˆ‘ä»¬å­¦æ ¡çš„ç”µå­å•†åŠ¡æ˜¯åæŠ€æœ¯çš„</li><li>è¯´è¯´é¡¹ç›®å§ï¼Œéƒ½æ˜¯å­¦æ ¡çš„å—ï¼Ÿæ²¡æœ‰å®ä¹ å—ï¼Ÿé¡¹ç›®éƒ½æ˜¯å­¦æ ¡å’ŒåŒå­¦æ‰“æ¯”èµ›å†™çš„ï¼Œæœ‰å®ä¹ ï¼Œå› ä¸ºç–«æƒ…ç®¡æ§å’Œé€šå‹¤æ—¶é—´å¤ªé•¿äº†å°±è¾äº†ã€‚æŒ‘ä¸€ä¸ªè¯´è¯´é¡¹ç›®ä¸­çš„éš¾ç‚¹ï¼Œå¦‚ä½•è§£å†³ï¼Œå½“æ—¶çš„å¿ƒæƒ…æ€ä¹ˆæ ·ï¼Ÿè¿™ä¸ªå°±ä¸è¯´äº†ï¼Œé¡¹ç›®çƒ‚å¤§è¡—å•Šå“ˆå“ˆå“ˆï¼Œä½†åæ˜ çš„æ˜¯é¡¹ç›®å¿…é¡»å‡†å¤‡å……åˆ†ï¼Œæœ‰1-2ä¸ªå¯ä»¥è®²çš„ï¼Œè®²è§£ä½ é‡åˆ°çš„å›°éš¾ï¼Œæ€ä¹ˆè§£å†³çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä½ å»å¦‚ä½•é˜è¿°ï¼Œè¿™å…¶å®ä¸ä»…ä»…æ£€æŸ¥ä½ çš„å¼€å‘èƒ½åŠ›ï¼Œè¿˜èƒ½è€ƒéªŒè¯­è¨€è¡¨è¿°èƒ½åŠ›ã€‚ä¸ç„¶ä½ è¯´é¡¹ç›®æ²¡å•¥ï¼Œé‚£å°±ç‹‚é—®åŸºç¡€ï¼Œç›´åˆ°ä½ è¶´ä¸‹ä¸ºæ­¢â€¦â€¦</li><li>æŒ–äº†å¾ˆä¹…é¡¹ç›®ï¼Œé‚£æˆ‘ä»¬ç°åœ¨æ¥èŠèŠåŸºç¡€ï¼Œè®²è®²jvmä¸­æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„è½¬æ¢å§<ul><li>å¤§å¯¹è±¡ç›´æ¥åˆ°è€å¹´ä»£</li><li>åˆ†é…æ‹…ä¿æœºåˆ¶ï¼šå½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿå†…å­˜æ—¶ï¼Œå‘èµ·MinorGCï¼Œè‹¥æ­¤æ—¶å­˜æ´»å¯¹è±¡æ— æ³•å­˜å…¥SurvivoråŒºï¼Œè¿™é€šè¿‡åˆ†é…æ‹…ä¿æœºåˆ¶æŠŠæ–°ç”Ÿä»£çš„å¯¹è±¡æå‰è½¬ç§»åˆ°è€å¹´ä»£å»ï¼›</li><li>Survivor Toè¢«å¡«æ»¡ï¼Œå°†æ‰€æœ‰çš„å¯¹è±¡è½¬ç§»åˆ°è€å¹´ä»£</li><li>Survivor Toä¸­ä¸€åŠä»¥ä¸Šå¯¹è±¡çš„å¹´é¾„ç›¸ç­‰ï¼Œç›´æ¥è½¬</li><li>Survivor Toä¸­å¯¹è±¡å¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼ˆé»˜è®¤15ï¼‰</li></ul></li><li>è®²è®²Springï¼ŒSpringMVCï¼ŒSpringBootï¼ŒSpringCloudçš„åŒºåˆ«å’Œè”ç³»</li><li>éƒ½æ˜¯å…³ç³»å‹æ•°æ®åº“å¯¹å§ï¼Œè¿˜æœ‰éå…³ç³»å‹å‘¢ï¼Œé‚£è¯´è¯´å¸¸ç”¨çš„å…³è”æŸ¥è¯¢ï¼ŸMysqlæœ‰å†…è¿æ¥Inner Joinï¼Œleft Joinï¼ŒRight Joinï¼Œæ²¡æœ‰å…¨è¿æ¥ï¼ŒSql Serveræœ‰å…¨è¿æ¥</li><li>ç½‘ç»œæ€ä¹ˆæ ·ï¼Ÿæ­£æ‰“ç®—è¯´OSIä¸ƒå±‚åè®®ï¼Œé¢è¯•å®˜è¯´ç»™ä¸ªåœºæ™¯ï¼Œè¯´è¯´æµè§ˆå™¨è¯·æ±‚ä¸€ä¸ªæœç‹çš„ç½‘ç«™ï¼Œåˆ°ç”¨æˆ·æ˜¾ç¤ºç”¨åˆ°çš„åè®®å§ã€‚é¦–å…ˆï¼ŒåŸŸåï¼Œæœç‹æ˜¯<strong>HTTPS</strong>çš„ï¼Œæ‹¿åˆ°åŸŸåå°±è¦è¿›è¡ŒåŸŸåå’ŒIPçš„è½¬æ¢ï¼Œ<strong>IPåè®®</strong>ï¼Œç”¨åˆ°äº†<strong>DNSåè®®</strong>ï¼Œåº•å±‚æ˜¯<strong>UDPåè®®</strong>ï¼Œç„¶åæ˜¯<strong>TCPåè®®</strong>çš„ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œè¯·æ±‚åç«¯ï¼Œæ‹¿åˆ°æ•°æ®ï¼Œæ¸²æŸ“é¡µé¢</li><li>å¹³æ—¶æ€ä¹ˆå­¦ä¹ æå‡è‡ªå·±çš„ï¼Ÿåƒé‡ŒåŸ¹è®­â€”&gt;çœ‹bç«™è§†é¢‘å­¦ä¹ â€”&gt;çœ‹åšå®¢å’Œå…¬ä¼—å·(ä¸¾äº†å‡ ä¸ªåšä¸»å’Œç¾å›¢æŠ€æœ¯å›¢é˜Ÿçš„åšå®¢)â€”&gt;çœ‹ä¹¦ï¼Œå› ä¸ºå‰é¢çš„éƒ½æ˜¯åˆ«äººåš¼ç¢çš„ä¸œè¥¿ï¼Œè¦æƒ³æ·±å…¥åº•å±‚ï¼Œåªæœ‰çœ‹ä¹¦ï¼Œæœ€è¿‘åœ¨çœ‹ã€Šæ·±å…¥ç†è§£JVMã€‹ï¼Œå¹³æ—¶çœ‹ä¹¦ä¹Ÿä¼šåšè¯»ä¹¦ç¬”è®°ï¼ˆç”µå­æ¡£çš„ï¼‰ï¼Œè¿™ä¸ªæ˜¯æ–¹ä¾¿åé¢æŸ¥æ‰¾çŸ¥è¯†ç‚¹</li></ol><p>åé—®ï¼š</p><ol><li>è¿›å»çœŸçš„è¦è½¬è¯­è¨€å—ï¼Ÿå…¶å®æˆ‘çŸ¥é“ç­”æ¡ˆï¼Œæˆ‘åªæ˜¯æƒ³ç»§ç»­èŠä¼šï¼Œè¯­è¨€åªæ˜¯å·¥å…·ï¼Œæœ‰å­¦ä¹ èƒ½åŠ›æ‰æ˜¯æœ€é‡è¦çš„</li><li>è¯·é¢è¯•å®˜è¯„ä»·ä¸‹æˆ‘ä»Šå¤©çš„è¡¨ç°ï¼Ÿè®°ä¸å¤ªæ¸…ä»–å’‹è¯´äº†ï¼Œåæ­£æ²¡æœ‰ç›´æ¥è¯´æ€ä¹ˆæ€ä¹ˆæ ·</li><li>åˆèŠäº†ä¼šï¼Œè¯´ç­‰ä¼šäººäº‹ä¼šé€šçŸ¥ä½ åé¢çš„é¢è¯•æµç¨‹ï¼Œä»Šå¤©å°±è¿™æ ·å§</li></ol><h2 id="ä¸‰é¢"><a href="#ä¸‰é¢" class="headerlink" title="ä¸‰é¢"></a>ä¸‰é¢</h2><blockquote><p>2021å¹´8æœˆ27æ—¥ 16:35-17:04 å¤ªç´§å¼ äº†ï¼Œä¸€æƒ³åˆ°æ˜¯VPå°±ç´§å¼ çš„è¦æ˜¯ï¼Œçœ‹ç‰›å®¢ä¸Šè¯´VPæ°”åœºåè¶³ï¼æå¾—ä¸­åˆéƒ½æ²¡ç¡ç€ï¼Œä¸‹åˆè¿›è…¾è®¯ä¼šè®®ï¼Œå‘ç°æ˜¯é¢è¯•å®˜æŒºå¹´è½»å•Šï¼Œåº”è¯¥æ˜¯éƒ¨é—¨è€å¤§å§ï¼Œå¾ˆå’Œè”¼çš„ï¼å…¨ç¨‹åŸºæœ¬ä¸Šæ˜¯èŠå¤©ï¼Œé¢è¯•ä½“éªŒå·¨å¥½</p></blockquote><ol><li>è‡ªæˆ‘ä»‹ç»+ä¸“ä¸šä»‹ç»+é¡¹ç›®+æ¯”èµ›ï¼ŒæœŸé—´ä¹Ÿåœ¨é—®æˆ‘ä¸€äº›ä¸œè¥¿</li><li>è¯´ä¸€ä¸‹ä½ è§‰å¾—æœ€æœ‰æˆå°±æ„Ÿçš„äº‹ï¼Ÿå°±è®²äº†ä¸‹è‡ªå·±è‡ªå­¦ç»å†ï¼Œé‡Œé¢å­¦åˆ°ä»€ä¹ˆï¼Œé¢è¯•å®˜å°±ç¬‘äº†</li><li>å¹³æ—¶æœ‰å…³æ³¨ä»€ä¹ˆæŠ€æœ¯è®ºå›å—ï¼Ÿç¾å›¢æŠ€æœ¯å›¢é˜Ÿï¼Œè¿˜æœ‰å¾ˆå¤šUPä¸»ï¼Œåšä¸»ç­‰ç­‰</li><li>ä¸ºä»€ä¹ˆé€‰æ‹©æ­¦æ±‰ï¼Ÿ</li></ol><p><strong>åé—®</strong></p><ol><li>é¢è¯•å®˜æ‚¨åœ¨é€‰å€™é€‰äººçš„æ—¶å€™ï¼Œçœ‹é‡ä»€ä¹ˆï¼Ÿ ä¸€é¢äºŒé¢ä¸‰é¢ä¸ä¸€æ ·çš„ï¼Œå“ˆå“ˆï¼Œè®°å¾—æœ€æ¸…æ¥šçš„æ˜¯ä¸€é¢å°±æ˜¯çœ‹å’Œç®€å†åŒ¹é…åº¦ï¼Œå†™äº†ç²¾é€šçš„è¯ï¼Œé‚£å°±ä¸å¥½æ„æ€äº†ï¼Œé‚£å°±è¦å¥½å¥½é—®é—®ä½ ï¼Œæˆ‘å½“æ—¶ä¹Ÿç¬‘äº†ï¼Œæˆ‘è¯´è¿™æ˜¯å¯¹æŠ€æœ¯çš„ä¸å°Šé‡ï¼Œä»–è¯´æ²¡ä¸ª10å¹´è¿™äº›ç²¾é€šçš„éƒ½æ˜¯ä½œæ­»ï¼Œç¬‘æ­»æˆ‘äº†ï¼</li><li>å¯¹æˆ‘çš„è¯„ä»·æ€ä¹ˆæ ·ï¼Ÿ</li></ol><p>ç„¶åèŠäº†å¾ˆä¹…ï¼Œé¢è¯•å®˜è¯´ï¼Œä½ æœ‰å•¥æƒ³èŠçš„éƒ½å¯ä»¥è·Ÿæˆ‘èŠå•Šï¼Œå“ˆå“ˆå“ˆï¼Œç¡®å®é¢è¯•å®˜æŠ€æœ¯äººå¾ˆå¥½ï¼ŒæŠ€æœ¯å¹¿åº¦å¾ˆå¹¿çš„ï¼Œåå¤å¼ºè°ƒæ•°æ®ç»“æ„å’Œè®¾è®¡æ¨¡å¼</p><ol><li>äºæ˜¯æˆ‘å°±è¯´è¿™ä¸ªæ•°æ®ç»“æ„å’Œç®—æ³•æˆ‘è¿˜å¥½ï¼Œè®¾è®¡æ¨¡å¼ï¼Œå› ä¸ºæ²¡æ€ä¹ˆå†™ä¼ä¸šçš„é¡¹ç›®ï¼Œç§¯ç´¯å¾ˆå°‘ï¼Œä»–è¯´è¿™ä¸ªæ˜¯æ—¶é—´æ¢æ¥çš„ï¼Œä½ å·²ç»å¾ˆä¸é”™äº†</li><li>å…¬å¸åŸ¹å…»ä½“ç³»ï¼Ÿåªèƒ½è¯´éå¸¸å®Œå–„ï¼</li><li>è–ªèµ„ï¼Ÿä¸æ˜¯BATé‚£ç§ä¼ä¸šï¼Œå…¬å¸æ˜¯è‡ªç ”è½¯ä»¶ï¼Œç„¶åå–é’±ï¼Œç›ˆåˆ©æ¨¡å¼ä¸ä¸€æ ·ï¼Œä½†è–ªèµ„æ˜¯ä¸­ä¸Šæ¸¸</li></ol><h2 id="OC"><a href="#OC" class="headerlink" title="OC"></a>OC</h2><p>HRç»™æˆ‘æ‰“ç”µè¯çš„æ—¶å€™ï¼Œæˆ‘è¿˜åœ¨æ·±ä¿¡æœç¬”è¯•ï¼Œå¾®ä¿¡å°ç¨‹åºæŠŠæ‰‹æœºé”äº†ï¼Œæˆ‘çŒœæƒ³åº”è¯¥æ˜¯ç»¿ç›Ÿçš„ï¼Œè¿˜çœ‹äº†ç”µè¯æ˜¯æ­¦æ±‰çš„ï¼Œå°±æ¥äº†ï¼Œå½“æ—¶åœ¨è‡ªä¹ å®¤ï¼Œæˆ‘å¾ˆå°å£°ï¼ŒHRé—®æˆ‘æ”¾ä¸æ–¹ä¾¿ï¼Œæˆ‘è¯´ç­‰ä¼šå§ï¼Œç°åœ¨ä¸æ–¹ä¾¿ï¼Œçº¦å®šäº†åŠå°æ—¶åå¥¹å†æ‰“æ¥ã€‚</p><p>åé¢èŠäº†15åˆ†é’Ÿï¼Œå°±å‘offeräº†~</p>]]></content>
    
    
    
    <tags>
      
      <tag>é¢ç»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ·é¢ç»</title>
    <link href="/2021/08/16/%E5%88%B7%E9%9D%A2%E7%BB%8F/"/>
    <url>/2021/08/16/%E5%88%B7%E9%9D%A2%E7%BB%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h1><p><strong>ä¸ƒå¤§å‚æ•°ï¼š</strong></p><ul><li><p>æ ¸å¿ƒçº¿ç¨‹æ•°é‡å¤§å°</p></li><li><p>æœ€å¤§çº¿ç¨‹æ•°é‡å¤§å°</p></li><li><p>ç­‰å¾…æ—¶é—´</p></li><li><p>ç­‰å¾…æ—¶é—´å•ä½</p></li><li><p>é˜»å¡é˜Ÿåˆ—</p><p>ArrayBlockingQueueï¼ˆåŸºäºæ•°ç»„ï¼‰ï¼ŒLinkedBlockingQueueï¼ˆåŸºäºé“¾è¡¨ï¼Œæ— ç•Œé˜Ÿåˆ—ï¼Œå¯ä¼ å…¥å‚æ•°æ„å»ºæœ‰ç•Œé˜Ÿåˆ—ï¼‰ï¼ŒPriorityBlockingQueueï¼ˆæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå› ä¸ºæ˜¯æ— ç•Œï¼Œæ‰€ä»¥putä¸ä¼šé˜»å¡ï¼‰</p></li><li><p>æ„å»ºå·¥å‚ ä¸€èˆ¬éƒ½æ˜¯é»˜è®¤</p></li><li><p>æ‹’ç»ç­–ç•¥ï¼ˆ<strong>å››å¤§ç­–ç•¥</strong>ï¼‰</p><p>æ»¡äº†å°±æŠ›å¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰ï¼Œæ»¡äº†å°±ä¸ç®¡ï¼Œæ»¡äº†å°±æŠ›å¼ƒé˜Ÿåˆ—æœ€æ—©çš„ï¼Œæ»¡äº†å°±ç”±è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹å»æ‰§è¡Œ</p><p>â€‹</p></li></ul><p><strong>ä¸ºä»€ä¹ˆä¸ç”¨Excutoråˆ›å»ºçº¿ç¨‹ï¼Ÿ</strong></p><p><strong>Excutor</strong>æ˜¯åˆ›å»ºçº¿ç¨‹æ± çš„å·¥å…·ç±»ï¼Œæœ‰å››ä¸ª</p><ul><li>SingleThreadPool</li><li>FixedThreadPool</li><li>CacheThreadPool</li><li>ScheduleThreadPool</li></ul><p>å‰ä¸¤ä¸ªæ˜¯ä¼šåˆ›å»ºå›ºå®šçš„çº¿ç¨‹æ•°ï¼Œä½†æ˜¯é˜»å¡é˜Ÿåˆ—æ˜¯æ— è¾¹ç•Œçš„ï¼Œä¼šå¯¼è‡´è¯·æ±‚çš„å †ç§¯ï¼Œæœ€ç»ˆOOM</p><p>åä¸¤ä¸ªä¼šåˆ›å»ºInteger.MAX_VALUEä¸ªçº¿ç¨‹ï¼Œå¯¼è‡´OOM</p><p><strong>å‘çº¿ç¨‹æ± æ·»åŠ ä»»åŠ¡åçº¿ç¨‹æ± çš„å¤„ç†é€»è¾‘</strong></p><ol><li>é¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ± ä»»åŠ¡é‡æœ‰æ²¡æœ‰è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°å¤§å°ï¼Œæ²¡æœ‰è¾¾åˆ°å°±åˆ›å»ºçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡</li><li>åˆ°è¾¾äº†ï¼Œå°±çœ‹é˜»å¡é˜Ÿåˆ—æ»¡æ²¡æ»¡ï¼Œæ²¡æ»¡å°±æ”¾åˆ°é˜»å¡é˜Ÿåˆ—é‡Œ</li><li>æ»¡äº†ï¼Œå°±åˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯ä¸æ˜¯è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ²¡æœ‰å°±åˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œ</li><li>è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°äº†ï¼Œé‚£å°±è¦æ‰§è¡Œæ‹’ç»ç­–ç•¥äº†</li></ol><h1 id="HashMapè€å…«è‚¡æ–‡"><a href="#HashMapè€å…«è‚¡æ–‡" class="headerlink" title="HashMapè€å…«è‚¡æ–‡"></a>HashMapè€å…«è‚¡æ–‡</h1><p><strong>åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ</strong></p><blockquote><p>JDK1.7 æ•°ç»„+é“¾è¡¨ â€”&gt;JDK1.8æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</p></blockquote><p>å¤´æ’æ³•â€”&gt;å°¾æ’æ³•</p><blockquote><p>å¤´æ’æ³•åœ¨å•çº¿ç¨‹ä¸‹ä¸ä¼šè®©é“¾è¡¨å˜æˆç¯çŠ¶ï¼Œå¤šçº¿ç¨‹ä¸‹å¯èƒ½ä¼šå‘ç”ŸèŠ‚ç‚¹çš„äº’ç›¸å¼•ç”¨ï¼Œé€ æˆé“¾è¡¨çš„ç¯çŠ¶ï¼Œä»¥è‡³äºå†get()æ—¶ä¼šå‘ç”Ÿæ­»å¾ªç¯</p><p>å°¾æ’æ³•å°±ä¸ä¼šï¼Œä½†è¿™å¹¶ä¸æ˜¯HashMapçš„BUGï¼Œå› ä¸ºHashMapå¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å°±ç”¨ConcurentMap</p></blockquote><p><strong>è½¬çº¢é»‘æ ‘çš„æ¡ä»¶ï¼Ÿ</strong></p><blockquote><p>é“¾è¡¨é•¿åº¦å¤§äº8å¹¶ä¸”æ¡¶çš„å¤§å°è¾¾åˆ°64æ‰ä¼šè½¬çº¢é»‘æ ‘ï¼Œå³ä½¿é“¾è¡¨é•¿åº¦å¤§äº8ï¼Œæ¡¶çš„å¤§å°æœªè¾¾åˆ°64ï¼Œæ˜¯å…ˆæ‰©å®¹çš„</p></blockquote><p><strong>put()æ“ä½œ</strong></p><blockquote><p>1.è·å–hashï¼Œæ‰°åŠ¨å‡½æ•°ï¼Œé«˜16ä½&amp;ä½16ä½ï¼Œæ›´åŠ æ•£åˆ—ï¼Œå‡å°‘hashç¢°æ’</p><p>2.å¯»å€ç®—æ³•ï¼šhash&amp;bin.length-1ï¼Œæ‰¾åˆ°æ¡¶çš„ä½ç½®</p><p>3.hashmapæ˜¯æ‡’åŠ è½½æœºåˆ¶ï¼Œç”¨åˆ°æ‰ä¼šåˆå§‹åŒ–ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æ˜¯æ£€æŸ¥hashmaoæœ‰ä¸æœ‰åˆå§‹åŒ–ï¼Œæ²¡æœ‰å°±å…ˆåˆå§‹åŒ–ï¼Œé»˜è®¤16</p><p>4.å·²ç»åˆå§‹åŒ–çš„hashmapï¼Œä¸‹é¢å°±æ˜¯putçš„æ“ä½œäº†ï¼Œå½“æ‰¾åˆ°çš„æ¡¶çš„ä½ç½®ä¸ºç©ºï¼Œé‚£å°±ç›´æ¥æ”¾ä¸Šå»å³å¯</p><p>5.æ¡¶çš„ä½ç½®ä¸ä¸ºç©ºï¼Œæ¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸æ’å…¥çš„keyä¸€æ ·ï¼Œé‚£å°±è¿›è¡Œæ›¿æ¢æ“ä½œï¼ˆç”¨&#x3D;&#x3D;æˆ–è€…equals()ï¼‰</p><p>6.å½“å‰å·²ç»æ ‘åŒ–äº†ï¼Œåˆ›é€ æ ‘å‹èŠ‚ç‚¹æ’å…¥çº¢é»‘æ ‘ä¸­ï¼Œè¿™ä¸ªæˆ‘å°±ä¸æ·±ç©¶äº†ï¼Œçº¢é»‘æ ‘è¿˜æ˜¯éš¾</p><p>7.å½“å‰å·²ç»é“¾åŒ–äº†ï¼Œé‚£å°±nextï¼Œä¸€ä¸ªä¸€ä¸ªæ‰¾ï¼Œä¸€ä¸ªä¸€ä¸ªequals()å»æ¯”è¾ƒï¼Œç›´åˆ°æœ€åä¹Ÿæ²¡å‘ç°ç›¸åŒçš„keyï¼Œé‚£å°±ç›´æ¥æŠŠNodeæ”¾åœ¨é“¾è¡¨å°¾éƒ¨ï¼Œä¹Ÿå°±æ˜¯å°¾æ’æ³•ï¼Œåˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº 8ï¼Œ å¤§äºçš„è¯é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘</p><p>8.++sizeï¼Œå¦‚æœ++size()&gt;æ‰©å®¹é˜ˆå€¼ï¼Œå°±ç«‹å³è¿›è¡Œresize()</p></blockquote><p><strong>get()æ“ä½œ</strong></p><blockquote><p>1.å¦‚æœé“¾è¡¨ä¸ºç©ºæˆ–è€…å¯¹åº”æ¡¶ä¸ºæ˜¯ç©ºçš„ï¼Œé‚£å°±ç›´æ¥è¿”å›null</p><p>2.å¦‚æœä¸ä¸ºç©ºï¼Œå¹¶ä¸”æ¡¶çš„å¤´å…ƒç´ å°±æ˜¯è¦æ‰¾çš„keyï¼Œé‚£å°±ç›´æ¥è¿”å›value</p><p>3.æ¡¶å·²ç»æ ‘åŒ–äº†ï¼Œå°±åœ¨çº¢é»‘æ ‘ä¸Šæ‰¾</p><p>4.æ¡¶å·²ç»é“¾åŒ–äº†ï¼Œå°±åœ¨é“¾è¡¨ä¸Šæ‰¾ï¼Œæ‰¾åˆ°å°±ç›´æ¥è¿”å›ï¼Œåˆ°æœ€åä¹Ÿæ²¡æ‰¾åˆ°ï¼Œå°±ç›´æ¥è¿”å›null</p></blockquote><p><strong>resize()æ“ä½œ</strong></p><blockquote><ol><li><p>å¦‚æœé“¾è¡¨å·²ç»åˆ°åº•Integer.MAX_VALUEï¼Œå°±ä¸å†è¿›è¡Œæ‰©å®¹äº†</p></li><li><p>å¦åˆ™å°±ç¿»å€æ‰©å®¹*2</p><p>rehash()</p></li><li><p>ç°åœ¨å°±è¦è¿›è¡Œæ•°ç»„çš„è¿ç§»æ“ä½œäº†ï¼Œå¤´èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå°±æŠŠå½“å‰æ¡¶ä½ç½®ä¸ºç©º</p></li><li><p>å½“å‰æ¡¶åªæœ‰ä¸€ä¸ªåŸå§‹ï¼Œç›´æ¥è¿›è¡Œå¯»å€ç®—æ³•ï¼Œæ‰¾åˆ°æ–°çš„æ¡¶ä½ç½®</p></li><li><p>å·²ç»æ ‘åŒ–äº†ï¼Œä¹Ÿæ˜¯é‡æ–°æ‰¾æ¡¶çš„ä½ç½®</p></li><li><p>å·²ç»é“¾åŒ–äº†ï¼Œå°±åˆ†é«˜ä½é“¾è¡¨å’Œä½ä½é“¾è¡¨ï¼Œä½ä½é“¾è¡¨å­˜æ”¾åœ¨æ‰©å®¹ä¹‹åçš„æ•°ç»„ä¸‹æ ‡çš„ä½ç½®ï¼Œä¸å½“å‰æ•°ç»„ä¸‹æ ‡ä½ç½®ä¸€è‡´çš„å…ƒç´ ï¼Œé«˜ä½é“¾è¡¨å­˜æ”¾åœ¨æ‰©å®¹ä¹‹åçš„æ•°ç»„ä¸‹æ ‡çš„ä½ç½®ä¸ºå½“å‰æ•°ç»„ä¸‹æ ‡ä½ç½®+ æ‰©å®¹ä¹‹å‰æ•°ç»„é•¿åº¦çš„å…ƒç´ ï¼Œè¿›è¡Œé“¾è¡¨çš„æ‹¼æ¥</p></li></ol></blockquote><p><strong>å¦‚æœæ˜¯ä¸€ä¸ªObjectä½œä¸ºhashMapçš„keyçš„è¯è¿™ä¸ªå¯¹è±¡éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Ÿ</strong></p><blockquote><p>Hashmapä¸å…è®¸æœ‰é‡å¤çš„keyï¼Œæ‰€ä»¥è¦é‡å†™å®ƒçš„hashcodeå’Œequalsæ–¹æ³•ï¼Œä»¥ä¾¿ç¡®è®¤keyæ˜¯å¦é‡å¤ã€‚é‡å†™hashCode()æ˜¯å› ä¸ºéœ€è¦è®¡ç®—å­˜å‚¨æ•°æ®çš„å­˜å‚¨ä½ç½®ï¼Œé‡å†™equals()æ–¹æ³•ç›®çš„æ˜¯ä¸ºäº†ä¿è¯keyåœ¨å“ˆå¸Œè¡¨ä¸­çš„å”¯ä¸€æ€§</p></blockquote><p><strong>çº¢é»‘æ ‘æŸ¥æ‰¾å’Œæ’å…¥æ—¶é—´å¤æ‚åº¦</strong></p><blockquote><p>æŸ¥æ‰¾å’Œæ’å…¥éƒ½æ˜¯O(logN)</p></blockquote><h1 id="ConcurrentHashMapè€å…«è‚¡æ–‡"><a href="#ConcurrentHashMapè€å…«è‚¡æ–‡" class="headerlink" title="ConcurrentHashMapè€å…«è‚¡æ–‡"></a>ConcurrentHashMapè€å…«è‚¡æ–‡</h1><p>çº¿ç¨‹å®‰å…¨çš„HashMap</p><p><strong>åº•å±‚æ•°æ®ç»“æ„ï¼Ÿ</strong></p><blockquote><p>JDK1.7 Segment+HashEntryåˆ†æ®µé”å®ç°</p><p>JDK1.8æŠ›å¼ƒSegmentï¼Œé‡‡ç”¨CAS+Sync+æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼Œ</p></blockquote><p><strong>è¯¦ç»†è®²è§£åˆ†æ®µé”å§</strong></p><blockquote><p>Segmentç»§æ‰¿äºReentrantLockï¼ŒSegmentåˆ™åŒ…å«HashEntryçš„æ•°ç»„ï¼ŒHashEntryæœ¬èº«å°±æ˜¯â¼€ä¸ªé“¾è¡¨çš„ç»“æ„ï¼Œå…·æœ‰ä¿å­˜keyã€valueçš„èƒ½â¼’èƒ½æŒ‡å‘ä¸‹â¼€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚</p><p>Segmentå°±æ˜¯HashMapï¼Œé»˜è®¤æ˜¯16ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´æ”¯æŒ16ä¸ªçº¿ç¨‹çš„å¹¶å‘å†™ï¼ŒSegmentä¹‹é—´ç›¸äº’ä¸å—åˆ°å½±å“,æ¯ä¸€æ®µéƒ½ä½¿ç”¨åˆ†æ®µé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®å…¶ä¸­ä¸€æ®µæ•°æ®æ—¶ï¼Œå…¶ä»–ç«¯æ•°æ®ä¹Ÿèƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ã€‚</p></blockquote><p><strong>get()ä¼šåŠ é”å—ï¼Ÿï¼ˆJDK1.7ï¼‰</strong></p><blockquote><p>ä¸ä¼šï¼Œé€šè¿‡Keyå®šä½åˆ°Segmentï¼Œå†éå†é“¾è¡¨ä¸Šçš„å…ƒç´ ï¼Œè·å–åˆ°çš„valueæ˜¯volatileçš„ï¼Œæ‰€ä»¥getæ˜¯ä¸éœ€è¦åŠ é”çš„</p></blockquote><p><strong>put()æ“ä½œï¼Ÿ</strong></p><blockquote><p>1.å’Œhashmapç±»é”ï¼Œå…ˆé€šè¿‡è®¡ç®—hashï¼Œå®šä½åˆ°Segmentï¼Œå¦‚æœå½“å‰Segmentæ˜¯ç©ºçš„ï¼Œå°±åˆå§‹åŒ–</p><p>2.ä½¿ç”¨ReentrantLockåŠ é”ï¼Œå¦‚æœå°è¯•è·å–é”å¤±è´¥å°±å°è¯•è‡ªé€‰ï¼Œå¦‚æœè‡ªæ—‹é”è¶…è¿‡ä¸€å®šæ¬¡æ•°å°±é˜»å¡ï¼Œä¿è¯ä¸€å®šèƒ½è·å–åˆ°é”</p><p>3.éå†HashEntryï¼Œå’ŒHashMapä¸€æ ·ï¼Œæœ‰å°±æ›¿æ¢ï¼Œæ²¡æœ‰å°±åŠ ä¸Š</p></blockquote><p><strong>JDK1.8ä¸­å…·ä½“æ€ä¹ˆå®ç°ConcurrentHashMapå†è¯´è¯¦ç»†ç‚¹</strong></p><blockquote><p>é‡‡ç”¨CAS+Synæ¥ä¿è¯å¹¶å‘çš„çº¿ç¨‹å®‰å…¨ï¼Œputæ—¶ï¼Œé€šè¿‡hashè®¡ç®—æ•°ç»„ä½ç½®ï¼Œè‹¥ä¸ºç©ºï¼Œå°±é€šè¿‡CASæ“ä½œç›´æ¥æ·»åŠ ã€‚è‹¥ä¸ä¸ºç©ºå°±SyncåŠ é”ï¼Œè¿›è¡Œæ·»åŠ æ“ä½œã€‚Syncä¹‹é”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œåªè¦Hashä¸å†²çªï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘ï¼Œæ•ˆç‡å¤§å¤§æç¤º</p><p>getæ²¡æœ‰è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œæ”¯æŒä¸å¹¶å‘æ“ä½œ</p></blockquote><p><strong>è¯´è¯´ä¸ºä»€ä¹ˆ1.8æŠ›å¼ƒäº†1.7çš„åˆ†æ®µé”å§</strong></p><blockquote><ol><li>Segmentç»§æ‰¿è‡ªReentrantLockï¼Œæœ‰äº†é”çš„åŠŸèƒ½ï¼Œæ˜¯åˆ†æ®µçš„ï¼Œå½“Segmentè¶Šæ¥è¶Šå¤§ï¼Œé”çš„ç²’åº¦ä¹Ÿè¶Šæ¥è¶Šå¤§</li><li>åˆ†æ®µé”ä¼˜åŠ¿åœ¨äºæ“ä½œä¸åŒçš„Segmentæ˜¯å¹¶å‘çš„ï¼Œä¸éœ€è¦é”ï¼Œæ“ä½œåŒä¸€ä¸ªSegmentæ˜¯éœ€è¦é”çš„ï¼Œç›¸å¯¹äºå¯¹æ•´ä¸ªmapåŠ é”æ˜¯æœ‰ä¼˜åŠ¿çš„</li><li>ç¼ºç‚¹åœ¨äºåˆ†æˆå¾ˆå¤šæ®µæ˜¯ä¼šæ¯”è¾ƒæµªè´¹å†…å­˜ç©ºé—´ï¼ˆä¸è¿ç»­ï¼Œç¢ç‰‡åŒ–ï¼‰ï¼›æ“ä½œmapæ—¶ç«äº‰åŒä¸€ä¸ªåˆ†æ®µé”çš„æ¦‚ç‡éå¸¸å°æ—¶ï¼Œåˆ†æ®µé”åè€Œä¼šé€ æˆæ›´æ–°ç­‰æ“ä½œçš„é•¿æ—¶é—´ç­‰å¾…; å½“æŸä¸ªæ®µå¾ˆå¤§æ—¶ï¼Œåˆ†æ®µé”çš„æ€§èƒ½ä¼šä¸‹é™ã€‚</li></ol></blockquote><p><strong>ä¸ºä»€ä¹ˆä¸ç”¨ReentrantLockè€Œç”¨Sync?</strong></p><blockquote><ol><li>å‡å°‘å†…å­˜å¼€é”€:å¦‚æœä½¿ç”¨ReentrantLockåˆ™éœ€è¦èŠ‚ç‚¹ç»§æ‰¿AQSæ¥è·å¾—åŒæ­¥æ”¯æŒï¼Œå¢åŠ å†…å­˜å¼€é”€ï¼Œè€Œ1.8ä¸­åªæœ‰å¤´èŠ‚ç‚¹éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚</li><li>å†…éƒ¨ä¼˜åŒ–:synchronizedåˆ™æ˜¯JVMç›´æ¥æ”¯æŒçš„ï¼ŒJVMèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶ä½œå‡ºç›¸åº”çš„ä¼˜åŒ–æªæ–½ï¼šé”ç²—åŒ–ã€é”æ¶ˆé™¤ã€é”è‡ªæ—‹ç­‰ç­‰ã€‚</li></ol></blockquote><h1 id="SQLä¼˜åŒ–"><a href="#SQLä¼˜åŒ–" class="headerlink" title="SQLä¼˜åŒ–"></a>SQLä¼˜åŒ–</h1><blockquote><p>è¿™ä¸ªåŸºæœ¬ä¸Šä¹Ÿæ˜¯å¿…é—®çš„ä¸€é“é¢˜ï¼Œå…ˆè¯´æ€è·¯å’Œç»´åº¦</p></blockquote><ul><li>åˆ†æè¯­å¥ï¼Œæ˜¯å¦åŠ è½½äº†ä¸å¿…è¦çš„å­—æ®µå’Œæ•°æ®</li><li>åˆ†æSQLæ‰§è¡Œè®¡åˆ’ï¼Œæ˜¯å¦å‘½ä¸­ç´¢å¼•ï¼Ÿè¿™æ—¶å€™å¯ä»¥è®²è®²é€‚åˆåˆ›å»ºç´¢å¼•çš„å­—æ®µï¼Œç´¢å¼•å¤±æ•ˆçš„æƒ…å†µï¼Œ</li><li>å¦‚æœSQLå¾ˆå¤æ‚ï¼Œä¼˜åŒ–SQLç»“æ„</li><li>å¦‚æœå•è¡¨æ•°æ®æ•°æ®é‡è¿‡å¤§ï¼Œå¯ä»¥è€ƒè™‘åˆ†è¡¨ï¼Ÿæ°´å¹³åˆ†è¡¨ï¼Ÿhashæˆ–è€…range</li></ul><h2 id="1-ä¼˜åŒ–è¡¨ç»“æ„"><a href="#1-ä¼˜åŒ–è¡¨ç»“æ„" class="headerlink" title="1. ä¼˜åŒ–è¡¨ç»“æ„"></a>1. ä¼˜åŒ–è¡¨ç»“æ„</h2><ul><li><p>å°½é‡ä½¿ç”¨æ•°å­—å‹å­—æ®µ</p><p>è‹¥åªå«æ•°å€¼ä¿¡æ¯çš„å­—æ®µå°½é‡ä¸è¦è®¾è®¡ä¸ºå­—ç¬¦å‹ï¼Œè¿™ä¼šé™ä½æŸ¥è¯¢å’Œè¿æ¥çš„æ€§èƒ½ï¼Œå¹¶ä¼šå¢åŠ å­˜å‚¨å¼€é”€ã€‚è¿™æ˜¯å› ä¸ºå¼•æ“åœ¨å¤„ç†æŸ¥è¯¢å’Œè¿æ¥æ—¶ä¼šé€ä¸ªæ¯”è¾ƒå­—ç¬¦å‹ï¼Œè€Œå¯¹æ•°å­—å‹åªéœ€è¦ä¸€æ¬¡æ¯”è¾ƒå³å¯</p></li><li><p>èƒ½ç”¨charå°±ç”¨charï¼Œå­˜å–æ›´å¿«ï¼ˆä¼šé—®charå’Œvarcharçš„åŒºåˆ«ï¼Œcharæ˜¯å›ºå®šé•¿åº¦ï¼Œè‹±æ–‡1ä¸ªå­—èŠ‚ï¼Œä¸­æ–‡2ä¸ªå­—èŠ‚ï¼Œvarcharæ˜¯å˜é•¿çš„ï¼Œä¸­è‹±æ–‡éƒ½æ˜¯2ä¸ªå­—èŠ‚ï¼‰</p></li><li><p>å½“ç´¢å¼•åˆ—å‡ºç°å¤§é‡é‡å¤æ•°æ®ï¼Œç¦»æ•£æ€§ä¸å¥½ï¼Œæ¯”å¦‚æ€§åˆ«ï¼ŒçŠ¶æ€ç­‰ï¼Œå°±éœ€è¦åˆ æ‰ç´¢å¼•</p></li></ul><h2 id="2-ä¼˜åŒ–æŸ¥è¯¢"><a href="#2-ä¼˜åŒ–æŸ¥è¯¢" class="headerlink" title="2. ä¼˜åŒ–æŸ¥è¯¢"></a>2. ä¼˜åŒ–æŸ¥è¯¢</h2><p><strong>é€‚åˆåˆ›å»ºç´¢å¼•çš„åˆ—</strong></p><ol><li>ä¸»é”®(é»˜è®¤å°±æ˜¯èšç°‡ç´¢å¼•)</li><li>ç»å¸¸æŸ¥</li><li>éç©º</li><li>éœ€è¦order byï¼Œgroup by</li><li>éç©ºã€å”¯ä¸€</li><li>ç»å¸¸èŒƒå›´æŸ¥è¯¢</li></ol><p><strong>ä¸é€‚åˆåˆ›å»ºç´¢å¼•çš„åˆ—</strong></p><ol><li>å¾ˆå°‘æŸ¥è¯¢çš„åˆ—</li><li>å®šä¹‰ä¸ºtextï¼Œbitï¼Œimageçš„æ•°æ®ç±»å‹</li><li>æœ‰nullçš„</li><li>ä¿®æ”¹æ€§èƒ½è¿œè¿œå¤§äºæ£€ç´¢æ—¶ï¼Œä¸åº”è¯¥åˆ›å»ºç´¢å¼•</li></ol><p><strong>ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ</strong></p><ol><li>whereä¸­å­˜åœ¨å‡½æ•°ç±»å‹è½¬æ¢ï¼Œæ¯”å¦‚select * from news where year(publish_time) &lt; 2017</li><li>é‡åˆ°null</li><li>ï¼&#x3D; ï¼Œnot in ï¼Œnot exitsä¼šèµ°ç´¢å¼•ï¼Œinä¹Ÿä¸ä¸€å®šéƒ½ä¼šèµ°ç´¢å¼•ï¼Œå‡å¦‚inä¸­çš„é›†åˆåŒ…å«äº†å¾ˆå¤šæ•°æ®ï¼Œinnodbåˆ¤æ–­æ€§èƒ½è¿˜ä¸å¦‚ç›´æ¥æ‰«è¡¨ï¼Œé‚£å°±ä¸ä¼šèµ°ç´¢å¼•äº†</li><li>likeï¼Œå¯¹äºwhere filed like â€˜%luffy%â€™ï¼Œä¸ä¼šèµ°ç´¢å¼•ï¼Œä½†where filed like â€˜luffy%â€™ä¼šèµ°ç´¢å¼•ï¼Œå–å†³äº%çš„ä½ç½®</li><li>é‡åˆ°è¿è¡Œ æ¯”å¦‚where id * 3 &#x3D; 100ï¼Œä¸ä¼šèµ°ï¼Œå¯ä»¥ä¼˜åŒ–æˆwhere id &#x3D; 100 &#x2F; 3</li></ol><p>éœ€è¦æ³¨æ„<strong>è¦†ç›–æŸ¥è¯¢</strong>ï¼Œé˜²æ­¢å›è¡¨æŸ¥è¯¢ã€‚å¤åˆç´¢å¼•ç¬¦åˆæœ€<strong>å·¦å‰ç¼€åŸåˆ™</strong></p><h2 id="3-ä¼˜åŒ–ç´¢å¼•"><a href="#3-ä¼˜åŒ–ç´¢å¼•" class="headerlink" title="3.ä¼˜åŒ–ç´¢å¼•"></a>3.ä¼˜åŒ–ç´¢å¼•</h2><ul><li>å¯¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶å’Œorder byçš„å­—æ®µå»ºç«‹ç´¢å¼•</li><li>é¿å…è¿‡å¤šçš„å»ºç«‹ç´¢å¼•ï¼Œå¤šä½¿ç”¨ç»„åˆç´¢å¼•</li></ul><p>æ¥ä¸‹æ˜¯ä¸ªé‡å¤´æˆäº†ï¼Œ<strong>åˆ†ææ‰§è¡Œè®¡åˆ’Expain SQL</strong></p><ol><li>id æŸ¥è¯¢çš„åºå·</li><li>select_type ç®€å•æŸ¥è¯¢è¿˜æ˜¯å¤æ‚æŸ¥è¯¢</li><li>table åœ¨å“ªä¸ªè¡¨ä¸Šè¿›è¡Œæ“ä½œ</li><li>type æœ€é‡è¦çš„ä¸€ä¸ªå‚è€ƒä¹‹ä¸€ï¼Œè¡¨ç¤ºå…³è”ç±»å‹æˆ–è€…è®¿é—®ç±»å‹ï¼Œå³è¿”å›MySqlå†³å®šå¦‚ä½•æŸ¥æ‰¾è¡¨ä¸­çš„æ•°æ®ã€‚ä»æœ€ä¼˜åˆ°æœ€å·®åˆ†åˆ«ä¸ºï¼šsystemâ€”&gt;constâ€”&gt;eq_refâ€”&gt; refâ€”&gt; fulltextâ€”&gt; ref_or_nullâ€”&gt; index_mergeâ€”&gt; unique_subqueryâ€”&gt; index_subqueryâ€”&gt; rangeâ€”&gt; indexâ€”&gt;All</li><li>pussible_keys æ˜¾ç¤ºæŸ¥è¯¢å¯èƒ½ä½¿ç”¨å“ªäº›ç´¢å¼•æ¥æŸ¥è¯¢</li><li>key å®é™…é‡‡ç”¨äº†å“ªä¸ªç´¢å¼•</li><li>key_len æ˜¾ç¤ºmysqlåœ¨ç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œé€šè¿‡è¿™ä¸ªå€¼å¯ä»¥ç®—å‡ºå…·ä½“ä½¿ç”¨äº†ç´¢å¼•ä¸­çš„å“ªäº›åˆ—</li><li>ref æ˜¾ç¤ºäº†åœ¨keyåˆ—è®°å½•çš„ç´¢å¼•ä¸­ï¼Œè¡¨æŸ¥æ‰¾å€¼æ‰€ç”¨åˆ°çš„åˆ—æˆ–å¸¸é‡ã€‚å¸¸è§çš„æœ‰ï¼šconst(å¸¸é‡)ã€funcï¼ŒNULLï¼Œå­—æ®µå</li><li>rows mysqlä¼°è®¡è¦è¯»å–å¹¶æ£€æµ‹çš„è¡Œæ•°ï¼Œä¸æ˜¯ç»“æœé›†çš„è¡Œæ•°</li><li>Extra æ˜¾ç¤ºé¢å¤–ä¿¡æ¯ï¼ŒUsing index,Using where,Using temporaryç­‰</li></ol><h1 id="Linuxå¸¸ç”¨å‘½ä»¤"><a href="#Linuxå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Linuxå¸¸ç”¨å‘½ä»¤"></a>Linuxå¸¸ç”¨å‘½ä»¤</h1><p>è¿™ä¸ªä¸œè¥¿è¿™æ²¡å•¥å¥½è¯´çš„ï¼Œå¤šæ•²å°±è¡Œï¼Œä½†ä¸€æ®µæ—¶é—´ä¸ç”¨ï¼ŒåŸºæœ¬ä¸Šå…¨å¿˜äº†ï¼Œé¢è¯•ä¹Ÿä¼šé—®å¼€å‘ç¯å¢ƒï¼Œé‚£å°±ä¸€å®šè¦è¯´ä¸‹Linuxï¼Œæ¯•ç«Ÿä¼ä¸šéƒ¨ç½²éƒ½æ˜¯åœ¨Linuxä¸Šï¼Œè¿™é‡Œä¹Ÿåªæ˜¯è¯´ä¸‹Javaå·¥ç¨‹å¸ˆå¸¸ç”¨å‘½ä»¤ï¼Œå¤šçš„æ„Ÿè§‰æ²¡å¿…è¦å»è®°ï¼Œç”¨åˆ°å»æŸ¥å°±æ˜¯</p><blockquote><p>åˆ‡æ¢rootç”¨æˆ·</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo -i<br></code></pre></td></tr></table></figure><blockquote><p>æ–‡ä»¶å¸¸ç”¨æ“ä½œ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs shell">~~ æ–°å»ºæ–‡ä»¶å¤¹<br>[root@centos7-luffy ~]# mkdir /root/testLinux<br>~~ è¿›å…¥æ–‡ä»¶å¤¹<br>[root@centos7-luffy ~]# cd testLinux/<br>~~ æ˜¾ç¤ºå½“å‰æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶ä¿¡æ¯<br>[root@centos7-luffy testLinux]# ls<br>~~ æ‰“å°å½“å‰è·¯å¾„<br>[root@centos7-luffy testLinux]# pwd<br>/root/testLinux<br>~~ å¹³é“ºæ–‡ä»¶ä¿¡æ¯<br>[root@centos7-luffy testLinux]# ll<br>æ€»ç”¨é‡ 0<br>~~ åˆ›å»ºæ–‡ä»¶ï¼Œè‹¥æ–‡ä»¶å­˜åœ¨å°±æ›´æ–°æ–‡ä»¶è®¿é—®æ—¶é—´å’Œä¿®æ”¹æ—¶é—´<br>[root@centos7-luffy testLinux]# touch a.txt<br>~~ ç¼–è¾‘æ–‡ä»¶<br>[root@centos7-luffy testLinux]# vim a.txt<br>~~ é¢„è§ˆæ–‡ä»¶<br>[root@centos7-luffy testLinux]# cat a.txt<br>&quot;I love Linux&quot;<br>~~ æ˜¾ç¤ºæ–‡ä»¶å‰10è¡Œ<br>[root@centos7-luffy testLinux]# head -10 a.txt<br>&quot;I love Linux&quot;<br>~~ æ˜¾ç¤ºæ–‡ä»¶å10è¡Œ<br>[root@centos7-luffy testLinux]# tail -10 a.txt<br>&quot;I love Linux&quot;<br>~~ æŠŠæ•°æ®å†™å…¥æ–‡ä»¶<br>[root@centos7-luffy testLinux]# echo &quot;wdnmd&quot; &gt;&gt; a.txt<br>[root@centos7-luffy testLinux]# cat a.txt<br>&quot;I love Linux&quot;<br>wdnmd<br>[root@centos7-luffy testLinux]# cd ../<br>[root@centos7-luffy ~]# ls<br>anaconda-ks.cfg initial-setup-ks.cfg msql mysql temp test testLinux å…¬å…± æ¨¡æ¿ è§†é¢‘ å›¾ç‰‡ æ–‡æ¡£ ä¸‹è½½ éŸ³ä¹ æ¡Œé¢<br>[root@centos7-luffy ~]# cd test<br>[root@centos7-luffy test]# ls<br>b.txt<br>~~ åˆ é™¤æ–‡ä»¶ -f å¼ºåˆ¶åˆ é™¤ï¼Œä¸ç”¨ç¡®è®¤ rm -r æ–‡ä»¶å¤¹åå­—ï¼Œç”¨æ¥åˆ é™¤æ–‡ä»¶å¤¹<br>[root@centos7-luffy test]# rm -f b.txt<br>[root@centos7-luffy test]# cd ../testLinux/<br>[root@centos7-luffy testLinux]# ls<br>a.txt<br>~~ å¤åˆ¶æ–‡ä»¶ cp æ–‡ä»¶ å¤åˆ¶åˆ°çš„è·¯å¾„<br>[root@centos7-luffy testLinux]# cp a.txt /root/test<br>[root@centos7-luffy testLinux]# cd /root/test<br>[root@centos7-luffy test]# ls<br>a.txt<br>[root@centos7-luffy test]# cat a.txt<br>&quot;I love Linux&quot;<br>wdnmd<br>~~ ç§»åŠ¨æ–‡ä»¶ å¯ä»¥ç”¨æ¥é‡å‘½åå“Ÿ mv æŒ‡å®šæ–‡ä»¶è·¯å¾„ ç›®æ ‡æ–‡ä»¶è·¯å¾„<br>[root@centos7-luffy test]# mv a.txt rename.txt<br>[root@centos7-luffy test]# ls<br>rename.txt<br>[root@centos7-luffy test]# mv rename.txt /root/testLinux/<br>[root@centos7-luffy test]# ls<br>[root@centos7-luffy test]# cd ../testLinux/<br>[root@centos7-luffy testLinux]# ls<br>a.txt rename.txt<br>[root@centos7-luffy testLinux]# cat rename.txt<br>&quot;I love Linux&quot;<br>wdnmd<br>~~ é‡å¯ç³»ç»Ÿ<br>[root@centos7-luffy testLinux]# reboot<br>~~ ä¼ äº†ä¸ªå‹ç¼©åŒ…åˆ°è¯¥æ–‡ä»¶å¤¹ï¼Œç”¨æ¥æ¼”ç¤ºæ–‡ä»¶è§£å‹å’Œå‹ç¼©æ“ä½œ<br>[root@centos7-luffy testLinux]# ls<br>apache-maven-3.6.3-bin.tar.gz a.txt rename.txt<br>~~ æ–‡ä»¶è§£å‹<br>[root@centos7-luffy testLinux]# tar zxvf apache-maven-3.6.3-bin.tar.gz<br>apache-maven-3.6.3/README.txt<br>apache-maven-3.6.3/LICENSE<br>apache-maven-3.6.3/NOTICE<br>apache-maven-3.6.3/lib/<br>apache-maven-3.6.3/lib/cdi-api.license<br>apache-maven-3.6.3/lib/commons-cli.license<br>apache-maven-3.6.3/lib/commons-io.license<br>apache-maven-3.6.3/lib/commons-lang3.license<br>apache-maven-3.6.3/lib/guava.license<br>Â·Â·Â·Â·Â·Â·<br>[root@centos7-luffy testLinux]# ls<br>apache-maven-3.6.3 apache-maven-3.6.3-bin.tar.gz a.txt rename.txt<br>~~ åˆ é™¤ä¹‹å‰çš„å‹ç¼©åŒ…ï¼Œç”¨æ–‡ä»¶å¤¹å‹ç¼©å¾—åˆ°å‹ç¼©åŒ…<br>[root@centos7-luffy testLinux]# rm -f apache-maven-3.6.3-bin.tar.gz<br>[root@centos7-luffy testLinux]# ls<br>apache-maven-3.6.3 a.txt rename.txt<br>~~ æ–‡ä»¶å‹ç¼© tar -zvcf å‹ç¼©åŒ…æ–‡ä»¶å è¦å‹ç¼©çš„æ–‡ä»¶å¤¹<br>[root@centos7-luffy testLinux]# tar -zcvf apache-maven-3.6.3.tar.gz apache-maven-3.6.3<br>apache-maven-3.6.3/<br>apache-maven-3.6.3/README.txt<br>apache-maven-3.6.3/LICENSE<br>apache-maven-3.6.3/NOTICE<br>apache-maven-3.6.3/lib/<br>apache-maven-3.6.3/lib/cdi-api.license<br>apache-maven-3.6.3/lib/commons-cli.license<br>apache-maven-3.6.3/lib/commons-io.license<br>apache-maven-3.6.3/lib/commons-lang3.license<br>apache-maven-3.6.3/lib/guava.license<br>apache-maven-3.6.3/lib/guice.license<br>apache-maven-3.6.3/lib/jansi.license<br>apache-maven-3.6.3/lib/javax.inject.license<br>apache-maven-3.6.3/lib/jcl-over-slf4j.license<br>apache-maven-3.6.3/lib/jsoup.license<br>apache-maven-3.6.3/lib/jsr250-api.license<br>apache-maven-3.6.3/lib/org.eclipse.sisu.inject.license<br>apache-maven-3.6.3/lib/org.eclipse.sisu.plexus.license<br>apache-maven-3.6.3/lib/plexus-cipher.license<br>apache-maven-3.6.3/lib/plexus-component-annotations.license<br>apache-maven-3.6.3/lib/plexus-interpolation.license<br>Â·Â·Â·Â·Â·Â·<br>[root@centos7-luffy testLinux]# ls<br>apache-maven-3.6.3 apache-maven-3.6.3.tar.gz a.txt rename.txt<br>[root@centos7-luffy testLinux]#<br></code></pre></td></tr></table></figure><blockquote><p>å…³äºç½‘ç»œçš„</p></blockquote><p>netstat å‘½ä»¤ç”¨äºæ˜¾ç¤ºå„ç§ç½‘ç»œç›¸å…³ä¿¡æ¯ï¼Œå¦‚ç½‘ç»œè¿æ¥ï¼Œè·¯ç”±è¡¨ï¼Œç½‘ç»œè¿æ¥çŠ¶æ€ã€‚å‘½ä»¤æ ¼å¼ï¼š<code>netstat [-options]</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plain">options å‚æ•°è§£æ<br>-a (all)æ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹ï¼Œé»˜è®¤ä¸æ˜¾ç¤º Listen ç›¸å…³<br>-t (tcp)ä»…æ˜¾ç¤ºtcpç›¸å…³é€‰é¡¹<br>-u (udp)ä»…æ˜¾ç¤ºudpç›¸å…³é€‰é¡¹<br>-n æ‹’ç»æ˜¾ç¤ºåˆ«åï¼Œèƒ½æ˜¾ç¤ºæ•°å­—çš„å…¨éƒ¨è½¬åŒ–æˆæ•°å­—ã€‚<br>-l ä»…åˆ—å‡ºæœ‰åœ¨ Listen (ç›‘å¬) çš„æœå‹™çŠ¶æ€<br>-p æ˜¾ç¤ºå»ºç«‹ç›¸å…³é“¾æ¥çš„ç¨‹åºå<br>-r æ˜¾ç¤ºè·¯ç”±ä¿¡æ¯ï¼Œè·¯ç”±è¡¨<br>-e æ˜¾ç¤ºæ‰©å±•ä¿¡æ¯ï¼Œä¾‹å¦‚uidç­‰<br>-s æŒ‰å„ä¸ªåè®®è¿›è¡Œç»Ÿè®¡<br>-c æ¯éš”ä¸€ä¸ªå›ºå®šæ—¶é—´ï¼Œæ‰§è¡Œè¯¥netstatå‘½ä»¤<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">netstat -pt</span><br>Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name<br>tcp 0 0 localhost:30037 \*:\* LISTEN 2109/firefox<br>....<br>------å„é¡¹æŒ‡æ ‡è§£æ----------------------------------------<br>Proto åè®®<br>Recv-Q æ¥æ”¶é˜Ÿåˆ— ï¼Œä¸€èˆ¬éƒ½åº”è¯¥æ˜¯0ã€‚å¦‚æœä¸æ˜¯åˆ™è¡¨ç¤ºè½¯ä»¶åŒ…æ­£åœ¨é˜Ÿåˆ—ä¸­å †ç§¯<br>Send-Q å‘é€é˜Ÿåˆ—ï¼Œä¸€èˆ¬éƒ½åº”è¯¥æ˜¯0ã€‚å¦‚æœä¸æ˜¯åˆ™è¡¨ç¤ºè½¯ä»¶åŒ…æ­£åœ¨é˜Ÿåˆ—ä¸­å †ç§¯<br>Local Address æœ¬åœ°åœ°å€+port<br>Foreign Address è¿œç«¯åœ°å€+port<br>State çŠ¶æ€<br>PID è¿›ç¨‹pid<br>Program name è¿›ç¨‹å<br></code></pre></td></tr></table></figure><p>netstat å¸¸ç”¨å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain"># netstat -anp<br># netstat -tunlp<br></code></pre></td></tr></table></figure><p>lsofï¼ˆList Open Filesï¼‰ ç”¨äºæŸ¥çœ‹ä½ è¿›ç¨‹å¼€æ‰“çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶çš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ‰“å¼€çš„ç«¯å£(TCPã€UDP)ã€‚å‘½ä»¤æ ¼å¼ <code>lsof ï¼»optionsï¼½ filename</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">options å‚æ•°è§£é‡Š<br>-a åˆ—å‡ºæ‰“å¼€æ–‡ä»¶å­˜åœ¨çš„è¿›ç¨‹<br>-c&lt;è¿›ç¨‹å&gt; åˆ—å‡ºæŒ‡å®šè¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶(å¸¸ç”¨)<br>-p&lt;è¿›ç¨‹å·&gt; åˆ—å‡ºæŒ‡å®šè¿›ç¨‹å·æ‰€æ‰“å¼€çš„æ–‡ä»¶(å¸¸ç”¨)<br>-g åˆ—å‡ºå±äºgidçš„è¿›ç¨‹è¯¦æƒ…<br>-u&lt;uname/uid&gt; æ˜¾ç¤ºå½’å±unameæˆ–uidçš„è¿›ç¨‹æƒ…å†µ<br>-d&lt;fdæ–‡ä»¶å·&gt; åˆ—å‡ºå ç”¨è¯¥æ–‡ä»¶å·çš„è¿›ç¨‹<br>+d&lt;ç›®å½•&gt; åˆ—å‡ºç›®å½•ä¸‹è¢«æ‰“å¼€çš„æ–‡ä»¶<br>+D&lt;ç›®å½•&gt; é€’å½’åˆ—å‡ºç›®å½•ä¸‹è¢«æ‰“å¼€çš„æ–‡ä»¶<br>-n&lt;ç›®å½•&gt; åˆ—å‡ºä½¿ç”¨NFSçš„æ–‡ä»¶<br>-i&lt;æ¡ä»¶&gt; åˆ—å‡ºç¬¦åˆæ¡ä»¶çš„è¿›ç¨‹ã€‚ï¼ˆip4/ip6åè®®ã€ç«¯å£ã€ @ip ï¼‰<br>-u åˆ—å‡ºUIDå·è¿›ç¨‹è¯¦æƒ…<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plain"># lsof<br>command PID USER FD type DEVICE SIZE NODE NAME<br>init 1 root txt REG 8,2 43496 6121706 /sbin/init<br>---------å„é¡¹æŒ‡æ ‡è§£æ-----------------------<br>COMMAND è¿›ç¨‹çš„åç§°<br>PID è¿›ç¨‹æ ‡è¯†ç¬¦<br>USER è¿›ç¨‹æ‰€æœ‰è€…<br>FD æ–‡ä»¶æè¿°ç¬¦ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡æ–‡ä»¶æè¿°ç¬¦è¯†åˆ«è¯¥æ–‡ä»¶ã€‚å¦‚cwdã€txtç­‰<br>TYPE æ–‡ä»¶ç±»å‹ï¼Œå¦‚DIRã€REGç­‰<br>DEVICE æŒ‡å®šç£ç›˜çš„åç§°<br>SIZE æ–‡ä»¶çš„å¤§å°<br>NODE ç´¢å¼•èŠ‚ç‚¹ï¼ˆæ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„æ ‡è¯†ï¼‰<br>NAME æ‰“å¼€æ–‡ä»¶çš„ç¡®åˆ‡åç§°<br></code></pre></td></tr></table></figure><p>lsof ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plain">~~ æ˜¾ç¤ºæ‰€æœ‰æ‰“å¼€80ç«¯å£çš„è¿›ç¨‹<br># lsof -i:80<br>~~ é‚£ä¸ªè¿›ç¨‹åœ¨å ç”¨/etc/passwd<br># lsof /etc/passwd<br>~~ æ˜¾ç¤ºä½¿ç”¨fdä¸º1211çš„è¿›ç¨‹<br># lsof -d 1211<br>~~ æ˜¾ç¤ºé‚£äº›æ–‡ä»¶è¢«pidä¸º 1211 çš„è¿›ç¨‹æ‰“å¼€<br># lsof -p 1211<br>~~ æŸ¥çœ‹sendmailè¿›ç¨‹çš„æ–‡ä»¶ä½¿ç”¨æƒ…å†µ<br># lsof -c sendmail<br></code></pre></td></tr></table></figure><blockquote><p>ç³»ç»ŸçŠ¶å†µ</p></blockquote><p>top å‘½ä»¤æ˜¯ç”¨æ¥ç›‘æ§Linuxç³»ç»ŸçŠ¶å†µï¼Œæ¯”å¦‚cpuã€å†…å­˜ï¼Œè¿›ç¨‹ç­‰èµ„æºä½¿ç”¨æƒ…å†µã€‚å‘½ä»¤æ ¼å¼ï¼š<code>top [-options]</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">options é€‰é¡¹å‚æ•°<br>-i&lt;æ—¶é—´&gt; è®¾ç½®åˆ·æ–°é—´éš”æ—¶é—´<br>-u&lt;ç”¨æˆ·å&gt; æŒ‡å®šç”¨æˆ·å<br>-p&lt;è¿›ç¨‹å·&gt; æŒ‡å®šè¿›ç¨‹<br>-H å¼€å¯çº¿ç¨‹æŸ¥çœ‹<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">top</span><br>top - 18:20:27 up 26 days, 8:30, 2 users, load average: 0.04, 0.09, 0.13<br>Tasks: 168 total, 1 running, 167 sleeping, 0 stopped, 0 zombie<br><span class="hljs-meta prompt_">%</span><span class="language-bash">Cpu(s): 0.3 us, 0.5 sy, 0.0 ni, 99.1 <span class="hljs-built_in">id</span>, 0.0 wa, 0.0 hi, 0.1 si, 0.0 st</span><br>KiB Mem: 32762356 total, 14675196 used, 18087160 free, 884 buffers<br>KiB Swap: 2103292 total, 0 used, 2103292 free. 6580028 cached Mem<br>PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND<br>1260 root 20 0 7933492 1.173g 14004 S 0.333 3.753 58:20.74 java<br>1503 root 20 0 69172 2240 1412 S 0.333 0.007 0:48.05 httpd<br>1520 daemon 20 0 358140 3980 776 S 0.333 0.012 6:19.55 httpd<br>2323 mysql 20 0 19.918g 4.538g 9404 S 0.333 14.52 352:51.44 mysqld<br>.......<br>---------å„é¡¹æŒ‡æ ‡è§£æ---------------------------------------------------<br>ç¬¬ä¸€è¡Œç»Ÿè®¡ä¿¡æ¯åŒº<br>18:20:27 å½“å‰æ—¶é—´<br>up 25 days, 17:29 ç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼Œæ ¼å¼ä¸ºæ—¶:åˆ†<br>1 user å½“å‰ç™»å½•ç”¨æˆ·æ•°<br>load average: 0.04, 0.09, 0.13 ç³»ç»Ÿè´Ÿè½½ï¼Œä¸‰ä¸ªæ•°å€¼åˆ†åˆ«ä¸º 1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿå‰åˆ°ç°åœ¨çš„å¹³å‡å€¼<br>Tasksï¼šè¿›ç¨‹ç›¸å…³ä¿¡æ¯<br>running æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°<br>sleeping ç¡çœ çš„è¿›ç¨‹æ•°<br>stopped åœæ­¢çš„è¿›ç¨‹æ•°<br>zombie åƒµå°¸è¿›ç¨‹æ•°<br>Cpu(s)ï¼šCPUç›¸å…³ä¿¡æ¯<br><span class="hljs-meta prompt_">%</span><span class="language-bash">usï¼šè¡¨ç¤ºç”¨æˆ·ç©ºé—´ç¨‹åºçš„cpuä½¿ç”¨ç‡ï¼ˆæ²¡æœ‰é€šè¿‡<span class="hljs-built_in">nice</span>è°ƒåº¦ï¼‰</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">syï¼šè¡¨ç¤ºç³»ç»Ÿç©ºé—´çš„cpuä½¿ç”¨ç‡ï¼Œä¸»è¦æ˜¯å†…æ ¸ç¨‹åº</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">niï¼šè¡¨ç¤ºç”¨æˆ·ç©ºé—´ä¸”é€šè¿‡<span class="hljs-built_in">nice</span>è°ƒåº¦è¿‡çš„ç¨‹åºçš„cpuä½¿ç”¨ç‡</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash"><span class="hljs-built_in">id</span>ï¼šç©ºé—²cpu</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">waï¼šcpuè¿è¡Œæ—¶åœ¨ç­‰å¾…ioçš„æ—¶é—´</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">hiï¼šcpuå¤„ç†ç¡¬ä¸­æ–­çš„æ•°é‡</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">siï¼šcpuå¤„ç†è½¯ä¸­æ–­çš„æ•°é‡</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">stï¼šè¢«è™šæ‹Ÿæœºå·èµ°çš„cpu</span><br>Mem å†…å­˜ä¿¡æ¯<br>total ç‰©ç†å†…å­˜æ€»é‡<br>used ä½¿ç”¨çš„ç‰©ç†å†…å­˜æ€»é‡<br>free ç©ºé—²å†…å­˜æ€»é‡<br>buffers ç”¨ä½œå†…æ ¸ç¼“å­˜çš„å†…å­˜é‡<br>Swap å†…å­˜ä¿¡æ¯<br>total äº¤æ¢åŒºæ€»é‡<br>used ä½¿ç”¨çš„äº¤æ¢åŒºæ€»é‡<br>free ç©ºé—²äº¤æ¢åŒºæ€»é‡<br>cached ç¼“å†²çš„äº¤æ¢åŒºæ€»é‡<br>~~ å¸¸ç”¨çš„æŒ‡æ ‡<br>PID è¿›ç¨‹id<br>PPID çˆ¶è¿›ç¨‹id<br>UID è¿›ç¨‹æ‰€æœ‰è€…çš„ç”¨æˆ·id<br>USER è¿›ç¨‹æ‰€æœ‰è€…çš„ç”¨æˆ·å<br>GROUP è¿›ç¨‹æ‰€æœ‰è€…çš„ç»„å<br>TTY å¯åŠ¨è¿›ç¨‹çš„ç»ˆç«¯åã€‚ä¸æ˜¯ä»ç»ˆç«¯å¯åŠ¨çš„è¿›ç¨‹åˆ™æ˜¾ç¤ºä¸º ?<br>PR ä¼˜å…ˆçº§<br>NI niceå€¼ã€‚è´Ÿå€¼è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼Œæ­£å€¼è¡¨ç¤ºä½ä¼˜å…ˆçº§<br>P æœ€åä½¿ç”¨çš„CPUï¼Œä»…åœ¨å¤šCPUç¯å¢ƒä¸‹æœ‰æ„ä¹‰<br><span class="hljs-meta prompt_">%</span><span class="language-bash">CPU ä¸Šæ¬¡æ›´æ–°åˆ°ç°åœ¨çš„CPUæ—¶é—´å ç”¨ç™¾åˆ†æ¯”</span><br>TIME è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½ç§’<br>TIME+ è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½1/100ç§’<br><span class="hljs-meta prompt_">%</span><span class="language-bash">MEM è¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”</span><br>VIRT è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜æ€»é‡ï¼Œå•ä½kbã€‚VIRT=SWAP+RES<br>SWAP è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œè¢«æ¢å‡ºçš„å¤§å°ï¼Œå•ä½kbã€‚<br>RES è¿›ç¨‹ä½¿ç”¨çš„ã€æœªè¢«æ¢å‡ºçš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbã€‚RES=CODE+DATA<br>CODE å¯æ‰§è¡Œä»£ç å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kb<br>DATA å¯æ‰§è¡Œä»£ç ä»¥å¤–çš„éƒ¨åˆ†(æ•°æ®æ®µ+æ ˆ)å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kb<br>SHR å…±äº«å†…å­˜å¤§å°ï¼Œå•ä½kb<br>S è¿›ç¨‹çŠ¶æ€; ç›¸å…³æšä¸¾å€¼è§£é‡ŠæŸ¥çœ‹ ps -ef S é¡¹è§£é‡Š<br>COMMAND è¿›ç¨‹å¯åŠ¨æ‰§è¡Œçš„å‘½ä»¤è¡Œ<br></code></pre></td></tr></table></figure><p>top å‘½ä»¤ä¸‹ï¼ŒæŸ¥çœ‹ä¿¡æ¯å¸¸ç”¨å¿«æ·é”®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs plain">h æ˜¾ç¤ºå¿«æ·é”®å¸®åŠ©<br>k ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹<br>i å¼€/å…³å¿½ç•¥é—²ç½®å’Œåƒµæ­»è¿›ç¨‹<br>q é€€å‡ºç¨‹åº<br>r é‡æ–°å®‰æ’ä¸€ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§åˆ«<br>S åˆ‡æ¢åˆ°ç´¯è®¡æ¨¡å¼<br>s æ›´æ”¹åˆ·æ–°é—´éš”æ—¶é—´ï¼Œå•ä½ç§’<br>f,F ä»å½“å‰æ˜¾ç¤ºä¸­æ·»åŠ æˆ–è€…åˆ é™¤é¡¹ç›®<br>o,O æ”¹å˜æ˜¾ç¤ºé¡¹ç›®çš„é¡ºåº<br>l åˆ‡æ¢æ˜¾ç¤ºå¹³å‡è´Ÿè½½å’Œå¯åŠ¨æ—¶é—´ä¿¡æ¯<br>m åˆ‡æ¢æ˜¾ç¤ºå†…å­˜ä¿¡æ¯<br>t åˆ‡æ¢æ˜¾ç¤ºè¿›ç¨‹å’ŒCPUçŠ¶æ€ä¿¡æ¯<br>c åˆ‡æ¢æ˜¾ç¤ºå‘½ä»¤åç§°å’Œå®Œæ•´å‘½ä»¤è¡Œ<br>M æ ¹æ®å†…å­˜ä½¿ç”¨å¤§å°æ’åº<br>P æ ¹æ®CPUä½¿ç”¨ç‡è¿›è¡Œæ’åº ï¼ˆé»˜è®¤æ’åºï¼‰<br>T æ ¹æ®æ—¶é—´/ç´¯è®¡æ—¶é—´è¿›è¡Œæ’åº<br>1 å±•å¼€å¤šæ ¸cpuæ˜¾ç¤º<br>H çº¿ç¨‹æŸ¥çœ‹æ¨¡å¼åˆ‡æ¢ä¸ºå¼€æˆ–å…³<br></code></pre></td></tr></table></figure><p>æ–‡ä»¶çš„è¯»å†™æƒ…å†µã€ç³»ç»Ÿè°ƒç”¨çš„ä½¿ç”¨æƒ…å†µã€ç£ç›˜I&#x2F;Oã€CPUæ•ˆç‡ã€å†…å­˜ä½¿ç”¨çŠ¶å†µã€è¿›ç¨‹æ´»åŠ¨åŠ IPC æœ‰å…³çš„æ´»åŠ¨ç­‰ã€‚å‘½ä»¤æ ¼å¼ï¼š<code>sar [options] [-A] [-o file] delay [count]</code>ã€‚delay ä¸ºé‡‡æ ·é—´éš”ï¼Œcount ä¸ºé‡‡æ ·æ¬¡æ•°ï¼Œé»˜è®¤å€¼æ˜¯1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs plain">options é€‰é¡¹å‚æ•°<br>-A æ‰€æœ‰æŠ¥å‘Šçš„æ€»å’Œ<br>-o file è¡¨ç¤ºå°†å‘½ä»¤ç»“æœä»¥äºŒè¿›åˆ¶æ ¼å¼å­˜æ”¾åœ¨æ–‡ä»¶ä¸­ï¼Œfile æ˜¯æ–‡ä»¶å<br>-u è¾“å‡ºCPUä½¿ç”¨æƒ…å†µçš„ç»Ÿè®¡ä¿¡æ¯<br>-v è¾“å‡ºinodeã€æ–‡ä»¶å’Œå…¶ä»–å†…æ ¸è¡¨çš„ç»Ÿè®¡ä¿¡æ¯<br>-d è¾“å‡ºæ¯ä¸€ä¸ªå—è®¾å¤‡çš„æ´»åŠ¨ä¿¡æ¯<br>-b æ˜¾ç¤ºI/Oå’Œä¼ é€é€Ÿç‡çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆç›¸å¯¹-d æ˜¯æ±‡æ€»ä¿¡æ¯ï¼‰<br>-r è¾“å‡ºå†…å­˜å’Œäº¤æ¢ç©ºé—´çš„ç»Ÿè®¡ä¿¡æ¯<br>-R è¾“å‡ºå†…å­˜é¡µé¢çš„ç»Ÿè®¡ä¿¡æ¯<br>-a æ–‡ä»¶è¯»å†™æƒ…å†µ<br>-q é˜Ÿåˆ—é•¿åº¦å’Œå¹³å‡è´Ÿè½½<br>-c è¾“å‡ºè¿›ç¨‹ç»Ÿè®¡ä¿¡æ¯ï¼Œæ¯ç§’åˆ›å»ºçš„è¿›ç¨‹æ•°<br>-y ç»ˆç«¯è®¾å¤‡æ´»åŠ¨æƒ…å†µ<br>-w è¾“å‡ºç³»ç»Ÿäº¤æ¢æ´»åŠ¨ä¿¡æ¯<br>-x &lt;pid&gt; æ˜¾ç¤ºç»™å®šè¿›ç¨‹çš„ç»Ÿè®¡ä¿¡æ¯<br>-n &lt;å…³é”®è¯&gt; ç»Ÿè®¡ç½‘ç»œä¿¡æ¯<br>å…³é”®è¯å¯ä»¥æ˜¯ï¼š<br>DEV ç½‘å¡<br>EDEV ç½‘å¡ (é”™è¯¯)<br>NFS NFS å®¢æˆ·ç«¯<br>NFSD NFS æœåŠ¡å™¨<br>SOCK Sockets (å¥—æ¥å­—) (v4)<br>SOCK6 Sockets (å¥—æ¥å­—) (v6)<br>IP IP æµ (v4)<br>EIP IP æµ (v4) (å¤±è´¥ä¿¡æ¯)<br>ICMP ICMP æµ (v4)<br>EICMP ICMP æµ (v4) (å¤±è´¥ä¿¡æ¯)<br>TCP TCP æµ (v4)<br>ETCP TCP æµ (v4) (å¤±è´¥ä¿¡æ¯)<br>UDP UDP æµ (v4)<br>IP6 IP æµ (v6)<br>EIP6 IP æµ (v6) (å¤±è´¥ä¿¡æ¯)<br>ICMP6 ICMP æµ (v6)<br>EICMP6 ICMP æµ (v6) (å¤±è´¥ä¿¡æ¯)<br>UDP6 UDP æµ (v6)<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">sar -u 1 2</span><br>Linux 3.10.0-862.el7.x86\_64 (8f57ec39327b) 07/11/2021 \_x86\_64\_ (6 CPU)<br>07:02:04 PM CPU %user %nice %system %iowait %steal %idle<br>07:02:05 PM all 23.90 3.22 7.97 5.25 0.00 59.66<br>07:02:06 PM all 26.53 4.76 8.84 5.95 0.00 53.91<br>Average: all 25.21 3.99 8.40 5.60 0.00 56.79<br>------å„é¡¹æŒ‡æ ‡è§£æ---------------------------------<br><span class="hljs-meta prompt_">%</span><span class="language-bash">user ç”¨æˆ·ç©ºé—´çš„CPUä½¿ç”¨</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash"><span class="hljs-built_in">nice</span> æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹çš„CPUä½¿ç”¨ç‡</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">system å†…æ ¸ç©ºé—´çš„CPUä½¿ç”¨ç‡</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">iowait CPUç­‰å¾…IOçš„ç™¾åˆ†æ¯”</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">steal è™šæ‹Ÿæœºçš„è™šæ‹ŸæœºCPUä½¿ç”¨çš„CPU</span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">idle ç©ºé—²çš„CPU</span><br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ <code>sar -r</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">sar -r 1 2</span><br>Linux 3.10.0-862.el7.x86\_64 (8f57ec39327b) 07/11/2021 \_x86\_64\_ (6 CPU)<br>07:05:16 PM kbmemfree kbmemused %memused kbbuffers kbcached kbcommit %commit kbactive kbinact kbdirty<br>07:05:17 PM 299596 32398396 99.08 2084 7615088 37900868 115.91 27267692 3809860 672<br>07:05:18 PM 298932 32399060 99.09 2084 7615848 37900100 115.91 27267828 3810252 488<br>Average: 299264 32398728 99.08 2084 7615468 37900484 115.91 27267760 3810056 580<br>------å„é¡¹æŒ‡æ ‡è§£æ--------------------<br>kbmemfree ç©ºé—²çš„ç‰©ç†å†…å­˜å¤§å°<br>kbmemused ä½¿ç”¨ä¸­çš„ç‰©ç†å†…å­˜å¤§å°<br><span class="hljs-meta prompt_">%</span><span class="language-bash">memused ç‰©ç†å†…å­˜ä½¿ç”¨ç‡</span><br>kbbuffers å†…æ ¸ä¸­ä½œä¸ºç¼“å†²åŒºä½¿ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œkbbufferså’Œkbcached:è¿™ä¸¤ä¸ªå€¼å°±æ˜¯freeå‘½ä»¤ä¸­çš„bufferå’Œcache.<br>kbcached ç¼“å­˜çš„æ–‡ä»¶å¤§å°<br>kbcommit ä¿è¯å½“å‰ç³»ç»Ÿæ­£å¸¸è¿è¡Œæ‰€éœ€è¦çš„æœ€å°å†…å­˜ï¼Œå³ä¸ºäº†ç¡®ä¿å†…å­˜ä¸æº¢å‡ºè€Œéœ€è¦çš„æœ€å°‘å†…å­˜ï¼ˆç‰©ç†å†…å­˜+Swapåˆ†åŒºï¼‰<br>commit è¿™ä¸ªå€¼æ˜¯kbcommitä¸å†…å­˜æ€»é‡ï¼ˆç‰©ç†å†…å­˜+swapåˆ†åŒºï¼‰çš„ä¸€ä¸ªç™¾åˆ†æ¯”çš„å€¼<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ IO å’Œä¼ é€’é€Ÿç‡ï¼š<code>sar -b</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">sar -b 1 2</span><br>Linux 3.10.0-862.el7.x86\_64 (8f57ec39327b) 07/11/2021 \_x86\_64\_ (6 CPU)<br>07:06:08 PM tps rtps wtps bread/s bwrtn/s<br>07:06:09 PM 171.00 0.00 171.00 0.00 3431.00<br>07:06:10 PM 163.00 0.00 163.00 0.00 2620.00<br>Average: 167.00 0.00 167.00 0.00 3025.50<br>------å„é¡¹æŒ‡æ ‡è§£æ--------------------<br>tps ç£ç›˜æ¯ç§’é’Ÿçš„IOæ€»æ•°ï¼Œç­‰äºiostatä¸­çš„tps<br>rtps æ¯ç§’é’Ÿä»ç£ç›˜è¯»å–çš„IOæ€»æ•°<br>wtps æ¯ç§’é’Ÿä»å†™å…¥åˆ°ç£ç›˜çš„IOæ€»æ•°<br>bread/s æ¯ç§’é’Ÿä»ç£ç›˜è¯»å–çš„å—æ€»æ•°<br>bwrtn/s æ¯ç§’é’Ÿæ­¤å†™å…¥åˆ°ç£ç›˜çš„å—æ€»æ•°<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>é¢ç»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç™¾åº¦æå‰æ‰¹ä¸€é¢</title>
    <link href="/2021/08/05/%E7%99%BE%E5%BA%A6%E6%8F%90%E5%89%8D%E6%89%B9%E4%B8%80%E9%9D%A2/"/>
    <url>/2021/08/05/%E7%99%BE%E5%BA%A6%E6%8F%90%E5%89%8D%E6%89%B9%E4%B8%80%E9%9D%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="ç™¾åº¦MEGæå‰æ‰¹ä¸€é¢-base-ä¸Šæµ·"><a href="#ç™¾åº¦MEGæå‰æ‰¹ä¸€é¢-base-ä¸Šæµ·" class="headerlink" title="ç™¾åº¦MEGæå‰æ‰¹ä¸€é¢ base ä¸Šæµ·"></a>ç™¾åº¦MEGæå‰æ‰¹ä¸€é¢ base ä¸Šæµ·</h1><blockquote><p>08.05 14:50-15:50 é¢è¯•å®˜æå‰åŠ çš„æˆ‘å¾®ä¿¡ï¼Œå•†é‡äº†é¢è¯•æ—¶é—´ï¼Œé¢è¯•ç”¨çš„ç™¾åº¦çš„è‡ªç ”çš„Webè§†é¢‘ä¼šè®®ç½‘ç«™</p></blockquote><ol><li><p>è‡ªæˆ‘ä»‹ç»ï¼Œé¡¹ç›®ä»‹ç»</p></li><li><p>ç®—æ³•é¢˜ï¼š</p><ul><li>æ ¹å·ä¸‰çš„å°æ•°ç‚¹å10ä½ â€”&gt;æ²¡æ•´å‡ºæ¥</li><li>å¿«æ’</li><li>çº¿ç¨‹å®‰å…¨çš„å•ä¾‹ï¼ˆæ‡’æ±‰å’Œé¥¿æ±‰å¼ï¼‰</li></ul></li><li><p>hashmapå…«è‚¡ 1.7-&gt;1.8 å¯»å€ç®—æ³• <strong>getçš„è¿‡ç¨‹</strong></p></li><li><p>hashmapæ˜¯çº¿ç¨‹å®‰å…¨çš„?æ€ä¹ˆç”¨çº¿ç¨‹å®‰å…¨mapï¼Ÿâ€”&gt;hashtable hashmapåŠ é” concurentHashmap(é¦–é€‰)</p></li><li><p>concurentHashmapåº•å±‚å®ç° 1.7â€”&gt;1.8 <strong>è®²è®²åˆ†æ®µé”å§</strong></p></li><li><p>sqlçš„ä¼˜åŒ– â€”&gt;å‰ä¸€ç¯‡é¢ç»å·²ç»è¯´äº†ï¼Œè¿™é‡Œå°±å†èµ˜è¿°</p></li><li><p>Springçš„Aopï¼Ÿåº•å±‚å®ç°ï¼Ÿ åº•å±‚å®ç°å½“æ—¶ç´§å¼ ç­”æˆäº†åå°„ï¼Ÿï¼Ÿï¼Ÿwc</p></li><li><p>Springçš„ä½œç”¨åŸŸï¼Ÿåªè¯´äº†åŸå‹ï¼Œå•ä¾‹ï¼Œè¿˜æœ‰å‡ ä¸ªå¿˜äº†</p></li><li><p>RedisåŸºæœ¬æ•°æ®ç±»å‹ï¼Œåº•å±‚å®ç°ï¼Œç®€å•è¯´ä¸‹åº”ç”¨åœºæ™¯ï¼Œä½ å¸¸ç”¨çš„æ˜¯ä»€ä¹ˆï¼Œé¡¹ç›®ä¸­æ€ä¹ˆç”¨åˆ°çš„ï¼Ÿ</p></li><li><p>Rediså¸¸ç”¨å‘½ä»¤ï¼Œæ²¡è¯´å‡ ä¸ªï¼Œå› ä¸ºéƒ½æ˜¯ç”¨çš„Springçš„RedisTemplateï¼Œè¦æ¶è¡¥ä¸‹å•Š</p></li><li><p>Redisçš„ç¼“å­˜å‡»ç©¿ï¼Œç¼“å­˜ç©¿é€ï¼Œç¼“å­˜é›ªå´©æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</p></li><li><p>DockerFileå¸¸ç”¨å‘½ä»¤ â€”&gt;é¡¹ç›®ä¸­æåˆ°DockerFileæ‰“åŒ…æˆé•œåƒï¼Œåˆšå¥½é¢è¯•å®˜å°±æ˜¯åœ¨MEGåšå®¹å™¨çš„ï¼Œæ·¦ï¼ï¼ï¼</p><p>æœ‰ç‚¹æ™šäº†ï¼Œå®³ï¼Œè¿™æ®µæ—¶é—´çš„å¤ä¹ éƒ½æ²¡çœ‹è¿™ä¸ª</p></li><li><p>åé—®ï¼š</p><ul><li>éƒ¨é—¨çš„æŠ€æœ¯æ ˆï¼Ÿ SpringBoot+Mybatis+Redis+ES+Dockerï¼Œæœ‰æ—¶å€™ä¼šç”¨åˆ°å¾®æœåŠ¡</li><li>ä»Šå¤©çš„é¢è¯•æ€ä¹ˆæ ·ï¼Ÿæˆ‘è‡ªå·±éƒ½è§‰å¾—è‡ªå·±æ²¡ç­”å¥½ï¼ï¼ é¢è¯•å®˜è¯´ç®€å†ä¸Šå†™çš„èµ·ç è¿˜æ˜¯èƒ½è¯´ä¸€äº›ï¼Œæœ‰å¾ˆå¤šè™½ç„¶çœ‹ç€æ˜¯åŸç†æ€§çš„ä¸œè¥¿ï¼Œä½†å®é™…å¼€å‘æ˜¯ç»å¸¸ç”¨åˆ°çš„ï¼Œæ¯”å¦‚AOPï¼Œå‘œå‘œå‘œ</li><li>å› ä¸ºçŸ¥é“é¢è¯•å®˜æ˜¯åšå®¹å™¨çš„äº†ï¼Œå°±æ²¡é—®æ˜¯å¹²å˜›çš„ï¼Œå°±ç›´æ¥é—®K8så’ŒDockerçš„åŒºåˆ«</li></ul></li></ol><p>åæ€ï¼šä¸¤æ¬¡æå‰æ‰¹åº”è¯¥éƒ½æ˜¯å‡‰äº†ï¼Œä½†ä¹Ÿåœ¨æˆ‘é¢„æœŸå†…ï¼Œæˆ‘å°±æ˜¯æ‹¿æ¥ç»ƒç»ƒæ‰‹ï¼Œèƒ½å‘ç°è‡ªå·±çš„ä¸è¶³æ˜¯æœ€å¥½çš„ï¼Œå°±ç›®å‰çœ‹æ¥æˆ‘çš„ç›®çš„æ˜¯å®Œå…¨è¾¾åˆ°äº†ï¼ŒçŸ¥é“è‡ªå·±çš„è–„å¼±å¤„å’Œå¤ä¹ çš„åº”è¯¥æ³¨æ„çš„ç‚¹äº†ï¼ï¼ï¼ç§‹æ‹›ï¼Œç»§ç»­å†²ï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>é¢ç»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äºŒå‰æœç´¢æ ‘ã€å¹³è¡¡äºŒå‰æ ‘ã€çº¢é»‘æ ‘ã€B+æ ‘æ€§èƒ½å¯¹æ¯”</title>
    <link href="/2021/07/29/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E3%80%81%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91%E3%80%81%E7%BA%A2%E9%BB%91%E6%A0%91%E3%80%81B-%E6%A0%91%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94/"/>
    <url>/2021/07/29/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E3%80%81%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91%E3%80%81%E7%BA%A2%E9%BB%91%E6%A0%91%E3%80%81B-%E6%A0%91%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94/</url>
    
    <content type="html"><![CDATA[<p>å‰è¨€ï¼šBSTã€AVLã€RBTã€B-treeéƒ½æ˜¯åŠ¨æ€ç»“æ„ï¼ŒæŸ¥æ‰¾æ—¶é—´åŸºæœ¬éƒ½åœ¨O(longN)æ•°é‡çº§ä¸Šã€‚ä¸‹é¢åšå‡ºè¯¦ç»†å¯¹æ¯”ã€‚</p><h1 id="äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary-Search-Treeï¼‰"><a href="#äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary-Search-Treeï¼‰" class="headerlink" title="äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰"></a>äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰</h1><p>äºŒå‰æŸ¥æ‰¾æ ‘åˆç§°äºŒå‰æœç´¢æ ‘ï¼ŒäºŒå‰æ’åºæ ‘ï¼Œç‰¹ç‚¹å¦‚ä¸‹:</p><ol><li>å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹å€¼å‡å°äºæ ¹ç»“ç‚¹</li><li>å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹å€¼å‡å¤§äºæ ¹ç»“ç‚¹</li><li>ç»“ç‚¹çš„å·¦å³å­æ ‘æœ¬èº«åˆæ˜¯ä¸€é¢—äºŒå‰æŸ¥æ‰¾æ ‘</li><li>äºŒå‰æŸ¥æ‰¾æ ‘<strong>ä¸­åºéå†</strong>å¾—åˆ°ç»“æœæ˜¯é€’å¢æ’åºçš„ç»“ç‚¹åºåˆ—ã€‚</li></ol><h2 id="BST-çš„æ“ä½œä»£ä»·åˆ†æï¼š"><a href="#BST-çš„æ“ä½œä»£ä»·åˆ†æï¼š" class="headerlink" title="BST çš„æ“ä½œä»£ä»·åˆ†æï¼š"></a>BST çš„æ“ä½œä»£ä»·åˆ†æï¼š</h2><h3 id="æŸ¥æ‰¾ä»£ä»·ï¼š"><a href="#æŸ¥æ‰¾ä»£ä»·ï¼š" class="headerlink" title="æŸ¥æ‰¾ä»£ä»·ï¼š"></a><strong>æŸ¥æ‰¾ä»£ä»·</strong>ï¼š</h3><p>ä»»ä½•ä¸€ä¸ªæ•°æ®çš„æŸ¥æ‰¾è¿‡ç¨‹éƒ½éœ€è¦ä»æ ¹ç»“ç‚¹å‡ºå‘ï¼Œæ²¿æŸä¸€ä¸ªè·¯å¾„æœå¶å­ç»“ç‚¹å‰è¿›ã€‚å› æ­¤æŸ¥æ‰¾ä¸­æ•°æ®æ¯”è¾ƒæ¬¡æ•°ä¸æ ‘çš„å½¢æ€å¯†åˆ‡ç›¸å…³ã€‚<br>å½“æ ‘ä¸­æ¯ä¸ªç»“ç‚¹å·¦å³å­æ ‘é«˜åº¦å¤§è‡´ç›¸åŒæ—¶ï¼Œ<strong>æ ‘é«˜ä¸ºlogN</strong>ã€‚åˆ™<strong>å¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸logNæˆæ­£æ¯”</strong>ï¼ŒæŸ¥æ‰¾çš„å¹³å‡æ—¶é—´å¤æ‚åº¦åœ¨O(logN)æ•°é‡çº§ä¸Šã€‚<br>å½“å…ˆåæ’å…¥çš„å…³é”®å­—æœ‰åºæ—¶ï¼Œ<strong>BSTé€€åŒ–æˆå•æ”¯æ ‘ç»“æ„ï¼ˆé€€åŒ–æˆé“¾è¡¨ï¼‰</strong>ã€‚æ­¤æ—¶æ ‘é«˜nã€‚å¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸º(n+1)&#x2F;2ï¼ŒæŸ¥æ‰¾çš„å¹³å‡æ—¶é—´å¤æ‚åº¦åœ¨O(N)æ•°é‡çº§ä¸Šã€‚</p><h3 id="æ’å…¥ä»£ä»·"><a href="#æ’å…¥ä»£ä»·" class="headerlink" title="æ’å…¥ä»£ä»·"></a>æ’å…¥ä»£ä»·</h3><p>æ–°ç»“ç‚¹æ’å…¥åˆ°æ ‘çš„å¶å­ä¸Šï¼Œå®Œå…¨ä¸éœ€è¦æ”¹å˜æ ‘ä¸­åŸæœ‰ç»“ç‚¹çš„ç»„ç»‡ç»“æ„ã€‚å½“æ ‘ä¸­**æ¯ä¸ªèŠ‚ç‚¹å·¦å³å­æ ‘é«˜åº¦å¤§è‡´ç›¸åŒæ—¶ï¼Œæ’å…¥çš„å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯O(logN)**ï¼›è‹¥é€€åŒ–æˆå•é“¾è¡¨äº†ï¼Œæ’å…¥çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(N)ã€‚</p><h3 id="åˆ é™¤ä»£ä»·"><a href="#åˆ é™¤ä»£ä»·" class="headerlink" title="åˆ é™¤ä»£ä»·"></a>åˆ é™¤ä»£ä»·</h3><p>å½“åˆ é™¤ä¸€ä¸ªç»“ç‚¹Pï¼Œé¦–å…ˆéœ€è¦å®šä½åˆ°è¿™ä¸ªç»“ç‚¹Pï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦ä¸€ä¸ªæŸ¥æ‰¾çš„ä»£ä»·ã€‚ç„¶åç¨å¾®æ”¹å˜ä¸€ä¸‹æ ‘çš„å½¢æ€ã€‚<strong>å¦‚æœè¢«åˆ é™¤ç»“ç‚¹çš„å·¦ã€å³å­æ ‘åªæœ‰ä¸€ä¸ªå­˜åœ¨</strong>ï¼Œåˆ™æ”¹å˜å½¢æ€çš„ä»£ä»·ä»…ä¸ºO(1)ã€‚å¦‚æœè¢«<strong>åˆ é™¤ç»“ç‚¹çš„å·¦ã€å³å­æ ‘å‡å­˜åœ¨</strong>ï¼Œåªéœ€è¦å°†å½“Pçš„å·¦å­©å­çš„å³å­©å­çš„å³å­©å­çš„â€¦çš„å³å¶å­ç»“ç‚¹ä¸Päº’æ¢ï¼Œåœ¨æ”¹å˜ä¸€äº›å·¦å³å­æ ‘å³å¯ã€‚å› æ­¤åˆ é™¤æ“ä½œçš„**æ—¶é—´å¤æ‚åº¦æœ€å¤§ä¸ä¼šè¶…è¿‡O(logN)**ã€‚</p><h3 id="BSTæ•ˆç‡æ€»ç»“"><a href="#BSTæ•ˆç‡æ€»ç»“" class="headerlink" title="BSTæ•ˆç‡æ€»ç»“ :"></a><strong>BSTæ•ˆç‡æ€»ç»“</strong> :</h3><p>æŸ¥æ‰¾æœ€å¥½æ—¶é—´å¤æ‚åº¦O(logN)ï¼Œæœ€åæ—¶é—´å¤æ‚åº¦O(N)ã€‚<br>æ’å…¥åˆ é™¤æ“ä½œç®—æ³•ç®€å•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸æŸ¥æ‰¾å·®ä¸å¤šã€‚</p><h1 id="å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘-Balanced-Binary-Search-Tree"><a href="#å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘-Balanced-Binary-Search-Tree" class="headerlink" title="å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ ( Balanced Binary Search Tree )"></a>å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ ( Balanced Binary Search Tree )</h1><p>äºŒå‰æŸ¥æ‰¾æ ‘åœ¨æœ€å·®æƒ…å†µï¼ˆé€€åŒ–æˆé“¾è¡¨ï¼‰ä¸‹ç«Ÿç„¶å’Œé¡ºåºæŸ¥æ‰¾æ•ˆç‡ç›¸å½“ï¼Œè¿™æ˜¯æ— æ³•ä»å—çš„ã€‚äº‹å®ä¹Ÿè¯æ˜ï¼Œå½“å­˜å‚¨æ•°æ®è¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œæ ‘çš„ç»“æ„å¯¹æŸäº›å…³é”®å­—çš„æŸ¥æ‰¾æ•ˆç‡å½±å“å¾ˆå¤§ã€‚å½“ç„¶ï¼Œé€ æˆè¿™ç§æƒ…å†µçš„**ä¸»è¦åŸå› å°±æ˜¯BSTä¸å¤Ÿå¹³è¡¡(å·¦å³å­æ ‘é«˜åº¦å·®å¤ªå¤§)**ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦é€šè¿‡ä¸€å®šçš„ç®—æ³•ï¼Œå°†ä¸å¹³è¡¡æ ‘æ”¹å˜æˆå¹³è¡¡æ ‘ã€‚å› æ­¤ï¼ŒAVLæ ‘å°±è¯ç”Ÿäº†ã€‚</p><h2 id="AVL-çš„æ“ä½œä»£ä»·åˆ†æï¼š"><a href="#AVL-çš„æ“ä½œä»£ä»·åˆ†æï¼š" class="headerlink" title="AVL çš„æ“ä½œä»£ä»·åˆ†æï¼š"></a>AVL çš„æ“ä½œä»£ä»·åˆ†æï¼š</h2><h3 id="æŸ¥æ‰¾ä»£ä»·"><a href="#æŸ¥æ‰¾ä»£ä»·" class="headerlink" title="æŸ¥æ‰¾ä»£ä»·"></a>æŸ¥æ‰¾ä»£ä»·</h3><p>AVLæ˜¯ä¸¥æ ¼å¹³è¡¡çš„BSTï¼ˆå¹³è¡¡å› å­ä¸è¶…è¿‡1ï¼‰ã€‚é‚£ä¹ˆæŸ¥æ‰¾è¿‡ç¨‹ä¸BSTä¸€æ ·ï¼Œåªæ˜¯AVLä¸ä¼šå‡ºç°æœ€å·®æƒ…å†µçš„BST(å•æ”¯æ ‘)ã€‚å› æ­¤æŸ¥æ‰¾æ•ˆç‡æœ€å¥½ï¼Œæœ€åæƒ…å†µéƒ½æ˜¯O(logN)æ•°é‡çº§çš„ã€‚</p><h3 id="æ’å…¥ä»£ä»·-1"><a href="#æ’å…¥ä»£ä»·-1" class="headerlink" title="æ’å…¥ä»£ä»·"></a>æ’å…¥ä»£ä»·</h3><p>AVLå¿…é¡»è¦ä¿è¯ä¸¥æ ¼å¹³è¡¡(|bf|&lt;&#x3D;1)ï¼Œé‚£ä¹ˆæ¯ä¸€æ¬¡æ’å…¥æ•°æ®ä½¿å¾—AVLä¸­æŸäº›ç»“ç‚¹çš„å¹³è¡¡å› å­è¶…è¿‡1å°±å¿…é¡»è¿›è¡Œæ—‹è½¬æ“ä½œã€‚äº‹å®ä¸Šï¼Œ<strong>AVLçš„æ¯ä¸€æ¬¡æ’å…¥ç»“ç‚¹æ“ä½œæœ€å¤šåªéœ€è¦æ—‹è½¬1æ¬¡(**å•æ—‹è½¬æˆ–åŒæ—‹è½¬)ã€‚å› æ­¤ï¼Œæ€»ä½“ä¸Šæ’å…¥æ“ä½œçš„ä»£ä»·ä»ç„¶åœ¨</strong>O(logN)**çº§åˆ«ä¸Š(æ’å…¥ç»“ç‚¹éœ€è¦é¦–å…ˆæŸ¥æ‰¾æ’å…¥çš„ä½ç½®)ã€‚</p><h3 id="åˆ é™¤ä»£ä»·ï¼š"><a href="#åˆ é™¤ä»£ä»·ï¼š" class="headerlink" title="åˆ é™¤ä»£ä»·ï¼š"></a><strong>åˆ é™¤ä»£ä»·</strong>ï¼š</h3><p>AVLåˆ é™¤ç»“ç‚¹çš„ç®—æ³•å¯ä»¥å‚è§BSTçš„åˆ é™¤ç»“ç‚¹ï¼Œä½†æ˜¯<strong>åˆ é™¤ä¹‹åå¿…é¡»æ£€æŸ¥ä»åˆ é™¤ç»“ç‚¹å¼€å§‹åˆ°æ ¹ç»“ç‚¹è·¯å¾„ä¸Šçš„æ‰€æœ‰ç»“ç‚¹çš„å¹³è¡¡å› å­</strong>ã€‚å› æ­¤åˆ é™¤çš„ä»£ä»·ç¨å¾®è¦å¤§ä¸€äº›ã€‚æ¯ä¸€æ¬¡åˆ é™¤æ“ä½œæœ€å¤šéœ€è¦O(logN)æ¬¡æ—‹è½¬ã€‚å› æ­¤ï¼Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logN)+O(logN)&#x3D;O(2logN)ã€‚</p><h3 id="AVL-æ•ˆç‡æ€»ç»“"><a href="#AVL-æ•ˆç‡æ€»ç»“" class="headerlink" title="AVL æ•ˆç‡æ€»ç»“ :"></a><strong>AVL æ•ˆç‡æ€»ç»“</strong> :</h3><p><strong>æŸ¥æ‰¾</strong>çš„æ—¶é—´å¤æ‚åº¦ç»´æŒåœ¨O(logN)ï¼Œä¸ä¼šå‡ºç°æœ€å·®æƒ…å†µ<br>AVLæ ‘åœ¨æ‰§è¡Œæ¯ä¸ª<strong>æ’å…¥</strong>æ“ä½œæ—¶æœ€å¤šéœ€è¦1æ¬¡æ—‹è½¬ï¼Œå…¶æ—¶é—´å¤æ‚åº¦åœ¨O(logN)å·¦å³ã€‚<br>AVLæ ‘åœ¨æ‰§è¡Œ<strong>åˆ é™¤</strong>æ—¶ä»£ä»·ç¨å¤§ï¼Œæ‰§è¡Œæ¯ä¸ªåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éœ€è¦O(2logN)ã€‚</p><h1 id="çº¢é»‘æ ‘-Red-Black-Tree"><a href="#çº¢é»‘æ ‘-Red-Black-Tree" class="headerlink" title="çº¢é»‘æ ‘ (Red-Black Tree )"></a>çº¢é»‘æ ‘ (Red-Black Tree )</h1><p>äºŒå‰å¹³è¡¡æ ‘çš„ä¸¥æ ¼å¹³è¡¡ç­–ç•¥ä»¥ç‰ºç‰²å»ºç«‹æŸ¥æ‰¾ç»“æ„(æ’å…¥ï¼Œåˆ é™¤æ“ä½œ)çš„ä»£ä»·ï¼Œæ¢æ¥äº†ç¨³å®šçš„O(logN) çš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ã€‚ä½†æ˜¯è¿™æ ·åšæ˜¯å¦å€¼å¾—å‘¢ï¼Ÿ<br>èƒ½ä¸èƒ½æ‰¾ä¸€ç§æŠ˜ä¸­ç­–ç•¥ï¼Œå³ä¸ç‰ºç‰²å¤ªå¤§çš„å»ºç«‹æŸ¥æ‰¾ç»“æ„çš„ä»£ä»·ï¼Œä¹Ÿèƒ½ä¿è¯ç¨³å®šé«˜æ•ˆçš„æŸ¥æ‰¾æ•ˆç‡å‘¢ï¼Ÿ ç­”æ¡ˆå°±æ˜¯ï¼šçº¢é»‘æ ‘ã€‚</p><h2 id="æ€§è´¨"><a href="#æ€§è´¨" class="headerlink" title="æ€§è´¨"></a>æ€§è´¨</h2><p>çº¢é»‘æ ‘æ€§è´¨ï¼š</p><ul><li>æ¯ä¸ªèŠ‚ç‚¹ä¸æ˜¯çº¢è‰²å°±æ˜¯é»‘è‰²</li><li>æ ¹ç»“ç‚¹æ˜¯é»‘è‰²</li><li>ä¸å¯èƒ½æœ‰è¿åœ¨ä¸€èµ·çš„çº¢è‰²ç»“ç‚¹</li><li>å¯¹äºæ¯ä¸ªç»“ç‚¹ï¼Œä»è¯¥ç»“ç‚¹åˆ°å…¶æ‰€æœ‰åä»£å¶èŠ‚ç‚¹çš„ç®€å•è·¯å¾„ä¸Šï¼Œå‡åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²ç»“ç‚¹</li><li>æ¯ä¸ªå¶å­ç»“ç‚¹éƒ½æ˜¯é»‘è‰²çš„ï¼ˆæ­¤å¤„çš„å¶å­ç»“ç‚¹æŒ‡çš„æ˜¯ç©ºç»“ç‚¹ï¼‰</li></ul><h2 id="RBT-çš„æ“ä½œä»£ä»·åˆ†æï¼š"><a href="#RBT-çš„æ“ä½œä»£ä»·åˆ†æï¼š" class="headerlink" title="RBT çš„æ“ä½œä»£ä»·åˆ†æï¼š"></a>RBT çš„æ“ä½œä»£ä»·åˆ†æï¼š</h2><h3 id="æŸ¥æ‰¾ä»£ä»·ï¼š-1"><a href="#æŸ¥æ‰¾ä»£ä»·ï¼š-1" class="headerlink" title="æŸ¥æ‰¾ä»£ä»·ï¼š"></a><strong>æŸ¥æ‰¾ä»£ä»·</strong>ï¼š</h3><p>ç”±äºçº¢é»‘æ ‘çš„æ€§è´¨(<strong>æœ€é•¿è·¯å¾„é•¿åº¦ä¸è¶…è¿‡æœ€çŸ­è·¯å¾„é•¿åº¦çš„2å€</strong>)ï¼Œå¯ä»¥è¯´æ˜çº¢é»‘æ ‘è™½ç„¶ä¸åƒAVLä¸€æ ·æ˜¯ä¸¥æ ¼å¹³è¡¡çš„ï¼Œä½†å¹³è¡¡æ€§èƒ½è¿˜æ˜¯è¦æ¯”BSTè¦å¥½ã€‚å…¶æŸ¥æ‰¾ä»£ä»·åŸºæœ¬ç»´æŒåœ¨O(logN)å·¦å³ï¼Œä½†åœ¨æœ€å·®æƒ…å†µä¸‹(æœ€é•¿è·¯å¾„æ˜¯æœ€çŸ­è·¯å¾„çš„2å€å°‘1)ï¼Œæ¯”AVLè¦ç•¥é€Šè‰²ä¸€ç‚¹ã€‚</p><h3 id="æ’å…¥ä»£ä»·ï¼š"><a href="#æ’å…¥ä»£ä»·ï¼š" class="headerlink" title="æ’å…¥ä»£ä»·ï¼š"></a><strong>æ’å…¥ä»£ä»·</strong>ï¼š</h3><p>RBTæ’å…¥ç»“ç‚¹æ—¶ï¼Œéœ€è¦æ—‹è½¬æ“ä½œå’Œå˜è‰²æ“ä½œã€‚ä½†ç”±äºåªéœ€è¦ä¿è¯RBTåŸºæœ¬å¹³è¡¡å°±å¯ä»¥äº†ã€‚å› æ­¤æ’å…¥ç»“ç‚¹æœ€å¤šåªéœ€è¦2æ¬¡æ—‹è½¬ï¼Œè¿™ä¸€ç‚¹å’ŒAVLçš„æ’å…¥æ“ä½œä¸€æ ·ã€‚è™½ç„¶å˜è‰²æ“ä½œéœ€è¦O(logN)ï¼Œä½†æ˜¯å˜è‰²æ“ä½œååˆ†ç®€å•ï¼Œä»£ä»·å¾ˆå°ã€‚</p><h3 id="åˆ é™¤ä»£ä»·ï¼š-1"><a href="#åˆ é™¤ä»£ä»·ï¼š-1" class="headerlink" title="åˆ é™¤ä»£ä»·ï¼š"></a><strong>åˆ é™¤ä»£ä»·</strong>ï¼š</h3><p>RBTçš„åˆ é™¤æ“ä½œä»£ä»·è¦æ¯”AVLè¦å¥½çš„å¤šï¼Œåˆ é™¤ä¸€ä¸ªç»“ç‚¹æœ€å¤šåªéœ€è¦3æ¬¡æ—‹è½¬æ“ä½œã€‚</p><h3 id="RBT-æ•ˆç‡æ€»ç»“"><a href="#RBT-æ•ˆç‡æ€»ç»“" class="headerlink" title="RBT æ•ˆç‡æ€»ç»“"></a>RBT æ•ˆç‡æ€»ç»“</h3><p>æŸ¥æ‰¾ æ•ˆç‡æœ€å¥½æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦ä¸ºO(logN)ï¼Œä½†åœ¨æœ€åæƒ…å†µä¸‹æ¯”AVLè¦å·®ä¸€äº›ï¼Œä½†ä¹Ÿè¿œè¿œå¥½äºBSTã€‚<br>æ’å…¥å’Œåˆ é™¤æ“ä½œæ”¹å˜æ ‘çš„å¹³è¡¡æ€§çš„æ¦‚ç‡è¦è¿œè¿œå°äºAVLï¼ˆRBTä¸æ˜¯é«˜åº¦å¹³è¡¡çš„ï¼‰ã€‚å› æ­¤éœ€è¦çš„æ—‹è½¬æ“ä½œçš„å¯èƒ½æ€§è¦å°ï¼Œè€Œä¸”ä¸€æ—¦éœ€è¦æ—‹è½¬ï¼Œæ’å…¥ä¸€ä¸ªç»“ç‚¹æœ€å¤šåªéœ€è¦æ—‹è½¬2æ¬¡ï¼Œåˆ é™¤æœ€å¤šåªéœ€è¦æ—‹è½¬3æ¬¡(å°äºAVLçš„åˆ é™¤æ“ä½œæ‰€éœ€è¦çš„æ—‹è½¬æ¬¡æ•°)ã€‚è™½ç„¶å˜è‰²æ“ä½œçš„æ—¶é—´å¤æ‚åº¦åœ¨O(logN)ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œè¿™ç§æ“ä½œç”±äºç®€å•æ‰€éœ€è¦çš„ä»£ä»·å¾ˆå°ã€‚</p><h1 id="Bæ ‘-B-æ ‘-B-Tree"><a href="#Bæ ‘-B-æ ‘-B-Tree" class="headerlink" title="Bæ ‘&#x2F;B+æ ‘ (B-Tree )"></a>Bæ ‘&#x2F;B+æ ‘ (B-Tree )</h1><p>å¯¹äºåœ¨å†…å­˜ä¸­çš„æŸ¥æ‰¾ç»“æ„è€Œè¨€ï¼Œçº¢é»‘æ ‘çš„æ•ˆç‡å·²ç»éå¸¸å¥½äº†(å®é™…ä¸Šå¾ˆå¤šå®é™…åº”ç”¨è¿˜å¯¹RBTè¿›è¡Œäº†ä¼˜åŒ–)ã€‚ä½†æ˜¯å¦‚æœæ˜¯æ•°æ®é‡éå¸¸å¤§çš„æŸ¥æ‰¾å‘¢ï¼Ÿå°†è¿™äº›æ•°æ®å…¨éƒ¨æ”¾å…¥å†…å­˜ç»„ç»‡æˆRBTç»“æ„æ˜¾ç„¶æ˜¯ä¸å®é™…çš„ï¼ˆå†…å­˜æ˜‚è´µï¼‰ã€‚å®é™…ä¸Šï¼ŒåƒOSä¸­çš„æ–‡ä»¶ç›®å½•å­˜å‚¨ï¼Œæ•°æ®åº“ä¸­çš„æ–‡ä»¶ç´¢å¼•ç»“æ„çš„å­˜å‚¨â€¦. éƒ½ä¸å¯èƒ½åœ¨å†…å­˜ä¸­å»ºç«‹æŸ¥æ‰¾ç»“æ„ã€‚å¿…é¡»åœ¨ç£ç›˜ä¸­å»ºç«‹å¥½è¿™ä¸ªç»“æ„ã€‚é‚£ä¹ˆåœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹ï¼ŒRBTè¿˜æ˜¯ä¸€ç§å¥½çš„é€‰æ‹©å—ï¼Ÿ<br>åœ¨ç£ç›˜ä¸­ç»„ç»‡æŸ¥æ‰¾ç»“æ„ï¼Œä»ä»»ä½•ä¸€ä¸ªç»“ç‚¹æŒ‡å‘å…¶ä»–ç»“ç‚¹éƒ½æœ‰å¯èƒ½è¯»å–ä¸€æ¬¡ç£ç›˜æ•°æ®ï¼Œå†å°†æ•°æ®å†™å…¥å†…å­˜è¿›è¡Œæ¯”è¾ƒã€‚å¤§å®¶éƒ½çŸ¥é“ï¼Œé¢‘ç¹çš„ç£ç›˜IOæ“ä½œï¼Œæ•ˆç‡æ˜¯å¾ˆä½ä¸‹çš„(æœºæ¢°è¿åŠ¨æ¯”ç”µå­è¿åŠ¨è¦æ…¢ä¸çŸ¥é“å¤šå°‘)ã€‚<strong>æ˜¾è€Œæ˜“è§ï¼Œæ‰€æœ‰çš„äºŒå‰æ ‘çš„æŸ¥æ‰¾ç»“æ„åœ¨ç£ç›˜ä¸­éƒ½æ˜¯ä½æ•ˆçš„ã€‚å› æ­¤ï¼ŒBæ ‘å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸€ä¸ªé—®é¢˜ã€‚</strong></p><h2 id="B-Treeçš„æ“ä½œä»£ä»·åˆ†æï¼š"><a href="#B-Treeçš„æ“ä½œä»£ä»·åˆ†æï¼š" class="headerlink" title="B-Treeçš„æ“ä½œä»£ä»·åˆ†æï¼š"></a>B-Treeçš„æ“ä½œä»£ä»·åˆ†æï¼š</h2><h3 id="æŸ¥æ‰¾ä»£ä»·-1"><a href="#æŸ¥æ‰¾ä»£ä»·-1" class="headerlink" title="æŸ¥æ‰¾ä»£ä»·"></a>æŸ¥æ‰¾ä»£ä»·</h3><p>B-Treeä½œä¸ºä¸€ä¸ªå¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘(m-å‰)ã€‚Bæ ‘çš„æŸ¥æ‰¾åˆ†æˆä¸¤ç§ï¼šä¸€ç§æ˜¯ä»ä¸€ä¸ªç»“ç‚¹æŸ¥æ‰¾å¦ä¸€ç»“ç‚¹çš„åœ°å€çš„æ—¶å€™ï¼Œéœ€è¦å®šä½ç£ç›˜åœ°å€(æŸ¥æ‰¾åœ°å€)ï¼ŒæŸ¥æ‰¾ä»£ä»·æé«˜ã€‚å¦ä¸€ç§æ˜¯å°†ç»“ç‚¹ä¸­çš„æœ‰åºå…³é”®å­—åºåˆ—æ”¾å…¥å†…å­˜ï¼Œè¿›è¡Œä¼˜åŒ–æŸ¥æ‰¾(å¯ä»¥ç”¨æŠ˜åŠ)ï¼Œç›¸æ¯”æŸ¥æ‰¾ä»£ä»·æä½ã€‚è€Œ<strong>Bæ ‘çš„é«˜åº¦å¾ˆå°ï¼Œå› æ­¤åœ¨è¿™ä¸€èƒŒæ™¯ä¸‹ï¼ŒBæ ‘æ¯”ä»»ä½•äºŒå‰ç»“æ„æŸ¥æ‰¾æ ‘çš„æ•ˆç‡éƒ½è¦é«˜å¾ˆå¤šã€‚è€Œä¸”B+æ ‘ä½œä¸ºBæ ‘çš„å˜ç§ï¼Œå…¶æŸ¥æ‰¾æ•ˆç‡æ›´é«˜ã€‚</strong></p><h3 id="æ’å…¥ä»£ä»·-2"><a href="#æ’å…¥ä»£ä»·-2" class="headerlink" title="æ’å…¥ä»£ä»·"></a>æ’å…¥ä»£ä»·</h3><p>B-Treeçš„æ’å…¥ä¼šå‘ç”Ÿç»“ç‚¹çš„åˆ†è£‚æ“ä½œã€‚å½“æ’å…¥æ“ä½œå¼•èµ·äº†sä¸ªèŠ‚ç‚¹çš„åˆ†è£‚æ—¶ï¼Œç£ç›˜è®¿é—®çš„æ¬¡æ•°ä¸ºh(è¯»å–æœç´¢è·¯å¾„ä¸Šçš„èŠ‚ç‚¹)ï¼‹2s(å›å†™ä¸¤ä¸ªåˆ†è£‚å‡ºçš„æ–°èŠ‚ç‚¹)ï¼‹1ï¼ˆå›å†™æ–°çš„æ ¹èŠ‚ç‚¹æˆ–æ’å…¥åæ²¡æœ‰å¯¼è‡´åˆ†è£‚çš„èŠ‚ç‚¹ï¼‰ã€‚å› æ­¤ï¼Œæ‰€éœ€è¦çš„ç£ç›˜è®¿é—®æ¬¡æ•°æ˜¯h+2s+1ï¼Œæœ€å¤šå¯è¾¾åˆ°3h+1ã€‚å› æ­¤æ’å…¥çš„ä»£ä»·æ˜¯å¾ˆå¤§çš„ã€‚</p><h3 id="åˆ é™¤ä»£ä»·-1"><a href="#åˆ é™¤ä»£ä»·-1" class="headerlink" title="åˆ é™¤ä»£ä»·"></a>åˆ é™¤ä»£ä»·</h3><p>B-Treeçš„åˆ é™¤ä¼šå‘ç”Ÿç»“ç‚¹åˆå¹¶æ“ä½œã€‚æœ€åæƒ…å†µä¸‹ç£ç›˜è®¿é—®æ¬¡æ•°æ˜¯3hï¼ï¼ˆæ‰¾åˆ°åŒ…å«è¢«åˆ é™¤å…ƒç´ éœ€è¦hæ¬¡è¯»è®¿é—®ï¼‰+ï¼ˆè·å–ç¬¬2è‡³hå±‚çš„æœ€ç›¸é‚»å…„å¼Ÿéœ€è¦h-1æ¬¡è¯»è®¿é—®ï¼‰+ï¼ˆåœ¨ç¬¬3è‡³hå±‚çš„åˆå¹¶éœ€è¦h-2æ¬¡å†™è®¿é—®ï¼‰+ï¼ˆå¯¹ä¿®æ”¹è¿‡çš„æ ¹èŠ‚ç‚¹å’Œç¬¬2å±‚çš„ä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œ3æ¬¡å†™è®¿é—®ï¼‰ã€‚</p><h3 id="B-Treeæ•ˆç‡æ€»ç»“"><a href="#B-Treeæ•ˆç‡æ€»ç»“" class="headerlink" title="B-Treeæ•ˆç‡æ€»ç»“"></a><strong>B-Treeæ•ˆç‡æ€»ç»“</strong></h3><p>ç”±äºè€ƒè™‘ç£ç›˜å‚¨å­˜ç»“æ„ï¼ŒBæ ‘çš„æŸ¥æ‰¾ã€åˆ é™¤ã€æ’å…¥çš„ä»£ä»·éƒ½è¿œè¿œè¦å°äºä»»ä½•äºŒå‰ç»“æ„æ ‘(è¯»å†™ç£ç›˜æ¬¡æ•°çš„é™ä½)ã€‚</p><h1 id="åŠ¨æ€æŸ¥æ‰¾æ ‘ç»“æ„çš„å¯¹æ¯”"><a href="#åŠ¨æ€æŸ¥æ‰¾æ ‘ç»“æ„çš„å¯¹æ¯”" class="headerlink" title="åŠ¨æ€æŸ¥æ‰¾æ ‘ç»“æ„çš„å¯¹æ¯”"></a>åŠ¨æ€æŸ¥æ‰¾æ ‘ç»“æ„çš„å¯¹æ¯”</h1><h2 id="å¹³è¡¡äºŒå‰æ ‘å’Œçº¢é»‘æ ‘-AVL-PK-RBT"><a href="#å¹³è¡¡äºŒå‰æ ‘å’Œçº¢é»‘æ ‘-AVL-PK-RBT" class="headerlink" title="å¹³è¡¡äºŒå‰æ ‘å’Œçº¢é»‘æ ‘ [AVL PK RBT]"></a>å¹³è¡¡äºŒå‰æ ‘å’Œçº¢é»‘æ ‘ [AVL PK RBT]</h2><p>AVL å’ŒRBT éƒ½æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘çš„ä¼˜åŒ–ã€‚å…¶æ€§èƒ½è¦è¿œè¿œå¥½äºäºŒå‰æŸ¥æ‰¾æ ‘ã€‚ä»–ä»¬ä¹‹é—´éƒ½æœ‰è‡ªå·±çš„ä¼˜åŠ¿ï¼Œå…¶åº”ç”¨ä¸Šä¹Ÿæœ‰ä¸åŒã€‚<br><strong>ç»“æ„å¯¹æ¯”ï¼š</strong> AVLçš„ç»“æ„é«˜åº¦å¹³è¡¡ï¼ŒRBTçš„ç»“æ„åŸºæœ¬å¹³è¡¡ã€‚å¹³è¡¡åº¦AVL &gt; RBT.<br><strong>æŸ¥æ‰¾å¯¹æ¯”ï¼š</strong> AVL æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦æœ€å¥½ï¼Œæœ€åæƒ…å†µéƒ½æ˜¯O(logN)ã€‚RBT æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦æœ€å¥½ä¸ºO(logN)ï¼Œæœ€åæƒ…å†µä¸‹æ¯”AVLç•¥å·®ã€‚<br><strong>æ’å…¥åˆ é™¤å¯¹æ¯”ï¼š</strong></p><ol><li>AVLçš„æ’å…¥å’Œåˆ é™¤ç»“ç‚¹å¾ˆå®¹æ˜“é€ æˆæ ‘ç»“æ„çš„ä¸å¹³è¡¡ï¼Œè€ŒRBTçš„å¹³è¡¡åº¦è¦æ±‚è¾ƒä½ã€‚å› æ­¤åœ¨å¤§é‡æ•°æ®æ’å…¥çš„æƒ…å†µä¸‹ï¼ŒRBTéœ€è¦é€šè¿‡æ—‹è½¬å˜è‰²æ“ä½œæ¥é‡æ–°è¾¾åˆ°å¹³è¡¡çš„é¢‘åº¦è¦å°äºAVLã€‚</li><li>å¦‚æœéœ€è¦å¹³è¡¡å¤„ç†æ—¶ï¼ŒRBTæ¯”AVLå¤šä¸€ç§å˜è‰²æ“ä½œï¼Œè€Œä¸”å˜è‰²çš„æ—¶é—´å¤æ‚åº¦åœ¨O(logN)æ•°é‡çº§ä¸Šã€‚ä½†æ˜¯ç”±äºæ“ä½œç®€å•ï¼Œæ‰€ä»¥åœ¨å®è·µä¸­è¿™ç§å˜è‰²ä»ç„¶æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚</li><li>å½“æ’å…¥ä¸€ä¸ªç»“ç‚¹éƒ½å¼•èµ·äº†æ ‘çš„ä¸å¹³è¡¡ï¼ŒAVLå’ŒRBTéƒ½æœ€å¤šéœ€è¦2æ¬¡æ—‹è½¬æ“ä½œã€‚ä½†åˆ é™¤ä¸€ä¸ªç»“ç‚¹å¼•èµ·ä¸å¹³è¡¡åï¼ŒAVLæœ€å¤šéœ€è¦logN æ¬¡æ—‹è½¬æ“ä½œï¼Œè€ŒRBTæœ€å¤šåªéœ€è¦3æ¬¡ã€‚å› æ­¤ä¸¤è€…æ’å…¥ä¸€ä¸ªç»“ç‚¹çš„ä»£ä»·å·®ä¸å¤šï¼Œä½†åˆ é™¤ä¸€ä¸ªç»“ç‚¹çš„ä»£ä»·RBTè¦ä½ä¸€äº›ã€‚</li><li>AVLå’ŒRBTçš„æ’å…¥åˆ é™¤ä»£ä»·ä¸»è¦è¿˜æ˜¯æ¶ˆè€—åœ¨æŸ¥æ‰¾å¾…æ“ä½œçš„ç»“ç‚¹ä¸Šã€‚å› æ­¤æ—¶é—´å¤æ‚åº¦åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸O(logN) æˆæ­£æ¯”çš„ã€‚</li></ol><p><strong>æ€»ä½“è¯„ä»·ï¼šå¤§é‡æ•°æ®å®è·µè¯æ˜ï¼ŒRBTçš„æ€»ä½“ç»Ÿè®¡æ€§èƒ½è¦å¥½äºå¹³è¡¡äºŒå‰æ ‘</strong>ã€‚</p><h2 id="B-æ ‘å’ŒB-æ ‘-B-Tree-PK-B-Tree"><a href="#B-æ ‘å’ŒB-æ ‘-B-Tree-PK-B-Tree" class="headerlink" title="B-æ ‘å’ŒB+æ ‘ [ B-Tree PK B+Tree]"></a>B-æ ‘å’ŒB+æ ‘ [ B-Tree PK B+Tree]</h2><p>B+æ ‘æ˜¯B-æ ‘çš„ä¸€ç§å˜ä½“ï¼Œåœ¨ç£ç›˜æŸ¥æ‰¾ç»“æ„ä¸­ï¼ŒB+æ ‘æ›´é€‚åˆæ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜å­˜å‚¨ç»“æ„ã€‚<br><strong>ç»“æ„å¯¹æ¯”ï¼š</strong><br>B-æ ‘æ˜¯å¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ï¼Œæ‰€æœ‰ç»“ç‚¹ä¸­éƒ½åŒ…å«äº†å¾…æŸ¥å…³é”®å­—çš„æœ‰æ•ˆä¿¡æ¯(æ¯”å¦‚æ–‡ä»¶ç£ç›˜æŒ‡é’ˆ)ã€‚æ¯ä¸ªç»“ç‚¹è‹¥æœ‰nä¸ªå…³é”®å­—ï¼Œåˆ™æœ‰n+1ä¸ªæŒ‡å‘å…¶ä»–ç»“ç‚¹çš„æŒ‡é’ˆã€‚</p><p>B+æ ‘ç›¸æ¯”B-æ ‘çš„ç‰¹ç‚¹ï¼š</p><ul><li>æ•°æ®åªå‡ºç°åœ¨å¶å­ç»“ç‚¹ï¼ŒB-æ ‘æ¯ä¸ªç»“ç‚¹éƒ½åŒ…å«äº†æ•°æ®ï¼›</li><li>å¶å­ç»“ç‚¹ä¹‹é—´ç”¨æŒ‡é’ˆè¿æ¥ï¼›</li><li>B+æ ‘çš„é«˜åº¦ä¸€èˆ¬æ˜¯3ï¼›</li></ul><p><strong>æŸ¥æ‰¾å¯¹æ¯”ï¼š</strong></p><ul><li><p>åœ¨ç›¸åŒæ•°é‡çš„å¾…æŸ¥æ•°æ®ä¸‹ï¼ŒB+æ ‘æŸ¥æ‰¾è¿‡ç¨‹ä¸­éœ€è¦è°ƒç”¨çš„ç£ç›˜IOæ“ä½œè¦å°‘äºæ™®é€šB-æ ‘ã€‚ç”±äºB+æ ‘æ‰€åœ¨çš„ç£ç›˜å­˜å‚¨èƒŒæ™¯ä¸‹ï¼Œå› æ­¤B+æ ‘çš„æŸ¥æ‰¾æ€§èƒ½è¦å¥½äºB-æ ‘ã€‚</p></li><li><p>B+æ ‘çš„æŸ¥æ‰¾æ•ˆç‡æ›´åŠ ç¨³å®šï¼Œå› ä¸ºæ‰€æœ‰å¶å­ç»“ç‚¹éƒ½å¤„äºåŒä¸€å±‚ä¸­ï¼Œè€Œä¸”æŸ¥æ‰¾æ‰€æœ‰å…³é”®å­—éƒ½å¿…é¡»èµ°å®Œä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„å…¨éƒ¨å†ç¨‹ã€‚å› æ­¤åŒä¸€é¢—B+æ ‘ä¸­ï¼Œä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾æ¯”è¾ƒæ¬¡æ•°éƒ½æ˜¯ä¸€æ ·çš„ã€‚è€ŒBæ ‘å°±ä¸ä¸€å®šäº†ï¼Œå¯èƒ½æŸ¥æ‰¾åˆ°æŸä¸€ä¸ªéç»ˆç»“ç‚¹å°±ç»“æŸäº†ã€‚</p><p>â€‹</p></li></ul><p><strong>æ’å…¥åˆ é™¤å¯¹æ¯”</strong>ï¼š B+æ ‘ä¸B-æ ‘åœ¨æ’å…¥åˆ é™¤æ“ä½œä¸­çš„æ•ˆç‡æ˜¯å·®ä¸å¤šçš„ã€‚</p><p><strong>æ€»ä½“è¯„ä»·ï¼šåœ¨åº”ç”¨èƒŒæ™¯ä¸‹ï¼Œç‰¹åˆ«æ˜¯æ–‡ä»¶ç»“æ„å­˜å‚¨ä¸­ã€‚B+æ ‘çš„åº”ç”¨è¦æ›´å¤šï¼Œå…¶æ•ˆç‡ä¹Ÿè¦æ¯”Bæ ‘å¥½</strong>ã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://blog.csdn.net/z702143700/article/details/49079107">äºŒå‰æŸ¥æ‰¾æ ‘ã€å¹³è¡¡äºŒå‰æ ‘ã€çº¢é»‘æ ‘ã€B-&#x2F;B+æ ‘æ€§èƒ½å¯¹æ¯”</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>æ•°æ®ç»“æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­—èŠ‚ä¸€é¢å‡‰ç»</title>
    <link href="/2021/07/28/%E5%AD%97%E8%8A%82%E4%B8%80%E9%9D%A2%E5%87%89%E7%BB%8F/"/>
    <url>/2021/07/28/%E5%AD%97%E8%8A%82%E4%B8%80%E9%9D%A2%E5%87%89%E7%BB%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="å­—èŠ‚æå‰æ‰¹æŠ€æœ¯ä¸­å°ä¸€é¢å‡‰ç»"><a href="#å­—èŠ‚æå‰æ‰¹æŠ€æœ¯ä¸­å°ä¸€é¢å‡‰ç»" class="headerlink" title="å­—èŠ‚æå‰æ‰¹æŠ€æœ¯ä¸­å°ä¸€é¢å‡‰ç»~"></a>å­—èŠ‚æå‰æ‰¹æŠ€æœ¯ä¸­å°ä¸€é¢å‡‰ç»~</h1><blockquote><p>07.26 15:00-16:10 é¢è¯•å®˜äººå¾ˆå¥½</p></blockquote><ol><li><p>è‡ªæˆ‘ä»‹ç»</p></li><li><p>é¡¹ç›®ä»‹ç»ï¼Œç»“åˆé¡¹ç›®é—®äº†äº›é—®é¢˜ï¼ˆqpså¤šå°‘ï¼Ÿå†…å­˜å ç”¨å¤šå°‘ï¼Ÿåé¢æ€ä¹ˆæ›´æ–°å’Œç»´æŠ¤è¿™ä¸ªé¡¹ç›®ï¼Ÿæ‰“ç®—ç”¨ä»¤ç‰Œæ¡¶é™æµï¼‰</p></li><li><p>JDKå¹³æ—¶ç”¨çš„ç‰ˆæœ¬ï¼Ÿ</p></li><li><p>Stringç±»å¯ç»§æ‰¿å—ï¼Ÿ finalä¿®é¥°ï¼Œä¸å¯è¢«ç»§æ‰¿</p></li><li><p>HashMapå…«è‚¡ JDK1.7â€”&gt;1.8å˜åŒ– åº•å±‚ç»“æ„å’Œå¤´æ’å˜å°¾æ’</p></li><li><p>å¹¶å‘ä¸‹æ€ä¹ˆç”¨Mapï¼ŸconcurentHashMapâ€”åº•å±‚å®ç° JDK1.7â€”1.8 è¿˜æœ‰åˆ«çš„æ–¹æ³•ä¿è¯çº¿ç¨‹å®‰å…¨å—ï¼Ÿ hashmapåŠ é”ï¼Œä½†ä¸ä¼šç”¨ï¼Œæ‰¿è½½èƒ½åŠ›æ²¡è¿™ä¸ªå¥½ ä¸ºä»€ä¹ˆï¼Ÿ 1.7ä¸­åˆ†æ®µé”åº•å±‚æ˜¯ä»€ä¹ˆï¼Ÿ putæ€ä¹ˆé” getä¼šé”ï¼Ÿ è·å–Entryæ•°ç»„é•¿åº¦æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿï¼ˆè¿™ä¸ªæ²¡å¬è¿‡å“ˆå“ˆå•Š åº”è¯¥æ˜¯çš„å§ï¼‰</p></li><li><p>çº¢é»‘æ ‘ set getçš„æ—¶é—´å¤æ‚åº¦ï¼ŸO(logn)</p></li><li><p>è¯´è¯´å¹¶å‘ä¸‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜å§ï¼ˆè¿™ä¸ªæ˜¯æˆ‘ç†è§£é¢è¯•å®˜æ‰€è¯´çš„ï¼‰é” valtile JUCä¸‹çš„åŸå­ç±» å¤©ç„¶çº¿ç¨‹å®‰å…¨æ— çŠ¶æ€ä»£ç  static</p></li><li><p>volatileä½œç”¨ï¼Ÿåº•å±‚å®ç°ï¼Ÿ</p></li><li><p>mysqlçš„æœ‰å“ªäº›å­˜å‚¨å¼•æ“ï¼Œå¯¹æ¯”ä¸‹</p></li><li><p>ACID</p></li><li><p>å››å¤§éš”ç¦»çº§åˆ«</p></li><li><p>é‡åˆ°è¿‡æ…¢SQLå—ï¼Ÿ å“ˆå“ˆ æ²¡é‡åˆ°ï¼Œè‡ªå·±è®¾è®¡çš„è¡¨å¾ˆç®€å•ï¼Œä¸è¿‡æˆ‘å¯ä»¥è¯´è¯´æˆ‘å¯¹ä¼˜åŒ–SQLå’Œå»ºç«‹ç´¢å¼•è¿™å—çš„ç†è§£â€”&gt;ä¸€èˆ¬æ¯ä¸ªè¡¨éƒ½ä¼šæœ‰innodbçš„è‡ªå¢idï¼Œä¸ç”¨ä¸šåŠ¡è‡ªå¸¦çš„idï¼Œè®²äº†ä¸‹åŸå› ï¼›è¦†ç›–ç´¢å¼•ï¼Œå°½é‡ä¸è¦å›è¡¨ï¼Œå¯ä»¥explainæŸ¥çœ‹ï¼›å“ªäº›é€‚åˆå»ºç´¢å¼•ï¼Œç´¢å¼•å¤±æ•ˆçš„æƒ…å†µï¼Œå¤šä¸ªç´¢å¼•å’Œè”åˆç´¢å¼•ï¼Œæœ€å·¦å‰ç¼€åŸåˆ™</p></li><li><p>å¾®æœåŠ¡æ²»ç†ï¼Ÿæˆ‘æ²¡ç”¨å¾®æœåŠ¡å•Šï¼Œéƒ½æ˜¯å•ä½“SpringBootâ€”â€”æ˜¯çš„ï¼Œæˆ‘æƒ³çœ‹ä½ äº†è§£è¿‡æ²¡ï¼Ÿå“¦å“¦ï¼Œé‚£æˆ‘è¿˜æ˜¯å­¦è¿‡SpringCloudå’ŒSprinCloudAliababaï¼Œå› ä¸ºNetfilxçš„å®£å¸ƒåœæ­¢ç»´æŠ¤è‡ªå·±çš„ç»„ä»¶ï¼Œæ‰€ä»¥æ–°ä¸€å¥—çš„å¾®æœåŠ¡æŠ€æœ¯æ ˆæ…¢æ…¢è½¬å˜æˆï¼š<br>æœåŠ¡æ³¨å†Œä¸­å¿ƒ nacos<br>æœåŠ¡é—´é€šä¿¡ç»„ä»¶ a.RestTemplate+Ribbon b.OpenFeigç»„ä»¶<br>æœåŠ¡ç†”æ–­ã€æµæ§ sentinel<br>ç½‘å…³ gateway<br>æœåŠ¡é…ç½®ä¸­å¿ƒ nacos</p></li><li><p>ok æˆ‘ä»¬æ¥ä¸ªSQLé¢˜</p><p><img src="https://uploadfiles.nowcoder.com/images/20210726/854208335_1627302797930/1F18B11DDB50077C9ECF00D88ED81E49"></p></li><li><p>NC91 æœ€é•¿é€’å¢å­åºåˆ— è¿™ä¸ªbé¢˜å‘•æ­»æˆ‘äº†ï¼Œå°±æ˜¯æˆ‘æ²¡åˆ·çš„ï¼ŒLISæ˜¯å¾ˆç®€å•ï¼Œä½†æˆ‘åªæ˜¯åœ¨LeetCodeä¸Šå†™çš„ï¼Œåªè¿”å›é•¿åº¦ï¼Œç›´æ¥DPï¼Œä½†æ˜¯è¿™ä¸ªç‰›å®¢å•Šï¼Œè¦è¿”å›åºåˆ—ï¼Œæ·¦ï¼Œæ²¡å†™å®Œï¼ï¼ï¼</p></li></ol><p>ç¬¬ä¸€æ¬¡é¢å¤§å‚ï¼Œæœ¬äººç®—æ³•å¾ˆä¸å¥½ï¼Œä¹Ÿå°±æŠŠå‰‘æŒ‡Offerå’ŒTOP100åˆ·å®Œäº†ï¼Œåˆ·äº†å¥½å‡ éï¼Œå¹³æ—¶ä¼šçœ‹ä¹¦ï¼Œå› ä¸ºçœ‹ä¹‹å‰å­—èŠ‚çš„é¢ç»éƒ½æ˜¯é—®OSï¼Œè®¡ç½‘ï¼Œæ‰€ä»¥è¯­è¨€åŸºç¡€å°±æ²¡æ€ä¹ˆçœ‹ï¼Œå®³ï¼Œæå‰æ‰¹ï¼Œè¯•è¯•å˜›ï¼ç§‹æ‹›ç»§ç»­æŠ•~</p>]]></content>
    
    
    
    <tags>
      
      <tag>é¢ç»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢</title>
    <link href="/2021/07/19/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2/"/>
    <url>/2021/07/19/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸Šä¸‹æ–‡"><a href="#ä¸Šä¸‹æ–‡" class="headerlink" title="ä¸Šä¸‹æ–‡"></a>ä¸Šä¸‹æ–‡</h1><p>é¦–å…ˆï¼Œéœ€è¦è®²æ¸…æ¥šä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ã€‚</p><p>æ¯ä¸ªä»»åŠ¡è¿è¡Œå‰ï¼ŒCPU éƒ½éœ€è¦çŸ¥é“ä»»åŠ¡ä»å“ªé‡ŒåŠ è½½ã€åˆä»å“ªé‡Œå¼€å§‹è¿è¡Œï¼Œè¿™å°±æ¶‰åŠåˆ° <strong>CPU å¯„å­˜å™¨</strong> å’Œ <strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰</strong>ï¼š</p><ul><li>CPU å¯„å­˜å™¨æ˜¯ CPU å†…ç½®çš„å®¹é‡å°ã€ä½†é€Ÿåº¦æå¿«çš„å†…å­˜ï¼›</li><li>ç¨‹åºè®¡æ•°å™¨ä¼šå­˜å‚¨ CPU æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ä½ç½®ï¼Œæˆ–è€…å³å°†æ‰§è¡Œçš„æŒ‡ä»¤ä½ç½®ã€‚</li></ul><p>è¿™ä¸¤ä¸ªæ˜¯ CPU è¿è¡Œä»»ä½•ä»»åŠ¡å‰éƒ½å¿…é¡»ä¾èµ–çš„ç¯å¢ƒï¼Œå› æ­¤å«åš CPU ä¸Šä¸‹æ–‡ã€‚</p><h1 id="ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>ä¸Šä¸‹æ–‡åˆ‡æ¢</h1><p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢å‘¢ï¼Ÿä¸‹é¢æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶éœ€è¦å±¥è¡Œçš„æ­¥éª¤ï¼š</p><ol><li>å°†å‰ä¸€ä¸ª CPU çš„ä¸Šä¸‹æ–‡ï¼ˆä¹Ÿå°±æ˜¯ CPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨é‡Œè¾¹çš„å†…å®¹ï¼‰ä¿å­˜èµ·æ¥ï¼›</li><li>ç„¶ååŠ è½½æ–°ä»»åŠ¡çš„ä¸Šä¸‹æ–‡åˆ°å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨ï¼›</li><li>æœ€åè·³è½¬åˆ°ç¨‹åºè®¡æ•°å™¨æ‰€æŒ‡çš„æ–°ä½ç½®ï¼Œè¿è¡Œæ–°ä»»åŠ¡ã€‚</li></ol><p>è¢«ä¿å­˜èµ·æ¥çš„ä¸Šä¸‹æ–‡ä¼šå­˜å‚¨åˆ°<strong>ç³»ç»Ÿå†…æ ¸</strong>ä¸­ï¼Œç­‰å¾…ä»»åŠ¡é‡æ–°è°ƒåº¦æ‰§è¡Œæ—¶å†æ¬¡åŠ è½½è¿›æ¥ã€‚</p><p>CPU çš„ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ†ä¸‰ç§ï¼š<strong>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ã€‚</p><h1 id="ç³»ç»Ÿè°ƒç”¨"><a href="#ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨"></a>ç³»ç»Ÿè°ƒç”¨</h1><p>Linux æŒ‰ç…§ç‰¹æƒç­‰çº§ï¼ŒæŠŠè¿›ç¨‹çš„è¿è¡Œç©ºé—´åˆ†ä¸º<strong>å†…æ ¸ç©ºé—´</strong>å’Œ<strong>ç”¨æˆ·ç©ºé—´</strong>ï¼š</p><ul><li>å†…æ ¸ç©ºé—´ï¼šå…·æœ‰æœ€é«˜æƒé™ï¼Œå¯ä»¥è®¿é—®æ‰€æœ‰èµ„æºï¼›</li><li>ç”¨æˆ·ç©ºé—´ï¼šåªèƒ½è®¿é—®å—é™èµ„æºï¼Œä¸èƒ½ç›´æ¥è®¿é—®å†…å­˜ç­‰ç¡¬ä»¶è®¾å¤‡ï¼Œå¿…é¡»å€ŸåŠ©ç³»ç»Ÿè°ƒç”¨ã€‚</li></ul><p>è¿›ç¨‹å¯ä»¥åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œï¼ˆå«ä½œï¼šè¿›ç¨‹ç”¨æˆ·æ€ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨å†…æ ¸ç©ºé—´è¿è¡Œï¼ˆå«ä½œï¼šè¿›ç¨‹å†…æ ¸æ€ï¼‰ã€‚ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€éœ€è¦<strong>ç³»ç»Ÿè°ƒç”¨</strong>å®Œæˆã€‚</p><p>ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸­ä¹Ÿä¼šå‘ç”Ÿ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚CPU å¯„å­˜å™¨ä¼šå…ˆä¿å­˜ç”¨æˆ·æ€çš„çŠ¶æ€ï¼Œç„¶ååŠ è½½å†…æ ¸æ€ç›¸å…³å†…å®¹ã€‚ç³»ç»Ÿè°ƒç”¨ç»“æŸä¹‹åï¼ŒCPU å¯„å­˜å™¨è¦æ¢å¤åŸæ¥ä¿å­˜çš„ç”¨æˆ·æ€ï¼Œç»§ç»­è¿è¡Œè¿›ç¨‹ã€‚æ‰€ä»¥ï¼Œ<strong>ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œå‘ç”Ÿä¸¤æ¬¡ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œä¸æ¶‰åŠè™šæ‹Ÿå†…å­˜ç­‰è¿›ç¨‹ç”¨æˆ·æ€çš„èµ„æºï¼Œä¹Ÿä¸ä¼šåˆ‡æ¢è¿›ç¨‹ã€‚ä¸é€šå¸¸æ‰€è¯´çš„è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸åŒï¼š</p><ul><li>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æŒ‡ï¼Œä»ä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼›</li><li>ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸­ä¸€ç›´æ˜¯åŒä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œã€‚</li></ul><h1 id="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</h1><p><strong>è¿›ç¨‹æ˜¯ç”±å†…æ ¸ç®¡ç†å’Œè°ƒåº¦çš„ï¼Œè¿›ç¨‹çš„åˆ‡æ¢åªèƒ½å‘ç”Ÿåœ¨å†…æ ¸æ€ã€‚</strong> å› æ­¤ï¼Œè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸ä½†åŒ…æ‹¬è™šæ‹Ÿå†…å­˜ã€æ ˆã€å…¨å±€å˜é‡ç­‰ç”¨æˆ·ç©ºé—´èµ„æºï¼Œè¿˜åŒ…æ‹¬å†…æ ¸å †æ ˆã€å¯„å­˜å™¨ç­‰å†…æ ¸ç©ºé—´çŠ¶æ€ã€‚æ‰€ä»¥ï¼Œè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”ç³»ç»Ÿè°ƒç”¨å¤šä¸€ä¸ªæ­¥éª¤ï¼šä¿å­˜å½“å‰è¿›ç¨‹çš„å†…æ ¸çŠ¶æ€å’Œ CPU å¯„å­˜å™¨ä¹‹å‰ï¼Œå…ˆæŠŠè¯¥è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ã€æ ˆç­‰ä¿å­˜èµ·æ¥ï¼›åŠ è½½ä¸‹ä¸€ä¸ªè¿›ç¨‹çš„å†…æ ¸æ€åï¼Œè¿˜éœ€è¦åˆ·æ–°è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜å’Œç”¨æˆ·æ ˆã€‚<strong>ä¿å­˜ä¸Šä¸‹æ–‡å’Œæ¢å¤ä¸Šä¸‹æ–‡éœ€è¦å†…æ ¸åœ¨ CPU ä¸Šè¿è¡Œæ‰èƒ½å®Œæˆã€‚</strong></p><p>Linux é€šè¿‡ TLB (Translation Lookaside Buffer) ç®¡ç†è™šæ‹Ÿå†…å­˜åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„å…³ç³»ã€‚å½“è™šæ‹Ÿå†…å­˜æ›´æ–°åï¼ŒTLB ä¹Ÿéœ€è¦åˆ·æ–°ï¼Œå†…å­˜çš„è®¿é—®é€Ÿåº¦ä¼šå› æ­¤å˜æ…¢ã€‚å°¤å…¶åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šï¼Œç¼“å­˜è¢«å¤šä¸ªå¤„ç†å™¨å…±äº«ï¼Œåˆ·æ–°ç¼“å­˜ä¸ä»…å½±å“å½“å‰å¤„ç†å™¨çš„è¿›ç¨‹ï¼Œè¿˜ä¼šå½±å“å…±äº«ç¼“å­˜çš„å…¶ä»–å¤„ç†å™¨è¿›ç¨‹ã€‚</p><p>Linux ä¼šä¸ºæ¯ä¸ª CPU éƒ½ç»´æŠ¤ä¸€ä¸ªå°±ç»ªé˜Ÿåˆ—ï¼Œå°†æ´»è·ƒè¿›ç¨‹ï¼ˆæ­£åœ¨è¿è¡Œå’Œæ­£åœ¨ç­‰å¾… CPU çš„è¿›ç¨‹ï¼‰æŒ‰ç…§ä¼˜å…ˆçº§å’Œç­‰å¾… CPU æ—¶é—´æ¥æ’åºï¼Œç„¶åé€‰æ‹©æœ€éœ€è¦ CPU çš„è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¼˜å…ˆçº§æœ€é«˜å’Œç­‰å¾… CPU æ—¶é—´æœ€é•¿çš„è¿›ç¨‹æ¥è¿è¡Œã€‚</p><p>è¿›ç¨‹åˆ‡æ¢æ—¶éœ€è¦åˆ‡æ¢ä¸Šä¸‹æ–‡ï¼Œè¿›ç¨‹åˆ‡æ¢çš„åœºæ™¯æœ‰ï¼š</p><p>è¿›ç¨‹æ—¶é—´ç‰‡è€—å°½ï¼›<br>ç³»ç»Ÿèµ„æºä¸è¶³ï¼ˆå¦‚å†…å­˜ä¸è¶³ï¼‰ï¼›<br>è¿›ç¨‹é€šè¿‡ç¡çœ å‡½æ•° sleep æŠŠè‡ªå·±æŒ‚èµ·æ¥ï¼›<br>å½“æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„è¿›ç¨‹è¿è¡Œæ—¶ï¼Œä¸ºäº†å»è¿è¡Œé«˜ä¼˜å…ˆçº§è¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹ä¼šè¢«æŒ‚èµ·ï¼›<br>å‘ç”Ÿç¡¬ä¸­æ–­ï¼ŒCPU ä¸Šçš„è¿›ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œç„¶åå»æ‰§è¡Œå†…æ ¸ä¸­çš„ä¸­æ–­æœåŠ¡è¿›ç¨‹ã€‚</p><h1 id="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</h1><p><strong>çº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè€Œè¿›ç¨‹åˆ™æ˜¯èµ„æºæ‹¥æœ‰çš„åŸºæœ¬å•ä½ã€‚</strong></p><p>å†…æ ¸ä¸­çš„ä»»åŠ¡è°ƒåº¦å®é™…æ˜¯åœ¨è°ƒåº¦çº¿ç¨‹ï¼Œè¿›ç¨‹åªæ˜¯ç»™çº¿ç¨‹æä¾›è™šæ‹Ÿå†…å­˜ã€å…¨å±€å˜é‡ç­‰èµ„æºã€‚çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œå…±äº«ç›¸åŒçš„è™šæ‹Ÿå†…å­˜å’Œå…¨å±€å˜é‡ç­‰èµ„æºä¸éœ€è¦ä¿®æ”¹ã€‚è€Œçº¿ç¨‹è‡ªå·±çš„ç§æœ‰æ•°æ®ï¼Œå¦‚æ ˆå’Œå¯„å­˜å™¨ç­‰ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶éœ€è¦ä¿å­˜ã€‚</p><p>çº¿ç¨‹åˆ‡æ¢åˆ†ä¸¤ç§æƒ…å†µï¼š</p><p>å‰åä¸¤ä¸ªçº¿ç¨‹å±äºä¸åŒè¿›ç¨‹ï¼›<br>å‰åä¸¤ä¸ªçº¿ç¨‹å±äºåŒä¸€ä¸ªè¿›ç¨‹ï¼ˆé€Ÿåº¦æ›´å¿«ï¼Œæ¶ˆè€—æ›´å°‘èµ„æºï¼‰ã€‚</p><h1 id="ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢</h1><p>ä¸ºäº†å¿«é€Ÿå“åº”ç¡¬ä»¶çš„äº‹ä»¶ï¼Œ<strong>ä¸­æ–­å¤„ç†ä¼šæ‰“æ–­è¿›ç¨‹çš„æ­£å¸¸è°ƒåº¦å’Œæ‰§è¡Œ</strong>ï¼Œç„¶åè°ƒç”¨ä¸­æ–­å¤„ç†ç¨‹åºï¼Œå“åº”è®¾å¤‡äº‹ä»¶ã€‚åœ¨æ‰“æ–­å…¶ä»–è¿›ç¨‹æ—¶ï¼Œéœ€è¦å…ˆå°†è¿›ç¨‹å½“å‰çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥ï¼Œç­‰ä¸­æ–­ç»“æŸåï¼Œè¿›ç¨‹ä»ç„¶å¯ä»¥æ¢å¤å›æ¥ã€‚</p><p>è·Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡ä¸åŒï¼Œä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸æ¶‰åŠè¿›ç¨‹çš„ç”¨æˆ·æ€ã€‚æ‰€ä»¥ï¼Œå³ä¾¿ä¸­æ–­è¿‡ç¨‹æ‰“æ–­äº†ä¸€ä¸ªæ­£å¤„åœ¨ç”¨æˆ·æ€çš„è¿›ç¨‹ï¼Œä¹Ÿä¸éœ€è¦ä¿å­˜å’Œæ¢å¤è¿™ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ã€å…¨å±€å˜é‡ç­‰ç”¨æˆ·æ€èµ„æºã€‚ä¸­æ–­ä¸Šä¸‹æ–‡ï¼ŒåªåŒ…æ‹¬å†…æ ¸æ€ä¸­æ–­æœåŠ¡ç¨‹åºæ‰§è¡Œæ‰€å¿…éœ€çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ CPU å¯„å­˜å™¨ã€å†…æ ¸å †æ ˆã€ç¡¬ä»¶ä¸­æ–­å‚æ•°ç­‰ã€‚</p><p><strong>å¯¹åŒä¸€ä¸ª CPU æ¥è¯´ï¼Œä¸­æ–­å¤„ç†æ¯”è¿›ç¨‹æ‹¥æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§</strong>ï¼Œæ‰€ä»¥ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸ä¼šä¸è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢åŒæ—¶å‘ç”Ÿã€‚å¹¶ä¸”ï¼Œç”±äºä¸­æ–­ä¼šæ‰“æ–­æ­£å¸¸è¿›ç¨‹çš„è°ƒåº¦å’Œæ‰§è¡Œï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†ä¸­æ–­å¤„ç†ç¨‹åºéƒ½çŸ­å°ç²¾æ‚ï¼Œä»¥ä¾¿å¯ä»¥å°½å¿«å®Œæˆã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://blog.csdn.net/qq_41359051/article/details/89673188?utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-6.pc_relevant_baidujshouduan&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-6.pc_relevant_baidujshouduan">ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisä¹‹AOFé‡å†™åŠå…¶å®ç°åŸç†</title>
    <link href="/2021/07/19/Redis%E4%B9%8BAOF%E9%87%8D%E5%86%99%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"/>
    <url>/2021/07/19/Redis%E4%B9%8BAOF%E9%87%8D%E5%86%99%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="AOFé‡å†™"><a href="#AOFé‡å†™" class="headerlink" title="AOFé‡å†™"></a>AOFé‡å†™</h1><ul><li>AOF æŒä¹…åŒ–æ˜¯é€šè¿‡ä¿å­˜è¢«æ‰§è¡Œçš„å†™å‘½ä»¤æ¥è®°å½•æ•°æ®åº“çŠ¶æ€çš„ï¼Œæ‰€ä»¥AOFæ–‡ä»¶çš„å¤§å°éšç€æ—¶é—´çš„æµé€ä¸€å®šä¼šè¶Šæ¥è¶Šå¤§ï¼›å½±å“åŒ…æ‹¬ä½†ä¸é™äºï¼šå¯¹äºRedisæœåŠ¡å™¨ï¼Œè®¡ç®—æœºçš„å­˜å‚¨å‹åŠ›ï¼›AOFè¿˜åŸå‡ºæ•°æ®åº“çŠ¶æ€çš„æ—¶é—´å¢åŠ ï¼›</li><li>ä¸ºäº†è§£å†³AOFæ–‡ä»¶ä½“ç§¯è†¨èƒ€çš„é—®é¢˜ï¼ŒRedisæä¾›äº†AOFé‡å†™åŠŸèƒ½ï¼šRedisæœåŠ¡å™¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶æ¥æ›¿ä»£ç°æœ‰çš„AOFæ–‡ä»¶ï¼Œæ–°æ—§ä¸¤ä¸ªæ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯æ–°çš„AOFæ–‡ä»¶ä¸ä¼šåŒ…å«ä»»ä½•æµªè´¹ç©ºé—´çš„å†—ä½™å‘½ä»¤ï¼Œé€šå¸¸ä½“ç§¯ä¼šè¾ƒæ—§AOFæ–‡ä»¶å°å¾ˆå¤šã€‚</li></ul><h2 id="AOF-æ–‡ä»¶é‡å†™çš„å®ç°"><a href="#AOF-æ–‡ä»¶é‡å†™çš„å®ç°" class="headerlink" title="AOF æ–‡ä»¶é‡å†™çš„å®ç°"></a>AOF æ–‡ä»¶é‡å†™çš„å®ç°</h2><ul><li>AOFé‡å†™å¹¶ä¸éœ€è¦å¯¹åŸæœ‰AOFæ–‡ä»¶è¿›è¡Œä»»ä½•çš„è¯»å–ï¼Œå†™å…¥ï¼Œåˆ†æç­‰æ“ä½œï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯é€šè¿‡è¯»å–æœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“çŠ¶æ€æ¥å®ç°çš„ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å‡è®¾æœåŠ¡å™¨å¯¹é”®listæ‰§è¡Œäº†ä»¥ä¸‹å‘½ä»¤s;</span><br>127.0.0.1:6379&gt; RPUSH list &quot;A&quot; &quot;B&quot;<br>(integer) 2<br>127.0.0.1:6379&gt; RPUSH list &quot;C&quot;<br>(integer) 3<br>127.0.0.1:6379&gt; RPUSH list &quot;D&quot; &quot;E&quot;<br>(integer) 5<br>127.0.0.1:6379&gt; LPOP list<br>&quot;A&quot;<br>127.0.0.1:6379&gt; LPOP list<br>&quot;B&quot;<br>127.0.0.1:6379&gt; RPUSH list &quot;F&quot; &quot;G&quot;<br>(integer) 5<br>127.0.0.1:6379&gt; LRANGE list 0 -1<br>1) &quot;C&quot;<br>2) &quot;D&quot;<br>3) &quot;E&quot;<br>4) &quot;F&quot;<br>5) &quot;G&quot;<br>127.0.0.1:6379&gt;<br></code></pre></td></tr></table></figure><ul><li>å½“å‰åˆ—è¡¨é”®liståœ¨æ•°æ®åº“ä¸­çš„å€¼å°±ä¸º[â€œCâ€, â€œDâ€, â€œEâ€, â€œFâ€, â€œGâ€]ã€‚è¦ä½¿ç”¨å°½é‡å°‘çš„å‘½ä»¤æ¥è®°å½•listé”®çš„çŠ¶æ€ï¼Œæœ€ç®€å•çš„æ–¹å¼ä¸æ˜¯å»è¯»å–å’Œåˆ†æç°æœ‰AOFæ–‡ä»¶çš„å†…å®¹ï¼Œï¼Œè€Œæ˜¯ç›´æ¥è¯»å–listé”®åœ¨æ•°æ®åº“ä¸­çš„å½“å‰å€¼ï¼Œç„¶åç”¨ä¸€æ¡RPUSH list â€œCâ€ â€œDâ€ â€œEâ€ â€œFâ€ â€œGâ€ä»£æ›¿å‰é¢çš„6æ¡å‘½ä»¤ã€‚</li></ul><h2 id="AOFé‡å†™åŠŸèƒ½çš„å®ç°åŸç†"><a href="#AOFé‡å†™åŠŸèƒ½çš„å®ç°åŸç†" class="headerlink" title="AOFé‡å†™åŠŸèƒ½çš„å®ç°åŸç†"></a>AOFé‡å†™åŠŸèƒ½çš„å®ç°åŸç†</h2><ul><li>é¦–å…ˆä»æ•°æ®åº“ä¸­è¯»å–é”®ç°åœ¨çš„å€¼ï¼Œç„¶åç”¨ä¸€æ¡å‘½ä»¤å»è®°å½•é”®å€¼å¯¹ï¼Œä»£æ›¿ä¹‹å‰è®°å½•è¯¥é”®å€¼å¯¹çš„å¤šä¸ªå‘½ä»¤;</li><li>ä¼ªä»£ç è¡¨ç¤ºå¦‚ä¸‹;</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">AOF</span>\_REWRITE(tmp\_tile\_name):<br>f = create(tmp\_tile\_name)<br><span class="hljs-comment"># éå†æ‰€æœ‰æ•°æ®åº“</span><br><span class="hljs-keyword">for</span> db <span class="hljs-keyword">in</span> redisServer.db:<br><span class="hljs-comment"># å¦‚æœæ•°æ®åº“ä¸ºç©ºï¼Œé‚£ä¹ˆè·³è¿‡è¿™ä¸ªæ•°æ®åº“</span><br><span class="hljs-keyword">if</span> db.<span class="hljs-keyword">is</span>\_empty(): <span class="hljs-keyword">continue</span><br><span class="hljs-comment"># å†™å…¥ SELECT å‘½ä»¤ï¼Œç”¨äºåˆ‡æ¢æ•°æ®åº“</span><br>f.write\_command(<span class="hljs-string">&quot;SELECT &quot;</span> + db.number)<br><span class="hljs-comment"># éå†æ‰€æœ‰é”®</span><br><span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> db:<br><span class="hljs-comment"># å¦‚æœé”®å¸¦æœ‰è¿‡æœŸæ—¶é—´ï¼Œå¹¶ä¸”å·²ç»è¿‡æœŸï¼Œé‚£ä¹ˆè·³è¿‡è¿™ä¸ªé”®</span><br><span class="hljs-keyword">if</span> key.have\_expire\_time() <span class="hljs-keyword">and</span> key.<span class="hljs-keyword">is</span>\_expired(): <span class="hljs-keyword">continue</span><br><span class="hljs-keyword">if</span> key.<span class="hljs-built_in">type</span> == String:<br><span class="hljs-comment"># ç”¨ SET key value å‘½ä»¤æ¥ä¿å­˜å­—ç¬¦ä¸²é”®</span><br>value = get\_value\_<span class="hljs-keyword">from</span>\_string(key)<br>f.write\_command(<span class="hljs-string">&quot;SET &quot;</span> + key + value)<br><span class="hljs-keyword">elif</span> key.<span class="hljs-built_in">type</span> == <span class="hljs-type">List</span>:<br><span class="hljs-comment"># ç”¨ RPUSH key item1 item2 ... itemN å‘½ä»¤æ¥ä¿å­˜åˆ—è¡¨é”®</span><br>item1, item2, ..., itemN = get\_item\_<span class="hljs-keyword">from</span>\_<span class="hljs-built_in">list</span>(key)<br>f.write\_command(<span class="hljs-string">&quot;RPUSH &quot;</span> + key + item1 + item2 + ... + itemN)<br><span class="hljs-keyword">elif</span> key.<span class="hljs-built_in">type</span> == <span class="hljs-type">Set</span>:<br><span class="hljs-comment"># ç”¨ SADD key member1 member2 ... memberN å‘½ä»¤æ¥ä¿å­˜é›†åˆé”®</span><br>member1, member2, ..., memberN = get\_member\_<span class="hljs-keyword">from</span>\_<span class="hljs-built_in">set</span>(key)<br>f.write\_command(<span class="hljs-string">&quot;SADD &quot;</span> + key + member1 + member2 + ... + memberN)<br><span class="hljs-keyword">elif</span> key.<span class="hljs-built_in">type</span> == Hash:<br><span class="hljs-comment"># ç”¨ HMSET key field1 value1 field2 value2 ... fieldN valueN å‘½ä»¤æ¥ä¿å­˜å“ˆå¸Œé”®</span><br>field1, value1, field2, value2, ..., fieldN, valueN =\<br>get\_field\_<span class="hljs-keyword">and</span>\_value\_<span class="hljs-keyword">from</span>\_<span class="hljs-built_in">hash</span>(key)<br>f.write\_command(<span class="hljs-string">&quot;HMSET &quot;</span> + key + field1 + value1 + field2 + value2 +\<br><span class="hljs-meta">... </span>+ fieldN + valueN)<br><span class="hljs-keyword">elif</span> key.<span class="hljs-built_in">type</span> == SortedSet:<br><span class="hljs-comment"># ç”¨ ZADD key score1 member1 score2 member2 ... scoreN memberN</span><br><span class="hljs-comment"># å‘½ä»¤æ¥ä¿å­˜æœ‰åºé›†é”®</span><br>score1, member1, score2, member2, ..., scoreN, memberN = \<br>get\_score\_<span class="hljs-keyword">and</span>\_member\_<span class="hljs-keyword">from</span>\_<span class="hljs-built_in">sorted</span>\_<span class="hljs-built_in">set</span>(key)<br>f.write\_command(<span class="hljs-string">&quot;ZADD &quot;</span> + key + score1 + member1 + score2 + member2 +\<br><span class="hljs-meta">... </span>+ scoreN + memberN)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">raise</span>\_<span class="hljs-built_in">type</span>\_error()<br><span class="hljs-comment"># å¦‚æœé”®å¸¦æœ‰è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆç”¨ EXPIREAT key time å‘½ä»¤æ¥ä¿å­˜é”®çš„è¿‡æœŸæ—¶é—´</span><br><span class="hljs-keyword">if</span> key.have\_expire\_time():<br>f.write\_command(<span class="hljs-string">&quot;EXPIREAT &quot;</span> + key + key.expire\_time\_<span class="hljs-keyword">in</span>\_unix\_timestamp())<br><span class="hljs-comment"># å…³é—­æ–‡ä»¶</span><br>f.close()<br></code></pre></td></tr></table></figure><ul><li>å®é™…ä¸ºäº†é¿å…æ‰§è¡Œå‘½ä»¤æ—¶é€ æˆå®¢æˆ·ç«¯è¾“å…¥ç¼“å†²åŒºæº¢å‡ºï¼Œé‡å†™ç¨‹åºåœ¨å¤„ç†list hash set zsetæ—¶ï¼Œä¼šæ£€æŸ¥é”®æ‰€åŒ…å«çš„å…ƒç´ çš„ä¸ªæ•°ï¼Œå¦‚æœå…ƒç´ çš„æ•°é‡è¶…è¿‡äº†redis.h&#x2F;REDIS_AOF_REWRITE_ITEMS_PER_CMDå¸¸é‡çš„å€¼ï¼Œé‚£ä¹ˆé‡å†™ç¨‹åºä¼šä½¿ç”¨å¤šæ¡å‘½ä»¤æ¥è®°å½•é”®çš„å€¼ï¼Œè€Œä¸æ˜¯å•ä½¿ç”¨ä¸€æ¡å‘½ä»¤ã€‚è¯¥å¸¸é‡é»˜è®¤å€¼æ˜¯64â€“ å³æ¯æ¡å‘½ä»¤è®¾ç½®çš„å…ƒç´ çš„ä¸ªæ•° æ˜¯æœ€å¤š64ä¸ªï¼Œä½¿ç”¨å¤šæ¡å‘½ä»¤é‡å†™å®ç°é›†åˆé”®ä¸­å…ƒç´ æ•°é‡è¶…è¿‡64ä¸ªçš„é”®ï¼›</li></ul><h2 id="AOFåå°é‡å†™"><a href="#AOFåå°é‡å†™" class="headerlink" title="AOFåå°é‡å†™"></a>AOFåå°é‡å†™</h2><ul><li>aof_rewriteå‡½æ•°å¯ä»¥åˆ›å»ºæ–°çš„AOFæ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°ä¼šè¿›è¡Œå¤§é‡çš„å†™å…¥æ“ä½œï¼Œæ‰€ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„çº¿ç¨‹å°†è¢«é•¿æ—¶é—´çš„é˜»å¡ï¼Œå› ä¸ºRedisæœåŠ¡å™¨ä½¿ç”¨å•çº¿ç¨‹æ¥å¤„ç†å‘½ä»¤è¯·æ±‚ï¼›æ‰€ä»¥å¦‚æœç›´æ¥æ˜¯æœåŠ¡å™¨è¿›ç¨‹è°ƒç”¨AOF_REWRITEå‡½æ•°çš„è¯ï¼Œé‚£ä¹ˆé‡å†™AOFæœŸé—´ï¼ŒæœåŠ¡å™¨å°†æ— æ³•å¤„ç†å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚ï¼›</li><li>Redisä¸å¸Œæœ›AOFé‡å†™ä¼šé€ æˆæœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ï¼Œæ‰€ä»¥Rediså†³å®šå°†AOFé‡å†™ç¨‹åºæ”¾åˆ°å­è¿›ç¨‹ï¼ˆåå°ï¼‰é‡Œæ‰§è¡Œã€‚è¿™æ ·å¤„ç†çš„æœ€å¤§å¥½å¤„æ˜¯ï¼š<ol><li>å­è¿›ç¨‹è¿›è¡ŒAOFé‡å†™æœŸé—´ï¼Œä¸»è¿›ç¨‹å¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ï¼›</li><li>å­è¿›ç¨‹å¸¦æœ‰ä¸»è¿›ç¨‹çš„æ•°æ®å‰¯æœ¬ï¼Œä½¿ç”¨å­è¿›ç¨‹è€Œä¸æ˜¯çº¿ç¨‹ï¼Œå¯ä»¥é¿å…åœ¨é”çš„æƒ…å†µä¸‹ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</li></ol></li></ul><h2 id="ä½¿ç”¨å­è¿›ç¨‹è¿›è¡ŒAOFé‡å†™çš„é—®é¢˜"><a href="#ä½¿ç”¨å­è¿›ç¨‹è¿›è¡ŒAOFé‡å†™çš„é—®é¢˜" class="headerlink" title="ä½¿ç”¨å­è¿›ç¨‹è¿›è¡ŒAOFé‡å†™çš„é—®é¢˜"></a>ä½¿ç”¨å­è¿›ç¨‹è¿›è¡ŒAOFé‡å†™çš„é—®é¢˜</h2><ul><li>å­è¿›ç¨‹åœ¨è¿›è¡ŒAOFé‡å†™æœŸé—´ï¼ŒæœåŠ¡å™¨è¿›ç¨‹è¿˜è¦ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ï¼Œè€Œæ–°çš„å‘½ä»¤å¯èƒ½å¯¹ç°æœ‰çš„æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œè¿™ä¼šè®©å½“å‰æ•°æ®åº“çš„æ•°æ®å’Œé‡å†™åçš„AOFæ–‡ä»¶ä¸­çš„æ•°æ®ä¸ä¸€è‡´ã€‚</li></ul><h2 id="å¦‚ä½•ä¿®æ­£"><a href="#å¦‚ä½•ä¿®æ­£" class="headerlink" title="å¦‚ä½•ä¿®æ­£"></a>å¦‚ä½•ä¿®æ­£</h2><ul><li>ä¸ºäº†è§£å†³è¿™ç§æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼ŒRediså¢åŠ äº†ä¸€ä¸ªAOFé‡å†™ç¼“å­˜ï¼Œè¿™ä¸ªç¼“å­˜åœ¨forkå‡ºå­è¿›ç¨‹ä¹‹åå¼€å§‹å¯ç”¨ï¼ŒRedisæœåŠ¡å™¨ä¸»è¿›ç¨‹åœ¨æ‰§è¡Œå®Œå†™å‘½ä»¤ä¹‹åï¼Œä¼šåŒæ—¶å°†è¿™ä¸ªå†™å‘½ä»¤è¿½åŠ åˆ°AOFç¼“å†²åŒºå’ŒAOFé‡å†™ç¼“å†²åŒº</li><li>å³å­è¿›ç¨‹åœ¨æ‰§è¡ŒAOFé‡å†™æ—¶ï¼Œä¸»è¿›ç¨‹éœ€è¦æ‰§è¡Œä»¥ä¸‹ä¸‰ä¸ªå·¥ä½œï¼š<ol><li>æ‰§è¡Œclientå‘æ¥çš„å‘½ä»¤è¯·æ±‚ï¼›</li><li>å°†å†™å‘½ä»¤è¿½åŠ åˆ°ç°æœ‰çš„AOFæ–‡ä»¶ä¸­ï¼›</li><li>å°†å†™å‘½ä»¤è¿½åŠ åˆ°AOFé‡å†™ç¼“å­˜ä¸­ã€‚</li></ol></li></ul><p><img src="https://i.loli.net/2021/07/19/LRt7Z4mQ6jh5vK3.png"></p><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><strong>å¯ä»¥ä¿è¯ï¼š</strong></p><p>AOFç¼“å†²åŒºçš„å†…å®¹ä¼šå®šæœŸè¢«å†™å…¥å’ŒåŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ï¼Œå¯¹ç°æœ‰çš„AOFæ–‡ä»¶çš„å¤„ç†å·¥ä½œä¼šæ­£å¸¸è¿›è¡Œ<br>ä»åˆ›å»ºå­è¿›ç¨‹å¼€å§‹ï¼ŒæœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å†™æ“ä½œéƒ½ä¼šè¢«è®°å½•åˆ°AOFé‡å†™ç¼“å†²åŒºä¸­ï¼›</p><h2 id="å®ŒæˆAOFé‡å†™ä¹‹å"><a href="#å®ŒæˆAOFé‡å†™ä¹‹å" class="headerlink" title="å®ŒæˆAOFé‡å†™ä¹‹å"></a>å®ŒæˆAOFé‡å†™ä¹‹å</h2><p>å½“å­è¿›ç¨‹å®Œæˆå¯¹AOFæ–‡ä»¶é‡å†™ä¹‹åï¼Œå®ƒä¼šå‘çˆ¶è¿›ç¨‹å‘é€ä¸€ä¸ªå®Œæˆä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æ¥åˆ°è¯¥å®Œæˆä¿¡å·ä¹‹åï¼Œä¼šè°ƒç”¨ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°å®Œæˆä»¥ä¸‹å·¥ä½œï¼š</p><ul><li>å°†AOFé‡å†™ç¼“å­˜ä¸­çš„å†…å®¹å…¨éƒ¨å†™å…¥åˆ°æ–°çš„AOFæ–‡ä»¶ä¸­ï¼›è¿™ä¸ªæ—¶å€™æ–°çš„AOFæ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€å’ŒæœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ï¼›</li><li>å¯¹æ–°çš„AOFæ–‡ä»¶è¿›è¡Œæ”¹åï¼ŒåŸå­çš„è¦†ç›–åŸæœ‰çš„AOFæ–‡ä»¶ï¼›å®Œæˆæ–°æ—§ä¸¤ä¸ªAOFæ–‡ä»¶çš„æ›¿æ¢ã€‚</li><li>å½“è¿™ä¸ªä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¸»è¿›ç¨‹å°±å¯ä»¥ç»§ç»­åƒå¾€å¸¸ä¸€æ ·æ¥æ”¶å‘½ä»¤è¯·æ±‚äº†ã€‚åœ¨æ•´ä¸ªAOFåå°é‡å†™è¿‡ç¨‹ä¸­ï¼Œåªæœ‰æœ€åçš„â€œä¸»è¿›ç¨‹å†™å…¥å‘½ä»¤åˆ°AOFç¼“å­˜â€å’Œâ€œå¯¹æ–°çš„AOFæ–‡ä»¶è¿›è¡Œæ”¹åï¼Œè¦†ç›–åŸæœ‰çš„AOFæ–‡ä»¶ã€‚â€è¿™ä¸¤ä¸ªæ­¥éª¤ï¼ˆä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡ŒæœŸé—´ï¼‰ä¼šé€ æˆä¸»è¿›ç¨‹é˜»å¡ï¼Œåœ¨å…¶ä»–æ—¶å€™ï¼ŒAOFåå°é‡å†™éƒ½ä¸ä¼šå¯¹ä¸»è¿›ç¨‹é€ æˆé˜»å¡ï¼Œè¿™å°†AOFé‡å†™å¯¹æ€§èƒ½é€ æˆçš„å½±å“é™åˆ°æœ€ä½ã€‚</li></ul><p>ä»¥ä¸Šï¼Œå³AOFåå°é‡å†™ï¼Œä¹Ÿå°±æ˜¯BGREWRITEAOFå‘½ä»¤çš„å·¥ä½œåŸç†ã€‚</p><h2 id="è§¦å‘AOFåå°é‡å†™çš„æ¡ä»¶"><a href="#è§¦å‘AOFåå°é‡å†™çš„æ¡ä»¶" class="headerlink" title="è§¦å‘AOFåå°é‡å†™çš„æ¡ä»¶"></a>è§¦å‘AOFåå°é‡å†™çš„æ¡ä»¶</h2><p>AOFé‡å†™å¯ä»¥ç”±ç”¨æˆ·é€šè¿‡è°ƒç”¨BGREWRITEAOFæ‰‹åŠ¨è§¦å‘ã€‚<br>æœåŠ¡å™¨åœ¨AOFåŠŸèƒ½å¼€å¯çš„æƒ…å†µä¸‹ï¼Œä¼šç»´æŒä»¥ä¸‹ä¸‰ä¸ªå˜é‡ï¼š</p><ul><li>è®°å½•å½“å‰AOFæ–‡ä»¶å¤§å°çš„å˜é‡aof_current_sizeã€‚</li><li>è®°å½•æœ€åä¸€æ¬¡AOFé‡å†™ä¹‹åï¼ŒAOFæ–‡ä»¶å¤§å°çš„å˜é‡aof_rewrite_base_sizeã€‚</li><li>å¢é•¿ç™¾åˆ†æ¯”å˜é‡aof_rewrite_percã€‚</li></ul><p>æ¯æ¬¡å½“serverCronï¼ˆæœåŠ¡å™¨å‘¨æœŸæ€§æ“ä½œå‡½æ•°ï¼‰å‡½æ•°æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šæ£€æŸ¥ä»¥ä¸‹æ¡ä»¶æ˜¯å¦å…¨éƒ¨æ»¡è¶³ï¼Œå¦‚æœå…¨éƒ¨æ»¡è¶³çš„è¯ï¼Œå°±è§¦å‘è‡ªåŠ¨çš„AOFé‡å†™æ“ä½œï¼š</p><ul><li>æ²¡æœ‰BGSAVEå‘½ä»¤ï¼ˆRDBæŒä¹…åŒ–ï¼‰&#x2F;AOFæŒä¹…åŒ–åœ¨æ‰§è¡Œï¼›</li><li>æ²¡æœ‰BGREWRITEAOFåœ¨è¿›è¡Œï¼›</li><li>å½“å‰AOFæ–‡ä»¶å¤§å°è¦å¤§äºserver.aof_rewrite_min_sizeï¼ˆé»˜è®¤ä¸º1MBï¼‰ï¼Œæˆ–è€…åœ¨redis.confé…ç½®äº†auto-aof-rewrite-min-sizeå¤§å°ï¼›</li><li>å½“å‰AOFæ–‡ä»¶å¤§å°å’Œæœ€åä¸€æ¬¡é‡å†™åçš„å¤§å°ä¹‹é—´çš„æ¯”ç‡ç­‰äºæˆ–è€…ç­‰äºæŒ‡å®šçš„å¢é•¿ç™¾åˆ†æ¯”ï¼ˆåœ¨é…ç½®æ–‡ä»¶è®¾ç½®äº†auto-aof-rewrite-percentageå‚æ•°ï¼Œä¸è®¾ç½®é»˜è®¤ä¸º100%ï¼‰</li></ul><p>å¦‚æœå‰é¢ä¸‰ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼Œå¹¶ä¸”å½“å‰AOFæ–‡ä»¶å¤§å°æ¯”æœ€åä¸€æ¬¡AOFé‡å†™æ—¶çš„å¤§å°è¦å¤§äºæŒ‡å®šçš„ç™¾åˆ†æ¯”ï¼Œé‚£ä¹ˆè§¦å‘è‡ªåŠ¨AOFé‡å†™ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>AOFé‡å†™çš„ç›®çš„<strong>æ˜¯ä¸ºäº†è§£å†³AOFæ–‡ä»¶ä½“ç§¯è†¨èƒ€çš„é—®é¢˜ï¼Œä½¿ç”¨æ›´å°çš„ä½“ç§¯æ¥ä¿å­˜æ•°æ®åº“çŠ¶æ€ï¼Œæ•´ä¸ªé‡å†™è¿‡ç¨‹åŸºæœ¬ä¸Šä¸å½±å“Redisä¸»è¿›ç¨‹å¤„ç†å‘½ä»¤è¯·æ±‚</strong>ï¼›<br>AOFé‡å†™å…¶å®æ˜¯ä¸€ä¸ªæœ‰æ­§ä¹‰çš„åå­—ï¼Œå®é™…ä¸Šé‡å†™å·¥ä½œæ˜¯é’ˆå¯¹æ•°æ®åº“çš„å½“å‰çŠ¶æ€æ¥è¿›è¡Œçš„ï¼Œé‡å†™è¿‡ç¨‹ä¸­ä¸ä¼šè¯»å†™ã€ä¹Ÿä¸é€‚ç”¨åŸæ¥çš„AOFæ–‡ä»¶ï¼›<br>AOFå¯ä»¥<strong>ç”±ç”¨æˆ·æ‰‹åŠ¨è§¦å‘ï¼Œä¹Ÿå¯ä»¥ç”±æœåŠ¡å™¨è‡ªåŠ¨è§¦å‘</strong>ã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://blog.csdn.net/hezhiqiang1314/article/details/69396887">Redisä¹‹AOFé‡å†™åŠå…¶å®ç°åŸç†</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloudAlibabaå¿«é€Ÿå…¥é—¨</title>
    <link href="/2021/06/25/SpringCloudAlibaba%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
    <url>/2021/06/25/SpringCloudAlibaba%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="1-ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ</h1><p>å®˜ç½‘: <a href="https://www.martinfowler.com/articles/microservices.html">https://www.martinfowler.com/articles/microservices.html</a></p><p>In short, the microservice architectural style is an approach to developing a single application as <code>a suite of small services</code>, each <code>running in its own process</code> and communicating with lightweight mechanisms, often an HTTP resource API. These services are <code>built around business capabilities</code> and <code>independently deployable</code> by fully automated deployment machinery. <code>There is a bare minimum of centralized management of these services</code>, which may be written in different programming languages and use different data storage technologies. â€”â€“[æ‘˜è‡ªå®˜ç½‘]</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> a suite of small services --ä¸€ç³»åˆ—å¾®å°æœåŠ¡<br><span class="hljs-bullet">-</span> running in its own process --è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹é‡Œ<br><span class="hljs-bullet">-</span> built around business capabilities --å›´ç»•è‡ªå·±çš„ä¸šåŠ¡å¼€å‘<br><span class="hljs-bullet">-</span> independently deployable --ç‹¬ç«‹éƒ¨ç½²<br><span class="hljs-bullet">-</span> bare minimum of centralized management of these services --åŸºäºåˆ†å¸ƒå¼ç®¡ç†<br></code></pre></td></tr></table></figure><p>å®˜æ–¹å®šä¹‰ï¼š<strong>å¾®æœåŠ¡å°±æ˜¯ç”±ä¸€ç³»åˆ—å›´ç»•è‡ªå·±ä¸šåŠ¡å¼€å‘çš„å¾®å°æœåŠ¡æ„æˆ,ä»–ä»¬ç‹¬ç«‹éƒ¨ç½²è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹é‡Œ,åŸºäºåˆ†å¸ƒå¼çš„ç®¡ç†</strong></p><p>é€šä¿—å®šä¹‰ï¼š<strong>å¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„ï¼Œè¿™ç§æ¶æ„æ˜¯å°†å•ä¸ªçš„æ•´ä½“åº”ç”¨ç¨‹åºåˆ†å‰²æˆæ›´å°çš„é¡¹ç›®å…³è”çš„ç‹¬ç«‹çš„æœåŠ¡ã€‚ä¸€ä¸ªæœåŠ¡é€šå¸¸å®ç°ä¸€ç»„ç‹¬ç«‹çš„ç‰¹æ€§æˆ–åŠŸèƒ½ï¼ŒåŒ…å«è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å’Œé€‚é…å™¨ã€‚å„ä¸ªå¾®æœåŠ¡ä¹‹é—´çš„å…³è”é€šè¿‡æš´éœ²apiæ¥å®ç°ã€‚è¿™äº›ç‹¬ç«‹çš„å¾®æœåŠ¡ä¸éœ€è¦éƒ¨ç½²åœ¨åŒä¸€ä¸ªè™šæ‹Ÿæœºï¼ŒåŒä¸€ä¸ªç³»ç»Ÿå’ŒåŒä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨ä¸­ã€‚</strong></p><h1 id="2-ä¸ºä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ"></a>2. ä¸ºä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ</h1><p><img src="https://i.loli.net/2021/06/25/v8UuOdxAzMycQwk.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1.ä¼˜ç‚¹</span><br><span class="hljs-bullet">-</span> å°†æœåŠ¡æ‹†åˆ†æˆå¤šä¸ªå•ä¸€èŒè´£çš„å°çš„æœåŠ¡ï¼Œè¿›è¡Œå•ç‹¬éƒ¨ç½²ï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡<br><span class="hljs-bullet">-</span> æ¯ä¸ªæœåŠ¡åº”è¯¥æœ‰è‡ªå·±å•ç‹¬çš„ç®¡ç†å›¢é˜Ÿï¼Œé«˜åº¦è‡ªæ²»<br><span class="hljs-bullet">-</span> æœåŠ¡å„è‡ªæœ‰è‡ªå·±å•ç‹¬çš„èŒè´£ï¼ŒæœåŠ¡ä¹‹é—´æ¾è€¦åˆï¼Œé¿å…å› ä¸€ä¸ªæ¨¡å—çš„é—®é¢˜å¯¼è‡´æœåŠ¡å´©æºƒ<br><span class="hljs-section"># 2.ç¼ºç‚¹</span><br><span class="hljs-bullet">-</span> å¼€å‘äººå‘˜è¦å¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤æ‚æ€§<br><span class="hljs-bullet">-</span> å¤šæœåŠ¡è¿ç»´éš¾åº¦ï¼Œéšç€æœåŠ¡çš„å¢åŠ ï¼Œè¿ç»´çš„å‹åŠ›ä¹Ÿåœ¨å¢å¤§<br><span class="hljs-bullet">-</span> æœåŠ¡æ²»ç† å’Œ æœåŠ¡ç›‘æ§ å…³é”®<br></code></pre></td></tr></table></figure><p><strong>æ¶æ„çš„æ¼”å˜</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1.æ¶æ„çš„æ¼”å˜è¿‡ç¨‹</span><br><span class="hljs-bullet">-</span> [å•ä¸€åº”ç”¨æ¶æ„] <span class="hljs-code">`===&gt;`</span> [å‚ç›´åº”ç”¨æ¶æ„] <span class="hljs-code">`===&gt;`</span> [åˆ†å¸ƒå¼æœåŠ¡æ¶æ„] <span class="hljs-code">`===&gt;`</span> [æµåŠ¨è®¡ç®—æ¶æ„]||[å¾®æœåŠ¡æ¶æ„] <span class="hljs-code">`===&gt;`</span> [æœªçŸ¥]<br></code></pre></td></tr></table></figure><p>dubboå®˜ç½‘:<a href="http://dubbo.apache.org/zh-cn/docs/user/preface/background.html">http://dubbo.apache.org/zh-cn/docs/user/preface/background.html</a></p><p><img src="https://i.loli.net/2021/06/25/3GYUBOtD19lrhMs.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1. All in One Application å•ä¸€æ¶æ„</span><br><span class="hljs-bullet">-</span> èµ·åˆå½“ç½‘ç«™æµé‡å¾ˆå°æ—¶,å°†æ‰€æœ‰åŠŸèƒ½éƒ½å†™åœ¨ä¸€ä¸ªåº”ç”¨é‡Œé¢,å¯¹æ•´ä¸ªåº”ç”¨è¿›è¡Œéƒ¨ç½²,ä»¥å‡å°‘éƒ¨ç½²èŠ‚ç‚¹å’Œæˆæœ¬ã€‚å¯¹äºè¿™ä¸ªæ¶æ„ç®€åŒ–å¢åˆ æ”¹æŸ¥çš„å·¥ä½œé‡çš„æ•°æ®è®¿é—®æ¡†æ¶ï¼ˆORMï¼‰æ˜¯å…³é”®ã€‚<br><span class="hljs-section"># 2. Vertical Application å‚ç›´æ¶æ„</span><br><span class="hljs-bullet">-</span> å½“è®¿é—®é‡é€æ¸å¢å¤§ï¼Œå•ä¸€åº”ç”¨å¢åŠ æœºå™¨å¸¦æ¥çš„åŠ é€Ÿåº¦è¶Šæ¥è¶Šå°ï¼Œæå‡æ•ˆç‡çš„æ–¹æ³•ä¹‹ä¸€æ˜¯å°†åº”ç”¨æ‹†æˆäº’ä¸ç›¸å¹²çš„å‡ ä¸ªåº”ç”¨ï¼Œä»¥æå‡æ•ˆç‡ã€‚æ­¤æ—¶ï¼Œç”¨äºåŠ é€Ÿå‰ç«¯é¡µé¢å¼€å‘çš„Webæ¡†æ¶(MVC)æ˜¯å…³é”®ã€‚<br><span class="hljs-section"># 3. Distributed Service åˆ†å¸ƒå¼æœåŠ¡æ¶æ„</span><br><span class="hljs-bullet">-</span> å½“å‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒï¼Œä½¿å‰ç«¯åº”ç”¨èƒ½æ›´å¿«é€Ÿçš„å“åº”å¤šå˜çš„å¸‚åœºéœ€æ±‚ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜ä¸šåŠ¡å¤ç”¨åŠæ•´åˆçš„åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶(RPC)æ˜¯å…³é”®ã€‚<br><span class="hljs-section"># 4. Elastic Computing æµåŠ¨è®¡ç®—æ¶æ„å³å¾®æœåŠ¡æ¶æ„</span><br><span class="hljs-bullet">-</span> å½“æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå®¹é‡çš„è¯„ä¼°ï¼Œå°æœåŠ¡èµ„æºçš„æµªè´¹ç­‰é—®é¢˜é€æ¸æ˜¾ç°ï¼Œæ­¤æ—¶éœ€å¢åŠ ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒåŸºäºè®¿é—®å‹åŠ›å®æ—¶ç®¡ç†é›†ç¾¤å®¹é‡ï¼Œæé«˜é›†ç¾¤åˆ©ç”¨ç‡ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜æœºå™¨åˆ©ç”¨ç‡çš„èµ„æºè°ƒåº¦å’Œæ²»ç†ä¸­å¿ƒ(SOA)æ˜¯å…³é”®<br></code></pre></td></tr></table></figure><hr><h1 id="3-å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆ"><a href="#3-å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3. å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆ"></a>3. å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆ</h1><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1.Dubbo (é˜¿é‡Œç³»)</span><br><span class="hljs-bullet">-</span> åˆå‡ºèŒ…åº:2011å¹´æœ«ï¼Œé˜¿é‡Œå·´å·´åœ¨GitHubä¸Šå¼€æºäº†åŸºäºJavaçš„åˆ†å¸ƒå¼æœåŠ¡æ²»ç†æ¡†æ¶Dubboï¼Œä¹‹åå®ƒæˆä¸ºäº†å›½å†…è¯¥ç±»å¼€æºé¡¹ç›®çš„ä½¼ä½¼è€…ï¼Œè®¸å¤šå¼€å‘è€…å¯¹å…¶è¡¨ç¤ºé’çã€‚åŒæ—¶ï¼Œå…ˆåæœ‰ä¸å°‘å…¬å¸åœ¨å®è·µä¸­åŸºäºDubboè¿›è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ï¼Œç›®å‰åœ¨GitHubä¸Šï¼Œå®ƒçš„forkã€staræ•°å‡å·²ç ´ä¸‡ã€‚Dubboè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œé€æ˜åŒ–çš„RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æ–¹æ¡ˆï¼Œä»¥åŠSOAæœåŠ¡æ²»ç†æ–¹æ¡ˆï¼Œä½¿å¾—åº”ç”¨å¯é€šè¿‡é«˜æ€§èƒ½RPCå®ç°æœåŠ¡çš„è¾“å‡ºã€è¾“å…¥åŠŸèƒ½å’ŒSpringæ¡†æ¶æ— ç¼é›†æˆã€‚DubboåŒ…å«è¿œç¨‹é€šè®¯ã€é›†ç¾¤å®¹é”™å’Œè‡ªåŠ¨å‘ç°ä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†ã€‚<br><span class="hljs-bullet">-</span> åœæ­¢ç»´æŠ¤:ä»2012å¹´10æœˆ23æ—¥Dubbo 2.5.3å‘å¸ƒåï¼Œåœ¨Dubboå¼€æºå°†æ»¡ä¸€å‘¨å¹´ä¹‹é™…ï¼Œé˜¿é‡ŒåŸºæœ¬åœæ­¢äº†å¯¹Dubboçš„ä¸»è¦å‡çº§ã€‚åªåœ¨ä¹‹åçš„2013å¹´å’Œ2014å¹´æ›´æ–°è¿‡2æ¬¡å¯¹Dubbo 2.4çš„ç»´æŠ¤ç‰ˆæœ¬ï¼Œç„¶ååœæ­¢äº†æ‰€æœ‰ç»´æŠ¤å·¥ä½œã€‚Dubboå¯¹Srpingçš„æ”¯æŒä¹Ÿåœç•™åœ¨äº†Spring 2.5.6ç‰ˆæœ¬ä¸Šã€‚<br><span class="hljs-bullet">-</span> æ­»è€Œå¤ç”Ÿ:å¤šå¹´æ¼«é•¿çš„ç­‰å¾…ï¼Œéšç€å¾®æœåŠ¡çš„ç«çƒ­å…´èµ·ï¼Œåœ¨å›½å†…å¤–å¼€å‘è€…å¯¹é˜¿é‡Œä¸å†å‡çº§ç»´æŠ¤Dubboçš„åæ§½å£°ä¸­ï¼Œé˜¿é‡Œç»ˆäºå¼€å§‹é‡æ–°å¯¹Dubboçš„å‡çº§å’Œç»´æŠ¤å·¥ä½œã€‚åœ¨2017å¹´9æœˆ7æ—¥ï¼Œé˜¿é‡Œå‘å¸ƒäº†Dubboçš„2.5.4ç‰ˆæœ¬ï¼Œè·ç¦»ä¸Šä¸€ä¸ªç‰ˆæœ¬2.5.3å‘å¸ƒå·²ç»æ¥è¿‘å¿«5å¹´æ—¶é—´äº†ã€‚åœ¨éšåçš„å‡ ä¸ªæœˆä¸­ï¼Œé˜¿é‡ŒDubboå¼€å‘å›¢é˜Ÿä»¥å·®ä¸å¤šæ¯æœˆä¸€ç‰ˆæœ¬çš„é€Ÿåº¦å¼€å§‹å¿«é€Ÿå‡çº§è¿­ä»£ï¼Œä¿®è¡¥äº†Dubboè€ç‰ˆæœ¬å¤šå¹´æ¥å­˜åœ¨çš„è¯¸å¤šbugï¼Œå¹¶å¯¹Springç­‰ç»„ä»¶çš„æ”¯æŒè¿›è¡Œäº†å…¨é¢å‡çº§ã€‚<br><span class="hljs-bullet">-</span> 2018å¹´1æœˆ8æ—¥ï¼ŒDubboåˆ›å§‹äººä¹‹ä¸€æ¢é£åœ¨Dubboäº¤æµç¾¤é‡Œé€éœ²äº†Dubbo 3.0æ­£åœ¨åŠ¨å·¥çš„æ¶ˆæ¯ã€‚Dubbo 3.0å†…æ ¸ä¸Dubbo 2.0å®Œå…¨ä¸åŒï¼Œä½†å…¼å®¹Dubbo 2.0ã€‚Dubbo 3.0å°†ä»¥Streamingä¸ºå†…æ ¸ï¼Œä¸å†æ˜¯Dubbo æ—¶ä»£çš„RPCï¼Œä½†æ˜¯RPCä¼šåœ¨Dubbo 3.0ä¸­å˜æˆè¿œç¨‹Streamingå¯¹æ¥çš„ä¸€ç§å¯é€‰å½¢æ€ã€‚ä»Dubboæ–°ç‰ˆæœ¬çš„è·¯çº¿è§„åˆ’ä¸Šå¯ä»¥çœ‹å‡ºï¼Œæ–°ç‰ˆæœ¬çš„Dubboåœ¨åŸæœ‰æœåŠ¡æ²»ç†çš„åŠŸèƒ½åŸºç¡€ä¸Šï¼Œå°†å…¨é¢æ‹¥æŠ±å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆã€‚<br><span class="hljs-bullet">-</span> ç»“è®º:å½“å‰ç”±äºRPCåè®®ã€æ³¨å†Œä¸­å¿ƒå…ƒæ•°æ®ä¸åŒ¹é…ç­‰é—®é¢˜ï¼Œåœ¨é¢ä¸´å¾®æœåŠ¡åŸºç¡€æ¡†æ¶é€‰å‹æ—¶Dubboä¸Spring Cloudæ˜¯åªèƒ½äºŒé€‰ä¸€ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤§å®¶æ€»æ˜¯æ‹¿Dubboå’ŒSpring Cloudåšå¯¹æ¯”çš„åŸå› ä¹‹ä¸€ã€‚Dubboä¹‹åä¼šç§¯æå¯»æ±‚é€‚é…åˆ°Spring Cloudç”Ÿæ€ï¼Œæ¯”å¦‚ä½œä¸ºSpring Cloudçš„äºŒè¿›åˆ¶é€šä¿¡æ–¹æ¡ˆæ¥å‘æŒ¥Dubboçš„æ€§èƒ½ä¼˜åŠ¿ï¼Œæˆ–è€…Dubboé€šè¿‡æ¨¡å—åŒ–ä»¥åŠå¯¹httpçš„æ”¯æŒé€‚é…åˆ°Spring Cloudã€‚<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/06/25/qHxUvu25LKBtDhV.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># Spring Cloud:</span><br><span class="hljs-bullet">-</span> Spring Cloud NetFlix(ç¾å›½ åœ¨çº¿è§†é¢‘ç½‘ç«™)<br>åŸºäºç¾å›½Netflixå…¬å¸å¼€æºçš„ç»„ä»¶è¿›è¡Œå°è£…,æä¾›äº†å¾®æœåŠ¡ä¸€æ ˆå¼çš„è§£å†³æ–¹æ¡ˆã€‚ Gç‰ˆæœ¬<br><span class="hljs-bullet">-</span> Spring Cloud alibaba<br>åœ¨Spring cloud netflixåŸºç¡€ä¸Šå°è£…äº†é˜¿é‡Œå·´å·´çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆã€‚<br><span class="hljs-bullet">-</span> Spring Cloud<br>ç›®å‰springå®˜æ–¹è¶‹åŠ¿æ­£åœ¨é€æ¸å¸æ”¶Netflixç»„ä»¶çš„ç²¾å,å¹¶åœ¨æ­¤åŸºç¡€è¿›è¡ŒäºŒæ¬¡å°è£…ä¼˜åŒ–,æ‰“é€ springä¸“æœ‰çš„è§£å†³æ–¹æ¡ˆ<br><span class="hljs-section"># æ ¸å¿ƒç»„ä»¶ï¼š</span><br><span class="hljs-bullet">-</span> eurekaã€consulã€nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒç»„ä»¶<br><span class="hljs-bullet">-</span> rabbion &amp; openfeign æœåŠ¡è´Ÿè½½å‡è¡¡ å’Œ æœåŠ¡è°ƒç”¨ç»„ä»¶<br><span class="hljs-bullet">-</span> hystrix &amp; hystrix dashboard æœåŠ¡æ–­è·¯å™¨ å’Œ æœåŠ¡ç›‘æ§ç»„ä»¶<br><span class="hljs-bullet">-</span> zuulã€gateway æœåŠ¡ç½‘å…³ç»„ä»¶<br><span class="hljs-bullet">-</span> config ç»Ÿä¸€é…ç½®ä¸­å¿ƒç»„ä»¶<br><span class="hljs-bullet">-</span> bus æ¶ˆæ¯æ€»çº¿ç»„ä»¶<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/06/25/toAP8xzGO2pr6QY.png"></p><h1 id="4-ä¸ºä»€ä¹ˆä¸é€‰æ‹©SpringCloudè€Œé€‰ç”¨SpringCloudAlibabaï¼Ÿ"><a href="#4-ä¸ºä»€ä¹ˆä¸é€‰æ‹©SpringCloudè€Œé€‰ç”¨SpringCloudAlibabaï¼Ÿ" class="headerlink" title="4. ä¸ºä»€ä¹ˆä¸é€‰æ‹©SpringCloudè€Œé€‰ç”¨SpringCloudAlibabaï¼Ÿ"></a>4. ä¸ºä»€ä¹ˆä¸é€‰æ‹©SpringCloudè€Œé€‰ç”¨SpringCloudAlibabaï¼Ÿ</h1><p>ç®€å•çš„æ¥è¯´ï¼Œå°±æ˜¯ç¬¬ä¸€å¥—å¾®æœåŠ¡æ¶æ„è§£å†³æ–¹æ¡ˆï¼šSpring Boot + Spring Cloud Netflixã€‚æœ€è¿‘ç”±äºNetflixå…¬å¸å®£å¸ƒSpring Cloud Netflix ç³»åˆ—æŠ€æœ¯æ ˆè¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œ äºæ˜¯é‡‡ç”¨ Spring Cloud Alibaba æ–¹æ¡ˆæ¥æ›¿ä»£ã€‚</p><p>æ¯”å¦‚Ribbonï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ã€Hystrixï¼ˆæœåŠ¡ç†”æ–­å’Œç›‘æ§ï¼‰åœæ­¢ç»´æŠ¤ï¼Œè€Œä¸”å¦‚configåšç»Ÿä¸€é…ç½®ä¸­å¿ƒå¹¶ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œäºæ˜¯æˆ‘ä»¬é€‰æ‹©Spring Cloud Alibabaã€‚</p><h1 id="5-Spring-Cloud-Alibaba"><a href="#5-Spring-Cloud-Alibaba" class="headerlink" title="5. Spring Cloud Alibaba"></a>5. Spring Cloud Alibaba</h1><p><a href="https://spring.io/projects/spring-cloud-alibaba">Spring Cloud Alibaba</a></p><ul><li>Spring Cloud Alibabaä¸ºåˆ†å¸ƒå¼åº”ç”¨å¼€å‘æä¾›äº†ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚å®ƒåŒ…å«äº†å¼€å‘åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ç»„ä»¶ï¼Œä½¿æ‚¨å¯ä»¥è½»æ¾åœ°ä½¿ç”¨springcloudå¼€å‘åº”ç”¨ç¨‹åºã€‚</li><li>æœ‰äº†Spring Cloud Alibabaï¼Œä½ åªéœ€è¦æ·»åŠ ä¸€äº›æ³¨è§£å’Œå°‘é‡çš„é…ç½®ï¼Œå°±å¯ä»¥å°†Spring Cloudåº”ç”¨è¿æ¥åˆ°é˜¿é‡Œçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆä¸Šï¼Œç”¨é˜¿é‡Œä¸­é—´ä»¶æ­å»ºä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨ç³»ç»Ÿã€‚</li></ul><p>Spring Cloud Alibabaç»„ä»¶ï¼š</p><ol><li>æœåŠ¡æ³¨å†Œä¸­å¿ƒ æœåŠ¡é…ç½®ä¸­å¿ƒ nacos &#x3D;&#x3D;&#x3D;&gt; æ›¿æ¢eureka consul æ›¿æ¢config+bus</li><li>æœåŠ¡ç†”æ–­ã€æµé‡æ§åˆ¶ sentinelï¼ˆsentinelã€sentinel dashBoardï¼‰</li></ol><h1 id="5-Spring-Cloud-æ•´åˆAlibabaç¯å¢ƒæ­å»º"><a href="#5-Spring-Cloud-æ•´åˆAlibabaç¯å¢ƒæ­å»º" class="headerlink" title="5. Spring Cloud æ•´åˆAlibabaç¯å¢ƒæ­å»º"></a>5. Spring Cloud æ•´åˆAlibabaç¯å¢ƒæ­å»º</h1><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œåªæ˜¯æƒ³è¯´æ˜ä¸‹é€‰æ‹©Spring Cloud æ•´åˆAlibabaçš„åŸå› ï¼Œä¸‹é¢æ­£å¼å¼€å§‹ä½¿ç”¨IDEAè¿›è¡Œç¯å¢ƒæ­å»º</p><p><strong>äº”å¤§ç»„ä»¶</strong>ï¼š</p><ol><li>æœåŠ¡æ³¨å†Œä¸­å¿ƒ <strong>nacos</strong></li><li>æœåŠ¡é—´é€šä¿¡ç»„ä»¶ a.RestTemplate+Ribbon b.<strong>OpenFeig</strong>ç»„ä»¶</li><li>æœåŠ¡ç†”æ–­ã€æµæ§ <strong>sentinel</strong></li><li>ç½‘å…³ <strong>gateway</strong></li><li>æœåŠ¡é…ç½®ä¸­å¿ƒ <strong>nacos</strong></li></ol><h2 id="5-1-IDEAæ–°å»ºç©ºæ¨¡å—"><a href="#5-1-IDEAæ–°å»ºç©ºæ¨¡å—" class="headerlink" title="5.1 IDEAæ–°å»ºç©ºæ¨¡å—"></a>5.1 IDEAæ–°å»ºç©ºæ¨¡å—</h2><p><img src="https://i.loli.net/2021/06/25/b8dE4snGFRIakwx.png"></p><p><img src="https://i.loli.net/2021/06/25/skdW9Jyx3zQrT74.png"></p><p><img src="https://i.loli.net/2021/06/25/rwN2xOkcjdZS4Yy.png"></p><p>å› ä¸ºå¾®æœåŠ¡é¡¹ç›®æ˜¯å¾ˆå¤šæ¨¡å—çš„ï¼Œæˆ‘ä»¬åˆ›å»ºè¿™æ ·ä¸€ä¸ªç©ºæ¨¡å—é¡¹ç›®æ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†ä»Šåå¼€å‘çš„æ¨¡å—</p><h2 id="5-2-åˆ›å»ºçˆ¶é¡¹ç›®"><a href="#5-2-åˆ›å»ºçˆ¶é¡¹ç›®" class="headerlink" title="5.2 åˆ›å»ºçˆ¶é¡¹ç›®"></a>5.2 åˆ›å»ºçˆ¶é¡¹ç›®</h2><p><img src="https://i.loli.net/2021/06/25/jb5DyPYgWf86khu.png"></p><p><img src="https://i.loli.net/2021/06/25/gjGfiys9JCXNHzW.png"></p><p>ä¸è¦é€‰æ‹©è¿™äº›æ¨¡æ¿ï¼Œæˆ‘ä»¬åªæ˜¯æ–°å»ºä¸€ä¸ªå¾®æœåŠ¡çˆ¶é¡¹ç›®ï¼Œç”¨ä½œç‰ˆæœ¬æ§åˆ¶</p><p><img src="https://i.loli.net/2021/06/25/BWxcvyIJGhsoHKk.png"></p><p><img src="https://i.loli.net/2021/06/25/kEovwOylJhA51FD.png"></p><p>å› ä¸ºæ•´åˆçš„æ˜¯SpringCloudå’ŒSpringCloud Alibabaï¼Œéœ€è¦ä¸¤è€…çš„ä¾èµ–éƒ½åŠ å…¥ï¼Œä¸‹é¢æ˜¯çˆ¶é¡¹ç›®çš„pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.dev<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springcloud\_alibaba\_parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>springcloud\_alibaba\_commons<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>springcloud\_alibaba\_users<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>springcloud\_alibaba\_products<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>springcloud\_alibaba\_gateway<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">spring.cloud.version</span>&gt;</span>Hoxton.SR6<span class="hljs-tag">&lt;/<span class="hljs-name">spring.cloud.version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">spring.cloud.alibaba.version</span>&gt;</span>2.2.1.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">spring.cloud.alibaba.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.cloud.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.cloud.alibaba.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><p>SpringCloudé€‰æ‹©çš„æ˜¯Hç‰ˆæœ¬ï¼ŒSpringBootæ˜¯2.xï¼ŒSpringCloudAlibabaæ˜¯2.2.1</p><p>åé¢çš„é¡¹ç›®éƒ½éœ€è¦ç»§æ‰¿è¿™ä¸ªçˆ¶é¡¹ç›®ï¼Œæ¯”å¦‚éƒ½ä¼šç”¨åˆ°SpringBootï¼Œé‚£ä¹ˆå­é¡¹ç›®æ˜¯ä¸éœ€è¦å†™ç‰ˆæœ¬å·çš„ï¼Œç”±çˆ¶é¡¹ç›®ç»Ÿä¸€ç®¡ç†ã€‚</p><h2 id="5-3-æœåŠ¡æ³¨å†Œä¸­å¿ƒ"><a href="#5-3-æœåŠ¡æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="5.3 æœåŠ¡æ³¨å†Œä¸­å¿ƒ"></a>5.3 æœåŠ¡æ³¨å†Œä¸­å¿ƒ</h2><p>Nacosæ˜¯å¾®æœåŠ¡æ¶æ„ä¸­æœåŠ¡æ³¨å†Œä¸­å¿ƒä»¥åŠç»Ÿä¸€é…ç½®ä¸­å¿ƒ,ç”¨æ¥æ›¿æ¢åŸæ¥çš„(eureka,consul)ä»¥åŠconfigç»„ä»¶</p><p>å®‰è£…Nacosï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Dockerå®‰è£…ï¼Œå…·ä½“æ“ä½œå°±ä¸ç»†è®²ï¼Œå®‰è£…å®Œæˆåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨è®¿é—®Nacosçš„webç•Œé¢ï¼Œæˆ‘è¿™é‡Œè£…çš„æ˜¯1.3.1</p><p>Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘ä»¬ä»Šååªéœ€è¦æŠŠå¼€å‘çš„å¾®æœåŠ¡æ¨¡å—æ³¨å†Œåˆ°å®ƒä¸Šå»å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬æ–°å»ºç”¨æˆ·åŠŸèƒ½æ¨¡å—å’Œå•†å“æ¨¡å—å»æ³¨å†Œåˆ°Nacosä¸Š</p><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--å¼•å…¥nacos configçš„ä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªSpringBooté¡¹ç›®ï¼Œæ‰€ä»¥å¼•å…¥webå¯åŠ¨å™¨å’Œnacoså‘æœåŠ¡æ³¨å†Œå’Œé…ç½®ä¾èµ–</p><p>ä¸‹é¢éœ€è¦æŠŠSpringBooté¡¹ç›®ç»“æ„å®Œå–„ï¼Œæ–°å»ºapplication.propertieså’Œå¯åŠ¨ç±»</p><p>application.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#å¯åŠ¨ç«¯å£</span><br><span class="hljs-attr">server.port</span>=<span class="hljs-string">8888</span><br><span class="hljs-comment">#æœåŠ¡åç§°</span><br><span class="hljs-attr">spring.application.name</span>=<span class="hljs-string">USERS</span><br><span class="hljs-comment">#nacosåœ°å€</span><br><span class="hljs-attr">spring.cloud.nacos.server-addr</span>=<span class="hljs-string">118.195.164.41:8849</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°USERSæœåŠ¡å·²ç»æˆåŠŸæ³¨å†Œåˆ°Nacosä¸­</p><p><img src="https://i.loli.net/2021/06/25/IOWN9iV52w3sBMy.png"></p><blockquote><p>ä¸ºäº†æµ‹è¯•ç¨‹åºæ˜¯å¦æˆåŠŸï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸ªæµ‹è¯•çš„æ¥å£ï¼Œæ¥éªŒè¯</p></blockquote><p>ä¸‹é¢åŒæ ·çš„æ“ä½œæ–°å»ºä¸€ä¸ªProductsï¼Œè¿™é‡Œå°±ä¸å†è¯´æ˜</p><h2 id="5-4-æœåŠ¡é—´é€šä¿¡"><a href="#5-4-æœåŠ¡é—´é€šä¿¡" class="headerlink" title="5.4 æœåŠ¡é—´é€šä¿¡"></a>5.4 æœåŠ¡é—´é€šä¿¡</h2><p>æœåŠ¡é—´é€šä¿¡ï¼ŒSpringCloud Alibabaå¹¶æ²¡æœ‰æä¾›æ–°çš„ç»„ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•å®ç°æœåŠ¡é—´é€šä¿¡ï¼š</p><p>1.RestTemplate+Ribbon ä½¿ç”¨RestTemplateåšæ¥å£é—´çš„é€šä¿¡ï¼ŒRibbonå®ç°è´Ÿè½½å‡è¡¡</p><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>1.RestTemplateçš„åŸºæœ¬ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();<br><span class="hljs-type">String</span> <span class="hljs-variable">orderObject</span> <span class="hljs-operator">=</span> restTemplate.getForObject(<span class="hljs-string">&quot;http://localhost:9999/order&quot;</span>, String.class);<br></code></pre></td></tr></table></figure><p>2.ä½¿ç”¨ribbonç»„ä»¶+restTemplateå®ç°è´Ÿè½½å‡è¡¡</p><p>1.discoveryClient</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">LoadBalanceClient List&lt;ServiceInstance&gt; serviceInstances = discoveryClient.getInstances(<span class="hljs-string">&quot;ORDERS&quot;</span>);<br>serviceInstances.forEach(serviceInstance -&gt; &#123;<br>log.info(<span class="hljs-string">&quot;æœåŠ¡ä¸»æœºï¼š&#123;&#125; æœåŠ¡ç«¯å£ï¼š&#123;&#125; æœåŠ¡åœ°å€ï¼š&#123;&#125;&quot;</span>,serviceInstance.getHost(),serviceInstance.getPort(),serviceInstance.getUri());<br>&#125;);<br><span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>().getForObject(serviceInstances.get(<span class="hljs-number">0</span>).getUri() + <span class="hljs-string">&quot;/order&quot;</span>, String.class);<br></code></pre></td></tr></table></figure><ol><li>loadBalancerClient</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ServiceInstance</span> <span class="hljs-variable">serviceInstance</span> <span class="hljs-operator">=</span> loadBalancerClient.choose(<span class="hljs-string">&quot;ORDERS&quot;</span>);<br>log.info(<span class="hljs-string">&quot;æœåŠ¡ä¸»æœºï¼š&#123;&#125; æœåŠ¡ç«¯å£ï¼š&#123;&#125; æœåŠ¡åœ°å€ï¼š&#123;&#125;&quot;</span>,serviceInstance.getHost(),serviceInstance.getPort(),serviceInstance.getUri());<br><span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>().getForObject(serviceInstance.getUri() + <span class="hljs-string">&quot;/order&quot;</span>, String.class);<br></code></pre></td></tr></table></figure><p>ç»¼ä¸Šæ˜¯RestTemplate+RibbonåšæœåŠ¡é—´é€šä¿¡ï¼Œå¹¶ä¸”å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ï¼ˆé»˜è®¤è½®è¯¢ï¼‰ï¼Œä¿è¯é«˜å¯ç”¨ï¼Œä½†æ˜¯ä¾æ—§ä¼š<strong>å‡ºç°è¯·æ±‚åœ°å€å†™æ­»</strong>çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆé‡‡ç”¨OpenfeignåšæœåŠ¡é—´çš„é€šä¿¡</p><p>é¦–å…ˆè¦çŸ¥é“ï¼ŒOpenfeignæ˜¯ä¸€ä¸ªä¼ªhttpè¯·æ±‚ç±»ï¼Œå®ƒåº•å±‚è¿˜æ˜¯RestTemplateï¼Œæ”¯æŒSpringMVCæ³¨è§£ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æŠŠå®ƒå½“ä½œæ˜¯ä¸€ä¸ªcontrollerçš„æ¥å£ç±»æ¥å†™ï¼ŒSpringMVCæ³¨è§£å®Œå…¨æ”¯æŒï¼</p><p>æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ªåŒ…ï¼Œæ¥å­˜æ”¾æœåŠ¡çš„è°ƒç”¨æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">6</span>/<span class="hljs-number">25</span> <span class="hljs-number">8</span>:<span class="hljs-number">53</span><br>\*/<br><span class="hljs-meta">@FeignClient(&quot;PRODUCTS&quot;)</span> <span class="hljs-comment">//è°ƒç”¨æœåŠ¡æ¨¡å—çš„åç§°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProductsClients</span> &#123;<br><span class="hljs-comment">//æ¥å£å Getæ–¹å¼ æ— å‚</span><br><span class="hljs-meta">@GetMapping(&quot;/product&quot;)</span><br>String <span class="hljs-title function_">product</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨æˆ‘ä»¬åªéœ€è¦åœ¨controllerä¸­æ³¨å…¥ProductsClientsï¼Œè°ƒç”¨è¿™ä¸ªproduct()æ–¹æ³•å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> productsClients.product();<br></code></pre></td></tr></table></figure><p>é»˜è®¤è½®è¯¢å®ç°è´Ÿè½½å‡è¡¡~</p><h2 id="5-5-ç½‘å…³æœåŠ¡"><a href="#5-5-ç½‘å…³æœåŠ¡" class="headerlink" title="5.5 ç½‘å…³æœåŠ¡"></a>5.5 ç½‘å…³æœåŠ¡</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1.è¯´æ˜</span><br><span class="hljs-bullet">-</span> ç½‘å…³ç»Ÿä¸€æœåŠ¡å…¥å£ï¼Œå¯æ–¹ä¾¿å®ç°å¯¹å¹³å°ä¼—å¤šæœåŠ¡æ¥å£è¿›è¡Œç®¡æ§ï¼Œå¯¹è®¿é—®æœåŠ¡çš„èº«ä»½è®¤è¯ã€é˜²æŠ¥æ–‡é‡æ”¾ä¸é˜²æ•°æ®ç¯¡æ”¹ã€åŠŸèƒ½è°ƒç”¨çš„ä¸šåŠ¡é‰´æƒã€å“åº”æ•°æ®çš„è„±æ•ã€æµé‡ä¸å¹¶å‘æ§åˆ¶ï¼Œç”šè‡³åŸºäºAPIè°ƒç”¨çš„è®¡é‡æˆ–è€…è®¡è´¹ç­‰ç­‰ã€‚<br><span class="hljs-bullet">-</span> ç½‘å…³ = è·¯ç”±è½¬å‘ + è¿‡æ»¤å™¨<br>`è·¯ç”±è½¬å‘ï¼šæ¥æ”¶ä¸€åˆ‡å¤–ç•Œè¯·æ±‚ï¼Œè½¬å‘åˆ°åç«¯çš„å¾®æœåŠ¡ä¸Šå»ï¼›<br>`åœ¨æœåŠ¡ç½‘å…³ä¸­å¯ä»¥å®Œæˆä¸€ç³»åˆ—çš„æ¨ªåˆ‡åŠŸèƒ½ï¼Œä¾‹å¦‚æƒé™æ ¡éªŒã€é™æµä»¥åŠç›‘æ§ç­‰ï¼Œè¿™äº›éƒ½å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨å®Œæˆ<br><span class="hljs-section"># 2.ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³</span><br><span class="hljs-bullet">-</span> 1.ç½‘å…³å¯ä»¥å®ç°æœåŠ¡çš„ç»Ÿä¸€ç®¡ç†<br><span class="hljs-bullet">-</span> 2.ç½‘å…³å¯ä»¥è§£å†³å¾®æœåŠ¡ä¸­é€šç”¨ä»£ç çš„å†—ä½™é—®é¢˜(å¦‚æƒé™æ§åˆ¶,æµé‡ç›‘æ§,é™æµç­‰)<br></code></pre></td></tr></table></figure><p>SpringCloud Alibabaå¹¶æ²¡å¼€å‘æ–°çš„ç½‘å…³ç»„ä»¶ï¼Œè€Œä¸”Gatewayå·²ç»å¾ˆä¼˜ç§€ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨GatewayåšæœåŠ¡å™¨çš„ç½‘å…³ï¼Œä¸‹é¢å¼€å‘ç½‘å…³æœåŠ¡ï¼š</p><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--å¼•å…¥gatewayç½‘å…³ä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--å¼•å…¥nacos configçš„ä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>**æ³¨æ„ï¼š**è¿™é‡Œä¸ç”¨åŠ å…¥webå¯åŠ¨å¯åŠ¨å™¨ï¼ŒGatewayä¸ºäº†æ•ˆç‡ä½¿ç”¨webfluxè¿›è¡Œå¼‚æ­¥éé˜»å¡æ¨¡å‹çš„å®ç°,å› æ­¤å’ŒåŸæ¥çš„webåŒ…å†²çª,å»æ‰åŸæ¥çš„webå³å¯</p><p>ç½‘å…³çš„é…ç½®å¯ä»¥ç”¨é…ç½®æ–‡ä»¶å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨Javaä»£ç </p><p>é…ç½®æ–‡ä»¶å»ºè®®ä½¿ç”¨ymlï¼Œå› ä¸ºæ ¼å¼è¦æ±‚é«˜ï¼Œæ–¹ä¾¿æŸ¥çœ‹ï¼Œä¸å®¹æ˜“é”™ï¼ŒåŒæ ·æ³¨å†Œåˆ°Nacosä¸Š</p><p>ä¸‹é¢çš„è·¯ç”±é…ç½®å®ç°äº†æœåŠ¡æ¥å£çš„ç»Ÿä¸€å…¥å£ç«¯å£æ˜¯8990ï¼Œå½“è®¿é—®è·¯å¾„æ˜¯æ˜¯&#x2F;invokeï¼Œå°±è½¬å‘åˆ°USERSæœåŠ¡ä¸‹ï¼Œå½“è®¿é—®è·¯å¾„æ˜¯&#x2F;productï¼Œå°±è½¬å‘åˆ°PRODUCTSï¼Œä½¿ç”¨lb:&#x2F;&#x2F;æœåŠ¡åç§°å°±å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br><span class="hljs-attr">port:</span> <span class="hljs-number">8990</span><br><span class="hljs-attr">spring:</span><br><span class="hljs-attr">application:</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">GATEWAY</span><br><span class="hljs-attr">cloud:</span><br><span class="hljs-attr">nacos:</span><br><span class="hljs-attr">discovery:</span><br><span class="hljs-attr">server-addr:</span> <span class="hljs-number">118.195</span><span class="hljs-number">.164</span><span class="hljs-number">.41</span><span class="hljs-string">:8849</span><br><span class="hljs-attr">gateway:</span><br><span class="hljs-attr">routes:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">users\_route</span><br><span class="hljs-attr">uri:</span> <span class="hljs-string">lb://USERS</span><br><span class="hljs-attr">predicates:</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">Path=/invoke</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">products\_route</span><br><span class="hljs-attr">uri:</span> <span class="hljs-string">lb://PRODUCTS</span><br><span class="hljs-attr">predicates:</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">Path=/product</span><br></code></pre></td></tr></table></figure><p>javaä»£ç é…ç½®è·¯ç”±</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GatewayConfig</span> &#123;<br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title function_">customRouteLocator</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> &#123;<br><span class="hljs-keyword">return</span> builder.routes()<br>.route(<span class="hljs-string">&quot;order\_route&quot;</span>, r -&gt; r.path(<span class="hljs-string">&quot;/product&quot;</span>)<br>.uri(<span class="hljs-string">&quot;http://localhost:9997/&quot;</span>))<br>.build();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æˆ‘ä¾æ—§å¼ºçƒˆå»ºè®®ä½¿ç”¨yamlï¼Œåé¢æŠŠé…ç½®æ–‡ä»¶æ”¾åœ¨Nacosæƒ³æ”¹ä¹Ÿå¾ˆæ–¹ä¾¿</p><p><img src="https://i.loli.net/2021/06/25/3s2ZPvr5uqEeib6.png"></p><p>éªŒè¯æˆåŠŸ</p><h2 id="5-6-æœåŠ¡é…ç½®ä¸­å¿ƒ"><a href="#5-6-æœåŠ¡é…ç½®ä¸­å¿ƒ" class="headerlink" title="5.6 æœåŠ¡é…ç½®ä¸­å¿ƒ"></a>5.6 æœåŠ¡é…ç½®ä¸­å¿ƒ</h2><p>Nacosä¸ä»…ä»…å¯ä»¥åšæœåŠ¡çš„æ³¨å†Œä¸­å¿ƒï¼Œè¿˜å¯ä»¥åšæœåŠ¡çš„é…ç½®ä¸­å¿ƒï¼Œå¯ä»¥æŠŠå¾®æœåŠ¡çš„é…ç½®æ–‡ä»¶äº¤ç»™è¿œç«¯ç®¡ç†ï¼Œæ“ä½œä¹Ÿå¾ˆç®€å•</p><p>æ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¼•å…¥nacos configçš„ä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é¦–å…ˆéœ€è¦äº†è§£ä¸‹Nacosçš„å‘½åç©ºé—´ï¼Œç»„çš„æ¦‚å¿µï¼ŒNocasæä¾›äº†é»˜è®¤çš„å…¬å…±çš„å‘½åç©ºé—´å’Œç»„ï¼Œä½†ä½œä¸ºå…·ä½“ç³»ç»Ÿå¼€å‘ï¼Œéœ€è¦å‘½ååˆ†ç±»ï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œç±»æ¯”æ•°æ®åº“ï¼Œå‘½åç©ºé—´ç›¸å½“äºåº“çš„æ¦‚å¿µï¼Œä¸€ä¸ªé¡¹ç›®åŸºæœ¬ä¸Šå°±ä¸€ä¸ªå‘½åç©ºé—´ï¼Œä¸‹é¢å¯ä»¥æœ‰å¾ˆå¤šç»„ï¼Œå°±ç±»å‹æ•°æ®è¡¨ï¼Œæ¯ä¸ªå¾®æœåŠ¡å°±å¯ä»¥æœ‰ä¸€ä¸ªç»„</p><p>é€šè¿‡Nacos Dashboardç•Œé¢ï¼Œæˆ‘ä»¬æ–°å»ºfinalå‘½åç©ºé—´å’Œå‡ ä¸ªç»„åšæµ‹è¯•</p><p><img src="https://i.loli.net/2021/06/25/usKhzAaPUYoNSnB.png"></p><p>productçš„é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œå°±æ˜¯æŠŠæœ¬åœ°çš„é…ç½®æ–‡ä»¶äº¤ç»™è¿œç«¯ç®¡ç†äº†</p><p>ä¿å­˜åï¼Œå‡å¦‚å°±è¿™æ ·ç›´æ¥å¯åŠ¨è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæœ¬åœ°åªæ˜¯æ·»åŠ äº†ä¾èµ–ï¼Œå¹¶æ²¡æœ‰å‘ŠçŸ¥ç¨‹åºå»å“ªé‡Œæ‹‰å–é…ç½®ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºbootstrap.propertiesï¼ˆä¸èƒ½æ˜¯application.propertiesï¼Œé…ç½®æ–‡ä»¶æ‹‰å–è¦æ—©äºç¨‹åºï¼Œbootstrapæ˜¯æ—©äºapplicationçš„ï¼‰</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#è¿œç«¯é…ç½®</span><br><span class="hljs-attr">spring.cloud.nacos.server-addr</span>=<span class="hljs-string">118.195.164.41:8849</span><br><span class="hljs-comment">#nacos namespace</span><br><span class="hljs-comment">#åˆ«å†™æˆäº† spring.cloud.nacos.discover</span><br><span class="hljs-attr">spring.cloud.nacos.config.namespace</span>=<span class="hljs-string">e6749e6a-76df-4627-b6f7-00ed0ea2d6ca</span><br><span class="hljs-comment">#nacos ç»„</span><br><span class="hljs-attr">spring.cloud.nacos.config.group</span>=<span class="hljs-string">USERS</span><br><span class="hljs-comment">#nacos dataId 1.name+æ–‡ä»¶åç¼€ 2.æ–‡ä»¶å+env+åç¼€</span><br><span class="hljs-attr">spring.cloud.nacos.config.name</span>=<span class="hljs-string">users-prod</span><br><span class="hljs-attr">spring.cloud.nacos.config.file-extension</span>=<span class="hljs-string">properties</span><br></code></pre></td></tr></table></figure><p>åŒæ ·Productesï¼ŒGatewayæœåŠ¡ä¹Ÿæ˜¯è¿™æ ·ä¿®æ”¹çš„ï¼Œæ³¨æ„æ–‡ä»¶ç›¸å¯¹åº”å°±è¡Œ</p><p>å¥½äº†å°±è¿™æ ·ï¼Œæˆ‘ä»¬çœ‹çœ‹æœ€åçš„é¡¹ç›®ç›®å½•ï¼š</p><p><img src="https://i.loli.net/2021/06/25/Akc2w9sU7PBfpiG.png"></p><p>æµ‹è¯•ä¹Ÿé€šè¿‡ï¼ŒæœåŠ¡é…ç½®å®Œæˆï¼</p><h2 id="5-7æœåŠ¡ç†”æ–­å’Œæµæ§"><a href="#5-7æœåŠ¡ç†”æ–­å’Œæµæ§" class="headerlink" title="5.7æœåŠ¡ç†”æ–­å’Œæµæ§"></a>5.7æœåŠ¡ç†”æ–­å’Œæµæ§</h2><p>éšç€å¾®æœåŠ¡çš„æ™®åŠï¼ŒæœåŠ¡è°ƒç”¨çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinelä»¥â€œæµé‡â€ä¸ºçªç ´å£ï¼Œåœ¨æµé‡æ§åˆ¶ã€æ–­è·¯ã€è´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªé¢†åŸŸè¿›è¡Œå·¥ä½œï¼Œä¿éšœæœåŠ¡å¯é æ€§ã€‚</p><p>é€šä¿—:ç”¨æ¥åœ¨å¾®æœåŠ¡ç³»ç»Ÿä¸­ä¿æŠ¤å¾®æœåŠ¡å¯¹çš„ä½œç”¨ å¦‚ä½• æœåŠ¡é›ªå´© æœåŠ¡ç†”æ–­ æœåŠ¡é™çº§ å°±æ˜¯ç”¨æ¥æ›¿æ¢hystrix</p><p>è¿™é‡Œæˆ‘ä»¬ä¹Ÿåªèƒ½ç®€å•çš„æ¨¡æ‹Ÿä¸‹ï¼ŒæœåŠ¡çš„ç†”æ–­å’Œæµæ§æ˜¯æŠ€æœ¯éš¾ç‚¹</p><p>sentinelæä¾›äº†ä¸¤ä¸ªæœåŠ¡ç»„ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">ä¸€ä¸ªæ˜¯ sentinel ç”¨æ¥å®ç°å¾®æœåŠ¡ç³»ç»Ÿä¸­æœåŠ¡ç†”æ–­ã€é™çº§ç­‰åŠŸèƒ½ã€‚è¿™ç‚¹å’Œhystrix ç±»ä¼¼<br>ä¸€ä¸ªæ˜¯ sentinel dashboard ç”¨æ¥ç›‘æ§å¾®æœåŠ¡ç³»ç»Ÿä¸­æµé‡è°ƒç”¨ç­‰æƒ…å†µã€‚è¿™ç‚¹å’Œhystrix ç±»ä¼¼<br></code></pre></td></tr></table></figure><p>å®‰è£…ä¸‹sentinel dashboard</p><p>å»Githubä¸‹è½½sentinelçš„jaråŒ…ï¼Œå®ƒæ˜¯SpringBootåº”ç”¨ï¼Œé»˜è®¤ç«¯å£æ˜¯8080ï¼Œä½†ä¸€èˆ¬æœºå™¨çš„8080éƒ½æ˜¯æœ‰å…¶å®ƒæœåŠ¡çš„ï¼Œæ‰€ä»¥éœ€è¦è¿è¡Œæ—¶ç”¨java -jar -Dserver.port&#x3D;è‡ªå®šä¹‰ç«¯å£å· sentinel.jaræ¥å®ç°æŒ‡å®šç«¯å£å¯åŠ¨</p><p>å¯åŠ¨æˆåŠŸåï¼Œè®¿é—®sentinelçš„webé¡µé¢ï¼Œé»˜è®¤ç”¨æˆ·åå¯†ç éƒ½sentinel</p><p><img src="https://i.loli.net/2021/06/25/K5upkVjzcQ1l7Gt.png"></p><p>ç›®å‰æ˜¯é¡¹ç›®æ²¡æœ‰é›†æˆsentinelï¼Œæ‰€ä»¥å®ƒæ˜¯æ²¡æœ‰é€‰é¡¹çš„ï¼Œç°åœ¨æˆ‘ä»¬åšä¸ªæµ‹è¯•ï¼Œåœ¨USERSä¸­çš„æ¥å£åŠ ä¸ªå‚æ•°åˆ¤æ–­ï¼Œå°äº0å°±æŠ›å¼‚å¸¸ï¼Œæ¥è§¦å‘sentinelçš„ç†”æ–­æœºåˆ¶</p><p>æ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬å·²ç»æŠŠé…ç½®æ–‡ä»¶äº¤ç»™Nocasç®¡ç†ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨è¿œç«¯çš„é…ç½®æ–‡ä»¶åŠ å…¥å‡ è¡Œé…ç½®å³å¯</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># å¼€å¯sentinel é»˜è®¤å¼€å¯</span><br><span class="hljs-attr">spring.cloud.sentinel.enabled</span>=<span class="hljs-string">true</span><br><span class="hljs-comment"># è¿æ¥dashboard</span><br><span class="hljs-attr">spring.cloud.sentinel.transport.dashboard</span>=<span class="hljs-string">localhost:8991</span><br><span class="hljs-comment"># ä¸dashboardé€šä¿¡çš„ç«¯å£</span><br><span class="hljs-attr">spring.cloud.sentinel.transport.port</span>=<span class="hljs-string">8719</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸‹USERSä¸­çš„æ¥å£æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs plain">/\*\*<br>\* @author è·¯é£<br>\* @create 2021/6/25 8:43<br>\*/<br>@RestController<br>public class UsersController &#123;<br>private static final Logger log = LoggerFactory.getLogger(UsersController.class);<br>@Value(&quot;$&#123;server.port&#125;&quot;)<br>private String port;<br>@Autowired<br>private RestTemplate restTemplate;<br>@Autowired<br>private ProductsClients productsClients;<br>@GetMapping(&quot;/invoke&quot;)<br>@SentinelResource(value = &quot;id&quot;,blockHandler =&quot;blockHandler&quot;,fallback = &quot;fall&quot;) //ä»£è¡¨æ˜¯ä¸€ä¸ªSentinelçš„èµ„æº<br>public String invoke(Integer id)&#123;<br>// String result = restTemplate.getForObject(&quot;http://PRODUCTS/product&quot;, String.class);<br>// String result = productsClients.product();<br>// log.info(&quot;result:&#123;&#125;&quot;,result);<br>if(id &lt; 0)&#123;<br>throw new RuntimeException(&quot;å‚æ•°æ ¡éªŒå¤±è´¥&quot;);<br>&#125;<br>log.info(&quot;user is ok&quot;);<br>return &quot;user service is ok! &quot;+ &quot; --&gt; portï¼š&quot;+port;<br>&#125;<br>public String blockHandler(Integer id, BlockException e)&#123;<br>if(e instanceof FlowException)&#123;<br>return &quot;è¯·æ±‚è¿‡äºç«çˆ†ï¼Œæ‚¨å·²è¢«æµæ§ï¼&quot;;<br>&#125;<br>if (e instanceof ParamFlowException)&#123;<br>return &quot;çƒ­ç‚¹å‚æ•°é™æµ&quot;;<br>&#125;<br>if (e instanceof DegradeException)&#123;<br>return &quot;é™çº§&quot;;<br>&#125;<br>return &quot;æœåŠ¡å™¨é¡¶ä¸ä½äº†~&quot;;<br>&#125;<br>public String fall(Integer id)&#123;<br>return &quot;é»˜è®¤æœåŠ¡å™¨é”™è¯¯&quot;;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨Sentinel Dashboardä¸­åŠ å…¥æµé‡æ§åˆ¶è§„åˆ™ï¼Œå½“QPSè¾¾åˆ°4å°±è§¦å‘æµæ§</p><p><img src="https://i.loli.net/2021/06/25/G17ZHazDEO6gcMB.png" alt="16.png"></p><p>æµ‹è¯•ç»“æœï¼Œå½“æˆ‘ä»¬è¯·æ±‚è¿‡å¿«ï¼Œè¾¾åˆ°é˜ˆå€¼å°±ä¼šè¿›è¡Œæµæ§ï¼Œæ— æ³•è¯·æ±‚</p><p><img src="https://i.loli.net/2021/06/25/7BzRq8OiyJgrplu.png"></p><p>å½“æˆ‘ä»¬è¯·æ±‚æ‰€å¸¦çš„idå°äº0ä¹Ÿä¼šèµ°å¤±è´¥çš„å¤„ç†æ–¹æ³•ï¼Œè€Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸</p><p><img src="https://i.loli.net/2021/06/25/wlWZ71QRjNcP8pD.png"></p><p>åˆ°æ­¤ï¼Œäº”å¤§ç»„ä»¶çš„é›†æˆç¯å¢ƒå·²ç»æ­å»ºå®Œæˆï¼</p><h1 id="6-æ€»ç»“"><a href="#6-æ€»ç»“" class="headerlink" title="6. æ€»ç»“"></a>6. æ€»ç»“</h1><p>å›è¿‡å»çœ‹ä¸€çœ‹ï¼Œè™½ç„¶ç»„ä»¶å¾ˆå¤šï¼Œä½†æ­å»ºå¹¶ä¸éš¾ï¼ŒåŸºæœ¬çš„æ­¥éª¤å°±æ˜¯ï¼š</p><ol><li>åŠ ä¾èµ–</li><li>å†™é…ç½®</li><li>å†™æ³¨è§£</li></ol><p>å¾®æœåŠ¡å¼€å‘éš¾å¾—çš„åé¢çš„æ¨¡å—ä¸€æ—¦å¤šèµ·æ¥ï¼Œæ¨¡å—ä¹‹é—´çš„è°ƒç”¨å°±å¾ˆé¥¶äººäº†</p><h1 id="7-å‚è€ƒ"><a href="#7-å‚è€ƒ" class="headerlink" title="7.å‚è€ƒ"></a>7.å‚è€ƒ</h1><p><a href="https://www.bilibili.com/video/BV1S5411c7hM">å°é™ˆçš„2021å¹´æœ€æ–°SpringCloudå¾®æœåŠ¡å®æˆ˜æ•™ç¨‹</a></p><h1 id="8-æºç "><a href="#8-æºç " class="headerlink" title="8.æºç "></a>8.æºç </h1>]]></content>
    
    
    
    <tags>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginxä¸€ç‚¹ç‚¹</title>
    <link href="/2021/06/13/Nginx%E4%B8%80%E7%82%B9%E7%82%B9/"/>
    <url>/2021/06/13/Nginx%E4%B8%80%E7%82%B9%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<p><img src="https://i.loli.net/2021/06/12/pOVkBsKWd5c4GPI.png"></p><h1 id="1-Nginxä»‹ç»"><a href="#1-Nginxä»‹ç»" class="headerlink" title="1. Nginxä»‹ç»"></a>1. Nginxä»‹ç»</h1><p>Nginxæ˜¯ä¸€æ¬¾è½»é‡çº§çš„WebæœåŠ¡å™¨ã€åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”±äºå®ƒçš„å†…å­˜å ç”¨å°‘ï¼Œå¯åŠ¨æå¿«ï¼Œé«˜å¹¶å‘èƒ½åŠ›å¼ºï¼Œåœ¨äº’è”ç½‘é¡¹ç›®ä¸­å¹¿æ³›åº”ç”¨ã€‚</p><p><img src="https://i.loli.net/2021/06/12/Eqcp7mT9v46ARyX.jpg"></p><p>ä¸Šå›¾åŸºæœ¬ä¸Šè¯´æ˜äº†å½“ä¸‹æµè¡Œçš„æŠ€æœ¯æ¶æ„ï¼Œå…¶ä¸­Nginxæœ‰ç‚¹å…¥å£ç½‘å…³çš„å‘³é“ã€‚</p><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬å…ˆå®‰è£…ç©ç©å§</p><h1 id="2-å®‰è£…Nginx"><a href="#2-å®‰è£…Nginx" class="headerlink" title="2. å®‰è£…Nginx"></a>2. å®‰è£…Nginx</h1><p>ä¸€èˆ¬éƒ½æ˜¯é¡¹ç›®éƒ½æ˜¯éƒ¨ç½²åœ¨linuxä¸Šï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨Dockerçš„æ–¹å¼å¯åŠ¨Nginxï¼Œå…³äºDockerçš„ï¼Œä¸Šä¸€ç¯‡æœ‰è¯¦ç»†ä»‹ç»</p><p><a href="https://luffy997.github.io/2021/06/12/Docker/">Docker</a></p><p>ä¸‹é¢è®°å½•centos7åˆ©ç”¨Dockerå®‰è£…Nginxçš„å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hspEdu01 nginx]# docker pull nginx<br>Using default tag: latest<br>Trying to pull repository docker.io/library/nginx ...<br>latest: Pulling from docker.io/library/nginx<br>69692152171a: Already exists<br>30afc0b18f67: Pull complete<br>596b1d696923: Pull complete<br>febe5bd23e98: Pull complete<br>8283eee92e2f: Pull complete<br>351ad75a6cfa: Pull complete<br>Digest: sha256:6d75c99af15565a301e48297fa2d121e15d80ad526f8369c526324f0f7ccb750<br>Status: Downloaded newer image for docker.io/nginx:latest<br>[root@hspEdu01 nginx]# ls<br>conf logs www<br>[root@hspEdu01 nginx]# cd conf/<br>[root@hspEdu01 conf]# ls<br>nginx.conf<br>[root@hspEdu01 conf]# cd ../<br>[root@hspEdu01 nginx]# cd ../<br>[root@hspEdu01 ~]# rm -rf nginx/<br>[root@hspEdu01 ~]# ls<br>anaconda-ks.cfg data data2 initial-setup-ks.cfg mysql å…¬å…± æ¨¡æ¿ è§†é¢‘ å›¾ç‰‡ æ–‡æ¡£ ä¸‹è½½ éŸ³ä¹ æ¡Œé¢<br>[root@hspEdu01 ~]# docker run --name nginx-test -p 80:80 -d nginx<br>608ed67163e091695eb14f964cff6f4d24f2818275845f34254eff49e24fe770<br>[root@hspEdu01 ~]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS<br>608ed67163e0 nginx &quot;/docker-entrypoin...&quot; 4 seconds ago Up 2 seconds 0.0.0.0:80-&gt;80/tcp<br>760a2956258e a8e34 &quot;java -jar app.jar&quot; About an hour ago Up About an hour 0.0.0.0:8010-&gt;8010/tcp<br>95628d5d89c5 mysql:5.7 &quot;docker-entrypoint...&quot; About an hour ago Up About an hour 0.0.0.0:3306-&gt;3306/tcp, 33060/tc<br>[root@hspEdu01 ~]# mkdir -p /root/nginx/www /root/nginx/logs /root/nginx/conf<br>[root@hspEdu01 ~]# cd nginx/<br>[root@hspEdu01 nginx]# cd conf/<br>[root@hspEdu01 conf]# ls<br>[root@hspEdu01 conf]# docker cp 608e:/etc/nginx/nginx.conf /root/nginx/conf<br>[root@hspEdu01 conf]# ls<br>nginx.conf<br>[root@hspEdu01 conf]# docker rm -f 608e<br>608e<br>[root@hspEdu01 conf]# docker run -d -p 80:80 --name nginx-web -v /root/nginx/www:/usr/share/nginx/html -v /root/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /root/nginx/logs:/var/log/nginx nginx<br>987bc07bc4eb474332766dfe6409d957e07bf94fc24153222cf8bf99147df717<br>[root@hspEdu01 conf]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES<br>987bc07bc4eb nginx &quot;/docker-entrypoin...&quot; 10 seconds ago Exited (1) 9 seconds ago nginx-web<br>760a2956258e a8e34 &quot;java -jar app.jar&quot; About an hour ago Up About an hour 0.0.0.0:8010-&gt;8010/tcp adoring\_pare<br>95628d5d89c5 mysql:5.7 &quot;docker-entrypoint...&quot; About an hour ago Up About an hour 0.0.0.0:3306-&gt;3306/tcp, 33060/tcp mysql<br>[root@hspEdu01 conf]# docker logs -f 987b<br>/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration<br>/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh<br>10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf<br>10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh<br>/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh<br>/docker-entrypoint.sh: Configuration complete; ready for start up<br>nginx: [alert] could not open error log file: open() &quot;/var/log/nginx/error.log&quot; failed (13: Permission denied)<br>2021/06/12 02:26:39 [emerg] 1#1: open() &quot;/etc/nginx/nginx.conf&quot; failed (13: Permission denied)<br>[root@hspEdu01 conf]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES<br>987bc07bc4eb nginx &quot;/docker-entrypoin...&quot; About a minute ago Exited (1) About a minute ago nginx-web<br>760a2956258e a8e34 &quot;java -jar app.jar&quot; About an hour ago Up About an hour 0.0.0.0:8010-&gt;8010/tcp adoring\_pare<br>95628d5d89c5 mysql:5.7 &quot;docker-entrypoint...&quot; About an hour ago Up About an hour 0.0.0.0:3306-&gt;3306/tcp, 33060/tcp mysql<br>[root@hspEdu01 conf]# docker rm -f 987<br>987<br>[root@hspEdu01 conf]# docker run -d -p 80:80 --name nginx-web -v /root/nginx/www:/usr/share/nginx/html -v /root/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /root/nginx/logs:/var/log/nginx --privileged=true nginx<br>6593ed8866071e1865217f58c627005aa8f3e9b3c8db6f5ff1aec22653503d1a<br>[root@hspEdu01 conf]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES<br>6593ed886607 nginx &quot;/docker-entrypoin...&quot; 5 seconds ago Up 3 seconds 0.0.0.0:80-&gt;80/tcp nginx-web<br>760a2956258e a8e34 &quot;java -jar app.jar&quot; About an hour ago Up About an hour 0.0.0.0:8010-&gt;8010/tcp adoring\_pare<br>95628d5d89c5 mysql:5.7 &quot;docker-entrypoint...&quot; About an hour ago Up About an hour 0.0.0.0:3306-&gt;3306/tcp, 33060/tcp mysql<br>[root@hspEdu01 conf]# cd ../<br>[root@hspEdu01 nginx]# cd www/<br>[root@hspEdu01 www]# touch a.html<br>[root@hspEdu01 www]# vim a.html<br>[root@hspEdu01 www]#<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªnginx-webçš„å®¹å™¨ï¼Œå¹¶æŠŠå®ƒçš„ç½‘é¡µç›®å½•ï¼Œæ—¥å¿—ç›®å½•å’Œé…ç½®æ–‡ä»¶ç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœºï¼Œæ–°å»ºäº†ä¸€ä¸ªa.htmlï¼Œå› ä¸ºNginxçš„çƒ­éƒ¨ç½²çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥åœ¨æµè§ˆå™¨è¯·æ±‚a.htmlå³å¯</p><p><img src="https://i.loli.net/2021/06/12/mUoaTBXV9Y1yJ23.png"></p><h1 id="3-è´Ÿè½½å‡è¡¡"><a href="#3-è´Ÿè½½å‡è¡¡" class="headerlink" title="3. è´Ÿè½½å‡è¡¡"></a>3. è´Ÿè½½å‡è¡¡</h1><p>åœ¨ç¬¬äºŒå¼ å›¾ä¸Šï¼Œå·²ç»æåˆ°Nginxå¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œä»€ä¹ˆå«è´Ÿè½½å‡è¡¡å‘¢ï¼Ÿ</p><p>å¦‚æœè¯·æ±‚æ•°è¿‡å¤§ï¼Œå•ä¸ªæœåŠ¡å™¨è§£å†³ä¸äº†ï¼Œæˆ‘ä»¬å¢åŠ æœåŠ¡å™¨çš„æ•°é‡ï¼Œç„¶åå°†è¯·æ±‚åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°†åŸå…ˆè¯·æ±‚é›†ä¸­åˆ°å•ä¸ªæœåŠ¡å™¨çš„æƒ…å†µæ”¹ä¸ºè¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°±æ˜¯è´Ÿè½½å‡è¡¡ã€‚</p><p>å®ç°æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨nginx.confä¸­upstream æŒ‡å®šåç«¯æœåŠ¡å™¨åœ°å€åˆ—è¡¨ï¼Œåœ¨ server ä¸­æ‹¦æˆªå“åº”è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ° Upstream ä¸­é…ç½®çš„æœåŠ¡å™¨åˆ—è¡¨ã€‚</p><h2 id="1-è½®è¯¢"><a href="#1-è½®è¯¢" class="headerlink" title="1. è½®è¯¢"></a>1. è½®è¯¢</h2><p>è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨Dockerå¤šç«¯å£å¯åŠ¨3å°TomcatæœåŠ¡å™¨ï¼Œé‡Œé¢Nginxå®ç°è¯·æ±‚çš„è´Ÿè½½å‡è¡¡ï¼Œä¸‹é¢è®°å½•è¯¦ç»†å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-0-15-centos conf]# docker run -p 8010:8080 -v /root/tomcat8010/webapps:/usr/local/tomcat/webapps -d --name tomcat8081 bcf990bea01a<br>a386923c309b971e5c09c1656f706313d074d62f1a898844513594f662463c07<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‰å°Tomcatå¯åŠ¨æ–¹å¼éƒ½æ˜¯ä¸€æ ·çš„ åªæ˜¯å‚æ•°å’Œæ•°æ®å·ä¸ä¸€æ ·è€Œå·²ï¼Œè¿™é‡Œä»¥æœ€åä¸€å°ä¸ºä¾‹å­</span><br>[root@VM-0-15-centos conf]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES<br>a386923c309b bcf990bea01a &quot;catalina.sh run&quot; 4 seconds ago Up 3 seconds 0.0.0.0:8010-&gt;8080/tcp tomcat8081<br>5dbbb4db6e00 bcf990bea01a &quot;catalina.sh run&quot; 20 hours ago Up 20 hours 0.0.0.0:8881-&gt;8080/tcp tomcat-8881<br>216a2e8f1c90 bcf990bea01a &quot;catalina.sh run&quot; 20 hours ago Up 20 hours 0.0.0.0:8888-&gt;8080/tcp tomcat-8888<br>8499b0e39d0f bcf990bea01a &quot;catalina.sh run&quot; 21 hours ago Up 21 hours 0.0.0.0:8080-&gt;8080/tcp mytomcat<br>7dd71eee737f mysql:5.7 &quot;docker-entrypoint...&quot; 43 hours ago Up 43 hours 0.0.0.0:3306-&gt;3306/tcp, 33060/tcp mysql<br>52aa02d195d9 nginx &quot;/docker-entrypoin...&quot; 2 days ago Up 2 minutes 0.0.0.0:80-&gt;80/tcp nginx-web<br>[root@VM-0-15-centos conf]# cd /root<br>[root@VM-0-15-centos ~]# ls<br>aa.txt apps data demo dockerfile images meiyan mysql nginx RUNNING.txt test tomcat8010 tomcat-8881 tomcat8888 webapps<br>[root@VM-0-15-centos ~]# cd tomcat8010<br>[root@VM-0-15-centos tomcat8010]# ls<br>webapps<br>[root@VM-0-15-centos tomcat8010]# cd webapps<br>[root@VM-0-15-centos webapps]# mkdir edu<br>[root@VM-0-15-centos webapps]# cd edu<br>[root@VM-0-15-centos edu]# ouch a.html<br>-bash: ouch: command not found<br>[root@VM-0-15-centos edu]# touch a.html<br>[root@VM-0-15-centos edu]# vim a.html<br>[root@VM-0-15-centos edu]# cat a.html<br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta charset=&quot;utf-8&quot;&gt;<br>&lt;title&gt;&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h3&gt;Tomcat8010&lt;/h3&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br>[root@VM-0-15-centos edu]# cd /root/nginx/conf/<br>[root@VM-0-15-centos conf]# vim nginx.conf<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®å®Œnginx.conf è®°å¾—é‡å¯nginxæœåŠ¡</span><br>[root@VM-0-15-centos conf]# docker restart nginx-web<br>nginx-web<br>[root@VM-0-15-centos conf]#<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®<a href="http://118.195.164.41/edu/a.html%EF%BC%8C%E4%BC%9A%E5%8F%91%E7%8E%B0%E5%AE%83%E6%98%AF%E8%B7%B3%E8%BD%AC%E5%88%B0%E4%B8%8D%E5%90%8C%E7%9A%84Tomcat%E4%B8%8A%EF%BC%8C%E5%8D%B3%E5%AE%9E%E7%8E%B0%E4%BA%86%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%8C%E8%BF%99%E9%87%8C%E5%8F%AA%E6%98%AF%E7%AC%AC%E4%B8%80%E7%A7%8D%EF%BC%8C%E6%88%91%E4%BB%AC%E5%B9%B6%E6%B2%A1%E8%AE%BE%E8%AE%A1%E7%BB%86%E5%88%99%EF%BC%8C%E4%B8%8B%E9%9D%A2%E6%88%91%E4%BB%AC%E5%86%8D%E5%B1%95%E7%A4%BA%E8%AE%B2%E8%BF%B0%E4%B8%8B%E5%85%B6%E5%AE%83%E5%87%A0%E7%A7%8D%EF%BC%9A">http://118.195.164.41/edu/a.htmlï¼Œä¼šå‘ç°å®ƒæ˜¯è·³è½¬åˆ°ä¸åŒçš„Tomcatä¸Šï¼Œå³å®ç°äº†è´Ÿè½½å‡è¡¡ï¼Œè¿™é‡Œåªæ˜¯ç¬¬ä¸€ç§ï¼Œæˆ‘ä»¬å¹¶æ²¡è®¾è®¡ç»†åˆ™ï¼Œä¸‹é¢æˆ‘ä»¬å†å±•ç¤ºè®²è¿°ä¸‹å…¶å®ƒå‡ ç§ï¼š</a></p><h2 id="2-ä¼˜å…ˆçº§"><a href="#2-ä¼˜å…ˆçº§" class="headerlink" title="2. ä¼˜å…ˆçº§"></a>2. ä¼˜å…ˆçº§</h2><p>ä¿®æ”¹nginx.confå³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-0-15-centos conf]# cat nginx.conf<br>user nginx;<br>worker\_processes auto;<br>error\_log /var/log/nginx/error.log notice;<br>pid /var/run/nginx.pid;<br>events &#123;<br>worker\_connections 1024;<br>&#125;<br>http &#123;<br>include /etc/nginx/mime.types;<br>default\_type application/octet-stream;<br>log\_format main &#x27;$remote\_addr - $remote\_user [$time\_local] &quot;$request&quot; &#x27;<br>&#x27;$status $body\_bytes\_sent &quot;$http\_referer&quot; &#x27;<br>&#x27;&quot;$http\_user\_agent&quot; &quot;$http\_x\_forwarded\_for&quot;&#x27;;<br>access\_log /var/log/nginx/access.log main;<br>upstream myserver &#123;<br>server 118.195.164.41:8080 weight=1;<br>server 118.195.164.41:8888 weight=10;<br>server 118.195.164.41:8881 weight=15;<br>server 118.195.164.41:8010 weight=20;<br>&#125;<br>server&#123;<br>listen 80;<br>charset utf-8;<br>server\_name 118.195.164.41;<br>location / &#123;<br>proxy\_pass http://myserver;<br>&#125;<br>&#125;<br>sendfile on;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">tcp\_nopush on;</span><br>keepalive\_timeout 65;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">gzip on;</span><br>include /etc/nginx/conf.d/\*.conf;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-ip-hash"><a href="#3-ip-hash" class="headerlink" title="3.ip_hash"></a>3.ip_hash</h2><p>æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-0-15-centos conf]# cat nginx.conf<br>user nginx;<br>worker\_processes auto;<br>error\_log /var/log/nginx/error.log notice;<br>pid /var/run/nginx.pid;<br>events &#123;<br>worker\_connections 1024;<br>&#125;<br>http &#123;<br>include /etc/nginx/mime.types;<br>default\_type application/octet-stream;<br>log\_format main &#x27;$remote\_addr - $remote\_user [$time\_local] &quot;$request&quot; &#x27;<br>&#x27;$status $body\_bytes\_sent &quot;$http\_referer&quot; &#x27;<br>&#x27;&quot;$http\_user\_agent&quot; &quot;$http\_x\_forwarded\_for&quot;&#x27;;<br>access\_log /var/log/nginx/access.log main;<br>upstream myserver &#123;<br>ip\_hash;<br>server 118.195.164.41:8080 ;<br>server 118.195.164.41:8888 ;<br>server 118.195.164.41:8881 ;<br>server 118.195.164.41:8010 ;<br>&#125;<br>server&#123;<br>listen 80;<br>charset utf-8;<br>server\_name 118.195.164.41;<br>location / &#123;<br>proxy\_pass http://myserver;<br>&#125;<br>&#125;<br>sendfile on;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">tcp\_nopush on;</span><br>keepalive\_timeout 65;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">gzip on;</span><br>include /etc/nginx/conf.d/\*.conf;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-fair-ç¬¬ä¸‰æ–¹"><a href="#4-fair-ç¬¬ä¸‰æ–¹" class="headerlink" title="4.fair(ç¬¬ä¸‰æ–¹)"></a>4.fair(ç¬¬ä¸‰æ–¹)</h2><p>æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚</p><p>éœ€è¦å®‰è£…å…¶å®ƒä¾èµ–ï¼Œè¿™é‡Œå°±ä¸æµ‹è¯•äº†</p><h1 id="4-åå‘ä»£ç†"><a href="#4-åå‘ä»£ç†" class="headerlink" title="4. åå‘ä»£ç†"></a>4. åå‘ä»£ç†</h1><p>ç»å¸¸å¬äººè¯´åˆ°ä¸€äº›æœ¯è¯­ï¼Œå¦‚åå‘ä»£ç†ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯åå‘ä»£ç†ï¼Œä»€ä¹ˆåˆæ˜¯æ­£å‘ä»£ç†å‘¢ï¼Ÿ</p><p><img src="https://i.loli.net/2021/06/13/HNdostpFcQSUK7I.jpg"></p><p>â€‹ æ­£å‘ä»£ç†ç¤ºæ„å›¾</p><p><img src="https://i.loli.net/2021/06/13/Td9tcFv6CNwDiGB.jpg"></p><p>â€‹ åå‘ä»£ç†ç¤ºæ„å›¾</p><p>ç”±äºé˜²ç«å¢™çš„åŸå› ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½ç›´æ¥è®¿é—®è°·æ­Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å€ŸåŠ©VPNæ¥å®ç°ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ­£å‘ä»£ç†çš„ä¾‹å­ã€‚è¿™é‡Œä½ èƒ½å¤Ÿå‘ç°ï¼Œæ­£å‘ä»£ç†â€œä»£ç†â€çš„æ˜¯å®¢æˆ·ç«¯ï¼Œè€Œä¸”å®¢æˆ·ç«¯æ˜¯çŸ¥é“ç›®æ ‡çš„ï¼Œè€Œç›®æ ‡æ˜¯ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯é€šè¿‡VPNè®¿é—®çš„ã€‚</p><p>å½“æˆ‘ä»¬åœ¨å¤–ç½‘è®¿é—®ç™¾åº¦çš„æ—¶å€™ï¼Œå…¶å®ä¼šè¿›è¡Œä¸€ä¸ªè½¬å‘ï¼Œä»£ç†åˆ°å†…ç½‘å»ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„åå‘ä»£ç†ï¼Œå³åå‘ä»£ç†â€œä»£ç†â€çš„æ˜¯æœåŠ¡å™¨ç«¯ï¼Œè€Œä¸”è¿™ä¸€ä¸ªè¿‡ç¨‹å¯¹äºå®¢æˆ·ç«¯è€Œè¨€æ˜¯é€æ˜çš„ã€‚</p><p>Nginxå®ç°åå‘ä»£ç†æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œä¸‹é¢è®°å½•è¯¦ç»†å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-0-15-centos conf]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES<br>a386923c309b bcf990bea01a &quot;catalina.sh run&quot; 22 hours ago Up 22 hours 0.0.0.0:8010-&gt;8080/tcp tomcat8081<br>5dbbb4db6e00 bcf990bea01a &quot;catalina.sh run&quot; 42 hours ago Up 42 hours 0.0.0.0:8881-&gt;8080/tcp tomcat-8881<br>216a2e8f1c90 bcf990bea01a &quot;catalina.sh run&quot; 43 hours ago Up 43 hours 0.0.0.0:8888-&gt;8080/tcp tomcat-8888<br>8499b0e39d0f bcf990bea01a &quot;catalina.sh run&quot; 43 hours ago Up 43 hours 0.0.0.0:8080-&gt;8080/tcp mytomcat<br>7dd71eee737f mysql:5.7 &quot;docker-entrypoint...&quot; 2 days ago Up 2 days 0.0.0.0:3306-&gt;3306/tcp, 33060/tcp mysql<br>52aa02d195d9 nginx &quot;/docker-entrypoin...&quot; 2 days ago Up 39 seconds 0.0.0.0:80-&gt;80/tcp nginx-web<br>[root@VM-0-15-centos conf]# vim nginx.conf<br>[root@VM-0-15-centos conf]# cat nginx.conf<br>user nginx;<br>worker\_processes auto;<br>error\_log /var/log/nginx/error.log notice;<br>pid /var/run/nginx.pid;<br>events &#123;<br>worker\_connections 1024;<br>&#125;<br>http &#123;<br>include /etc/nginx/mime.types;<br>default\_type application/octet-stream;<br>log\_format main &#x27;$remote\_addr - $remote\_user [$time\_local] &quot;$request&quot; &#x27;<br>&#x27;$status $body\_bytes\_sent &quot;$http\_referer&quot; &#x27;<br>&#x27;&quot;$http\_user\_agent&quot; &quot;$http\_x\_forwarded\_for&quot;&#x27;;<br>access\_log /var/log/nginx/access.log main;<br>upstream myserver &#123;<br>server 118.195.164.41:8080 ;<br>server 118.195.164.41:8888 ;<br>server 118.195.164.41:8881 ;<br>server 118.195.164.41:8010 ;<br>&#125;<br>server&#123;<br>listen 80;<br>charset utf-8;<br>server\_name 118.195.164.41;<br>location / &#123;<br>proxy\_pass http://118.195.164.41:8888/edu/a.html;<br>proxy\_redirect default;<br>&#125;<br>&#125;<br>sendfile on;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">tcp\_nopush on;</span><br>keepalive\_timeout 65;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">gzip on;</span><br>include /etc/nginx/conf.d/\*.conf;<br>&#125;<br>[root@VM-0-15-centos conf]# docker restart nginx-web<br>nginx-web<br>[root@VM-0-15-centos conf]# vim nginx.conf<br>[root@VM-0-15-centos conf]# docker restart nginx-web<br>nginx-web<br>[root@VM-0-15-centos conf]#<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹å‘ä»£ç†ï¼Œè®©è®¿é—®80ç«¯å£çš„è¯·æ±‚é‡å®šå‘åˆ°8888ç«¯å£ä¸‹çš„ä¸€ä¸ªé¡µé¢ï¼Œæµ‹è¯•æˆåŠŸï¼</p><p>å…³äºlocationçš„é…ç½®ï¼Œä¸»è¦å°±æ˜¯å¯¹è®¿é—®è·¯å¾„è¿›è¡Œè®¾ç½®ï¼Œæœ‰å¾ˆå¤šï¼Œä¸‹é¢è¿™ç¯‡åšæ–‡è®²çš„å¾ˆå¥½ï¼š</p><p><a href="https://blog.csdn.net/tjcyjd/article/details/50897959">nginxçš„locationé…ç½®è¯¦è§£</a></p><h1 id="5-åŠ¨é™åˆ†ç¦»"><a href="#5-åŠ¨é™åˆ†ç¦»" class="headerlink" title="5. åŠ¨é™åˆ†ç¦»"></a>5. åŠ¨é™åˆ†ç¦»</h1><p><img src="https://i.loli.net/2021/06/13/xCJVvKSAT5j3PGu.png"></p><p>Nginx åŠ¨é™åˆ†ç¦»ç®€å•æ¥è¯´å°±æ˜¯æŠŠåŠ¨æ€è·Ÿé™æ€è¯·æ±‚åˆ†å¼€ï¼Œä¸èƒ½ç†è§£æˆåªæ˜¯å•çº¯çš„æŠŠåŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢ç‰©ç†åˆ†ç¦»ã€‚ä¸¥æ ¼æ„ä¹‰ä¸Šè¯´åº”è¯¥æ˜¯åŠ¨æ€è¯·æ±‚è·Ÿé™æ€è¯·æ±‚åˆ†å¼€ï¼Œå¯ä»¥ç†è§£æˆä½¿ç”¨ Nginxå¤„ç†é™æ€é¡µé¢ï¼ŒTomcat å¤„ç†åŠ¨æ€é¡µé¢ã€‚åŠ¨é™åˆ†ç¦»ä»ç›®å‰å®ç°è§’åº¦æ¥è®²å¤§è‡´åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯çº¯ç²¹æŠŠé™æ€æ–‡ä»¶ç‹¬ç«‹æˆå•ç‹¬çš„åŸŸåï¼Œæ”¾åœ¨ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šï¼Œä¹Ÿæ˜¯ç›®å‰ä¸»æµæ¨å´‡çš„æ–¹æ¡ˆï¼›</p><p>å¦å¤–ä¸€ç§æ–¹æ³•å°±æ˜¯åŠ¨æ€è·Ÿé™æ€æ–‡ä»¶æ··åˆåœ¨ä¸€èµ·å‘å¸ƒï¼Œé€šè¿‡ nginx æ¥åˆ†å¼€ã€‚é€šè¿‡ location æŒ‡å®šä¸åŒçš„åç¼€åå®ç°ä¸åŒçš„è¯·æ±‚è½¬å‘ã€‚é€šè¿‡ expires å‚æ•°è®¾ç½®ï¼Œå¯ä»¥ä½¿æµè§ˆå™¨ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œå‡å°‘ä¸æœåŠ¡å™¨ä¹‹å‰çš„è¯·æ±‚å’Œæµé‡ã€‚å…·ä½“ Expires å®šä¹‰ï¼šæ˜¯ç»™ä¸€ä¸ªèµ„æºè®¾å®šä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´æ— éœ€å»æœåŠ¡ç«¯éªŒè¯ï¼Œç›´æ¥é€šè¿‡æµè§ˆå™¨è‡ªèº«ç¡®è®¤æ˜¯å¦è¿‡æœŸå³å¯ï¼Œ</p><p>æ‰€ä»¥ä¸ä¼šäº§ç”Ÿé¢å¤–çš„æµé‡ã€‚æ­¤ç§æ–¹æ³•éå¸¸é€‚åˆä¸ç»å¸¸å˜åŠ¨çš„èµ„æºã€‚ï¼ˆå¦‚æœç»å¸¸æ›´æ–°çš„æ–‡ä»¶ï¼Œä¸å»ºè®®ä½¿ç”¨ Expires æ¥ç¼“å­˜ï¼‰ï¼Œæˆ‘è¿™é‡Œè®¾ç½® 3dï¼Œè¡¨ç¤ºåœ¨è¿™ 3 å¤©ä¹‹å†…è®¿é—®è¿™ä¸ª URLï¼Œå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯”å¯¹æœåŠ¡å™¨è¯¥æ–‡ä»¶æœ€åæ›´æ–°æ—¶é—´æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸ä¼šä»æœåŠ¡å™¨æŠ“å–ï¼Œè¿”å›çŠ¶æ€ç  304ï¼Œå¦‚æœæœ‰ä¿®æ”¹ï¼Œåˆ™ç›´æ¥ä»æœåŠ¡å™¨é‡æ–°ä¸‹è½½ï¼Œè¿”å›çŠ¶æ€ç  200ã€‚</p><p>å¯¹äºè¿™ä¸ªé…ç½®ï¼Œå…¶å®å°±æ˜¯åœ¨locationé…ç½®ä¸‹è·¯å¾„ï¼Œä½†æˆ‘ä¸€ç›´æ²¡æˆåŠŸï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼ï¼é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs shell">user nginx;<br>worker\_processes auto;<br>error\_log /var/log/nginx/error.log notice;<br>pid /var/run/nginx.pid;<br>events &#123;<br>worker\_connections 1024;<br>&#125;<br>http &#123;<br>include /etc/nginx/mime.types;<br>default\_type application/octet-stream;<br>log\_format main &#x27;$remote\_addr - $remote\_user [$time\_local] &quot;$request&quot; &#x27;<br>&#x27;$status $body\_bytes\_sent &quot;$http\_referer&quot; &#x27;<br>&#x27;&quot;$http\_user\_agent&quot; &quot;$http\_x\_forwarded\_for&quot;&#x27;;<br>upstream static &#123;<br>server 118.195.164.41:80;<br>&#125;<br>upstream dynamic &#123;<br>server 118.195.164.41:8080 ;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">server 118.195.164.41:8888 ;</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">server 118.195.164.41:8881 ;</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">server 118.195.164.41:8010 ;</span><br>&#125;<br>server&#123;<br>listen 80;<br>charset utf-8;<br>server\_name 118.195.164.41;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‹¦æˆªåŠ¨æ€èµ„æº</span><br>location ~ .\*\.(php|jsp)$ &#123;<br>proxy\_pass http://dynamic;<br>&#125;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‹¦æˆªé™æ€èµ„æº</span><br>location ~ .\*\.(jpg|png|htm|html|css|js)$ &#123;<br>root /data/; #htmlç›®å½•<br>proxy\_pass http://static;<br>autoindex on; #è‡ªåŠ¨æ‰“å¼€æ–‡ä»¶åˆ—è¡¨<br>&#125;<br>&#125;<br>sendfile on;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">tcp\_nopush on;</span><br>keepalive\_timeout 65;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">gzip on;</span><br>include /etc/nginx/conf.d/\*.conf;<br>&#125;<br></code></pre></td></tr></table></figure><p>åé¢æœ‰æ—¶é—´å†æ›´æ–°Nginxçš„~</p><h1 id="6-å‚è€ƒæ–‡ç« "><a href="#6-å‚è€ƒæ–‡ç« " class="headerlink" title="6. å‚è€ƒæ–‡ç« "></a>6. å‚è€ƒæ–‡ç« </h1><p><a href="https://zhuanlan.zhihu.com/p/34943332">8åˆ†é’Ÿå¸¦ä½ æ·±å…¥æµ…å‡ºææ‡‚Nginx</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker</title>
    <link href="/2021/06/12/Docker/"/>
    <url>/2021/06/12/Docker/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å­¦Dockerï¼ŒèŠ±äº†å¾ˆå¤šæ—¶é—´ï¼Œç®—æ˜¯æŠŠDockerçš„ä¸€äº›åŸºæœ¬ä½¿ç”¨æ–¹æ³•getåˆ°äº†ï¼Œç°åœ¨è®°å½•ä¸‹</p><h1 id="1-DockeråŸºç¡€çŸ¥è¯†"><a href="#1-DockeråŸºç¡€çŸ¥è¯†" class="headerlink" title="1. DockeråŸºç¡€çŸ¥è¯†"></a>1. DockeråŸºç¡€çŸ¥è¯†</h1><h2 id="1-ä»€ä¹ˆæ˜¯Docker"><a href="#1-ä»€ä¹ˆæ˜¯Docker" class="headerlink" title="1. ä»€ä¹ˆæ˜¯Docker"></a>1. ä»€ä¹ˆæ˜¯Docker</h2><p><img src="https://i.loli.net/2021/06/11/hu1LqNzFQvP87aC.png" alt="image-20200404105433120.png"></p><p>å®˜ç½‘çš„ä»‹ç»æ˜¯â€œ<code>Docker is the worldâ€™s leading software container platform.</code>â€ å®˜æ–¹ç»™Dockerçš„å®šä½æ˜¯ä¸€ä¸ª<code>åº”ç”¨å®¹å™¨å¹³å°</code>ã€‚</p><p>Docker æ˜¯ä¸€ä¸ªå®¹å™¨å¹³å°çš„é¢†å¯¼è€… Docker å®¹å™¨å¹³å° Docker åº”ç”¨å®¹å™¨å¹³å°</p><h2 id="1-2-ä¸ºä»€ä¹ˆä½¿ç”¨Docker"><a href="#1-2-ä¸ºä»€ä¹ˆä½¿ç”¨Docker" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆä½¿ç”¨Docker"></a>1.2 ä¸ºä»€ä¹ˆä½¿ç”¨Docker</h2><ul><li><p><code>åˆä½œå¼€å‘çš„æ—¶å€™ï¼Œåœ¨æœ¬æœºå¯ä»¥è·‘ï¼Œåˆ«äººçš„ç”µè„‘è·‘ä¸èµ·æ¥</code></p><p>è¿™é‡Œæˆ‘ä»¬æ‹¿java Webåº”ç”¨ç¨‹åºä¸¾ä¾‹ï¼Œæˆ‘ä»¬ä¸€ä¸ªjava Webåº”ç”¨ç¨‹åºæ¶‰åŠå¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚jdkã€tomcatã€springç­‰ç­‰ã€‚å½“è¿™äº›å…¶ä¸­æŸä¸€é¡¹ç‰ˆæœ¬ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œå¯èƒ½å°±ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºè·‘ä¸èµ·æ¥è¿™ç§æƒ…å†µã€‚Dockeråˆ™å°†ç¨‹åºç›´æ¥æ‰“åŒ…æˆé•œåƒï¼Œç›´æ¥è¿è¡Œåœ¨å®¹å™¨ä¸­å³å¯ã€‚</p></li><li><p><code>æœåŠ¡å™¨è‡ªå·±çš„ç¨‹åºæŒ‚äº†ï¼Œç»“æœå‘ç°æ˜¯åˆ«äººç¨‹åºå‡ºäº†é—®é¢˜æŠŠå†…å­˜åƒå®Œäº†ï¼Œè‡ªå·±ç¨‹åºå› ä¸ºå†…å­˜ä¸å¤Ÿå°±æŒ‚äº†</code></p><p>è¿™ç§ä¹Ÿæ˜¯ä¸€ç§æ¯”è¾ƒå¸¸è§çš„æƒ…å†µï¼Œå¦‚æœä½ çš„ç¨‹åºé‡è¦æ€§ä¸æ˜¯ç‰¹åˆ«é«˜çš„è¯ï¼Œå…¬å¸åŸºæœ¬ä¸Šä¸å¯èƒ½è®©ä½ çš„ç¨‹åºç‹¬äº«ä¸€å°æœåŠ¡å™¨çš„ï¼Œè¿™æ—¶å€™ä½ çš„æœåŠ¡å™¨å°±ä¼šè·Ÿå…¬å¸å…¶ä»–äººçš„ç¨‹åºå…±äº«ä¸€å°æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¸å¯é¿å…åœ°å°±ä¼šå—åˆ°å…¶ä»–ç¨‹åºçš„å¹²æ‰°ï¼Œå¯¼è‡´è‡ªå·±çš„ç¨‹åºå‡ºç°é—®é¢˜ã€‚Dockerå°±å¾ˆå¥½è§£å†³äº†ç¯å¢ƒéš”ç¦»çš„é—®é¢˜ï¼Œåˆ«äººç¨‹åºä¸ä¼šå½±å“åˆ°è‡ªå·±çš„ç¨‹åºã€‚</p></li><li><p><code>å…¬å¸è¦å¼„ä¸€ä¸ªæ´»åŠ¨ï¼Œå¯èƒ½ä¼šæœ‰å¤§é‡çš„æµé‡è¿›æ¥ï¼Œå…¬å¸éœ€è¦å†å¤šéƒ¨ç½²å‡ åå°æœåŠ¡å™¨</code></p><p>åœ¨æ²¡æœ‰Dockerçš„æƒ…å†µä¸‹ï¼Œè¦åœ¨å‡ å¤©å†…éƒ¨ç½²å‡ åå°æœåŠ¡å™¨ï¼Œè¿™å¯¹è¿ç»´æ¥è¯´æ˜¯ä¸€ä»¶éå¸¸æŠ˜ç£¨äººçš„äº‹ï¼Œè€Œä¸”æ¯å°æœåŠ¡å™¨çš„ç¯å¢ƒè¿˜ä¸ä¸€å®šä¸€æ ·ï¼Œå°±ä¼šå‡ºç°å„ç§é—®é¢˜ï¼Œæœ€åéƒ¨ç½²åœ°å¤´çš®å‘éº»ã€‚ç”¨Dockerçš„è¯ï¼Œæˆ‘åªéœ€è¦å°†ç¨‹åºæ‰“åŒ…åˆ°é•œåƒï¼Œä½ è¦å¤šå°‘å°æœåŠ¡ï¼Œæˆ‘å°±ç»™åŠ›è·‘å¤šå°‘å®¹å™¨ï¼Œæå¤§åœ°æé«˜äº†éƒ¨ç½²æ•ˆç‡ã€‚</p></li></ul><h2 id="1-3-Dockerå’Œè™šæ‹Ÿæœºçš„åŒºåˆ«"><a href="#1-3-Dockerå’Œè™šæ‹Ÿæœºçš„åŒºåˆ«" class="headerlink" title="1.3 Dockerå’Œè™šæ‹Ÿæœºçš„åŒºåˆ«"></a>1.3 Dockerå’Œè™šæ‹Ÿæœºçš„åŒºåˆ«</h2><p><img src="https://i.loli.net/2021/06/11/GaDNFPUjYsLkWCM.png"></p><p><code>æ¯”è¾ƒä¸Šé¢ä¸¤å¼ å›¾ï¼Œæˆ‘ä»¬å‘ç°è™šæ‹Ÿæœºæ˜¯æºå¸¦æ“ä½œç³»ç»Ÿï¼Œæœ¬èº«å¾ˆå°çš„åº”ç”¨ç¨‹åºå´å› ä¸ºæºå¸¦äº†æ“ä½œç³»ç»Ÿè€Œå˜å¾—éå¸¸å¤§ï¼Œå¾ˆç¬¨é‡</code>ã€‚Dockeræ˜¯ä¸æºå¸¦æ“ä½œç³»ç»Ÿçš„ï¼Œæ‰€ä»¥Dockerçš„åº”ç”¨å°±éå¸¸çš„è½»å·§ã€‚å¦å¤–åœ¨è°ƒç”¨å®¿ä¸»æœºçš„CPUã€ç£ç›˜ç­‰ç­‰è¿™äº›èµ„æºçš„æ—¶å€™ï¼Œæ‹¿å†…å­˜ä¸¾ä¾‹ï¼Œè™šæ‹Ÿæœºæ˜¯åˆ©ç”¨Hypervisorå»è™šæ‹ŸåŒ–å†…å­˜ï¼Œæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹æ˜¯è™šæ‹Ÿå†…å­˜-&gt;è™šæ‹Ÿç‰©ç†å†…å­˜-&gt;çœŸæ­£ç‰©ç†å†…å­˜ï¼Œä½†æ˜¯Dockeræ˜¯åˆ©ç”¨Docker Engineå»è°ƒç”¨å®¿ä¸»çš„çš„èµ„æºï¼Œè¿™æ—¶å€™è¿‡ç¨‹æ˜¯è™šæ‹Ÿå†…å­˜-&gt;çœŸæ­£ç‰©ç†å†…å­˜ã€‚</p><table><thead><tr><th></th><th>ä¼ ç»Ÿè™šæ‹Ÿæœº</th><th>Dockerå®¹å™¨</th></tr></thead><tbody><tr><td>ç£ç›˜å ç”¨</td><td>å‡ ä¸ªGBåˆ°å‡ åä¸ªGBå·¦å³</td><td>å‡ åMBåˆ°å‡ ç™¾MBå·¦å³</td></tr><tr><td>CPUå†…å­˜å ç”¨</td><td>è™šæ‹Ÿæ“ä½œç³»ç»Ÿéå¸¸å ç”¨CPUå’Œå†…å­˜</td><td>Dockerå¼•æ“å ç”¨æä½</td></tr><tr><td>å¯åŠ¨é€Ÿåº¦</td><td>ï¼ˆä»å¼€æœºåˆ°è¿è¡Œé¡¹ç›®ï¼‰å‡ åˆ†é’Ÿ</td><td>ï¼ˆä»å¼€å¯å®¹å™¨åˆ°è¿è¡Œé¡¹ç›®ï¼‰å‡ ç§’</td></tr><tr><td>å®‰è£…ç®¡ç†</td><td>éœ€è¦ä¸“é—¨çš„è¿ç»´æŠ€æœ¯</td><td>å®‰è£…ã€ç®¡ç†æ–¹ä¾¿</td></tr><tr><td>åº”ç”¨éƒ¨ç½²</td><td>æ¯æ¬¡éƒ¨ç½²éƒ½è´¹æ—¶è´¹åŠ›</td><td>ä»ç¬¬äºŒæ¬¡éƒ¨ç½²å¼€å§‹è½»æ¾ç®€æ·</td></tr><tr><td>è€¦åˆæ€§</td><td>å¤šä¸ªåº”ç”¨æœåŠ¡å®‰è£…åˆ°ä¸€èµ·ï¼Œå®¹æ˜“äº’ç›¸å½±å“</td><td>æ¯ä¸ªåº”ç”¨æœåŠ¡ä¸€ä¸ªå®¹å™¨ï¼Œè¾¾æˆéš”ç¦»</td></tr><tr><td>ç³»ç»Ÿä¾èµ–</td><td>æ— </td><td>éœ€æ±‚ç›¸åŒæˆ–ç›¸ä¼¼çš„å†…æ ¸ï¼Œç›®å‰æ¨èæ˜¯Linux</td></tr></tbody></table><h2 id="1-4-Docker-çš„æ ¸å¿ƒ"><a href="#1-4-Docker-çš„æ ¸å¿ƒ" class="headerlink" title="1.4 Docker çš„æ ¸å¿ƒ"></a>1.4 Docker çš„æ ¸å¿ƒ</h2><p><img src="https://i.loli.net/2021/06/11/BYIR9lyPEAe2MXK.png"></p><ul><li><code>é•œåƒ:</code> ä¸€ä¸ªé•œåƒä»£è¡¨ä¸€ä¸ªåº”ç”¨ç¯å¢ƒ,ä»–æ˜¯ä¸€ä¸ªåªè¯»çš„æ–‡ä»¶,å¦‚ mysqlé•œåƒ,tomcaté•œåƒ,nginxé•œåƒç­‰</li><li><code>å®¹å™¨:</code> é•œåƒæ¯æ¬¡è¿è¡Œä¹‹åå°±æ˜¯äº§ç”Ÿä¸€ä¸ªå®¹å™¨,å°±æ˜¯æ­£åœ¨è¿è¡Œçš„é•œåƒ,ç‰¹ç‚¹å°±æ˜¯å¯è¯»å¯å†™</li><li><code>ä»“åº“:</code>ç”¨æ¥å­˜æ”¾é•œåƒçš„ä½ç½®,ç±»ä¼¼äºmavenä»“åº“,ä¹Ÿæ˜¯é•œåƒä¸‹è½½å’Œä¸Šä¼ çš„ä½ç½®</li><li><code>dockerFile:</code>dockerç”Ÿæˆé•œåƒé…ç½®æ–‡ä»¶,ç”¨æ¥ä¹¦å†™è‡ªå®šä¹‰é•œåƒçš„ä¸€äº›é…ç½®</li><li><code>tar:</code>ä¸€ä¸ªå¯¹é•œåƒæ‰“åŒ…çš„æ–‡ä»¶,æ—¥åå¯ä»¥è¿˜åŸæˆé•œåƒ</li></ul><h1 id="2-Dockerå¸¸ç”¨æ“ä½œï¼ˆcentos7-Xï¼‰"><a href="#2-Dockerå¸¸ç”¨æ“ä½œï¼ˆcentos7-Xï¼‰" class="headerlink" title="2. Dockerå¸¸ç”¨æ“ä½œï¼ˆcentos7.Xï¼‰"></a>2. Dockerå¸¸ç”¨æ“ä½œï¼ˆcentos7.Xï¼‰</h1><h2 id="2-1-Dockerçš„å®‰è£…"><a href="#2-1-Dockerçš„å®‰è£…" class="headerlink" title="2.1 Dockerçš„å®‰è£…"></a>2.1 Dockerçš„å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell">1ã€æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬ï¼Œå¿…é¡»æ˜¯3.10åŠä»¥ä¸Š<br>uname â€r<br>2ã€å®‰è£…docker<br>yum install docker<br>3ã€è¾“å…¥yç¡®è®¤å®‰è£…<br>4ã€å¯åŠ¨docker<br>[root@localhost ~]# systemctl start docker<br>[root@localhost ~]# docker â€v<br>Docker version 1.13.1, build 7d71120/1.13.1<br>5ã€å¼€æœºå¯åŠ¨docker<br>[root@localhost ~]# systemctl enable docker<br>Created symlink from /etc/systemd/system/multiâ€user.target.wants/docker.service to<br>/usr/lib/systemd/system/docker.service.<br>6ã€åœæ­¢docker<br>systemctl stop docker<br>7ã€é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ<br>mkdir -p /etc/docker<br>vim /etc/docker/daemon.json<br>&#123;<br>&quot;registry-mirrors&quot;: [&quot;https://77t1qhyj.mirror.aliyuncs.com&quot;]<br>&#125;<br>systemctl daemon-reload<br>systemctl restart docker<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯Dockeråªé€‚åˆlinuxå†…æ ¸ç‰ˆæœ¬åœ¨3.10åŠä»¥ä¸Šçš„ï¼Œæˆ‘ç”¨çš„centosï¼Œé‚£å°±éœ€è¦7.Xï¼Œæ‰€ä»¥ä¹‹å‰çš„centos6.Xå°±ä¸è¡Œäº†ã€‚</p><p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šè®¾ç½®å¼€æœºå¯åŠ¨Dockerï¼Œå‡å¦‚æ˜¯æœ¬åœ°çš„è™šæ‹Ÿæœºå°±éœ€è¦ä¿®æ”¹é•œåƒæ‹‰å–åœ°å€ï¼Œä¸ç„¶dockerå®˜æ–¹çš„é•œåƒåœ°å€å°±å¾ˆæ…¢äº†ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å¤±è´¥ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨é˜¿é‡Œäº‘çš„é•œåƒåŠ é€Ÿï¼Œåœ¨é˜¿é‡Œäº‘é‡Œæœç´¢é•œåƒåŠ é€Ÿå³å¯æ‰¾åˆ°ã€‚</p><p>è‹¥æ˜¯ç”¨åˆ°äº‘æœåŠ¡å™¨ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘ï¼Œè…¾è®¯äº‘å°±ä¸éœ€è¦äº†~</p><p>é…ç½®å®Œè®°å¾—é‡æ–°åŠ è½½é…ç½®ï¼Œå†é‡å¯ä¸‹Dockerå³å¯ã€‚</p><p>å¯åŠ¨Docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl start docker<br></code></pre></td></tr></table></figure><p>å…³é—­Docker</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">systemctl stop docker<br></code></pre></td></tr></table></figure><h2 id="2-2-Dockerçš„å¸¸ç”¨æ“ä½œ"><a href="#2-2-Dockerçš„å¸¸ç”¨æ“ä½œ" class="headerlink" title="2.2 Dockerçš„å¸¸ç”¨æ“ä½œ"></a>2.2 Dockerçš„å¸¸ç”¨æ“ä½œ</h2><ol><li>é•œåƒæ“ä½œ</li></ol><table><thead><tr><th>æ“ä½œ</th><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ£€ç´¢</td><td>docker search å…³é”®å­— eg:docker search redis</td><td>å¯ä»¥å»Docker HubæŸ¥æ‰¾é•œåƒçš„è¯¦ç»†ä¿¡æ¯</td></tr><tr><td>æ‹‰å–</td><td>docker pull é•œåƒåï¼štag</td><td>ï¼štagæ˜¯å¯ä»¥é€‰çš„ï¼Œè¡¨ç¤ºæ ‡ç­¾ï¼Œå¤šä¸ºç‰ˆæœ¬å·ï¼Œå¦‚æœçœç•¥ï¼Œå³ä¸ºlatest</td></tr><tr><td>åˆ—è¡¨</td><td>docker images</td><td>æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰é•œåƒ</td></tr><tr><td>åˆ é™¤</td><td>docker rmi image-id</td><td>åˆ é™¤æŒ‡å®šçš„æœ¬åœ°é•œåƒ</td></tr></tbody></table><p>2.å®¹å™¨æ“ä½œ</p><p>ä»ä¸Šæ–‡æˆ‘ä»¬å°±å·²ç»çŸ¥é“Dockeræ˜¯å®¹å™¨åº”ç”¨å¹³å°ï¼Œé‚£ä»€ä¹ˆæ˜¯å®¹å™¨å‘¢ï¼Ÿ</p><p>ç®€å•çš„æ¥è¯´ï¼Œå°±æ˜¯è¿è¡Œèµ·æ¥çš„é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">1.è¿è¡Œå®¹å™¨</span><br>docker run é•œåƒå -------------------------- é•œåƒåæ–°å»ºå¹¶å¯åŠ¨å®¹å™¨<br>--name åˆ«åä¸ºå®¹å™¨èµ·ä¸€ä¸ªåå­—<br>-d å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨ï¼ˆåœ¨åå°å¯åŠ¨å®¹å™¨ï¼‰<br>-p æ˜ å°„ç«¯å£å·ï¼šåŸå§‹ç«¯å£å· æŒ‡å®šç«¯å£å·å¯åŠ¨<br>ä¾‹ï¼šdocker run -it --name myTomcat -p 8888:8080 tomcat<br>docker run -d --name myTomcat -P tomcat<br><span class="hljs-meta prompt_"># </span><span class="language-bash">2.æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨</span><br>docker ps -------------------------- åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨<br>-a æ­£åœ¨è¿è¡Œçš„å’Œå†å²è¿è¡Œè¿‡çš„å®¹å™¨<br>-q é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·<br><span class="hljs-meta prompt_"># </span><span class="language-bash">3.åœæ­¢|å…³é—­|é‡å¯å®¹å™¨</span><br>docker start å®¹å™¨åå­—æˆ–è€…å®¹å™¨id --------------- å¼€å¯å®¹å™¨<br>docker restart å®¹å™¨åæˆ–è€…å®¹å™¨id --------------- é‡å¯å®¹å™¨<br>docker stop å®¹å™¨åæˆ–è€…å®¹å™¨id ------------------ æ­£å¸¸åœæ­¢å®¹å™¨è¿è¡Œ<br>docker kill å®¹å™¨åæˆ–è€…å®¹å™¨id ------------------ ç«‹å³åœæ­¢å®¹å™¨è¿è¡Œ<br><span class="hljs-meta prompt_"># </span><span class="language-bash">4.åˆ é™¤å®¹å™¨</span><br>docker rm -f å®¹å™¨idå’Œå®¹å™¨å<br>docker rm -f $(docker ps -aq) -------------------------- åˆ é™¤æ‰€æœ‰å®¹å™¨<br><span class="hljs-meta prompt_"># </span><span class="language-bash">5.æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹</span><br>docker top å®¹å™¨idæˆ–è€…å®¹å™¨å ------------------ æŸ¥çœ‹å®¹å™¨å†…çš„è¿›ç¨‹<br><span class="hljs-meta prompt_"># </span><span class="language-bash">6.æŸ¥çœ‹æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚</span><br>docker inspect å®¹å™¨id ------------------ æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚<br><span class="hljs-meta prompt_"># </span><span class="language-bash">7.æŸ¥çœ‹å®¹å™¨çš„è¿è¡Œæ—¥å¿—</span><br>docker logs [OPTIONS] å®¹å™¨idæˆ–å®¹å™¨å ------------------ æŸ¥çœ‹å®¹å™¨æ—¥å¿—<br>-t åŠ å…¥æ—¶é—´æˆ³<br>-f è·Ÿéšæœ€æ–°çš„æ—¥å¿—æ‰“å°<br>--tail æ•°å­— æ˜¾ç¤ºæœ€åå¤šå°‘æ¡<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä»¥å®‰è£…Tomcatä¸ºä¾‹ï¼Œè®°å½•æ“ä½œå…¨è¿‡ç¨‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨Docker Hubä¸ŠæŸ¥æ‰¾è‡ªå·±éœ€è¦çš„Tomcatç‰ˆæœ¬ï¼Œç”±äºTomcatéœ€è¦JDKç¯å¢ƒï¼Œæ‰€ä»¥ä¸‹è½½çš„é•œåƒä¸­åŒ…å«JDKï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ‹‰å–å‘½ä»¤å³å¯</span><br>[root@hspEdu01 ~]# docker pull tomcat:9.0.46-jdk8<br>Trying to pull repository docker.io/library/tomcat ...<br>9.0.46-jdk8: Pulling from docker.io/library/tomcat<br>d960726af2be: Pull complete<br>e8d62473a22d: Pull complete<br>8962bc0fad55: Pull complete<br>65d943ee54c1: Pull complete<br>da20b77f10ac: Pull complete<br>fb6a778e6477: Pull complete<br>ae7884f0e61b: Pull complete<br>5a229cc6592e: Pull complete<br>efb3915175c2: Pull complete<br>805021669e73: Pull complete<br>Digest: sha256:36c2088c48cb29bb093abce58527259fe70f7feaccc3820cdbf1ca21caa76785<br>Status: Downloaded newer image for docker.io/tomcat:9.0.46-jdk8<br>[root@hspEdu01 ~]# docker images<br>REPOSITORY TAG IMAGE ID CREATED SIZE<br>docker.io/tomcat 9.0.46-jdk8 7253c7ce0ab9 4 weeks ago 534 MB<br>[root@hspEdu01 ~]# docker run -d -p 8080:8080 --name tomcat01 7253c7ce0ab9<br>a3ec9a313973f624836fc5caf46b001d7fd3c1d8932c33702730e010870d142b<br>[root@hspEdu01 ~]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES<br>a3ec9a313973 7253c7ce0ab9 &quot;catalina.sh run&quot; 5 seconds ago Up 3 seconds 0.0.0.0:8080-&gt;8080/tcp tomcat01<br>[root@hspEdu01 ~]#<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰“å¼€æµè§ˆå™¨ è®¿é—®http://192.168.27.129:8080/ å‡ºç°tomcatï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span><br>[root@hspEdu01 ~]# docker logs -f a3ec<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿›å»å®¹å™¨</span><br>[root@hspEdu01 ~]# docker exec -it a3ec bash<br>root@a3ec9a313973:/usr/local/tomcat# ls<br>BUILDING.txt LICENSE README.md RUNNING.txt conf logs temp webapps.dist<br>CONTRIBUTING.md NOTICE RELEASE-NOTES bin lib native-jni-lib webapps work<br>root@a3ec9a313973:/usr/local/tomcat# cd webapps<br>root@a3ec9a313973:/usr/local/tomcat/webapps# ls<br>root@a3ec9a313973:/usr/local/tomcat/webapps# cd ../conf<br>root@a3ec9a313973:/usr/local/tomcat/conf# ls<br>Catalina catalina.properties jaspic-providers.xml logging.properties tomcat-users.xml web.xml<br>catalina.policy context.xml jaspic-providers.xsd server.xml tomcat-users.xsd<br>root@a3ec9a313973:/usr/local/tomcat/conf# vim server.xml<br>bash: vim: command not found<br>root@a3ec9a313973:/usr/local/tomcat/conf# exit<br>exit<br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œå‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ¨ç½²tomcaté¡¹ç›®ï¼Œéƒ½æ˜¯æŠŠé¡¹ç›®æ‹·è´åˆ°webappsä¸‹ï¼Œtomcatå³å¯è‡ªå¸¦è§£æè¿è¡Œé¡¹ç›®ï¼Œä½†æˆ‘ä»¬æœ‰æ—¶å€™è¿˜éœ€è¦é…ç½®ä¸‹é»˜è®¤ç«¯å£ï¼Œ8080-&gt;80ï¼Œé»˜è®¤è®¿é—®è·¯å¾„ï¼Œå°±éœ€è¦ä¿®æ”¹server.xmlï¼Œweb.xmlï¼Œä½†æˆ‘ä»¬å‘ç°ç”¨vimå¹¶ä¸è¡Œï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦ä½¿ç”¨å‘½ä»¤è¿›å®¹å™¨ï¼Œå°±ç‰¹åˆ«ä¸æ–¹ä¾¿ï¼Œè€Œä¸”å®¹å™¨ä¸€æ—¦è¢«åˆ é™¤ï¼Œæ•°æ®ä¹Ÿæ²¡äº†ã€‚</p><p>è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥é€‰æ‹©æ•°æ®å·çš„æ–¹å¼ï¼Œè®©å®¹å™¨å’Œå®¿ä¸»æœºå»ºç«‹ç›´æ¥çš„ç‰©ç†ç®¡ç†ï¼Œç¬¬ä¸€æ˜¯æ–¹ä¾¿æ“ä½œï¼Œç¬¬äºŒæ˜¯å¯ä»¥å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ï¼Œæ¯”å¦‚Mysqlçš„æ•°æ®åº“</p><p>æ•°æ®å·ä¹Ÿå¾ˆç®€å•ï¼Œä¸€èˆ¬æ˜¯ä¸¤ç§ï¼š</p><ul><li>ç›´æ¥å‘½åæ•°æ®å·ï¼Œè®©Dockerå»åˆ›å»º</li><li>æŠŠå®¹å™¨ä½ç½®å’Œå®¿ä¸»æœºæ–‡ä»¶ç›®å½•å»ºç«‹è”ç³»</li></ul><p>ä¸¤è€…å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œæˆ‘ä»¬éƒ½è¯•è¯•å§</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hspEdu01 ~]# docker rm -f a3ec<br>a3ec<br>[root@hspEdu01 ~]# docker run -d -p 8080:8080 -v webapps:/usr/local/tomcat/webapps -v webconf:/usr/local/tomcat/conf --name tomcat 7253c7ce0ab9<br>21795689b90c0447b10250fd3b36b96232188b4f16c88f14a434469cd4e33f0f<br>[root@hspEdu01 ~]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES<br>21795689b90c 7253c7ce0ab9 &quot;catalina.sh run&quot; 3 seconds ago Up 2 seconds 0.0.0.0:8080-&gt;8080/tcp tomcat<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰æ•°æ®å·</span><br>[root@hspEdu01 ~]# docker volume ls<br>DRIVER VOLUME NAME<br>local webapps<br>local webconf<br>[root@hspEdu01 ~]# docker inspect webapps<br>[<br>&#123;<br>&quot;Driver&quot;: &quot;local&quot;,<br>&quot;Labels&quot;: null,<br>&quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/webapps/\_data&quot;,<br>&quot;Name&quot;: &quot;webapps&quot;,<br>&quot;Options&quot;: &#123;&#125;,<br>&quot;Scope&quot;: &quot;local&quot;<br>&#125;<br>]<br>[root@hspEdu01 ~]# cd /var/lib/docker/volumes/webapps/\_data<br>[root@hspEdu01 \_data]# ls<br>[root@hspEdu01 \_data]# touch a.html<br>[root@hspEdu01 \_data]# vim a.html<br>[root@hspEdu01 \_data]# cat a.html<br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta charset=&quot;utf-8&quot;&gt;<br>&lt;title&gt;&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h3&gt;Tomcat&lt;/h3&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br>[root@hspEdu01 \_data]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES<br>21795689b90c 7253c7ce0ab9 &quot;catalina.sh run&quot; 2 minutes ago Up 2 minutes 0.0.0.0:8080-&gt;8080/tcp tomcat<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨</span><br>[root@hspEdu01 \_data]# docker exec -it 2179 bash<br>root@21795689b90c:/usr/local/tomcat# ls<br>BUILDING.txt CONTRIBUTING.md LICENSE NOTICE README.md RELEASE-NOTES RUNNING.txt bin conf lib logs native-jni-lib temp webapps webapps.dist work<br>root@21795689b90c:/usr/local/tomcat# cd webapps<br>root@21795689b90c:/usr/local/tomcat/webapps# ls<br>a.html<br>root@21795689b90c:/usr/local/tomcat/webapps# exit<br>exit<br>[root@hspEdu01 \_data]# docker restart 2179<br>2179<br>[root@hspEdu01 \_data]# docker inspect webconf<br>[<br>&#123;<br>&quot;Driver&quot;: &quot;local&quot;,<br>&quot;Labels&quot;: null,<br>&quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/webconf/\_data&quot;,<br>&quot;Name&quot;: &quot;webconf&quot;,<br>&quot;Options&quot;: &#123;&#125;,<br>&quot;Scope&quot;: &quot;local&quot;<br>&#125;<br>]<br>[root@hspEdu01 \_data]# cd /var/lib/docker/volumes/webconf/\_data<br>[root@hspEdu01 \_data]# ls<br>Catalina catalina.properties jaspic-providers.xml logging.properties tomcat-users.xml web.xml<br>catalina.policy context.xml jaspic-providers.xsd server.xml tomcat-users.xsd<br>[root@hspEdu01 \_data]#<br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œå®¿ä¸»æœºï¼Œå·²ç»å’Œå®¹å™¨ç›®å½•å»ºç«‹è”ç³»ï¼Œä¸‹é¢åªæ˜¯æŠŠå·¦è¾¹çš„wenappsæ”¹æˆå®¿ä¸»æœºçš„æ–‡ä»¶å¤¹å³å¯</p><p>ç°åœ¨æˆ‘ä»¬æ¥è£…ä¸‹mysqlï¼Œä¸ä»…æ¶‰åŠåˆ°æ•°æ®å·ï¼Œè¿˜æ¶‰åŠåˆ°ç”¨æˆ·è´¦å·çš„è®¾ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hspEdu01 data]# docker run --name mysql -v /root/mysql/data:/var/lib/mysql -v /root/mysql/conf.d:/etc/mysql/conf.d -e MYSQL\_ROOT\_PASSWORD=root -p 3306:3306 --privileged=true -d mysql:5.7<br>95628d5d89c5c1513e1046bb19181007c2dfc43ea1f3132472ff57f4453fda7b<br>[root@hspEdu01 data]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES<br>95628d5d89c5 mysql:5.7 &quot;docker-entrypoint...&quot; 3 seconds ago Up 2 seconds 0.0.0.0:3306-&gt;3306/tcp, 33060/tcp mysql<br>[root@hspEdu01 data]# cd /root<br>[root@hspEdu01 ~]# ls<br>anaconda-ks.cfg data data2 initial-setup-ks.cfg mysql å…¬å…± æ¨¡æ¿ è§†é¢‘ å›¾ç‰‡ æ–‡æ¡£ ä¸‹è½½ éŸ³ä¹ æ¡Œé¢<br>[root@hspEdu01 ~]# cd mysql/<br>[root@hspEdu01 mysql]# ls<br>conf.d data<br>[root@hspEdu01 mysql]# cd conf.d/<br>[root@hspEdu01 conf.d]# ls<br>[root@hspEdu01 conf.d]# cd ../data/<br>[root@hspEdu01 data]# ls<br>auto.cnf ca.pem client-key.pem ibdata1 ib\_logfile1 mysql private\_key.pem server-cert.pem sys<br>ca-key.pem client-cert.pem ib\_buffer\_pool ib\_logfile0 ibtmp1 performance\_schema public\_key.pem server-key.pem<br>[root@hspEdu01 data]#<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç¡®å®šæŠŠmysqlçš„é…ç½®ç›®å½•å’Œæ•°æ®åº“å­˜å‚¨ç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœºäº†ï¼Œæˆ‘ä»¬ç”¨navicatæµ‹è¯•ï¼Œè¿æ¥æˆåŠŸï¼</p><p>ä¸ºä»€ä¹ˆè¦æŠŠmysqlå®¹å™¨çš„dataæŒ‚è½½å‡ºå»å‘¢ï¼Ÿå› ä¸ºå®¹å™¨æ˜¯ä¸ä¸ºåº”ç”¨æä¾›ä»»ä½•æŒä¹…åŒ–æ“ä½œçš„ï¼Œä¸€æ—¦å®¹å™¨å…³é—­ï¼Œæ•°æ®ä¹Ÿæ²¡äº†ï¼Œå‡å¦‚æ˜¯è¿™æ ·ï¼Œæ•°æ®åº“å­˜åœ¨çš„æ„ä¹‰ä¹Ÿå°±æ²¡äº†ï¼Œæ‰€ä»¥éœ€è¦æŠŠä¹Ÿæ˜¯å¿…é¡»æŠŠæ•°æ®åº“çš„å­˜å‚¨æ•°æ®çš„æ–‡ä»¶å¤¹æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Šã€‚</p><p>åŸºæœ¬ä¸Šé•œåƒçš„å¯åŠ¨ä¹Ÿå°±åªéœ€è¦æ³¨æ„ç«¯å£æ˜ å°„ï¼Œæ•°æ®å·çš„è®¾ç½®ï¼Œç”¨æˆ·è´¦å·å¯†ç çš„è®¾ç½®ï¼Œå…¶å®ƒçš„å¯ä»¥å‚è€ƒDocker Hubä¸­ï¼Œå¯¹ç›¸åº”é•œåƒå¯åŠ¨éƒ½ç»™å‡ºäº†å‚è€ƒã€‚</p><p>æ³¨ï¼šâ€“privileged&#x3D;true æ˜¯ç”±äºæƒé™é—®é¢˜ï¼Œéœ€è¦å¸¦å…¥æƒé™æ‰èƒ½æ­£å¸¸å¯åŠ¨ï¼Œå‡å¦‚ä½ èƒ½æ­£å¸¸å¯åŠ¨ï¼Œå°±ä¸éœ€è¦å¸¦è¿™ä¸ªå‚æ•°</p><h1 id="3-Dockerfile"><a href="#3-Dockerfile" class="headerlink" title="3. Dockerfile"></a>3. Dockerfile</h1><h2 id="3-1ä»€ä¹ˆæ˜¯Docerfile"><a href="#3-1ä»€ä¹ˆæ˜¯Docerfile" class="headerlink" title="3.1ä»€ä¹ˆæ˜¯Docerfile"></a>3.1ä»€ä¹ˆæ˜¯Docerfile</h2><p>Dockerfileå¯ä»¥è®¤ä¸ºæ˜¯<strong>Dockeré•œåƒçš„æè¿°æ–‡ä»¶ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬</strong>ã€‚ä¸»è¦ä½œç”¨æ˜¯<strong>ç”¨æ¥æ„å»ºdockeré•œåƒçš„æ„å»ºæ–‡ä»¶</strong></p><p><img src="https://i.loli.net/2021/06/11/BYIR9lyPEAe2MXK.png"></p><p>é€šè¿‡æ¶æ„å›¾å¯ä»¥çœ‹å‡ºé€šè¿‡DockerFileå¯ä»¥ç›´æ¥æ„å»ºé•œåƒ</p><h2 id="3-2-Dockerfileè§£æè¿‡ç¨‹"><a href="#3-2-Dockerfileè§£æè¿‡ç¨‹" class="headerlink" title="3.2 Dockerfileè§£æè¿‡ç¨‹"></a>3.2 Dockerfileè§£æè¿‡ç¨‹</h2><p><img src="https://i.loli.net/2021/06/12/poNADCTSGsbuBUv.png"></p><h2 id="3-3-Dockerfileçš„ä¿ç•™å‘½ä»¤"><a href="#3-3-Dockerfileçš„ä¿ç•™å‘½ä»¤" class="headerlink" title="3.3 Dockerfileçš„ä¿ç•™å‘½ä»¤"></a>3.3 Dockerfileçš„ä¿ç•™å‘½ä»¤</h2><p>å®˜æ–¹è¯´æ˜:<a href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p><table><thead><tr><th>ä¿ç•™å­—</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>FROM</strong></td><td><strong>å½“å‰é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„</strong> <code>ç¬¬ä¸€ä¸ªæŒ‡ä»¤å¿…é¡»æ˜¯FROM</code></td></tr><tr><td>MAINTAINER</td><td>é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€</td></tr><tr><td><strong>RUN</strong></td><td><strong>æ„å»ºé•œåƒæ—¶éœ€è¦è¿è¡Œçš„æŒ‡ä»¤</strong></td></tr><tr><td><strong>EXPOSE</strong></td><td><strong>å½“å‰å®¹å™¨å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£å·</strong></td></tr><tr><td><strong>WORKDIR</strong></td><td><strong>æŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»å½•è¿›æ¥çš„å·¥ä½œç›®å½•ï¼Œä¸€ä¸ªè½è„šç‚¹</strong></td></tr><tr><td><strong>ENV</strong></td><td><strong>ç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡</strong></td></tr><tr><td><strong>ADD</strong></td><td><strong>å°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒä¸”ADDå‘½ä»¤ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹taråŒ…</strong></td></tr><tr><td><strong>COPY</strong></td><td><strong>ç±»ä¼¼äºADDï¼Œæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­ å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­&lt;åŸè·¯å¾„&gt;çš„æ–‡ä»¶&#x2F;ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„&lt;ç›®æ ‡è·¯å¾„&gt;ä½ç½®</strong></td></tr><tr><td><strong>VOLUME</strong></td><td><strong>å®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œ</strong></td></tr><tr><td><strong>CMD</strong></td><td><strong>æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ Dockerfileä¸­å¯ä»¥æœ‰å¤šä¸ªCMDæŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼ŒCMDä¼šè¢«docker runä¹‹åçš„å‚æ•°æ›¿æ¢</strong></td></tr><tr><td><strong>ENTRYPOINT</strong></td><td><strong>æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ ENTRYPOINTçš„ç›®çš„å’ŒCMDä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨æŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºåŠå…¶å‚æ•°</strong></td></tr></tbody></table><h4 id="3-3-1-FROM-å‘½ä»¤"><a href="#3-3-1-FROM-å‘½ä»¤" class="headerlink" title="3.3.1 FROM å‘½ä»¤"></a>3.3.1 FROM å‘½ä»¤</h4><ul><li><p>åŸºäºé‚£ä¸ªé•œåƒè¿›è¡Œæ„å»ºæ–°çš„é•œåƒ,åœ¨æ„å»ºæ—¶ä¼šè‡ªåŠ¨ä»docker hubæ‹‰å–baseé•œåƒ å¿…é¡»ä½œä¸ºDockerfileçš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤å‡ºç°</p></li><li><p>è¯­æ³•:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> &lt;image&gt;<br><span class="hljs-keyword">FROM</span> &lt;image&gt;[:&lt;tag&gt;] ä½¿ç”¨ç‰ˆæœ¬ä¸å†™ä¸ºlatest<br><span class="hljs-keyword">FROM</span> &lt;image&gt;[@&lt;digest&gt;] ä½¿ç”¨æ‘˜è¦<br></code></pre></td></tr></table></figure></li></ul><h4 id="3-3-2-MAINTAINER-å‘½ä»¤"><a href="#3-3-2-MAINTAINER-å‘½ä»¤" class="headerlink" title="3.3.2 MAINTAINER å‘½ä»¤"></a>3.3.2 MAINTAINER å‘½ä»¤</h4><ul><li><p>é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€[åºŸå¼ƒ]</p></li><li><p>è¯­æ³•:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">MAINTAINER</span> &lt;name&gt;<br></code></pre></td></tr></table></figure></li></ul><h4 id="3-3-3-RUN-å‘½ä»¤"><a href="#3-3-3-RUN-å‘½ä»¤" class="headerlink" title="3.3.3 RUN å‘½ä»¤"></a>3.3.3 RUN å‘½ä»¤</h4><ul><li><p>RUNæŒ‡ä»¤å°†åœ¨å½“å‰æ˜ åƒä¹‹ä¸Šçš„æ–°å±‚ä¸­æ‰§è¡Œä»»ä½•å‘½ä»¤å¹¶æäº¤ç»“æœã€‚ç”Ÿæˆçš„æäº¤æ˜ åƒå°†ç”¨äºDockerfileä¸­çš„ä¸‹ä¸€æ­¥</p></li><li><p>è¯­æ³•:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">RUN</span><span class="language-bash"> &lt;<span class="hljs-built_in">command</span>&gt; (shell form, the <span class="hljs-built_in">command</span> is run <span class="hljs-keyword">in</span> a shell, <span class="hljs-built_in">which</span> by default is /bin/sh -c on Linux or cmd /S /C on Windows)</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> hello</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> [<span class="hljs-string">&quot;executable&quot;</span>, <span class="hljs-string">&quot;param1&quot;</span>, <span class="hljs-string">&quot;param2&quot;</span>] (<span class="hljs-built_in">exec</span> form)</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> [<span class="hljs-string">&quot;/bin/bash&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;echo hello&quot;</span>]</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="3-3-4-EXPOSE-å‘½ä»¤"><a href="#3-3-4-EXPOSE-å‘½ä»¤" class="headerlink" title="3.3.4 EXPOSE å‘½ä»¤"></a>3.3.4 EXPOSE å‘½ä»¤</h4><ul><li><p>ç”¨æ¥æŒ‡å®šæ„å»ºçš„é•œåƒåœ¨è¿è¡Œä¸ºå®¹å™¨æ—¶å¯¹å¤–æš´éœ²çš„ç«¯å£</p></li><li><p>è¯­æ³•:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span>/tcp å¦‚æœæ²¡æœ‰æ˜¾ç¤ºæŒ‡å®šåˆ™é»˜è®¤æš´éœ²éƒ½æ˜¯tcp<br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span>/udp<br></code></pre></td></tr></table></figure></li></ul><h4 id="3-3-5-CMD-å‘½ä»¤"><a href="#3-3-5-CMD-å‘½ä»¤" class="headerlink" title="3.3.5 CMD å‘½ä»¤"></a>3.3.5 CMD å‘½ä»¤</h4><ul><li><p>ç”¨æ¥ä¸ºå¯åŠ¨çš„å®¹å™¨æŒ‡å®šæ‰§è¡Œçš„å‘½ä»¤,åœ¨Dockerfileä¸­åªèƒ½æœ‰ä¸€æ¡CMDæŒ‡ä»¤ã€‚å¦‚æœåˆ—å‡ºå¤šä¸ªå‘½ä»¤ï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ªå‘½ä»¤æ‰ä¼šç”Ÿæ•ˆã€‚</p></li><li><p>æ³¨æ„: <strong>Dockerfileä¸­åªèƒ½æœ‰ä¸€æ¡CMDæŒ‡ä»¤ã€‚å¦‚æœåˆ—å‡ºå¤šä¸ªå‘½ä»¤ï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ªå‘½ä»¤æ‰ä¼šç”Ÿæ•ˆã€‚</strong></p></li><li><p>è¯­æ³•:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;executable&quot;</span>,<span class="hljs-string">&quot;param1&quot;</span>,<span class="hljs-string">&quot;param2&quot;</span>] (<span class="hljs-built_in">exec</span> form, this is the preferred form)</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;param1&quot;</span>,<span class="hljs-string">&quot;param2&quot;</span>] (as default parameters to ENTRYPOINT)</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> <span class="hljs-built_in">command</span> param1 param2 (shell form)</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="3-3-6-WORKDIR-å‘½ä»¤"><a href="#3-3-6-WORKDIR-å‘½ä»¤" class="headerlink" title="3.3.6 WORKDIR å‘½ä»¤"></a>3.3.6 WORKDIR å‘½ä»¤</h4><ul><li><p>ç”¨æ¥ä¸ºDockerfileä¸­çš„ä»»ä½•RUNã€CMDã€ENTRYPOINTã€COPYå’ŒADDæŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•ã€‚å¦‚æœWORKDIRä¸å­˜åœ¨ï¼Œå³ä½¿å®ƒæ²¡æœ‰åœ¨ä»»ä½•åç»­DockerfileæŒ‡ä»¤ä¸­ä½¿ç”¨ï¼Œå®ƒä¹Ÿå°†è¢«åˆ›å»ºã€‚</p></li><li><p>è¯­æ³•:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /path/to/workdir</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /a</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> b</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> c</span><br>`æ³¨æ„:<span class="hljs-keyword">WORKDIR</span><span class="language-bash">æŒ‡ä»¤å¯ä»¥åœ¨Dockerfileä¸­å¤šæ¬¡ä½¿ç”¨ã€‚å¦‚æœæä¾›äº†ç›¸å¯¹è·¯å¾„ï¼Œåˆ™è¯¥è·¯å¾„å°†ä¸å…ˆå‰WORKDIRæŒ‡ä»¤çš„è·¯å¾„ç›¸å¯¹`</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="3-3-7-ENV-å‘½ä»¤"><a href="#3-3-7-ENV-å‘½ä»¤" class="headerlink" title="3.3.7 ENV å‘½ä»¤"></a>3.3.7 ENV å‘½ä»¤</h4><ul><li><p>ç”¨æ¥ä¸ºæ„å»ºé•œåƒè®¾ç½®ç¯å¢ƒå˜é‡ã€‚è¿™ä¸ªå€¼å°†å‡ºç°åœ¨æ„å»ºé˜¶æ®µä¸­æ‰€æœ‰åç»­æŒ‡ä»¤çš„ç¯å¢ƒä¸­ã€‚</p></li><li><p>è¯­æ³•ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ENV</span> &lt;key&gt; &lt;value&gt;<br><span class="hljs-keyword">ENV</span> &lt;key&gt;=&lt;value&gt; ...<br></code></pre></td></tr></table></figure></li></ul><h4 id="3-3-8-ADD-å‘½ä»¤"><a href="#3-3-8-ADD-å‘½ä»¤" class="headerlink" title="3.3.8 ADD å‘½ä»¤"></a>3.3.8 ADD å‘½ä»¤</h4><ul><li><p>ç”¨æ¥ä»contextä¸Šä¸‹æ–‡å¤åˆ¶æ–°æ–‡ä»¶ã€ç›®å½•æˆ–è¿œç¨‹æ–‡ä»¶urlï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°ä½äºæŒ‡å®šè·¯å¾„çš„æ˜ åƒæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p></li><li><p>è¯­æ³•:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ADD</span><span class="language-bash"> hom\* /mydir/ é€šé…ç¬¦æ·»åŠ å¤šä¸ªæ–‡ä»¶</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> hom?.txt /mydir/ é€šé…ç¬¦æ·»åŠ </span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> test.txt relativeDir/ å¯ä»¥æŒ‡å®šç›¸å¯¹è·¯å¾„</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> test.txt /absoluteDir/ ä¹Ÿå¯ä»¥æŒ‡å®šç»å¯¹è·¯å¾„</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> url</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="3-3-9-COPY-å‘½ä»¤"><a href="#3-3-9-COPY-å‘½ä»¤" class="headerlink" title="3.3.9 COPY å‘½ä»¤"></a>3.3.9 COPY å‘½ä»¤</h4><ul><li><p>ç”¨æ¥å°†contextç›®å½•ä¸­æŒ‡å®šæ–‡ä»¶å¤åˆ¶åˆ°é•œåƒçš„æŒ‡å®šç›®å½•ä¸­</p></li><li><p>è¯­æ³•:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">COPY</span><span class="language-bash"> src dest</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> [<span class="hljs-string">&quot;&lt;src&gt;&quot;</span>,... <span class="hljs-string">&quot;&lt;dest&gt;&quot;</span>]</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="3-3-10-VOLUME-å‘½ä»¤"><a href="#3-3-10-VOLUME-å‘½ä»¤" class="headerlink" title="3.3.10 VOLUME å‘½ä»¤"></a>3.3.10 VOLUME å‘½ä»¤</h4><ul><li><p>ç”¨æ¥å®šä¹‰å®¹å™¨è¿è¡Œæ—¶å¯ä»¥æŒ‚åœ¨åˆ°å®¿ä¸»æœºçš„ç›®å½•</p></li><li><p>è¯­æ³•:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">VOLUME</span><span class="language-bash"> [<span class="hljs-string">&quot;/data&quot;</span>]</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="3-3-11-ENTRYPOINTå‘½ä»¤"><a href="#3-3-11-ENTRYPOINTå‘½ä»¤" class="headerlink" title="3.3.11 ENTRYPOINTå‘½ä»¤"></a>3.3.11 ENTRYPOINTå‘½ä»¤</h4><ul><li><p>ç”¨æ¥æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œå‘½ä»¤å’ŒCMDç±»ä¼¼</p></li><li><p>è¯­æ³•:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;executable&quot;</span>, <span class="hljs-string">&quot;param1&quot;</span>, <span class="hljs-string">&quot;param2&quot;</span>]</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> <span class="hljs-built_in">command</span> param1 param2</span><br></code></pre></td></tr></table></figure><p>ENTRYPOINTæŒ‡ä»¤ï¼Œå¾€å¾€ç”¨äºè®¾ç½®å®¹å™¨å¯åŠ¨åçš„<strong>ç¬¬ä¸€ä¸ªå‘½ä»¤</strong>ï¼Œè¿™å¯¹ä¸€ä¸ªå®¹å™¨æ¥è¯´å¾€å¾€æ˜¯å›ºå®šçš„ã€‚<br>CMDæŒ‡ä»¤ï¼Œå¾€å¾€ç”¨äºè®¾ç½®å®¹å™¨å¯åŠ¨çš„ç¬¬ä¸€ä¸ªå‘½ä»¤çš„<strong>é»˜è®¤å‚æ•°</strong>ï¼Œè¿™å¯¹ä¸€ä¸ªå®¹å™¨æ¥è¯´å¯ä»¥æ˜¯å˜åŒ–çš„ã€‚</p></li></ul><h4 id="3-3-11-ENTRYPOINTå‘½ä»¤-1"><a href="#3-3-11-ENTRYPOINTå‘½ä»¤-1" class="headerlink" title="3.3.11 ENTRYPOINTå‘½ä»¤"></a>3.3.11 ENTRYPOINTå‘½ä»¤</h4><ul><li><p>ç”¨æ¥æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œå‘½ä»¤å’ŒCMDç±»ä¼¼</p></li><li><p>è¯­æ³•:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;executable&quot;</span>, <span class="hljs-string">&quot;param1&quot;</span>, <span class="hljs-string">&quot;param2&quot;</span>]</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> <span class="hljs-built_in">command</span> param1 param2</span><br></code></pre></td></tr></table></figure><p>ENTRYPOINTæŒ‡ä»¤ï¼Œå¾€å¾€ç”¨äºè®¾ç½®å®¹å™¨å¯åŠ¨åçš„<strong>ç¬¬ä¸€ä¸ªå‘½ä»¤</strong>ï¼Œè¿™å¯¹ä¸€ä¸ªå®¹å™¨æ¥è¯´å¾€å¾€æ˜¯å›ºå®šçš„ã€‚<br>CMDæŒ‡ä»¤ï¼Œå¾€å¾€ç”¨äºè®¾ç½®å®¹å™¨å¯åŠ¨çš„ç¬¬ä¸€ä¸ªå‘½ä»¤çš„<strong>é»˜è®¤å‚æ•°</strong>ï¼Œè¿™å¯¹ä¸€ä¸ªå®¹å™¨æ¥è¯´å¯ä»¥æ˜¯å˜åŒ–çš„ã€‚</p></li></ul><h1 id="4-Dockerfileæ„å»ºspringbooté¡¹ç›®éƒ¨ç½²"><a href="#4-Dockerfileæ„å»ºspringbooté¡¹ç›®éƒ¨ç½²" class="headerlink" title="4. Dockerfileæ„å»ºspringbooté¡¹ç›®éƒ¨ç½²"></a>4. Dockerfileæ„å»ºspringbooté¡¹ç›®éƒ¨ç½²</h1><h2 id="4-1-å‡†å¤‡ä¸€ä¸ªspringbooté¡¹ç›®"><a href="#4-1-å‡†å¤‡ä¸€ä¸ªspringbooté¡¹ç›®" class="headerlink" title="4.1 å‡†å¤‡ä¸€ä¸ªspringbooté¡¹ç›®"></a>4.1 å‡†å¤‡ä¸€ä¸ªspringbooté¡¹ç›®</h2><p><img src="https://i.loli.net/2021/06/12/Y8SeGUC7Pnhd5iV.png"></p><p>è¿™é‡Œæ¨èä¸ªå°æŠ€å·§ï¼Œå¯ä»¥ç”¨ideaä¸­çš„toolsè¿æ¥è™šæ‹Ÿæœºï¼Œç›¸å½“äºä¸€ä¸ªç®€å•çš„xftpï¼Œåœ¨è™šæ‹Ÿæœºä¸­æ–°å»ºä¸ªæ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾é•œåƒæ‰“åŒ…æ‰€éœ€çš„ææ–™</p><h2 id="4-2-ç¼–å†™Dockerfileæ–‡ä»¶"><a href="#4-2-ç¼–å†™Dockerfileæ–‡ä»¶" class="headerlink" title="4.2 ç¼–å†™Dockerfileæ–‡ä»¶"></a>4.2 ç¼–å†™Dockerfileæ–‡ä»¶</h2><p>è¿™é‡Œå¯ä»¥åœ¨ideaä¸­å®‰è£…ä¸ªDockeræ’ä»¶ï¼Œå³å¯æ”¯æŒDockerfileä»£ç æç¤º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">FROM openjdk:8-jre<br>WORKDIR /app<br>ADD dockerfile-test-0.0.1-SNAPSHOT.jar app.jar<br>EXPOSE 8010<br>ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;]<br>CMD [&quot;app.jar&quot;]<br></code></pre></td></tr></table></figure><p>Javaé¡¹ç›®è‚¯å®šéœ€è¦jdkç¯å¢ƒçš„ï¼Œæ‰€ä»¥éœ€è¦é¦–å…ˆæ‹‰å–jdké•œåƒ</p><h2 id="4-3-æŠŠDockerfileå’Œjaræ–‡ä»¶æ‹–å…¥åˆ°æ–‡ä»¶å¤¹é‡Œ"><a href="#4-3-æŠŠDockerfileå’Œjaræ–‡ä»¶æ‹–å…¥åˆ°æ–‡ä»¶å¤¹é‡Œ" class="headerlink" title="4.3 æŠŠDockerfileå’Œjaræ–‡ä»¶æ‹–å…¥åˆ°æ–‡ä»¶å¤¹é‡Œ"></a>4.3 æŠŠDockerfileå’Œjaræ–‡ä»¶æ‹–å…¥åˆ°æ–‡ä»¶å¤¹é‡Œ</h2><h2 id="4-4-è¯¦ç»†çš„å‘½ä»¤è®°å½•"><a href="#4-4-è¯¦ç»†çš„å‘½ä»¤è®°å½•" class="headerlink" title="4.4 è¯¦ç»†çš„å‘½ä»¤è®°å½•"></a>4.4 è¯¦ç»†çš„å‘½ä»¤è®°å½•</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@hspEdu01 dockerfile-test]# docker images<br>REPOSITORY TAG IMAGE ID CREATED SIZE<br>docker.io/tomcat 9.0.46-jdk8 7253c7ce0ab9 4 weeks ago 534 MB<br>docker.io/mysql 5.7 2c9028880e58 4 weeks ago 447 MB<br>docker.io/openjdk 8 eca41db787bd 4 weeks ago 514 MB<br>[root@hspEdu01 dockerfile-test]# docker build -t app .<br>Sending build context to Docker daemon 17.08 MB<br>Step 1/6 : FROM openjdk:8-jre<br>Trying to pull repository docker.io/library/openjdk ...<br>8-jre: Pulling from docker.io/library/openjdk<br>d960726af2be: Already exists<br>e8d62473a22d: Already exists<br>8962bc0fad55: Already exists<br>961f7da1b9e5: Pull complete<br>7ba190cfbc66: Pull complete<br>595e52ef2a1b: Pull complete<br>Digest: sha256:5f5917a0754c79104a0025d3debb2bdc0c2fc11d60e80e008e9de89822281e46<br>Status: Downloaded newer image for docker.io/openjdk:8-jre<br><span class="hljs-meta prompt_">---&gt; </span><span class="language-bash">a979584e265d</span><br>Step 2/6 : WORKDIR /app<br><span class="hljs-meta prompt_">---&gt; </span><span class="language-bash">ed8a0ad97eb5</span><br>Removing intermediate container a4d123dd9196<br>Step 3/6 : ADD dockerfile-test-0.0.1-SNAPSHOT.jar app.jar<br><span class="hljs-meta prompt_">---&gt; </span><span class="language-bash">53cd89081273</span><br>Removing intermediate container 93713300ae57<br>Step 4/6 : EXPOSE 8010<br><span class="hljs-meta prompt_">---&gt; </span><span class="language-bash">Running <span class="hljs-keyword">in</span> 8bf5e5054545</span><br><span class="hljs-meta prompt_">---&gt; </span><span class="language-bash">a550b7d7348e</span><br>Removing intermediate container 8bf5e5054545<br>Step 5/6 : ENTRYPOINT java -jar<br><span class="hljs-meta prompt_">---&gt; </span><span class="language-bash">Running <span class="hljs-keyword">in</span> a8596518fb47</span><br><span class="hljs-meta prompt_">---&gt; </span><span class="language-bash">c5097be2928d</span><br>Removing intermediate container a8596518fb47<br>Step 6/6 : CMD app.jar<br><span class="hljs-meta prompt_">---&gt; </span><span class="language-bash">Running <span class="hljs-keyword">in</span> 4c3318ac728d</span><br><span class="hljs-meta prompt_">---&gt; </span><span class="language-bash">a8e34817044f</span><br>Removing intermediate container 4c3318ac728d<br>Successfully built a8e34817044f<br>[root@hspEdu01 dockerfile-test]# docker images<br>REPOSITORY TAG IMAGE ID CREATED SIZE<br>app latest a8e34817044f 43 seconds ago 285 MB<br>docker.io/tomcat 9.0.46-jdk8 7253c7ce0ab9 4 weeks ago 534 MB<br>docker.io/mysql 5.7 2c9028880e58 4 weeks ago 447 MB<br>docker.io/openjdk 8-jre a979584e265d 4 weeks ago 268 MB<br>docker.io/openjdk 8 eca41db787bd 4 weeks ago 514 MB<br>[root@hspEdu01 dockerfile-test]# docker run -d -p 8010:8010 a8e34<br>760a2956258e4b6d0f56351597049f45677bed264aa5241ba1f584e0e2d38645<br>[root@hspEdu01 dockerfile-test]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES<br>760a2956258e a8e34 &quot;java -jar app.jar&quot; 4 seconds ago Up 2 seconds 0.0.0.0:8010-&gt;8010/tcp adoring\_pare<br>95628d5d89c5 mysql:5.7 &quot;docker-entrypoint...&quot; 42 minutes ago Up 42 minutes 0.0.0.0:3306-&gt;3306/tcp, 33060/tcp mysql<br>[root@hspEdu01 dockerfile-test]#<br></code></pre></td></tr></table></figure><h2 id="4-5-æµ‹è¯•æ¥å£"><a href="#4-5-æµ‹è¯•æ¥å£" class="headerlink" title="4.5 æµ‹è¯•æ¥å£"></a>4.5 æµ‹è¯•æ¥å£</h2><p><img src="https://i.loli.net/2021/06/12/TKPSFDMx6AQOaqC.png"></p><p>Dockerçš„æ“ä½œè¿œä¸å¦‚æ­¤ï¼Œè¿™é‡Œä»…ä»…åªæ˜¯å…¥é—¨ï¼Œåé¢ä¼šç»§ç»­æ›´æ–°çš„~</p>]]></content>
    
    
    
    <tags>
      
      <tag>å®¹å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootä¹‹é›†æˆMongoDB</title>
    <link href="/2021/05/22/SpringBoot%E4%B9%8B%E9%9B%86%E6%88%90MongoDB/"/>
    <url>/2021/05/22/SpringBoot%E4%B9%8B%E9%9B%86%E6%88%90MongoDB/</url>
    
    <content type="html"><![CDATA[<p>å…¬å¸çš„æŠ€æœ¯æ ˆæ˜¯SpringCloud+ZoomKeeper+RabbitMq+JPA+MongoDBï¼Œåˆ©ç”¨zkå»åšé…ç½®æ–‡ä»¶ï¼Œrabbitmqåšä¸€äº›å¼‚æ­¥å¤„ç†ï¼ŒæŒä¹…å±‚é‡‡ç”¨JPA(æ•°æ®åº“çš„Mysql)ï¼Œå¯¹äºå¤§éƒ¨åˆ†éƒ½æ˜¯æŸ¥è¯¢çš„ä¸šåŠ¡ï¼Œæ•°æ®æ˜¯å­˜åœ¨MongoDBä¸­ã€‚</p><p>MongoDBæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€å¼€æºã€æ— æ¨¡å¼çš„æ–‡æ¡£å‹æ•°æ®åº“ï¼Œæ˜¯å½“å‰NoSqlæ•°æ®åº“ä¸­æ¯”è¾ƒçƒ­é—¨çš„ä¸€ç§ã€‚ é€‚åˆå¯¹å¤§é‡æˆ–è€…æ— å›ºå®šæ ¼å¼çš„æ•°æ®è¿›è¡Œå­˜å‚¨ï¼Œæ¯”å¦‚ï¼šæ—¥å¿—ã€ç¼“å­˜ç­‰ã€‚å¯¹äº‹ç‰©æ”¯æŒè¾ƒå¼±ï¼Œä¸é€‚ç”¨å¤æ‚çš„å¤šæ–‡æ¡£ï¼ˆå¤šè¡¨ï¼‰çš„çº§è”æŸ¥è¯¢ã€‚</p><p>MongoDBçš„é€‚ç”¨åœºæ™¯ï¼š</p><ol><li>åœ¨åº”ç”¨æœåŠ¡å™¨çš„æ—¥å¿—è®°å½•</li><li>å­˜å‚¨ä¸€äº›ç›‘æ§æ•°æ®</li><li>åº”ç”¨ä¸éœ€è¦äº‹åŠ¡åŠå¤æ‚ join æ”¯æŒ</li><li>åº”ç”¨éœ€è¦2000-3000ä»¥ä¸Šçš„è¯»å†™QPS</li><li>åº”ç”¨éœ€è¦TBç”šè‡³ PB çº§åˆ«æ•°æ®å­˜å‚¨</li><li>åº”ç”¨å‘å±•è¿…é€Ÿï¼Œéœ€è¦èƒ½å¿«é€Ÿæ°´å¹³æ‰©å±•</li><li>åº”ç”¨è¦æ±‚å­˜å‚¨çš„æ•°æ®ä¸ä¸¢å¤±</li><li>åº”ç”¨éœ€è¦99.999%é«˜å¯ç”¨</li><li>åº”ç”¨éœ€è¦å¤§é‡çš„åœ°ç†ä½ç½®æŸ¥è¯¢ã€æ–‡æœ¬æŸ¥è¯¢</li></ol><p>ä¸‹é¢å°±è®²ä¸‹SpringBootåˆ©ç”¨MongoTemplateæ“ä½œmongdb</p><h1 id="1-MongDBçš„å®‰è£…"><a href="#1-MongDBçš„å®‰è£…" class="headerlink" title="1. MongDBçš„å®‰è£…"></a>1. MongDBçš„å®‰è£…</h1><p>å®‰è£…MongDBå¯ä»¥çœ‹<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/">å®˜ç½‘å®‰è£…</a></p><p>è‹±è¯­ä¸å¥½çš„å°ä¼™ä¼´å¯ä»¥çœ‹è¿™ä¸ª<a href="https://www.runoob.com/docker/docker-install-mongodb.html">å®‰è£…</a></p><p>æˆ‘æ˜¯åœ¨centos7.0ä¸Šå®‰è£…çš„MongDB4.2ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ŒåŠ å…¥ç”¨æˆ·å’Œå¯†ç ï¼Œä¸‹é¢çš„linuxè¯¦ç»†å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VM-0-15-centos ~]# docker pull mongo:4.2.6<br>Trying to pull repository docker.io/library/mongo ...<br>4.2.6: Pulling from docker.io/library/mongo<br>23884877105a: Pull complete<br>bc38caa0f5b9: Pull complete<br>2910811b6c42: Pull complete<br>36505266dcc6: Pull complete<br>a4d269900d94: Pull complete<br>5e2526abb80a: Pull complete<br>d3eece1f39ec: Pull complete<br>358ed78d3204: Pull complete<br>1a878b8604ae: Pull complete<br>dde03a2883d0: Pull complete<br>4ffe534daa34: Pull complete<br>f164ba21e17c: Pull complete<br>6494c387442c: Pull complete<br>Digest: sha256:c880f6b56f443bb4d01baa759883228cd84fa8d78fa1a36001d1c0a0712b5a07<br>Status: Downloaded newer image for docker.io/mongo:4.2.6<br>[root@VM-0-15-centos ~]# docker images<br>REPOSITORY TAG IMAGE ID CREATED SIZE<br>docker.io/mysql 5.7 2c9028880e58 9 days ago 447 MB<br>docker.io/tomcat 9.0.45-jdk8-adoptopenjdk-hotspot bcf990bea01a 10 days ago 341 MB<br>docker.io/mongo 4.2.6 3f3daf863757 13 months ago 388 MB<br>docker.io/rabbitmq 3.7.15-management f05c3eb3cf91 22 months ago 179 MB<br>[root@VM-0-15-centos ~]# docker run -td --name mongo -p 27017:27017 3f3daf863757 --auth<br>44d090fd4314773ac4362298eadf5928feda9c347b50dd0ff17c40c32cb00128<br>[root@VM-0-15-centos ~]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS<br>NAMES<br>44d090fd4314 3f3daf863757 &quot;docker-entrypoint...&quot; 4 seconds ago Up 3 seconds 0.0.0.0:27017-&gt;27017/tcp<br>[root@VM-0-15-centos ~]# docker exec -it mongo mongo admin<br>MongoDB shell version v4.2.6<br>connecting to: mongodb://127.0.0.1:27017/admin?compressors=disabled&amp;gssapiServiceName=mongodb<br>Implicit session: session &#123; &quot;id&quot; : UUID(&quot;cb9f0916-53bc-4781-aa95-4409477eb89b&quot;) &#125;<br>MongoDB server version: 4.2.6<br>Welcome to the MongoDB shell.<br>For interactive help, type &quot;help&quot;.<br>For more comprehensive documentation, see<br>http://docs.mongodb.org/<br>Questions? Try the support group<br>http://groups.google.com/group/mongodb-user<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">db.createUser(&#123; user:<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-built_in">pwd</span>:<span class="hljs-string">&#x27;123456&#x27;</span>,roles:[ &#123; role:<span class="hljs-string">&#x27;userAdminAnyDatabase&#x27;</span>, db: <span class="hljs-string">&#x27;admin&#x27;</span>&#125;,<span class="hljs-string">&quot;readWriteAnyDatabase&quot;</span>]&#125;);</span><br>Successfully added user: &#123;<br>&quot;user&quot; : &quot;admin&quot;,<br>&quot;roles&quot; : [<br>&#123;<br>&quot;role&quot; : &quot;userAdminAnyDatabase&quot;,<br>&quot;db&quot; : &quot;admin&quot;<br>&#125;,<br>&quot;readWriteAnyDatabase&quot;<br>]<br>&#125;<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">db.auth(<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;123456&#x27;</span>)</span><br>1<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">^C</span><br>bye<br>[root@VM-0-15-centos ~]# docker restart 44d090fd4314<br>44d090fd4314<br>[root@VM-0-15-centos ~]# docker ps -a<br>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS<br>NAMES<br>44d090fd4314 3f3daf863757 &quot;docker-entrypoint...&quot; 47 minutes ago Up 3 seconds 0.0.0.0:27017-&gt;27017/tcp<br></code></pre></td></tr></table></figure><h1 id="2-æ·»åŠ Mavenä¾èµ–"><a href="#2-æ·»åŠ Mavenä¾èµ–" class="headerlink" title="2. æ·»åŠ Mavenä¾èµ–"></a>2. æ·»åŠ Mavenä¾èµ–</h1><p>åªéœ€è¦åŠ å…¥webå¯åŠ¨å™¨å’Œmongdbä¾èµ–å³å¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- æ·»åŠ mongodbä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="3-æ·»åŠ é…ç½®æ–‡ä»¶"><a href="#3-æ·»åŠ é…ç½®æ–‡ä»¶" class="headerlink" title="3. æ·»åŠ é…ç½®æ–‡ä»¶"></a>3. æ·»åŠ é…ç½®æ–‡ä»¶</h1><p>æˆ‘ä»¬æå‰åœ¨MongoDBä¸­åˆ›å»ºä¸€ä¸ªteståº“ï¼Œå¹¶åœ¨ä¸‹é¢çš„é…ç½®ä¿¡æ¯ä¸­åŠ å…¥åˆšåˆšé…ç½®çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¯†ç éœ€è¦ç”¨å•å¼•å·</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br><span class="hljs-attr">data:</span><br><span class="hljs-attr">mongodb:</span><br><span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br><span class="hljs-attr">port:</span> <span class="hljs-number">27017</span><br><span class="hljs-attr">database:</span> <span class="hljs-string">test</span><br><span class="hljs-attr">option:</span><br><span class="hljs-attr">max-connection-idle-time:</span> <span class="hljs-number">1500</span><br><span class="hljs-attr">max-connection-per-host:</span> <span class="hljs-number">200</span><br><span class="hljs-attr">max-wait-time:</span> <span class="hljs-number">60000</span><br><span class="hljs-attr">max-connection-life-time:</span> <span class="hljs-number">0</span><br><span class="hljs-attr">connect-timeout:</span> <span class="hljs-number">10000</span><br><span class="hljs-attr">socket-timeout:</span> <span class="hljs-number">60000</span><br><span class="hljs-attr">password:</span> <span class="hljs-string">&#x27;123456&#x27;</span><br><span class="hljs-attr">username:</span> <span class="hljs-string">admin</span><br><span class="hljs-attr">authentication-database:</span> <span class="hljs-string">admin</span><br></code></pre></td></tr></table></figure><h1 id="4-ç¼–å†™å®ä½“ç±»"><a href="#4-ç¼–å†™å®ä½“ç±»" class="headerlink" title="4. ç¼–å†™å®ä½“ç±»"></a>4. ç¼–å†™å®ä½“ç±»</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">5</span>/<span class="hljs-number">22</span> <span class="hljs-number">10</span>:<span class="hljs-number">10</span><br>\*/<br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Document(collation = &quot;user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br><span class="hljs-meta">@Id</span><br><span class="hljs-keyword">private</span> Integer id;<br><span class="hljs-keyword">private</span> Integer age;<br><span class="hljs-keyword">private</span> String name;<br><span class="hljs-keyword">private</span> String role;<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(Integer id, Integer age, String name, String role)</span> &#123;<br><span class="hljs-built_in">this</span>.id = id;<br><span class="hljs-built_in">this</span>.age = age;<br><span class="hljs-built_in">this</span>.name = name;<br><span class="hljs-built_in">this</span>.role = role;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="5-ç¼–å†™DAOå±‚"><a href="#5-ç¼–å†™DAOå±‚" class="headerlink" title="5. ç¼–å†™DAOå±‚"></a>5. ç¼–å†™DAOå±‚</h1><p>SpringBootå·²ç»ä¸ºæˆ‘ä»¬é«˜åº¦å°è£…äº†MongoTemplateï¼Œç±»ä¼¼RedisTemplate</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MongoTestDao</span> &#123;<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> MongoTemplate mongoTemplate;<br>/\*\*<br>\* åˆ›å»ºå¯¹è±¡<br>\* <span class="hljs-meta">@param</span> user<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span>&#123;<br>mongoTemplate.save(user);<br>&#125;<br>/\*\*<br>\* æ ¹æ®idæŸ¥è¯¢å¯¹è±¡<br>\* <span class="hljs-meta">@param</span> id<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">findUserById</span><span class="hljs-params">(Integer id)</span>&#123;<br><span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>(Criteria.where(<span class="hljs-string">&quot;name&quot;</span>).is(id));<br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mongoTemplate.findOne(query, User.class);<br><span class="hljs-keyword">return</span> user;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUserById</span><span class="hljs-params">(User user)</span>&#123;<br><span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>(Criteria.where(<span class="hljs-string">&quot;id&quot;</span>).is(user.getId()));<br><span class="hljs-type">Update</span> <span class="hljs-variable">update</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Update</span>().set(<span class="hljs-string">&quot;age&quot;</span>, user.getAge()).set(<span class="hljs-string">&quot;name&quot;</span>, user.getName());<br><span class="hljs-comment">//æ›´æ–°æŸ¥è¯¢ç»“æœä¸­çš„ç¬¬ä¸€æ¡æ•°æ®</span><br>mongoTemplate.updateFirst(query,update,User.class);<br>&#125;<br>/\*\*<br>\* æ ¹æ®idåˆ é™¤<br>\* <span class="hljs-meta">@param</span> id<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUserById</span><span class="hljs-params">(Integer id)</span>&#123;<br><span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>(Criteria.where(<span class="hljs-string">&quot;id&quot;</span>).is(id));<br>mongoTemplate.remove(query,User.class);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="6-æµ‹è¯•ç”¨ä¾‹"><a href="#6-æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="6. æµ‹è¯•ç”¨ä¾‹"></a>6. æµ‹è¯•ç”¨ä¾‹</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringbootMongodbApplicationTests</span> &#123;<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> MongoTestDao mongoTestDao;<br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>mongoTestDao.save(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(i,i,String.valueOf(i+<span class="hljs-number">1</span>),String.valueOf(i+<span class="hljs-number">100</span>)));<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;#####æ’å…¥å®Œæ¯•ï¼######&quot;</span>);<br>&#125;<br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>mongoTestDao.updateUserById(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(i,i-<span class="hljs-number">1000</span>,<span class="hljs-string">&quot;A&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>));<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;#####ä¿®æ”¹å®Œæ¯•ï¼######&quot;</span>);<br>&#125;<br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>mongoTestDao.deleteUserById(i);<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;#####ä¿®æ”¹å®Œæ¯•ï¼######&quot;</span>);<br>&#125;<br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findUserById</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mongoTestDao.findUserById(i);<br>System.out.println(i+<span class="hljs-string">&quot;-----------&quot;</span>+user);<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;#####æŸ¥è¯¢å®Œæ¯•ï¼######&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•é€šè¿‡ï¼Œæ”¾ä¸€å¼ ç”¨MongDB Compassè¿æ¥MongDBçš„å›¾</p><p><img src="https://i.loli.net/2021/05/22/VfkQB98IWAoz1uF.png"></p><h1 id="7-GitHubä»£ç "><a href="#7-GitHubä»£ç " class="headerlink" title="7. GitHubä»£ç "></a>7. GitHubä»£ç </h1><p><a href="https://github.com/luffy997/SpringBootBucket/tree/main/springboot-mongodb">springboot-mongodb</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>éšç¬”04</title>
    <link href="/2021/04/28/%E9%9A%8F%E7%AC%9404/"/>
    <url>/2021/04/28/%E9%9A%8F%E7%AC%9404/</url>
    
    <content type="html"><![CDATA[<h1 id="å…³äºå¤šçº¿ç¨‹çš„å‡ ç‚¹è¡¥å……"><a href="#å…³äºå¤šçº¿ç¨‹çš„å‡ ç‚¹è¡¥å……" class="headerlink" title="å…³äºå¤šçº¿ç¨‹çš„å‡ ç‚¹è¡¥å……"></a>å…³äºå¤šçº¿ç¨‹çš„å‡ ç‚¹è¡¥å……</h1><p>åœ¨ç†è§£çº¿ç¨‹çš„çŠ¶æ€æ—¶ï¼Œéœ€è¦å…ˆäº†è§£æ¯ä¸ªå¯¹è±¡éƒ½æœ‰çš„â€”â€”é”æ± å’Œç­‰å¾…æ± è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚</p><p>é”æ± å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹Aå·²ç»å ç”¨äº†å¯¹è±¡é”ï¼Œå…¶ä»–å¯¹è±¡æƒ³è¦æ‹¿åˆ°è¯¥å¯¹è±¡é”å°±å¿…é¡»ç­‰å¾…Aé‡Šæ”¾é”ï¼Œè¿™äº›æƒ³æ‹¿åˆ°å¯¹è±¡é”çš„çº¿ç¨‹å°±ä¼šè¿›å…¥é”æ± ï¼Œç­‰å¾…å’Œç«äº‰é”ã€‚</p><p>ç­‰å¾…æ± ï¼šå‡è®¾ä¸€ä¸ªçº¿ç¨‹Aè°ƒç”¨äº†æŸä¸ªå¯¹è±¡çš„wait()æ–¹æ³•ï¼Œçº¿ç¨‹Aå°±ä¼šé‡Šæ”¾è¯¥å¯¹è±¡çš„é”ï¼Œè¿›å…¥åˆ°è¯¥å¯¹è±¡çš„ç­‰å¾…æ± ã€‚</p><p>ä»ä¸Šé¢å°±å¯ä»¥çœ‹å‡ºé”æ± æ˜¯é‡Œçš„çº¿ç¨‹éƒ½æ˜¯ç«äº‰é”çš„ï¼Œè€Œç­‰å¾…æ± é‡Œçš„çº¿ç¨‹å·²ç»è¢«é‡Šæ”¾é”ï¼Œç­‰å¾…è¢«å”¤é†’ï¼Œæ‰€ä»¥æ˜¯ä¸ä¼šç«äº‰è¯¥å¯¹è±¡çš„é”</p><p>æˆ‘ä»¬å…ˆèŠä¸‹sleepå’Œwaitçš„åŒºåˆ«</p><p>Sleepæ˜¯Threadçš„é™æ€æ–¹æ³•ï¼Œçº¿ç¨‹ä¼‘çœ ï¼Œä¸ä¼šè®©å‡ºé”ï¼Œè€Œæ˜¯åˆ°æ—¶å€™å°±ç»§ç»­æ‰§è¡Œã€‚å¯ä»¥åœ¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹è¿›è¡Œä½¿ç”¨ã€‚</p><p>Waitæ˜¯Objectçš„æ–¹æ³•ï¼Œçº¿ç¨‹é‡Šæ”¾é”ï¼Œè¿›å…¥ç­‰å¾…æ± ï¼Œç­‰å¾…notify()æˆ–notifyAll()å”¤é†’ï¼Œè¿›è€Œè¿›å…¥é”æ± ï¼Œç«äº‰é”ã€‚Waitå¿…é¡»æ˜¯åœ¨å·²ç»æŒæœ‰é”çš„æƒ…å†µä¸‹å»è°ƒç”¨é‡Šæ”¾é”ï¼Œä¸ç„¶ä¼šæŠ›å‡ºIllegalMonitorStateExceptionï¼Œå› ä¸ºé”éƒ½æ²¡ï¼Œä½•è°ˆé‡Šæ”¾é”å‘¢ï¼Ÿ</p><p>æ¥ä¸‹æ¥å°±æ˜¯waitï¼Œnotifyï¼ŒnotifyAll()çš„åŒºåˆ«ï¼Œä¸Šé¢å·²ç»è¯´åˆ°ï¼Œè°ƒç”¨waitå°±æ˜¯ä½¿çº¿ç¨‹é‡Šæ”¾å½“å‰é”è¿›å…¥ç­‰å¾…æ± ï¼Œé‚£ä¹ˆä¹Ÿä¸æ˜¯ä¸€ç›´ç­‰å¾…å•Šï¼Œå½“æˆ‘ä»¬éœ€è¦æŸä¸ªçº¿ç¨‹å°±å¯ä»¥è°ƒç”¨notify()æˆ–è€…notifyAll()æ¥ä½¿çº¿ç¨‹ä»ç­‰å¾…æ± ä¸­è§£æ”¾å‡ºæ¥ï¼Œè¿›å…¥é”æ± å»ç«äº‰é”ã€‚æ‰€ä»¥è¿™é‡Œå°±æœ‰ä¸ªå¾ˆé‡è¦çš„çŸ¥è¯†ç‚¹â€”â€”è°ƒç”¨notify()æˆ–è€…notifyAll()æ˜¯ä¸ä¼šç«‹å³è·å¾—é”ï¼Œè€Œæ˜¯å»é”æ± ç«äº‰é”ï¼Œç«äº‰é”çš„æƒ…å†µé‚£å°±ä¸ä¸€æ ·äº†ï¼Œå¯èƒ½ç›´æ¥å°±è·å¾—é”äº†ï¼Œä¹Ÿå¯ä»¥è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚è¿™ä¸ªä¹Ÿæ˜¯blockedå’ŒwaitingçŠ¶æ€çš„åŒºåˆ«ã€‚</p><p>å¯¹äºnotify()å’ŒnotifyAll()å¤§åŒå°å¼‚ï¼Œnotify()æ˜¯éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…æ± ä¸­çš„çº¿ç¨‹è¿›å…¥é”æ± ï¼Œnotify()æ˜¯å”¤é†’å…¨éƒ¨çº¿ç¨‹è¿›å…¥é”æ± ã€‚å½“ç„¶è°ƒç”¨notify()éšæœºå”¤é†’ä¼šæœ‰ä¼˜å…ˆçº§çš„æ§åˆ¶ï¼Œä½†åªæ˜¯æ¦‚ç‡ï¼Œä¸æ˜¯æ¯æ¬¡éƒ½æ˜¯ä¸¥æ ¼æŒ‰ç…§ä¼˜å…ˆçº§ï¼Œè¿™ä¸ªæ˜¯å‡­cpuè°ƒåº¦çš„ã€‚</p><h1 id="Redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹çš„åº•å±‚å®ç°"><a href="#Redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹çš„åº•å±‚å®ç°" class="headerlink" title="Redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹çš„åº•å±‚å®ç°"></a>Redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹çš„åº•å±‚å®ç°</h1><p><img src="https://i.loli.net/2021/05/06/uCMHktPwJqFr5Rh.png"></p><p>â€‹ æ®ä¸Šè¡¨å¯çŸ¥ï¼ŒStringçš„ç¼–ç å¯ä»¥æ˜¯int,embstr,rawï¼Œå½“è¾“å…¥çš„æ•°å€¼å¯ä»¥è½¬æ¢ä¸ºlongï¼Œé‚£å°±ä»¥intçš„ç±»å‹è¿›è¡Œå­˜å‚¨ã€‚å¯¹äºå­—ç¬¦ç±»å‹ï¼Œredisåº•å±‚å¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨stringï¼Œè€Œæ˜¯è‡ªå·±å®ç°äº†ä¸€ä¸ªç®€å•çš„åŠ¨æ€å­—ç¬¦ä¸²sdsï¼Œcè¯­è¨€çš„stringæ˜¯ä¸è®°å½•è‡ªèº«é•¿åº¦æ˜¯ï¼Œä½†sdsæ˜¯è®°å½•çš„ï¼Œè¿™æ ·å°±ä½¿å¾—è·å–æœ¬èº«å­—ç¬¦é•¿åº¦çš„æ“ä½œæ—¶é—´å¤æ‚åº¦ä»O(n)é™åˆ°O(1)ï¼Œå¯¹äºemstrç¼–ç çš„èŒƒå›´æ˜¯å­—ç¬¦ä¸²å­—èŠ‚å°äºç­‰äº39ä¸ªå­—èŠ‚ï¼Œrawæ˜¯å¤§äº39ä¸ªå­—èŠ‚ï¼Œå½“ç„¶intç¼–ç ä¹Ÿæ˜¯å¯ä»¥åœ¨ä¸€å®šæƒ…å†µä¸‹è½¬æ¢ä¸ºrawçš„ï¼Œæ¯”å¦‚å¯¹intè¿›è¡Œappendæ“ä½œã€‚</p><p>â€‹ Listæ˜¯ä¸€ä¸ªæœ‰åºçš„ï¼Œå¯æ’å…¥é‡å¤å…ƒç´ çš„é“¾è¡¨ç»“æ„ï¼Œåº•å±‚æ˜¯ziplistæˆ–linkedlistã€‚ziplistæ˜¯ä¸€ä¸ªå‹ç¼©å‹é“¾è¡¨ï¼Œä¸ºèŠ‚çº¦å†…å­˜è€Œå¼€å‘çš„ï¼Œé€‚ç”¨äºé•¿åº¦è¾ƒå°çš„å€¼ï¼Œå…¶æ˜¯ç”±è¿ç»­ç©ºé—´ç»„æˆ(ä¼šä¿å­˜æ¯ä¸ªå€¼çš„é•¿åº¦ä¿¡æ¯ï¼Œå› æ­¤å¯ä¾æ¬¡æ‰¾åˆ°å„ä¸ªå€¼)ï¼Œå­˜å–æ•ˆç‡é«˜ï¼Œå ç”¨ç©ºé—´å°ï¼Œä½†ç”±äºåœ°å€ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥ä¿®æ”¹é“¾è¡¨éœ€è¦ä¿®æ”¹åœ°å€ç©ºé—´ã€‚LinkedListæ˜¯ä¸€ä¸ªæ— ç¯çš„åŒå‘é“¾è¡¨ï¼Œä¿®æ”¹æ•ˆç‡é«˜ï¼Œä½†æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ä¿ç•™å‰é©±å’Œåç»§ï¼Œå ç”¨å†…å­˜å¤§ã€‚å¯¹äºä¸¤ç§æ•°æ®ç»“æ„çš„é€‰æ‹©ï¼Œlistæ˜¯ä»¥ä¿å­˜çš„å­—ç¬¦ä¸²å…ƒç´ å¤§å°éƒ½å°äº64ä¸ªå­—èŠ‚å’Œå…ƒç´ æ•°é‡å°äº512ä¸ªä½œä¸ºæ ‡å‡†ï¼Œä¸¤ä¸ªéƒ½æ»¡è¶³å°±ç”¨ziplistï¼Œä¸€ä¸ªä¸æ»¡è¶³å°±ç”¨linkedlistã€‚</p><p>â€‹ Hashåº•å±‚ç”±ziplistæˆ–hashtableå®ç°ï¼Œzipliståº•å±‚çš„å‹ç¼©åˆ—è¡¨ï¼Œå¯¹äºå­˜å‚¨hashçš„å¯¹è±¡æ˜¯æŠŠåŒä¸€é”®å€¼å¯¹çš„ä¸¤ä¸ªèŠ‚ç‚¹ç›¸äº’ç´§é ï¼Œkeyåœ¨å‰ï¼Œvalueåœ¨åï¼Œå…ˆä¿å­˜çš„å°±åœ¨ziplistçš„è¡¨å¤´æ–¹å‘ï¼Œåæ¥çš„å°±åœ¨è¡¨å°¾ã€‚Hashtableåº•å±‚æ˜¯å­—å…¸å®ç°ï¼Œæ¯ä¸ªé”®å€¼å¯¹éƒ½ä½¿ç”¨ä¸€ä¸ªå­—å…¸é”®å€¼å¯¹ä¿å­˜ï¼Œå­—å…¸çš„é”®ä¸ºå­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¿å­˜ketï¼Œå­—å…¸çš„å€¼ä¹Ÿä¸ºå­—ç¬¦ä¸²çš„å¯¹è±¡ï¼Œä¿å­˜é”®å€¼å¯¹çš„å€¼ã€‚Ziplistå’Œhashtableçš„é€‰æ‹©ï¼Œå½“listå¯¹è±¡æ»¡è¶³ä¿å­˜çš„å­—ç¬¦ä¸²å…ƒç´ å¤§å°éƒ½å°äº64ä¸ªå­—èŠ‚å’Œå…ƒç´ æ•°é‡å°äº512ä¸ªï¼Œå°±ç”¨ziplistï¼Œå¦åˆ™ç”¨hashtableã€‚ä¸Šé¢çš„ä¸¤ä¸ªå€¼å¯ä»¥åœ¨redisçš„é…ç½®æ–‡ä»¶ä¸­çš„hashã€-max-zaiplist-valueå’Œhash-max-ziplist-entriesè¿›è¡Œä¿®æ”¹ã€‚</p><p>â€‹ Setçš„ç¼–ç å¯ä»¥ä¸ºinsertæˆ–hashtableï¼Œinsertä½¿ç”¨æ•°ç»„ä½œä¸ºåº•å±‚å®ç°ï¼Œä¸ä¼šå‡ºç°é‡å¤å…ƒç´ ã€‚Hashtableåº•å±‚è¿˜æ˜¯å­—å…¸ï¼Œåªæ˜¯valueä¸ºç©ºè€Œå·²ã€‚Insertå’Œhashtableçš„é€‰æ‹©ï¼Œå½“æ‰€æœ‰çš„å…ƒç´ éƒ½æ˜¯æ•´æ•°å’Œå…ƒç´ ä¸ªæ•°å°äº512ä¸ªï¼Œå°±ç”¨insertå¦åˆ™ç”¨hashtableã€‚</p><p>â€‹ ZSetçš„å¯¹è±¡ç¼–ç æ˜¯ziplistæˆ–è€…skiplist(è·³è¡¨)å®ç°ï¼ŒzipListç¼–ç ï¼Œæ¯ä¸ªé›†åˆå…ƒç´ ä½¿ç”¨ç›¸é‚»çš„ä¸¤ä¸ªå‹ç¼©åˆ—è¡¨èŠ‚ç‚¹ä¿å­˜ï¼Œä¸€ä¸ªä¿å­˜å…ƒç´ æˆå‘˜ï¼Œä¸€ä¸ªä¿å­˜å…ƒç´ åˆ†å€¼ï¼Œç„¶åä»å°åˆ°è¾¾æ’åºã€‚å¯¹äºè·³è¡¨åº”è¯¥æ˜¯æ¯”è¾ƒé™Œç”Ÿçš„æ•°æ®ç»“æ„ï¼Œå®ƒé€šè¿‡åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ç»´æŒå¤šä¸ªæŒ‡å‘å…¶ä»–èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»è€Œè¾¾åˆ°å¿«é€Ÿè®¿é—®èŠ‚ç‚¹çš„ç›®çš„ï¼Œé€šä¿—ç‚¹è¯´å°±æ˜¯æ·»åŠ äº†å¤šé‡ç´¢å¼•çš„ç»“æ„ã€‚ä¸€ä¸ªæœ‰åºé›†åˆåŒ…å«çš„å…ƒç´ æ•°é‡æ¯”è¾ƒå¤š,åˆæˆ–è€…æœ‰åºé›†åˆä¸­å…ƒç´ çš„æˆå‘˜æ˜¯æ¯”è¾ƒé•¿çš„å­—ç¬¦ä¸²æ—¶,Rediså°±ä¼šä½¿ç”¨è·³è·ƒè¡¨æ¥ä½œä¸ºæœ‰åºé›†åˆå¥çš„åº•å±‚å®ç°ã€‚è·³è·ƒè¡¨å®ç°ç”±zskiplistå’Œ zskiplistnodeä¸¤ä¸ªç»“æ„ç»„æˆ,å…¶ä¸­zskiplistç”¨äºä¿å­˜è·³è·ƒè¡¨ä¿¡æ¯(æ¯”å¦‚è¡¨å¤´èŠ‚ç‚¹ã€è¡¨å°¾èŠ‚ç‚¹ã€é•¿åº¦),è€Œzskiplistnodeåˆ™ç”¨äºè¡¨ç¤ºè·³è·ƒè¡¨èŠ‚ç‚¹ã€‚Redisæ¯ä¸ªè·³è·ƒè¡¨èŠ‚ç‚¹çš„å±‚é«˜éƒ½æ˜¯1è‡³32ä¹‹é—´çš„éšæœºæ•°ã€‚åœ¨åŒä¸€ä¸ªè·³è·ƒè¡¨ä¸­,å¤šä¸ªèŠ‚ç‚¹å¯ä»¥åŒ…å«ç›¸åŒçš„åˆ†å€¼,ä½†æ¯ä¸ªèŠ‚ç‚¹çš„æˆå‘˜å¯¹è±¡å¿…é¡»æ˜¯å”¯ä¸€çš„è·³è·ƒè¡¨ä¸­çš„èŠ‚ç‚¹æŒ‰ç…§åˆ†å€¼å¤§å°è¿›è¡Œæ’åº,å½“åˆ†å€¼ç›¸åŒæ—¶,èŠ‚ç‚¹æŒ‰ç…§æˆå‘˜å¯¹è±¡çš„å¤§å°è¿›è¡Œæ’åºã€‚</p><p>â€‹ å¯¹äºå…·ä½“ä½¿ç”¨ziplistè¿˜æ˜¯skiplistä½œä¸ºzetçš„åº•å±‚ï¼Œå½“å…ƒç´ æ•°é‡å°äº128å’Œä¿å­˜çš„æ‰€æœ‰å…ƒç´ çš„é•¿åº¦éƒ½å°äº64ä¸ªå­—èŠ‚ï¼Œå°±æ˜¯ç”¨ziplistï¼Œå¦åˆ™ä½¿ç”¨è·³è¡¨å®ç°ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>éšç¬”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>éšç¬”03</title>
    <link href="/2021/04/18/%E9%9A%8F%E7%AC%9403/"/>
    <url>/2021/04/18/%E9%9A%8F%E7%AC%9403/</url>
    
    <content type="html"><![CDATA[<h1 id="è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢çš„åŒºåˆ«"><a href="#è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢çš„åŒºåˆ«" class="headerlink" title="è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢çš„åŒºåˆ«"></a>è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢çš„åŒºåˆ«</h1><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“è¿›ç¨‹å’Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢åšäº†ä»€ä¹ˆï¼š</p><ol><li>åˆ‡æ¢é¡µç›®å½•ä»¥åŠä½¿ç”¨æ–°çš„åœ°å€ç©ºé—´</li><li>åˆ‡æ¢å†…æ ¸æ ˆå’Œç¡¬ä»¶çš„ä¸Šä¸‹æ–‡</li></ol><p>ä¸¤ç§çš„åŒºåˆ«å°±æ˜¯è¿›ç¨‹æœ‰ç¬¬ä¸€ä¸ªæ“ä½œï¼Œçº¿ç¨‹æ˜¯æ²¡æœ‰çš„ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹å’Œè¿›ç¨‹éƒ½æœ‰</p><p>å…³äºè®¨è®ºä¸¤è€…çš„åŒºåˆ«ï¼Œéœ€è¦çŸ¥é“è¿›ç¨‹å’Œçº¿ç¨‹çš„åœ¨å†…å­˜åœ°å€ä¸Šçš„åŒºåˆ«ï¼Œè¿›ç¨‹æ˜¯ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œè€Œè¿›ç¨‹é‡Œé¢çš„çº¿ç¨‹æ˜¯è¿ç»­çš„åœ°å€ç©ºé—´ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹åœ°å€æ˜¯å…±äº«çš„ã€‚</p><p>å…¶å®åˆ‡æ¢è¿›ç¨‹å’Œçº¿ç¨‹æœ€å¤§çš„åŒºåˆ«å°±æ˜¯è™šæ‹Ÿåœ°å€ç©ºé—´çš„æ”¹å˜ã€‚å¯¹äºè¿›ç¨‹ç”±äºæ˜¯ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æ˜¯æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä¸€æ—¦è¿›è¡Œåˆ‡æ¢å°±éœ€è¦åˆ‡æ¢è™šæ‹Ÿåœ°å€ç©ºé—´ï¼›çº¿ç¨‹ç”±äºæ˜¯åœ°å€ç©ºé—´æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦åˆ‡æ¢è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆæ˜¯è™šæ‹Ÿåœ°å€ï¼Ÿä¸ºä»€ä¹ˆè™šæ‹Ÿåœ°å€ç©ºé—´çš„åˆ‡æ¢æ˜¯æ¶ˆè€—æ€§èƒ½çš„ï¼Ÿ</p><p>è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æä¾›çš„ä¸€å—ç‹¬ç«‹çš„ã€ç§æœ‰çš„ã€åœ°å€è¿ç»­çš„è™šæ‹Ÿå†…å­˜ï¼Œä½†è™šæ‹Ÿå†…å­˜ç»ˆç©¶è¿˜æ˜¯è™šæ‹Ÿçš„ï¼Œéœ€è¦çœŸæ­£å’Œç‰©ç†åœ°å€æŒ‚é’©ï¼Œé‚£ä¹ˆè¿™æ ·çš„æŠ€æœ¯å°±å«åœ°å€ç©ºé—´æ˜ å°„æŠ€æœ¯ï¼ŒæŠŠè™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€å»ºç«‹å…³ç³»ã€‚å¯¹äºè¿™ç§å…³ç³»è¡¨å°±å«åšé¡µè¡¨ï¼Œç”±äºæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿå†…å­˜ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªè¿›ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œé¡µè¡¨å°±æ˜¯æŸ¥è¯¢è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜å…³ç³»çš„ï¼Œä½†å¯¹äºçº¿ç¨‹éƒ½æ˜¯å…±äº«åœ°å€ç©ºé—´çš„ï¼Œä¸æ¶‰åŠåˆ°ç©ºé—´åœ°å€çš„è½¬æ¢ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å›ç­”ä¸ºä»€ä¹ˆè™šæ‹Ÿåœ°å€çš„åˆ‡æ¢æ˜¯æ¶ˆè€—æ€§èƒ½çš„äº†ï¼Œè¿›ç¨‹çš„åˆ‡æ¢é¦–å…ˆå°±éœ€è¦æŠŠè™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼Œå°±éœ€è¦æŸ¥è¯¢é¡µè¡¨ï¼ŒæŸ¥è¯¢æ˜¯å¾ˆæ…¢çš„ï¼Œæ‰€ä»¥å°±ä¼šéœ€è¦ä¸€ä¸ªcacheæ¥ç¼“å­˜å¸¸ç”¨çš„åœ°å€è½¬æ¢ï¼Œå½“è™šæ‹Ÿåœ°å€è¿›è¡Œåˆ‡æ¢æ—¶ï¼Œå°±éœ€è¦æ›´æ–°é¡µè¡¨çš„ä¿¡æ¯å’Œç¼“å­˜ï¼Œæ­¤æ—¶æŸ¥è¡¨å°±å¾ˆæ…¢ï¼Œè¡¨ç°å¤„ç†çš„å°±æ˜¯åº”ç”¨ç¨‹åºçš„æ…¢ï¼Œä½†çº¿ç¨‹å°±ä¸éœ€è¦æ“ä½œäº†ã€‚</p><p>æ€»çš„æ¥è¯´å°±æ˜¯ï¼Œè¿›ç¨‹ç”±äºè‡ªèº«å†…å­˜æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥å½“åˆ‡æ¢çº¿ç¨‹å°±æ¶‰åŠåˆ°åœ°å€çš„è½¬å˜ï¼Œåœ¨è½¬å˜çš„æ—¶å€™å¯¼è‡´æ…¢çš„åŸå› æ˜¯é¡µè¡¨æŸ¥è¯¢cacheå¤±æ•ˆï¼Œéœ€è¦é‡æ–°cacheï¼Œè¿™æ ·å°±å¯¼è‡´ç¨‹åºæ…¢ã€‚çº¿ç¨‹ç”±äºå…±äº«å†…å­˜åœ°å€ï¼Œæ‰€ä»¥ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚</p><h1 id="Mysqlå¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜"><a href="#Mysqlå¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜" class="headerlink" title="Mysqlå¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜"></a>Mysqlå¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜</h1><p>é¦–å…ˆè¦çŸ¥é“Mysqlçš„å››ç±»éš”ç¦»çº§åˆ«ï¼š</p><ol><li>è¯»æœªæäº¤ï¼Œä¼šå‘ç”Ÿè„è¯»</li><li>è¯»å·²æäº¤ï¼Œä¸å¯é‡å¤è¯»</li><li>å¯é‡å¤è¯»ï¼Œå¯èƒ½äº§ç”Ÿå¹»è¯»</li><li>ä¸²è¯»</li></ol><p>å…·ä½“çš„æ„æ€æˆ‘å°±ä¸è®²äº†ï¼Œè¿™é‡Œä¸»è¦è®²Mysqlå¦‚ä½•è§£å†³å¹»è¯»é—®é¢˜ï¼Œå¹»è¯»å°±æ˜¯äº‹åŠ¡A æŒ‰ç…§ä¸€å®šæ¡ä»¶è¿›è¡Œæ•°æ®è¯»å–ï¼ŒæœŸé—´äº‹åŠ¡B æ’å…¥äº†ç›¸åŒæœç´¢æ¡ä»¶çš„æ–°æ•°æ®ï¼Œäº‹åŠ¡Aå†æ¬¡æŒ‰ç…§åŸå…ˆæ¡ä»¶è¿›è¡Œè¯»å–æ—¶ï¼Œå‘ç°äº†äº‹åŠ¡B æ–°æ’å…¥çš„æ•°æ®ã€‚</p><p>é¦–å…ˆè¦çŸ¥é“ï¼Œæˆ‘ä»¬åœ¨ç”¨SQLè¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶æ˜¯æœ‰ä¸¤ç§ä¸åŒç±»å‹çš„è¯»ï¼Œä¸€ä¸ªæ˜¯å¿«ç…§è¯»ï¼Œä¸€ä¸ªæ˜¯å½“å‰è¯»ã€‚</p><p>å¿«ç…§è¯»å°±æˆ‘ä»¬åœ¨æ‰§è¡Œselectè¯­å¥æ—¶ç”Ÿæ•ˆï¼ŒåŸºäºMVCCå¹¶å‘ç‰ˆæœ¬æ§åˆ¶ï¼Œå®ƒçš„åº•å±‚å…¶å®ä¹Ÿå¾ˆç®€å•å°±æ˜¯æœ‰ä¸€ä¸ªåˆ›å»ºç‰ˆæœ¬å·å­—æ®µå’Œåˆ é™¤ç‰ˆæœ¬å·å­—æ®µï¼Œç”¨æˆ·åœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ä¼šå¸¦ä¸Šä¸€ä¸ªè‡ªå·±æ‹¿åˆ°çš„ç‰ˆæœ¬å·å°äºæˆ–ç­‰äºå½“å‰ç‰ˆæœ¬å·å’Œåˆ é™¤ç‰ˆæœ¬å·ä¸ºç©ºæˆ–è€…å¤§äºå½“å‰ç‰ˆæœ¬çš„å‚æ•°ã€‚</p><p>å½“å‰è¯»å°±æ˜¯åœ¨æ•°æ®åº“è¯»å–æœ€æ–°æ•°æ®ï¼Œinsert,delete,updateçš„æ“ä½œé»˜è®¤å°±æ˜¯å½“å‰è¯»ï¼Œè¿˜æœ‰å°±æ˜¯å½“æˆ‘ä»¬çš„selectå¸¦ä¸Šäº†å…±äº«é”lock in share modelå’Œç‹¬å é”for updateï¼Œå¦‚æœå¹¶å‘è¯»å†™éƒ½æ˜¯å½“å‰è¯»çº§åˆ«ï¼Œé‚£å°±ä¸ä¼šå‡ºç°å¹»è¯»é—®é¢˜ï¼Œæ­¤æ—¶åŠ ä¸Šäº†next-key-lockï¼Œæ˜¯è®°å½•é”å’Œé—´éš™é”çš„ç»“åˆã€‚åˆ©ç”¨ç´¢å¼•ï¼ŒæŠŠåˆ—ä¸Šé”®å€¼èŒƒå›´åˆ†æˆäº†ä¸€äº›åŒºé—´ï¼ˆå·¦å¼€å³é—­ï¼‰ï¼ŒåŠ é”æ˜¯æ ¹æ®æŸ¥è¯¢æ¡ä»¶å°ä½æ»¡è¶³æ¡ä»¶çš„åŒºé—´ï¼ˆå³ä½¿è®°å½•ä¸å­˜åœ¨ï¼‰ï¼Œä½¿å¾—è¿™äº›åŒºé—´æ— æ³•è¢«ä¿®æ”¹ï¼Œå®ç°äº†å¹»è¯»çš„é¿å…ã€‚</p><p><strong>å¦‚æœselectä¸åŠ é”ï¼Œè‡ªåŠ¨é€‚åº”MVCCï¼Œå†™å´æ˜¯å½“å‰è¯»ï¼Œå°±å¯èƒ½å‡ºç°è„è¯»</strong></p><h1 id="Mysqlçš„Undo-logæ—¥å¿—çš„ç†è§£"><a href="#Mysqlçš„Undo-logæ—¥å¿—çš„ç†è§£" class="headerlink" title="Mysqlçš„Undo logæ—¥å¿—çš„ç†è§£"></a>Mysqlçš„Undo logæ—¥å¿—çš„ç†è§£</h1><p>undo logï¼Œå°±æ˜¯å¤§å®¶ç»å¸¸æ‰€è¯´çš„å›æ»šæ—¥å¿—ã€‚</p><p>å®ƒé‡Œé¢è®°å½•çš„æ˜¯å¯¹æ•°æ®çš„å›æ»šæ“ä½œã€‚å½“æˆ‘ä»¬å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®æœ‰å˜åŠ¨æ“ä½œçš„æ—¶å€™ï¼Œä¸ºäº†å¯ä»¥å›æ»šåˆ°æ•°æ®è¢«æ”¹åŠ¨ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå°±æŠŠæ•°æ®çš„å˜åŠ¨è¿‡ç¨‹çš„é€†å‘æ“ä½œç»™è®°å½•åœ¨undo logä¸­ã€‚æˆ‘ä»¬å¯¹æ•°æ®åº“çš„æŸ¥è¯¢æŸ¥æ‰¾æ˜¯ä¸ä¼šè®°å½•undo logçš„ï¼Œåªæœ‰æ•°æ®åº“ä¸­çš„æ•°æ®æœ‰å˜åŒ–çš„æ“ä½œæ‰ä¼šè®°å½•undo logã€‚</p><p>æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªinsertè¯­å¥ï¼Œåœ¨undo logä¸­å°±è®°å½•ä¸€ä¸ªdeleteè¯­å¥ï¼Œç”¨äºåˆ é™¤æ‰åˆšæ’å…¥çš„æ•°æ®ï¼Œä»¥æ­¤æ¥è¾¾åˆ°å›æ»šåˆ°æ’å…¥ä¹‹å‰çš„çŠ¶æ€ï¼›</p><p>æˆ‘ä»¬æ‰§è¡Œäº†ä¸€ä¸ªupdateè¯­å¥ï¼Œåœ¨undo logä¸­ä¹Ÿè®°å½•ä¸€ä¸ªupateè¯­å¥ï¼Œåªä¸è¿‡è¿™ä¸ªupdateè¯­å¥çš„å†…å®¹æ˜¯æŠŠæˆ‘ä»¬åˆšæ‰æ‰§è¡Œupdateæ“ä½œçš„æ•°æ®å†…å®¹ç»™ä¿®æ”¹å›å»ï¼Œä»¥æ­¤è¾¾åˆ°å›æ»šåˆ°æ•°æ®ä¿®æ”¹ä¹‹å‰çš„çŠ¶æ€ï¼›</p><p>æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªdeleteè¯­å¥ï¼Œåœ¨undo logä¸­å°±è®°å½•ä¸€ä¸ªinsertè¯­å¥ï¼Œç”¨äºæŠŠåˆšæ‰åˆ é™¤çš„æ•°æ®å†æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œä»¥æ­¤æ¥è¾¾åˆ°å›æ»šåˆ°åˆ é™¤ä¹‹å‰çš„çŠ¶æ€ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼šundo logä¸­è®°å½•çš„å†…å®¹æ˜¯å¦‚ä½•æŠŠæ•°æ®è¿˜åŸåˆ°å˜åŠ¨ä¹‹å‰çš„çŠ¶æ€ï¼Œæ ¹æ®è¿™ä¸ªæ—¥å¿—ä¸­çš„è®°å½•ï¼Œå°±å¯ä»¥æŠŠæ•°æ®è¿˜åŸåˆ°ä¸Šä¸€ä¸ªäº‹åŠ¡æäº¤åçš„çŠ¶æ€ã€‚</p><p>è¿˜ç”¨Undo Logæ¥å®ç°å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(ç®€ç§°ï¼šMVCC)ã€‚Undo Logæ˜¯ä¸ºäº†å®ç°äº‹åŠ¡çš„åŸå­æ€§ã€‚ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„åŸå­æ€§ï¼Œè¿™é‡Œç®€å•æä¸€å¥ï¼šä¸€ä¸ªäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸èƒ½åªæäº¤éƒ¨åˆ†æ“ä½œã€‚åœ¨å¤±è´¥çš„æ—¶å€™å›ï¼Œéœ€è¦å›æ»šä¹‹å‰çš„éƒ¨åˆ†æ“ä½œï¼Œè€Œè¿™ä¸ªå›æ»šæ“ä½œå°±æ˜¯ä¾èµ–äºæˆ‘ä»¬ä»Šå¤©æåˆ°çš„undo logã€‚ä»undo logé‡Œé¢å»å›æ»šæ•°æ®åˆ°äº‹åŠ¡å¼€å¯ä¹‹å‰çš„çŠ¶æ€ã€‚</p><p>äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆä¸åšä»»ä½•æ“ä½œï¼Œä¸èƒ½åªåšéƒ¨åˆ†æ“ä½œã€‚å¦‚æœåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œè¦å›æ»š(Rollback)åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ã€‚</p><p>è€Œredologæ˜¯ä¸ºäº†å®ç°äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œè¦æŠŠæ‰€æœ‰å¯¹æ•°æ®çš„ä¿®æ”¹ï¼ŒæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œåªè¦äº‹åŠ¡æäº¤æˆåŠŸäº†ï¼Œä¸èƒ½å› ä¸ºé‡å¯ã€å®•æœºç­‰åŸå› å¯¼è‡´æäº¤çš„æ•°æ®ä¸¢å¤±äº†ï¼Œä¸è§äº†ã€‚è¿™é‡Œï¼ŒæŠŠredoå’Œundoä¸¤ç§logå¯¹ç…§è®°ä¸€ä¸‹ã€‚</p><p>äº‹åŠ¡ä¸€æ—¦å®Œæˆï¼Œè¯¥äº‹åŠ¡å¯¹æ•°æ®åº“æ‰€åšçš„æ‰€æœ‰ä¿®æ”¹éƒ½ä¼šæŒä¹…çš„ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ä¸ºäº†ä¿è¯æŒä¹…æ€§ï¼Œæ•°æ®åº“ç³»ç»Ÿä¼šå°†ä¿®æ”¹åçš„æ•°æ®å®Œå…¨çš„è®°å½•åˆ°æŒä¹…çš„å­˜å‚¨ä¸Šã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>éšç¬”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>éšç¬”02</title>
    <link href="/2021/04/16/%E9%9A%8F%E7%AC%9402/"/>
    <url>/2021/04/16/%E9%9A%8F%E7%AC%9402/</url>
    
    <content type="html"><![CDATA[<h1 id="httpså®ç°åŸç†"><a href="#httpså®ç°åŸç†" class="headerlink" title="httpså®ç°åŸç†"></a>httpså®ç°åŸç†</h1><p>æœ€è¿‘çœ‹çš„ä¸€ç¯‡é¢è¯•æ€»ç»“ï¼ŒåŸä½œè€…å†™çš„æœ‰ä¸€ä¸¢ä¸¢é—®é¢˜ï¼Œä¸‹é¢è¿™ç¯‡è®²çš„å¾ˆæ¸…æ¥š</p><p><a href="https://blog.csdn.net/u014756827/article/details/102851812?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_baidulandingword-0&spm=1001.2101.3001.4242">æ·±å…¥ç†è§£https</a></p><p>åœ¨æ­¤ä¹‹å‰ï¼Œéœ€è¦äº†è§£å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„åŸç†å’Œæ•ˆç‡å¯¹æ¯”</p><p>å¯¹ç§°åŠ å¯†ï¼Œå°±æ˜¯åŠ å¯†å’Œè§£å¯†ç”¨çš„<strong>åŒä¸€æŠŠå¯†é’¥</strong>ï¼ŒåŠ å¯†å’Œè§£å¯†é€Ÿåº¦å¿«</p><p>éå¯¹ç§°åŠ å¯†ï¼ŒåŠ å¯†ç”¨å…¬é’¥ï¼Œ<strong>è§£å¯†ç”¨å¯†é’¥ï¼Œå…¬é’¥æ˜¯å…¬å¼€çš„</strong>ï¼Œä½†åœ¨è§£å¯†çš„æ—¶å€™åªæœ‰ç”¨ç›¸åº”çš„å¯†é’¥æ‰èƒ½è§£å¯†ï¼ŒåŠ å¯†å’Œè§£å¯†é€Ÿåº¦æ…¢ã€‚</p><p>httpsè§£å†³çš„httpçš„ä¸‰å¤§é—®é¢˜ï¼š</p><ol><li>æ˜æ–‡ä¼ è¾“ï¼Œè£¸å¥”</li><li>æ¶ˆæ¯çš„å®Œæ•´æ€§æ— æ³•åˆ¤æ–­</li><li>é€šä¿¡èº«ä»½å¯èƒ½è¢«ä¼ªé€ </li></ol><p>åŸºäºä»¥ä¸Šä¸‰å¤§é—®é¢˜ï¼Œè®²ä¸‹httpsåœ¨è¿›è¡Œä¼ è¾“çš„æ—¶å€™æ˜¯å¦‚ä½•è§£å†³çš„ï¼š</p><ol><li><p>Cè¯·æ±‚httpsåŸŸåï¼Œ443ç«¯å£ï¼Œæºå¸¦æµè§ˆå™¨æ”¯æŒçš„hashç®—æ³•å’ŒåŠ å¯†ç®—æ³•</p></li><li><p>Sæ˜¯æœ‰CAä¸€å¯¹ç§é’¥å’Œå…¬é’¥ï¼Œç§é’¥æ˜¯ä¸€å®šä¸èƒ½åœ¨ç½‘ä¸Šç›´æ¥ä¼ è¾“çš„ï¼Œæ‰€ä»¥æŠŠå…¬é’¥å’Œè¿”å›æµè§ˆå™¨æ”¯æŒçš„hashç®—æ³•å’ŒåŠ å¯†ç®—æ³•</p></li><li><p>Cå°±è¦æ ¡éªŒå…¬é’¥çš„åˆæ³•æ€§ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æµè§ˆå™¨å†…éƒ¨çš„TSLå®Œæˆï¼Œä¸»è¦æ ¡éªŒè¯æ•°æ˜¯å¦ä¸åŸŸååŒ¹é…ï¼Œæ˜¯å¦åˆ°æœŸï¼Œæ ¡éªŒé€šè¿‡çš„è¯ï¼Œå°±è¿›å…¥ä¸‹ä¸€ä¸ªæ­¥éª¤ï¼Œæ²¡é€šè¿‡å°±ä¼šåœ¨Cæç¤ºç›¸åº”çš„ä¿¡æ¯</p></li><li><p>Céšæœºç”Ÿæˆä¸€ä¸ªXï¼Œé€šè¿‡å…¬é’¥åŠ å¯†ï¼Œä¼ è¾“ç»™Sï¼ŒSè¿›è¡Œç§é’¥è§£å¯†â€”â€”<strong>å”¯ä¸€ä¸€æ¬¡éå¯¹ç§°åŠ å¯†</strong></p></li><li><p>åé¢çš„ä¿¡æ¯ä¼ è¾“éƒ½æ˜¯å¯¹ç§°åŠ å¯†ï¼Œå› ä¸ºXè¿™ä¸ªå°±æ˜¯å¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼Œå·§å¦™çš„é€šè¿‡CAè®¤è¯ï¼Œ<strong>å®ç°éå¯¹ç§°åŠ å¯†æ¥ä¼ è¾“å¯¹ç§°åŠ å¯†å¯†é’¥</strong></p></li></ol><p>å¦‚ä¸Š1ï¼Œ3å·²ç»è¢«è§£å†³ï¼Œå¯¹äºæ¶ˆæ¯å®Œæ•´æ€§ï¼Œæ˜¯é€šè¿‡æ•°å­—ç­¾åå®ç°ï¼ŒSé€šè¿‡æµè§ˆå™¨æ”¯æŒçš„Hashç®—æ³•å’Œç”¨ç§é’¥åŠ å¯†æ‘˜è¦ä¿¡æ¯å‘é€ç»™Cï¼ŒCé€šè¿‡å…¬é’¥è§£æè·å¾—ç›¸åº”ä¿¡æ¯ï¼Œå¯¹æ”¶åˆ°çš„åŸæ–‡è¿›è¡Œåœ¨æ‘˜è¦ä¿¡æ¯åŒ¹é…ï¼Œä¸€æ ·åˆ™è¯´æ˜æ¶ˆæ¯å…·æœ‰å®Œæ•´æ€§ã€‚</p><h1 id="å¸¸è§çš„ç½‘ç»œæ”»å‡»"><a href="#å¸¸è§çš„ç½‘ç»œæ”»å‡»" class="headerlink" title="å¸¸è§çš„ç½‘ç»œæ”»å‡»"></a>å¸¸è§çš„ç½‘ç»œæ”»å‡»</h1><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p>è·¨ç«™è„šæœ¬æ”»å‡»ï¼ŒæŒ‡çš„æ˜¯æ”»å‡»è€…é€šè¿‡é¡µé¢è¾“å…¥æ¶æ„æ‰§è¡Œä»£ç ï¼Œæ¯”å¦‚åµŒå…¥JavaScriptæ‰§è¡Œä»£ç ï¼Œå‘é€åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰è¿›è¡Œè¿‡æ»¤æ“ä½œï¼Œå°±å¯èƒ½ç›´æ¥ä¿å­˜åˆ°æ•°æ®åº“ï¼Œé¡µé¢åˆ·æ–°çš„å†…å®¹ç›´æ¥ä»æ•°æ®åº“é‡Œæ‹¿åˆ°ï¼Œå°±ä¼šæ‰§è¡Œè¿™æ®µJavaScriptä»£ç ï¼Œæ¯”å¦‚alert(â€œâ€)å‡½æ•°ç­‰ç­‰</p><p>åŸå› ï¼šæ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¿›è¡Œä¸€ä¸ªè¿‡æ»¤å’Œè½¬ä¹‰æ“ä½œ</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><p>å¯¹é‡è¦çš„cookieè®¾ç½®httpOnlyï¼Œé˜²æ­¢ç”¨æˆ·ç›´æ¥é€šè¿‡document.cookieä¿®æ”¹cookie</p></li><li><p>å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤å’Œè½¬ç§»æ“ä½œï¼Œå–å‡ºæ¶æ„çš„æ‰§è¡Œä»£ç </p><p>â€‹</p></li></ol><h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><p>è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œå½“ç”¨æˆ·æˆåŠŸç™»å½•ä¿¡ä»»çš„Aç³»ç»Ÿï¼Œåœ¨æœªé€€å‡ºçš„æƒ…å†µä¸‹å»è¯·æ±‚æœªä¿¡ä»»çš„Bç³»ç»Ÿï¼Œå‡å¦‚Bæ²¡æœ‰åšCSRFæ”»å‡»é˜²å¾¡ï¼ŒBç³»ç»Ÿå°±ä¼šç›´æ¥è·å–Aç³»ç»Ÿé‡Œçš„cookieï¼Œç„¶åç›´æ¥å»è¯·æ±‚Aç³»ç»Ÿçš„æ¥å£ï¼Œè¾¾åˆ°æœªç™»å½•Aç³»ç»Ÿè€Œå®ç°æ“ä½œAç³»ç»Ÿçš„ç›®çš„ï¼Œä»è€Œè¿›è¡Œç ´åã€‚</p><p>æ¯”å¦‚ä¸€ä¸ªè½¬è´¦ç³»ç»Ÿï¼Œç”¨æˆ·åœ¨æœªå…³é—­è½¬è£…ç³»ç»Ÿçš„åŒæ—¶å»å¼€å¯ä¸€ä¸ªå±é™©ç½‘ç«™ï¼Œç½‘ç«™è‡ªå¸¦è·å–cookieç„¶åæºå¸¦cookieå‘è‡ªå·±çš„è´¦æˆ·è¿›è¡Œè½¬è´¦ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>åœ¨Aç³»ç»Ÿåœ¨è¯·æ±‚å¤´ä¸­å‡å¦‚Refereå­—æ®µè¿›è¡Œé™åˆ¶ï¼Œå¯¹è¯·æ±‚çš„IPè¿›è¡Œé™åˆ¶</li><li>å°½é‡ä½¿ç”¨POSTï¼Œè€Œä¸æ˜¯GET</li><li>åŠ å…¥éªŒè¯ç </li><li>ä½¿ç”¨Tokenè¿›è¡Œæ ¡éªŒ</li></ol><h2 id="XSRF"><a href="#XSRF" class="headerlink" title="XSRF"></a>XSRF</h2><p>æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼Œå¾ˆå¤šç½‘ç«™å› ä¸ºå‡ºäºå®‰å…¨çš„è€ƒè™‘æ˜¯é€šè¿‡æ”¾åœ¨å…¬ç½‘çš„æœåŠ¡å™¨å»è®¿é—®å†…ç½‘æœåŠ¡å™¨ï¼Œä½†å¦‚æœæ²¡æœ‰å¢åŠ å®‰å…¨æªæ–½ï¼Œå°±ä¼šè¾¾åˆ°ç›´æ¥é€šè¿‡æœåŠ¡ç«¯å®ç°è®¿é—®å…¬ç½‘æœåŠ¡å™¨èµ„æºçš„åŠŸèƒ½ã€‚</p><p>åŸå› ï¼šå†…ç½‘åœ¨æ¥æ”¶è¯·æ±‚çš„æ—¶å€™æ²¡æœ‰è¿›è¡Œè¿‡æ»¤å’Œé™åˆ¶æ“ä½œ</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><p>ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼Œæ”»å‡»è€…æ— æ³•é€šè¿‡çŠ¶æ€ç å¾—çŸ¥æœåŠ¡å™¨çš„çŠ¶æ€</p></li><li><p>ç¦ç”¨å…¶ä»–ç«¯å£ï¼Œåªæä¾›80ï¼Œ443ï¼Œ8080ç«¯å£ç­‰</p></li><li><p>é™åˆ¶åè®®ï¼Œåªæ”¯æŒhttp,httpsåè®®</p></li><li><p>è®¾ç½®IPé»‘åå•</p><p>â€‹</p></li></ol><h2 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h2><p>SQLæ³¨å…¥ä¹Ÿæ˜¯å¸¸è§çš„ç½‘ç»œæ”»å‡»ï¼Œæ¯”å¦‚åœ¨ç™»å½•çš„æ—¶å€™è¾“å…¥ç”¨æˆ·åæ—¶ç”¨or 1 &#x3D; 1è¿™ç§æ’ç­‰çš„æ¡ä»¶è¿›è¡Œæ‹¼æ¥ï¼Œè‹¥æœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œé¢„ç¼–è¯‘æ“ä½œï¼Œé‚£å°±ç›´æ¥æ‹¼æ¥åœ¨ç™»å½•çš„SQLä¸Šï¼Œä»è€Œç»•è¿‡ç™»å½•è¯·æ±‚å®ç°ç™»å½•ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>æ•°æ®åº“ä½¿ç”¨é¢„ç¼–è¯‘ï¼Œæ¯”å¦‚é‡‡ç”¨Mybatisçš„#è¿›è¡Œå°±æ‹¼æ¥æ“ä½œï¼Œè€Œä¸æ˜¯$è¿™ç§ç›´æ¥è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥çš„æ“ä½œ</li><li>å¯¹å‰ç«¯ä¼ æ¥çš„æ•°æ®è¿›è¡Œæ•°æ®ç±»å‹åˆ¤æ–­</li><li>å­˜å‚¨è¿‡ç¨‹ï¼Œåœ¨æ•°æ®åº“çº§åˆ«è¿›è¡Œç™»å½•éªŒè¯</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>éšç¬”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>éšç¬”01</title>
    <link href="/2021/04/13/%E9%9A%8F%E7%AC%9401/"/>
    <url>/2021/04/13/%E9%9A%8F%E7%AC%9401/</url>
    
    <content type="html"><![CDATA[<h1 id="ArrayListå’ŒLinkedListåŒºåˆ«"><a href="#ArrayListå’ŒLinkedListåŒºåˆ«" class="headerlink" title="ArrayListå’ŒLinkedListåŒºåˆ«"></a>ArrayListå’ŒLinkedListåŒºåˆ«</h1><p>å¯¹äºè¿™ä¸¤ç§æ•°æ®ç»“æ„çš„åŸºç¡€æ¯”è¾ƒï¼Œå¦‚ï¼Œçº¿ç¨‹å®‰å…¨é—®é¢˜ã€åº•å±‚ç»“æ„ï¼Œç©ºé—´å ç”¨é—®é¢˜æˆ‘å°±ä¸å¤šè¯´äº†ï¼Œç½‘ä¸Šå¾ˆå¤šæ–‡æ¡£å†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œè¿™é‡Œæˆ‘è¯¦ç»†çš„è®²ä¸‹è‡ªå·±å¯¹ArrayListå’ŒLinkedListåœ¨æ•°æ®çš„æŸ¥è¯¢ï¼Œå¢åŠ ï¼Œåˆ é™¤å’Œä¿®æ”¹ä¸Šçš„æ€§èƒ½å·®å¼‚ï¼š</p><p>è¦åˆ†æåœ¨ä¸‰ç§æƒ…å†µä¸‹çš„å·®å¼‚ï¼Œé¦–å…ˆè¦æ¸…æ¥šä¸¤ç§å®¹å™¨å®ƒçš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆï¼ŒArrayListåº•å±‚æ˜¯æ•°ç»„å®ç°çš„ï¼Œè¿ç»­çš„åœ°å€å†…å­˜ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯å¸¦ç´¢å¼•ï¼›LinkedListåº•å±‚æ˜¯åŒå‘é“¾è¡¨ï¼Œä¸æ˜¯è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè€Œä¸”åŒå‘é“¾è¡¨çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜æ”¾å‰é©±ï¼Œå½“å‰ï¼Œåç»§èŠ‚ç‚¹ä¿¡æ¯ã€‚</p><ol><li>æŸ¥è¯¢ï¼šä¸€èˆ¬å°±ä¸¤ç§æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æŸç´¢å¼•çš„å…ƒç´ å’ŒæŸ¥è¯¢æŸå…ƒç´ çš„ç´¢å¼•ï¼Œæ¯”å¦‚æŸ¥è¯¢ç¬¬Nä¸ªç´¢å¼•ä¸‹çš„å…ƒç´ ï¼Œè¿™ä¸ªæ¯«æ— ç–‘é—®æ˜¯ArrayListå¿«ï¼Œå› ä¸ºå®ƒåº•å±‚æ˜¯æ•°ç»„ï¼Œæ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼ŒLinkedListä¸æ˜¯è¿ç»­çš„ï¼Œåªèƒ½ä¸€ä¸ªæ¥ç€ä¸€ä¸ªçš„å»æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n)ã€‚å¯¹äºæŸ¥è¯¢æŸå…ƒç´ çš„ç´¢å¼•ï¼Œä¸¤ç§å®¹å™¨å°±åªèƒ½éå†äº†ï¼Œæ•ˆç‡æ˜¯å·®ä¸å¤šçš„</li><li>æ’å…¥ï¼Œä¹Ÿåˆ†æ’å…¥çš„ä½ç½®ï¼Œæ˜¯å¤´éƒ¨ï¼Œæ˜¯ä¸­é—´ï¼Œæ˜¯æœ«å°¾ï¼Ÿæ­¤æ—¶ArrayListçš„è¿ç»­çš„å†…å­˜åœ°å€è¿™ä¸ªç‰¹ç‚¹å°±å˜æˆåŠ£åŠ¿äº†ï¼Œå½“æ’å…¥åˆ°å¤´éƒ¨å’Œä¸­é—´éƒ¨åˆ†ï¼ŒArraylistå°±éœ€è¦æ•°ç»„çš„copyæˆ–è€…æ‰©å®¹ï¼Œæ•ˆç‡æ˜¯å¾ˆä½çš„ï¼Œä½†æ’å…¥åˆ°å°¾éƒ¨ï¼Œå°±å¯ä»¥ç›´æ¥æ’å…¥ï¼ˆä¸è€ƒè™‘æ‰©å®¹ï¼‰ã€‚å¯¹äºLinkedListæˆ‘æƒ³æœ‰æ•°æ®ç»“æ„åŸºç¡€çš„æœ‹å‹éƒ½ä¼šç›´åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€å­˜å‚¨çš„æ•°æ®æ˜¯ä»€ä¹ˆï¼Œæ’å…¥å¤´éƒ¨æˆ–è€…ä¸­éƒ¨åªéœ€è¦ä¿®æ”¹ä¸‹å¾…æ’å…¥èŠ‚ç‚¹çš„å‰é©±å’Œåç»§å³å¯ï¼Œæ’å…¥å°¾éƒ¨ä¹Ÿåªéœ€ç›´æ¥æ’å…¥å³å¯ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(1)ã€‚æ‰€ä»¥åœ¨æ’å…¥çš„ä½ç½®æ˜¯å¤´éƒ¨å’Œä¸­éƒ¨æ˜¯ï¼ŒLinkedListå‡­å€Ÿè‡ªèº«å­˜å‚¨æ•°æ®çš„ç‰¹ç‚¹æ‹¥æœ‰ç»å¯¹çš„ä¼˜åŠ¿ï¼Œåœ¨æ’å…¥åˆ°å°¾éƒ¨æ—¶ä¸¤è€…æ€§èƒ½å·®ä¸å¤šã€‚</li><li>ä¿®æ”¹ï¼Œæˆ‘åªè®¨è®ºæŒ‰ç´¢å¼•ä¿®æ”¹çš„ï¼Œä¸ç®¡ä½ç½®å¦‚ä½•å¯¹äºArrayListå¯ä»¥ç›´æ¥æ ¹æ®ç´¢å¼•ä¿®æ”¹å…ƒç´ å€¼ã€‚ä½†å¯¹äºLinkedListç»´æŠ¤äº†é¦–å°¾æŒ‡é’ˆï¼Œä¿®æ”¹é¦–ä½æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œå¯¹äºä¸­é—´çš„éœ€è¦æ˜¯ç”¨äºŒåˆ†æŸ¥æ‰¾å®ç°çš„ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(logn)</li><li>åˆ é™¤ï¼šå½“åˆ é™¤æŒ‡å®šç´¢å¼•çš„å…ƒç´ æˆ–è€…æŒ‡å®šå…ƒç´ æ—¶ï¼Œä¸¤è€…å·®åˆ«å’Œæ’å…¥ç±»ä¼¼ï¼Œå¯¹äºåˆ é™¤æŒ‡å®šçš„ç´¢å¼•å…ƒç´ åœ¨å¤´éƒ¨æˆ–è€…åœ¨ä¸­éƒ¨ï¼ŒArrayListå°±éœ€è¦è¿›è¡Œæ•°ç»„çš„è¿ç§»ï¼Œæ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦éƒ½å¾ˆé«˜ï¼Œä½†åˆ é™¤æŒ‡å®šçš„ç´¢å¼•åœ¨æœ«å°¾ï¼Œå°±ç›´æ¥ç½®ç©ºå°±è¡Œäº†ã€‚å¯¹äºLinkedListéœ€è¦éå†æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œåœ¨ä¿®æ”¹å‰åçš„å‰é©±å’Œåç»§ï¼Œä½†æ€»ä½“æ•ˆç‡é«˜äºArrayListï¼Œè€Œä¸”å®ƒç»´æŠ¤äº†å¤´å°¾æŒ‡é’ˆï¼Œå¯¹äºåˆ é™¤å¤´å°¾çš„æ˜¯å¾ˆå¿«çš„ã€‚</li></ol><p>æ€»çš„æ¥è¯´ï¼ŒArrayListç”±äºåº•å±‚æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥æŸ¥è¯¢å¿«ï¼Œä½†åˆ é™¤å’Œæ’å…¥æ…¢ã€‚LinkedListæ˜¯åŒå‘é“¾è¡¨ï¼ŒæŸ¥è¯¢æ…¢ï¼Œä½†åˆ é™¤å’Œæ’å…¥å¿«ã€‚ä¿®æ”¹ä¸¤è€…å·®å¼‚ä¸å¤§ã€‚</p><h1 id="å•çº¿ç¨‹ä¸‹å¯¹ArralListè¿›è¡Œåˆ é™¤æ“ä½œæŠ›å‡ºå¹¶å‘ä¿®æ”¹å¼‚å¸¸åˆ†æ"><a href="#å•çº¿ç¨‹ä¸‹å¯¹ArralListè¿›è¡Œåˆ é™¤æ“ä½œæŠ›å‡ºå¹¶å‘ä¿®æ”¹å¼‚å¸¸åˆ†æ" class="headerlink" title="å•çº¿ç¨‹ä¸‹å¯¹ArralListè¿›è¡Œåˆ é™¤æ“ä½œæŠ›å‡ºå¹¶å‘ä¿®æ”¹å¼‚å¸¸åˆ†æ"></a>å•çº¿ç¨‹ä¸‹å¯¹ArralListè¿›è¡Œåˆ é™¤æ“ä½œæŠ›å‡ºå¹¶å‘ä¿®æ”¹å¼‚å¸¸åˆ†æ</h1><p>å•çº¿ç¨‹ä¸‹å¯èƒ½å¾ˆå¤šäººæ— æ³•æƒ³è±¡ä¸ºä»€ä¹ˆä¹Ÿä¼šæŠ›å‡ºå¹¶å‘ä¿®æ”¹å¼‚å¸¸ï¼Œä½¿ç”¨list.remove(object)å°±ä¼šæŠ›å‡ºè¯¥å¼‚å¸¸ï¼Œæ‰€ä»¥å½“å•çº¿ç¨‹éœ€è¦åˆ é™¤å…ƒç´ æ—¶éœ€è¦ç”¨è¿­ä»£å™¨çš„removeæ–¹æ³•ï¼ŒäºŒè€…çš„å·®å¼‚åœ¨å“ªï¼Ÿæ·±å…¥æºç å‘ç°ï¼ŒæŠ›å‡ºå¼‚å¸¸çš„æ¡ä»¶æ˜¯modCountå’ŒexpectCountä¸ç›¸ç­‰ï¼Œæˆ‘ä»¬éœ€è¦è®°ä½è¿™ä¸ªæ¡ä»¶ï¼ç‚¹å¼€Arraylistçš„removeå‘ç°å®ƒè°ƒç”¨çš„æ˜¯fastRemoveï¼Œä¸€è¿›å»å°±ç›´æ¥æŠŠmodCount++ï¼Œç„¶åè¿›è¡Œåˆ é™¤æ“ä½œï¼Œç›´æ¥æŠŠexpectedCountæŒ‚ä¸€éäº†ï¼Œä¸æŠ›å¼‚å¸¸æ‰å¥‡æ€ªå‘¢</p><p>æ¥ç€è¿›å…¥è¿­ä»£å™¨çš„removeæ–¹æ³•ï¼Œå‘ç°å®ƒæ˜¯å…ˆè°ƒç”¨çš„Arraylist.removeï¼Œä»ä¸Šé¢æˆ‘ä»¬å°±çŸ¥é“æ­¤æ—¶modCountè‚¯å®šè‡ªå¢äº†ï¼Œä½†æ¥ä¸‹æ¥å°±æŠŠè¿›è¡Œäº†expected &#x3D; modcountçš„æ“ä½œï¼Œè¿™å°±å®ç°äº†ä¸¤è€…ç›¸ç­‰ï¼Œä¸æŠ›å‡ºå¼‚å¸¸äº†ã€‚</p><h1 id="HashMapçš„æ•°ç»„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2-nï¼Œåˆå§‹å¤§å°ä¸ºä»€ä¹ˆæ˜¯16ï¼Ÿ"><a href="#HashMapçš„æ•°ç»„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2-nï¼Œåˆå§‹å¤§å°ä¸ºä»€ä¹ˆæ˜¯16ï¼Ÿ" class="headerlink" title="HashMapçš„æ•°ç»„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2^nï¼Œåˆå§‹å¤§å°ä¸ºä»€ä¹ˆæ˜¯16ï¼Ÿ"></a>HashMapçš„æ•°ç»„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2^nï¼Œåˆå§‹å¤§å°ä¸ºä»€ä¹ˆæ˜¯16ï¼Ÿ</h1><p>hash&amp;(table.length-1)å…¶å®æœ¬è´¨ä¸Šå°±æ˜¯hash%table.length-1ï¼Œåªæ˜¯ä½è¿ç®—æ•ˆç‡é«˜äºç›´æ¥%ï¼Œè¿™ä¸ªåœ¨å‰ælengthçš„é•¿åº¦ä¸º2çš„Næ¬¡æ–¹ä¸‹æˆç«‹çš„ï¼Œæ‰€ä»¥è¦æ±‚tabeçš„é•¿åº¦æ˜¯2çš„Næ¬¡æ–¹</p><p>å¯¹äºåˆå§‹é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯16ï¼Œè¿™ä¸ªå®˜æ–¹ä¹Ÿæ²¡ç»™å‡ºç»“æœï¼Œåœ¨é˜¿é‡Œå¼€å‘æ‰‹å†Œé‡Œï¼Œå¯¹äºçŸ¥é“é•¿åº¦çš„map,éœ€è¦æŒ‡å®šåˆå§‹å®¹é‡å¤§å°ï¼Œè®¡ç®—ä¸ºå¤§äºç»™å‡ºæ•°æ®çš„2^nï¼Œæ¯”å¦‚ç»™å‡º4 ï¼Œé‚£å°±æ˜¯8ï¼Œç»™å‡º7ï¼Œä¹Ÿæ˜¯8ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>éšç¬”</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rediså¿…çŸ¥å¿…ä¼š</title>
    <link href="/2021/04/02/Redis%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/"/>
    <url>/2021/04/02/Redis%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/</url>
    
    <content type="html"><![CDATA[<p><img src="https://i.loli.net/2021/04/02/HcTdmkXUhQVpaNz.png"></p><p>Redisç»å¯¹æ˜¯å½“ä¸‹éå¸¸ç«çƒ­çš„ä¸€ä¸ªNoSqlæ•°æ®åº“ï¼Œåœ¨ä¹‹å‰çš„åšå®¢ä¸­ï¼Œæˆ‘å·²ç»è®²åˆ°äº†springbooté›†æˆredisçš„ä½¿ç”¨ï¼Œä»Šå¤©åœ¨è¿™é‡Œåˆ†äº«ä¸‹Rediså¸¸é—®é¢è¯•é¢˜</p><h1 id="1-ä¸ºä»€ä¹ˆä½¿ç”¨Redisï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆä½¿ç”¨Redisï¼Ÿ" class="headerlink" title="1.ä¸ºä»€ä¹ˆä½¿ç”¨Redisï¼Ÿ"></a>1.ä¸ºä»€ä¹ˆä½¿ç”¨Redisï¼Ÿ</h1><p>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Redisï¼Œä¸»è¦è€ƒè™‘ä¸¤ä¸ªè§’åº¦ï¼šæ€§èƒ½å’Œå¹¶å‘ã€‚å¦‚æœåªæ˜¯ä¸ºäº†åˆ†å¸ƒå¼é”è¿™äº›å…¶ä»–åŠŸèƒ½ï¼Œè¿˜æœ‰å…¶ä»–ä¸­é—´ä»¶ Zookpeer ç­‰ä»£æ›¿ï¼Œå¹¶éä¸€å®šè¦ä½¿ç”¨ Redisã€‚</p><p><strong>æ€§èƒ½ï¼š</strong></p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åœ¨ç¢°åˆ°éœ€è¦æ‰§è¡Œè€—æ—¶ç‰¹åˆ«ä¹…ï¼Œä¸”ç»“æœä¸é¢‘ç¹å˜åŠ¨çš„ SQLï¼Œå°±ç‰¹åˆ«é€‚åˆå°†è¿è¡Œç»“æœæ”¾å…¥ç¼“å­˜ã€‚è¿™æ ·ï¼Œåé¢çš„è¯·æ±‚å°±å»ç¼“å­˜ä¸­è¯»å–ï¼Œä½¿å¾—è¯·æ±‚èƒ½å¤Ÿè¿…é€Ÿå“åº”ã€‚</p><p>ç‰¹åˆ«æ˜¯åœ¨ç§’æ€ç³»ç»Ÿï¼Œåœ¨åŒä¸€æ—¶é—´ï¼Œå‡ ä¹æ‰€æœ‰äººéƒ½åœ¨ç‚¹ï¼Œéƒ½åœ¨ä¸‹å•ï¼Œæ‰§è¡Œçš„æ˜¯åŒä¸€æ“ä½œâ€”â€”å‘æ•°æ®åº“æŸ¥æ•°æ®ã€‚</p><p><img src="https://i.loli.net/2021/04/02/bIGELFasS2dhCP1.png"></p><p>æ ¹æ®äº¤äº’æ•ˆæœçš„ä¸åŒï¼Œå“åº”æ—¶é—´æ²¡æœ‰å›ºå®šæ ‡å‡†ã€‚åœ¨ç†æƒ³çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬çš„é¡µé¢è·³è½¬éœ€è¦åœ¨ç¬é—´è§£å†³ï¼Œå¯¹äºé¡µå†…æ“ä½œåˆ™éœ€è¦åœ¨åˆ¹é‚£é—´è§£å†³ã€‚</p><p><strong>å¹¶å‘ï¼š</strong></p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨å¤§å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œæ•°æ®åº“ä¼šå‡ºç°è¿æ¥å¼‚å¸¸ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨ Redis åšä¸€ä¸ªç¼“å†²æ“ä½œï¼Œè®©è¯·æ±‚å…ˆè®¿é—®åˆ° Redisï¼Œè€Œä¸æ˜¯ç›´æ¥è®¿é—®æ•°æ®åº“ã€‚</p><p><img src="https://i.loli.net/2021/04/02/PnzoO35fYTwcK7C.png"></p><h1 id="2-Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ"><a href="#2-Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="2.Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ"></a>2.Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ</h1><p>Redisçš„é€Ÿåº¦éå¸¸çš„å¿«ï¼Œå•æœºçš„Rediså°±å¯ä»¥æ”¯æŒæ¯ç§’10å‡ ä¸‡çš„å¹¶å‘ï¼Œç›¸å¯¹äºmysqlæ¥è¯´ï¼Œæ€§èƒ½æ˜¯mysqlçš„å‡ åå€ã€‚é€Ÿåº¦å¿«çš„åŸå› ä¸»è¦æœ‰ï¼š</p><ol><li>å®Œå…¨åŸºäºå†…å­˜æ“ä½œ</li><li>Cè¯­è¨€å®ç°ï¼Œä¼˜åŒ–è¿‡çš„æ•°æ®ç»“æ„ï¼ŒåŸºäºå‡ ç§åŸºç¡€çš„æ•°æ®ç»“æœï¼ŒRedisåšäº†å¤§é‡çš„ä¼˜åŒ–ï¼Œæ€§èƒ½æé«˜</li><li>ä½¿ç”¨å•çº¿ç¨‹ï¼Œæ— ä¸Šä¸‹æ–‡çš„åˆ‡æ¢æˆæœ¬ï¼ˆredisçš„å•çº¿ç¨‹æ˜¯æŒ‡ç½‘ç»œè¯·æ±‚æ¨¡å—ä½¿ç”¨äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ä¸éœ€è€ƒè™‘å¹¶å‘å®‰å…¨æ€§ã€‚ä½†æ˜¯å¯¹äºéœ€è¦ä¾èµ–å¤šä¸ªæ“ä½œçš„å¤åˆæ“ä½œæ¥è¯´ï¼Œè¿˜æ˜¯éœ€è¦é”çš„ï¼Œè€Œä¸”æœ‰å¯èƒ½æ˜¯åˆ†å¸ƒå¼é”ï¼‰</li><li>åŸºäºéé˜»å¡çš„IOå¤šè·¯å¤ç”¨æœºåˆ¶</li></ol><p>å¯¹äºéé˜»å¡çš„å¤šè·¯IOå¤ç”¨æœºåˆ¶ï¼Œå¯ä»¥æ·±å…¥çš„å»äº†è§£ä¸‹ï¼Œç®€å•çš„è¯´å°±æ˜¯å®ç°ä¸€ä¸ªçº¿ç¨‹ç›‘æ§å¤šä¸ªIOæµï¼ŒåŠæ—¶å“åº”è¯·æ±‚ï¼Œä¸¾ä¸ªæ —å­ï¼š</p><p>å°æ˜åœ¨ A åŸå¼€äº†ä¸€å®¶å¿«é¤åº—åº—ï¼Œè´Ÿè´£åŒåŸå¿«é¤æœåŠ¡ã€‚å°æ˜å› ä¸ºèµ„é‡‘é™åˆ¶ï¼Œé›‡ä½£äº†ä¸€æ‰¹é…é€å‘˜ï¼Œç„¶åå°æ˜å‘ç°èµ„é‡‘ä¸å¤Ÿäº†ï¼Œåªå¤Ÿä¹°ä¸€è¾†è½¦é€å¿«é€’ã€‚</p><p><strong>ç»è¥æ–¹å¼ä¸€</strong></p><p>å®¢æˆ·æ¯ä¸‹ä¸€ä»½è®¢å•ï¼Œå°æ˜å°±è®©ä¸€ä¸ªé…é€å‘˜ç›¯ç€ï¼Œç„¶åè®©äººå¼€è½¦å»é€ã€‚æ…¢æ…¢çš„å°æ›²å°±å‘ç°äº†è¿™ç§ç»è¥æ–¹å¼å­˜åœ¨ä¸‹è¿°é—®é¢˜ï¼š</p><ul><li>æ—¶é—´éƒ½èŠ±åœ¨äº†æŠ¢è½¦ä¸Šäº†ï¼Œå¤§éƒ¨åˆ†é…é€å‘˜éƒ½å¤„åœ¨é—²ç½®çŠ¶æ€ï¼ŒæŠ¢åˆ°è½¦æ‰èƒ½å»é€ã€‚</li><li>éšç€ä¸‹å•çš„å¢å¤šï¼Œé…é€å‘˜ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œå°æ˜å‘ç°å¿«é€’åº—é‡Œè¶Šæ¥è¶ŠæŒ¤ï¼Œæ²¡åŠæ³•é›‡ä½£æ–°çš„é…é€å‘˜äº†ã€‚</li><li>é…é€å‘˜ä¹‹é—´çš„åè°ƒå¾ˆèŠ±æ—¶é—´ã€‚</li></ul><p>ç»¼åˆä¸Šè¿°ç¼ºç‚¹ï¼Œå°æ˜ç—›å®šæ€ç—›ï¼Œæå‡ºäº†ç»è¥æ–¹å¼äºŒã€‚</p><p><strong>ç»è¥æ–¹å¼äºŒ</strong></p><p>å°æ˜åªé›‡ä½£ä¸€ä¸ªé…é€å‘˜ã€‚å½“å®¢æˆ·ä¸‹å•ï¼Œå°æ˜æŒ‰é€è¾¾åœ°ç‚¹æ ‡æ³¨å¥½ï¼Œä¾æ¬¡æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚æœ€åï¼Œè®©é…é€å‘˜ä¾æ¬¡å¼€ç€è½¦å»é€ï¼Œé€å¥½äº†å°±å›æ¥æ‹¿ä¸‹ä¸€ä¸ªã€‚ä¸Šè¿°ä¸¤ç§ç»è¥æ–¹å¼å¯¹æ¯”ï¼Œå¾ˆæ˜æ˜¾ç¬¬äºŒç§æ•ˆç‡æ›´é«˜ã€‚</p><p>åœ¨ä¸Šè¿°æ¯”å–»ä¸­ï¼š</p><ul><li>æ¯ä¸ªé…é€å‘˜â†’æ¯ä¸ªçº¿ç¨‹</li><li>æ¯ä¸ªè®¢å•â†’æ¯ä¸ª Socket(I&#x2F;O æµ)</li><li>è®¢å•çš„é€è¾¾åœ°ç‚¹â†’Socket çš„ä¸åŒçŠ¶æ€</li><li>å®¢æˆ·é€é¤è¯·æ±‚â†’æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚</li><li>æ˜æ›²çš„ç»è¥æ–¹å¼â†’æœåŠ¡ç«¯è¿è¡Œçš„ä»£ç </li><li>ä¸€è¾†è½¦â†’CPU çš„æ ¸æ•°</li></ul><p>äºæ˜¯æœ‰äº†å¦‚ä¸‹ç»“è®ºï¼š</p><ul><li>ç»è¥æ–¹å¼ä¸€å°±æ˜¯ä¼ ç»Ÿçš„å¹¶å‘æ¨¡å‹ï¼Œæ¯ä¸ª I&#x2F;O æµ(è®¢å•)éƒ½æœ‰ä¸€ä¸ªæ–°çš„çº¿ç¨‹(é…é€å‘˜)ç®¡ç†ã€‚</li><li>ç»è¥æ–¹å¼äºŒå°±æ˜¯ I&#x2F;O å¤šè·¯å¤ç”¨ã€‚åªæœ‰å•ä¸ªçº¿ç¨‹(ä¸€ä¸ªé…é€å‘˜)ï¼Œé€šè¿‡è·Ÿè¸ªæ¯ä¸ª I&#x2F;O æµçš„çŠ¶æ€(æ¯ä¸ªé…é€å‘˜çš„é€è¾¾åœ°ç‚¹)ï¼Œæ¥ç®¡ç†å¤šä¸ª I&#x2F;O æµã€‚</li></ul><p>ç±»æ¯”åˆ°çœŸå®çš„çº¿ç¨‹æ¨¡å‹ï¼š</p><p><img src="https://i.loli.net/2021/04/02/UwdoC85NJMgk2m3.png"></p><p>Redis-client åœ¨æ“ä½œçš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿå…·æœ‰ä¸åŒäº‹ä»¶ç±»å‹çš„ Socketã€‚åœ¨æœåŠ¡ç«¯ï¼Œæœ‰ä¸€æ®µ I&#x2F;O å¤šè·¯å¤ç”¨ç¨‹åºï¼Œå°†å…¶ç½®å…¥é˜Ÿåˆ—ä¹‹ä¸­ã€‚ç„¶åï¼Œæ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼Œä¾æ¬¡å»é˜Ÿåˆ—ä¸­å–ï¼Œè½¬å‘åˆ°ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ä¸­ã€‚</p><p>ç›®å‰æ”¯æŒI&#x2F;Oå¤šè·¯å¤ç”¨çš„ç³»ç»Ÿè°ƒç”¨æœ‰<strong>select</strong>ï¼Œ<strong>pselect</strong>ï¼Œ<strong>poll</strong>ï¼Œ<strong>epoll</strong>ç­‰å‡½æ•°ã€‚I&#x2F;Oå¤šè·¯å¤ç”¨å°±æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶<strong>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦</strong>ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ªï¼Œå…¶èƒ½å¤Ÿé€šçŸ¥åº”ç”¨ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œã€‚</p><p><strong>å¤šè·¯I&#x2F;Oå¤ç”¨æœºåˆ¶</strong>ä¸å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æŠ€æœ¯ç›¸æ¯”ç³»ç»Ÿå¼€é”€å°ï¼Œç³»ç»Ÿä¸å¿…åˆ›å»ºè¿›ç¨‹&#x2F;çº¿ç¨‹ï¼Œä¹Ÿä¸å¿…ç»´æŠ¤è¿™äº›è¿›ç¨‹&#x2F;çº¿ç¨‹ï¼Œä»è€Œå¤§å¤§å‡å°äº†ç³»ç»Ÿçš„å¼€é”€ã€‚</p><p>å¸¸è§å‡½æ•°çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><ol><li><p>selectå‡½æ•°ï¼š</p><ul><li>ä¼šä¿®æ”¹ä¼ å…¥çš„å‚æ•°æ•°ç»„ï¼Œè¿™ä¸ªå¯¹äºä¸€ä¸ªéœ€è¦è°ƒç”¨å¾ˆå¤šæ¬¡çš„å‡½æ•°ï¼Œæ˜¯éå¸¸ä¸å‹å¥½çš„ã€‚</li><li>æœ‰æœ€å¤§ç›‘å¬è¿æ¥æ•°1024ä¸ªçš„é™åˆ¶</li><li>å¦‚æœä»»ä½•ä¸€ä¸ªsock(I&#x2F;O stream)å‡ºç°äº†æ•°æ®ï¼Œselectæ²¡æœ‰è¿”å›å…·ä½“æ˜¯å“ªä¸ªè¿”å›äº†æ•°æ®ï¼Œéœ€è¦é‡‡ç”¨è½®è¯¢çš„æ–¹å¼å»éå†è·å–</li><li>çº¿ç¨‹ä¸å®‰å…¨ï¼ˆå½“ä½ åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å·²ç»ç›‘å¬è¯¥socketï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æƒ³è¦å°†è¯¥socketå…³é—­ï¼Œåˆ™ç»“æœä¼šä¸å¯é¢„çŸ¥ï¼‰</li></ul></li><li><p>pollå‡½æ•°ï¼š</p><ul><li>å»æ‰äº†1024çš„é™åˆ¶ï¼ˆä½¿ç”¨é“¾è¡¨æå®šï¼‰</li><li>ä¸å†ä¿®æ”¹ä¼ å…¥çš„å‚æ•°æ•°ç»„</li><li>ä¾ç„¶æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</li></ul></li><li><p>epollå‡½æ•°</p><ul><li><p>epollä¸ä»…è¿”å›socketç»„é‡Œé¢æ•°æ®ï¼Œè¿˜å¯ä»¥ç¡®å®šå…·ä½“å“ªä¸ªsocketæœ‰æ•°æ®</p></li><li><p>çº¿ç¨‹ä¸å®‰å…¨</p><p>â€‹</p></li></ul></li></ol><h1 id="Redisæ”¯æŒå“ªäº›æ•°æ®ç±»å‹ï¼Œåº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"><a href="#Redisæ”¯æŒå“ªäº›æ•°æ®ç±»å‹ï¼Œåº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Redisæ”¯æŒå“ªäº›æ•°æ®ç±»å‹ï¼Œåº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"></a>Redisæ”¯æŒå“ªäº›æ•°æ®ç±»å‹ï¼Œåº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</h1><p>redisæ”¯æŒäº”ç§æ•°æ®ç±»å‹ä½œä¸ºå…¶Valueï¼Œredisçš„Keyéƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ã€‚</p><blockquote><p>redisæ²¡æœ‰ç›´æ¥ä½¿â½¤Cè¯­â¾”ä¼ ç»Ÿçš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œâ½½æ˜¯â¾ƒâ¼°å®ç°çš„å«åšç®€å•åŠ¨æ€å­—ç¬¦ä¸²SDSçš„</p><p>æŠ½è±¡ç±»å‹ã€‚Cè¯­â¾”çš„å­—ç¬¦ä¸²ä¸è®°å½•â¾ƒèº«çš„â»“åº¦ä¿¡æ¯ï¼Œâ½½SDSåˆ™ä¿å­˜äº†â»“åº¦ä¿¡æ¯ï¼Œè¿™æ ·å°†è·å–å­—ç¬¦ä¸²â»“åº¦çš„æ—¶é—´ç”±O(N)é™ä½åˆ°äº†O(1)ï¼ŒåŒæ—¶å¯ä»¥é¿å…ç¼“å†²åŒºæº¢å‡ºå’Œå‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²â»“åº¦æ—¶æ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°ã€‚</p></blockquote><ul><li><strong>string</strong>ï¼šRedizä¸­å­—ç¬¦ä¸²Valueæœ€å¤§å¯ä¸º512Mã€‚å¯ä»¥ç”¨æ¥åšä¸€äº›è®¡æ•°åŠŸèƒ½çš„ç¼“å­˜ï¼ˆä¹Ÿæ˜¯å®é™…å·¥ä½œä¸­æœ€å¸¸è§çš„ï¼‰</li><li><strong>list</strong>ï¼šç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ï¼Œå…¶åº•å±‚å®ç°æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚å¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯æ¨é€åŠŸèƒ½ï¼ŒåšåŸºäºredisçš„åˆ†é¡µåŠŸèƒ½ç­‰</li><li><strong>set</strong>ï¼šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„æ— åºé›†åˆã€‚å¯ä»¥ç”¨æ¥è¿›è¡Œå…¨å±€å»é‡ç­‰ã€‚</li><li><strong>sorted set</strong>ï¼šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„æœ‰åºé›†åˆï¼Œç»™æ¯ä¸€ä¸ªå…ƒç´ ä¸€ä¸ªå›ºå®šçš„åˆ†æ•°scoreæ¥ä¿å­˜é¡ºåºã€‚å¯ä»¥ç”¨æ¥åšæ’è¡Œæ¦œåº”ç”¨æˆ–è€…è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾ç­‰</li><li><strong>hash</strong>ï¼šé”®å€¼å¯¹é›†åˆï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„keyå’Œvalueçš„æ˜ å°„è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´å…¶å­˜å‚¨çš„valueæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆkeyâ€”valueï¼‰ã€‚å¯ä»¥ç”¨æ¥å­˜æ”¾ä¸€äº›å…·ä½“ç‰¹å®šç»“æ„çš„ä¿¡æ¯ã€‚</li></ul><p>èˆ¬æƒ…å†µä¸‹ï¼Œå¯ä»¥è®¤ä¸ºredisçš„æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰ä¸Šè¿°äº”ç§ï¼Œå…¶åº•å±‚æ•°æ®ç»“æ„åŒ…æ‹¬ï¼š<strong>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼Œé“¾è¡¨ï¼Œå­—å…¸ï¼Œè·³è¡¨ï¼Œæ•´æ•°é›†åˆä»¥åŠå‹ç¼©åˆ—è¡¨ã€‚</strong></p><p>è¿™ç¯‡æ–‡ç« è®²äº†å¾ˆå¤šç”¨rediså®ç°çš„ä¸šåŠ¡æ¨¡å‹ï¼š</p><p><a href="https://blog.csdn.net/zzu_seu/article/details/106323114?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161709361516780265416508%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=161709361516780265416508&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-106323114.pc_search_result_no_baidu_js&utm_term=redis%E7%9A%84%E4%BA%94%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">Redisäº”ç§æ•°æ®ç»“æ„å’Œä½¿ç”¨åœºæ™¯</a></p><h1 id="ä¸ºä»€ä¹ˆRedis6-0ä¹‹ååˆæ”¹ç”¨å¤šçº¿ç¨‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆRedis6-0ä¹‹ååˆæ”¹ç”¨å¤šçº¿ç¨‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆRedis6.0ä¹‹ååˆæ”¹ç”¨å¤šçº¿ç¨‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆRedis6.0ä¹‹ååˆæ”¹ç”¨å¤šçº¿ç¨‹ï¼Ÿ</h1><p>redisä½¿ç”¨å¤šçº¿ç¨‹å¹¶éæ˜¯å®Œå…¨æ‘’å¼ƒå•çº¿ç¨‹ï¼Œredisè¿˜æ˜¯ä½¿â½¤å•çº¿ç¨‹æ¨¡å‹æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œåªæ˜¯ä½¿â½¤å¤šçº¿ç¨‹æ¥å¤„ç†æ•°æ®çš„è¯»å†™å’Œåè®®è§£æï¼Œæ‰§â¾å‘½ä»¤è¿˜æ˜¯ä½¿â½¤å•çº¿ç¨‹ã€‚</p><p>è¿™æ ·åšçš„ç›®çš„æ˜¯å› ä¸ºredisçš„æ€§èƒ½ç“¶é¢ˆåœ¨äºç½‘ç»œIOè€ŒéCPUï¼Œä½¿ç”¨å¤šçº¿ç¨‹èƒ½æå‡IOè¯»å†™çš„æ•ˆç‡ï¼Œä»è€Œæ•´ä½“æé«˜redisçš„æ€§èƒ½ã€‚</p><h1 id="çƒ­keyæ˜¯ä»€ä¹ˆï¼Ÿçƒ­keyé—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#çƒ­keyæ˜¯ä»€ä¹ˆï¼Ÿçƒ­keyé—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="çƒ­keyæ˜¯ä»€ä¹ˆï¼Ÿçƒ­keyé—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿ"></a>çƒ­keyæ˜¯ä»€ä¹ˆï¼Ÿçƒ­keyé—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿ</h1><p>çƒ­keyå°±æ˜¯çªç„¶æœ‰<strong>å‡ åä¸‡çš„è¯·æ±‚å»è®¿é—®redisä¸Šçš„æŸä¸ªç‰¹å®šçš„key</strong>ï¼Œé‚£ä¹ˆè¿™æ ·ä¼šé€ æˆæµé‡è¿‡äºé›†ä¸­ï¼Œè¾¾åˆ°ç‰©ç†ç½‘å¡ä¸Šé™ï¼Œä»è€Œå¯¼è‡´è¿™å°redisçš„æœåŠ¡å™¨å®•æœºå¼•å‘é›ªå´©ã€‚</p><p><img src="https://i.loli.net/2021/04/02/RtPKjb9lgx8QE23.png"></p><p>é’ˆå¯¹çƒ­keyçš„è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>æå‰æŠŠçƒ­keyæ‰“æ•£åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œé™ä½å‹åŠ›</li><li>åŠ å…¥äºŒçº§ç¼“å­˜ï¼Œæå‰åŠ è½½çƒ­keyæ•°æ®åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœrediså®•æœºï¼Œèµ°å†…å­˜æŸ¥è¯¢</li></ol><h1 id="ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€å’Œç¼“å­˜é›ªå´©ä¸‰è¿é—®"><a href="#ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€å’Œç¼“å­˜é›ªå´©ä¸‰è¿é—®" class="headerlink" title="ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€å’Œç¼“å­˜é›ªå´©ä¸‰è¿é—®"></a>ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€å’Œç¼“å­˜é›ªå´©ä¸‰è¿é—®</h1><p><strong>ç¼“å­˜å‡»ç©¿</strong></p><p>ç¼“å­˜å‡»ç©¿æŒ‡çš„æ˜¯å•ä¸ªkeyå¹¶å‘è®¿é—®è¿‡é«˜ï¼Œè¿‡æœŸæ—¶å¯¼è‡´æ‰€æœ‰è¯·æ±‚ç›´æ¥æ‰“åˆ°dbä¸Šï¼Œè¿™ä¸ªå’Œçƒ­keyçš„é—®é¢˜æ¯”è¾ƒç±»ä¼¼ï¼Œåªæ˜¯è¯´çš„ç‚¹<strong>åœ¨äºkeyè¿‡æœŸå¯¼è‡´è¯·æ±‚æ‰“åˆ°dbä¸Š</strong>ã€‚</p><p><img src="https://i.loli.net/2021/04/02/tgPf8UqNDnQA4Xw.png"></p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><p>åŠ é”æ›´æ–°ï¼Œæ¯”å¦‚è¯·æ±‚æŸ¥è¯¢Aï¼Œå‘ç°ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå¯¹Aè¿™ä¸ªkeyåŠ é”ï¼ŒåŒæ—¶å»æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œå†™å…¥ç¼“å­˜ï¼Œå†è¿”å›ç»™ç”¨æˆ·ï¼Œè¿™æ ·åâ¾¯çš„è¯·æ±‚å°±å¯ä»¥ä»ç¼“å­˜ä¸­æ‹¿åˆ°æ•°æ®äº†ã€‚å½“ç„¶åŠ é”ä¼šæœ‰ç‚¹æ…¢ï¼Œä½†å¥½æ¯”å®•æœºå¼ºã€‚</p></li><li><p>å°†è¿‡æœŸæ—¶é—´ç»„åˆå†™åœ¨valueä¸­ï¼Œé€šè¿‡å¼‚æ­¥çš„â½…å¼ä¸æ–­çš„åˆ·æ–°è¿‡æœŸæ—¶é—´ï¼Œé˜²â½Œæ­¤ç±»ç°è±¡ã€‚</p></li></ol><p><strong>ç¼“å­˜ç©¿é€</strong></p><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸å­˜åœ¨ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ‰“åˆ°DBï¼Œå°±åƒç¼“å­˜ä¸å­˜åœ¨â¼€æ ·ã€‚</p><p><img src="https://i.loli.net/2021/04/02/zYXirowEVHNAbex.png"></p><p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒåŠ â¼€å±‚å¸ƒéš†è¿‡æ»¤å™¨ã€‚å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†æ˜¯åœ¨ä½ å­˜â¼Šæ•°æ®çš„æ—¶å€™ï¼Œä¼šé€šè¿‡æ•£åˆ—å‡½æ•°å°†å®ƒæ˜ å°„ä¸ºâ¼€ä¸ªä½æ•°ç»„ä¸­çš„Kä¸ªç‚¹ï¼ŒåŒæ—¶æŠŠä»–ä»¬ç½®ä¸º1ã€‚</p><p><img src="https://i.loli.net/2021/04/02/gl7DSthOTvB4dUk.png"></p><p>è¿™æ ·å½“â½¤æˆ·å†æ¬¡æ¥æŸ¥è¯¢Aï¼Œâ½½Aåœ¨å¸ƒéš†è¿‡æ»¤å™¨å€¼ä¸º0ï¼Œç›´æ¥è¿”å›ï¼Œå°±ä¸ä¼šäº§â½£å‡»ç©¿è¯·æ±‚æ‰“åˆ°DBäº†ã€‚</p><p>æ˜¾ç„¶ï¼Œä½¿â½¤å¸ƒéš†è¿‡æ»¤å™¨ä¹‹åä¼šæœ‰â¼€ä¸ªé—®é¢˜å°±æ˜¯è¯¯åˆ¤ï¼Œå› ä¸ºå®ƒæœ¬èº«æ˜¯â¼€ä¸ªæ•°ç»„ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªå€¼è½åˆ°åŒâ¼€ä¸ªä½ç½®ï¼Œé‚£ä¹ˆç†è®ºä¸Šæ¥è¯´åªè¦æˆ‘ä»¬çš„æ•°ç»„â»“åº¦å¤Ÿâ»“ï¼Œè¯¯åˆ¤çš„æ¦‚ç‡å°±ä¼šè¶Šä½ï¼Œè¿™ç§é—®é¢˜å°±æ ¹æ®å®é™…æƒ…å†µæ¥å°±å¥½äº†ã€‚</p><p>å¯¹äºå¸ƒéš†è¿‡æ»¤å™¨ï¼Œä¸‹é¢è¿™ç¯‡æ–‡ç« è®²çš„å¾ˆæ¸…æ¥šï¼š</p><p><a href="https://blog.csdn.net/madongyu1259892936/article/details/85267620">å¸ƒéš†è¿‡æ»¤å™¨</a></p><p><strong>ç¼“å­˜é›ªå´©</strong></p><p>å½“æŸâ¼€æ—¶åˆ»å‘â½£â¼¤è§„æ¨¡çš„ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼Œâ½å¦‚ä½ çš„ç¼“å­˜æœåŠ¡å®•æœºäº†ï¼Œä¼šæœ‰â¼¤é‡çš„è¯·æ±‚è¿›æ¥ç›´æ¥æ‰“åˆ°DBä¸Šï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„å´©æºƒï¼Œç§°ä¸ºé›ªå´©ã€‚é›ªå´©å’Œå‡»ç©¿ã€çƒ­keyçš„é—®é¢˜ä¸å¤ªâ¼€æ ·çš„æ˜¯ï¼Œä»–æ˜¯æŒ‡â¼¤è§„æ¨¡çš„ç¼“å­˜éƒ½è¿‡æœŸå¤±æ•ˆäº†ã€‚</p><p><img src="https://i.loli.net/2021/04/02/tkv89MCsAH3c2SR.png"></p><p>é’ˆå¯¹ç¼“å­˜é›ªå´©çš„å‡ ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p><ol><li>é’ˆå¯¹ä¸åŒkeyè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…åŒæ—¶è¿‡æœŸ</li><li>é™æµï¼Œå¦‚æœrediså®•æœºï¼Œå¯ä»¥é™æµï¼Œé¿å…åŒæ—¶åˆ»å¤§é‡è¯·æ±‚æ‰“å´©db</li><li>äºŒçº§ç¼“å­˜ï¼ŒåŒçƒ­keyçš„æ–¹æ¡ˆ</li></ol><h1 id="Redisçš„è¿‡æœŸç­–ç•¥"><a href="#Redisçš„è¿‡æœŸç­–ç•¥" class="headerlink" title="Redisçš„è¿‡æœŸç­–ç•¥"></a>Redisçš„è¿‡æœŸç­–ç•¥</h1><p><strong>æƒ°æ€§åˆ é™¤</strong></p><p>æƒ°æ€§åˆ é™¤æŒ‡çš„æ˜¯å½“æˆ‘ä»¬æŸ¥è¯¢keyçš„æ—¶å€™æ‰å¯¹keyè¿›â¾æ£€æµ‹ï¼Œå¦‚æœå·²ç»è¾¾åˆ°è¿‡æœŸæ—¶é—´ï¼Œåˆ™åˆ é™¤ã€‚æ˜¾ç„¶ï¼Œä»–æœ‰â¼€ä¸ªç¼ºç‚¹å°±æ˜¯å¦‚æœè¿™äº›è¿‡æœŸçš„keyæ²¡æœ‰è¢«è®¿é—®ï¼Œé‚£ä¹ˆä»–å°±â¼€ç›´â½†æ³•è¢«åˆ é™¤ï¼Œâ½½ä¸”â¼€ç›´å â½¤å†…å­˜ã€‚</p><p><img src="https://i.loli.net/2021/04/02/yOUg7Z8sneljt5K.png"></p><p><strong>å®šæœŸåˆ é™¤</strong></p><p>å®šæœŸåˆ é™¤æŒ‡çš„æ˜¯redisæ¯éš”ä¸€æ®µæ—¶é—´å¯¹æ•°æ®åº“åšä¸€æ¬¡æ£€æŸ¥ï¼Œåˆ é™¤é‡Œé¢è¿‡æœŸçš„keyã€‚ç”±äºä¸å¯èƒ½å¯¹æ‰€æœ‰keyå»åšè½®è¯¢åˆ é™¤ï¼Œæ‰€ä»¥redisä¼šæ¯æ¬¡éšæœºå–ä¸€äº›keyå»åšæ£€æŸ¥å’Œåˆ é™¤</p><h1 id="å®šæœŸ-æƒ°æ€§åˆ é™¤éƒ½æ²¡åˆ é™¤è¿‡æœŸçš„keyæ€ä¹ˆåŠï¼Ÿ"><a href="#å®šæœŸ-æƒ°æ€§åˆ é™¤éƒ½æ²¡åˆ é™¤è¿‡æœŸçš„keyæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="å®šæœŸ+æƒ°æ€§åˆ é™¤éƒ½æ²¡åˆ é™¤è¿‡æœŸçš„keyæ€ä¹ˆåŠï¼Ÿ"></a>å®šæœŸ+æƒ°æ€§åˆ é™¤éƒ½æ²¡åˆ é™¤è¿‡æœŸçš„keyæ€ä¹ˆåŠï¼Ÿ</h1><p>å‡è®¾redisæ¯æ¬¡å®šæœŸéšæœºæŸ¥è¯¢keyçš„æ—¶å€™æ²¡æœ‰åˆ æ‰ï¼Œè¿™äº›keyä¹Ÿæ²¡åšæŸ¥è¯¢ï¼Œå°±ä¼šå¯¼è‡´keyä¸€ç›´ä¿å­˜åœ¨redisé‡Œé¢æ— æ³•è¢«åˆ é™¤ï¼Œè¿™æ—¶å€™å°±ä¼šèµ°åˆ°redisçš„å†…å­˜æ·˜æ±°æœºåˆ¶ã€‚</p><ol><li>volatile-lruï¼šä»å·²è®¾ç½®è¿‡æœŸçš„keyä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘æ—¶å€™çš„keyè¿›è¡Œæ·˜æ±°</li><li>volatike-ttlï¼šä»å·²è®¾ç½®è¿‡æœŸçš„keyä¸­ï¼Œç§»é™¤å°†è¦è¿‡æœŸçš„key</li><li>volatile-randomï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„keyéšæœºé€‰æ‹©keyæ·˜æ±°</li><li>allkeys-lruï¼šä»keyä¸­é€‰æ‹©æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„è¿›è¡Œæ·˜æ±°</li><li>allkeys-randï¼šä»keyä¸­éšæœºé€‰æ‹©keyè¿›è¡Œæ·˜æ±°</li><li>noevictionï¼šå½“å†…å­˜è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œæ–°å†™å…¥æ“ä½œæŠ¥é”™</li></ol><h1 id="redisçš„æŒä¹…åŒ–æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#redisçš„æŒä¹…åŒ–æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="redisçš„æŒä¹…åŒ–æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>redisçš„æŒä¹…åŒ–æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h1><p>redisæŒä¹…åŒ–åˆ†ä¸ºRDBå’ŒAOFä¸¤ç§</p><p><strong>RDB(å¿«ç…§æ–¹å¼ snapshotting) å…¨é‡æŒä¹…åŒ–</strong></p><p>RDBæŒä¹…åŒ–å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œä¹Ÿå¯ä»¥æ ¹æ®é…ç½®å®šæœŸæ‰§è¡Œï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ•°æ®åº“çŠ¶æ€ä¿å­˜åˆ°RDBâ½‚ä»¶ä¸­ï¼ŒRDBâ½‚ä»¶æ˜¯â¼€ä¸ªå‹ç¼©çš„â¼†è¿›åˆ¶â½‚ä»¶ï¼Œé€šè¿‡å®ƒå¯ä»¥è¿˜åŸæŸä¸ªæ—¶åˆ»æ•°æ®åº“çš„çŠ¶æ€ã€‚ç”±äºRDBâ½‚ä»¶æ˜¯ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šçš„ï¼Œæ‰€ä»¥å³ä½¿rediså´©æºƒæˆ–è€…é€€å‡ºï¼Œåªè¦RDBâ½‚ä»¶å­˜åœ¨ï¼Œå°±å¯ä»¥â½¤å®ƒæ¥æ¢å¤è¿˜åŸæ•°æ®åº“çš„çŠ¶æ€ã€‚</p><p>å¯ä»¥é€šè¿‡SAVEæˆ–è€…BGSAVEæ¥ç”ŸæˆRDBæ–‡ä»¶</p><p>SAVEå‘½ä»¤ä¼šé˜»å¡redisè¿›ç¨‹ï¼Œç›´åˆ°RDBæ–‡ä»¶ç”Ÿæˆå®Œæ¯•ï¼Œåœ¨è¿›ç¨‹é˜»å¡æœŸé—´ï¼Œredisä¸èƒ½å¤„ç†ä»»ä½•å‘½ä»¤è¯·æ±‚ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„ã€‚</p><p>BGSAVEåˆ™æ˜¯ä¼šforkå‡ºâ¼€ä¸ªâ¼¦è¿›ç¨‹ï¼Œç„¶åç”±â¼¦è¿›ç¨‹å»è´Ÿè´£â½£æˆRDBâ½‚ä»¶ï¼Œâ½—è¿›ç¨‹è¿˜å¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ï¼Œä¸ä¼šé˜»å¡è¿›ç¨‹ã€‚</p><p>åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶å€™ï¼ŒRDBç›¸å¯¹äºAOFè¦å¿«</p><p><strong>AOF(append only file) å¢é‡æŒä¹…åŒ–</strong></p><p>AOFå’ŒRDBä¸åŒï¼ŒAOFæ˜¯é€šè¿‡ä¿å­˜redisæœåŠ¡å™¨æ‰€æ‰§è¡Œçš„å†™å‘½ä»¤æ¥è®°å½•æ•°æ®åº“çŠ¶æ€çš„ã€‚</p><p>AOFé€šè¿‡è¿½åŠ ã€å†™å…¥ã€åŒæ­¥ä¸‰ä¸ªæ­¥éª¤æ¥å®ç°æŒä¹…åŒ–æœºåˆ¶</p><ol><li>å½“AOFæŒä¹…åŒ–å¤„äºæ¿€æ´»çŠ¶æ€ï¼ŒæœåŠ¡å™¨æ‰§è¡Œå†™å‘½ä»¤ä¹‹åï¼Œå†™å‘½ä»¤å°†ä¼šè¢«è¿½åŠ appendåˆ°aof_bufç¼“å†²åŒºçš„æœ«å°¾</li><li>å½“æœåŠ¡å™¨æ¯ç»“æŸä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¹‹å‰ï¼Œå°±ä¼šè°ƒç”¨flushAppendOnlyFileå‡½æ•°å†³å®šæ˜¯å¦è¦å°†aof_bufçš„å†…å®¹ä¿å­˜åˆ°AOFæ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡é…ç½®appendfsyncæ¥å†³å®š</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">always ##aof\_bufå†…å®¹å†™å…¥å¹¶åŒæ­¥åˆ°AOFæ–‡ä»¶<br>everysec ##aof\_bufä¸­å†…å®¹å†™å…¥åˆ°AOFæ–‡ä»¶ï¼Œå¦‚æœä¸Šæ¬¡åŒæ­¥AOFæ–‡ä»¶è·ç¦»ç°åœ¨è¶…è¿‡1ç§’ï¼Œåˆ™å†æ¬¡å¯¹AOFæ–‡ä»¶è¿›è¡ŒåŒæ­¥<br>no ##å°†aof\_bufå†…å®¹å†™å…¥åˆ°AOFæ–‡ä»¶ï¼Œä½†æ˜¯ä¸ä¼šå¯¹AOFæ–‡ä»¶è¿›è¡ŒåŒæ­¥ï¼ŒåŒæ­¥æ—¶é—´ç”±æ“ä½œç³»ç»Ÿå†³å®š<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤é€‰é¡¹å°†ä¼šæ˜¯everysecï¼Œå› ä¸ºalwaysæ¥è¯´è™½ç„¶æœ€å®‰å…¨ï¼ˆåªä¼šä¸¢å¤±ä¸€æ¬¡äº‹ä»¶å¾ªç¯çš„å†™å‘½ä»¤ï¼‰ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®ï¼Œè€Œeverysecæ¨¡å¼åªä¸è¿‡å¯èƒ½ä¸¢å¤±1ç§’é’Ÿçš„æ•°æ®ï¼Œè€Œnoæ¨¡å¼çš„æ•ˆç‡å’Œeverysecç›¸ä»¿ï¼Œä½†æ˜¯ä¼šä¸¢å¤±ä¸Šæ¬¡åŒæ­¥AOFæ–‡ä»¶ä¹‹åçš„æ‰€æœ‰å†™å‘½ä»¤æ•°æ®ã€‚</p><h1 id="æ€ä¹ˆå®ç°Redisçš„é«˜å¯ç”¨ï¼Ÿ"><a href="#æ€ä¹ˆå®ç°Redisçš„é«˜å¯ç”¨ï¼Ÿ" class="headerlink" title="æ€ä¹ˆå®ç°Redisçš„é«˜å¯ç”¨ï¼Ÿ"></a>æ€ä¹ˆå®ç°Redisçš„é«˜å¯ç”¨ï¼Ÿ</h1><p><strong>ä¸»ä»æ¶æ„</strong></p><p>ä¸»ä»æ¨¡å¼æ˜¯æœ€ç®€å•çš„å®ç°é«˜å¯ç”¨çš„æ–¹æ¡ˆï¼Œæ ¸å¿ƒå°±æ˜¯ä¸»ä»åŒæ­¥ã€‚ä¸»ä»åŒæ­¥çš„åŸç†å¦‚ä¸‹ï¼š</p><ol><li>slaveå‘é€syncå‘½ä»¤åˆ°master</li><li>masteræ”¶åˆ°syncä¹‹åï¼Œæ‰§è¡Œbgsaveï¼Œç”ŸæˆRDBå…¨é‡æ–‡ä»¶</li><li>masteræŠŠslaveçš„å†™å‘½ä»¤è®°å½•åˆ°ç¼“å­˜</li><li>bgsaveæ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå‘é€RDBåˆ°slaveã€slaveæ‰§è¡Œ</li><li>masterå‘é€ç¼“å­˜ä¸­çš„å†™å‘½ä»¤åˆ°slaveï¼Œslaveæ‰§è¡Œ</li></ol><p><img src="https://i.loli.net/2021/04/02/YU1cidsvu9CZfSa.png"></p><p>è¿™é‡Œä»æœºå‘é€çš„å‘½ä»¤æ˜¯syncï¼Œä½†åœ¨redis2.8ç‰ˆæœ¬ä¹‹åå°±å·²ç»ä½¿ç”¨psyncæ›¿ä»£syncï¼Œå› ä¸ºsyncéå¸¸æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œpsyncæ•ˆç‡æ›´é«˜ã€‚</p><p><strong>å“¨å…µ</strong></p><p>åŸºäºä¸»ä»æ–¹æ¡ˆçš„ç¡®å®å¾ˆæ˜æ˜¾ï¼Œå‡è®¾masterå®•æœºï¼Œé‚£ä¹ˆå°±ä¸èƒ½å†™å…¥æ•°æ®ï¼Œslaveä¹Ÿå°±å¤±å»äº†ä½œç”¨ï¼Œæ•´ä¸ªæ¶æ„å°±ä¸å¯ç”¨äº†ï¼Œé™¤éæ‰‹åŠ¨åˆ‡æ¢ï¼Œä¸»è¦åŸå› å°±æ˜¯æ²¡æœ‰è‡ªåŠ¨æ•…éšœè½¬ç§»æœºåˆ¶ã€‚è€Œå“¨å…µï¼ˆsentinelï¼‰çš„åŠŸèƒ½æ¯”å•çº¯çš„ä¸»ä»æ¶æ„å…¨é¢çš„å¤šï¼Œå®ƒå…·å¤‡è‡ªåŠ¨æ•…éšœè½¬ç§»ã€é›†ç¾¤ç›‘æ§ã€æ¶ˆæ¯é€šçŸ¥ç­‰åŠŸèƒ½ã€‚</p><p><img src="https://i.loli.net/2021/04/02/kUWqxdRO5mazLlj.png"></p><p>å“¨å…µå¯ä»¥åŒæ—¶ç›‘è§†å¤šä¸ªä¸»ä»æœåŠ¡å™¨ï¼Œå¹¶ä¸”åœ¨è¢«ç›‘è§†çš„masterä¸‹çº¿æ—¶ï¼Œè‡ªåŠ¨å°†æŸä¸ªslaveæå‡ä½masterï¼Œç„¶åç”±æ–°çš„masterç»§ç»­æ¥æ”¶å‘½ä»¤ã€‚æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>åˆå§‹åŒ–sentinelï¼Œå°†æ™®é€šçš„redisä»£ç æ›¿æ¢æˆsentinelä¸“ä¸šä»£ç </li><li>åˆå§‹åŒ–masterå­—å…¸å’ŒæœåŠ¡å™¨ä¿¡æ¯ï¼ŒæœåŠ¡å™¨ä¿¡æ¯ä¸»è¦ä¿å­˜ip:portï¼Œå¹¶è®°å½•å®ä¾‹çš„åœ°å€å’ŒID</li><li>åˆ›å»ºå’Œmasterçš„ä¸¤ä¸ªè¿æ¥ï¼Œå‘½ä»¤è¿æ¥å’Œè®¢é˜…è¿æ¥ï¼Œå¹¶ä¸”è®¢é˜…sentinel:helloé¢‘é“</li><li>æ¯éš”10ç§’å‘masterå‘é€infoå‘½ä»¤ï¼Œè·å–masterå’Œå®ƒä¸‹â¾¯æ‰€æœ‰slaveçš„å½“å‰ä¿¡æ¯</li><li>å½“å‘ç°masteræœ‰æ–°çš„slaveä¹‹åï¼Œsentinelå’Œæ–°çš„slaveåŒæ ·å»ºâ½´ä¸¤ä¸ªè¿æ¥ï¼ŒåŒæ—¶æ¯ä¸ª10ç§’å‘é€infoå‘½ä»¤ï¼Œæ›´æ–°masterä¿¡æ¯</li><li>sentinelæ¯éš”1ç§’å‘æ‰€æœ‰æœåŠ¡å™¨å‘é€pingå‘½ä»¤ï¼Œå¦‚æœæŸå°æœåŠ¡å™¨åœ¨é…ç½®çš„å“åº”æ—¶é—´å†…è¿ç»­è¿”å›â½†æ•ˆå›å¤ï¼Œå°†ä¼šè¢«æ ‡è®°ä¸ºä¸‹çº¿çŠ¶æ€</li><li>é€‰ä¸¾å‡ºé¢†å¤´sentinelï¼Œé¢†å¤´sentineléœ€è¦åŠæ•°ä»¥ä¸Šçš„sentinelåŒæ„</li><li>é¢†å¤´sentinelä»å·²ä¸‹çº¿çš„çš„masteræ‰€æœ‰slaveä¸­æŒ‘é€‰â¼€ä¸ªï¼Œå°†å…¶è½¬æ¢ä¸ºmaster</li><li>è®©æ‰€æœ‰çš„slaveæ”¹ä¸ºä»æ–°çš„masterå¤åˆ¶æ•°æ®å°†åŸæ¥çš„masterè®¾ç½®ä¸ºæ–°çš„masterçš„ä»æœåŠ¡å™¨ï¼Œå½“åŸæ¥masteré‡æ–°å›å¤è¿æ¥æ—¶ï¼Œå°±å˜æˆäº†æ–°masterçš„ä»æœåŠ¡å™¨</li></ol><p>sentinelä¼šæ¯éš”1ç§’å‘æ‰€æœ‰å®ä¾‹ï¼ˆåŒ…æ‹¬ä¸»ä»æœåŠ¡å™¨å’Œå…¶ä»–sentinelï¼‰å‘é€pingå‘½ä»¤ï¼Œå¹¶ä¸”æ ¹æ®å›å¤åˆ¤æ–­æ˜¯å¦å·²ç»ä¸‹çº¿ï¼Œè¿™ç§â½…å¼å«åšä¸»è§‚ä¸‹çº¿ã€‚å½“åˆ¤æ–­ä¸ºä¸»è§‚ä¸‹çº¿æ—¶ï¼Œå°±ä¼šå‘å…¶ä»–ç›‘è§†çš„sentinelè¯¢é—®ï¼Œå¦‚æœè¶…è¿‡åŠæ•°çš„æŠ•ç¥¨è®¤ä¸ºå·²ç»æ˜¯ä¸‹çº¿çŠ¶æ€ï¼Œåˆ™ä¼šæ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿çŠ¶æ€ï¼ŒåŒæ—¶è§¦å‘æ•…éšœè½¬ç§»ã€‚</p><h1 id="Redisäº‹åŠ¡æœºåˆ¶"><a href="#Redisäº‹åŠ¡æœºåˆ¶" class="headerlink" title="Redisäº‹åŠ¡æœºåˆ¶"></a>Redisäº‹åŠ¡æœºåˆ¶</h1><p>**éš”ç¦»æ€§ï¼š**redisæ˜¯å•è¿›ç¨‹çš„ç¨‹åºï¼Œä¿è¯åœ¨æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œä¸ä¼šå¯¹äº‹åŠ¡è¿›è¡Œä¸­æ–­ï¼Œäº‹åŠ¡å¯ä»¥è¿è¡Œç›´åˆ°æ‰§è¡Œå®Œæ‰€æœ‰äº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¸ºæ­¢ã€‚æ‰€ä»¥redisçš„äº‹åŠ¡æ”¯æŒéš”ç¦»æ€§</p><p>redisä¼šå°†ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤åºåˆ—åŒ–ï¼Œç„¶åæŒ‰é¡ºåºæ‰§è¡Œã€‚redisä¸å¯èƒ½åœ¨ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ’å…¥æ‰§è¡Œå¦ä¸€ä¸ªå®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚ã€‚å¯ä»¥ä¿è¯Rediså°†è¿™äº›å‘½ä»¤ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œæ‰§è¡Œã€‚</p><ol><li>æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚ï¼Œäº‹åŠ¡ä»¥MULTIå¼€å§‹</li><li>å¦‚æœå®¢æˆ·ç«¯æ­£å¤„äºäº‹åŠ¡çŠ¶æ€ï¼Œåˆ™ä¼šæŠŠäº‹åŠ¡æ”¾â¼Šé˜Ÿåˆ—åŒæ—¶è¿”å›ç»™å®¢æˆ·ç«¯QUEUEDï¼Œåä¹‹åˆ™ç›´æ¥æ‰§è¡Œè¿™ä¸ªå‘½ä»¤</li><li>å½“æ”¶åˆ°å®¢æˆ·ç«¯EXECå‘½ä»¤æ—¶ï¼ŒWATCHå‘½ä»¤ç›‘è§†æ•´ä¸ªäº‹åŠ¡ä¸­çš„keyæ˜¯å¦æœ‰è¢«ä¿®æ”¹ï¼Œå¦‚æœæœ‰åˆ™è¿”å›ç©ºå›å¤åˆ°å®¢æˆ·ç«¯è¡¨ç¤ºå¤±è´¥ï¼Œå¦åˆ™redisä¼šéå†æ•´ä¸ªäº‹åŠ¡é˜Ÿåˆ—ï¼Œæ‰§â¾é˜Ÿåˆ—ä¸­ä¿å­˜çš„æ‰€æœ‰å‘½ä»¤ï¼Œæœ€åè¿”å›ç»“æœç»™å®¢æˆ·ç«¯</li></ol><p>WATCHçš„æœºåˆ¶æœ¬èº«æ˜¯â¼€ä¸ªCASçš„æœºåˆ¶ï¼Œè¢«ç›‘è§†çš„keyä¼šè¢«ä¿å­˜åˆ°â¼€ä¸ªé“¾è¡¨ä¸­ï¼Œå¦‚æœæŸä¸ªkeyè¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆREDIS_DIRTY_CASæ ‡å¿—å°†ä¼šè¢«æ‰“å¼€ï¼Œè¿™æ—¶æœåŠ¡å™¨ä¼šæ‹’ç»æ‰§â¾äº‹åŠ¡ã€‚</p><p>è§£é‡Šä¸‹ï¼š</p><p>MULTIï¼šæ ‡è®°ä¸€ä¸ªäº‹åŠ¡å—çš„å¼€å§‹</p><p>EXECï¼šæ‰§è¡Œæ‰€æœ‰äº‹åŠ¡å—å†…çš„å‘½ä»¤</p><p>DISCARDï¼šå–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—çš„æ‰€æœ‰å‘½ä»¤</p><p>UNWATCHï¼šå–æ¶ˆWATCHå‘½ä»¤å¯¹æ‰€æœ‰keyçš„ç›‘è§†</p><p>WATCH key [keyâ€¦] ï¼šç›‘è§†ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰keyï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ªï¼ˆæˆ–è¿™äº›ï¼‰keyè¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­</p><p>éœ€è¦æ³¨æ„çš„æ˜¯<strong>redisçš„äº‹åŠ¡ä¸æ”¯æŒå›æ»šæ“ä½œ</strong>ï¼Œredisä»¥ MULTI å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œç„¶åå°†å¤šä¸ªå‘½ä»¤å…¥é˜Ÿåˆ°äº‹åŠ¡ä¸­ï¼Œæœ€åç”± EXEC å‘½ä»¤è§¦å‘äº‹åŠ¡ï¼Œä¸€å¹¶æ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚åªæœ‰å½“è¢«è°ƒç”¨çš„rediså‘½ä»¤æœ‰è¯­æ³•é”™è¯¯æ—¶ï¼Œè¿™æ¡å‘½ä»¤æ‰ä¼šæ‰§è¡Œå¤±è´¥ï¼Œæˆ–è€…å¯¹æŸä¸ªé”®æ‰§è¡Œä¸ç¬¦åˆå…¶æ•°æ®ç±»å‹çš„æ“ä½œï¼Œä½†æ˜¯åº”è¯¥åœ¨å°†å‘½ä»¤å…¥é˜Ÿåˆ—çš„æ—¶å€™å°±åº”è¯¥å¹¶ä¸”èƒ½å¤Ÿå‘ç°è¿™äº›é—®é¢˜ï¼Œæ‰€ä»¥redisçš„äº‹åŠ¡ä¸æ”¯æŒè¿›è¡Œå›æ»šæ“ä½œã€‚</p><h1 id="redisç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜"><a href="#redisç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="redisç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜"></a>redisç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜</h1><p><strong>ä¸ä¸€è‡´åŸå› </strong></p><p>ä¸ç®¡æ˜¯å…ˆå†™åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼›è¿˜æ˜¯å…ˆåˆ ç¼“å­˜ï¼Œå†å†™åº“ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ<br>å› ä¸ºå†™å’Œè¯»æ˜¯å¹¶å‘çš„ï¼Œæ²¡æ³•ä¿è¯é¡ºåºï¼Œå¦‚æœåˆ äº†ç¼“å­˜ï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠå†™åº“ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±æ¥è¯»å–ï¼Œå‘ç°ç¼“å­˜ä¸ºç©ºï¼Œåˆ™å»æ•°æ®åº“ä¸­è¯»å–æ•°æ®å†™å…¥ç¼“å­˜ï¼Œæ­¤æ—¶ç¼“å­˜ä¸­ä¸ºè„æ•°æ®ã€‚å¦‚æœå…ˆå†™äº†åº“ï¼Œå†åˆ é™¤ç¼“å­˜å‰ï¼Œå†™åº“çš„çº¿ç¨‹å®•æœºäº†ï¼Œæ²¡æœ‰åˆ é™¤æ‰ç¼“å­˜ï¼Œåˆ™ä¹Ÿä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æƒ…å†µã€‚<br>å¦‚æœæ˜¯redisé›†ç¾¤ï¼Œæˆ–è€…ä¸»ä»æ¨¡å¼ï¼Œå†™ä¸»è¯»ä»ï¼Œç”±äºrediså¤åˆ¶å­˜åœ¨ä¸€å®šçš„æ—¶é—´å»¶è¿Ÿï¼Œä¹Ÿæœ‰å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</p><p><strong>ä¼˜åŒ–æ€è·¯ï¼š</strong></p><p><strong>åŒåˆ +è¶…æ—¶</strong></p><p>åœ¨å†™åº“å‰åéƒ½è¿›è¡Œredis.del(key)æ“ä½œï¼Œå¹¶ä¸”è®¾å®šåˆç†çš„è¶…æ—¶æ—¶é—´ã€‚è¿™æ ·æœ€å·®çš„æƒ…å†µæ˜¯åœ¨è¶…æ—¶æ—¶é—´å†…å­˜åœ¨ä¸ä¸€è‡´ï¼Œå½“ç„¶è¿™ç§æƒ…å†µæå…¶å°‘è§ï¼Œå¯èƒ½çš„åŸå› å°±æ˜¯æœåŠ¡å®•æœºã€‚æ­¤ç§æƒ…å†µå¯ä»¥æ»¡è¶³ç»å¤§å¤šæ•°éœ€æ±‚ã€‚<br>å½“ç„¶è¿™ç§ç­–ç•¥è¦è€ƒè™‘rediså’Œæ•°æ®åº“ä¸»ä»åŒæ­¥çš„è€—æ—¶ï¼Œæ‰€ä»¥åœ¨ç¬¬äºŒæ¬¡åˆ é™¤å‰æœ€å¥½ä¼‘çœ ä¸€å®šæ—¶é—´ï¼Œæ¯”å¦‚500æ¯«ç§’ï¼Œè¿™æ ·æ¯«æ— ç–‘é—®åˆå¢åŠ äº†å†™è¯·æ±‚çš„è€—æ—¶ã€‚</p><p><strong>å¼‚æ­¥æ·˜æ±°ç¼“å­˜</strong></p><p>é€šè¿‡è¯»å–binlogçš„æ–¹å¼ï¼Œå¼‚æ­¥åˆ é™¤ç¼“å­˜</p><p><img src="https://i.loli.net/2021/04/02/Catg21HDkfwq9Nc.png"></p><p>å¥½å¤„ï¼šä¸šåŠ¡ä»£ç ä¾µå…¥æ€§ä½ï¼Œå°†ç¼“å­˜ä¸æ•°æ®åº“ä¸ä¸€è‡´çš„æ—¶é—´å°½å¯èƒ½ç¼©å°ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springå¿…çŸ¥å¿…ä¼š</title>
    <link href="/2021/03/26/Spring%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/"/>
    <url>/2021/03/26/Spring%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/</url>
    
    <content type="html"><![CDATA[<h1 id="Springä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#Springä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="Springä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>Springä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</h1><h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a><strong>å•ä¾‹æ¨¡å¼</strong></h2><p>Springä¸­çš„Beané»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯å•ä¾‹çš„ã€‚beanè¢«å£°æ˜ä¸ºå•ä¾‹çš„æ—¶å€™ï¼Œåœ¨å¤„ç†å¤šæ¬¡è¯·æ±‚çš„æ—¶å€™åœ¨Springå®¹å™¨é‡Œåªå®ä¾‹åŒ–å‡ºä¸€ä¸ªbeanï¼Œåç»­çš„è¯·æ±‚éƒ½å…¬ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šä¿å­˜åœ¨ä¸€ä¸ªmapé‡Œé¢ã€‚å½“æœ‰è¯·æ±‚æ¥çš„æ—¶å€™ä¼šå…ˆä»ç¼“å­˜(map)é‡ŒæŸ¥çœ‹æœ‰æ²¡æœ‰ï¼Œæœ‰çš„è¯ç›´æ¥ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œæ²¡æœ‰çš„è¯æ‰å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸ªå•ä¾‹çš„ã€‚ä½†æ˜¯å¯¹äºåŸå‹(prototype)beanæ¥è¯´å½“æ¯æ¬¡è¯·æ±‚æ¥çš„æ—¶å€™ç›´æ¥å®ä¾‹åŒ–æ–°çš„beanï¼Œæ²¡æœ‰ç¼“å­˜ä»¥åŠä»ç¼“å­˜æŸ¥çš„è¿‡ç¨‹ã€‚</p><ul><li><p>æ‰€ä»¥å•ä¾‹çš„beanåªæœ‰ç¬¬ä¸€æ¬¡åˆ›å»ºæ–°çš„beanåé¢å°±ä¼šå¤ç”¨beanï¼Œæ‰€ä»¥ä¸ä¼šé¢‘ç¹åˆ›å»ºå¯¹è±¡ã€‚</p></li><li><p>åŸå‹çš„beanæ¯æ¬¡éƒ½ä¼šæ–°åˆ›å»º</p></li></ul><p><strong>å•ä¾‹beançš„ä¼˜åŠ¿ï¼š</strong></p><ol><li>å‡å°‘äº†æ–°ç”Ÿæˆå®ä¾‹çš„æ¶ˆè€— æ–°ç”Ÿæˆå®ä¾‹æ¶ˆè€—åŒ…æ‹¬ä¸¤æ–¹é¢ï¼Œé¦–å…ˆï¼ŒSpringä¼šé€šè¿‡åå°„æˆ–è€…cglibæ¥ç”Ÿæˆbeanå®ä¾‹è¿™éƒ½æ˜¯è€—æ€§èƒ½çš„æ“ä½œï¼Œå…¶æ¬¡ç»™å¯¹è±¡åˆ†é…å†…å­˜ä¹Ÿä¼šæ¶‰åŠå¤æ‚ç®—æ³•</li><li>å‡å°‘jvmåƒåœ¾å›æ”¶ ç”±äºä¸ä¼šç»™æ¯ä¸ªè¯·æ±‚éƒ½æ–°ç”Ÿæˆbeanå®ä¾‹ï¼Œæ‰€ä»¥è‡ªç„¶å›æ”¶çš„å¯¹è±¡å°‘äº†</li><li>å¯ä»¥å¿«é€Ÿè·å–åˆ°bean å› ä¸ºå•ä¾‹çš„è·å–beanæ“ä½œé™¤äº†ç¬¬ä¸€æ¬¡ç”Ÿæˆä¹‹å¤–å…¶ä½™çš„éƒ½æ˜¯ä»ç¼“å­˜é‡Œè·å–çš„æ‰€ä»¥å¾ˆå¿«</li></ol><p><strong>å•ä¾‹beançš„åŠ£åŠ¿ï¼š</strong></p><p>å•ä¾‹çš„beanä¸€ä¸ªå¾ˆå¤§çš„åŠ£åŠ¿å°±æ˜¯ä»–ä¸èƒ½åšåˆ°çº¿ç¨‹å®‰å…¨ï¼ï¼ï¼ï¼Œç”±äºæ‰€æœ‰è¯·æ±‚éƒ½å…±äº«ä¸€ä¸ªbeanå®ä¾‹ï¼Œæ‰€ä»¥è¿™ä¸ªbeanè¦æ˜¯æœ‰çŠ¶æ€çš„ä¸€ä¸ªbeançš„è¯å¯èƒ½åœ¨å¹¶å‘åœºæ™¯ä¸‹å‡ºç°é—®é¢˜ï¼Œæœ‰çŠ¶æ€çš„Beanï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸å®‰å…¨ï¼Œé‚£ä¹ˆé€‚åˆç”¨PrototypeåŸå‹æ¨¡å¼ã€‚Prototype: æ¯æ¬¡å¯¹beançš„è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„beanå®ä¾‹ã€‚</p><p>æ€»çš„æ¥è¯´SpringæŠŠbeané»˜è®¤è®¾è®¡æˆå•ä¾‹ï¼Œå°±æ˜¯ä¸ºäº†<strong>æé«˜æ€§èƒ½ï¼</strong></p><h2 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h2><h2 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h2><h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2><p>è¿™ç¯‡åšæ–‡è®²çš„ä¸é”™ï¼Œè´´ä¸ªé“¾æ¥ï¼š</p><p><a href="https://blog.csdn.net/u013521220/article/details/107374259">Springä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</a></p><h1 id="Springçš„IOC"><a href="#Springçš„IOC" class="headerlink" title="Springçš„IOC"></a>Springçš„IOC</h1><p><a href="https://blog.csdn.net/zhangcongyi420/article/details/89419715">Springçš„IOC å®ç°åŸç†</a></p><p>ç®€å•æ¥è¯´ï¼ŒIOC å«åšæ§åˆ¶åè½¬ï¼ŒæŒ‡çš„æ˜¯é€šè¿‡Springæ¥ç®¡ç†å¯¹è±¡çš„åˆ›å»ºã€é…ç½®å’Œç”Ÿå‘½å‘¨æœŸï¼Œè¿™æ ·ç›¸å½“äºæŠŠæ§åˆ¶æƒäº¤ç»™äº†Springï¼Œä¸éœ€è¦â¼ˆâ¼¯æ¥ç®¡ç†å¯¹è±¡ä¹‹é—´å¤æ‚çš„ä¾èµ–å…³ç³»ï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯è§£è€¦ã€‚åœ¨Springé‡Œé¢ï¼Œä¸»è¦æä¾›äº† BeanFactory å’Œ ApplicationContext ä¸¤ç§ IOC å®¹å™¨ï¼Œé€šè¿‡ä»–ä»¬æ¥å®ç°å¯¹ Bean çš„ç®¡ç†ã€‚</p><h1 id="Springçš„AOP"><a href="#Springçš„AOP" class="headerlink" title="Springçš„AOP"></a>Springçš„AOP</h1><p><a href="https://blog.csdn.net/moreevan/article/details/11977115/">Spring AOP å®ç°åŸç†</a></p><p>ç®€å•çš„æ¥è¯´ï¼ŒAOP å«åšé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œä»–æ˜¯â¼€ä¸ªç¼–ç¨‹èŒƒå¼ï¼Œâ½¬çš„å°±æ˜¯æé«˜ä»£ç çš„æ¨¡å—æ€§ã€‚Srping AOP åŸºäºåŠ¨æ€ä»£ç†çš„æ–¹å¼å®ç°ï¼Œå¦‚æœæ˜¯å®ç°äº†æ¥â¼çš„è¯å°±ä¼šä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œåä¹‹åˆ™ä½¿ç”¨ CGLIB ä»£ç†ï¼ŒSpringä¸­ AOPçš„åº”ç”¨ä¸»è¦ä½“ç°åœ¨ äº‹åŠ¡ã€æ—¥å¿—ã€å¼‚å¸¸å¤„ç†ç­‰æ–¹é¢ï¼Œé€šè¿‡åœ¨ä»£ç çš„å‰ååšâ¼€äº›å¢å¼ºå¤„ç†ï¼Œå¯ä»¥å®ç°å¯¹ä¸šåŠ¡é€»è¾‘çš„éš”ç¦»ï¼Œæé«˜ä»£ç çš„æ¨¡å—åŒ–èƒ½åŠ›ï¼ŒåŒæ—¶ä¹Ÿæ˜¯è§£è€¦ã€‚Springä¸»è¦æä¾›äº† Aspect åˆ‡é¢ã€JoinPoint è¿æ¥ç‚¹ã€PointCut åˆ‡å…¥ç‚¹ã€Advice å¢å¼ºç­‰å®ç°æ–¹å¼ã€‚</p><p>AOPçš„ä½¿ç”¨ï¼Œæˆ‘åœ¨ä¹‹å‰çš„åšå®¢ä¹Ÿå†™åˆ°ï¼Œè¿™é‡Œè´´ä¸ªé“¾æ¥ï¼š</p><p><a href="https://luffy997.github.io/2021/01/06/SpringBoot%E4%B9%8BAOP%E7%9A%84%E4%BD%BF%E7%94%A8/">SpringBootä¹‹AOPçš„ä½¿ç”¨</a></p><h1 id="JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h1><p>JDK åŠ¨æ€ä»£ç†ä¸»è¦æ˜¯é’ˆå¯¹ç±»å®ç°äº†æŸä¸ªæ¥å£ï¼ŒAOP åˆ™ä¼šä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ã€‚ä»–åŸºäºåå°„çš„æœºåˆ¶å®ç°ï¼Œç”Ÿæˆâ¼€ä¸ªå®ç°åŒæ ·æ¥å£çš„â¼€ä¸ªä»£ç†ç±»ï¼Œç„¶åé€šè¿‡é‡å†™æ–¹æ³•çš„æ–¹å¼ï¼Œå®ç°å¯¹ä»£ç çš„å¢å¼ºã€‚</p><p>è€Œå¦‚æœæŸä¸ªç±»æ²¡æœ‰å®ç°æ¥å£ï¼ŒAOP åˆ™ä¼šä½¿â½¤ CGLIB ä»£ç†ã€‚ä»–çš„åº•å±‚åŸç†æ˜¯åŸºäº asm ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œé€šè¿‡ä¿®æ”¹å­—èŠ‚ç ç”Ÿæˆâ¼€ä¸ªå­ç±»ï¼Œç„¶åé‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œå®ç°å¯¹ä»£ç çš„å¢å¼ºã€‚</p><h1 id="Springçš„AOPå’ŒAspectj-AOPçš„åŒºåˆ«"><a href="#Springçš„AOPå’ŒAspectj-AOPçš„åŒºåˆ«" class="headerlink" title="Springçš„AOPå’ŒAspectj AOPçš„åŒºåˆ«"></a>Springçš„AOPå’ŒAspectj AOPçš„åŒºåˆ«</h1><p>Spring AOP åŸºäºåŠ¨æ€ä»£ç†å®ç°ï¼Œå±äºè¿è¡Œæ—¶å¢å¼ºã€‚</p><p>AspectJ åˆ™å±äºç¼–è¯‘æ—¶å¢å¼ºï¼Œä¸»è¦æœ‰3ç§æ–¹å¼ï¼š</p><ol><li><p>ç¼–è¯‘æ—¶ç»‡â¼Šï¼šæŒ‡çš„æ˜¯å¢å¼ºçš„ä»£ç å’Œæºä»£ç æˆ‘ä»¬éƒ½æœ‰ï¼Œç›´æ¥ä½¿â½¤ AspectJ ç¼–è¯‘å™¨ç¼–è¯‘å°±è¡Œäº†ï¼Œç¼–è¯‘ä¹‹åâ½£æˆâ¼€ä¸ªæ–°çš„ç±»ï¼Œä»–ä¹Ÿä¼šä½œä¸ºâ¼€ä¸ªæ­£å¸¸çš„ Java ç±»è£…è½½åˆ°JVMã€‚</p></li><li><p>ç¼–è¯‘åç»‡â¼Šï¼šæŒ‡çš„æ˜¯ä»£ç å·²ç»è¢«ç¼–è¯‘æˆ class â½‚ä»¶æˆ–è€…å·²ç»æ‰“æˆ jar åŒ…ï¼Œè¿™æ—¶å€™è¦å¢å¼ºçš„è¯ï¼Œå°±æ˜¯</p><p>ç¼–è¯‘åç»‡å…¥ï¼Œæ¯”å¦‚ä½ ä¾èµ–äº†ç¬¬ä¸‰æ–¹çš„ç±»åº“ï¼Œâ¼œæƒ³å¯¹ä»–å¢å¼ºçš„è¯ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼ã€‚</p></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">weaveDependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">weaveDependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">weaveDependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">weaveDependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">weaveDependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">weaveDependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure><ol><li>åŠ è½½æ—¶ç»‡å…¥ï¼šæŒ‡çš„æ˜¯åœ¨ JVM åŠ è½½ç±»çš„æ—¶å€™è¿›â¾ç»‡â¼Šã€‚</li></ol><p>æ€»ç»“ä¸‹æ¥çš„è¯ï¼Œå°±æ˜¯ Spring AOP åªèƒ½åœ¨è¿è¡Œæ—¶ç»‡â¼Šï¼Œä¸éœ€è¦å•ç‹¬ç¼–è¯‘ï¼Œæ€§èƒ½ç›¸æ¯” AspectJ ç¼–è¯‘ç»‡â¼Šçš„â½…å¼æ…¢ï¼Œè€ŒAspectJ åªâ½€æŒç¼–è¯‘å‰åå’Œç±»åŠ è½½æ—¶ç»‡â¼Šï¼Œæ€§èƒ½æ›´å¥½ï¼ŒåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚</p><h1 id="FactoryBeanå’ŒBeanFactoryæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#FactoryBeanå’ŒBeanFactoryæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="FactoryBeanå’ŒBeanFactoryæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>FactoryBeanå’ŒBeanFactoryæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h1><p>BeanFactoryæ˜¯Beançš„å·¥å‚ï¼ŒApplicationContextçš„çˆ¶ç±»ï¼ŒIOCå®¹å™¨çš„æ ¸å¿ƒï¼Œè´Ÿè´£ç”Ÿäº§å’Œç®¡ç†Beanå¯¹è±¡ã€‚</p><p>FactoryBeanæ˜¯Beanï¼Œå¯ä»¥é€šè¿‡å®ç°Factoryæ¥å£å®šåˆ¶å®ä¾‹åŒ–Beançš„é€»è¾‘ï¼Œé€šè¿‡ä»£ç†ä¸€ä¸ªBeanå¯¹è±¡ï¼Œå¯¹æ–¹æ³•å‰ååšä¸€äº›æ“ä½œã€‚</p><h1 id="SpringBeançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#SpringBeançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="SpringBeançš„ç”Ÿå‘½å‘¨æœŸ"></a>SpringBeançš„ç”Ÿå‘½å‘¨æœŸ</h1><p>SpringBean ç”Ÿå‘½å‘¨æœŸç®€å•æ¦‚æ‹¬ä¸º4ä¸ªé˜¶æ®µï¼š</p><ol><li><p>å®ä¾‹åŒ–ï¼Œåˆ›å»ºä¸€ä¸ªBeanå¯¹è±¡</p></li><li><p>å¡«å……å±æ€§ï¼Œä¸ºå±æ€§èµ‹å€¼</p></li><li><p>åˆå§‹åŒ–</p><ul><li>å¦‚æœå®ç°ç±»xxxAwareæ¥å£ï¼Œé€šè¿‡ä¸åŒç±»å‹çš„Awareæ¥å£æ‹¿åˆ°Springå®¹å™¨çš„èµ„æº</li><li>å¦‚æœå®ç°äº†BeanPostProcessoræ¥å£ï¼Œåˆ™ä¼šå›è°ƒè¯¥æ¥å£çš„postProcessBeforeInitializationå’ŒpostProcessAfterInitializationæ–¹æ³•</li><li>å¦‚æœé…ç½®äº†init-methodæ–¹æ³•ï¼Œåˆ™ä¼šæ‰§è¡Œinit-methodé…ç½®çš„æ–¹æ³•</li></ul></li><li><p>é”€æ¯</p><ul><li><p>å®¹å™¨å…³é—­åï¼Œå¦‚æœBeanå®ç°äº†DisposableBeanæ¥å£ï¼Œåˆ™ä¼šå›è°ƒè¯¥æ¥å£çš„destoryæ–¹æ³•</p></li><li><p>å¦‚æœé…ç½®äº†destory-methodæ–¹æ³•ï¼Œåˆ™ä¼šæ‰§è¡Œdestory-methodé…ç½®çš„æ–¹æ³•</p><p>â€‹</p></li></ul></li></ol><p><img src="https://i.loli.net/2021/03/25/olSnIia4xpgN2zP.jpg"></p><p><a href="https://www.jianshu.com/p/1dec08d290c1">è¯·åˆ«å†é—®Spring Beançš„ç”Ÿå‘½å‘¨æœŸäº†ï¼</a></p><h1 id="Spirngæ˜¯æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–çš„"><a href="#Spirngæ˜¯æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–çš„" class="headerlink" title="Spirngæ˜¯æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–çš„"></a>Spirngæ˜¯æ€ä¹ˆè§£å†³å¾ªç¯ä¾èµ–çš„</h1><p>é¦–å…ˆï¼ŒSpringè§£å†³å¾ªç¯ä¾èµ–æœ‰ä¸¤ä¸ªå‰ææ¡ä»¶ï¼š</p><ol><li>ä¸å…¨æ˜¯æ„é€ å™¨æ–¹å¼çš„å¾ªç¯ä¾èµ–</li><li>å¿…é¡»æ˜¯å•ä¾‹</li></ol><p>åŸºäºä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬çŸ¥é“Beançš„ç”Ÿå‘½å‘¨æœŸï¼Œæœ¬è´¨ä¸Šè§£å†³å¾ªç¯ä¾èµ–é—®é¢˜çš„å°±æ˜¯ä¸‰çº§ç¼“å­˜ï¼Œé€šè¿‡ä¸‰çº§ç¼“å­˜æå‰æ‹¿åˆ°æœªåˆå§‹åŒ–çš„å¯¹è±¡ã€‚</p><p>ç¬¬ä¸€çº§ç¼“å­˜ï¼šç”¨æ¥ä¿å­˜å®ä¾‹åŒ–ã€åˆå§‹åŒ–éƒ½å®Œæˆçš„å¯¹è±¡</p><p>ç¬¬äºŒçº§ç¼“å­˜ï¼šç”¨æ¥ä¿å­˜å®ä¾‹åŒ–å®Œæˆï¼Œä½†æœªåˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡</p><p>ç¬¬ä¸‰çº§ç¼“å­˜ï¼šç”¨æ¥ä¿å­˜ä¸€ä¸ªå¯¹è±¡å·¥å‚ï¼Œæä¾›ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œç”¨äºåˆ›å»ºäºŒçº§ç¼“å­˜ä¸­çš„å¯¹è±¡</p><p><img src="https://i.loli.net/2021/03/26/qLdW6vIhZFgxinD.jpg"></p><p>å‡è®¾ä¸€ä¸ªç®€å•çš„å¾ªç¯ä¾èµ–åœºæ™¯ï¼ŒAã€Bäº’ç›¸ä¾èµ–ã€‚</p><p><img src="https://i.loli.net/2021/03/26/VMi1J7zj5NBHOdh.jpg"></p><p>Aå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼š</p><ol><li>åˆ›å»ºå¯¹è±¡Aï¼Œå®ä¾‹åŒ–çš„æ—¶å€™æŠŠAå¯¹è±¡å·¥å‚æ”¾å…¥ä¸‰çº§ç¼“å­˜</li></ol><p><img src="https://i.loli.net/2021/03/26/HS8Wuqzco6324hs.jpg"></p><ol><li><p>Aæ³¨å…¥å±æ€§æ—¶ï¼Œå‘ç°ä¾èµ–Bï¼Œè½¬è€Œå»å®ä¾‹åŒ–B</p></li><li><p>åŒæ ·åˆ›å»ºå¯¹è±¡Bï¼Œæ³¨å…¥å±æ€§æ—¶å‘ç°ä¾èµ–Aï¼Œä¸€æ¬¡ä»ä¸€çº§åˆ°ä¸‰çº§ç¼“å­˜æŸ¥è¯¢Aï¼Œä»ä¸‰çº§ç¼“å­˜é€šè¿‡å¯¹è±¡å·¥å‚æ‹¿åˆ°Aï¼ŒæŠŠAæ”¾å…¥äºŒçº§ç¼“å­˜ï¼ŒåŒæ—¶åˆ é™¤ä¸‰çº§ç¼“å­˜ä¸­çš„Aï¼Œæ­¤æ—¶ï¼ŒBå·²ç»å®ä¾‹åŒ–å¹¶ä¸”åˆå§‹åŒ–å®Œæˆï¼ŒæŠŠBæ”¾å…¥ä¸€çº§ç¼“å­˜ã€‚</p><p><img src="https://i.loli.net/2021/03/26/z4xug2cRHAZdP9C.jpg"></p></li><li><p>æ¥ç€ç»§ç»­åˆ›å»ºAï¼Œé¡ºåˆ©ä»ä¸€çº§ç¼“å­˜æ‹¿åˆ°å®ä¾‹åŒ–ä¸”åˆå§‹åŒ–å®Œæˆçš„Bå¯¹è±¡ï¼ŒAå¯¹è±¡åˆ›å»ºä¹Ÿå®Œæˆï¼Œåˆ é™¤äºŒçº§ç¼“å­˜ä¸­çš„Aï¼ŒåŒæ—¶æŠŠAæ”¾å…¥ä¸€çº§ç¼“å­˜</p></li><li><p>æœ€åï¼Œä¸€çº§ç¼“å­˜ä¸­ä¿å­˜ç€å®ä¾‹åŒ–ã€åˆå§‹åŒ–éƒ½å®Œæˆçš„Aã€Bå¯¹è±¡</p><p><img src="https://i.loli.net/2021/03/26/lmjHCGcTw2Fqyxp.jpg"></p></li></ol><p>å› æ­¤ï¼Œç”±äºæŠŠå®ä¾‹åŒ–å’Œåˆå§‹åŒ–çš„æµç¨‹åˆ†å¼€äº†ï¼Œæ‰€ä»¥å¦‚æœéƒ½æ˜¯ç”¨æ„é€ å™¨çš„åŒ–ï¼Œå°±æ²¡æ³•åˆ†ç¦»è¿™ä¸ªæ“ä½œï¼Œæ‰€ä»¥éƒ½æ˜¯æ„é€ å™¨çš„è¯å°±æ— æ³•è§£å†³å¾ªç¯ä¾èµ– çš„é—®é¢˜äº†ã€‚</p><p>ä¸‹é¢å¯¹ä¸Šé¢çš„åšä¸€äº›è¡¥å……è¯´æ˜ï¼š</p><ol><li><p>åˆ›å»ºå¯¹è±¡Aï¼Œå®ä¾‹åŒ–çš„æ—¶å€™æŠŠAå¯¹è±¡å·¥å‚æ”¾å…¥ä¸‰çº§ç¼“å­˜ï¼Œè¿™é‡Œä¸ºå•¥ç›´æ¥æ”¾å…¥ç¬¬ä¸‰çº§ç¼“å­˜ï¼Œå› ä¸ºAæ—¢æ²¡æœ‰å®ä¾‹åŒ–å®Œæˆï¼Œä¹Ÿæ²¡ç”¨åˆå§‹åŒ–å®Œæˆï¼Œåªèƒ½æ”¾å…¥ä¸‰çº§ç¼“å­˜ï¼ˆä¸€äºŒçº§éƒ½è¦å®ä¾‹åŒ–å®Œæˆï¼‰ï¼Œä¸‹é¢æ˜¯æºç ï¼š</p><p><img src="https://i.loli.net/2021/03/26/X4YAUF9jI5evphr.png"></p></li><li><p>ä¸ºä»€ä¹ˆç¬¬ä¸‰çº§ç¼“å­˜è¦ä½¿ç”¨ObjectFactoryï¼Ÿ</p><p>å¦‚æœä»…ä»…æ˜¯è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¦‚æœå¯¹è±¡å®ç°äº†AOPï¼Œé‚£ä¹ˆæ³¨å…¥åˆ°å…¶ä»–beançš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯æœ€ç»ˆçš„ä»£ç†å¯¹è±¡ï¼Œè€Œæ˜¯åŸå§‹çš„ã€‚è¿™æ—¶å°±éœ€è¦é€šè¿‡ä¸‰çº§ç¼“å­˜çš„ObjectFactoryæ‰èƒ½æå‰äº§ç”Ÿæœ€ç»ˆçš„éœ€è¦ä»£ç†çš„å¯¹è±¡ã€‚</p><p><img src="https://i.loli.net/2021/03/26/oUlnZaJRXNsV5yG.png"></p><p>â€‹</p><ol><li><p>ä»€ä¹ˆæ—¶å€™å°†Beançš„å¼•ç”¨æå‰æš´éœ²ç»™ç¬¬ä¸‰çº§ç¼“å­˜çš„ObjectFactoryæŒæœ‰ï¼Ÿæ—¶æœºå°±æ˜¯åœ¨ç¬¬ä¸€æ­¥å®ä¾‹åŒ–ä¹‹åï¼Œç¬¬äºŒæ­¥ä¾èµ–æ³¨å…¥ä¹‹å‰ï¼Œå®Œæˆæ­¤æ“ä½œã€‚</p><p><img src="https://i.loli.net/2021/03/26/BtaOd4SX1HmlnMk.png"></p><p>â€‹</p><p>â€‹</p></li><li><p>å¾ªç¯ä¾èµ–é—®é¢˜åœ¨Springä¸­ä¸»è¦æœ‰ä¸‰ç§æƒ…å†µï¼š</p><ul><li>é€šè¿‡æ„é€ æ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥æ—¶äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li><li>é€šè¿‡setteræ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥ä¸”æ˜¯åœ¨å¤šä¾‹ï¼ˆåŸå‹ï¼‰æ¨¡å¼ä¸‹äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li><li>é€šè¿‡setteræ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥ä¸”æ˜¯åœ¨å•ä¾‹æ¨¡å¼ä¸‹äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li></ul><p>åœ¨Springä¸­ï¼Œåªæœ‰ç¬¬ï¼ˆ3ï¼‰ç§æ–¹å¼çš„å¾ªç¯ä¾èµ–é—®é¢˜è¢«è§£å†³äº†ï¼Œå…¶ä»–ä¸¤ç§æ–¹å¼åœ¨é‡åˆ°å¾ªç¯ä¾èµ–é—®é¢˜æ—¶éƒ½ä¼šäº§ç”Ÿå¼‚å¸¸ã€‚å…¶å®ä¹Ÿå¾ˆå¥½è§£é‡Šï¼š</p><p>ç¬¬ï¼ˆ1ï¼‰ç§æ„é€ æ–¹æ³•æ³¨å…¥çš„æƒ…å†µä¸‹ï¼Œåœ¨newå¯¹è±¡çš„æ—¶å€™å°±ä¼šå µå¡ä½äº†ï¼Œå…¶å®ä¹Ÿå°±æ˜¯â€å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹â€œçš„å†å²éš¾é¢˜ã€‚</p><p>ç¬¬ï¼ˆ2ï¼‰ç§setteræ–¹æ³•ï¼ˆå¤šä¾‹ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸€æ¬¡getBean()æ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„Beanï¼Œå¦‚æ­¤åå¤ä¸‹å»å°±ä¼šæœ‰æ— ç©·æ— å°½çš„Beanäº§ç”Ÿäº†ï¼Œæœ€ç»ˆå°±ä¼šå¯¼è‡´OOMé—®é¢˜çš„å‡ºç°ã€‚</p></li></ol></li></ol><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://blog.csdn.net/a745233700/article/details/110914620?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_utm_term-0&spm=1001.2101.3001.4242">Springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜</a></p><h1 id="ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼ŸäºŒçº§ä¸è¡Œå—ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼ŸäºŒçº§ä¸è¡Œå—ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼ŸäºŒçº§ä¸è¡Œå—ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜ï¼ŸäºŒçº§ä¸è¡Œå—ï¼Ÿ</h1><p>ä¸å¯ä»¥ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚</p><p>å› ä¸ºä¸‰çº§ç¼“å­˜ä¸­æ”¾çš„æ˜¯ç”Ÿæˆå…·ä½“å¯¹è±¡çš„åŒ¿åå†…éƒ¨ç±»ï¼Œä»–å¯ä»¥â½£æˆä»£ç†å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯æ™®é€šçš„å®ä¾‹å¯¹è±¡ã€‚</p><p>ä½¿â½¤ä¸‰çº§ç¼“å­˜ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯ä¸ç®¡ä»€ä¹ˆæ—¶å€™ä½¿ç”¨çš„éƒ½æ˜¯â¼€ä¸ªå¯¹è±¡ã€‚</p><p>å‡è®¾åªæœ‰â¼†çº§ç¼“å­˜çš„æƒ…å†µï¼Œå¾€äºŒçº§ç¼“å­˜ä¸­æ”¾çš„æ˜¾ç¤ºâ¼€ä¸ªæ™®é€šçš„Beanå¯¹è±¡ï¼Œ BeanPostProcessor å»â½£æˆ</p><p>ä»£ç†å¯¹è±¡ä¹‹åï¼Œè¦†ç›–æ‰â¼†çº§ç¼“å­˜ä¸­çš„æ™®é€šBeanå¯¹è±¡ï¼Œé‚£ä¹ˆå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½å–åˆ°çš„å¯¹è±¡å°±ä¸â¼€è‡´äº†ã€‚</p><p><img src="https://i.loli.net/2021/03/26/c6uSjZOahlrVA2J.jpg"></p><h1 id="Springäº‹åŠ¡ä¼ æ’­æœºåˆ¶æœ‰å“ªäº›"><a href="#Springäº‹åŠ¡ä¼ æ’­æœºåˆ¶æœ‰å“ªäº›" class="headerlink" title="Springäº‹åŠ¡ä¼ æ’­æœºåˆ¶æœ‰å“ªäº›"></a>Springäº‹åŠ¡ä¼ æ’­æœºåˆ¶æœ‰å“ªäº›</h1><ol><li>PROPAGATION_REQUIREDï¼šå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±åˆ›å»ºâ¼€ä¸ªæ–°äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ </li></ol><p>â¼Šè¯¥äº‹åŠ¡ï¼Œè¿™ä¹Ÿæ˜¯é€šå¸¸æˆ‘ä»¬çš„é»˜è®¤é€‰æ‹©ã€‚</p><ol><li>PROPAGATION_REQUIRES_NEWï¼šåˆ›å»ºæ–°äº‹åŠ¡ï¼Œæ— è®ºå½“å‰å­˜ä¸å­˜åœ¨äº‹åŠ¡ï¼Œéƒ½åˆ›å»ºæ–°äº‹åŠ¡ã€‚</li><li>PROPAGATION_NESTEDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŒ‰</li></ol><p>REQUIREDå±æ€§æ‰§è¡Œã€‚</p><ol><li>PROPAGATION_NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡</li></ol><p>æŒ‚èµ·ã€‚</p><ol><li>PROPAGATION_NEVERï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li>PROPAGATION_MANDATORYï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸</li></ol><p>å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚</p><ol><li>PROPAGATION_SUPPORTSï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜</li></ol><p>åœ¨äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ‰§è¡Œã€‚</p><h1 id="SpringBootå¯åŠ¨æµç¨‹"><a href="#SpringBootå¯åŠ¨æµç¨‹" class="headerlink" title="SpringBootå¯åŠ¨æµç¨‹"></a>SpringBootå¯åŠ¨æµç¨‹</h1><ol><li>å‡†å¤‡ç¯å¢ƒï¼Œæ ¹æ®ä¸åŒçš„ç¯å¢ƒåˆ›å»ºä¸åŒçš„Environment</li><li>å‡†å¤‡ã€åŠ è½½ä¸Šä¸‹æ–‡ï¼Œä¸ºä¸åŒçš„ç¯å¢ƒé€‰æ‹©ä¸åŒçš„Spring Contextï¼Œç„¶ååŠ è½½èµ„æºï¼Œé…ç½®Bean</li><li>åˆå§‹åŒ–ï¼Œè¿™ä¸ªé˜¶æ®µåˆ·æ–°Spring Contextï¼Œå¯åŠ¨åº”ç”¨</li><li>æœ€åç»“æŸæµç¨‹</li></ol><p><img src="https://i.loli.net/2021/03/26/jua6whBdD5KreoP.png"></p><p>è´´ä¸€ç¯‡è®²è§£Springå¯åŠ¨ç›¸å…³æ³¨è§£çš„åšæ–‡ï¼š</p><p><a href="https://blog.csdn.net/u014352080/article/details/102716468">SpringBootå¯åŠ¨æµç¨‹åŠå…¶åŸç†</a></p><h1 id="Springä¸­çš„Controllerã€Serviceã€Daoæ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ"><a href="#Springä¸­çš„Controllerã€Serviceã€Daoæ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ" class="headerlink" title="Springä¸­çš„Controllerã€Serviceã€Daoæ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ"></a>Springä¸­çš„Controllerã€Serviceã€Daoæ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</h1><p>å¯¹äºBeanä¹‹å‰å¼€ç¯‡ä¹Ÿå·²ç»è®²åˆ°ï¼š</p><p>åŸå‹Bean</p><p>å¯¹äºåŸå‹Bean,æ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ä¹‹é—´å¹¶ä¸å­˜åœ¨Beanå…±äº«ï¼Œè‡ªç„¶æ˜¯ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</p><p><strong>å•ä¾‹Bean</strong></p><p>å¯¹äºå•ä¾‹Bean,æ‰€æœ‰çº¿ç¨‹éƒ½å…±äº«ä¸€ä¸ªå•ä¾‹å®ä¾‹Bean,å› æ­¤æ˜¯å­˜åœ¨èµ„æºçš„ç«äº‰ã€‚</p><p>å¦‚æœå•ä¾‹Bean,æ˜¯ä¸€ä¸ªæ— çŠ¶æ€Beanï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ä¸­çš„æ“ä½œä¸ä¼šå¯¹Beançš„æˆå‘˜æ‰§è¡ŒæŸ¥è¯¢ä»¥å¤–çš„æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªå•ä¾‹Beanæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯”å¦‚Spring mvc çš„ Controllerã€Serviceã€Daoç­‰ï¼Œè¿™äº›Beanå¤§å¤šæ˜¯æ— çŠ¶æ€çš„ï¼Œåªå…³æ³¨äºæ–¹æ³•æœ¬èº«ã€‚</p><p><strong>springå•ä¾‹ï¼Œä¸ºä»€ä¹ˆcontrollerã€serviceå’Œdaoç¡®èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</strong></p><p>Springä¸­çš„Beané»˜è®¤æ˜¯å•ä¾‹æ¨¡å¼çš„ï¼Œæ¡†æ¶å¹¶æ²¡æœ‰å¯¹beanè¿›è¡Œå¤šçº¿ç¨‹çš„å°è£…å¤„ç†ã€‚</p><p>å®é™…ä¸Šå¤§éƒ¨åˆ†æ—¶é—´Beanæ˜¯æ— çŠ¶æ€çš„ï¼ˆæ¯”å¦‚Daoï¼‰ æ‰€ä»¥è¯´åœ¨æŸç§ç¨‹åº¦ä¸Šæ¥è¯´Beanå…¶å®æ˜¯å®‰å…¨çš„ã€‚</p><p>ä½†æ˜¯å¦‚æœBeanæ˜¯æœ‰çŠ¶æ€çš„ é‚£å°±éœ€è¦å¼€å‘äººå‘˜è‡ªå·±æ¥è¿›è¡Œçº¿ç¨‹å®‰å…¨çš„ä¿è¯ï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯æ”¹å˜beançš„ä½œç”¨åŸŸ æŠŠ â€œsingletonâ€æ”¹ä¸ºâ€™â€˜protopyteâ€™ è¿™æ ·æ¯æ¬¡è¯·æ±‚Beanå°±ç›¸å½“äºæ˜¯ new Bean() è¿™æ ·å°±å¯ä»¥ä¿è¯çº¿ç¨‹çš„å®‰å…¨äº†ã€‚</p><ul><li>æœ‰çŠ¶æ€å°±æ˜¯æœ‰æ•°æ®å­˜å‚¨åŠŸèƒ½</li><li>æ— çŠ¶æ€å°±æ˜¯ä¸ä¼šä¿å­˜æ•°æ® ã€€ã€€ controllerã€serviceå’Œdaoå±‚æœ¬èº«å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåªæ˜¯å¦‚æœåªæ˜¯è°ƒç”¨é‡Œé¢çš„æ–¹æ³•ï¼Œè€Œä¸”å¤šçº¿ç¨‹è°ƒç”¨ä¸€ä¸ªå®ä¾‹çš„æ–¹æ³•ï¼Œä¼šåœ¨å†…å­˜ä¸­å¤åˆ¶å˜é‡ï¼Œè¿™æ˜¯è‡ªå·±çš„çº¿ç¨‹çš„å·¥ä½œå†…å­˜ï¼Œæ˜¯å®‰å…¨çš„ã€‚</li></ul><p>å¯¹äºä»»ä½•æ— çŠ¶æ€å•ä¾‹éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„</p><p><strong>@Controller @Serviceæ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„?</strong></p><p>é»˜è®¤é…ç½®ä¸‹ä¸æ˜¯çš„ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹@Controlleræ²¡æœ‰åŠ ä¸Š@Scopeï¼Œæ²¡æœ‰åŠ @Scopeå°±æ˜¯é»˜è®¤å€¼singletonï¼Œå•ä¾‹çš„ã€‚æ„æ€å°±æ˜¯ç³»ç»Ÿåªä¼šåˆå§‹åŒ–ä¸€æ¬¡Controllerå®¹å™¨ï¼Œæ‰€ä»¥æ¯æ¬¡è¯·æ±‚çš„éƒ½æ˜¯åŒä¸€ä¸ªControllerå®¹å™¨ï¼Œå½“ç„¶æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>è¿™é‡Œå†™äº†ä¸ªæµ‹è¯•ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Contrller é»˜è®¤å•ä¾‹åˆ†ææµ‹è¯•<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">3</span>/<span class="hljs-number">26</span> <span class="hljs-number">14</span>:<span class="hljs-number">54</span><br>\*/<br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Scope(value = &quot;singleton&quot;)</span> <span class="hljs-comment">//åŠ ä¸Š@Scopeæ³¨è§£ï¼Œä»–æœ‰2ä¸ªå–å€¼ï¼šå•ä¾‹-singleton å¤šå®ä¾‹-prototype</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestController</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">var</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">staticVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>ThreadLocal&lt;Long&gt; t1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;Long&gt;();<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> User user;<br><span class="hljs-meta">@Value(&quot;$&#123;test.val&#125;&quot;)</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> testVal;<br><span class="hljs-meta">@GetMapping(&quot;/testVal01&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">test01</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//varéšç€è¯·æ±‚æ¬¡æ•°ï¼Œè¿›è¡Œ+1</span><br>System.out.println(<span class="hljs-string">&quot;æ™®é€šå˜é‡var:&quot;</span> + (++<span class="hljs-keyword">var</span>));<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ™®é€šå˜é‡var:&quot;</span>+<span class="hljs-keyword">var</span>;<br>&#125;<br><span class="hljs-meta">@GetMapping(&quot;/testVal02&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">test02</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//å‘ç°æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„</span><br>System.out.println(<span class="hljs-string">&quot;æ™®é€šå˜é‡varï¼š&quot;</span> + (++<span class="hljs-keyword">var</span>));<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ™®é€šå˜é‡varï¼š&quot;</span>+<span class="hljs-keyword">var</span>;<br>&#125;<br><span class="hljs-meta">@GetMapping(&quot;/testVal03&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">test03</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//staticçš„staticVarè¿˜æ˜¯ä¼šéšç€è¯·æ±‚è€Œ+1ï¼Œçº¿ç¨‹ä¸å®‰å…¨</span><br>System.out.println(<span class="hljs-string">&quot;æ™®é€šå˜é‡var:&quot;</span> + (++<span class="hljs-keyword">var</span>)+ <span class="hljs-string">&quot;---é™æ€å˜é‡staticVar:&quot;</span> + (++staticVar));<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ™®é€šå˜é‡var:&quot;</span> + <span class="hljs-keyword">var</span> + <span class="hljs-string">&quot;é™æ€å˜é‡staticVar:&quot;</span> + staticVar;<br>&#125;<br><span class="hljs-meta">@GetMapping(&quot;/testVal04&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">test04</span><span class="hljs-params">()</span>&#123;<br>t1.set(<span class="hljs-number">1L</span>);<br>System.out.println(<span class="hljs-string">&quot;å…ˆå–ä¸€ä¸‹userå¯¹è±¡ä¸­çš„å€¼ï¼š&quot;</span>+user.getAge()+<span class="hljs-string">&quot;----&gt;&quot;</span>+user.hashCode());<br>user.setAge(<span class="hljs-number">1</span>);<br>System.out.println(<span class="hljs-string">&quot;æ™®é€šå˜é‡var:&quot;</span> + (++<span class="hljs-keyword">var</span>) + <span class="hljs-string">&quot;===é™æ€å˜é‡staticVar:&quot;</span> + (++staticVar) + <span class="hljs-string">&quot;===é…ç½®å˜é‡testInt:&quot;</span> + (++testVal)<br>+ <span class="hljs-string">&quot;===ThreadLocalå˜é‡tl:&quot;</span> + t1.get()+<span class="hljs-string">&quot;===æ³¨å…¥å˜é‡user:&quot;</span> + user.getAge());<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ™®é€šå˜é‡var:&quot;</span> + <span class="hljs-keyword">var</span> + <span class="hljs-string">&quot;,é™æ€å˜é‡staticVar:&quot;</span> + staticVar + <span class="hljs-string">&quot;,é…ç½®è¯»å–å˜é‡testInt:&quot;</span> + testVal + <span class="hljs-string">&quot;,ThreadLocalå˜é‡tl:&quot;</span><br>+ t1.get() + <span class="hljs-string">&quot;æ³¨å…¥å˜é‡user:&quot;</span> + user.getAge();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æµ‹è¯•ï¼Œè°ƒç”¨ç¬¬ä¸€ä¸ªæ¥å£ï¼Œå‘ç°æ™®é€šå˜é‡çš„å€¼ä¼šéšç€è¯·æ±‚æ¬¡æ•°çš„å¢åŠ è€Œ+1ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</p><p>ä½†æˆ‘ä»¬åŠ ä¸Š@scopeæ³¨è§£æ—¶ï¼Œè®©å®ƒä¸èµ°é»˜è®¤çš„singletonï¼Œè€Œæ˜¯èµ°åŸå‹ï¼Œå¯åŠ¨ç¨‹åºï¼Œå‘ç°æ™®é€šå˜é‡çš„å€¼ä¸ä¼šä¼šéšç€è¯·æ±‚æ¬¡æ•°çš„å¢åŠ è€Œ+1ï¼Œç°åœ¨çœ‹æ¥æ²¡æœ‰å‡ºç°çº¿ç¨‹ä¸å®‰å…¨çš„æƒ…å†µï¼Œé‚£æˆ‘ä»¬ç»§ç»­æµ‹è¯•ï¼Œå‡å¦‚staticå˜é‡ï¼Œæˆ‘ä»¬çŸ¥é“ç±»åŠ è½½æ˜¯æ‡’åŠ è½½æœºåˆ¶ï¼Œåœ¨å‡†åˆ«é˜¶æ®µå°±ä¼šå¯¹staticå˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œåé¢å°±ä¸ç®¡äº†ï¼Œæˆ‘ä»¬å¯åŠ¨ç¨‹åºå‘ç°ï¼Œstaticå˜é‡ä¼šéšç€è¯·æ±‚æ¬¡æ•°çš„å¢åŠ è€Œ+1ï¼Œæ‰€ä»¥åŠ äº†@scopeæ³¨è§£å¹¶ä¸ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼</p><p>è¿™é‡Œå°±å¼•å…¥äº†TheadLocalï¼Œä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œå®ç°çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¼ é€’åŒä¸€ä¸ªå¯¹è±¡ï¼Œéš”ç¦»äº†å¤šçº¿ç¨‹ä¹‹é—´æ•°æ®å…±äº«çš„é—®é¢˜ï¼Œæ‰€ä»¥å¯åŠ¨ç¨‹åºä¼šå‘ç°t1å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†staticå’ŒUserå¯¹è±¡éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</p><p>TestController æ˜¯æ¯æ¬¡è¯·æ±‚çš„æ—¶å€™éƒ½åˆå§‹åŒ–äº†ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯é™æ€å˜é‡å§‹ç»ˆæ˜¯åªæœ‰ä¸€ä»½çš„ï¼Œè€Œä¸”è¿™ä¸ªæ³¨å…¥çš„userå¯¹è±¡ä¹Ÿæ˜¯åªæœ‰ä¸€ä»½çš„ã€‚é™æ€å˜é‡åªæœ‰ä¸€ä»½è¿™æ˜¯å½“ç„¶çš„å’¯ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•è®©userå¯¹è±¡å¯ä»¥æ¯æ¬¡éƒ½newä¸€ä¸ªæ–°çš„å‘¢ï¼Ÿå½“ç„¶å¯ä»¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">3</span>/<span class="hljs-number">26</span> <span class="hljs-number">15</span>:<span class="hljs-number">05</span><br>\*/<br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfig</span> &#123;<br><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@Scope(value = &quot;prototype&quot;)</span><br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">user</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨æ³¨å…¥IOCå®¹å™¨çš„æ—¶å€™ï¼ŒåŠ å…¥@scopeï¼ŒæŠŠå®ƒè®¾ç½®æˆåŸå‹å³å¯ï¼Œæµ‹è¯•ç¨‹åºå‘ç°Userçš„hashcodeæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯æ¬¡èµ‹å€¼å‰å–userä¸­çš„å˜é‡å€¼ä¹Ÿéƒ½æ˜¯é»˜è®¤å€¼0ã€‚</p><p>æ€»ç»“ä¸‹ï¼š</p><ol><li>åœ¨@Controller&#x2F;@Serviceç­‰å®¹å™¨ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œscopeæ˜¯singletonçš„ï¼Œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</li><li>å°½é‡ä¸è¦åœ¨@Controller&#x2F;@Serviceç­‰å®¹å™¨ä¸­å®šä¹‰é™æ€å˜é‡ï¼Œä¸è®ºæ˜¯å•ä¾‹è¿˜æ˜¯å¤šå®ä¾‹ï¼Œå› ä¸ºéƒ½ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨</li><li>é»˜è®¤æ³¨å…¥çš„Beanå¯¹è±¡ï¼Œåœ¨ä¸è®¾ç½®scopeçš„æ—¶å€™ä¹Ÿæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</li><li>ä¸€å®šè¦å®šä¹‰å˜é‡çš„è¯ï¼Œç”¨TheadLocalè¿›è¡Œå°è£…ï¼Œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¤šçº¿ç¨‹å¿…çŸ¥å¿…ä¼š</title>
    <link href="/2021/03/24/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/"/>
    <url>/2021/03/24/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/</url>
    
    <content type="html"><![CDATA[<h1 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„è”ç³»å’ŒåŒºåˆ«"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„è”ç³»å’ŒåŒºåˆ«" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹çš„è”ç³»å’ŒåŒºåˆ«"></a>è¿›ç¨‹å’Œçº¿ç¨‹çš„è”ç³»å’ŒåŒºåˆ«</h1><p>**è¿›ç¨‹ï¼š**æ˜¯ç¨‹åºåœ¨æ‰§è¡Œä¸­è¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½</p><p><strong>çº¿ç¨‹ï¼š</strong> æ˜¯è¿›ç¨‹çš„è¿›ä¸€æ­¥åˆ’åˆ†ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªæ‰§è¡Œä½“ï¼Œæ›´å°çš„ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ï¼Œäº¦ç§°è½»é‡çº§çº¿ç¨‹</p><p>ä¸¾ä¸ªæ —å­ï¼š</p><p>æˆ‘ä»¬åœ¨ä½¿ç”¨QQçš„æ—¶å€™å‡è®¾æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œé‚£æˆ‘ä»¬ä½¿ç”¨QQçš„å‘çŸ­ä¿¡ï¼Œå‘æ–‡ä»¶ï¼Œå‘è¯´è¯´ç­‰åŠŸèƒ½å°±å¯ä»¥è¯´æ˜¯çº¿ç¨‹ã€‚</p><p>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼š</p><ul><li><p>è¿›ç¨‹æ˜¯ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œä½†åŒä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹å…±äº«æœ¬è¿›ç¨‹çš„åœ°å€ç©ºé—´</p></li><li><p>åŒä¸€è¿›ç¨‹çš„çº¿ç¨‹å…±äº«èµ„æºæ¯”å¦‚CPUï¼Œå†…å­˜ç­‰ç­‰ï¼Œä½†è¿›ç¨‹ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„</p></li><li><p>ä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶ä»–è¿›ç¨‹äº§ç”Ÿå½±å“</p></li><li><p>ä¸€ä¸ªçº¿ç¨‹å´©æºƒæ•´ä¸ªè¿›ç¨‹éƒ½æ­»æ‰ï¼Œæ‰€ä»¥å¤šè¿›ç¨‹è¦æ¯”å¤šçº¿ç¨‹è¦å¥å£®</p></li><li><p>è¿›ç¨‹å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¸”æ¯ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æœ‰ä¸€ä¸ªç¨‹åºè¿è¡Œçš„å…¥å£ã€é¡ºåºæ‰§è¡Œåºåˆ—å’Œç¨‹åºå…¥å£</p></li><li><p>çº¿ç¨‹ä¸èƒ½ç‹¬ç«‹æ‰§è¡Œï¼Œå¿…é¡»ä¾å­˜åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œç”±åº”ç”¨ç¨‹åºæä¾›å¤šä¸ªçº¿ç¨‹çš„æ‰§è¡Œæ§åˆ¶ï¼Œçº¿ç¨‹æ˜¯å¤„ç†å™¨è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œä½†è¿›ç¨‹ä¸æ˜¯</p></li><li><p>ä¸¤è€…éƒ½æ”¯æŒå¹¶å‘æ‰§è¡Œã€‚è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ¶ˆè€—çš„èµ„æºå¤§ï¼Œæ•ˆç‡é«˜ã€‚æ‰€ä»¥æ¶‰åŠåˆ°é¢‘ç¹çš„åˆ‡æ¢æ—¶ï¼Œä½¿ç”¨çº¿ç¨‹è¦å¥½äºè¿›ç¨‹ã€‚å¦‚æœåŒæ—¶è¦æ±‚è¿›è¡Œå¹¶ä¸”åˆè¦å…±äº«æŸäº›å˜é‡çš„å¹¶å‘æ“ä½œï¼Œå°±åªèƒ½ç”¨çº¿ç¨‹ï¼ˆè¿›ç¨‹ä¹‹é—´æ˜¯æƒ³ç‹¬ç«‹çš„ï¼‰</p><p>â€‹</p></li></ul><h1 id="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"></a>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</h1><p>å†…å®¹æ‘˜å½•è‡ªï¼š<a href="https://zhuanlan.zhihu.com/p/58966050">https://zhuanlan.zhihu.com/p/58966050</a></p><p><img src="https://i.loli.net/2021/03/24/iMAe6TZCO5poaN2.jpg" alt="v2-3640b7f86a072bc188199aa8bb76c271\_720w.jpg"></p><p>ä¸‹é¢è¯¦ç»†è¯´æ˜ä¸‹ï¼Œçº¿ç¨‹å…±æœ‰6ç§çŠ¶æ€ï¼š</p><p>newï¼Œrunnableï¼Œblockedï¼Œwaitingï¼Œtimed waitingï¼Œterminated</p><p>1ï¼Œå½“è¿›å…¥synchronizedåŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•æ—¶ï¼Œä¸”æ²¡æœ‰è·å–åˆ°é”ï¼Œçº¿ç¨‹å°±è¿›å…¥äº†blockedçŠ¶æ€ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ï¼Œé‡æ–°è¿›å…¥runnableçŠ¶æ€</p><p>2ï¼Œå½“çº¿ç¨‹è°ƒç”¨wait()æˆ–è€…joinæ—¶ï¼Œçº¿ç¨‹éƒ½ä¼šè¿›å…¥åˆ°waitingçŠ¶æ€ï¼Œå½“è°ƒç”¨notifyæˆ–notifyAllæ—¶ï¼Œæˆ–è€…joinçš„çº¿ç¨‹æ‰§è¡Œç»“æŸåï¼Œä¼šè¿›å…¥runnableçŠ¶æ€</p><p>3ï¼Œå½“çº¿ç¨‹è°ƒç”¨sleep(time)ï¼Œæˆ–è€…wait(time)æ—¶ï¼Œè¿›å…¥timed waitingçŠ¶æ€ï¼Œ</p><p>å½“ä¼‘çœ æ—¶é—´ç»“æŸåï¼Œæˆ–è€…è°ƒç”¨notifyæˆ–notifyAllæ—¶ä¼šé‡æ–°runnableçŠ¶æ€ã€‚</p><p>4ï¼Œç¨‹åºæ‰§è¡Œç»“æŸï¼Œçº¿ç¨‹è¿›å…¥terminatedçŠ¶æ€</p><p>æ¡ˆä¾‹ç¯‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-meta">@author</span> huangguizhao<br>\* æµ‹è¯•çº¿ç¨‹çš„çŠ¶æ€<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadStateTest</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>());<br>System.out.println(thread.getState());<span class="hljs-comment">//NEW</span><br>thread.start();<br>System.out.println(thread.getState());<span class="hljs-comment">//RUNNABLE</span><br><span class="hljs-comment">//ä¿é™©èµ·è§ï¼Œè®©å½“å‰ä¸»çº¿ç¨‹ä¼‘çœ ä¸‹</span><br>Thread.sleep(<span class="hljs-number">10</span>);<br>System.out.println(thread.getState());<span class="hljs-comment">//terminated</span><br>&#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>&#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>System.out.println(i);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadStateTest</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><span class="hljs-type">BlockTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BlockTask</span>();<br><span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(task);<br><span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(task);<br>t1.start();<br>t2.start();<br><span class="hljs-comment">//ä»ä¸¥è°¨çš„è§’åº¦æ¥è¯´ï¼Œt1çº¿ç¨‹ä¸ä¸€å®šä¼šå…ˆæ‰§è¡Œï¼Œæ­¤å¤„æ˜¯å‡è®¾t1å…ˆæ‰§è¡Œ</span><br>System.out.println(t1.getState());<span class="hljs-comment">//RUNNABLE</span><br>System.out.println(t2.getState());<span class="hljs-comment">//BLOCKED</span><br>Thread.sleep(<span class="hljs-number">10</span>);<br>System.out.println(t1.getState());<span class="hljs-comment">//TIMED\_WAITING</span><br>Thread.sleep(<span class="hljs-number">1000</span>);<br>System.out.println(t1.getState());<span class="hljs-comment">//WAITING</span><br>&#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>&#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>)&#123;<br><span class="hljs-comment">//å¦ä¸€ä¸ªçº¿ç¨‹ä¼šè¿›å…¥blockçŠ¶æ€</span><br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//ç›®çš„æ˜¯è®©çº¿ç¨‹è¿›å…¥waiting timeçŠ¶æ€</span><br>Thread.sleep(<span class="hljs-number">1000</span>);<br><span class="hljs-comment">//è¿›å…¥waitingçŠ¶æ€</span><br>wait();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><p>blockedï¼Œwaitingï¼Œtimed waiting æˆ‘ä»¬éƒ½ç§°ä¸ºé˜»å¡çŠ¶æ€</p><p>ä¸Šè¿°çš„å°±ç»ªçŠ¶æ€å’Œè¿è¡ŒçŠ¶æ€ï¼Œéƒ½è¡¨ç°ä¸ºrunnableçŠ¶æ€</p><h1 id="synchornizedåŸç†"><a href="#synchornizedåŸç†" class="headerlink" title="synchornizedåŸç†"></a>synchornizedåŸç†</h1><p>ç›¸ä¿¡åªè¦å¯¹Javaçš„å¤šçº¿ç¨‹æœ‰ä¸€å®šäº†è§£çš„åŒå­¦å°±ä¸€å®šçŸ¥é“è¿™ä¸ªå…³é”®å­—ï¼Œæˆ‘è¿™é‡Œä¸¾ä¸€ä¸ªå¤§ä¸€å­¦ä¹ æ•°æ®åº“æ—¶ï¼Œè€å¸ˆä¸¾çš„ä¸€ä¸ªä¾‹å­ï¼š</p><p>ä¸€ä¸ªäººå’Œä»–çš„å¤«äººæœ‰ä¸¤å¼ ä¸€æ¨¡ä¸€æ ·çš„é“¶è¡Œå¡ï¼ˆç°å®ä¸­æ˜¯ä¸å­˜åœ¨çš„ï¼‰ï¼Œå¡é‡Œæœ‰1000å—ï¼Œåœ¨å½“åœ°çš„ä¸¤å®¶é“¶è¡ŒåŒæ—¶å¹¶å‘çš„å–1000å—é’±ï¼Œæ˜¯ä¸æ˜¯ä¸¤ä¸ªäººéƒ½æˆåŠŸå–å‡ºé’±å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ¯«æ— ç–‘é—®æ˜¯å¦å®šçš„ï¼Œè¦æ˜¯è¿™æ ·è¿˜èƒ½æˆåŠŸï¼Œé‚£é“¶è¡Œæ—©å°±å…³é—¨å€’é—­äº†ã€‚</p><p>è€å¸ˆç»™æˆ‘ä»¬è®²äº†é”çš„æœºåˆ¶ï¼Œå°±æ˜¯å½“å–é’±çš„è¯·æ±‚å‘å‡ºåï¼Œå°±ä¼šæœ‰ä¸€ä¸ªé”çš„æœºåˆ¶ï¼Œåªæœ‰ç­‰ä¸Šä¸€ä¸ªäººçš„æ“ä½œæ‰§è¡Œå®Œåï¼Œä¸‹ä¸€ä¸ªäººæ‰èƒ½è¿›è¡Œå–é’±ï¼Œè¿™å°±ä¸ä¼šå‡ºç°å–å‡ºä¸¤å€é’±çš„ç°è±¡ã€‚</p><p>å½“ç„¶ï¼Œå¯èƒ½è€å¸ˆè¯´çš„æ˜¯æ•°æ®åº“çš„è¡Œçº§é”æˆ–è€…è¡¨çº§é”ï¼Œä½†æˆ‘ä»¬è¿™é‡Œä¹Ÿå¯ä»¥å¼•ç”³åˆ°Javaä¸­ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹éƒ½å»æ“ä½œä¸€ä¸ªè´¦æˆ·ï¼Œé‚£å°±å¿…ç„¶éœ€è¦é”çš„æœºåˆ¶æ¥æ§åˆ¶çº¿ç¨‹çš„æ‰§è¡Œï¼Œsynchorinizedå°±æ˜¯ä¸€æŠŠè¿™æ ·çš„é”ï¼</p><p>å…³äºsynchornizedçš„ä½¿ç”¨ï¼Œæˆ‘åœ¨JUCä¸­å·²ç»è®²åˆ°ï¼Œè¿™é‡Œå°±å†è®²ï¼Œè¿™é‡Œçš„æ ¸å¿ƒæ˜¯è®²è§£synchornizedçš„åŸç†ã€‚</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* syschronizedåŸç†åˆ†æ<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">3</span>/<span class="hljs-number">22</span> <span class="hljs-number">10</span>:<span class="hljs-number">57</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchorizedDemo</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><span class="hljs-keyword">synchronized</span> (o)&#123;<br>System.out.println(<span class="hljs-string">&quot;ok&quot;</span>);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”¨ä¾‹ä¹Ÿå¾ˆç®€å•ï¼Œåˆ›å»ºäº†ä¸€ä¸ªObjectå¯¹è±¡ï¼Œé€šè¿‡synchorizedå¯¹å®ƒè¿›è¡ŒåŠ é”ï¼Œæ‹¿åˆ°é”æ‰“å°OK</p><p>é€šè¿‡JDKè‡ªå¸¦çš„åç¼–è¯‘å·¥å…·javapï¼Œæˆ‘ä»¬åç¼–è¯‘å®ƒçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œçœ‹å®ƒåœ¨JVMè¿è¡Œæ—¶çœŸæ­£çš„é¢è²Œ</p><p>public static void main(java.lang.String[]);</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs plain">descriptor: ([Ljava/lang/String;)V<br>flags: ACC\_PUBLIC, ACC\_STATIC<br>Code:<br>stack=2, locals=4, args\_size=1<br>0: new #2 // class java/lang/Object<br>3: dup<br>4: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V æ— å‚æ„é€ <br>7: astore\_1<br>8: aload\_1<br>9: dup<br>10: astore\_2<br>11: monitorenter // åŠ é”<br>12: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream;<br>15: ldc #4 // String ok<br>17: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V<br>20: aload\_2<br>21: monitorexit //é‡Šæ”¾é”<br>22: goto 30<br>25: astore\_3<br>26: aload\_2<br>27: monitorexit<br>28: aload\_3<br>29: athrow<br>30: return<br></code></pre></td></tr></table></figure><p>å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°ï¼Œå‡ºç°<strong>monitorenterå’Œmonitorexit</strong>ï¼Œå¯¹äºå…¶ä»–çš„JVMæŒ‡ä»¤å°±æ˜¯ä¸€äº›æ‹·è´ï¼Œèµ‹å€¼ç­‰æ“ä½œï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€å…³æ³¨monitorenterå’Œmonitorexitä¸¤æ¡JVMæŒ‡ä»¤å³å¯ï¼›</p><p>synchronizedæ˜¯javaæä¾›çš„åŸå­æ€§å†…ç½®é”ï¼Œè¿™ç§å†…ç½®çš„å¹¶ä¸”ä½¿ç”¨è€…çœ‹ä¸åˆ°çš„é”ä¹Ÿè¢«ç§°ä¸ºç›‘è§†å™¨é”ï¼Œä½¿â½¤</p><p>synchronizedä¹‹åï¼Œä¼šåœ¨ç¼–è¯‘ä¹‹ååœ¨åŒæ­¥çš„ä»£ç å—å‰ååŠ ä¸Šmonitorenterå’Œmonitorexitå­—èŠ‚ç æŒ‡ä»¤ï¼Œ</p><p>ä»–ä¾èµ–æ“ä½œç³»ç»Ÿåº•å±‚äº’æ–¥é”å®ç°ã€‚ä»–çš„ä½œç”¨ä¸»è¦å°±æ˜¯å®ç°åŸå­æ€§æ“ä½œå’Œè§£å†³å…±äº«å˜é‡çš„å†…å­˜å¯è§æ€§é—®</p><p>é¢˜ã€‚</p><p>æ‰§è¡ŒmonitorenteræŒ‡ä»¤æ—¶ä¼šå°è¯•è·å–å¯¹è±¡é”ï¼Œå¦‚æœå¯¹è±¡æ²¡æœ‰è¢«é”å®šæˆ–è€…å·²ç»è·å¾—äº†é”ï¼Œé”çš„è®¡æ•°å™¨+1ã€‚</p><p>æ­¤æ—¶å…¶ä»–ç«äº‰é”çš„çº¿ç¨‹åˆ™ä¼šè¿›â¼Šç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</p><p>æ‰§è¡ŒmonitorexitæŒ‡ä»¤æ—¶åˆ™ä¼šæŠŠè®¡æ•°å™¨-1ï¼Œå½“è®¡æ•°å™¨å€¼ä¸º0æ—¶ï¼Œåˆ™é”é‡Šæ”¾ï¼Œå¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å†ç»§ç»­</p><p>ç«äº‰é”ã€‚</p><p>synchronizedæ˜¯æ’å®ƒé”ï¼Œå½“â¼€ä¸ªçº¿ç¨‹è·å¾—é”ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…è¯¥çº¿ç¨‹é‡Šæ”¾é”åæ‰èƒ½è·å¾—é”ï¼Œè€Œä¸”</p><p>ç”±äºJavaä¸­çš„çº¿ç¨‹å’Œæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹æ˜¯â¼€â¼€å¯¹åº”çš„ï¼Œçº¿ç¨‹è¢«é˜»å¡æˆ–è€…å”¤é†’æ—¶æ—¶ä¼šä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸</p><p>æ€ï¼Œè¿™ç§è½¬æ¢éå¸¸æ¶ˆè€—æ€§èƒ½ã€‚</p><p>ä»å†…å­˜è¯­ä¹‰æ¥è¯´ï¼ŒåŠ é”çš„è¿‡ç¨‹ä¼šæ¸…é™¤â¼¯ä½œå†…å­˜ä¸­çš„å…±äº«å˜é‡ï¼Œå†ä»ä¸»å†…å­˜è¯»å–ï¼Œè€Œé‡Šæ”¾é”çš„è¿‡ç¨‹åˆ™æ˜¯å°†</p><p>å·¥ä½œå†…å­˜ä¸­çš„å…±äº«å˜é‡å†™å›ä¸»å†…å­˜ã€‚</p><p>è‹¥å†æ·±å…¥äº†è§£ï¼Œsynchronizedå®é™…ä¸Šæœ‰ä¸¤ä¸ªé˜Ÿåˆ—<strong>waitSet</strong>å’Œ<strong>entryList</strong>ã€‚</p><ol><li>å½“å¤šä¸ªçº¿ç¨‹è¿›â¼ŠåŒæ­¥ä»£ç å—æ—¶ï¼Œé¦–å…ˆè¿›å…¥entryList</li><li>æœ‰â¼€ä¸ªçº¿ç¨‹è·å–åˆ°monitoré”åï¼Œå°±èµ‹å€¼ç»™å½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸”è®¡æ•°å™¨+1</li><li>å¦‚æœçº¿ç¨‹è°ƒç”¨waitæ–¹æ³•ï¼Œå°†é‡Šæ”¾é”ï¼Œå½“å‰çº¿ç¨‹ç½®ä¸ºnullï¼Œè®¡æ•°å™¨-1ï¼ŒåŒæ—¶è¿›â¼ŠwaitSetç­‰å¾…è¢«å”¤é†’ï¼Œ</li></ol><p>è°ƒç”¨notifyæˆ–è€…notifyAllä¹‹ååˆä¼šè¿›â¼ŠentryListç«äº‰é”</p><ol><li>å¦‚æœçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼ŒåŒæ ·é‡Šæ”¾é”ï¼Œè®¡æ•°å™¨-1ï¼Œå½“å‰çº¿ç¨‹ç½®ä¸ºnull</li></ol><p><img src="https://i.loli.net/2021/03/22/nf6FljQke9YDovH.jpg"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><blockquote><p>æ–¹æ³•çº§åˆ«çš„ synchronized ä¸ä¼šåœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­æœ‰æ‰€ä½“ç°ï¼Œä½¿ç”¨ACC_SYNCHRONIZEDæ ‡è®°ç¬¦éšå¼çš„å®ç°ã€‚</p></blockquote><h1 id="é”çš„ä¼˜åŒ–"><a href="#é”çš„ä¼˜åŒ–" class="headerlink" title="é”çš„ä¼˜åŒ–"></a>é”çš„ä¼˜åŒ–</h1><p>è¿™ä¸€å—å¾ˆéš¾ï¼Œæˆ‘æ‰¾äº†ä¸€ç¯‡å¾ˆä¸é”™çš„åšæ–‡ï¼Œæœ‰æ—¶é—´ä¸€å®šè¦å¤šè¯»è¯»ï¼</p><p><a href="https://www.jianshu.com/p/e674ee68fd3f">Javaä¸­çš„é”[åŸç†ã€é”ä¼˜åŒ–ã€CASã€AQS]</a></p><h1 id="CASçš„åŸç†"><a href="#CASçš„åŸç†" class="headerlink" title="CASçš„åŸç†"></a>CASçš„åŸç†</h1><p>CASå«åšCompareAndSwapï¼Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼Œä¸»è¦é€šè¿‡å¤„ç†å™¨çš„æŒ‡ä»¤æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼š</p><ol><li>å˜é‡å†…å­˜åœ°å€ï¼ŒVè¡¨ç¤º</li><li>æ—§çš„é¢„æœŸå€¼ï¼ŒAè¡¨ç¤º</li><li>å‡†å¤‡è®¾ç½®çš„æ–°å€¼ï¼ŒBè¡¨ç¤º</li></ol><p>å½“æŒ‡å‘CASæŒ‡ä»¤æ—¶ï¼Œåªæœ‰å½“Vç­‰äºAæ—¶ï¼Œæ‰ä¼šç”¨Bå»æ›´æ–°Vçš„å€¼ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œæ›´æ–°æ“ä½œã€‚</p><h1 id="CASçš„ç¼ºç‚¹"><a href="#CASçš„ç¼ºç‚¹" class="headerlink" title="CASçš„ç¼ºç‚¹"></a>CASçš„ç¼ºç‚¹</h1><p>ä¸»è¦æœ‰3ç‚¹ï¼š</p><p>**ABAé—®é¢˜ï¼š**ABAçš„é—®é¢˜æ˜¯æŒ‡åœ¨CASæ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œå½“è¯»å–åˆ°çš„å€¼æ˜¯Aï¼Œç„¶åå‡†å¤‡èµ‹å€¼çš„æ—¶å€™ä»ç„¶æ˜¯Aï¼Œä½†å®é™…ä¸Šæœ‰å¯èƒ½Açš„å€¼è¢«æ”¹æˆäº†Bï¼Œç„¶ååˆæ”¹å›äº†Aï¼Œè¿™ä¸ªCASæ›´æ–°çš„æ¼æ´å°±å«åšABAã€‚åªæ˜¯ABAçš„é—®é¢˜å¤§éƒ¨åˆ†åœºæ™¯ä¸‹éƒ½ä¸å½±å“å¹¶å‘çš„æœ€ç»ˆæ•ˆæœã€‚</p><p>Javaä¸­æœ‰AtomicStampedReferenceæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»–åŠ å…¥äº†é¢„æœŸæ ‡å‡†å’Œæ›´æ–°åæ ‡å‡†ä¸¤ä¸ªå­—æ®µï¼Œæ›´æ–°æ—¶ä¸å…‰æ£€æŸ¥å€¼ï¼Œè¿˜è¦æ£€æŸ¥å½“å‰çš„æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå…¨éƒ¨ç›¸ç­‰çš„è¯æ‰ä¼šæ›´æ–°ã€‚</p><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* CAS è§£å†³ABAé—®é¢˜<br>\* ç±»ä¼¼ä¹è§‚é”ï¼ï¼<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">22</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CASDemo2</span> &#123;<br><span class="hljs-comment">//Integerä½¿ç”¨äº†å¯¹è±¡ç¼“å­˜æœºåˆ¶,é»˜è®¤èŒƒå›´æ˜¯-128 ~ 127æ¨èä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•valueOfè·å–å¯¹è±¡å®ä¾‹,</span><br><span class="hljs-comment">// è€Œä¸æ˜¯new ,å› ä¸ºvalueOfä½¿ç”¨ç¼“å­˜,è€Œnew -å®šä¼šåˆ›å»ºæ–°çš„å¯¹è±¡åˆ†é…æ–°çš„å†…å­˜ç©ºé—´;</span><br><span class="hljs-comment">//CAS compareAndSetï¼šæ¯”è¾ƒå¹¶äº¤æ¢</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>AtomicStampedReference&lt;Integer&gt; atomicStampedReference = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicStampedReference</span>&lt;Integer&gt;(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> atomicStampedReference.getStamp();<br>System.out.println(<span class="hljs-string">&quot;a1=&gt;&quot;</span>+atomicStampedReference.getStamp());<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>atomicStampedReference.compareAndSet(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,atomicStampedReference.getStamp(),atomicStampedReference.getStamp()+<span class="hljs-number">1</span>);<br>System.out.println(<span class="hljs-string">&quot;a2=&gt;&quot;</span>+atomicStampedReference.getStamp());<br>atomicStampedReference.compareAndSet(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,atomicStampedReference.getStamp(),atomicStampedReference.getStamp()+<span class="hljs-number">1</span>);<br>System.out.println(<span class="hljs-string">&quot;a3=&gt;&quot;</span>+atomicStampedReference.getStamp());<br>&#125;,<span class="hljs-string">&quot;a&quot;</span>).start();<br><span class="hljs-comment">//å¦å¤–ä¸€ä¸ªçº¿ç¨‹</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> atomicStampedReference.getStamp();<br>System.out.println(<span class="hljs-string">&quot;b1=&gt;&quot;</span>+stamp);<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>atomicStampedReference.compareAndSet(<span class="hljs-number">1</span>,<span class="hljs-number">6</span>,atomicStampedReference.getStamp(),atomicStampedReference.getStamp()+<span class="hljs-number">1</span>);<br>System.out.println(<span class="hljs-string">&quot;b2=&gt;&quot;</span>+atomicStampedReference.getStamp());<br>&#125;,<span class="hljs-string">&quot;b&quot;</span>).start();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</strong>ï¼šè‡ªæ—‹é”CASçš„æ–¹å¼å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥å¾ˆå¤§çš„å¼€é”€ã€‚</p><p><strong>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</strong>ï¼šåªå¯¹ä¸€ä¸ªå…±äº«å˜é‡æ“ä½œå¯ä»¥ä¿è¯åŸå­æ€§ï¼Œä½†æ˜¯å¤šä¸ªåˆ™ä¸è¡Œï¼Œå¤šä¸ªå¯ä»¥é€šè¿‡AtomicReferenceæ¥å¤„ç†æˆ–è€…ä½¿ç”¨é”synchronizedæ¥å®ç°</p><h1 id="ReentrantLockåŸç†ï¼Ÿå®ƒå’Œsynchronizedçš„åŒºåˆ«"><a href="#ReentrantLockåŸç†ï¼Ÿå®ƒå’Œsynchronizedçš„åŒºåˆ«" class="headerlink" title="ReentrantLockåŸç†ï¼Ÿå®ƒå’Œsynchronizedçš„åŒºåˆ«"></a>ReentrantLockåŸç†ï¼Ÿå®ƒå’Œsynchronizedçš„åŒºåˆ«</h1><p>ç›¸æ¯”äºsynchronized,ReentrantLockéœ€è¦æ˜¾å¼çš„è·å–é”å’Œé‡Šæ”¾é”ï¼Œç›¸å¯¹ç°åœ¨åŸºæœ¬ä¸Šéƒ½æ˜¯ç”¨JDK7å’ŒJDK8çš„ç‰ˆæœ¬ï¼ŒReentrantLockçš„æ•ˆç‡å’ŒsynchronizedåŒºåˆ«åŸºæœ¬å¯ä»¥æŒå¹³ã€‚ä»–ä»¬çš„ä¸»è¦åŒºåˆ«æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><p>synchronizedæ˜¯Javaè¯­è¨€å…³é”®å­—ï¼Œæ˜¯åŸç”Ÿè¯­æ³•å±‚é¢çš„äº’æ–¥ï¼Œéœ€è¦JVMå®ç°ã€‚è€ŒReentrantLockå®ƒæ˜¯JDK1.5ä¹‹åæä¾›çš„AIPå±‚é¢çš„äº’æ–¥é”ï¼Œéœ€è¦lock()å’Œunlock()æ–¹æ³•é…åˆtry&#x2F;finalyè¯­å¥å—æ¥å®Œæˆ</p></li><li><p>ç­‰å¾…å¯ä¸­æ–­ï¼Œç­‰å¾…å¯ä¸­æ–­æ˜¯æŒ‡å½“å‰æŒæœ‰é”çš„çº¿ç¨‹é•¿æœŸä¸é‡Šæ”¾é”çš„æ—¶å€™ï¼Œæ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…æ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ã€‚å¯ç­‰å¾…ç‰¹æ€§å¯¹å¤„ç†æ‰§è¡Œæ—¶é—´éå¸¸é•¿çš„åŒæ­¥å¿«å¾ˆæœ‰å¸®åŠ©ã€‚synchronizedå°±ä¸æ”¯æŒç­‰å¾…å¯ä¸­æ–­ï¼Œä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ä¸é‡Šæ”¾ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±ä¼šä¸€ç›´ç­‰å¾…ã€‚ReentrantLockåˆ™å¯ä»¥ä¸­æ–­ç­‰å¾…ï¼Œå»åšåˆ«çš„äº‹æƒ…</p></li><li><p>å…¬å¹³é”ï¼Œå…¬å¹³é”å°±æ˜¯çº¿ç¨‹ä¸èƒ½æ’é˜Ÿï¼Œä¸¥æ ¼çš„å…ˆæ¥ååˆ°ã€‚éå…¬å¹³é”å°±æ˜¯çº¿ç¨‹å¯ä»¥æ’é˜Ÿã€‚æ˜¯æŒ‡synchronizedå’ŒReentrantLocké»˜è®¤éƒ½æ˜¯éå…¬å¹³é”ï¼Œä½†ReentrantLockå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ä¼ å‚å˜æˆå…¬å¹³é”ï¼Œä½†è¿™æ ·æ€§èƒ½ä¹Ÿä¼šæ€¥å‰§ä¸‹é™</p></li><li><p>é”ç»‘å®šå¤šä¸ªæ¡ä»¶ã€‚synchronizedä¸­ï¼Œé”å¯¹è±¡çš„wait()å’Œnotify()æˆ–notifyAll()æ–¹æ³•å¯ä»¥å®ç°ä¸€ä¸ªéšå«çš„æ¡ä»¶ã€‚ä½†å¦‚æœè¦å¤šäºä¸€ä¸ªçš„æ¡ä»¶å…³è”ï¼Œå°±ä¸å¾—ä¸é¢å¤–æ·»åŠ ä¸€æŠŠé”ã€‚ReentrantLockå¯ä»¥åŒæ—¶ç»‘å®šå¤šä¸ªConditionå¯¹è±¡ï¼Œåªéœ€å¤šæ¬¡è°ƒç”¨new Condition()å³å¯</p><p>â€‹</p></li></ol><p>ReentrantLockåŸºäº<strong>AQS</strong>(AbstractQueueSynchronizer <strong>æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨</strong>)å®ç°ï¼ŒAQSä¹Ÿæ˜¯ç”¨æ¥æ„å»ºé”æˆ–è€…å…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æ¶ã€‚å¤§åé¼é¼çš„AQSçœŸçš„æ¥äº†ï¼ï¼</p><ol><li><p><strong>ä½¿ç”¨ä¸€ä¸ªintç±»å‹çš„æˆå‘˜å˜é‡è¡¨ç¤ºåŒæ­¥çŠ¶æ€</strong></p><ul><li>getState()ï¼šè·å–å½“å‰åŒæ­¥çŠ¶æ€</li><li>setState(int newState)ï¼šè®¾ç½®å½“å‰åŒæ­¥çŠ¶æ€</li><li>compareAndSetState(int expect,int update)ï¼šä½¿ç”¨CASè®¾ç½®å½“å‰çŠ¶æ€ï¼Œè¯¥æ–¹æ³•èƒ½å¤Ÿä¿è¯çŠ¶æ€è®¾ç½®çš„åŸå­æ€§ã€‚</li></ul></li><li><p><strong>é€šè¿‡å†…ç½®çš„FIFOåŒå‘é˜Ÿåˆ—æ¥å®Œæˆè·å–é”çº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œ</strong></p><ul><li><p>åŒæ­¥å™¨åŒ…å«ä¸¤ä¸ªèŠ‚ç‚¹ç±»å‹çš„åº”ç”¨ï¼Œä¸€ä¸ªæŒ‡å‘èŠ‚ç‚¹ï¼Œä¸€ä¸ªæŒ‡å‘å°¾èŠ‚ç‚¹ï¼Œæœªè·å–çš„çº¿ç¨‹ä¼šåˆ›å»ºèŠ‚ç‚¹çº¿ç¨‹å®‰å…¨ï¼ˆcompareAndSetTailï¼‰çš„åŠ å…¥é˜Ÿåˆ—å°¾éƒ¨ã€‚åŒæ­¥é˜Ÿåˆ—éµå¾ªFIFOï¼Œé¦–èŠ‚ç‚¹æ˜¯è·å–åŒæ­¥çŠ¶æ€æˆåŠŸçš„èŠ‚ç‚¹ã€‚</p><p><img src="https://i.loli.net/2021/03/22/gJoCs1xQ5pKanq9.jpg"></p><p>â€‹</p></li><li><p>æœªè·å–åˆ°é”çš„çº¿ç¨‹å°†åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè®¾ç½®åˆ°å°¾èŠ‚ç‚¹</p><p><img src="https://i.loli.net/2021/03/22/Xq32R6MViNa51hr.jpg"></p></li><li><p>é¦–èŠ‚ç‚¹çš„çº¿ç¨‹åœ¨é‡Šæ”¾é”æ—¶ï¼Œå°†ä¼šå”¤é†’åç»§èŠ‚ç‚¹ã€‚è€Œåç»§èŠ‚ç‚¹å°†ä¼šåœ¨è·å–é”æˆåŠŸæ—¶å°†è‡ªå·±è®¾ç½®æˆé¦–èŠ‚ç‚¹ã€‚ã€‚</p><p><img src="https://i.loli.net/2021/03/22/fHFc6vpIRXhSr9L.jpg"></p><p>â€‹</p><p>æ€»çš„æ¥è¯´å°±æ˜¯ï¼š</p><p>AQSå†…éƒ¨ç»´æŠ¤â¼€ä¸ªstateçŠ¶æ€ä½ï¼Œå°è¯•åŠ é”çš„æ—¶å€™é€šè¿‡CAS(CompareAndSwap)ä¿®æ”¹å€¼ï¼Œå¦‚æœæˆåŠŸè®¾ç½®ä¸º</p><p>1ï¼Œå¹¶ä¸”æŠŠå½“å‰çº¿ç¨‹IDèµ‹å€¼ï¼Œåˆ™ä»£è¡¨åŠ é”æˆåŠŸï¼Œâ¼€æ—¦è·å–åˆ°é”ï¼Œå…¶ä»–çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡è¿›â¼Šé˜»å¡é˜Ÿåˆ—â¾ƒ</p><p>æ—‹ï¼Œè·å¾—é”çš„çº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™å°†ä¼šå”¤é†’é˜»å¡é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œé‡Šæ”¾é”çš„æ—¶å€™åˆ™ä¼šæŠŠstateé‡æ–°ç½®ä¸º0ï¼ŒåŒ</p><p>æ—¶å½“å‰çº¿ç¨‹IDç½®ä¸ºç©ºã€‚</p><p>â€‹</p></li></ul></li></ol><h1 id="HashMapåŸç†"><a href="#HashMapåŸç†" class="headerlink" title="HashMapåŸç†"></a>HashMapåŸç†</h1><p>è¿™ä¸ªæˆ‘ä¸Šä¸€ç¯‡åšæ–‡å·²ç»å½»åº•åˆ†æè¿‡ï¼Œè¿™é‡Œå°±ä¸å†è¯´äº†ï¼Œè´´ä¸ªé“¾æ¥ï¼š</p><p><a href="https://luffy997.github.io/2021/03/04/HashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">HashMapæºç åˆ†æ</a></p><h1 id="å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ€ä¹ˆä½¿ç”¨Mapï¼ŸConcurrentHashMapæœ‰äº†è§£è¿‡å—ï¼Ÿ"><a href="#å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ€ä¹ˆä½¿ç”¨Mapï¼ŸConcurrentHashMapæœ‰äº†è§£è¿‡å—ï¼Ÿ" class="headerlink" title="å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ€ä¹ˆä½¿ç”¨Mapï¼ŸConcurrentHashMapæœ‰äº†è§£è¿‡å—ï¼Ÿ"></a>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ€ä¹ˆä½¿ç”¨Mapï¼ŸConcurrentHashMapæœ‰äº†è§£è¿‡å—ï¼Ÿ</h1><p>HashMapç”±äºåº•å±‚å¹¶æ²¡æœ‰åŠ å…¥åŒæ­¥é”çš„æœºåˆ¶ï¼Œæ‰€ä»¥ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæ‰€ä»¥è§£å†³æ–¹æ³•æœ‰ï¼š</p><ol><li>ä½¿ç”¨Collections.synchronizedMap()åŒæ­¥åŠ é”çš„æ–¹å¼</li><li>è¿˜å¯ä»¥ä½¿ç”¨HashTableï¼Œè™½ç„¶æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œä½†æ€§èƒ½å¾ˆå·®</li><li>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯ä»¥ä½¿ç”¨JUCä¸‹çš„ConcurrentHashMap</li></ol><p>ConcurrentHashmapåœ¨JDK1.7å’Œ1.8çš„ç‰ˆæœ¬æ”¹åŠ¨æ¯”è¾ƒå¤§ï¼Œ1.7ä½¿â½¤Segment+HashEntryåˆ†æ®µé”çš„æ–¹å¼å®</p><p>ç°ï¼Œ1.8åˆ™æŠ›å¼ƒäº†Segmentï¼Œæ”¹ä¸ºä½¿â½¤CAS+synchronized+Nodeå®ç°ï¼ŒåŒæ ·ä¹ŸåŠ å…¥äº†çº¢â¿Šæ ‘ï¼Œé¿å…é“¾è¡¨</p><p>è¿‡é•¿å¯¼è‡´æ€§èƒ½çš„é—®é¢˜ã€‚</p><p>å…³äºConcurrentHashMapçš„æºç åˆ†æï¼Œåé¢å•ç‹¬å†™ä¸€ç¯‡ã€‚</p><h1 id="volatileåŸç†"><a href="#volatileåŸç†" class="headerlink" title="volatileåŸç†"></a>volatileåŸç†</h1><p>ç›¸æ¯”synchronizedçš„åŠ é”æ–¹å¼æ¥è§£å†³å…±äº«å˜é‡çš„å†…å­˜å¯è§æ€§é—®é¢˜ï¼Œvolatileå°±æ˜¯æ›´è½»é‡çš„é€‰æ‹©ï¼Œä»–æ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢çš„é¢å¤–å¼€é”€æˆæœ¬ã€‚ä½¿ç”¨volatileå£°æ˜çš„å˜é‡ï¼Œå¯ä»¥ç¡®ä¿å€¼è¢«æ›´æ–°çš„æ—¶å€™å…¶ä»–çº¿ç¨‹ç«‹åˆ»å¯è§ã€‚</p><p>volatileä½¿ç”¨å†…å­˜å±éšœæ¥ä¿è¯ä¸ä¼šå‘ç”ŸæŒ‡ä»¤é‡æ’ï¼Œè§£å†³å†…å­˜å¯è§æ€§çš„é—®é¢˜ï¼Œä½†ä¸ä¿è¯åŸå­æ€§ã€‚</p><p>çº¿ç¨‹å¹¶ä¸ä¼šæ—¶æ—¶å’Œä¸»å†…å­˜è¿›è¡Œç›´æ¥äº¤äº’ï¼Œçº¿ç¨‹éƒ½æ˜¯ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡åˆ°å·¥ä½œå†…å­˜æ¥æ“ä½œï¼Œå®Œæˆä¹‹åå†æŠŠç»“æœå†™å›ä¸»å†…å­˜ï¼Œä½†æ˜¯è¿™æ ·å°±ä¼šå¸¦æ¥å¯è§æ€§é—®é¢˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç°åœ¨æˆ‘ä»¬æ˜¯ä¸¤çº§ç¼“å­˜çš„åŒæ ¸CPUæ¶æ„ï¼ŒåŒ…å«L1ã€L2ä¸¤çº§ç¼“å­˜ã€‚å¯¹äºä»€ä¹ˆæ˜¯å·¥ä½œå†…å­˜å’Œä¸»å­˜æˆ‘åœ¨JUCç³»åˆ—å·²ç»è®²è¿‡ï¼Œè¿™é‡Œå°±ä¸å†ç»§ç»­è®²ã€‚</p><ol><li><p>çº¿ç¨‹Aé¦–å…ˆè·å–å˜é‡Xçš„å€¼ï¼Œç”±äºæœ€åˆä¸¤çº§ç¼“å­˜éƒ½æ˜¯ç©ºï¼Œæ‰€ä»¥ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–Xï¼Œå‡è®¾Xåˆå§‹å€¼ä¸º0ï¼Œçº¿ç¨‹Aè¯»å–ä¹‹åæŠŠXå€¼éƒ½ä¿®æ”¹ä¸º1ï¼ŒåŒæ—¶å†™å›ä¸»å†…å­˜ã€‚è¿™æ—¶å€™ç¼“å­˜å’Œä¸»å†…å­˜çš„æƒ…å†µå¦‚ä¸‹ï¼š</p><p><img src="https://i.loli.net/2021/03/22/dlgtVvHkZ9UyMRn.jpg"></p></li><li><p>çº¿ç¨‹Bä¹Ÿè¿™æ ·åŒæ—¶è¯»å–xçš„å€¼ï¼Œç”±äºL2ç¼“å­˜å·²ç»æœ‰ç¼“å­˜x&#x3D;1ï¼Œæ‰€ä»¥ç›´æ¥ä»L2ç¼“å­˜è¯»å–ï¼Œä¹‹åçº¿ç¨‹BæŠŠx</p><p>ä¿®æ”¹ä¸º2ï¼ŒåŒæ—¶å†™å›L2å’Œä¸»å†…å­˜ã€‚è¿™æ˜¯çš„xå€¼å¦‚ä¸‹:</p><p>é‚£ä¹ˆçº¿ç¨‹Aå¦‚æœå†æƒ³è·å–å˜é‡xçš„å€¼ï¼Œå› ä¸ºL1ç¼“å­˜å·²ç»æœ‰äº†x&#x3D;1ï¼Œæ‰€ä»¥è¿™æ—¶å€™å˜é‡å†…å­˜ä¸å¯è§é—®é¢˜å°±äº§ç”Ÿäº†ï¼ŒBä¿®æ”¹ä¸º2çš„å€¼å¯¹Aæ¥è¯´æ²¡æœ‰ä»»ä½•æ„ŸçŸ¥</p><p><img src="https://i.loli.net/2021/03/22/EO3BV8I5AXNUtiS.jpg"></p><p>â€‹</p><p>è¿™æ—¶ï¼Œå¯ä»¥é€šè¿‡volatileä¿®è®¾å˜é‡ï¼Œå½“çº¿ç¨‹Aå†æ¬¡è¯»å–å˜é‡xçš„è¯ï¼ŒCPUå°±ä¼šæ ¹æ®ç¼“å­˜ä¸€è‡´æ€§åè®®å¼ºåˆ¶çº¿ç¨‹Aé‡æ–°ä»ä¸»å†…å­˜åŠ è½½æœ€æ–°çš„å€¼åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨ç¼“å­˜ä¸­çš„å€¼ã€‚</p><p>å†æ¥è¯´å†…å­˜å±éšœçš„é—®é¢˜ï¼Œvolatileä¿®è®¾ä¹‹åä¼šåŠ å…¥ä¸åŒçš„å†…å­˜å±éšœæ¥ä¿è¯å¯è§æ€§çš„é—®é¢˜èƒ½æ­£ç¡®æ‰§è¡Œã€‚è¿™é‡Œå†™çš„å±éšœåŸºäºä¹¦ä¸­æä¾›çš„å†…å®¹ï¼Œä½†å®é™…ä¸Šç”±äºCPUæ¶æ„ä¸åŒï¼Œé‡æ’åºçš„ç­–ç•¥ä¹Ÿä¸åŒï¼Œæä¾›çš„å†…å­˜å±éšœä¹Ÿä¸€æ ·ï¼Œæ¯”å¦‚åœ¨x86å¹³å°ä¸Šï¼Œåªæœ‰StoreLoadä¸€è‡´å†…å­˜å±éšœã€‚</p><ol><li>StoreStoreå±éšœï¼Œä¿è¯ä¸Šé¢çš„æ™®é€šå†™ä¸å’Œvolatileå†™å‘â½£é‡æ’åº</li><li>StoreLoadå±éšœï¼Œä¿è¯volatileå†™ä¸åâ¾¯å¯èƒ½çš„volatileè¯»å†™ä¸å‘â½£é‡æ’åº</li><li>LoadLoadå±éšœï¼Œç¦æ­¢volatileè¯»ä¸åâ¾¯çš„æ™®é€šè¯»é‡æ’åº</li><li>LoadStoreå±éšœï¼Œç¦â½Œvolatileè¯»å’Œåâ¾¯çš„æ™®é€šå†™é‡æ’åº</li></ol></li></ol><p><img src="https://i.loli.net/2021/03/22/UAX1NtFPx8IpZRi.jpg"></p><h1 id="JMMå†…å­˜æ¨¡å‹çš„ç†è§£ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦JMM"><a href="#JMMå†…å­˜æ¨¡å‹çš„ç†è§£ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦JMM" class="headerlink" title="JMMå†…å­˜æ¨¡å‹çš„ç†è§£ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦JMM"></a>JMMå†…å­˜æ¨¡å‹çš„ç†è§£ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦JMM</h1><p>æœ¬èº«éšç€CPUå’Œå†…å­˜çš„å‘å±•é€Ÿåº¦å·®å¼‚çš„é—®é¢˜ï¼Œå¯¼è‡´CPUçš„é€Ÿåº¦è¿œå¿«äºå†…å­˜ï¼Œæ‰€ä»¥ç°åœ¨çš„CPUåŠ â¼Šäº†é«˜é€Ÿ<br>ç¼“å­˜ï¼Œé«˜é€Ÿç¼“å­˜â¼€èˆ¬å¯ä»¥åˆ†ä¸ºL1ã€L2ã€L3ä¸‰çº§ç¼“å­˜ã€‚åŸºäºä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬çŸ¥é“äº†è¿™å¯¼è‡´äº†ç¼“å­˜â¼€è‡´æ€§çš„<br>é—®é¢˜ï¼Œæ‰€ä»¥åŠ â¼Šäº†ç¼“å­˜â¼€è‡´æ€§åè®®ï¼ŒåŒæ—¶å¯¼è‡´äº†å†…å­˜å¯è§æ€§çš„é—®é¢˜ï¼Œè€Œç¼–è¯‘å™¨å’ŒCPUçš„é‡æ’åºå¯¼è‡´äº†åŸ<br>å­æ€§å’Œæœ‰åºæ€§çš„é—®é¢˜ï¼ŒJMMå†…å­˜æ¨¡å‹æ­£æ˜¯å¯¹å¤šçº¿ç¨‹æ“ä½œä¸‹çš„â¼€ç³»åˆ—è§„èŒƒçº¦æŸï¼Œå› ä¸ºä¸å¯èƒ½è®©ç¨‹åºå‘˜çš„ä»£<br>ç å»å…¼å®¹æ‰€æœ‰çš„CPUï¼Œé€šè¿‡JMMæˆ‘ä»¬æ‰å±è”½äº†ä¸åŒç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿå†…å­˜çš„è®¿é—®å·®å¼‚ï¼Œè¿™æ ·ä¿è¯äº†Javaç¨‹åºåœ¨ä¸åŒçš„å¹³å°ä¸‹è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¿è¯åœ¨é«˜å¹¶å‘çš„æ—¶å€™èƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œã€‚</p><p><img src="https://i.loli.net/2021/03/23/n7ToREwJh2p4e5Y.jpg"></p><p>**åŸå­æ€§ï¼š**Javaå†…å­˜å†…å­˜æ¨¡å‹é€šè¿‡readã€loadã€assignã€useã€storeã€writeæ¥ä¿è¯åŸå­æ€§æ“ä½œï¼Œå¦å¤–è¿˜æœ‰lockå’Œunlockï¼Œç›´æ¥å¯¹åº”ç€synchronizedå…³é”®å­—çš„monitorenterå’Œmonitorexitå­—èŠ‚ç æŒ‡ä»¤ã€‚</p><p>**å¯è§æ€§ï¼š**å¯è§æ€§çš„é—®é¢˜åœ¨ä¸Šé¢å·²ç»å›åˆ°äº†ï¼ŒJavaä¿è¯å¯è§æ€§å¯ä»¥é€šè¿‡volatileã€synchornizedã€finalæ¥å®ç°ã€‚</p><p>**æœ‰åºæ€§ï¼š**ç”±äºå¤„ç†å™¨å’Œç¼–è¯‘å™¨çš„é‡æ’åºå¯¼è‡´çš„æœ‰åºæ€§é—®é¢˜ï¼ŒJavaé€šè¿‡volatileã€synchornizedæ¥ä¿è¯ã€‚</p><p><strong>happen-beforeè§„åˆ™</strong></p><p>è™½ç„¶æŒ‡ä»¤é‡æ’æé«˜äº†å¹¶å‘çš„æ€§èƒ½ï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºä¼šå¯¹æŒ‡ä»¤é‡æ’åšå‡ºâ¼€äº›è§„åˆ™é™åˆ¶ï¼Œå¹¶ä¸èƒ½è®©æ‰€æœ‰çš„æŒ‡</p><p>ä»¤éƒ½éšæ„çš„æ”¹å˜æ‰§è¡Œä½ç½®ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><p>å•çº¿ç¨‹æ¯ä¸ªæ“ä½œï¼Œhappen-beforeäºè¯¥çº¿ç¨‹ä¸­ä»»æ„åç»­æ“ä½œ</p></li><li><p>volatileå†™happen-beforeä¸åç»­å¯¹è¿™ä¸ªå˜é‡çš„è¯»</p></li><li><p>synchronizedè§£é”happen-beforeåç»­å¯¹è¿™ä¸ªé”çš„åŠ é”</p></li><li><p>finalå˜é‡çš„å†™happen-beforeäºfinalåŸŸå¯¹è±¡çš„è¯»ï¼Œhappen-beforeåç»­å¯¹finalå˜é‡çš„è¯»</p></li><li><p>ä¼ é€’æ€§è§„åˆ™ï¼ŒAå…ˆäºBï¼ŒBå…ˆäºCï¼Œé‚£ä¹ˆAâ¼€å®šå…ˆäºCå‘ç”Ÿ</p><p>â€‹</p></li></ol><h1 id="å·¥ä½œå†…å­˜å’Œä¸»å­˜åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å·¥ä½œå†…å­˜å’Œä¸»å­˜åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å·¥ä½œå†…å­˜å’Œä¸»å­˜åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å·¥ä½œå†…å­˜å’Œä¸»å­˜åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>ä¸»å­˜å°±å¯ä»¥è®¤ä¸ºå°±æ˜¯ç‰©ç†å†…å­˜ï¼ŒJavaå†…å­˜æ¨¡å‹ä¸­å®é™…å°±æ˜¯è™šæ‹Ÿæœºå†…å­˜çš„ä¸€éƒ¨åˆ†ã€‚è€Œå·¥ä½œå†…å­˜å°±æ˜¯CPUç¼“å­˜ï¼Œä»–å¯èƒ½æ˜¯å¯„å­˜å™¨ä¹Ÿå¯èƒ½æ˜¯L1\L2\L3ç¼“å­˜ï¼Œéƒ½æ˜¯æœ‰å¯èƒ½çš„ã€‚</p><h1 id="ThreadLocalçš„ç†è§£å’ŒåŸç†"><a href="#ThreadLocalçš„ç†è§£å’ŒåŸç†" class="headerlink" title="ThreadLocalçš„ç†è§£å’ŒåŸç†"></a>ThreadLocalçš„ç†è§£å’ŒåŸç†</h1><p><strong>ThreadLocalçš„ä½œç”¨ï¼š</strong></p><p>ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œå®ç°åœ¨çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¼ é€’åŒä¸€ä¸ªå¯¹è±¡ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å†™ä¸€ä¸ªæµ‹è¯•ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* ThreadLocal æµ‹è¯•ç±»<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">3</span>/<span class="hljs-number">24</span> <span class="hljs-number">8</span>:<span class="hljs-number">06</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WithThreadLocal</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;Integer&gt; num = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;Integer&gt;() &#123;<br><span class="hljs-comment">// é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä¿®æ”¹â€œçº¿ç¨‹å˜é‡â€çš„åˆå§‹å€¼ï¼Œé»˜è®¤æ˜¯null</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> Integer <span class="hljs-title function_">initialValue</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>&#125;;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br><span class="hljs-keyword">if</span> (num.get().equals(<span class="hljs-number">0</span>))&#123;<br>num.set(<span class="hljs-number">1</span>);<br>&#125;<br>System.out.println(Thread.currentThread().getName()+<span class="hljs-string">&quot;---&gt;&quot;</span>+num.get());<br>&#125;).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br><span class="hljs-keyword">if</span> (num.get().equals(<span class="hljs-number">0</span>))&#123;<br>num.set(<span class="hljs-number">2</span>);<br>&#125;<br>System.out.println(Thread.currentThread().getName()+<span class="hljs-string">&quot;---&gt;&quot;</span>+num.get());<br>&#125;).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br><span class="hljs-keyword">if</span> (num.get().equals(<span class="hljs-number">0</span>))&#123;<br>num.set(<span class="hljs-number">3</span>);<br>&#125;<br>System.out.println(Thread.currentThread().getName()+<span class="hljs-string">&quot;---&gt;&quot;</span>+num.get());<br>&#125;).start();<br>System.out.println(<span class="hljs-string">&quot;æœ€ç»ˆçš„num---&gt;&quot;</span>+num.get());<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è‹¥æ²¡æœ‰ThreadLocalç›¸å…³çš„çŸ¥è¯†ï¼Œè¿™æ®µä»£ç å…¶å®æœ€ç»ˆçš„ä¹Ÿä¸èƒ½ç¡®å®šï¼ˆçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºæ˜¯å‡­CPUè°ƒåº¦çš„ï¼Œè¿™ä¸ªå’Œä»£ç é¡ºåºå…³ç³»ä¸å¤§ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬åªèƒ½æŠŠnumå½“ä½œä¸€ä¸ªé™æ€çš„å…¨å±€å˜é‡ï¼Œæ²¡æœ‰å¯¹å®ƒè¿›è¡Œä»»ä½•çš„åŠ é”æ“ä½œï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œèµ·ç æ‰“å°çš„ä¸ä¼šæ˜¯numçš„åˆå§‹å€¼0ï¼Œä½†æˆ‘ä»¬è¿è¡Œå‘ç°æœ€ç»ˆçš„numå°±æ˜¯0ï¼Œåœ¨æ¯æ¡çº¿ç¨‹ä¸­æ‰“å°çš„æ•°æ®ä¹Ÿéƒ½æ˜¯æ³¨å…¥çš„æ•°æ®ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¥‡æ€ªï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">Thread-0---&gt;1<br>Thread-1---&gt;2<br>æœ€ç»ˆçš„num---&gt;0<br>Thread-2---&gt;3<br></code></pre></td></tr></table></figure><p>æŸ¥é˜…èµ„æ–™ï¼Œå‘ç°TheadLocaç›¸å…³èµ„æ–™å‘ç°ï¼Œå®ƒä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æä¾›äº†å˜é‡çš„å‰¯æœ¬ï¼Œä½¿å¾—æ¯ä¸ªçº¿ç¨‹åœ¨æŸä¸€æ—¶é—´è®¿é—®åˆ°çš„å¹¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ ·å°±éš”ç¦»äº†å¤šä¸ªçº¿ç¨‹å¯¹æ•°æ®çš„æ•°æ®å…±äº«ã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæ˜æ˜çº¿ç¨‹å¯¹å®ƒè¿›è¡Œäº†ä¿®æ”¹ï¼Œä½†ä¸ºä»€ä¹ˆè¿˜æ˜¯åˆå§‹å€¼çš„åŸå› ï¼</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±ç¿»è¯»æºç ï¼Œçœ‹çœ‹ThreadLocalçš„å†…éƒ¨å®ç°åŸç†å’Œå¸¸ç”¨æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Thread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalMap</span> &#123;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;<br><span class="hljs-comment">// ä¸å½“å‰ThreadLocalç›¸å…³çš„å¯¹è±¡</span><br>Object value;<br>Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;<br><span class="hljs-built_in">super</span>(k);<br>value = v;<br>&#125;<br>&#125;<br><span class="hljs-comment">// åˆå§‹å®¹é‡</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> INITIAL\_CAPACITY = <span class="hljs-number">16</span>;<br><span class="hljs-comment">// å­˜æ”¾ä¿¡æ¯çš„æ•°ç»„</span><br><span class="hljs-keyword">private</span> Entry[] table;<br><span class="hljs-comment">// å½“å‰å®¹å™¨å¤§å°</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">// å½“å®¹é‡åˆ°è¾¾é˜ˆå€¼å°±ä¼šè¿›è¡Œæ‰©å®¹</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> threshold; <span class="hljs-comment">// Default to 0</span><br><span class="hljs-comment">// è®¾ç½®é˜ˆå€¼thresholdä¸ºæ•°ç»„é•¿åº¦çš„2/3</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setThreshold</span><span class="hljs-params">(<span class="hljs-type">int</span> len)</span> &#123;<br>threshold = len \* <span class="hljs-number">2</span> / <span class="hljs-number">3</span>;<br>&#125;<br><span class="hljs-comment">// ThreadLocalMapçš„æ„é€ å™¨ï¼Œå¯ä»¥çœ‹å‡ºkeyæ˜¯ç»è¿‡ThreadLocalå†…éƒ¨ä¸€ä¸ªå˜é‡threadLocalHashCode</span><br><span class="hljs-comment">// è®¡ç®—è€Œæ¥çš„ä¸€ä¸ªç´¢å¼•ä½ç½®ï¼Œç¨åè¯¦è§£</span><br>ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;<br>table = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>[INITIAL\_CAPACITY];<br><span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> firstKey.threadLocalHashCode &amp; (INITIAL\_CAPACITY - <span class="hljs-number">1</span>);<br>table[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(firstKey, firstValue);<br>size = <span class="hljs-number">1</span>;<br>setThreshold(INITIAL\_CAPACITY);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªThreadLocalMapæ—¶ï¼Œå®é™…ä¸Šå†…éƒ¨æ˜¯æ„å»ºäº†ä¸€ä¸ªEntryç±»å‹çš„æ•°ç»„ï¼ŒEntryæ˜¯ç±»ä¼¼Mapçš„Key-Valueç»“æ„çš„ï¼ŒKeyæ˜¯æ ¹æ®å½“å‰ThreadLocalè®¡ç®—æ¥äº†ä¸€ä¸ªhashCodeï¼ŒValueå°±æ˜¯è¦ä¿å­˜çš„çº¿ç¨‹å˜é‡çš„å‰¯æœ¬ï¼ˆå¦‚ä¸Šæ–‡ä¸­çš„SimpleDateFormatï¼‰ã€‚keyåˆå§‹åŒ–å¤§å°ä¸º16ï¼Œé˜ˆå€¼thresholdä¸ºæ•°ç»„é•¿åº¦çš„2&#x2F;3ï¼ŒEntryç±»å‹ä¸ºï¼Œæœ‰ä¸€ä¸ªå¼±å¼•ç”¨æŒ‡å‘ThreadLocalå¯¹è±¡ã€‚</p><p>æ‰€ä»¥æ¯ä¸ªThreadå†…éƒ¨éƒ½ç»´æŠ¤è¿™ä¸€ä¸ªç±»ä¼¼Mapï¼ˆè™½ç„¶ä¸æ˜¯ï¼Œä½†æ˜¯å¯ä»¥ç®€å•çš„è®¤ä¸ºæ˜¯HashMapï¼‰ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªThreadLocalåï¼Œå®é™…ä¸Šæ˜¯æŠŠå½“å‰çš„ThreadLocalä¿¡æ¯å­˜æ”¾åˆ°Threadå†…éƒ¨æ‰€ç»´æŠ¤çš„ThreadLocalMapä¸­ã€‚ThreadLocalMapæ˜¯å¯¹å½“å‰çº¿ç¨‹ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½å¼€æ”¾çš„ï¼Œæ‰€ä»¥å½“å°±åšåˆ°äº†æ¯ä¸ªçº¿ç¨‹å…±äº«ï¼Œæ¥ä¸‹æ¥è¿›è¡Œè¯¦ç»†åˆ†æã€‚</p><p>ç»§ç»­çœ‹ThreadLocalçš„å‡ ä¸ªå¸¸ç”¨æ–¹æ³•ï¼Œå…¶å®çœŸçš„å°±å‡ ä¸ªï¼Œè¿™é‡ŒæŠŠget()ï¼Œset()ï¼ŒsetInitialValue()æ‹¿å‡ºæ¥è®²è®²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> &#123;<br><span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br><span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br><span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)<br>map.set(<span class="hljs-built_in">this</span>, value);<br><span class="hljs-keyword">else</span><br>createMap(t, value);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç éå¸¸ç®€å•ï¼Œæ‹¿åˆ°å½“å‰çº¿ç¨‹å¯¹è±¡ï¼Œä»ä¸Šé¢çš„mapè·å–mapå¯¹è±¡ï¼Œè‹¥ä¸ºç©ºå°±ä»¥å‘mapä¸­æ·»ä»¥tä¸ºkeyï¼Œvalueå°±æ˜¯å½“å‰å¯¹è±¡ï¼Œè‹¥ä¸ä¸ºç©ºï¼Œå°±åˆ·æ–°valueã€‚åˆ°è¿™æ˜¯ä¸æ˜¯å¾ˆå¤šåŒå­¦ä¼šç–‘æƒ‘ï¼Œé‚£è¿™æ ·çš„æ“ä½œmapçš„keyä¸å°±ä¸ä¸€æ ·äº†å—ï¼Œä¸€ä¸ªæ˜¯å½“å‰çº¿ç¨‹å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯thisï¼Œä¹Ÿå°±æ˜¯ThreadLocalå¯¹è±¡ï¼Œæˆ‘ä»¬ç‚¹å¼€createMap()æºç å‘ç°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">void createMap(Thread t, T firstValue) &#123;<br>t.threadLocals = new ThreadLocalMap(this, firstValue);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ²¡é”™ï¼Œè¿™é‡Œç›´æ¥ä¿®æ”¹çš„æ˜¯å¼•ç”¨ï¼Œtçš„ç±»å‹æœ€åå°±æ˜¯ThreadLocaläº†ï¼Œæ‰€ä»¥è¿˜æ˜¯ä»¥ThreadLocalä¸ºkeyï¼Œä¼ å…¥çš„å‚æ•°ä½œä¸ºvalueã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plain">public T get() &#123;<br>Thread t = Thread.currentThread();<br>ThreadLocalMap map = getMap(t);<br>if (map != null) &#123;<br>ThreadLocalMap.Entry e = map.getEntry(this);<br>if (e != null) &#123;<br>T result = (T)e.value;<br>return result;<br>&#125;<br>&#125;<br>return setInitialValue();<br>&#125;<br></code></pre></td></tr></table></figure><p>get()æ–¹æ³•æ²¡ä»€ä¹ˆå¥½è®²çš„ï¼Œå°±æ˜¯ä»mapä¸­çš„Entryå–å€¼ï¼Œå‡å¦‚æœ‰é˜…è¯»è¿‡HashMapæºç çš„ç»éªŒï¼Œè¿™é‡Œå…¶å®å°±æ˜¯å…ˆä»mapä¸­æ‹¿åˆ°key(ThreadLoacl)ï¼Œå†åˆ¤æ–­mapæ˜¯ä¸æ˜¯ç©ºï¼Œä¸ä¸ºç©ºå°±æ˜¯ç›´æ¥è·å–å€¼ï¼Œç„¶åè¿”å›ï¼Œä¸ºç©ºå°±è°ƒç”¨setInitialValue()è¿›è¡Œåˆå§‹åŒ–æ“ä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plain">private T setInitialValue() &#123;<br>T value = initialValue();<br>Thread t = Thread.currentThread();<br>ThreadLocalMap map = getMap(t);<br>if (map != null)<br>map.set(this, value);<br>else<br>createMap(t, value);<br>return value;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°setInitialValue()è¿˜æ˜¯å’ŒcreateMapç›¸å…³ï¼ŒæŠŠæ•°æ®å­˜å…¥ThreadLocalMapçš„æ“ä½œã€‚</p><p>ä¸Šæ–‡ä¸­æˆ‘ä»¬æ¸…æ¥šäº†ThreadLocalMapå…¶å®å°±æ˜¯ä¸€ä¸ªEntryç±»å‹çš„æ•°ç»„ï¼Œç±»ä¼¼mapï¼Œä»»ä½•Mapéƒ½è¦è§£å†³çš„çš„å°±æ˜¯å“ˆå¸Œå†²çªã€‚å…¶ä¸­int i &#x3D; firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1);çš„iæ˜¯ThreadLocalå­˜æ”¾åœ¨ThreadLocalMapä¸­çš„ç´¢å¼•ä½ç½®ï¼Œç„¶åthreadLocalHashCodeçš„å…·ä½“ç»†èŠ‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">threadLocalHashCode</span> <span class="hljs-operator">=</span> nextHashCode();<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">nextHashCode</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> nextHashCode.getAndAdd(HASH\_INCREMENT);<br>&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">nextHashCode</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> nextHashCode.getAndAdd(HASH\_INCREMENT);<br>&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">nextHashCode</span> <span class="hljs-operator">=</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>();<br>ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;<br>table = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>[INITIAL\_CAPACITY];<br><span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> firstKey.threadLocalHashCode &amp; (INITIAL\_CAPACITY - <span class="hljs-number">1</span>);<br>table[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(firstKey, firstValue);<br>size = <span class="hljs-number">1</span>;<br>setThreshold(INITIAL\_CAPACITY);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯ä¸€ä¸ªThreadLocaléƒ½ä¼šæ ¹æ®nextHashCodeç”Ÿæˆä¸€ä¸ªintå€¼ï¼Œä½œä¸ºå“ˆå¸Œå€¼ã€‚ç„¶åæ ¹æ®è¿™ä¸ªå“ˆå¸Œå€¼å’Œæ•°ç»„çš„é•¿åº¦len-1ï¼ˆå› ä¸ºlençš„é•¿åº¦æ€»æ˜¯2çš„å€æ•°ï¼Œå‡ä¸€çš„è¯å°±å¯ä»¥ä¿è¯ä½Nä½éƒ½æ˜¯1ï¼‰è¿›è¡Œæ±‚å’Œï¼Œä»è€Œè·å–å“ˆå¸Œå€¼çš„ä½Nä½ï¼Œä»è€Œè·å–å†æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®ã€‚è€Œä¸”nextHashCodeçš„ç±»å‹æ˜¯AtomicIntegerï¼Œè¿™ä¸ªå°±æ˜¯ä¸ºäº†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹èƒ½ä¿è¯æ•°å€¼æ“ä½œåŸå­æ€§çš„ç±»ã€‚</p><p><strong>å¦‚ä½•è§£å†³å“ˆå¸Œå†²çªå‘¢ï¼Ÿ</strong></p><p>ç†Ÿæ‚‰çš„HashMapå‘ç”Ÿå“ˆå¸Œå†²çªæˆ‘ä»¬éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œé€šè¿‡é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘è¿›è¡Œè§£å†³ï¼Œè€ŒThreadLocalMapå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªå¾ˆç®€å•Entryæ•°ç»„ï¼Œå¹¶ä¸åƒHashMapå…·æœ‰é‚£ä¹ˆå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œé‚£ä¹ˆThreadLocalMapæ˜¯å¦‚ä½•è§£å†³çš„å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(ThreadLocal&lt;?&gt; key, Object value)</span> &#123;<br>ThreadLocal.ThreadLocalMap.Entry[] tab = table;<br><span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> tab.length;<br><span class="hljs-comment">// æ±‚ç´¢å¼•ä½ç½®</span><br><span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> key.threadLocalHashCode &amp; (len-<span class="hljs-number">1</span>);<br><span class="hljs-comment">// å¦‚æœè¦å­˜æ”¾çš„iä½ç½®æœ‰æ•°æ®ï¼Œå°±è¯´æ˜å‘ç”Ÿäº†å“ˆå¸Œå†²çª</span><br><span class="hljs-keyword">for</span> (ThreadLocal.ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> tab[i];<br>e != <span class="hljs-literal">null</span>;<br>e = tab[i = nextIndex(i, len)]) &#123;<br>ThreadLocal&lt;?&gt; k = e.get();<br><span class="hljs-comment">// å¦‚æœæ˜¯åŒä¸€ä¸ªThreadLocalå¯¹è±¡ï¼Œå°±ç›´æ¥è¦†ç›–</span><br><span class="hljs-keyword">if</span> (k == key) &#123;<br>e.value = value;<br><span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-comment">// å¦‚æœkeyä¸ºnullï¼Œåˆ™æ›¿æ¢å®ƒçš„ä½ç½®</span><br><span class="hljs-keyword">if</span> (k == <span class="hljs-literal">null</span>) &#123;<br>replaceStaleEntry(key, value, i);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-comment">// å¦åˆ™å°±nextIndex(i, len)ï¼Œå»æ‰¾ä¸‹ä¸€ä¸ªä½ç½®</span><br>&#125;<br>tab[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>.ThreadLocalMap.Entry(key, value);<br><span class="hljs-type">int</span> <span class="hljs-variable">sz</span> <span class="hljs-operator">=</span> ++size;<br><span class="hljs-keyword">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)<br>rehash();<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœå‘ç”Ÿå“ˆå¸Œå†²çªé‡‡ç”¨<strong>çº¿æ€§æ¢æµ‹</strong>çš„æ–¹å¼ï¼Œä¸»è¦å°±æ˜¯åˆ¤æ–­å½“å‰ä½ç½®æ˜¯å¦å¯ä»¥æ›¿æ¢ï¼Œ<strong>å¦‚æœå‘ç°è¿™ä¸ªä½ç½®ä¸Šå·²ç»æœ‰å…¶ä»–keyå€¼çš„å…ƒç´ è¢«å ç”¨ï¼Œåˆ™åˆ©ç”¨å›ºå®šçš„ç®—æ³•å¯»æ‰¾ä¸€å®šæ­¥é•¿çš„ä¸‹ä¸ªä½ç½®ï¼Œä¾æ¬¡åˆ¤æ–­ï¼Œç›´è‡³æ‰¾åˆ°èƒ½å¤Ÿå­˜æ”¾çš„ä½ç½®ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">nextIndex</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> len)</span> &#123;<br><span class="hljs-keyword">return</span> ((i + <span class="hljs-number">1</span> &lt; len) ? i + <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ThreadLocalå†…å­˜æ³„æ¼</strong></p><p>ä½†æ˜¯æœ‰äº›æ—¶å€™ä½¿ç”¨ThreadLocalæ˜¯ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼çš„ï¼Œè€Œä¸ºä»€ä¹ˆä¼šå‘ç”Ÿå†…å­˜æ³„æ¼å‘¢ï¼Ÿä¸‹é¢æ˜¯æˆ‘ç†è§£çš„ä¸€äº›ç­”æ¡ˆï¼š<br>å¦‚æœThreadLocalæ²¡æœ‰å¤–éƒ¨å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆåœ¨å‘ç”Ÿåƒåœ¾å›æ”¶çš„æ—¶å€™ï¼ŒThreadLocalå°±å¿…å®šä¼šè¢«å›æ”¶ï¼Œè€ŒThreadLocalåˆä½œä¸ºMapä¸­çš„keyï¼ŒThreadLocalè¢«å›æ”¶å°±ä¼šå¯¼è‡´ä¸€ä¸ªkeyä¸ºnullçš„entryï¼Œå¤–éƒ¨å°±æ— æ³•é€šè¿‡keyæ¥è®¿é—®è¿™ä¸ªentryï¼Œåƒåœ¾å›æ”¶ä¹Ÿæ— æ³•å›æ”¶ï¼Œè¿™å°±é€ æˆäº†å†…å­˜æ³„æ¼</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong><br>è§£å†³åŠæ³•æ˜¯æ¯æ¬¡ä½¿ç”¨å®ŒThreadLocaléƒ½è°ƒç”¨å®ƒçš„remove()æ–¹æ³•æ¸…é™¤æ•°æ®ï¼Œæˆ–è€…æŒ‰ç…§JDKå»ºè®®å°†ThreadLocalå˜é‡å®šä¹‰æˆprivate staticï¼Œè¿™æ ·å°±ä¸€ç›´å­˜åœ¨ThreadLocalçš„å¼ºå¼•ç”¨ï¼Œä¹Ÿå°±èƒ½ä¿è¯ä»»ä½•æ—¶å€™éƒ½èƒ½é€šè¿‡ThreadLocalçš„å¼±å¼•ç”¨è®¿é—®åˆ°Entryçš„valueå€¼ï¼Œè¿›è€Œæ¸…é™¤æ‰ã€‚</p><p><strong>ThreadLocalåœ¨å¼€å‘ä¸­çš„åº”ç”¨åœºæ™¯</strong></p><p>æ¯”å¦‚ï¼šhibernateç®¡ç†sessionï¼Œmybatisç®¡ç†sqlsessionï¼Œå…¶å†…éƒ¨éƒ½æ˜¯é‡‡ç”¨ThreadLocalæ¥å®ç°çš„ã€‚</p><p>å‰æçŸ¥è¯†ï¼šä¸ç®¡æ˜¯ä»€ä¹ˆæ¡†æ¶ï¼Œæœ€æœ¬è´¨çš„æ“ä½œéƒ½æ˜¯åŸºäºJDBCï¼Œå½“æˆ‘ä»¬éœ€è¦è·Ÿæ•°æ®åº“æ‰“äº¤é“çš„æ—¶å€™ï¼Œéƒ½éœ€è¦æœ‰ä¸€ä¸ªconnectionã€‚</p><p>é‚£ä¹ˆï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨ä¸šåŠ¡å±‚å®ç°äº‹åŠ¡æ§åˆ¶æ—¶ï¼Œè¯¥å¦‚ä½•è¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼Ÿ</p><p>æˆ‘ä»¬æ„å»ºä¸‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><span class="hljs-comment">//çœç•¥æ¥å£çš„å£°æ˜</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">UserDao</span> <span class="hljs-variable">userDao</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDao</span>();<br><span class="hljs-keyword">private</span> <span class="hljs-type">LogDao</span> <span class="hljs-variable">logDao</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogDao</span>();<br><span class="hljs-comment">//äº‹åŠ¡çš„è¾¹ç•Œæ”¾åœ¨ä¸šåŠ¡å±‚</span><br><span class="hljs-comment">//JDBCçš„å°è£…ï¼Œconnection</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span>&#123;<br>userDao.add();<br>logDao.add();<br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDao</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span>&#123;<br>System.out.println(<span class="hljs-string">&quot;UserDao addã€‚ã€‚ã€‚&quot;</span>);<br><span class="hljs-comment">//åˆ›å»ºconnectionå¯¹è±¡</span><br><span class="hljs-comment">//connection.commit();</span><br><span class="hljs-comment">//connection.rollback();</span><br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogDao</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span>&#123;<br>System.out.println(<span class="hljs-string">&quot;LogDao addã€‚ã€‚ã€‚&quot;</span>);<br><span class="hljs-comment">//åˆ›å»ºconnectionå¯¹è±¡</span><br><span class="hljs-comment">//connection.commit();</span><br><span class="hljs-comment">//connection.rollback();</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä»£ç æŒ‰ä¸Šé¢çš„æ–¹å¼æ¥ç®¡ç†connectionï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¿è¯serviceçš„äº‹åŠ¡æ§åˆ¶å—ï¼Ÿ</p><p>è¿™æ˜¯ä¸è¡Œçš„ï¼Œå‡è®¾ç¬¬ä¸€ä¸ªdaoæ“ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆå®ƒå°±æäº¤äº‹åŠ¡äº†ï¼Œè€Œç¬¬äºŒä¸ªdaoæ“ä½œå¤±è´¥äº†ï¼Œå®ƒå›æ»šäº†äº‹åŠ¡ï¼Œä½†ä¸ä¼šå½±å“åˆ°ç¬¬ä¸€ä¸ªdaoçš„äº‹åŠ¡ï¼Œå› ä¸ºä¸Šé¢è¿™ä¹ˆå†™æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„äº‹åŠ¡</p><p>é‚£ä¹ˆæ€ä¹ˆè§£å†³ã€‚</p><p>ä¸Šé¢çš„æ ¹æºå°±æ˜¯ä¸¤ä¸ªdaoæ“ä½œçš„æ˜¯ä¸åŒçš„connection</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¿è¯æ˜¯åŒä¸ªconnectionå³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//äº‹åŠ¡çš„è¾¹ç•Œæ”¾åœ¨ä¸šåŠ¡å±‚</span><br><span class="hljs-comment">//JDBCçš„å°è£…ï¼Œconnection</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Connection</span>();<br>userDao.add(connection);<br>logDao.add(connection);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹å¼ä»£ç ä¸å¤Ÿä¼˜é›…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionUtils</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;Connection&gt; threadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> threadLocal.get();<br><span class="hljs-keyword">if</span>(connection == <span class="hljs-literal">null</span>)&#123;<br>connection = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Connection</span>();<br>threadLocal.set(connection);<br>&#125;<br><span class="hljs-keyword">return</span> connection;<br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDao</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span>&#123;<br>System.out.println(<span class="hljs-string">&quot;UserDao addã€‚ã€‚ã€‚&quot;</span>);<br><span class="hljs-comment">//åˆ›å»ºconnectionå¯¹è±¡</span><br><span class="hljs-comment">//connection.commit();</span><br><span class="hljs-comment">//connection.rollback();</span><br><span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> ConnectionUtils.getConnection();<br>System.out.println(<span class="hljs-string">&quot;UserDao-&gt;&quot;</span>+connection);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¿è¯ä¸¤ä¸ªdaoæ“ä½œçš„æ˜¯åŒä¸€ä¸ªconnection</p><h1 id="å¼•ç”¨ç±»å‹æœ‰å“ªäº›"><a href="#å¼•ç”¨ç±»å‹æœ‰å“ªäº›" class="headerlink" title="å¼•ç”¨ç±»å‹æœ‰å“ªäº›"></a><strong>å¼•ç”¨ç±»å‹æœ‰å“ªäº›</strong></h1><p>å¼•ç”¨ç±»å‹ä¸»è¦åˆ†ä¸ºå¼ºè½¯å¼±è™šå››ç§ï¼š</p><ul><li>å¼ºå¼•ç”¨æŒ‡çš„å°±æ˜¯ä»£ç ä¸­æ™®éå­˜åœ¨çš„èµ‹å€¼â½…å¼ï¼Œæ¯”å¦‚A a &#x3D; new A()è¿™ç§ã€‚å¼ºå¼•â½¤å…³è”çš„å¯¹è±¡ï¼Œæ°¸è¿œä¸</li></ul><p>ä¼šè¢«GCå›æ”¶ã€‚</p><ul><li>è½¯å¼•ç”¨å¯ä»¥ç”¨SoftReferenceæ¥æè¿°ï¼ŒæŒ‡çš„æ˜¯é‚£äº›æœ‰â½¤ä½†æ˜¯ä¸æ˜¯å¿…é¡»è¦çš„å¯¹è±¡ã€‚ç³»ç»Ÿåœ¨å‘â½£å†…å­˜æº¢</li></ul><p>å‡ºå‰ä¼šå¯¹è¿™ç±»å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚</p><ul><li>å¼±å¼•ç”¨å¯ä»¥ç”¨WeakReferenceæ¥æè¿°ï¼Œä»–çš„å¼ºåº¦æ¯”è½¯å¼•â½¤æ›´ä½â¼€ç‚¹ï¼Œå¼±å¼•ç”¨çš„å¯¹è±¡ä¸‹â¼€æ¬¡GCçš„æ—¶</li></ul><p>å€™â¼€å®šä¼šè¢«å›æ”¶ï¼Œè€Œä¸ç®¡å†…å­˜æ˜¯å¦è¶³å¤Ÿã€‚</p><ul><li>è™šå¼•ç”¨ä¹Ÿè¢«ç§°ä½œå¹»å½±å¼•ç”¨ï¼Œå®ƒæ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ã€‚ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„ å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥å–å¾—ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™š å¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„åªæ˜¯ä¸ºäº†èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚åœ¨JDK 1.2ç‰ˆä¹‹åæä¾› äº†PhantomReferenceç±»æ¥å®ç°è™šå¼•ç”¨ã€‚</li></ul><h1 id="çº¿ç¨‹æ± çš„ä¸‰å¤§æ–¹æ³•ã€ä¸ƒå¤§å‚æ•°å’Œå››ç§æ‹’ç»ç­–ç•¥"><a href="#çº¿ç¨‹æ± çš„ä¸‰å¤§æ–¹æ³•ã€ä¸ƒå¤§å‚æ•°å’Œå››ç§æ‹’ç»ç­–ç•¥" class="headerlink" title="çº¿ç¨‹æ± çš„ä¸‰å¤§æ–¹æ³•ã€ä¸ƒå¤§å‚æ•°å’Œå››ç§æ‹’ç»ç­–ç•¥"></a>çº¿ç¨‹æ± çš„ä¸‰å¤§æ–¹æ³•ã€ä¸ƒå¤§å‚æ•°å’Œå››ç§æ‹’ç»ç­–ç•¥</h1><p>è¿™ä¸ªé¢è¯•ä¹Ÿæ˜¯å¿…é—®çš„ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å·²ç»è¯¦ç»†è®²åˆ°äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°</p><p><a href="https://luffy997.github.io/2021/01/26/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89/">JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—(ä¸‰)</a></p><h1 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h1><h1 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h1><h1 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h1><p>ä¸Šé¢è¿™ä¸‰ä¸ªå¸¸ç”¨è¾…åŠ©ç±»æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« ä¹Ÿè®²è¿‡</p><p><a href="https://luffy997.github.io/2021/01/25/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89/#8-1-CountDownLatch">JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—(äºŒ)</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysqlå¿…çŸ¥å¿…ä¼š</title>
    <link href="/2021/03/18/Mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/"/>
    <url>/2021/03/18/Mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p><strong>MySQL</strong> æ˜¯æœ€æµè¡Œçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œåœ¨ WEB åº”ç”¨æ–¹é¢ MySQL æ˜¯æœ€å¥½çš„ RDBMS(Relational Database Management Systemï¼šå…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ)åº”ç”¨è½¯ä»¶ä¹‹ä¸€ã€‚</p><p><strong>mysqlæ¶æ„å›¾</strong></p><p><img src="https://i.loli.net/2021/03/18/QKW4emFJLshMDxV.png"></p><h1 id="myisamå’Œinnodb"><a href="#myisamå’Œinnodb" class="headerlink" title="myisamå’Œinnodb"></a>myisamå’Œinnodb</h1><p><strong>myisam</strong>å¼•æ“æ˜¯5.1ç‰ˆæœ¬ä¹‹å‰çš„é»˜è®¤å¼•æ“ï¼Œæœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li><p>ä¸æ”¯æŒäº‹åŠ¡</p></li><li><p>åªæ”¯æŒè¡¨çº§é”å®š â€”&gt;æ•°æ®æ›´æ–°æ—¶é”å®šæ•´ä¸ªè¡¨ï¼Œå°±è¯´è¯´å¯¹ä¸€ä¸ªæ•°æ®è¿›è¡Œæ“ä½œå°±ä¼šé”å®šæ•´ä¸ªè¡¨ï¼Œå…¶ä»–äººä¸èƒ½åŒæ—¶æ“ä½œè¿™ä¸ªè¡¨ï¼Œå®ç°å®¹æ˜“ä½†å¹¶å‘æ•ˆç‡ä½ã€‚</p></li><li><p>åªä¼šç¼“å­˜ç´¢å¼• â€”&gt; myisamå¯ä»¥é€šè¿‡key_buffer_sizeçš„å€¼æ¥æé«˜ç¼“å­˜ç´¢å¼•ï¼Œä»¥å¤§å¤§æé«˜è®¿é—®æ€§èƒ½å‡å°‘ç£ç›˜IOï¼Œä½†æ˜¯è¿™ä¸ªç¼“å­˜åŒºåªä¼šç¼“å­˜ç´¢å¼•ï¼Œè€Œä¸ä¼šç¼“å­˜æ•°æ®ã€‚</p></li><li><p>è¯»å–é€Ÿåº¦è¾ƒå¿«ï¼Œå ç”¨èµ„æºè¾ƒå°‘</p></li><li><p>ä¸æ”¯æŒå¤–é”®çº¦æŸï¼Œä½†åªæ˜¯å…¨æ–‡ç´¢å¼•</p></li><li><p>å¯¹äºcount(*)æŸ¥è¯¢æ¥è¯´MyISAMæ›´æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºå…¶ä¿å­˜äº†è¡Œæ•°</p><p>â€‹</p></li></ul><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p><p>1.ä¸éœ€è¦æ”¯æŒäº‹åŠ¡çš„ä¸šåŠ¡</p><p>2.è¯»æ•°æ®æ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œè¯»å†™éƒ½é¢‘ç¹çš„åœºæ™¯ä¸é€‚åº”ï¼ˆè¡¨çº§é”å®šï¼‰</p><p>3.ç‹¬å†™å¹¶å‘è®¿é—®è¾ƒä½çš„ä¸šåŠ¡</p><p><strong>innodb</strong></p><ul><li>æ”¯æŒäº‹åŠ¡ï¼Œæ”¯æŒ4ä¸ªäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œæ”¯æŒå¤šç‰ˆæœ¬è¯»</li><li>é»˜è®¤è¡Œçº§é”ï¼ˆæ›´æ–°æ—¶ä¸€èˆ¬æ˜¯é”å®šå½“å‰è¡Œï¼‰ï¼Œä¹Ÿæ”¯æŒè¡¨çº§é”ã€‚é€šè¿‡ç´¢å¼•å®ç°ï¼Œå…¨è¡¨æ‰«æä»ç„¶ä¼šæ˜¯è¡¨é”ï¼Œéœ€æ³¨æ„é—´éš™é”çš„å½±å“</li><li>å…·æœ‰éå¸¸é«˜çš„ç¼“å­˜ç‰¹æ€§ï¼šç¼“å­˜ç´¢å¼•å’Œæ•°æ®</li><li>ä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œæ”¯æŒå¤–é”®çº¦æŸ</li><li>é€šè¿‡MVCCæ”¯æŒé«˜å¹¶å‘</li><li>åŸºäºèšç°‡ç´¢å¼•åˆ›å»º</li></ul><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p><ol><li>éœ€è¦äº‹åŠ¡æ”¯æŒ</li><li>è¡Œçº§é”å¯¹é«˜å¹¶å‘æœ‰å¾ˆå¥½çš„é€‚åº”èƒ½åŠ›ï¼Œä½†éœ€è¦ç¡®ä¿æŸ¥è¯¢æ˜¯é€šè¿‡ç´¢å¼•å®Œæˆçš„</li><li>æ•°æ®æ›´æ–°è¾ƒé¢‘ç¹çš„åœºæ™¯</li><li>æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜</li><li>ç¡¬ä»¶å†…å­˜è¾ƒå¤§ï¼Œå¯ä»¥æä¾›å¾ˆå¥½çš„ç¼“å­˜æ•ˆæœ</li></ol><h1 id="mysqlçš„ç´¢å¼•æœ‰å“ªäº›ï¼Ÿèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#mysqlçš„ç´¢å¼•æœ‰å“ªäº›ï¼Ÿèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="mysqlçš„ç´¢å¼•æœ‰å“ªäº›ï¼Ÿèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ"></a>mysqlçš„ç´¢å¼•æœ‰å“ªäº›ï¼Ÿèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>ç´¢å¼•æŒ‰æ•°æ®ç»“æ„æ¥åˆ†ä¸»è¦åŒ…å«ï¼š<strong>B+æ ‘å’ŒHashç´¢å¼•</strong></p><p>è¿™é‡Œå°±ä¸å¾—ä¸æä¸‹ï¼Œä¸ºä»€ä¹ˆMysqlé»˜è®¤ç´¢å¼•æ˜¯B+æ ‘ï¼Œä¸æ˜¯Bæ ‘ï¼Ÿ</p><ol><li>B+æ ‘æ˜¯Bæ ‘çš„å˜ç§ï¼ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹åªç”¨æ¥ä¿å­˜ç´¢å¼•ï¼Œä¸å­˜å‚¨æ•°æ®ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½ä¿å­˜åœ¨å¶å­èŠ‚ç‚¹ï¼›è€ŒBæ ‘çš„éå¶å­èŠ‚ç‚¹ä¹Ÿä¼šä¿å­˜æ•°æ®ã€‚è¿™æ ·å°±ä½¿å¾—B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®šï¼Œå‡ä¸ºä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚</li><li>B+æ ‘çš„å†…éƒ¨èŠ‚ç‚¹å¹¶æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆï¼Œå› æ­¤å…¶å†…éƒ¨èŠ‚ç‚¹ç›¸æ¯”Bæ ‘æ›´å°ï¼ŒåŒæ ·ç©ºé—´å¯ä»¥è¯»å…¥æ›´å¤šçš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½ã€‚</li></ol><p>åœ¨Mysqlæ–‡æ¡£é‡Œï¼Œå®é™…ä¸ŠB+æ ‘ç´¢å¼•å†™æˆäº†BTREE</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> t(<br>aid <span class="hljs-type">int</span> unsigned <span class="hljs-keyword">not null</span> auto\_increment,<br>userid <span class="hljs-type">int</span> unsigned <span class="hljs-keyword">not null</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>,<br>username <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not null</span> <span class="hljs-keyword">default</span> â€˜â€™,<br>detail <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">not null</span> <span class="hljs-keyword">default</span> â€˜â€™,<br><span class="hljs-keyword">primary key</span>(aid),<br><span class="hljs-keyword">unique</span> key(uid) <span class="hljs-keyword">USING</span> BTREE,<br>key (username(<span class="hljs-number">12</span>)) <span class="hljs-keyword">USING</span> BTREE â€” æ­¤å¤„ uname åˆ—åªåˆ›å»ºäº†æœ€å·¦<span class="hljs-number">12</span>ä¸ªå­—ç¬¦é•¿åº¦çš„éƒ¨åˆ†ç´¢å¼•<br>)engine<span class="hljs-operator">=</span>InnoDB;<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/03/18/M4rAIHGJvQW1tX8.jpg"></p><p>B+æ ‘æ˜¯å·¦å°å³å¤§çš„é¡ºåºå­˜å‚¨ç»“æ„ï¼ŒèŠ‚ç‚¹åªåŒ…å«idç´¢å¼•åˆ—ï¼Œè€Œå¶å­èŠ‚ç‚¹åŒ…å«ç´¢å¼•åˆ—å’Œæ•°æ®ï¼Œè¿™ç§<strong>æ•°æ®å’Œç´¢å¼•åœ¨ä¸€èµ·</strong>å­˜å‚¨çš„ç´¢å¼•æ–¹å¼å«åšèšç°‡ç´¢å¼•ã€‚éèšç°‡ç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰æ˜¯åœ¨B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸Šå­˜å‚¨çš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯æ•°æ®æœ¬èº«ï¼Œä¿å­˜çš„æ˜¯<strong>ä¸»é”®idå€¼</strong>ï¼Œè¿™â¼€ç‚¹å’Œmyisamä¿å­˜çš„æ˜¯æ•°æ®åœ°å€æ˜¯ä¸åŒçš„ã€‚ã€‚å¹¶ä¸”èšç°‡ç´¢å¼•çš„æ•°æ®çš„ç‰©ç†å­˜æ”¾é¡ºåºä¸ç´¢å¼•é¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œå³åªè¦ç´¢å¼•æ˜¯ç›¸é‚»çš„ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ•°æ®ä¸€å®šä¹Ÿæ˜¯ç›¸é‚»çš„ã€‚èšç°‡ç´¢å¼•è¦æ¯”éèšç°‡ç´¢å¼•æŸ¥è¯¢æ•ˆç‡é«˜å¾ˆå¤šã€‚</p><p><img src="https://i.loli.net/2021/03/18/zyEWSuB5fNMjvRV.jpg"></p><p>ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œå› ä¸ºç‰©ç†åœ°å€æ˜¯å”¯ä¸€ç¡®å®šçš„ã€‚å‡è®¾æ²¡æœ‰å®šä¹‰ä¸»é”®ï¼ŒInnoDbä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€çš„éç©ºç´¢å¼•ä»£æ›¿ï¼Œå¦‚æœæ²¡æœ‰çš„è¯åˆ™ä¼šéšå¼å®šä¹‰ä¸€ä¸ªä¸»é”®ä½œä¸ºèšç°‡ç´¢å¼•ã€‚</p><p><strong>Hashç´¢å¼•</strong></p><p><img src="https://i.loli.net/2021/03/18/qsIXucABdtEFGg8.jpg"></p><p>ç®€å•çš„è¯´ï¼ŒHashç´¢å¼•å°±è¯´é‡‡ç”¨ä¸€å®šçš„Hashç®—æ³•ï¼ŒæŠŠé”®å€¼å¯¹æ¢ç®—æˆæ–°çš„Hashå€¼ï¼Œæ£€ç´¢æ—¶ä¸éœ€è¦ç±»ä¼¼B+æ ‘é‚£æ ·ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹é€çº§æŸ¥æ‰¾ï¼Œåªéœ€ä¸€æ¬¡å“ˆå¸Œç®—æ³•å³å¯ç«‹åˆ»å®šä½åˆ°ç›¸åº”çš„ä½ç½®ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚</p><p>B+æ ‘ç´¢å¼•å’Œå“ˆå¸Œç´¢å¼•çš„æ˜æ˜¾åŒºåˆ«æ˜¯ï¼š</p><ul><li><p><strong>å¦‚æœæ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œé‚£ä¹ˆå“ˆå¸Œç´¢å¼•æ˜æ˜¾æœ‰ç»å¯¹ä¼˜åŠ¿</strong>ï¼Œå› ä¸ºåªéœ€è¦ç»è¿‡ä¸€æ¬¡ç®—æ³•å³å¯æ‰¾åˆ°ç›¸åº”çš„é”®å€¼ï¼›å½“ç„¶äº†ï¼Œè¿™ä¸ªå‰ææ˜¯ï¼Œé”®å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚å¦‚æœé”®å€¼ä¸æ˜¯å”¯ä¸€çš„ï¼Œå°±éœ€è¦å…ˆæ‰¾åˆ°è¯¥é”®æ‰€åœ¨ä½ç½®ï¼Œç„¶åå†æ ¹æ®é“¾è¡¨å¾€åæ‰«æï¼Œç›´åˆ°æ‰¾åˆ°ç›¸åº”çš„æ•°æ®ï¼›</p></li><li><p>ä»ç¤ºæ„å›¾ä¸­ä¹Ÿèƒ½çœ‹åˆ°ï¼Œ<strong>å¦‚æœæ˜¯èŒƒå›´æŸ¥è¯¢æ£€ç´¢ï¼Œè¿™æ—¶å€™å“ˆå¸Œç´¢å¼•å°±æ¯«æ— ç”¨æ­¦ä¹‹åœ°äº†</strong>ï¼Œå› ä¸ºåŸå…ˆæ˜¯æœ‰åºçš„é”®å€¼ï¼Œç»è¿‡å“ˆå¸Œç®—æ³•åï¼Œæœ‰å¯èƒ½å˜æˆä¸è¿ç»­çš„äº†ï¼Œå°±æ²¡åŠæ³•å†åˆ©ç”¨ç´¢å¼•å®ŒæˆèŒƒå›´æŸ¥è¯¢æ£€ç´¢ï¼›</p></li><li><p>åŒç†ï¼Œ<strong>å“ˆå¸Œç´¢å¼•ä¹Ÿæ²¡åŠæ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åº</strong>ï¼Œä»¥åŠlike â€˜xxx%â€™ è¿™æ ·çš„éƒ¨åˆ†æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆè¿™ç§éƒ¨åˆ†æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå…¶å®æœ¬è´¨ä¸Šä¹Ÿæ˜¯èŒƒå›´æŸ¥è¯¢ï¼‰ï¼›</p></li><li><p><strong>å“ˆå¸Œç´¢å¼•ä¹Ÿä¸æ”¯æŒå¤šåˆ—è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…è§„åˆ™</strong>ï¼›</p></li><li><p>B+æ ‘ç´¢å¼•çš„å…³é”®å­—æ£€ç´¢æ•ˆç‡æ¯”è¾ƒå¹³å‡ï¼Œä¸åƒBæ ‘é‚£æ ·æ³¢åŠ¨å¹…åº¦å¤§ï¼Œ<strong>åœ¨æœ‰å¤§é‡é‡å¤é”®å€¼æƒ…å†µä¸‹ï¼Œå“ˆå¸Œç´¢å¼•çš„æ•ˆç‡ä¹Ÿæ˜¯æä½çš„ï¼Œå› ä¸ºå­˜åœ¨çš„å“ˆå¸Œç¢°æ’é—®é¢˜</strong>ã€‚</p><p>â€‹</p></li></ul><h1 id="è¦†ç›–ç´¢å¼•å’Œå›è¡¨"><a href="#è¦†ç›–ç´¢å¼•å’Œå›è¡¨" class="headerlink" title="è¦†ç›–ç´¢å¼•å’Œå›è¡¨"></a>è¦†ç›–ç´¢å¼•å’Œå›è¡¨</h1><p>è¦†ç›–ç´¢å¼•æ˜¯å¸¸è§çš„SQLä¼˜åŒ–ç­–ç•¥ï¼ŒæŒ‡åœ¨ä¸€æ¬¡æŸ¥è¯¢ä¸­ï¼Œå¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«æˆ–è€…è¯´è¦†ç›–æ‰€æœ‰æŸ¥è¯¢çš„å­—æ®µå€¼ï¼Œæˆ‘ä»¬å°±ç§°ä¸ºè¦†ç›–ç´¢å¼•ï¼Œè€Œä¸éœ€è¦å›è¡¨æŸ¥è¯¢ã€‚</p><p>å›è¡¨æ˜¯å¦‚ä½•æ‰§è¡Œçš„å‘¢ï¼Ÿ</p><p><img src="https://i.loli.net/2021/03/18/nQecETFYpGKfyti.jpg"></p><p>å¦‚ç²‰çº¢è‰²è·¯å¾„ï¼Œéœ€è¦æ‰«æä¸¤éç´¢å¼•æ ‘ï¼š</p><ol><li>å…ˆé€šè¿‡æ™®é€šç´¢å¼•å®šä½åˆ°id&#x3D;5ï¼›</li><li>å†é€šè¿‡èšé›†ç´¢å¼•å®šä½åˆ°è¡Œè®°å½•ï¼›</li></ol><p>è¿™å°±æ˜¯æ‰€è°“çš„å›è¡¨æŸ¥è¯¢ï¼Œå…ˆå®šä½ä¸»é”®å€¼ï¼Œå†å®šä½è¡Œè®°å½•ï¼Œå®ƒçš„æ€§èƒ½è¾ƒæ‰«æä¸€éç´¢å¼•æ ‘æ…¢ã€‚</p><p>ç¡®å®šâ¼€ä¸ªæŸ¥è¯¢æ˜¯å¦æ˜¯è¦†ç›–ç´¢å¼•ï¼Œæˆ‘ä»¬åªéœ€è¦explain sqlè¯­å¥çœ‹Extraçš„ç»“æœæ˜¯å¦æ˜¯â€œUsing indexâ€å³å¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> \<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> age<span class="hljs-operator">=</span><span class="hljs-number">1</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span>æŸ¥è¯¢çš„nameâ½†æ³•ä»ç´¢å¼•æ•°æ®è·å–<br>explain <span class="hljs-keyword">select</span> id,age <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> age<span class="hljs-operator">=</span><span class="hljs-number">1</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span>å¯ä»¥ç›´æ¥ä»ç´¢å¼•è·å–<br></code></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/heyanan/p/13570033.html">mysqlè¦†ç›–ç´¢å¼•ä¸å›è¡¨</a></p><h1 id="é”çš„ç±»å‹"><a href="#é”çš„ç±»å‹" class="headerlink" title="é”çš„ç±»å‹"></a>é”çš„ç±»å‹</h1><p>mysqlé”åˆ†ä¸ºå…±äº«é”å’Œæ’ä»–é”ï¼Œä¹Ÿå«è¯»é”å’Œå†™é”ã€‚</p><p>è¯»é”æ˜¯å…±äº«çš„ï¼Œå¯ä»¥é€šè¿‡lock in share mode å®ç°ï¼Œè¿™æ—¶å€™åªèƒ½è¯»ä¸èƒ½å†™ã€‚</p><p>å†™é”æ˜¯æ’ä»–çš„ï¼Œå®ƒä¼šé˜»å¡å…¶ä»–çš„å†™é”å’Œè¯»é”ã€‚ä»é¢—ç²’åº¦æ¥åŒºåˆ†ï¼Œå¯ä»¥åˆ†ä¸ºè¡¨é”å’Œè¡Œé”ä¸¤ç§ã€‚</p><p>è¡¨é”ä¼šé”å®šæ•´å¼ è¡¨å¹¶ä¸”é˜»å¡å…¶ä»–ç”¨æˆ·å¯¹è¯¥è¡¨çš„æ‰€æœ‰è¯»å†™æ“ä½œï¼Œæ¯”å¦‚alterä¿®æ”¹è¡¨ç»“æ„çš„æ—¶å€™å°±ä¼šé”è¡¨ã€‚</p><p>è¡Œé”åˆå¯åˆ†ä¸ºä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œæ‚²è§‚é”å¯ä»¥é€šè¿‡for updateå®ç°ï¼Œä¹è§‚é”é€šè¿‡ç‰ˆæœ¬å·å®ç°ã€‚</p><h1 id="äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«"></a>äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«</h1><p>mysqlå¿…é—®äº‹åŠ¡çš„ï¼</p><p><strong>äº‹åŠ¡åŸºæœ¬ç‰¹æ€§ACIDï¼š</strong></p><ul><li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡ä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼›</li><li>ä¸€è‡´æ€§ï¼ˆConsistrncyï¼‰ï¼šä¿è¯æ•°æ®åº“çŠ¶æ€ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚æ¯”å¦‚Aè½¬è´¦ç»™B100å—ï¼Œå‡è®¾è½¬æˆåŠŸï¼Œé‚£ä¹ˆAå’ŒBåœ¨æ²¡è¿›è¡Œè½¬è´¦ä¹‹å‰çš„é‡‘é¢ä¹‹å’Œæ˜¯ç­‰äºè½¬è´¦æˆåŠŸç°åœ¨çš„Aå’ŒBçš„é‡‘é¢ä¹‹å’Œã€‚å‡å¦‚ä¸­é—´sqlæ‰§è¡Œè¿‡ç¨‹ä¸­ç³»ç»Ÿå´©æºƒAä¹Ÿä¸ä¼šæŸå¤±100å—ï¼Œå› ä¸ºäº‹åŠ¡æ²¡æœ‰æäº¤ï¼Œä¿®æ”¹ä¹Ÿä¸ä¼šä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</li><li>éš”ç¦»æ€§ï¼ˆISolationï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡çš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤å‰ï¼Œå¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚</li><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå¯¹æ•°æ®åº“çš„ä¿®æ”¹æ˜¯æ°¸ä¹…ä¿å­˜çš„ã€‚</li></ul><p><strong>å››ä¸ªéš”ç¦»çº§åˆ«ï¼š</strong></p><ul><li><p>read uncommit è¯»æœªæäº¤ï¼Œå¯èƒ½è¯»åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼Œä¹Ÿå«è„è¯»ï¼Œä¸¾ä¸ªæ —å­ï¼šç”¨æˆ·Aå¼€å¯äº‹åŠ¡ï¼Œä¿®æ”¹è‡ªå·±çš„åŸæ¥çš„age &#x3D; 10ä¸ºage &#x3D; 20ï¼Œä½†è¿˜æœªæäº¤ï¼Œç”¨æˆ·Bå¼€å¯äº‹åŠ¡è¯»å–ç”¨æˆ·Açš„ageï¼Œä¼šå‘ç°è¯»å–çš„age &#x3D; 20ï¼Œä½†ç”¨æˆ·Açš„äº‹åŠ¡æ²¡æäº¤ï¼Œç”¨æˆ·Bå»è¯»å–ç”¨æˆ·Açš„ageåº”è¯¥æ˜¯10ï¼Œè¿™å°±æ˜¯è„è¯»ã€‚</p></li><li><p>read commit è¯»å·²æäº¤ï¼Œä¸¤æ¬¡è¯»å–ç»“æœä¸ä¸€è‡´ï¼Œå«åšä¸å¯é‡å¤è¯»ã€‚ä¸å¯é‡å¤è¯»è§£å†³äº†è„è¯»çš„é—®é¢˜ï¼Œä½†åˆå‡ºç°ä¸ªé—®é¢˜å®ƒåªä¼šè¯»å–å·²æäº¤çš„äº‹åŠ¡ã€‚ä¸¾ä¸ªæ —å­ï¼Œç”¨æˆ·Båœ¨ç”¨æˆ·Aå°šæœªå¼€å¯äº‹åŠ¡çš„æ—¶å€™å»è¯»å–age &#x3D; 10ï¼Œä½†å†æ¬¡è¯»å–çš„æ—¶å€™Aå·²ç»å¼€å¯å¹¶æäº¤äº‹åŠ¡ï¼ŒBå†æ¬¡è¯»å–Açš„æ—¶å€™age &#x3D; 20ï¼Œè¿™å°±é€ æˆå‰åè¯»çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p></li><li><p>repeatable read å¯é‡å¤åº¦ï¼Œè¿™æ˜¯mysqlçš„é»˜è®¤çº§åˆ«ï¼Œå°±æ˜¯æ¯æ¬¡è¯»å–ç»“æœéƒ½â¼€æ ·ï¼Œä½†æ˜¯æœ‰å¯èƒ½äº§â½£å¹»è¯»ã€‚</p></li><li><p>serializable ä¸²è¡Œï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼Œå®ƒä¼šç»™æ¯ä¸€è¡Œè¯»å–çš„æ•°æ®åŠ é”ï¼Œä¼šå¯¼è‡´å¤§é‡è¶…æ—¶å’Œé”ç«äº‰é—®é¢˜ã€‚</p><p>â€‹</p></li></ul><h1 id="ä¸åšæ§åˆ¶ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘æ“ä½œæ•°æ®åº“ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜"><a href="#ä¸åšæ§åˆ¶ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘æ“ä½œæ•°æ®åº“ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜" class="headerlink" title="ä¸åšæ§åˆ¶ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘æ“ä½œæ•°æ®åº“ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜?"></a>ä¸åšæ§åˆ¶ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘æ“ä½œæ•°æ®åº“ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜?</h1><ul><li><strong>ä¸¢å¤±æ›´æ–°</strong> ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶è·å¾—ç›¸åŒçš„æ•°æ®ï¼Œç„¶ååœ¨å„è‡ªäº‹åŠ¡ä¸­åŒæ—¶ä¿®æ”¹äº†æ•°æ®ï¼Œè°å…ˆæäº¤äº‹åŠ¡ï¼Œè°çš„æ•°æ®å°±ä¼šè¢«åé¢æäº¤äº‹åŠ¡çš„æ•°æ®æ‰€è¦†ç›–ï¼Œå…ˆæäº¤çš„äº‹åŠ¡è¢«åæäº¤çš„æ‰€è¦†ç›–ï¼Œå¯¼è‡´æ•°æ®æ›´æ–°å¤±è´¥ã€‚</li><li><strong>è„è¯»</strong> äº‹åŠ¡Aè¯»å–äº†äº‹åŠ¡Bæœªæäº¤çš„æ•°æ®ï¼Œç”±äºäº‹åŠ¡Bå›æ»šï¼Œå¯¼è‡´äº‹åŠ¡Aè¯»å–äº†äº‹åŠ¡Bæœªæäº¤çš„æ•°æ®ï¼Œå‡ºç°è„è¯»ã€‚</li><li><strong>ä¸å¯é‡å¤è¯»</strong> ä¸€ä¸ªäº‹åŠ¡åœ¨è‡ªå·±æ²¡æ›´æ–°æ•°æ®åº“çš„æƒ…å†µï¼ŒåŒä¸€ä¸ªæŸ¥è¯¢æ“ä½œæ‰§è¡Œä¸¤æ¬¡æˆ–å¤šæ¬¡ç»“æœæ•°å€¼ä¸ä¸€æ ·ï¼Œå› ä¸ºæœ‰åˆ«çš„äº‹åŠ¡æ›´æ–°äº†è¯¥æ•°æ®ï¼Œå¹¶ä¸”æäº¤äº†äº‹åŠ¡ã€‚</li><li><strong>å¹»è¯»</strong> äº‹åŠ¡Aè¯»çš„æ—¶å€™è¯»å‡ºäº†Næ¡è®°å½•ï¼Œäº‹åŠ¡Båœ¨äº‹åŠ¡Aæ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¢åŠ äº†1æ¡ï¼Œäº‹åŠ¡Aå†è¯»çš„æ—¶å€™å°±å˜æˆäº†N+1æ¡ï¼Œè¿™ç§æƒ…å†µå°±å«åšå¹»è¯»ã€‚</li></ul><p>æ³¨æ„ï¼šå¹»è¯»æ˜¯ä¸€ç§ç»“æ„ä¸Šçš„æ”¹å˜ï¼Œæ¯”å¦‚æ•°æ®æ¡æ•°çš„æ”¹å˜ï¼›ä¸å¯é‡å¤è¯»æ˜¯è¯»å‡ºçš„æ•°å€¼å‘ç”Ÿäº†æ”¹å˜ã€‚</p><h1 id="ACIDé ä»€ä¹ˆä¿è¯ï¼Ÿ"><a href="#ACIDé ä»€ä¹ˆä¿è¯ï¼Ÿ" class="headerlink" title="ACIDé ä»€ä¹ˆä¿è¯ï¼Ÿ"></a>ACIDé ä»€ä¹ˆä¿è¯ï¼Ÿ</h1><p>AåŸå­æ€§ç”±undo logæ—¥å¿—ä¿è¯ï¼Œå®ƒè®°å½•äº†éœ€è¦å›æ»šçš„æ—¥å¿—ä¿¡æ¯ï¼Œäº‹åŠ¡å›æ»šæ’¤é”€å·²ç»æ‰§è¡ŒæˆåŠŸçš„SQL</p><p>Cä¸€è‡´æ€§ä¸€èˆ¬ç”±ä»£ç å±‚é¢æ¥ä¿è¯</p><p>Iéš”ç¦»æ€§ç”±MVCCæ¥ä¿è¯</p><p>DæŒä¹…æ€§ç”±å†…å­˜+redo log(é‡åšæ—¥å¿—)æ¥ä¿è¯ï¼Œmysqlä¿®æ”¹æ•°æ®åŒæ—¶åœ¨å†…å­˜å’Œredo logè®°å½•è¿™æ¬¡æ“ä½œï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™é€šè¿‡redo logåˆ·ç›˜ï¼Œå®•æœºçš„æ—¶å€™å¯ä»¥ä»redo logæ¢å¤ï¼Œè¿™ä¸ªèƒ½åŠ›ç§°ä¸ºcrash-safeã€‚</p><h1 id="MVCCçš„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#MVCCçš„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="MVCCçš„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>MVCCçš„æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>MVCCå«åšå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œå®é™…ä¸Šå°±æ˜¯ä¿å­˜äº†æ•°æ®åœ¨æŸä¸ªæ—¶é—´èŠ‚ç‚¹çš„å¿«ç…§ã€‚</p><p>æˆ‘ä»¬æ¯è¡Œæ•°æ®å®é™…ä¸Šéšè—äº†ä¸¤åˆ—ï¼Œåˆ›å»ºæ—¶é—´ç‰ˆæœ¬å·ï¼Œè¿‡æœŸï¼ˆåˆ é™¤ï¼‰æ—¶é—´ç‰ˆæœ¬ï¼Œæ¯å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œç‰ˆæœ¬å·éƒ½ä¼šè‡ªåŠ¨é€’å¢ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªuserè¡¨ï¼Œå­—æ®µä¸ºidï¼Œnameï¼Œå‡å¦‚æˆ‘ä»¬æ’å…¥ä¸¤æ¡æ•°æ®ï¼Œå®ƒå®é™…ä¸Šé•¿è¿™æ ·</p><table><thead><tr><th>id</th><th>name</th><th>create_version</th><th>delete_version</th></tr></thead><tbody><tr><td>1</td><td>å¼ ä¸‰</td><td>1</td><td></td></tr><tr><td>2</td><td>æå››</td><td>2</td><td></td></tr></tbody></table><p>å‡è®¾è¿™æ—¶å€™å°æ˜å»æ‰§è¡ŒæŸ¥è¯¢ï¼Œæ­¤æ—¶current_vision&#x3D;3</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> \<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">&lt;=</span><span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œå°çº¢åœ¨è¿™ä¸ªæ—¶å€™å¼€å¯äº‹åŠ¡å»ä¿®æ”¹id&#x3D;1çš„è®°å½•ï¼Œcurrent_vision&#x3D;4</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;å¼ ä¸‰ä¸‰&#x27;</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸåçš„ç»“æœæ˜¯è¿™æ ·çš„</p><table><thead><tr><th>id</th><th>name</th><th>create_vison</th><th>delete_versin</th></tr></thead><tbody><tr><td>1</td><td>å¼ ä¸‰</td><td>1</td><td></td></tr><tr><td>2</td><td>æå››</td><td>2</td><td></td></tr><tr><td>1</td><td>å¼ ä¸‰ä¸‰</td><td>4</td><td></td></tr></tbody></table><p>å¦‚æœè¿™æ—¶å€™è¿˜æœ‰å°é»‘åœ¨åˆ é™¤id&#x3D;2çš„æ•°æ®ï¼Œcurrent_version&#x3D;5,æ‰§è¡Œåç»“æœæ˜¯è¿™æ ·çš„ã€‚</p><table><thead><tr><th>id</th><th>name</th><th>create_vison</th><th>delete_version</th></tr></thead><tbody><tr><td>1</td><td>å¼ ä¸‰</td><td>1</td><td></td></tr><tr><td>2</td><td>æå››</td><td>2</td><td>5</td></tr><tr><td>1</td><td>å¼ ä¸‰ä¸‰</td><td>4</td><td></td></tr></tbody></table><p>ç”±äºMVCCçš„<strong>åŸç†æ˜¯æŸ¥æ‰¾åˆ›å»ºç‰ˆæœ¬å°äºæˆ–ç­‰äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬ï¼Œåˆ é™¤ç‰ˆæœ¬ä¸ºç©ºæˆ–è€…å¤§äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬</strong>ï¼Œå°æ˜çœŸå®çš„æŸ¥è¯¢åº”è¯¥æ˜¯è¿™æ ·çš„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> \<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">&lt;=</span><span class="hljs-number">3</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">create</span>\_version<span class="hljs-operator">&lt;=</span><span class="hljs-number">3</span> <span class="hljs-keyword">and</span>(<span class="hljs-keyword">delete</span>\_version <span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">delete</span>\_version <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>);<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å°æ˜æœ€åæŸ¥è¯¢åˆ°çš„id&#x3D;1çš„åå­—è¿˜æ˜¯â€˜å¼ ä¸‰â€™ï¼Œå¹¶ä¸”id&#x3D;2ä¹Ÿèƒ½æŸ¥è¯¢åˆ°ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†<strong>ä¿è¯äº‹åŠ¡è¯»å–çš„æ•°æ®æ˜¯åœ¨äº‹åŠ¡ä¹‹å‰å°±å·²ç»å­˜åœ¨çš„ï¼Œè¦ä¹ˆæ˜¯äº‹åŠ¡è‡ªå·±æ’å…¥æˆ–è€…ä¿®æ”¹çš„ã€‚</strong></p><p>æ˜ç™½MVCCåŸç†ï¼Œæˆ‘ä»¬æ¥è¯´ä»€ä¹ˆæ˜¯å¹»è¯»å°±ç®€å•å¤šäº†ã€‚ä¸¾ä¸€ä¸ªå¸¸è§çš„åœºæ™¯ï¼Œç”¨æˆ·åœ¨æ³¨å†Œæ—¶ï¼Œæˆ‘ä»¬å…ˆæŸ¥è¯¢ç”¨æˆ·åæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±æ’å…¥ï¼Œå‡è®¾ç”¨æˆ·åæ˜¯å”¯ä¸€ç´¢å¼•ã€‚</p><ol><li><p>å°æ˜å¼€å¯äº‹åŠ¡current_version&#x3D;6æŸ¥è¯¢åå­—ä¸ºâ€™ç‹äº”â€˜çš„è®°å½•ï¼Œå‘ç°ä¸å­˜åœ¨ã€‚</p></li><li><p>å°çº¢å¼€å¯äº‹åŠ¡current_version&#x3D;7æ’å…¥ä¸€æ¡æ•°æ®ï¼Œç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><p>â€‹</p></li></ol><table><thead><tr><th>id</th><th>name</th><th>create_version</th><th>delete_version</th></tr></thead><tbody><tr><td>1</td><td>å¼ ä¸‰</td><td>1</td><td></td></tr><tr><td>2</td><td>æå››</td><td>2</td><td></td></tr><tr><td>3</td><td>ç‹äº”</td><td>7</td><td></td></tr></tbody></table><ol><li>å°æ˜æ‰§è¡Œæ’å…¥åå­—â€™ç‹äº”â€˜çš„è®°å½•ï¼Œå‘ç°å”¯ä¸€ç´¢å¼•å†²çªï¼Œæ— æ³•æ’å…¥ï¼Œè¿™å°±æ˜¯<strong>å¹»è¯»</strong>ã€‚</li></ol><h1 id="Mysqlçš„æ—¥å¿—æ¨¡å—redo-logå’Œbinlogæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Mysqlçš„æ—¥å¿—æ¨¡å—redo-logå’Œbinlogæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Mysqlçš„æ—¥å¿—æ¨¡å—redo logå’Œbinlogæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Mysqlçš„æ—¥å¿—æ¨¡å—redo logå’Œbinlogæ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>åœ¨MySQLçš„ä½¿ç”¨ä¸­ï¼Œæ›´æ–°æ“ä½œä¹Ÿæ˜¯å¾ˆé¢‘ç¹çš„ï¼Œå¦‚æœæ¯ä¸€æ¬¡æ›´æ–°æ“ä½œéƒ½æ ¹æ®æ¡ä»¶æ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œç„¶åå°†è®°å½•æ›´æ–°ï¼Œå†å†™å›ç£ç›˜ï¼Œé‚£ä¹ˆ<strong>IO</strong>æˆæœ¬ä»¥åŠæŸ¥æ‰¾è®°å½•çš„æˆæœ¬éƒ½å¾ˆé«˜ã€‚æ‰€ä»¥ï¼Œå‡ºç°äº†æ—¥å¿—æ¨¡å—ï¼Œå³æˆ‘ä»¬çš„updateæ›´æ–°æ“ä½œæ˜¯<strong>å…ˆå†™æ—¥å¿—ï¼Œåœ¨åˆé€‚çš„æ—¶é—´æ‰ä¼šå»å†™ç£ç›˜</strong>ï¼Œæ—¥å¿—æ›´æ–°å®Œæ¯•å°±å°†æ‰§è¡Œç»“æœè¿”å›ç»™äº†å®¢æˆ·ç«¯ã€‚</p><p>MySQLä¸­çš„æ—¥å¿—æ¨¡å—ä¸»è¦æœ‰<strong>redo log</strong>ï¼ˆé‡åšæ—¥å¿—ï¼‰å’Œbinlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ã€‚</p><p><strong>redo log</strong></p><p>redo logæ˜¯<strong>InnoDBå¼•æ“ç‰¹æœ‰</strong>çš„æ—¥å¿—æ¨¡å—ï¼Œredo logæ˜¯<strong>ç‰©ç†æ—¥å¿—</strong>ï¼Œè®°å½•äº†æŸä¸ªæ•°æ®é¡µä¸Šåšäº†å“ªäº›ä¿®æ”¹ã€‚InnoDBçš„redo logæ˜¯å›ºå®šå¤§å°çš„ï¼Œæ¯”å¦‚å¯ä»¥é…ç½®ä¸ºä¸€ç»„4ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯1GBï¼Œé‚£ä¹ˆredologæ€»å…±å°±å¯ä»¥è®°å½• 4GBçš„æ“ä½œã€‚ä»å¤´å¼€å§‹å†™ï¼Œå†™åˆ°æœ«å°¾å°±åˆå›åˆ°å¼€å¤´å¾ªç¯å†™ã€‚</p><p>InnoDBçš„redo logä¿è¯äº†æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ä¹‹åï¼Œä¹‹å‰æäº¤çš„è®°å½•ä¸ä¼šä¸¢å¤±ï¼Œè¿™ä¸ªèƒ½åŠ›ç§°ä¸ºcrash-safeã€‚</p><p><strong>binlog</strong></p><p>binlogæ˜¯<strong>Serverå±‚è‡ªå¸¦</strong>çš„æ—¥å¿—æ¨¡å—ï¼Œbinlogæ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•æœ¬æ¬¡ä¿®æ”¹çš„åŸå§‹é€»è¾‘ï¼Œè¯´ç™½äº†å°±æ˜¯SQLè¯­å¥ã€‚binlogæ˜¯è¿½åŠ å†™çš„å½¢å¼ï¼Œå¯ä»¥å†™å¤šä¸ªæ–‡ä»¶ï¼Œä¸ä¼šè¦†ç›–ä¹‹å‰çš„æ—¥å¿—ã€‚é€šè¿‡mysqlbinlogå¯ä»¥è§£ææŸ¥çœ‹binlogæ—¥å¿—ã€‚binlogæ—¥å¿—æ–‡ä»¶çš„æ ¼å¼ï¼šstatementï¼Œrowï¼Œmixedã€‚</p><ol><li><strong>statement</strong>æ ¼å¼çš„binlogè®°å½•çš„æ˜¯å®Œæ•´çš„SQLè¯­å¥ï¼Œä¼˜ç‚¹æ˜¯æ—¥å¿—æ–‡ä»¶å°ï¼Œæ€§èƒ½è¾ƒå¥½ï¼Œç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œé‚£å°±æ˜¯å‡†ç¡®æ€§å·®ï¼Œé‡åˆ°SQLè¯­å¥ä¸­æœ‰now()ç­‰å‡½æ•°ä¼šå¯¼è‡´ä¸å‡†ç¡®</li><li><strong>row</strong>æ ¼å¼çš„binlogä¸­è®°å½•çš„æ˜¯æ•°æ®è¡Œçš„å®é™…æ•°æ®çš„å˜æ›´ï¼Œä¼˜ç‚¹å°±æ˜¯æ•°æ®è®°å½•å‡†ç¡®ï¼Œç¼ºç‚¹å°±æ˜¯æ—¥å¿—æ–‡ä»¶è¾ƒå¤§ã€‚</li><li><strong>mixed</strong>æ ¼å¼çš„binlogæ˜¯å‰é¢ä¸¤è€…çš„æ··åˆæ¨¡å¼</li></ol><p>ä¸šç•Œç›®å‰æ¨èä½¿ç”¨çš„æ˜¯ row æ¨¡å¼ï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹å¯¹å‡†ç¡®æ€§çš„è¦æ±‚æ˜¯æ’åœ¨ç¬¬ä¸€ä½çš„ã€‚</p><p>åœ¨æ›´æ–°æ•°æ®åº“çš„æ—¶å€™ï¼Œé€šè¿‡redo logå’Œbinlogçš„<strong>ä¸¤é˜¶æ®µæäº¤</strong>ï¼Œå¯ä»¥ç¡®ä¿æ•°æ®åº“å¼‚å¸¸å´©æºƒä¹‹åæ•°æ®çš„æ­£ç¡®æ¢å¤ã€‚</p><p>åœ¨å¯¹æ•°æ®åº“è¯¯æ“ä½œä¹‹åï¼Œå¯ä»¥é€šè¿‡<strong>å¤‡ä»½åº“+binlog</strong>å¯ä»¥å°†æ•°æ®åº“çŠ¶æ€æ¢å¤åˆ°â€œä»»æ„â€œæ—¶åˆ»ã€‚</p><h1 id="ä»€ä¹ˆæ˜¯é—´éš™é”ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é—´éš™é”ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é—´éš™é”ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é—´éš™é”ï¼Ÿ</h1><p>é—´éš™é”æ˜¯å¯é‡å¤è¯»çº§åˆ«ä¸‹æ‰ä¼šæœ‰çš„é”ï¼Œç»“åˆMVCCå’Œé—´éš™é”å¯ä»¥è§£å†³å¹»è¯»çš„é—®é¢˜ã€‚æˆ‘ä»¬è¿˜æ˜¯ä»¥userä¸¾</p><p>ä¾‹ï¼Œå‡è®¾ç°åœ¨userè¡¨æœ‰å‡ æ¡è®°å½•</p><table><thead><tr><th>id</th><th>age</th></tr></thead><tbody><tr><td>1</td><td>10</td></tr><tr><td>2</td><td>20</td></tr><tr><td>3</td><td>30</td></tr></tbody></table><p>å½“æˆ‘ä»¬æ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">begin</span>;<br><span class="hljs-keyword">select</span> \<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> age<span class="hljs-operator">=</span><span class="hljs-number">20</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">update</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span>ç‹¬å é”<br><span class="hljs-keyword">begin</span>;<br><span class="hljs-keyword">insert into</span> <span class="hljs-keyword">user</span>(age) <span class="hljs-keyword">values</span>(<span class="hljs-number">10</span>); #æˆåŠŸ<br><span class="hljs-keyword">insert into</span> <span class="hljs-keyword">user</span>(age) <span class="hljs-keyword">values</span>(<span class="hljs-number">11</span>); #å¤±è´¥<br><span class="hljs-keyword">insert into</span> <span class="hljs-keyword">user</span>(age) <span class="hljs-keyword">values</span>(<span class="hljs-number">20</span>); #å¤±è´¥<br><span class="hljs-keyword">insert into</span> <span class="hljs-keyword">user</span>(age) <span class="hljs-keyword">values</span>(<span class="hljs-number">21</span>); #å¤±è´¥<br><span class="hljs-keyword">insert into</span> <span class="hljs-keyword">user</span>(age) <span class="hljs-keyword">values</span>(<span class="hljs-number">30</span>); #å¤±è´¥<br></code></pre></td></tr></table></figure><p>åªæœ‰10å¯ä»¥æ’â¼ŠæˆåŠŸï¼Œé‚£ä¹ˆå› ä¸ºè¡¨çš„é—´éš™mysqlâ¾ƒåŠ¨å¸®æˆ‘ä»¬â½£æˆäº†åŒºé—´(å·¦å¼€å³é—­)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">(negative infinityï¼Œ<span class="hljs-number">10</span>],(<span class="hljs-number">10</span>,<span class="hljs-number">20</span>],(<span class="hljs-number">20</span>,<span class="hljs-number">30</span>],(<span class="hljs-number">30</span>,positive infinity)<br></code></pre></td></tr></table></figure><p>ç”±äº20å­˜åœ¨è®°å½•ï¼Œæ‰€ä»¥(10,20]ï¼Œ(20,30]åŒºé—´éƒ½è¢«é”å®šäº†â½†æ³•æ’â¼Šã€åˆ é™¤ã€‚</p><p>å¦‚æœæŸ¥è¯¢21å‘¢ï¼Ÿå°±ä¼šæ ¹æ®21å®šä½åˆ°(20,30)çš„åŒºé—´(éƒ½æ˜¯å¼€åŒºé—´)ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯å”¯â¼€ç´¢å¼•æ˜¯ä¸ä¼šæœ‰é—´éš™ç´¢å¼•çš„ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…«å¤§æ’åºç®—æ³•ï¼ˆä¸‹ï¼‰</title>
    <link href="/2021/03/17/%E5%85%AB%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%EF%BC%88%E4%B8%8B%EF%BC%89/"/>
    <url>/2021/03/17/%E5%85%AB%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%EF%BC%88%E4%B8%8B%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h1><p>å½’å¹¶æ’åºï¼ˆMERGE-SORTï¼‰æ˜¯åˆ©ç”¨å½’å¹¶çš„æ€æƒ³å®ç°çš„æ’åºæ–¹æ³•ï¼Œè¯¥æ–¹æ³•é‡‡ç”¨ç»å…¸çš„åˆ†æ²»ç­–ç•¥ï¼ˆåˆ†æ²»æ³•å°†é—®é¢˜åˆ†æˆä¸€äº›å°çš„é—®é¢˜ç„¶åé€’å½’æ±‚è§£ï¼Œè€Œæ²»çš„é˜¶æ®µåˆ™å°†åˆ†çš„é˜¶æ®µå¾—åˆ°çš„å„ä¸ªç­”æ¡ˆæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå³ä¸ºåˆ†è€Œæ²»ä¹‹ï¼‰ã€‚</p><p><strong>å®ç°æ€æƒ³</strong></p><p><img src="https://i.loli.net/2021/03/17/xMubRDktIYjQdOX.jpg"></p><p><strong>å…·ä½“æ­¥éª¤</strong></p><p><img src="https://i.loli.net/2021/03/17/kLhDN6S9mYcEQb7.jpg"></p><p><strong>ä»£ç å®ç°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åˆ†+åˆæ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mergeSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right, <span class="hljs-type">int</span>[] temp)</span> &#123;<br><span class="hljs-keyword">if</span>(left &lt; right) &#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> (left + right) / <span class="hljs-number">2</span>; <span class="hljs-comment">//ä¸­é—´ç´¢å¼•</span><br><span class="hljs-comment">//å‘å·¦é€’å½’è¿›è¡Œåˆ†è§£</span><br>mergeSort(arr, left, mid, temp);<br><span class="hljs-comment">//å‘å³é€’å½’è¿›è¡Œåˆ†è§£</span><br>mergeSort(arr, mid + <span class="hljs-number">1</span>, right, temp);<br><span class="hljs-comment">//åˆå¹¶</span><br>merge(arr, left, mid, right, temp);<br>&#125;<br>&#125;<br><span class="hljs-comment">//åˆå¹¶çš„æ–¹æ³•</span><br>/\*\*<br>\*<br>\* <span class="hljs-meta">@param</span> arr æ’åºçš„åŸå§‹æ•°ç»„<br>\* <span class="hljs-meta">@param</span> left å·¦è¾¹æœ‰åºåºåˆ—çš„åˆå§‹ç´¢å¼•<br>\* <span class="hljs-meta">@param</span> mid ä¸­é—´ç´¢å¼•<br>\* <span class="hljs-meta">@param</span> right å³è¾¹ç´¢å¼•<br>\* <span class="hljs-meta">@param</span> temp åšä¸­è½¬çš„æ•°ç»„<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">merge</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> mid, <span class="hljs-type">int</span> right, <span class="hljs-type">int</span>[] temp)</span> &#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> left; <span class="hljs-comment">// åˆå§‹åŒ–i, å·¦è¾¹æœ‰åºåºåˆ—çš„åˆå§‹ç´¢å¼•</span><br><span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> mid + <span class="hljs-number">1</span>; <span class="hljs-comment">//åˆå§‹åŒ–j, å³è¾¹æœ‰åºåºåˆ—çš„åˆå§‹ç´¢å¼•</span><br><span class="hljs-type">int</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// æŒ‡å‘tempæ•°ç»„çš„å½“å‰ç´¢å¼•</span><br><span class="hljs-comment">//(ä¸€)</span><br><span class="hljs-comment">//å…ˆæŠŠå·¦å³ä¸¤è¾¹(æœ‰åº)çš„æ•°æ®æŒ‰ç…§è§„åˆ™å¡«å……åˆ°tempæ•°ç»„</span><br><span class="hljs-comment">//ç›´åˆ°å·¦å³ä¸¤è¾¹çš„æœ‰åºåºåˆ—ï¼Œæœ‰ä¸€è¾¹å¤„ç†å®Œæ¯•ä¸ºæ­¢</span><br><span class="hljs-keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= right) &#123;<span class="hljs-comment">//ç»§ç»­</span><br><span class="hljs-comment">//å¦‚æœå·¦è¾¹çš„æœ‰åºåºåˆ—çš„å½“å‰å…ƒç´ ï¼Œå°äºç­‰äºå³è¾¹æœ‰åºåºåˆ—çš„å½“å‰å…ƒç´ </span><br><span class="hljs-comment">//å³å°†å·¦è¾¹çš„å½“å‰å…ƒç´ ï¼Œå¡«å……åˆ° tempæ•°ç»„</span><br><span class="hljs-comment">//ç„¶å t++, i++</span><br><span class="hljs-keyword">if</span>(arr[i] &lt;= arr[j]) &#123;<br>temp[t] = arr[i];<br>t += <span class="hljs-number">1</span>;<br>i += <span class="hljs-number">1</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">//åä¹‹,å°†å³è¾¹æœ‰åºåºåˆ—çš„å½“å‰å…ƒç´ ï¼Œå¡«å……åˆ°tempæ•°ç»„</span><br>temp[t] = arr[j];<br>t += <span class="hljs-number">1</span>;<br>j += <span class="hljs-number">1</span>;<br>&#125;<br>&#125;<br><span class="hljs-comment">//(äºŒ)</span><br><span class="hljs-comment">//æŠŠæœ‰å‰©ä½™æ•°æ®çš„ä¸€è¾¹çš„æ•°æ®ä¾æ¬¡å…¨éƒ¨å¡«å……åˆ°temp</span><br><span class="hljs-keyword">while</span>( i &lt;= mid) &#123; <span class="hljs-comment">//å·¦è¾¹çš„æœ‰åºåºåˆ—è¿˜æœ‰å‰©ä½™çš„å…ƒç´ ï¼Œå°±å…¨éƒ¨å¡«å……åˆ°temp</span><br>temp[t] = arr[i];<br>t += <span class="hljs-number">1</span>;<br>i += <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-keyword">while</span>( j &lt;= right) &#123; <span class="hljs-comment">//å³è¾¹çš„æœ‰åºåºåˆ—è¿˜æœ‰å‰©ä½™çš„å…ƒç´ ï¼Œå°±å…¨éƒ¨å¡«å……åˆ°temp</span><br>temp[t] = arr[j];<br>t += <span class="hljs-number">1</span>;<br>j += <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-comment">//(ä¸‰)</span><br><span class="hljs-comment">//å°†tempæ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°arr</span><br><span class="hljs-comment">//æ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡éƒ½æ‹·è´æ‰€æœ‰</span><br>t = <span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">tempLeft</span> <span class="hljs-operator">=</span> left; <span class="hljs-comment">//</span><br><span class="hljs-comment">//ç¬¬ä¸€æ¬¡åˆå¹¶ tempLeft = 0 , right = 1 // tempLeft = 2 right = 3 // tL=0 ri=3</span><br><span class="hljs-comment">//æœ€åä¸€æ¬¡ tempLeft = 0 right = 7</span><br><span class="hljs-keyword">while</span>(tempLeft &lt;= right) &#123;<br>arr[tempLeft] = temp[t];<br>t += <span class="hljs-number">1</span>;<br>tempLeft += <span class="hljs-number">1</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨é‡Šå†™çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡Œå°±ä¸åšè¿‡å¤šè®ºè¿°äº†ã€‚</p><h1 id="åŸºæ•°æ’åº"><a href="#åŸºæ•°æ’åº" class="headerlink" title="åŸºæ•°æ’åº"></a>åŸºæ•°æ’åº</h1><p>åŸºæ•°æ’åºï¼ˆRADIX-SORTï¼‰å±äºâ€œåˆ†é…å¼æ’åºâ€ï¼Œåˆç§°â€œæ¡¶å­æ³•â€ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯é€šè¿‡é”®å€¼çš„å„ä¸ªä½çš„å€¼ï¼Œå°†è¦æ’åºçš„å…ƒç´ åˆ†é…è‡³æŸäº›â€œæ¡¶â€ä¸­ï¼Œè¾¾åˆ°æ’åºçš„æ•ˆæœã€‚</p><p>åŸºæ•°æ’åºæ˜¯å±äºç¨³å®šæ€§çš„æ’åºï¼ŒåŸºæ•°æ’åºæ³•æ˜¯æ•ˆç‡é«˜çš„ç¨³å®šæ€§æ’åºæ³•</p><p>åŸºæ•°æ’åºæ˜¯æ¡¶æ’åºçš„æ‰©å±•ã€‚</p><p><strong>åŸºæœ¬æ€æƒ³</strong></p><p>å°†æ‰€æœ‰å¾…æ¯”è¾ƒæ•°å€¼ç»Ÿä¸€ä¸ºåŒæ ·çš„æ•°ä½é•¿åº¦ï¼Œæ•°ä½è¾ƒçŸ­çš„æ•°å‰é¢è¡¥é›¶ã€‚ç„¶åï¼Œä»æœ€ä½ä¸ºå¼€å§‹ï¼Œä¾æ¬¡è¿›è¡Œæ’åºã€‚</p><p>è¿™æ ·ä»æœ€ä½ä½æ’åºä¸€ç›´åˆ°æœ€é«˜ä½æ’åºå®Œæˆä»¥åï¼Œæ•°åˆ—å°±æ˜¯ä¸€ä¸ªæœ‰åºåºåˆ—ã€‚</p><p><strong>å›¾æ–‡è¯´æ˜</strong></p><p><img src="https://i.loli.net/2021/03/17/DW5qLVdYaIAQ3ON.jpg"></p><p><img src="https://i.loli.net/2021/03/17/esxpcPiIalXC1WJ.jpg"></p><p><strong>ä»£ç å®ç°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">radixSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> &#123;<br><span class="hljs-comment">//æ ¹æ®å‰é¢çš„æ¨å¯¼è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æœ€ç»ˆçš„åŸºæ•°æ’åºä»£ç </span><br><span class="hljs-comment">//1.å¾—åˆ°æœ€å¤§çš„ä½æ•°</span><br><span class="hljs-type">int</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br><span class="hljs-keyword">if</span> (arr[i] &gt; max) &#123;<br>max = arr[i];<br>&#125;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-variable">maxLength</span> <span class="hljs-operator">=</span> (max + <span class="hljs-string">&quot; &quot;</span>).length(); <span class="hljs-comment">//è½¬å­—ç¬¦ä¸² å»length å¾—åˆ°é•¿åº¦</span><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œè¡¨ç¤º10ä¸ªæ¡¶, æ¯ä¸ªæ¡¶å°±æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„</span><br><span class="hljs-comment">//è¯´æ˜</span><br><span class="hljs-comment">//1. äºŒç»´æ•°ç»„åŒ…å«10ä¸ªä¸€ç»´æ•°ç»„</span><br><span class="hljs-comment">//2. ä¸ºäº†é˜²æ­¢åœ¨æ”¾å…¥æ•°çš„æ—¶å€™ï¼Œæ•°æ®æº¢å‡ºï¼Œåˆ™æ¯ä¸ªä¸€ç»´æ•°ç»„(æ¡¶)ï¼Œå¤§å°å®šä¸ºarr.length</span><br><span class="hljs-comment">//3. åæ˜ç¡®ï¼ŒåŸºæ•°æ’åºæ˜¯ä½¿ç”¨ç©ºé—´æ¢æ—¶é—´çš„ç»å…¸ç®—æ³•</span><br><span class="hljs-type">int</span>[][] bucket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>][arr.length];<br><span class="hljs-comment">//å¾ªç¯å¤„ç†</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, n = <span class="hljs-number">1</span>; i &lt; maxLength; i++, n \*= <span class="hljs-number">10</span>) &#123;<br><span class="hljs-type">int</span>[] bucketElementCounts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>];<br><span class="hljs-comment">//ç¬¬nè½®</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; arr.length; j++) &#123;<br><span class="hljs-comment">//å–å‡ºæ¯ä¸ªå…ƒç´ çš„ä¸ªä½çš„å€¼</span><br><span class="hljs-type">int</span> <span class="hljs-variable">digitOfElement</span> <span class="hljs-operator">=</span> arr[j] / n % <span class="hljs-number">10</span>;<br><span class="hljs-comment">//æ”¾å…¥åˆ°å¯¹åº”çš„æ¡¶ä¸­</span><br>bucket[digitOfElement][bucketElementCounts[digitOfElement]] = arr[j];<br>bucketElementCounts[digitOfElement]++;<br>&#125;<br><span class="hljs-comment">//æŒ‰ç…§è¿™ä¸ªæ¡¶çš„é¡ºåºï¼ˆä¸€ç»´æ•°ç»„çš„ä¸‹æ ‡ä¾æ¬¡å–å‡ºæ•°æ®ï¼Œæ”¾å…¥åŸæ¥æ•°ç»„ï¼‰</span><br><span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">//éå†æ¯ä¸€æ¡¶ï¼Œå¹¶å°†æ¡¶ä¸­æ•°æ®ï¼Œæ”¾å…¥åŸæ•°ç»„</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; k &lt; bucketElementCounts.length; k++) &#123;<br><span class="hljs-comment">//å¦‚æœæ¡¶ä¸­æœ‰æ•°æ®ï¼Œæˆ‘ä»¬æ”¾å…¥åˆ°åŸæ•°ç»„</span><br><span class="hljs-keyword">if</span> (bucketElementCounts[k] != <span class="hljs-number">0</span>) &#123;<br><span class="hljs-comment">//å¾ªç¯è¯¥æ¡¶å³ç¬¬Kä¸ªæ¡¶ï¼ˆå³ç¬¬kä¸ªä¸€ç»´æ•°ç»„ï¼‰ï¼Œæ”¾å…¥</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">l</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; l &lt; bucketElementCounts[k]; l++) &#123;<br><span class="hljs-comment">//å–å‡ºå…ƒç´ æ”¾å…¥åˆ°arr</span><br>arr[index++] = bucket[k][l];<br>&#125;<br>&#125;<br>bucketElementCounts[k] = <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">// System.out.println(&quot;ç¬¬&quot; + (i + 1) + &quot;è½®åŸºæ•°æ’åºåï¼š&quot; + Arrays.toString(arr));</span><br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h1><p>å †æ’åºæ˜¯åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„è€Œè®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ï¼Œå †æ’åºæ˜¯ä¸€ç§é€‰æ‹©æ’åºï¼Œå®ƒçš„æœ€åï¼Œæœ€å¥½ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(nlogn)ï¼Œå®ƒä¹Ÿæ˜¯ä¸ç¨³å®šæ’åºã€‚</p><p><strong>å †æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>å…·æœ‰å®Œå…¨ä»¥ä¸‹æ€§è´¨çš„å®Œå…¨äºŒå‰æ ‘ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å·¦å³å­©å­èŠ‚ç‚¹çš„å€¼ï¼Œç§°ä¸ºå¤§é¡¶å †ï¼Œä¸è¦æ±‚èŠ‚ç‚¹çš„å·¦å­©å­å’Œå³å­©å­å€¼çš„å¤§å°ã€‚</p><p><img src="https://i.loli.net/2021/03/17/HGnRPQfUjYJWtV9.jpg"></p><p>æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å·¦å³å­©å­èŠ‚ç‚¹çš„å€¼ï¼Œç§°ä¸ºå°é¡¶å †</p><p><img src="https://i.loli.net/2021/03/17/xEocFaQnu24Hlp1.jpg"></p><p><strong>ä¸€èˆ¬å‡åºé‡‡ç”¨å¤§é¡¶å †ï¼Œé™åºé‡‡ç”¨å°é¡¶å †</strong></p><p><strong>åŸºæœ¬æ€æƒ³</strong></p><ol><li>å°†å¾…æ’åºåºåˆ—æ„é€ æˆä¸€ä¸ªå¤§é¡¶å †</li><li>æ­¤æ—¶ï¼Œæ•´ä¸ªåºåˆ—çš„æœ€å¤§å€¼å°±æ˜¯å †é¡¶çš„æœ€å¤§å€¼</li><li>å°†å…¶ä¸æœ«å°¾å…ƒç´ è¿›è¡Œäº¤æ¢ï¼Œæ­¤æ—¶æœ«å°¾å°±ä¸ºæœ€å¤§å€¼</li><li>ç„¶åå°†å‰©ä¸‹çš„n-1ä¸ªå…ƒç´ é‡æ–°æ„é€ æˆä¸€ä¸ªå †ï¼Œè¿™æ ·ä¼šå¾—åˆ°nä¸ªå…ƒç´ çš„æ¬¡å°å€¼ã€‚å¦‚æ­¤åå¤æ‰§è¡Œï¼Œå°±å¾—åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—äº†ã€‚</li></ol><p><strong>å›¾è§£</strong></p><blockquote><p>æ­¥éª¤ä¸€ï¼šæ„é€ åˆå§‹å †ã€‚å°†ç»™å®šæ— åºåºåˆ—æ„é€ æˆä¸€ä¸ªå¤§é¡¶å †</p></blockquote><p>1.å‡è®¾ç»™å®šæ— åºåºåˆ—ç»“æ„å¦‚ä¸‹</p><p><img src="https://i.loli.net/2021/03/17/R7Pzd6y3x129tKH.jpg"></p><p>2.æ­¤æ—¶æˆ‘ä»¬ä»æœ€åä¸€ä¸ªéå¶å­ç»“ç‚¹å¼€å§‹ï¼ˆå¶ç»“ç‚¹è‡ªç„¶ä¸ç”¨è°ƒæ•´ï¼Œç¬¬ä¸€ä¸ªéå¶å­ç»“ç‚¹ arr.length&#x2F;2-1&#x3D;5&#x2F;2-1&#x3D;1ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„6ç»“ç‚¹ï¼‰ï¼Œä»å·¦è‡³å³ï¼Œä»ä¸‹è‡³ä¸Šè¿›è¡Œè°ƒæ•´ã€‚</p><p><img src="https://i.loli.net/2021/03/17/JzqwdAPQgOe4ytB.jpg"></p><p>3.æ‰¾åˆ°ç¬¬äºŒä¸ªéå¶èŠ‚ç‚¹4ï¼Œç”±äº[4,9,8]ä¸­9å…ƒç´ æœ€å¤§ï¼Œ4å’Œ9äº¤æ¢ã€‚</p><p><img src="https://i.loli.net/2021/03/17/J4kIA3uaQmcUgRp.jpg"></p><p>4.è¿™æ—¶ï¼Œäº¤æ¢å¯¼è‡´äº†å­æ ¹[4,5,6]ç»“æ„æ··ä¹±ï¼Œç»§ç»­è°ƒæ•´ï¼Œ[4,5,6]ä¸­6æœ€å¤§ï¼Œäº¤æ¢4å’Œ6ã€‚</p><p><img src="https://i.loli.net/2021/03/17/duXn1TpNODwcbyC.jpg"></p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å°†ä¸€ä¸ªæ— åºåºåˆ—æ„é€ æˆäº†ä¸€ä¸ªå¤§é¡¶å †ã€‚</p><blockquote><p>æ­¥éª¤äºŒ ï¼šå°†å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ è¿›è¡Œäº¤æ¢ï¼Œä½¿æœ«å°¾å…ƒç´ æœ€å¤§ã€‚ç„¶åç»§ç»­è°ƒæ•´å †ï¼Œå†å°†å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ äº¤æ¢ï¼Œå¾—åˆ°ç¬¬äºŒå¤§å…ƒç´ ã€‚å¦‚æ­¤åå¤è¿›è¡Œäº¤æ¢ã€é‡å»ºã€äº¤æ¢ã€‚</p></blockquote><p>6.å°†å †é¡¶å…ƒç´ 9å’Œæœ«å°¾å…ƒç´ 4è¿›è¡Œäº¤æ¢</p><p><img src="https://i.loli.net/2021/03/17/5mLhj6FV7rW9pJQ.jpg"></p><p>7.é‡æ–°è°ƒæ•´ç»“æ„ï¼Œä½¿å…¶ç»§ç»­æ»¡è¶³å †å®šä¹‰</p><p><img src="https://i.loli.net/2021/03/17/WpYXTH2VzIQ38Gh.jpg"></p><p>8.å†å°†å †é¡¶å…ƒç´ 8ä¸æœ«å°¾å…ƒç´ 5è¿›è¡Œäº¤æ¢ï¼Œå¾—åˆ°ç¬¬äºŒå¤§å…ƒç´ 8.</p><p><img src="https://i.loli.net/2021/03/17/aG1XdTEW9ZCSNH7.jpg"></p><p>9.åç»­è¿‡ç¨‹ï¼Œç»§ç»­è¿›è¡Œè°ƒæ•´ï¼Œäº¤æ¢ï¼Œå¦‚æ­¤åå¤è¿›è¡Œï¼Œæœ€ç»ˆä½¿å¾—æ•´ä¸ªåºåˆ—æœ‰åº</p><p><img src="https://i.loli.net/2021/03/17/RyQJpsnNoCKZg3X.jpg"></p><p><strong>ä»£ç å®ç°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">headSort</span><span class="hljs-params">(<span class="hljs-type">int</span> arr [])</span>&#123;<br><span class="hljs-comment">// System.out.println(&quot;å †æ’åº&quot;);</span><br><span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">// //åˆ†æ­¥å®Œæˆ</span><br><span class="hljs-comment">// adjustHeap(arr,1,arr.length);</span><br><span class="hljs-comment">// System.out.println(&quot;ç¬¬ä¸€æ¬¡&quot;+ Arrays.toString(arr));</span><br><span class="hljs-comment">// adjustHeap(arr,0,arr.length);</span><br><span class="hljs-comment">// System.out.println(&quot;ç¬¬äºŒæ¬¡&quot;+ Arrays.toString(arr));</span><br><span class="hljs-comment">//å°†æ— åºåºåˆ—æ„å»ºæˆä¸€ä¸ªå †ï¼Œæ ¹æ®å‡åºé™åºéœ€æ±‚é€‰æ‹©å¤§é¡¶å †æˆ–å°é¡¶å †</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> arr.length /<span class="hljs-number">2</span> -<span class="hljs-number">1</span>;i &gt;=<span class="hljs-number">0</span>;i --)&#123;<br>adjustHeap(arr,i,arr.length);<br>&#125;<br>/\*\*<br>\* <span class="hljs-number">2.</span>å°†å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ äº¤æ¢ï¼Œå°†æœ€å¤§å…ƒç´ æ²‰åˆ°æ•°ç»„æœ«ç«¯<br>\* <span class="hljs-number">3.</span>é‡æ–°è°ƒæ•´ç»“æ„ï¼Œä½¿å…¶æ»¡è¶³å †å®šä¹‰ï¼Œç„¶åç»§ç»­äº¤æ¢å †é¡¶å…ƒç´ ä¸å½“å‰æœ«å°¾å…ƒç´ ï¼Œåå¤æ‰§è¡Œ<br>\*/<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> arr.length -<span class="hljs-number">1</span>; j &gt; <span class="hljs-number">0</span>; j--)&#123;<br><span class="hljs-comment">//äº¤æ¢</span><br>temp = arr[j];<br>arr[j] = arr[<span class="hljs-number">0</span>];<br>arr[<span class="hljs-number">0</span>] = temp;<br>adjustHeap(arr,<span class="hljs-number">0</span>,j);<br>&#125;<br><span class="hljs-comment">// System.out.println(&quot;æ•°ç»„=&quot;+Arrays.toString(arr));</span><br>&#125;<br>/\*\*<br>\*<br>\* <span class="hljs-meta">@param</span> arr å¾…è°ƒæ•´çš„æ•°ç»„<br>\* <span class="hljs-meta">@param</span> i è¡¨ç¤ºéå¶å­èŠ‚ç‚¹åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•<br>\* <span class="hljs-meta">@param</span> length è¡¨ç¤ºå¯¹å¤šå°‘ä¸ªå…ƒç´ è¿›è¡Œè°ƒæ•´ï¼Œlengthæ˜¯åœ¨é€æ¸å‡å°‘<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustHeap</span><span class="hljs-params">(<span class="hljs-type">int</span> arr [],<span class="hljs-type">int</span> i,<span class="hljs-type">int</span> length)</span>&#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span>arr[i]; <span class="hljs-comment">//å…ˆå–å‡ºå½“å‰å…ƒç´ çš„å€¼ï¼Œä¿å­˜åœ¨ä¸´æ—¶å˜é‡</span><br><span class="hljs-comment">//å¼€å§‹è°ƒæ•´</span><br><span class="hljs-comment">//è¯´æ˜</span><br><span class="hljs-comment">//1ï¼Œk = i \*2 +1 kæ˜¯ièŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> i \* <span class="hljs-number">2</span> +<span class="hljs-number">1</span>; k &lt; length; k = i \* <span class="hljs-number">2</span> +<span class="hljs-number">1</span>) &#123;<br><span class="hljs-keyword">if</span> (k+<span class="hljs-number">1</span> &lt; length &amp;&amp; arr[k] &lt; arr [k+<span class="hljs-number">1</span>])&#123; <span class="hljs-comment">//è¯´æ˜å·¦å­èŠ‚ç‚¹çš„å€¼å°äºå³å­èŠ‚ç‚¹çš„å€¼</span><br>k ++;<br>&#125;<br><span class="hljs-keyword">if</span> (arr [k] &gt; temp)&#123; <span class="hljs-comment">//å¦‚æœå­èŠ‚ç‚¹å¤§äºçˆ¶èŠ‚ç‚¹</span><br>arr[i] = arr [k]; <span class="hljs-comment">//æŠŠè¾ƒå¤§çš„å€¼èµ‹ç»™å½“å‰èŠ‚ç‚¹</span><br>i = k;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br><span class="hljs-comment">//å½“for å¾ªç¯ç»“æŸåï¼Œæˆ‘ä»¬å·²ç»å°†ä»¥i ä¸ºçˆ¶èŠ‚ç‚¹çš„æ ‘çš„æœ€å¤§å€¼ï¼Œæ”¾åœ¨äº†æœ€é¡¶ï¼ˆå±€éƒ¨ï¼‰</span><br>arr [i] = temp; <span class="hljs-comment">//å°†tempå€¼æ”¾åˆ°è°ƒæ•´åçš„ä½ç½®</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç¯‡ä»‹ç»æ˜¯ä¸‰ç§æ’åºç¡®å®šæœ‰ç‚¹éš¾ï¼Œéœ€è¦å¤§å®¶å…ˆç†è§£å®ç°æ€è·¯ï¼Œåœ¨debugè¿›å»ç¨‹åºï¼Œå»çœ‹æ¯ä¸€æ­¥çš„æ“ä½œã€‚</p><h1 id="å…«å¤§æ’åºç®—æ³•æ—¶é—´å¤æ‚åº¦åˆ†æ"><a href="#å…«å¤§æ’åºç®—æ³•æ—¶é—´å¤æ‚åº¦åˆ†æ" class="headerlink" title="å…«å¤§æ’åºç®—æ³•æ—¶é—´å¤æ‚åº¦åˆ†æ"></a>å…«å¤§æ’åºç®—æ³•æ—¶é—´å¤æ‚åº¦åˆ†æ</h1><table><thead><tr><th>æ’åºç®—æ³•</th><th>å¹³å‡æ—¶é—´</th><th>æœ€å·®æƒ…å½¢</th><th>ç¨³å®šåº¦</th><th>é¢å¤–ç©ºé—´</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>å†’æ³¡</td><td>O(n^2)</td><td>O(n^2)</td><td>ç¨³å®š</td><td>O(1)</td><td>nå°æ—¶è¾ƒå¥½</td></tr><tr><td>äº¤æ¢</td><td>O(n^2)</td><td>O(n^2)</td><td>ä¸ç¨³å®š</td><td>O(1)</td><td>nå°æ—¶è¾ƒå¥½</td></tr><tr><td>é€‰æ‹©</td><td>O(n^2)</td><td>O(n^2)</td><td>ä¸ç¨³å®š</td><td>O(1)</td><td>nå°æ—¶è¾ƒå¥½</td></tr><tr><td>æ’å…¥</td><td>O(n^2)</td><td>O(n^2)</td><td>ç¨³å®š</td><td>O(1)</td><td>å¤§éƒ¨åˆ†å·²æ’åºè¾ƒå¥½</td></tr><tr><td>åŸºæ•°</td><td>O(logRB)</td><td>O(logRB)</td><td>ç¨³å®š</td><td>O(n)</td><td>Bæ˜¯çœŸæ•°ï¼ˆ0-9ï¼‰Ræ˜¯åŸºæ•°ï¼ˆä¸ªåç™¾ï¼‰</td></tr><tr><td>Shell</td><td>O(nlogn)</td><td>O(n^s) 1&lt;s&lt;2</td><td>ä¸ç¨³å®š</td><td>O(1)</td><td>sæ˜¯æ‰€é€‰åˆ†ç»„</td></tr><tr><td>å¿«æ’</td><td>O(nlogn)</td><td>O(n^2)</td><td>ä¸ç¨³å®š</td><td>O(nlogn)</td><td>nå¤§æ—¶è¾ƒå¥½</td></tr><tr><td>å½’å¹¶</td><td>O(nlogn)</td><td>O(nlogn)</td><td>ç¨³å®š</td><td>O(1)</td><td>nå¤§æ—¶è¾ƒå¥½</td></tr><tr><td>å †</td><td>O(nlogn)</td><td>O(nlogn)</td><td>ä¸ç¨³å®š</td><td>O(1)</td><td>nå¤§æ—¶è¾ƒå¥½</td></tr></tbody></table><p><strong>å¹³å‡æ—¶é—´å¤æ‚åº¦å’Œæœ€åæ—¶é—´å¤æ‚åº¦</strong></p><ol><li><p>å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯æŒ‡æ‰€æœ‰å¯èƒ½çš„è¾“å…¥å®ä¾‹å‡ä»¥ç­‰æ¦‚ç‡å‡ºç°çš„æƒ…å†µä¸‹ï¼Œè¯¥ç®—æ³•çš„è¿è¡Œæ—¶é—´ã€‚</p></li><li><p>æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ç§°æœ€åæ—¶é—´å¤æ‚åº¦ã€‚ä¸€èˆ¬è®¨è®ºçš„æ—¶é—´å¤æ‚åº¦å‡æ˜¯æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ã€‚ è¿™æ ·åšçš„åŸå› æ˜¯ï¼šæœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ç®—æ³•åœ¨ä»»ä½•è¾“å…¥å®ä¾‹ä¸Šè¿è¡Œæ—¶é—´çš„ç•Œé™ï¼Œè¿™å°±ä¿è¯äº†ç®—æ³•çš„è¿è¡Œæ—¶é—´ä¸ä¼šæ¯”æœ€åæƒ…å†µæ›´é•¿ã€‚</p><p>â€‹</p></li></ol><p>æˆ‘ä¸ªäººå–œæ¬¢å¿«æ’ï¼Œå°¤å…¶æ˜¯é€’å½’å®ç°çš„å¿«æ’ï¼Œç†è§£æ€æƒ³å’Œä»£ç é˜…è¯»éƒ½å¾ˆå®¹æ˜“ï¼Œåœ¨å¼€å‘ä¸­é‡åˆ°æ’åºé€šå¸¸è°ƒç”¨çš„æ˜¯é›†åˆå·¥å…·ç±»Arraysçš„sort()æ–¹æ³•ï¼Œå®ƒåº•å±‚ä¹Ÿæ˜¯ç”¨çš„å¿«æ’ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å•ä¾‹æ¨¡å¼çš„å¤šç§å®ç°æ–¹å¼</title>
    <link href="/2021/03/16/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%A4%9A%E7%A7%8D%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0/"/>
    <url>/2021/03/16/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%A4%9A%E7%A7%8D%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<p>å•ä¾‹æ¨¡å¼ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”å®ƒè‡ªå·±è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼Œè¿™ä¸ªç±»æä¾›äº†ä¸€ç§è®¿é—®å…¶å”¯ä¸€çš„å¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹æœ‰å“ªå‡ ç§å®ç°æ–¹å¼å§ã€‚</p><p>å•ä¾‹æ¨¡å¼åˆ†é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼ï¼Œä¸‹é¢ä»‹ç»ä¸‹ä¸¤ç§çš„å…·ä½“å†™æ³•ï¼š</p><h1 id="é¥¿æ±‰å¼"><a href="#é¥¿æ±‰å¼" class="headerlink" title="é¥¿æ±‰å¼"></a>é¥¿æ±‰å¼</h1><p>é¥¿æ±‰å¼å°±æ˜¯åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å·²ç»åˆ›å»ºå®ä¾‹ï¼Œä¸ç®¡ä½ ç”¨æ²¡ç”¨åˆ°ï¼Œéƒ½åˆ›å»ºã€‚</p><p>å¥½å¤„ï¼šçº¿ç¨‹å®‰å…¨</p><p>åå¤„ï¼šæµªè´¹å†…å­˜ç©ºé—´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hungry</span> &#123;<br><span class="hljs-comment">//æ„é€ å™¨ç§æœ‰</span><br><span class="hljs-keyword">private</span> <span class="hljs-title function_">Hungry</span><span class="hljs-params">()</span> &#123;<br>&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Hungry</span> <span class="hljs-variable">hungry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hungry</span>();<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Hungry <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">return</span> hungry;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç®€å•çš„æµ‹è¯•ä¸‹ï¼Œå®ƒåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ˜¯å¦ä¼šäº§ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestHungry</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">8</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;<br>pool.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>System.out.println(Thread.currentThread().getName()+Hungry.getInstance());<br>&#125;<br>&#125;);<br>&#125;<br>pool.shutdown();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>pool-1-thread-8design.singleton.Hungry@fa49b1e<br>pool-1-thread-7design.singleton.Hungry@fa49b1e<br>pool-1-thread-8design.singleton.Hungry@fa49b1e<br>pool-1-thread-5design.singleton.Hungry@fa49b1e<br>pool-1-thread-1design.singleton.Hungry@fa49b1e</p><p>ç”±äºæ‰“å°æ•°æ®è¿‡å¤šï¼Œæˆ‘ä»¬åªæˆªå–ä¸€éƒ¨åˆ†ï¼Œå‘ç°ä»–ä»¬çš„hashcodeéƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¯´æ˜ä»–ä»¬éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹å¯¹è±¡</p><p>é‚£ä¸ºä»€ä¹ˆè¿™ç§æ–¹æ³•å°±èƒ½å®ç°çº¿ç¨‹å®‰å…¨å‘¢ï¼Ÿ</p><p>ç±»åŠ è½½çš„æ–¹å¼æ˜¯æŒ‰éœ€åŠ è½½ï¼Œä¸”åªåŠ è½½ä¸€æ¬¡ã€‚</p><p>å› æ­¤ï¼Œåœ¨ä¸Šè¿°å•ä¾‹ç±»è¢«åŠ è½½æ—¶ï¼Œå°±ä¼šå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡å¹¶äº¤ç»™è‡ªå·±çš„å¼•ç”¨ï¼Œä¾›ç³»ç»Ÿä½¿ç”¨ã€‚å•ä¾‹å°±æ˜¯è¯¥ç±»åªèƒ½è¿”å›ä¸€ä¸ªå®ä¾‹ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œåœ¨çº¿ç¨‹è®¿é—®å•ä¾‹å¯¹è±¡ä¹‹å‰å°±å·²ç»åˆ›å»ºå¥½äº†ã€‚å†åŠ ä¸Šï¼Œ<strong>ç”±äºä¸€ä¸ªç±»åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åªä¼šè¢«åŠ è½½ä¸€æ¬¡</strong>ï¼Œå› æ­¤è¯¥å•ä¾‹ç±»åªä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹æ¯æ¬¡éƒ½åªèƒ½ä¹Ÿå¿…å®šåªå¯ä»¥æ‹¿åˆ°è¿™ä¸ªå”¯ä¸€çš„å¯¹è±¡ã€‚å› æ­¤å°±è¯´ï¼Œé¥¿æ±‰å¼å•ä¾‹å¤©ç”Ÿå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h1 id="æ‡’æ±‰å¼"><a href="#æ‡’æ±‰å¼" class="headerlink" title="æ‡’æ±‰å¼"></a>æ‡’æ±‰å¼</h1><p>æ‡’æ±‰å¼ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å®ä¾‹åœ¨ç”¨åˆ°çš„æ—¶å€™æ‰å»åˆ›å»ºï¼Œâ€œæ¯”è¾ƒæ‡’â€ï¼Œç”¨çš„æ—¶å€™æ‰å»æ£€æŸ¥æœ‰æ²¡æœ‰å®ä¾‹ï¼Œå¦‚æœæœ‰åˆ™è¿”å›ï¼Œæ²¡æœ‰åˆ™æ–°å»ºã€‚æœ‰çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹ä¸å®‰å…¨ä¸¤ç§å†™æ³•ã€‚</p><h2 id="Lazy01"><a href="#Lazy01" class="headerlink" title="Lazy01"></a>Lazy01</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* æ‡’æ±‰å¼å•ä¾‹<span class="hljs-number">01</span><br>\* å•ä¾‹å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™è¿›è¡Œåˆ›å»ºï¼Œè¿™ä¸ªç±»æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">3</span>/<span class="hljs-number">16</span> <span class="hljs-number">12</span>:<span class="hljs-number">25</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Lazy01</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-title function_">Lazy01</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Lazy01</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Lazy01 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//å¤šä¸ªçº¿ç¨‹è°ƒç”¨ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤šä¸ªå¯¹è±¡</span><br><span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>)&#123;<br>instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Lazy01</span>();<br>&#125;<br><span class="hljs-keyword">return</span> instance;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡æµ‹è¯•ï¼Œå‘ç°å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ‹¿åˆ°å®ä¾‹çš„hashcodeæœ‰çš„æ˜¯ä¸ä¸€æ ·çš„ï¼Œå°±è¯´æ˜å®ƒå¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><h2 id="Lazy02"><a href="#Lazy02" class="headerlink" title="Lazy02"></a>Lazy02</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* å•ä¾‹å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™è¿›è¡Œåˆ›å»ºï¼Œè¿™ä¸ªç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯è¿™ä¸ªå†™æ³•ä¸æ¨è<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">3</span>/<span class="hljs-number">16</span> <span class="hljs-number">14</span>:<span class="hljs-number">59</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Lazy02</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-title function_">Lazy02</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Lazy02</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> Lazy02 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>)&#123;<br>instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Lazy02</span>();<br>&#125;<br><span class="hljs-keyword">return</span> instance;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨è·å–å®ä¾‹æ—¶ï¼Œè¯¥ç±»åœ¨æ–¹æ³•æ˜¯åŠ å…¥synchronizedä»¥ä¿è¯çº¿ç¨‹çš„æœ‰åºæ€§ï¼Œä½†synchronizedæ˜¯é‡é‡çº§é”ï¼Œæ•ˆç‡å¹¶ä¸é«˜ã€‚</p><h2 id="Lazy03"><a href="#Lazy03" class="headerlink" title="Lazy03"></a>Lazy03</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* æ‡’æ±‰æ¨¡å¼ï¼ˆåŒé‡é”åŒæ­¥é”å•ä¾‹æ¨¡å¼ï¼‰ï¼Œå•ä¾‹å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™è¿›è¡Œåˆ›å»ºï¼Œä½†æ˜¯ï¼Œ<br>\* è¿™ä¸ªç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ï¼ï¼ï¼ï¼<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">3</span>/<span class="hljs-number">16</span> <span class="hljs-number">15</span>:<span class="hljs-number">01</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Lazy03</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-title function_">Lazy03</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Lazy03</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-comment">//çº¿ç¨‹ä¸å®‰å…¨</span><br><span class="hljs-comment">//å½“æ‰§è¡Œinstance = new Lazy04();è¿™è¡Œä»£ç æ—¶ï¼ŒCPUä¼šæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š</span><br><span class="hljs-comment">//1.memory = allocate() åˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´</span><br><span class="hljs-comment">//2.ctorInstance() åˆå§‹åŒ–å¯¹è±¡</span><br><span class="hljs-comment">//3.instance = memory è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜</span><br><span class="hljs-comment">//å•çº¯æ‰§è¡Œä»¥ä¸Šä¸‰æ­¥æ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‘ç”ŸæŒ‡ä»¤é‡æ’åºã€‚</span><br><span class="hljs-comment">// æŒ‡ä»¤é‡æ’åºå¯¹å•çº¿ç¨‹æ²¡æœ‰å½±å“ï¼Œå•çº¿ç¨‹ä¸‹CPUå¯ä»¥æŒ‰ç…§é¡ºåºæ‰§è¡Œä»¥ä¸Šä¸‰ä¸ªæ­¥éª¤ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œå¦‚æœå‘ç”Ÿäº†æŒ‡ä»¤é‡æ’åºï¼Œåˆ™ä¼šæ‰“ä¹±ä¸Šé¢çš„ä¸‰ä¸ªæ­¥éª¤ã€‚</span><br><span class="hljs-comment">//å¦‚æœå‘ç”Ÿäº†JVMå’ŒCPUä¼˜åŒ–ï¼Œå‘ç”Ÿé‡æ’åºæ—¶ï¼Œå¯èƒ½ä¼šæŒ‰ç…§ä¸‹é¢çš„é¡ºåºæ‰§è¡Œï¼š</span><br><span class="hljs-comment">//1.memory = allocate() åˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´</span><br><span class="hljs-comment">//3.instance = memory è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜</span><br><span class="hljs-comment">//2.ctorInstance() åˆå§‹åŒ–å¯¹è±¡</span><br><span class="hljs-comment">//å‡è®¾ç›®å‰æœ‰ä¸¤ä¸ªçº¿ç¨‹Aå’ŒBåŒæ—¶æ‰§è¡ŒgetInstance()æ–¹æ³•ï¼ŒAçº¿ç¨‹æ‰§è¡Œåˆ°instance = new</span><br><span class="hljs-comment">//SingletonExample4(); Bçº¿ç¨‹åˆšæ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ª if (instance == null)&#123;å¤„ï¼Œ</span><br><span class="hljs-comment">//å¦‚æœæŒ‰ç…§1.3.2çš„é¡ºåºï¼Œå‡è®¾çº¿ç¨‹Aæ‰§è¡Œåˆ°3.instance = memory è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…</span><br><span class="hljs-comment">//å­˜ï¼Œæ­¤æ—¶ï¼Œçº¿ç¨‹Båˆ¤æ–­instanceå·²ç»æœ‰å€¼ï¼Œå°±ä¼šç›´æ¥return instance;</span><br><span class="hljs-comment">//è€Œå®é™…ä¸Šï¼Œçº¿ç¨‹Aè¿˜æœªæ‰§è¡Œ2.ctorInstance() åˆå§‹åŒ–å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹Bæ‹¿åˆ°çš„instanceå¯¹è±¡</span><br><span class="hljs-comment">// è¿˜æœªè¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™ä¸ªæœªåˆå§‹åŒ–çš„instanceå¯¹è±¡ä¸€æ—¦è¢«çº¿ç¨‹Bä½¿ç”¨ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Lazy03 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>)&#123;<br><span class="hljs-keyword">synchronized</span> (Lazy03.class)&#123;<br><span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>)&#123;<br>instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Lazy03</span>();<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> instance;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨é‡Šè¯´çš„å¾ˆè¯¦ç»†äº†ï¼Œå°±æ˜¯ç”±äºæŒ‡ä»¤çš„é‡æ’ï¼Œç…§æˆä»£ç æ‰§è¡Œé¡ºåºçš„ä¸ä¸€è‡´ï¼Œå¯èƒ½æœªåˆå§‹åŒ–å–è¿”å›ç»™éœ€è¦å®ä¾‹çš„ç±»ï¼Œå°±ä¼šé€ æˆå®‰å…¨é—®é¢˜ã€‚</p><p>æŒ‡ä»¤é‡æ’ä¼šå‘ç”Ÿåœ¨ç¼–è¯‘å™¨æˆ–æŒ‡ä»¤å¹¶è¡Œæˆ–è€…æ“ä½œç³»ç»Ÿä¸­ï¼Œè™½ç„¶è¿™ä¸ªæ¦‚ç‡å¾ˆå°ï¼Œä½†å¹¶ä¸ä¸èƒ½è¯´è¯¥å•ä¾‹æ¨¡å¼æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>Javaä¸­æœ‰Volatileå…³é”®å­—ï¼Œå°±å¯ä»¥ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œå…·ä½“åŸå› ï¼Œæ˜¯æ“ä½œç³»ç»Ÿçš„çŸ¥è¯†äº†ï¼ˆæœ¬èœé¸Ÿç°åœ¨ä¹Ÿæ²¡å­¦ï¼‰ï¼Œä»¥åå†æ·±ç©¶ã€‚</p><h2 id="Lazy04"><a href="#Lazy04" class="headerlink" title="Lazy04"></a>Lazy04</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* ï¼ˆåŒé‡é”åŒæ­¥é”å•ä¾‹æ¨¡å¼ï¼‰å•ä¾‹å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™è¿›è¡Œåˆ›å»ºï¼Œè¿™ä¸ªç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½¿<br>\* ç”¨çš„æ˜¯ <span class="hljs-keyword">volatile</span> + åŒé‡æ£€æµ‹æœºåˆ¶æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’è¾¾åˆ°çº¿ç¨‹å®‰å…¨<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">3</span>/<span class="hljs-number">16</span> <span class="hljs-number">15</span>:<span class="hljs-number">07</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Lazy04</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-title function_">Lazy04</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Lazy05</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Lazy04 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>)&#123;<br><span class="hljs-keyword">synchronized</span> (Lazy04.class)&#123;<br><span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>)&#123;<br>instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Lazy05</span>();<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> instance;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŠ å…¥valitileï¼Œç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œå®ç°çº¿ç¨‹å®‰å…¨ï¼</p><h2 id="Lazy05"><a href="#Lazy05" class="headerlink" title="Lazy05"></a>Lazy05</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* å•ä¾‹å®ä¾‹åœ¨ç±»è£…è½½çš„æ—¶å€™ï¼ˆä½¿ç”¨é™æ€ä»£ç å—ï¼‰è¿›è¡Œåˆ›å»ºï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">3</span>/<span class="hljs-number">16</span> <span class="hljs-number">15</span>:09<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Lazy05</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-title function_">Lazy05</span> <span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Lazy05</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">static</span> &#123;<br>instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Lazy05</span>();<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Lazy05 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">return</span> instance;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é™æ€ä»£ç å—ï¼Œåœ¨é¡¹ç›®è¿è¡Œæ—¶åªåŠ è½½ä¸€æ¬¡ï¼Œå¯èƒ½å’Œé¥¿æ±‰å¼æœ‰ç‚¹åƒï¼Œéƒ½æ˜¯å€ŸåŠ©ç±»åŠ è½½åªä¼šåŠ è½½ä¸€æ¬¡çš„ç‰¹ç‚¹ã€‚</p><h2 id="Lazy06"><a href="#Lazy06" class="headerlink" title="Lazy06"></a>Lazy06</h2><p>ä»¥ä¸Šåœ¨æ‡’æ±‰å•ä¾‹æ¨¡å¼ä¸­å®ç°äº†çº¿ç¨‹å®‰å…¨ï¼Œä½†éƒ½ä¼šè¢«ä¸‡æ¶ä¹‹æºåå°„ç»™æ”»ç ´ï¼Œæ‰€ä»¥å¼•å…¥æšä¸¾æ¥å®ç°æœ€ç»ˆçš„å•ä¾‹æ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* æšä¸¾æ–¹å¼è¿›è¡Œå®ä¾‹åŒ–ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ­¤ç§æ–¹å¼ä¹Ÿæ˜¯çº¿ç¨‹æœ€å®‰å…¨çš„<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">3</span>/<span class="hljs-number">16</span> <span class="hljs-number">15</span>:<span class="hljs-number">11</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Lazy06</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-title function_">Lazy06</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Lazy06 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">return</span> Lazy.INSTANCE.getInstance();<br>&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Lazy</span>&#123;<br>INSTANCE;<br><span class="hljs-keyword">private</span> Lazy06 singleton;<br><span class="hljs-comment">//JVMä¿è¯è¿™ä¸ªæ–¹æ³•åªä¼šè¢«è°ƒä¸€æ¬¡</span><br>Lazy()&#123; <span class="hljs-comment">//æ„é€ æ–¹æ³•ç§æœ‰</span><br>singleton = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Lazy06</span>();<br>&#125;<br><span class="hljs-keyword">public</span> Lazy06 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">return</span> singleton;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…·ä½“ä¸ºä»€ä¹ˆèƒ½å®ç°é¿å…åå°„çš„é—®é¢˜ï¼Œä¸‹é¢çš„åšæ–‡è®²çš„å¾ˆå¥½ï¼š</p><p><a href="https://www.cnblogs.com/chiclee/p/9097772.html">ä¸ºä»€ä¹ˆè¦ç”¨æšä¸¾å®ç°å•ä¾‹æ¨¡å¼ï¼ˆé¿å…åå°„ã€åºåˆ—åŒ–é—®é¢˜ï¼‰</a></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨å†™é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„æ—¶å€™ï¼Œæˆ‘å»ºè®®å¯ä»¥å†™Lazy04å’ŒLazy06ï¼Œå‰è€…åŒé‡æ£€æµ‹+volatileï¼Œåè€…æ˜¯JDK5å¼•å…¥æšä¸¾åå†™å•ä¾‹çš„æ–¹å¼ï¼Œéƒ½éœ€è¦æŒæ¡ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HashMapæºç åˆ†æ</title>
    <link href="/2021/03/04/HashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <url>/2021/03/04/HashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="1-HashMapä»‹ç»"><a href="#1-HashMapä»‹ç»" class="headerlink" title="1.HashMapä»‹ç»"></a>1.HashMapä»‹ç»</h1><h2 id="1-1-HashMapåº•å±‚å­˜å‚¨ç»“æ„"><a href="#1-1-HashMapåº•å±‚å­˜å‚¨ç»“æ„" class="headerlink" title="1.1 HashMapåº•å±‚å­˜å‚¨ç»“æ„"></a>1.1 HashMapåº•å±‚å­˜å‚¨ç»“æ„</h2><blockquote><p>HashMapæœ€æ—©å‡ºç°åœ¨JDK1.2ä¸­ï¼Œåº•å±‚åŸºäºæ•£åˆ—ç®—æ³•å®ç°ã€‚HashMap å…è®¸ null é”®å’Œ null å€¼ï¼Œæ˜¯éçº¿ç¨‹å®‰å…¨ç±»ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½ä¼šå­˜åœ¨é—®é¢˜ã€‚</p></blockquote><p>1.8ç‰ˆæœ¬çš„HashMapåº•å±‚å­˜å‚¨ç»“æ„ï¼š</p><p>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</p><p><img src="https://i.loli.net/2021/03/04/Yo9vtBKTcAbWmwx.png"></p><h2 id="1-2-HashMapç±»çš„å®šä¹‰"><a href="#1-2-HashMapç±»çš„å®šä¹‰" class="headerlink" title="1.2 HashMapç±»çš„å®šä¹‰"></a>1.2 HashMapç±»çš„å®šä¹‰</h2><p>å…ˆæ¥çœ‹çœ‹HashMapç±»çš„å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashMap</span>&lt;K,V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMap</span>&lt;K,V&gt;<br><span class="hljs-keyword">implements</span> <span class="hljs-title class_">Map</span>&lt;K,V&gt;, Cloneable, Serializable &#123;<br></code></pre></td></tr></table></figure><p>ä»ä¸­æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼š</p><ul><li><p><code>HashMap&lt;K,V&gt;</code>ï¼š<code>HashMap</code>æ˜¯ä»¥<code>key-value</code>å½¢å¼å­˜å‚¨æ•°æ®çš„ã€‚</p></li><li><p><code>extends AbstractMap&lt;K,V&gt;</code>ï¼šç»§æ‰¿äº†<code>AbstractMap</code>ï¼Œå¤§å¤§å‡å°‘äº†å®ç°Mapæ¥å£æ—¶éœ€è¦çš„å·¥ä½œé‡ã€‚</p></li><li><p><code>implements Map&lt;K,V&gt;</code>ï¼šå®ç°äº†<code>Map</code>ï¼Œæä¾›äº†æ‰€æœ‰å¯é€‰çš„<code>Map</code>æ“ä½œã€‚</p></li><li><p><code>implements Cloneable</code>ï¼šè¡¨æ˜å…¶å¯ä»¥è°ƒç”¨<code>clone()</code>æ–¹æ³•æ¥è¿”å›å®ä¾‹çš„<code>field-for-field</code>æ‹·è´ã€‚</p></li><li><p><code>implements Serializable</code>ï¼šè¡¨æ˜è¯¥ç±»æ˜¯å¯ä»¥åºåˆ—åŒ–çš„ã€‚</p><p>â€‹</p></li></ul><p><img src="https://i.loli.net/2021/03/04/FUn6KCZqD2OBdwx.png"></p><h2 id="1-3-put-æ•°æ®åŸç†åˆ†æ"><a href="#1-3-put-æ•°æ®åŸç†åˆ†æ" class="headerlink" title="1.3 put()æ•°æ®åŸç†åˆ†æ"></a>1.3 put()æ•°æ®åŸç†åˆ†æ</h2><p><img src="https://i.loli.net/2021/03/04/XK9mWsMO87aFgdS.png"></p><h2 id="1-4å¸¸è§åè¯è§£é‡Š"><a href="#1-4å¸¸è§åè¯è§£é‡Š" class="headerlink" title="1.4å¸¸è§åè¯è§£é‡Š"></a>1.4å¸¸è§åè¯è§£é‡Š</h2><ol><li><p>hashmapçš„åº•å±‚æ•°æ®ç»“æ„åä¸ºtableçš„æ•°ç»„ï¼Œæ˜¯ä¸€ä¸ªNodeæ•°ç»„</p></li><li><p>tableæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªNodeå…ƒç´ ï¼ˆä½†æ˜¯è¿™ä¸ªNodeå…ƒç´ å¯èƒ½æŒ‡å‘ä¸‹ä¸€ä¸ªNodeå…ƒç´ ä»è€Œå½¢æˆé“¾è¡¨ï¼‰ï¼Œtableæ•°ç»„çš„æ¯ä¸ªä½ç½®ç§°ä¸ºæ¡¶ï¼Œæ¯”å¦‚talbe[0] ç§°ä¸ºä¸€ä¸ªæ¡¶ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºä¸€ä¸ªbin</p><p>â€‹</p></li></ol><h1 id="2-æºç "><a href="#2-æºç " class="headerlink" title="2.æºç "></a>2.æºç </h1><h2 id="2-1-æ ¸å¿ƒå±æ€§åˆ†æ"><a href="#2-1-æ ¸å¿ƒå±æ€§åˆ†æ" class="headerlink" title="2.1 æ ¸å¿ƒå±æ€§åˆ†æ"></a>2.1 æ ¸å¿ƒå±æ€§åˆ†æ</h2><p><strong>é™æ€å¸¸é‡</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* The <span class="hljs-keyword">default</span> initial capacity - MUST be a power of two.<br>\* é»˜è®¤çš„åˆå§‹å®¹é‡ï¼Œå¿…é¡»æ˜¯äºŒçš„æ¬¡æ–¹<br>\*/<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> DEFAULT\_INITIAL\_CAPACITY = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">4</span>; <span class="hljs-comment">// aka 16</span><br>/\*\*<br>\* The maximum capacity, used <span class="hljs-keyword">if</span> a higher value is implicitly specified<br>\* by either of the constructors with arguments.<br>\* MUST be a power of two &lt;= <span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">30.</span><br>\*<br>\* æœ€å¤§å®¹é‡ï¼Œå½“é€šè¿‡æ„é€ å‡½æ•°éšå¼æŒ‡å®šäº†ä¸€ä¸ªå¤§äºMAXIMUM\_CAPACITYçš„æ—¶å€™ä½¿ç”¨<br>\*/<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> MAXIMUM\_CAPACITY = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>;<br>/\*\*<br>\* The load factor used <span class="hljs-keyword">when</span> none specified in constructor.<br>\* åŠ è½½å› å­ï¼Œå½“æ„é€ å‡½æ•°æ²¡æœ‰æŒ‡å®šåŠ è½½å› å­çš„æ—¶å€™çš„é»˜è®¤å€¼çš„æ—¶å€™ä½¿ç”¨<br>\*/<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> DEFAULT\_LOAD\_FACTOR = <span class="hljs-number">0.75f</span>;<br>/\*\*<br>\* The bin count threshold <span class="hljs-keyword">for</span> using a tree rather than list <span class="hljs-keyword">for</span> a<br>\* bin. Bins are converted to trees <span class="hljs-keyword">when</span> adding an element to a<br>\* bin with at least <span class="hljs-built_in">this</span> many nodes. The value must be greater<br>\* than <span class="hljs-number">2</span> and should be at least <span class="hljs-number">8</span> to mesh with assumptions in<br>\* tree removal about conversion back to plain bins upon<br>\* shrinkage.<br>\*<br>\* TREEIFY\_THRESHOLDä¸ºå½“ä¸€ä¸ªbinä»listè½¬åŒ–ä¸ºtreeçš„é˜ˆå€¼ï¼Œå½“ä¸€ä¸ªbinä¸­å…ƒç´ çš„æ€»å…ƒç´ æœ€ä½è¶…è¿‡è¿™ä¸ªå€¼çš„æ—¶å€™ï¼Œbinæ‰è¢«è½¬åŒ–ä¸ºtreeï¼›<br>\* ä¸ºäº†æ»¡è¶³è½¬åŒ–ä¸ºç®€å•binæ—¶çš„è¦æ±‚ï¼ŒTREEIFY\_THRESHOLDå¿…é¡»æ¯”<span class="hljs-number">2</span>å¤§è€Œä¸”æ¯”<span class="hljs-number">8</span>è¦å°<br>\*/<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> TREEIFY\_THRESHOLD = <span class="hljs-number">8</span>;<br>/\*\*<br>\* The bin count threshold <span class="hljs-keyword">for</span> untreeifying <span class="hljs-title function_">a</span> <span class="hljs-params">(split)</span> bin during a<br>\* resize operation. Should be less than TREEIFY\_THRESHOLD, and at<br>\* most <span class="hljs-number">6</span> to mesh with shrinkage detection under removal.<br>\*<br>\* binåtreeåŒ–æ—¶çš„æœ€å¤§å€¼ï¼Œåº”è¯¥æ¯”TREEIFY\_THRESHOLDè¦å°ï¼Œ<br>\* ä¸ºäº†åœ¨ç§»é™¤å…ƒç´ çš„æ—¶å€™èƒ½æ£€æµ‹åˆ°ç§»é™¤åŠ¨ä½œï¼ŒUNTREEIFY\_THRESHOLDå¿…é¡»è‡³å°‘ä¸º<span class="hljs-number">6</span><br>\*/<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> UNTREEIFY\_THRESHOLD = <span class="hljs-number">6</span>;<br>/\*\*<br>\* The smallest table capacity <span class="hljs-keyword">for</span> which bins may be treeified.<br>\* (Otherwise the table is resized <span class="hljs-keyword">if</span> too many nodes in a bin.)<br>\* Should be at least <span class="hljs-number">4</span> \* TREEIFY\_THRESHOLD to avoid conflicts<br>\* between resizing and treeification thresholds.<br>\*<br>\* æ ‘åŒ–çš„å¦å¤–ä¸€ä¸ªé˜ˆå€¼ï¼Œtableçš„é•¿åº¦(æ³¨æ„ä¸æ˜¯binçš„é•¿åº¦)çš„æœ€å°å¾—ä¸º<span class="hljs-number">64</span>ã€‚ä¸ºäº†é¿å…æ‰©å®¹å’Œæ ‘å‹ç»“æ„åŒ–é˜ˆå€¼ä¹‹é—´çš„å†²çªï¼ŒMIN\_TREEIFY\_CAPACITY åº”è¯¥æœ€å°æ˜¯ <span class="hljs-number">4</span> \* TREEIFY\_THRESHOLD<br>\*/<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> MIN\_TREEIFY\_CAPACITY = <span class="hljs-number">64</span>;<br></code></pre></td></tr></table></figure><p>æˆå‘˜å˜é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* The table, initialized on first use, and resized as<br>\* necessary. When allocated, length is always a power of two.<br>\* (We also tolerate length zero in some operations to allow<br>\* bootstrapping mechanics that are currently not needed.)<br>\*<br>\* tableï¼Œç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨çš„æ—¶å€™æ‰è¿›è¡ŒåŠ è½½<br>\*/<br><span class="hljs-keyword">transient</span> Node&lt;K,V&gt;[] table;<br>/\*\*<br>\* Holds cached <span class="hljs-title function_">entrySet</span><span class="hljs-params">()</span>. Note that AbstractMap fields are used<br>\* <span class="hljs-keyword">for</span> <span class="hljs-title function_">keySet</span><span class="hljs-params">()</span> and <span class="hljs-title function_">values</span><span class="hljs-params">()</span>.<br>\* é”®å€¼å¯¹ç¼“å­˜ï¼Œå®ƒä»¬çš„æ˜ å°„å…³ç³»é›†åˆä¿å­˜åœ¨entrySetä¸­ã€‚å³ä½¿Keyåœ¨å¤–éƒ¨ä¿®æ”¹å¯¼è‡´hashCodeå˜åŒ–ï¼Œç¼“å­˜ä¸­è¿˜å¯ä»¥æ‰¾åˆ°æ˜ å°„å…³ç³»<br>\*/<br><span class="hljs-keyword">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;<br>/\*\*<br>\* The number of key-value mappings contained in <span class="hljs-built_in">this</span> map.<br>\* tableä¸­ key-value å…ƒç´ çš„ä¸ªæ•°<br>\*/<br><span class="hljs-keyword">transient</span> <span class="hljs-type">int</span> size;<br>/\*\*<br>\* The number of times <span class="hljs-built_in">this</span> HashMap has been structurally modified<br>\* Structural modifications are those that change the number of mappings in<br>\* the HashMap or otherwise modify its internal <span class="hljs-title function_">structure</span> <span class="hljs-params">(e.g.,</span><br><span class="hljs-params">\* rehash)</span>. This field is used to make iterators on Collection-views of<br>\* the HashMap fail-fast. (See ConcurrentModificationException).<br>\*<br>\* HashMapåœ¨ç»“æ„ä¸Šè¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œç»“æ„ä¸Šè¢«ä¿®æ”¹æ˜¯æŒ‡é‚£äº›æ”¹å˜HashMapä¸­æ˜ å°„çš„æ•°é‡æˆ–è€…ä»¥å…¶ä»–æ–¹å¼ä¿®æ”¹å…¶å†…éƒ¨ç»“æ„çš„æ¬¡æ•°ï¼ˆä¾‹å¦‚ï¼Œrehashï¼‰ã€‚<br>\* æ­¤å­—æ®µç”¨äºä½¿HashMapé›†åˆè§†å›¾ä¸Šçš„è¿­ä»£å™¨å¿«é€Ÿå¤±è´¥ã€‚<br>\*/<br><span class="hljs-keyword">transient</span> <span class="hljs-type">int</span> modCount;<br>/\*\*<br>\* The next size value at which to <span class="hljs-title function_">resize</span> <span class="hljs-params">(capacity \* load factor)</span>.<br>\*<br>\* ä¸‹ä¸€æ¬¡resizeæ‰©å®¹é˜ˆå€¼ï¼Œå½“å‰tableä¸­çš„å…ƒç´ è¶…è¿‡æ­¤å€¼æ—¶ï¼Œè§¦å‘æ‰©å®¹<br>\* threshold = capacity \* load factor<br>\* <span class="hljs-meta">@serial</span><br>\*/<br><span class="hljs-comment">// (The javadoc description is true upon serialization.</span><br><span class="hljs-comment">// Additionally, if the table array has not been allocated, this</span><br><span class="hljs-comment">// field holds the initial array capacity, or zero signifying</span><br><span class="hljs-comment">// DEFAULT\_INITIAL\_CAPACITY.ï¼ˆ???????ï¼‰)</span><br><span class="hljs-type">int</span> threshold;<br>/\*\*<br>\* The load factor <span class="hljs-keyword">for</span> the hash table.<br>\* è´Ÿè½½å› å­<br>\* <span class="hljs-meta">@serial</span><br>\*/<br><span class="hljs-keyword">final</span> <span class="hljs-type">float</span> loadFactor;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè®²ä¸‹è´Ÿè½½å› å­ï¼š</p><blockquote><p>å¯¹äº HashMap æ¥è¯´ï¼Œè´Ÿè½½å› å­æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å‚æ•°ï¼Œè¯¥å‚æ•°ååº”äº† HashMap æ¡¶æ•°ç»„çš„ä½¿ç”¨æƒ…å†µã€‚é€šè¿‡è°ƒèŠ‚è´Ÿè½½å› å­ï¼Œå¯ä½¿ HashMap æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦ä¸Šæœ‰ä¸åŒçš„è¡¨ç°ã€‚</p></blockquote><p>å½“æˆ‘ä»¬è°ƒä½è´Ÿè½½å› å­æ—¶ï¼ŒHashMap æ‰€èƒ½å®¹çº³çš„é”®å€¼å¯¹æ•°é‡å˜å°‘ã€‚æ‰©å®¹æ—¶ï¼Œé‡æ–°å°†é”®å€¼å¯¹å­˜å‚¨æ–°çš„æ¡¶æ•°ç»„é‡Œï¼Œé”®çš„é”®ä¹‹é—´äº§ç”Ÿçš„ç¢°æ’ä¼šä¸‹é™ï¼Œé“¾è¡¨é•¿åº¦å˜çŸ­ã€‚æ­¤æ—¶ï¼ŒHashMap çš„å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œçš„æ•ˆç‡å°†ä¼šå˜é«˜ï¼Œè¿™é‡Œæ˜¯å…¸å‹çš„æ‹¿ç©ºé—´æ¢æ—¶é—´ã€‚</p><p>ç›¸åï¼Œå¦‚æœå¢åŠ è´Ÿè½½å› å­ï¼ˆè´Ÿè½½å› å­å¯ä»¥å¤§äº1ï¼‰ï¼ŒHashMap æ‰€èƒ½å®¹çº³çš„é”®å€¼å¯¹æ•°é‡å˜å¤šï¼Œç©ºé—´åˆ©ç”¨ç‡é«˜ï¼Œä½†ç¢°æ’ç‡ä¹Ÿé«˜ã€‚è¿™æ„å‘³ç€é“¾è¡¨é•¿åº¦å˜é•¿ï¼Œæ•ˆç‡ä¹Ÿéšä¹‹é™ä½ï¼Œè¿™ç§æƒ…å†µæ˜¯æ‹¿æ—¶é—´æ¢ç©ºé—´ã€‚è‡³äºè´Ÿè½½å› å­æ€ä¹ˆè°ƒèŠ‚ï¼Œè¿™ä¸ªçœ‹ä½¿ç”¨åœºæ™¯äº†ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨é»˜è®¤å€¼å°±å¯ä»¥äº†ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹0.75åœ¨æ—¶é—´è·Ÿç©ºé—´ä»£ä»·ä¸Šè¾¾åˆ°äº†å¹³è¡¡æ‰€ä»¥ä¸å»ºè®®ä¿®æ”¹ã€‚</p><h2 id="2-2-æ„é€ æ–¹æ³•åˆ†æ"><a href="#2-2-æ„é€ æ–¹æ³•åˆ†æ" class="headerlink" title="2.2 æ„é€ æ–¹æ³•åˆ†æ"></a>2.2 æ„é€ æ–¹æ³•åˆ†æ</h2><p>åªçœ‹æ„é€ æ–¹æ³•ä¸­å‚æ•°æœ€å¤šçš„ä¸€ä¸ªå³å¯ï¼Œå…¶ä»–çš„éƒ½æ˜¯è°ƒç”¨è¿™ä¸ªæ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">HashMap</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity, <span class="hljs-type">float</span> loadFactor)</span> &#123;<br><span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">0</span>)<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Illegal initial capacity: &quot;</span> +<br>initialCapacity);<br><span class="hljs-keyword">if</span> (initialCapacity &gt; MAXIMUM\_CAPACITY)<br>initialCapacity = MAXIMUM\_CAPACITY;<br><span class="hljs-keyword">if</span> (loadFactor &lt;= <span class="hljs-number">0</span> || Float.isNaN(loadFactor))<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Illegal load factor: &quot;</span> +<br>loadFactor);<br><span class="hljs-built_in">this</span>.loadFactor = loadFactor;<br><span class="hljs-built_in">this</span>.threshold = tableSizeFor(initialCapacity);<br>&#125;<br>/\*\*<br>\* Returns a power of two size <span class="hljs-keyword">for</span> the given target capacity.<br>\*<br>\* <span class="hljs-number">1.</span>è¿”å›ä¸€ä¸ªå¤§äºç­‰äºå½“å‰å€¼capçš„ä¸€ä¸ªçš„æ•°å­—ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°å­—ä¸€å®šæ˜¯<span class="hljs-number">2</span>çš„æ¬¡æ–¹æ•°<br>\* å‡å¦‚capä¸º<span class="hljs-number">10</span>ï¼Œé‚£ä¹ˆn= <span class="hljs-number">9</span> = <span class="hljs-number">0b1001</span><br>\* <span class="hljs-number">0b1001</span> | <span class="hljs-number">0b0100</span> = <span class="hljs-number">0b1101</span><br>\* <span class="hljs-number">0b1101</span> | <span class="hljs-number">0b0011</span> = <span class="hljs-number">0b1111</span><br>\* <span class="hljs-number">0b1111</span> | <span class="hljs-number">0b0011</span> = <span class="hljs-number">0b1111</span><br>\* ......<br>\* .....<br>\* n = <span class="hljs-number">0b1111</span> = <span class="hljs-number">15</span><br>\*<br>\* <span class="hljs-number">2.</span>è¿™é‡Œçš„capå¿…é¡»è¦å‡<span class="hljs-number">1</span>ï¼Œå¦‚æœä¸å‡ï¼Œå¹¶ä¸”å¦‚æœä¼ å…¥çš„capä¸º<span class="hljs-number">16</span>ï¼Œé‚£ä¹ˆç®—å‡ºæ¥çš„å€¼ä¸º<span class="hljs-number">32</span><br>\*<br>\* <span class="hljs-number">3.</span>è¿™ä¸ªæ–¹æ³•å°±æ˜¯ä¸ºäº†æŠŠæœ€é«˜ä½<span class="hljs-number">1</span>çš„åé¢éƒ½å˜ä¸º<span class="hljs-number">1</span><br>\* <span class="hljs-number">0001</span> <span class="hljs-number">1101</span> <span class="hljs-number">1100</span> -&gt; <span class="hljs-number">0001</span> <span class="hljs-number">1111</span> <span class="hljs-number">1111</span> -&gt; +<span class="hljs-number">1</span> -&gt; <span class="hljs-number">0010</span> <span class="hljs-number">1111</span> <span class="hljs-number">1111</span><br>\*/<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">tableSizeFor</span><span class="hljs-params">(<span class="hljs-type">int</span> cap)</span> &#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> cap - <span class="hljs-number">1</span>;<br>n |= n &gt;&gt;&gt; <span class="hljs-number">1</span>;<br>n |= n &gt;&gt;&gt; <span class="hljs-number">2</span>;<br>n |= n &gt;&gt;&gt; <span class="hljs-number">4</span>;<br>n |= n &gt;&gt;&gt; <span class="hljs-number">8</span>;<br>n |= n &gt;&gt;&gt; <span class="hljs-number">16</span>;<br><span class="hljs-keyword">return</span> (n &lt; <span class="hljs-number">0</span>) ? <span class="hljs-number">1</span> : (n &gt;= MAXIMUM\_CAPACITY) ? MAXIMUM\_CAPACITY : n + <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-3-putæ–¹æ³•åˆ†æ"><a href="#2-3-putæ–¹æ³•åˆ†æ" class="headerlink" title="2.3 putæ–¹æ³•åˆ†æ"></a>2.3 putæ–¹æ³•åˆ†æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-meta">@param</span> key key with which the specified value is to be associated<br>\* <span class="hljs-meta">@param</span> value value to be associated with the specified key<br>\* <span class="hljs-meta">@return</span> the previous value associated with key, or<br>\* <span class="hljs-literal">null</span> <span class="hljs-keyword">if</span> there was no mapping <span class="hljs-keyword">for</span> key.<br>\* (A <span class="hljs-literal">null</span> <span class="hljs-keyword">return</span> can also indicate that the map<br>\* previously associated <span class="hljs-literal">null</span> with key.)<br>\* è¿”å›å…ˆå‰keyå¯¹åº”çš„valueå€¼ï¼ˆå¦‚æœvalueä¸º<span class="hljs-literal">null</span>ï¼Œä¹Ÿè¿”å›<span class="hljs-literal">null</span>ï¼‰ï¼Œå¦‚æœå…ˆå‰ä¸å­˜åœ¨è¿™ä¸ªkeyï¼Œé‚£ä¹ˆè¿”å›çš„å°±æ˜¯<span class="hljs-literal">null</span>ï¼›<br>\*/<br><span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> &#123;<br><span class="hljs-keyword">return</span> putVal(hash(key), key, value, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);<br>&#125;<br>/<br>\* åœ¨å¾€haspmapä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œç”±å…ƒç´ çš„hashcodeç»è¿‡ä¸€ä¸ªæ‰°åŠ¨å‡½æ•°ä¹‹åå†ä¸tableçš„é•¿åº¦è¿›è¡Œä¸è¿ç®—æ‰æ‰¾åˆ°æ’å…¥ä½ç½®ï¼Œä¸‹é¢çš„è¿™ä¸ªhash()æ–¹æ³•å°±æ˜¯æ‰€è°“çš„æ‰°åŠ¨å‡½æ•°<br>\* ä½œç”¨ï¼šè®©keyçš„hashCodeå€¼çš„é«˜<span class="hljs-number">16</span>ä½å‚ä¸è¿ç®—,hash()æ–¹æ³•è¿”å›çš„å€¼çš„ä½åå…­ä½æ˜¯æœ‰hashCodeçš„é«˜ä½<span class="hljs-number">16</span>ä½å…±åŒçš„ç‰¹å¾çš„<br>\* ä¸¾ä¾‹<br>\* hashCode = 0b <span class="hljs-number">0010</span> <span class="hljs-number">0101</span> <span class="hljs-number">1010</span> <span class="hljs-number">1100</span> <span class="hljs-number">0011</span> <span class="hljs-number">1111</span> <span class="hljs-number">0010</span> <span class="hljs-number">1110</span><br>\*<br>\* 0b <span class="hljs-number">0010</span> <span class="hljs-number">0101</span> <span class="hljs-number">1010</span> <span class="hljs-number">1100</span> <span class="hljs-number">0011</span> <span class="hljs-number">1111</span> <span class="hljs-number">0010</span> <span class="hljs-number">1110</span> ^<br>\* 0b <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0000</span> <span class="hljs-number">0010</span> <span class="hljs-number">0101</span> <span class="hljs-number">1010</span> <span class="hljs-number">1100</span><br>\* 0b <span class="hljs-number">0010</span> <span class="hljs-number">0101</span> <span class="hljs-number">1010</span> <span class="hljs-number">1100</span> <span class="hljs-number">0001</span> <span class="hljs-number">1010</span> <span class="hljs-number">1000</span> <span class="hljs-number">0010</span><br>\*/<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(Object key)</span> &#123;<br><span class="hljs-type">int</span> h;<br><span class="hljs-keyword">return</span> (key == <span class="hljs-literal">null</span>) ? <span class="hljs-number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="hljs-number">16</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>è®©é«˜16ä½å‚ä¸è¿ç®—çš„åŸå› ï¼Œè¯´æ˜ä¸€ä¸‹ï¼šå½“æ•°ç»„çš„é•¿åº¦å¾ˆçŸ­æ—¶ï¼Œåªæœ‰ä½ä½æ•°çš„hashcodeå€¼èƒ½å‚ä¸è¿ç®—ã€‚è€Œè®©é«˜16ä½å‚ä¸è¿ç®—å¯ä»¥æ›´å¥½çš„å‡åŒ€æ•£åˆ—ï¼Œå‡å°‘ç¢°æ’ï¼Œè¿›ä¸€æ­¥é™ä½hashå†²çªçš„å‡ ç‡ã€‚å¹¶ä¸”ä½¿å¾—é«˜16ä½å’Œä½16ä½çš„ä¿¡æ¯éƒ½è¢«ä¿ç•™äº†ã€‚<br>ç„¶åæœ‰ä¸å°‘åšå®¢æåˆ°äº†å› ä¸ºintæ˜¯4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å³ç§»16ä½ã€‚åŸå› å¤§å®¶å¯ä»¥æ‰“å¼€hashmapçš„æºç ï¼Œæ‰¾åˆ°hashæ–¹æ³•ï¼ŒæŒ‰ä½ctrlç‚¹å‡»æ–¹æ³•é‡Œçš„hashcodeï¼Œè·³è½¬åˆ°Objectç±»ï¼Œç„¶åå¯ä»¥çœ‹åˆ°hashcodeçš„æ•°æ®ç±»å‹æ˜¯intã€‚intä¸º4ä¸ªå­—èŠ‚ï¼Œ1ä¸ªå­—èŠ‚8ä¸ªæ¯”ç‰¹ä½ï¼Œå°±æ˜¯32ä¸ªæ¯”ç‰¹ä½ï¼Œæ‰€ä»¥16å¾ˆå¯èƒ½æ˜¯å› ä¸º32å¯¹åŠçš„ç»“æœï¼Œä¹Ÿå°±æ˜¯è®©é«˜çš„é‚£ä¸€åŠä¹Ÿæ¥å‚ä¸è¿ç®—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> V <span class="hljs-title function_">putVal</span><span class="hljs-params">(<span class="hljs-type">int</span> hash, K key, V value, <span class="hljs-type">boolean</span> onlyIfAbsent,</span><br><span class="hljs-params"><span class="hljs-type">boolean</span> evict)</span> &#123;<br><span class="hljs-comment">// tabè¡¨ç¤ºå½“å‰hashmapçš„table</span><br><span class="hljs-comment">// pè¡¨ç¤ºtableçš„å…ƒç´ </span><br><span class="hljs-comment">// nè¡¨ç¤ºæ•£åˆ—è¡¨çš„é•¿åº¦</span><br><span class="hljs-comment">// iè¡¨ç¤ºè·¯ç”±å¯»å€ç»“æœ</span><br>Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="hljs-type">int</span> n, i;<br><span class="hljs-comment">// å»¶è¿Ÿåˆå§‹åŒ–é€»è¾‘ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨putval()æ–¹æ³•çš„æ—¶å€™æ‰è¿›è¡Œåˆå§‹åŒ–hashmapä¸­æœ€è€—å†…å­˜çš„talbe</span><br><span class="hljs-keyword">if</span> ((tab = table) == <span class="hljs-literal">null</span> || (n = tab.length) == <span class="hljs-number">0</span>)<br>n = (tab = resize()).length;<br><span class="hljs-comment">// 1.æœ€ç®€å•çš„ä¸€ç§æƒ…å†µï¼Œå¯»æ‰¾åˆ°çš„æ¡¶ä½ï¼Œåˆšå¥½æ˜¯nullï¼Œè¿™ä¸ªæ—¶å€™ç›´æ¥æ„å»ºNodeèŠ‚ç‚¹æ”¾è¿›å»å°±è¡Œäº†</span><br><span class="hljs-keyword">if</span> ((p = tab[i = (n - <span class="hljs-number">1</span>) &amp; hash]) == <span class="hljs-literal">null</span>)<br>tab[i] = newNode(hash, key, value, <span class="hljs-literal">null</span>);<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">// eï¼Œå¦‚æœkeyä¸ä¸ºnullï¼Œå¹¶ä¸”æ‰¾åˆ°äº†å½“å‰è¦æ’å…¥çš„keyä¸€è‡´çš„nodeå…ƒç´ ï¼Œå°±ä¿å­˜åœ¨eä¸­</span><br><span class="hljs-comment">// kè¡¨ç¤ºä¸€ä¸ªä¸´æ—¶çš„key</span><br>Node&lt;K,V&gt; e; K k;<br><span class="hljs-comment">// 2.è¡¨ç¤ºè¯¥æ¡¶ä½ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ä½ å½“å‰æ’å…¥çš„nodeå…ƒç´ çš„keyä¸€è‡´ï¼Œè¡¨ç¤ºååºè¦è¿›è¡Œæ›¿æ¢æ“ä½œ</span><br><span class="hljs-keyword">if</span> (p.hash == hash &amp;&amp;<br>((k = p.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k))))<br>e = p;<br><span class="hljs-comment">// 3.è¡¨ç¤ºå½“å‰æ¡¶ä½å·²ç»æ ‘åŒ–äº†</span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p <span class="hljs-keyword">instanceof</span> TreeNode)<br>e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="hljs-built_in">this</span>, tab, hash, key, value);<br><span class="hljs-comment">// 4.å½“å‰æ…ä½æ˜¯ä¸€ä¸ªé“¾è¡¨</span><br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">binCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; ; ++binCount) &#123;<br><span class="hljs-comment">// 4.1 è¿­ä»£åˆ°æœ€åä¸€ä¸ªå…ƒç´ äº†ä¹Ÿæ²¡æœ‰æ‰¾åˆ°è¦æ’å…¥çš„keyä¸€è‡´çš„node</span><br><span class="hljs-keyword">if</span> ((e = p.next) == <span class="hljs-literal">null</span>) &#123;<br>p.next = newNode(hash, key, value, <span class="hljs-literal">null</span>);<br><span class="hljs-keyword">if</span> (binCount &gt;= TREEIFY\_THRESHOLD - <span class="hljs-number">1</span>) <span class="hljs-comment">// -1 for 1st</span><br>treeifyBin(tab, hash);<br><span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-comment">// 4.1 æ‰¾åˆ°äº†ä¸è¦æ’å…¥çš„keyä¸€è‡´çš„nodeå…ƒç´ </span><br><span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;<br>((k = e.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k))))<br><span class="hljs-keyword">break</span>;<br>p = e;<br>&#125;<br>&#125;<br><span class="hljs-comment">// å¦‚æœæ‰¾åˆ°äº†ä¸è¦æ’å…¥çš„keyä¸€è‡´çš„nodeå…ƒç´ ï¼Œé‚£ä¹ˆè¿›è¡Œæ›¿æ¢</span><br><span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// existing mapping for key</span><br><span class="hljs-type">V</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> e.value;<br><span class="hljs-keyword">if</span> (!onlyIfAbsent || oldValue == <span class="hljs-literal">null</span>)<br>e.value = value;<br>afterNodeAccess(e);<br><span class="hljs-keyword">return</span> oldValue;<br>&#125;<br>&#125;<br><span class="hljs-comment">// nodeCountè¡¨ç¤ºæ•£åˆ—è¡¨tableç»“æ„çš„ä¿®æ”¹æ¬¡æ•°ï¼Œæ›¿æ¢Nodeå…ƒç´ çš„valueä¸ç®—</span><br>++modCount;<br><span class="hljs-keyword">if</span> (++size &gt; threshold)<br>resize();<br>afterNodeInsertion(evict);<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><ol><li>HashMapçš„hashç®—æ³•(hash()æ–¹æ³•)ã€‚</li><li>(n - 1) &amp; hashç­‰ä»·äºå¯¹ length å–ä½™</li></ol><h2 id="2-4-resizeæ–¹æ³•åˆ†æ"><a href="#2-4-resizeæ–¹æ³•åˆ†æ" class="headerlink" title="2.4 resizeæ–¹æ³•åˆ†æ"></a>2.4 resizeæ–¹æ³•åˆ†æ</h2><p>åœ¨ HashMap ä¸­ï¼Œæ¡¶æ•°ç»„çš„é•¿åº¦å‡æ˜¯2çš„å¹‚ï¼Œé˜ˆå€¼å¤§å°ä¸ºæ¡¶æ•°ç»„é•¿åº¦ä¸è´Ÿè½½å› å­çš„ä¹˜ç§¯ã€‚å½“ HashMap ä¸­çš„é”®å€¼å¯¹æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè¿›è¡Œæ‰©å®¹ã€‚</p><p><strong>ä¸¾ä¸ªä¾‹å­ï¼š</strong></p><p>å½“åœ¨tableé•¿åº¦ä½16ä¸­çš„å…ƒç´ ç§»åˆ°tableé•¿åº¦ä½32çš„tableä¸­çš„æ—¶å€™ï¼›æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒåŸæ¥åœ¨15è¿™ä¸ªæ§½ä½çš„å…ƒç´ çš„hash()å€¼çš„åå››ä½ä¸€å®šæ˜¯1111ï¼ˆå› ä¸ºè·Ÿ1111å³tableé•¿åº¦-1 è¿›è¡Œä¸è¿ç®—å¾—åˆ°äº†1111ï¼‰ã€‚æ‰€ä»¥æ‰€ä»¥å½“tableé•¿åº¦å˜ä¸º32çš„æ—¶å€™ï¼ŒåŸæ¥åœ¨15è¿™ä¸ªæ§½ä½çš„å…ƒç´ è¦ä¹ˆè¿˜åœ¨15è¿™ä¸ªæ§½ä½ï¼Œè¦ä¹ˆåœ¨31è¿™ä¸ªæ“ä½œï¼ˆå› ä¸ºåŸæ¥15è¿™ä¸ªæ§½ä½çš„å…ƒç´ åäº”ä½ä¸€å®šæ˜¯11111æˆ–è€…01111ï¼Œè·Ÿ 11111å³tableæ–°é•¿åº¦-1 è¿›è¡Œä¸è¿ç®—ä¸€å®šå¾—åˆ° 01111æˆ–è€…11111ï¼‰</p><p><img src="https://i.loli.net/2021/03/04/p51KGxsFgOA4qhQ.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* å¯¹tableè¿›è¡Œåˆå§‹åŒ–æˆ–è€…æ‰©å®¹ã€‚<br>\* å¦‚æœtableä¸º<span class="hljs-literal">null</span>ï¼Œåˆ™å¯¹tableè¿›è¡Œåˆå§‹åŒ–<br>\* å¦‚æœå¯¹tableæ‰©å®¹ï¼Œå› ä¸ºæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯ç¿»å€ï¼Œä¸åŸæ¥è®¡ç®—ï¼ˆn-<span class="hljs-number">1</span>ï¼‰&amp;hashçš„ç»“æœç›¸æ¯”ï¼ŒèŠ‚ç‚¹è¦ä¹ˆå°±åœ¨åŸæ¥çš„ä½ç½®ï¼Œè¦ä¹ˆå°±è¢«åˆ†é…åˆ°â€œåŸä½ç½®+æ—§å®¹é‡â€è¿™ä¸ªä½ç½®ã€‚<br>\*/<br><span class="hljs-keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;<br>Node&lt;K,V&gt;[] oldTab = table;<br><span class="hljs-comment">// oldCapè¡¨ç¤ºæ‰©å®¹ä¹‹å‰tableæ•°ç»„çš„é•¿åº¦</span><br><span class="hljs-type">int</span> <span class="hljs-variable">oldCap</span> <span class="hljs-operator">=</span> (oldTab == <span class="hljs-literal">null</span>) ? <span class="hljs-number">0</span> : oldTab.length;<br><span class="hljs-comment">// oldThrè¡¨ç¤ºæœ¬æ¬¡æ‰©å®¹ä¹‹å‰çš„é˜ˆå€¼ï¼Œè§¦å‘æœ¬æ¬¡æ‰©å®¹æ“ä½œçš„é˜ˆå€¼</span><br><span class="hljs-type">int</span> <span class="hljs-variable">oldThr</span> <span class="hljs-operator">=</span> threshold;<br><span class="hljs-comment">// newCapï¼šè¡¨ç¤ºæ‰©å®¹ä¹‹åtableæ•°ç»„çš„å¤§å°ï¼› newThrè¡¨ç¤ºæ‰©å®¹ä¹‹åï¼Œä¸‹æ¬¡å‡ºå‘æ‰©å®¹çš„æ¡ä»¶</span><br><span class="hljs-type">int</span> newCap, newThr = <span class="hljs-number">0</span>;<br><span class="hljs-comment">//===================ç»™newCapå’ŒnewThrèµ‹å€¼start=============================</span><br><span class="hljs-comment">// oldCapå¤§äºé›¶ï¼Œè¯´æ˜ä¹‹å‰å·²ç»åˆå§‹åŒ–è¿‡äº†ï¼ˆhashmapä¸­çš„æ•£åˆ—è¡¨ä¸æ˜¯nullï¼‰ï¼Œè¦è¿›è¡Œæ­£å¸¸çš„æ‰©å®¹æ“ä½œ</span><br><span class="hljs-keyword">if</span> (oldCap &gt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-comment">// å·²ç»æœ€å¤§å€¼äº†ï¼Œä¸å†æ‰©å®¹äº†</span><br><span class="hljs-keyword">if</span> (oldCap &gt;= MAXIMUM\_CAPACITY) &#123;<br>threshold = Integer.MAX\_VALUE;<br><span class="hljs-keyword">return</span> oldTab;<br>&#125;<br><span class="hljs-comment">// ï¼ˆ1ï¼‰è¿›è¡Œç¿»å€æ‰©å®¹(å‡å¦‚æ—§çš„oldCapä¸º8ï¼Œ &lt; DEFAULT\_INITIAL\_CAPACITYï¼Œé‚£ä¹ˆæ­¤æ¡ä»¶ä¸æˆç«‹newThrå°†ä¸ä¼šèµ‹å€¼)</span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="hljs-number">1</span>) &lt; MAXIMUM\_CAPACITY &amp;&amp;<br>oldCap &gt;= DEFAULT\_INITIAL\_CAPACITY)<br>newThr = oldThr &lt;&lt; <span class="hljs-number">1</span>; <span class="hljs-comment">// double threshold</span><br>&#125;<br><span class="hljs-comment">// ï¼ˆ2ï¼‰</span><br><span class="hljs-comment">// oldCap == 0ï¼ˆè¯´æ˜hashmapä¸­çš„æ•£åˆ—è¡¨æ˜¯nullï¼‰ä¸”oldThr &gt; 0 ï¼›ä¸‹é¢å‡ ç§æƒ…å†µéƒ½ä¼šå‡ºç°oldCap == 0,oldThr &gt; 0</span><br><span class="hljs-comment">// 1.public HashMap(int initialCapacity);</span><br><span class="hljs-comment">// 2.public HashMap(Map&lt;? extends K, ? extends V&gt; m);å¹¶ä¸”è¿™ä¸ªmapæœ‰æ•°æ®</span><br><span class="hljs-comment">// 3.public HashMap(int initialCapacity, float loadFactor);</span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (oldThr &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">// initial capacity was placed in threshold</span><br>newCap = oldThr;<br><span class="hljs-comment">// oldCap == 0, oldThr == 0</span><br><span class="hljs-comment">// public HashMap();</span><br><span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// zero initial threshold signifies using defaults</span><br>newCap = DEFAULT\_INITIAL\_CAPACITY;<br>newThr = (<span class="hljs-type">int</span>)(DEFAULT\_LOAD\_FACTOR \* DEFAULT\_INITIAL\_CAPACITY);<br>&#125;<br><span class="hljs-comment">// å¯¹åº”ä¸Šé¢ï¼ˆ1ï¼‰ä¸æˆç«‹æˆ–è€…ï¼ˆ2ï¼‰æˆç«‹çš„æƒ…å†µ</span><br><span class="hljs-keyword">if</span> (newThr == <span class="hljs-number">0</span>) &#123;<br><span class="hljs-type">float</span> <span class="hljs-variable">ft</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>)newCap \* loadFactor;<br>newThr = (newCap &lt; MAXIMUM\_CAPACITY &amp;&amp; ft &lt; (<span class="hljs-type">float</span>)MAXIMUM\_CAPACITY ?<br>(<span class="hljs-type">int</span>)ft : Integer.MAX\_VALUE);<br>&#125;<br><span class="hljs-comment">//===================ç»™newCapå’ŒnewThrèµ‹å€¼end=============================</span><br>threshold = newThr;<br><span class="hljs-meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span><br>Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>[newCap];<br>table = newTab;<br><span class="hljs-keyword">if</span> (oldTab != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; oldCap; ++j) &#123;<br>Node&lt;K,V&gt; e;<br><span class="hljs-comment">// å¤´ç»“ç‚¹ä¸ä¸ºç©º</span><br><span class="hljs-keyword">if</span> ((e = oldTab[j]) != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-comment">// å°†å¯¹åº”çš„æ¡¶ä½æŒ‡å‘nullï¼Œæ–¹ä¾¿jvmå›æ”¶</span><br>oldTab[j] = <span class="hljs-literal">null</span>;<br><span class="hljs-comment">// 1.å¦‚æœåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="hljs-keyword">if</span> (e.next == <span class="hljs-literal">null</span>)<br>newTab[e.hash &amp; (newCap - <span class="hljs-number">1</span>)] = e;<br><span class="hljs-comment">// 2.æ ‘åŒ–äº†</span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> TreeNode)<br>((TreeNode&lt;K,V&gt;)e).split(<span class="hljs-built_in">this</span>, newTab, j, oldCap);<br><span class="hljs-comment">// 3.è¿˜æ˜¯é“¾è¡¨</span><br><span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// preserve order</span><br><span class="hljs-comment">// ä½ä½é“¾è¡¨ï¼šå­˜æ”¾åœ¨æ‰©å®¹ä¹‹åçš„æ•°ç»„ä¸‹æ ‡çš„ä½ç½®ï¼Œä¸å½“å‰æ•°ç»„ä¸‹æ ‡ä½ç½®ä¸€è‡´çš„å…ƒç´ </span><br><span class="hljs-comment">// é«˜ä½é“¾è¡¨ï¼šå­˜æ”¾åœ¨æ‰©å®¹ä¹‹åçš„æ•°ç»„ä¸‹æ ‡çš„ä½ç½®ä¸ºå½“å‰æ•°ç»„ä¸‹æ ‡ä½ç½®+ æ‰©å®¹ä¹‹å‰æ•°ç»„é•¿åº¦çš„å…ƒç´ </span><br>Node&lt;K,V&gt; loHead = <span class="hljs-literal">null</span>, loTail = <span class="hljs-literal">null</span>;<br>Node&lt;K,V&gt; hiHead = <span class="hljs-literal">null</span>, hiTail = <span class="hljs-literal">null</span>;<br>Node&lt;K,V&gt; next;<br><span class="hljs-keyword">do</span> &#123;<br>next = e.next;<br><span class="hljs-comment">// æ¯”å¦‚e.hashåªèƒ½ä¸ºä¸¤ç§å¯èƒ½ 1 1111 æˆ–è€… 0 1111 ï¼Œ oldCap ä¸º 10000</span><br><span class="hljs-keyword">if</span> ((e.hash &amp; oldCap) == <span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">if</span> (loTail == <span class="hljs-literal">null</span>)<br>loHead = e;<br><span class="hljs-keyword">else</span><br>loTail.next = e;<br>loTail = e;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">if</span> (hiTail == <span class="hljs-literal">null</span>)<br>hiHead = e;<br><span class="hljs-keyword">else</span><br>hiTail.next = e;<br>hiTail = e;<br>&#125;<br>&#125; <span class="hljs-keyword">while</span> ((e = next) != <span class="hljs-literal">null</span>);<br><span class="hljs-comment">// å¦‚æœä½ä½é“¾è¡¨æœ‰æ•°æ®</span><br><span class="hljs-keyword">if</span> (loTail != <span class="hljs-literal">null</span>) &#123;<br>loTail.next = <span class="hljs-literal">null</span>;<br>newTab[j] = loHead;<br>&#125;<br><span class="hljs-comment">// å¦‚æœé«˜ä½é“¾è¡¨æœ‰æ•°æ®</span><br><span class="hljs-keyword">if</span> (hiTail != <span class="hljs-literal">null</span>) &#123;<br>hiTail.next = <span class="hljs-literal">null</span>;<br>newTab[j + oldCap] = hiHead;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> newTab;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ•´ä½“æ­¥éª¤ï¼š</strong></p><ol><li>è®¡ç®—æ–°æ¡¶æ•°ç»„çš„å®¹é‡ newCap å’Œæ–°é˜ˆå€¼ newThr</li><li>æ ¹æ®è®¡ç®—å‡ºçš„ newCap åˆ›å»ºæ–°çš„æ¡¶æ•°ç»„ï¼Œæ¡¶æ•°ç»„ table ä¹Ÿæ˜¯åœ¨è¿™é‡Œè¿›è¡Œåˆå§‹åŒ–çš„</li><li>å°†é”®å€¼å¯¹èŠ‚ç‚¹é‡æ–°æ˜ å°„åˆ°æ–°çš„æ¡¶æ•°ç»„é‡Œã€‚å¦‚æœèŠ‚ç‚¹æ˜¯ TreeNode ç±»å‹ï¼Œåˆ™éœ€è¦æ‹†åˆ†çº¢é»‘æ ‘ã€‚å¦‚æœæ˜¯æ™®é€šèŠ‚ç‚¹ï¼Œåˆ™èŠ‚ç‚¹æŒ‰åŸé¡ºåºè¿›è¡Œåˆ†ç»„ã€‚</li></ol><p>æ€»ç»“èµ·æ¥ï¼Œä¸€å…±æœ‰ä¸‰ç§<strong>æ‰©å®¹æ–¹å¼</strong>ï¼š</p><ol><li><p>ä½¿ç”¨é»˜è®¤æ„é€ æ–¹æ³•åˆå§‹åŒ–HashMapã€‚ä»å‰æ–‡å¯ä»¥çŸ¥é“HashMapåœ¨ä¸€å¼€å§‹åˆå§‹åŒ–çš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ªç©ºçš„tableï¼Œå¹¶ä¸”thersholdä¸º0ã€‚å› æ­¤ç¬¬ä¸€æ¬¡æ‰©å®¹çš„å®¹é‡ä¸ºé»˜è®¤å€¼DEFAULT_INITIAL_CAPACITYä¹Ÿå°±æ˜¯16ã€‚åŒæ—¶threshold &#x3D; DEFAULT_INITIAL_CAPACITY * DEFAULT_LOAD_FACTOR &#x3D; 12ã€‚</p></li><li><p>æŒ‡å®šåˆå§‹å®¹é‡çš„æ„é€ æ–¹æ³•åˆå§‹åŒ–HashMapã€‚é‚£ä¹ˆä»ä¸‹é¢æºç å¯ä»¥çœ‹åˆ°åˆå§‹å®¹é‡ä¼šç­‰äºthresholdï¼Œæ¥ç€threshold &#x3D; å½“å‰çš„å®¹é‡ï¼ˆthresholdï¼‰ * DEFAULT_LOAD_FACTORã€‚</p></li><li><p>HashMapä¸æ˜¯ç¬¬ä¸€æ¬¡æ‰©å®¹ã€‚å¦‚æœHashMapå·²ç»æ‰©å®¹è¿‡çš„è¯ï¼Œé‚£ä¹ˆæ¯æ¬¡tableçš„å®¹é‡ä»¥åŠthresholdé‡ä¸ºåŸæœ‰çš„ä¸¤å€ã€‚</p><p>â€‹</p></li></ol><p>ç»†å¿ƒç‚¹çš„äººä¼šå¾ˆå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆè¦åˆ¤æ–­loadFactorä¸º0å‘¢ï¼Ÿ</p><blockquote><p>loadFactorå°æ•°ä½ä¸º 0ï¼Œæ•´æ•°ä½å¯è¢«2æ•´é™¤ä¸”å¤§äºç­‰äº8æ—¶ï¼Œåœ¨æŸæ¬¡è®¡ç®—ä¸­å°±å¯èƒ½ä¼šå¯¼è‡´ newThr æº¢å‡ºå½’é›¶ã€‚</p></blockquote><h2 id="2-5-getæ–¹æ³•åˆ†æ"><a href="#2-5-getæ–¹æ³•åˆ†æ" class="headerlink" title="2.5 getæ–¹æ³•åˆ†æ"></a>2.5 getæ–¹æ³•åˆ†æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(Object key)</span> &#123;<br>Node&lt;K,V&gt; e;<br><span class="hljs-keyword">return</span> (e = getNode(hash(key), key)) == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : e.value;<br>&#125;<br><span class="hljs-keyword">final</span> Node&lt;K,V&gt; <span class="hljs-title function_">getNode</span><span class="hljs-params">(<span class="hljs-type">int</span> hash, Object key)</span> &#123;<br><span class="hljs-comment">// tabï¼šå¼•ç”¨å½“å‰hashmapçš„table</span><br><span class="hljs-comment">// firstï¼šæ¡¶ä½ä¸­çš„å¤´å…ƒç´ </span><br><span class="hljs-comment">// nï¼štableçš„é•¿åº¦</span><br><span class="hljs-comment">// eï¼šæ˜¯ä¸´æ—¶Nodeå…ƒç´ </span><br><span class="hljs-comment">// kï¼šæ˜¯keyçš„ä¸´æ—¶å˜é‡</span><br>Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="hljs-type">int</span> n; K k;<br><span class="hljs-comment">// 1.å¦‚æœå“ˆå¸Œè¡¨ä¸ºç©ºï¼Œæˆ–keyå¯¹åº”çš„æ¡¶ä¸ºç©ºï¼Œè¿”å›null</span><br><span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="hljs-number">0</span> &amp;&amp;<br>(first = tab[(n - <span class="hljs-number">1</span>) &amp; hash]) != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-comment">// 2.è¿™ä¸ªæ¡¶çš„å¤´å…ƒç´ å°±æ˜¯æƒ³è¦æ‰¾çš„</span><br><span class="hljs-keyword">if</span> (first.hash == hash &amp;&amp; <span class="hljs-comment">// always check first node</span><br>((k = first.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k))))<br><span class="hljs-keyword">return</span> first;<br><span class="hljs-comment">// è¯´æ˜å½“å‰æ¡¶ä½ä¸æ­¢ä¸€ä¸ªå…ƒç´ ï¼Œå¯èƒ½æ˜¯é“¾è¡¨ï¼Œä¹Ÿå¯èƒ½æ˜¯çº¢é»‘æ ‘</span><br><span class="hljs-keyword">if</span> ((e = first.next) != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-comment">// 3.æ ‘åŒ–äº†</span><br><span class="hljs-keyword">if</span> (first <span class="hljs-keyword">instanceof</span> TreeNode)<br><span class="hljs-keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);<br><span class="hljs-comment">// 4.é“¾è¡¨</span><br><span class="hljs-keyword">do</span> &#123;<br><span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;<br>((k = e.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k))))<br><span class="hljs-keyword">return</span> e;<br>&#125; <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-literal">null</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-6-removeæ–¹æ³•åˆ†æ"><a href="#2-6-removeæ–¹æ³•åˆ†æ" class="headerlink" title="2.6 removeæ–¹æ³•åˆ†æ"></a>2.6 removeæ–¹æ³•åˆ†æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">remove</span><span class="hljs-params">(Object key)</span> &#123;<br>Node&lt;K,V&gt; e;<br><span class="hljs-keyword">return</span> (e = removeNode(hash(key), key, <span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>)) == <span class="hljs-literal">null</span> ?<br><span class="hljs-literal">null</span> : e.value;<br>&#125;<br><span class="hljs-keyword">final</span> Node&lt;K,V&gt; <span class="hljs-title function_">removeNode</span><span class="hljs-params">(<span class="hljs-type">int</span> hash, Object key, Object value,</span><br><span class="hljs-params"><span class="hljs-type">boolean</span> matchValue, <span class="hljs-type">boolean</span> movable)</span> &#123;<br><span class="hljs-comment">// tabï¼šå¼•ç”¨å½“å‰hashmapçš„table</span><br><span class="hljs-comment">// pï¼šå½“å‰çš„nodeå…ƒç´ </span><br><span class="hljs-comment">// nï¼šå½“å‰çš„æ•£åˆ—è¡¨æ•°ç»„é•¿åº¦</span><br><span class="hljs-comment">// indexï¼šè¡¨ç¤ºå¯»å€ç»“æœ</span><br>Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="hljs-type">int</span> n, index;<br><span class="hljs-comment">// 1.å¦‚æœæ•°ç»„tableä¸ºç©ºæˆ–keyæ˜ å°„åˆ°çš„æ¡¶ä¸ºç©ºï¼Œè¿”å›nullã€‚</span><br><span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="hljs-number">0</span> &amp;&amp;<br>(p = tab[index = (n - <span class="hljs-number">1</span>) &amp; hash]) != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-comment">// nodeï¼šæŸ¥æ‰¾åˆ°çš„ç»“æœ</span><br><span class="hljs-comment">// eï¼šå½“å‰Nodeçš„ä¸‹ä¸€ä¸ªå…ƒç´ </span><br>Node&lt;K,V&gt; node = <span class="hljs-literal">null</span>, e; K k; V v;<br><span class="hljs-comment">// 2.æ¡¶ä½çš„å¤´å…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„</span><br><span class="hljs-keyword">if</span> (p.hash == hash &amp;&amp;<br>((k = p.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k))))<br>node = p;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((e = p.next) != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-comment">// 3.æ ‘åŒ–äº†</span><br><span class="hljs-keyword">if</span> (p <span class="hljs-keyword">instanceof</span> TreeNode)<br>node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);<br><span class="hljs-comment">// 4.é“¾è¡¨ä¸­</span><br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">do</span> &#123;<br><span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;<br>((k = e.key) == key ||<br>(key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k)))) &#123;<br>node = e;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>p = e;<br>&#125; <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-literal">null</span>);<br>&#125;<br>&#125;<br><span class="hljs-comment">// å¦‚æœnodeä¸ä¸ºnullï¼Œè¯´æ˜æŒ‰ç…§keyæŸ¥æ‰¾åˆ°æƒ³è¦åˆ é™¤çš„æ•°æ®äº†</span><br><span class="hljs-keyword">if</span> (node != <span class="hljs-literal">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||<br>(value != <span class="hljs-literal">null</span> &amp;&amp; value.equals(v)))) &#123;<br><span class="hljs-comment">// æ˜¯æ ‘ï¼Œåˆ é™¤èŠ‚ç‚¹</span><br><span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> TreeNode)<br>((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="hljs-built_in">this</span>, tab, movable);<br><span class="hljs-comment">// åˆ é™¤çš„æ¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node == p)<br>tab[index] = node.next;<br><span class="hljs-comment">// ä¸æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ </span><br><span class="hljs-keyword">else</span><br>p.next = node.next;<br>++modCount;<br>--size;<br>afterNodeRemoval(node);<br><span class="hljs-keyword">return</span> node;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-7-replaceæ–¹æ³•åˆ†æ"><a href="#2-7-replaceæ–¹æ³•åˆ†æ" class="headerlink" title="2.7 replaceæ–¹æ³•åˆ†æ"></a>2.7 replaceæ–¹æ³•åˆ†æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">replace</span><span class="hljs-params">(K key, V oldValue, V newValue)</span> &#123;<br>Node&lt;K,V&gt; e; V v;<br><span class="hljs-keyword">if</span> ((e = getNode(hash(key), key)) != <span class="hljs-literal">null</span> &amp;&amp;<br>((v = e.value) == oldValue || (v != <span class="hljs-literal">null</span> &amp;&amp; v.equals(oldValue)))) &#123;<br>e.value = newValue;<br>afterNodeAccess(e);<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> V <span class="hljs-title function_">replace</span><span class="hljs-params">(K key, V value)</span> &#123;<br>Node&lt;K,V&gt; e;<br><span class="hljs-keyword">if</span> ((e = getNode(hash(key), key)) != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-type">V</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> e.value;<br>e.value = value;<br>afterNodeAccess(e);<br><span class="hljs-keyword">return</span> oldValue;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-8-å…¶ä»–å¸¸ç”¨æ–¹æ³•"><a href="#2-8-å…¶ä»–å¸¸ç”¨æ–¹æ³•" class="headerlink" title="2.8 å…¶ä»–å¸¸ç”¨æ–¹æ³•"></a>2.8 å…¶ä»–å¸¸ç”¨æ–¹æ³•</h2><h3 id="isEmpty"><a href="#isEmpty" class="headerlink" title="isEmpty()"></a><strong>isEmpty()</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">/\*\*<br>\* å¦‚æœmapä¸­æ²¡æœ‰é”®å€¼å¯¹æ˜ å°„ï¼Œè¿”å›true<br>\*<br>\* @return &lt;å¦‚æœmapä¸­æ²¡æœ‰é”®å€¼å¯¹æ˜ å°„ï¼Œè¿”å›true<br>\*/<br>public boolean isEmpty() &#123;<br>return size == 0;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="putMapEntries"><a href="#putMapEntries" class="headerlink" title="putMapEntries()"></a>putMapEntries()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putMapEntries</span><span class="hljs-params">(Map&lt;? extends K, ? extends V&gt; m, <span class="hljs-type">boolean</span> evict)</span> &#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> m.size();<br><span class="hljs-keyword">if</span> (s &gt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-comment">// tableä¸ºnullï¼Œä»£è¡¨è¿™é‡Œä½¿ç”¨HashMap(Map&lt;? extends K, ? extends V&gt; m)æ„é€ å‡½æ•° æˆ–è€…å…¶å®ƒæ–¹å¼å®ä¾‹åŒ–hashmapä½†æ˜¯è¿˜æ²¡å¾€é‡Œé¢æ·»åŠ è¿‡å…ƒç´ </span><br><span class="hljs-keyword">if</span> (table == <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// pre-size</span><br><span class="hljs-comment">//å‰é¢è®²åˆ°ï¼Œinitial capacity\*load factorå°±æ˜¯å½“å‰hashMapå…è®¸çš„æœ€å¤§å…ƒç´ æ•°ç›®ã€‚é‚£ä¹ˆä¸éš¾ç†è§£ï¼Œs/loadFactor+1å³ä¸ºåº”è¯¥åˆå§‹åŒ–çš„å®¹é‡ã€‚</span><br><span class="hljs-type">float</span> <span class="hljs-variable">ft</span> <span class="hljs-operator">=</span> ((<span class="hljs-type">float</span>)s / loadFactor) + <span class="hljs-number">1.0F</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> ((ft &lt; (<span class="hljs-type">float</span>)MAXIMUM\_CAPACITY) ?<br>(<span class="hljs-type">int</span>)ft : MAXIMUM\_CAPACITY);<br><span class="hljs-keyword">if</span> (t &gt; threshold)<br>threshold = tableSizeFor(t);<br>&#125;<br><span class="hljs-comment">//tableå·²ç»åˆå§‹åŒ–ï¼Œå¹¶ä¸”mapçš„å¤§å°å¤§äºä¸´ç•Œå€¼</span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s &gt; threshold)<br><span class="hljs-comment">//æ‰©å®¹å¤„ç†</span><br>resize();<br><span class="hljs-comment">//å°†mapä¸­æ‰€æœ‰é”®å€¼å¯¹æ·»åŠ åˆ°hashMapä¸­</span><br><span class="hljs-keyword">for</span> (Map.Entry&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">K</span>, ? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">V</span>&gt; e : m.entrySet()) &#123;<br><span class="hljs-type">K</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> e.getKey();<br><span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> e.getValue();<br>putVal(hash(key), key, value, <span class="hljs-literal">false</span>, evict);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="putAll"><a href="#putAll" class="headerlink" title="putAll()"></a>putAll()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* å°†å‚æ•°mapä¸­çš„æ‰€æœ‰é”®å€¼å¯¹æ˜ å°„æ’å…¥åˆ°hashMapä¸­ï¼Œå¦‚æœæœ‰ç¢°æ’ï¼Œåˆ™è¦†ç›–valueã€‚<br>\* <span class="hljs-meta">@param</span> m å‚æ•°map<br>\* <span class="hljs-meta">@throws</span> NullPointerException å¦‚æœmapä¸º<span class="hljs-literal">null</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putAll</span><span class="hljs-params">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;<br>putMapEntries(m, <span class="hljs-literal">true</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="clear"><a href="#clear" class="headerlink" title="clear()"></a>clear()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* åˆ é™¤mapä¸­æ‰€æœ‰çš„é”®å€¼å¯¹<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> &#123;<br>Node&lt;K,V&gt;[] tab;<br>modCount++;<br><span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-literal">null</span> &amp;&amp; size &gt; <span class="hljs-number">0</span>) &#123;<br>size = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; tab.length; ++i)<br>tab[i] = <span class="hljs-literal">null</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="containsValue-Object-value"><a href="#containsValue-Object-value" class="headerlink" title="containsValue( Object value)"></a>containsValue( Object value)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* å¦‚æœhashMapä¸­çš„é”®å€¼å¯¹æœ‰ä¸€å¯¹æˆ–å¤šå¯¹çš„valueä¸ºå‚æ•°valueï¼Œè¿”å›<span class="hljs-literal">true</span><br>\*<br>\* <span class="hljs-meta">@param</span> value å‚æ•°value<br>\* <span class="hljs-meta">@return</span> å¦‚æœhashMapä¸­çš„é”®å€¼å¯¹æœ‰ä¸€å¯¹æˆ–å¤šå¯¹çš„valueä¸ºå‚æ•°valueï¼Œè¿”å›<span class="hljs-literal">true</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsValue</span><span class="hljs-params">(Object value)</span> &#123;<br>Node&lt;K,V&gt;[] tab; V v;<br><span class="hljs-comment">//</span><br><span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-literal">null</span> &amp;&amp; size &gt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-comment">//éå†æ•°ç»„table</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; tab.length; ++i) &#123;<br><span class="hljs-comment">//éå†æ¡¶ä¸­çš„node</span><br><span class="hljs-keyword">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class="hljs-literal">null</span>; e = e.next) &#123;<br><span class="hljs-keyword">if</span> ((v = e.value) == value ||<br>(value != <span class="hljs-literal">null</span> &amp;&amp; value.equals(v)))<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="3-ç–‘é—®å’Œè§£ç­”"><a href="#3-ç–‘é—®å’Œè§£ç­”" class="headerlink" title="3.ç–‘é—®å’Œè§£ç­”"></a>3.ç–‘é—®å’Œè§£ç­”</h1><p><strong>1. JDK1.7æ˜¯åŸºäºæ•°ç»„+å•é“¾è¡¨å®ç°ï¼ˆä¸ºä»€ä¹ˆä¸ç”¨åŒé“¾è¡¨ï¼‰</strong></p><p>é¦–å…ˆï¼Œç”¨é“¾è¡¨æ˜¯ä¸ºäº†è§£å†³hashå†²çªã€‚</p><p>å•é“¾è¡¨èƒ½å®ç°ä¸ºä»€ä¹ˆè¦ç”¨åŒé“¾è¡¨å‘¢?(åŒé“¾è¡¨éœ€è¦æ›´å¤§çš„å­˜å‚¨ç©ºé—´)</p><p><strong>2. ä¸ºä»€ä¹ˆè¦ç”¨çº¢é»‘æ ‘ï¼Œè€Œä¸ç”¨å¹³è¡¡äºŒå‰æ ‘ï¼Ÿ</strong></p><p>æ’å…¥æ•ˆç‡æ¯”å¹³è¡¡äºŒå‰æ ‘é«˜ï¼ŒæŸ¥è¯¢æ•ˆç‡æ¯”æ™®é€šäºŒå‰æ ‘é«˜ã€‚æ‰€ä»¥é€‰æ‹©æ€§èƒ½ç›¸å¯¹æŠ˜ä¸­çš„çº¢é»‘æ ‘ã€‚</p><p><strong>3. é‡å†™å¯¹è±¡çš„Equalsæ–¹æ³•æ—¶ï¼Œè¦é‡å†™hashCodeæ–¹æ³•ï¼Œä¸ºä»€ä¹ˆï¼Ÿè·ŸHashMapæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</strong></p><p>equalsä¸hashcodeé—´çš„å…³ç³»:</p><ol><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸åŒï¼ˆå³ç”¨equalsæ¯”è¾ƒè¿”å›trueï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬çš„hashCodeå€¼ä¸€å®šè¦ç›¸åŒï¼›</li><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„hashCodeç›¸åŒï¼Œå®ƒä»¬å¹¶ä¸ä¸€å®šç›¸åŒ(å³ç”¨equalsæ¯”è¾ƒè¿”å›false)</li></ol><p>å› ä¸ºåœ¨ HashMap çš„é“¾è¡¨ç»“æ„ä¸­éå†åˆ¤æ–­çš„æ—¶å€™ï¼Œç‰¹å®šæƒ…å†µä¸‹é‡å†™çš„ equals æ–¹æ³•æ¯”è¾ƒå¯¹è±¡æ˜¯å¦ç›¸ç­‰çš„ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œå¾ªç¯ä¸‹æ¥æ›´æ˜¯å½±å“æŸ¥æ‰¾æ•ˆç‡ã€‚æ‰€ä»¥è¿™é‡ŒæŠŠ hashcode çš„åˆ¤æ–­æ”¾åœ¨å‰é¢ï¼Œåªè¦ hashcode ä¸ç›¸ç­‰å°±ç©å„¿å®Œï¼Œä¸ç”¨å†å»è°ƒç”¨å¤æ‚çš„ equals äº†ã€‚å¾ˆå¤šç¨‹åº¦åœ°æå‡ HashMap çš„ä½¿ç”¨æ•ˆç‡ã€‚</p><p>æ‰€ä»¥é‡å†™ hashcode æ–¹æ³•æ˜¯ä¸ºäº†è®©æˆ‘ä»¬èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ HashMap ç­‰é›†åˆç±»ï¼Œå› ä¸º HashMap åˆ¤æ–­å¯¹è±¡æ˜¯å¦ç›¸ç­‰æ—¢è¦æ¯”è¾ƒ hashcode åˆè¦ä½¿ç”¨ equals æ¯”è¾ƒã€‚è€Œè¿™æ ·çš„å®ç°æ˜¯ä¸ºäº†æé«˜ HashMap çš„æ•ˆç‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> Node&lt;K,V&gt; <span class="hljs-title function_">getNode</span><span class="hljs-params">(<span class="hljs-type">int</span> hash, Object key)</span> &#123;<br>Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="hljs-type">int</span> n; K k;<br><span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="hljs-number">0</span> &amp;&amp;<br>(first = tab[(n - <span class="hljs-number">1</span>) &amp; hash]) != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">if</span> (first.hash == hash &amp;&amp; <span class="hljs-comment">// always check first node</span><br>((k = first.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k))))<br><span class="hljs-keyword">return</span> first;<br><span class="hljs-keyword">if</span> ((e = first.next) != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">if</span> (first <span class="hljs-keyword">instanceof</span> TreeNode)<br><span class="hljs-keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);<br><span class="hljs-keyword">do</span> &#123;<br><span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;<br>((k = e.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.equals(k))))<br><span class="hljs-keyword">return</span> e;<br>&#125; <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-literal">null</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>4. æ—¢ç„¶çº¢é»‘æ ‘é‚£ä¹ˆå¥½ï¼Œä¸ºå•¥hashmapä¸ç›´æ¥é‡‡ç”¨çº¢é»‘æ ‘ï¼Œè€Œæ˜¯å½“å¤§äº8ä¸ªçš„æ—¶å€™æ‰è½¬æ¢çº¢é»‘æ ‘ï¼Ÿ</strong></p><p>å› ä¸ºçº¢é»‘æ ‘éœ€è¦è¿›è¡Œå·¦æ—‹ï¼Œå³æ—‹æ“ä½œï¼Œ è€Œå•é“¾è¡¨ä¸éœ€è¦ã€‚</p><p>ä»¥ä¸‹éƒ½æ˜¯å•é“¾è¡¨ä¸çº¢é»‘æ ‘ç»“æ„å¯¹æ¯”ã€‚</p><p>å¦‚æœå…ƒç´ å°äº8ä¸ªï¼ŒæŸ¥è¯¢æˆæœ¬é«˜ï¼Œæ–°å¢æˆæœ¬ä½ã€‚</p><p>å¦‚æœå…ƒç´ å¤§äº8ä¸ªï¼ŒæŸ¥è¯¢æˆæœ¬ä½ï¼Œæ–°å¢æˆæœ¬é«˜ã€‚</p><p>è‡³äºä¸ºä»€ä¹ˆé€‰æ•°å­—8ï¼Œæ˜¯å¤§ä½¬æŠ˜ä¸­è¡¡é‡çš„ç»“æœï¼Œå°±åƒloadFactoré»˜è®¤å€¼0.75ä¸€æ ·ã€‚</p><p><strong>5. JDK1.8çš„HashMapåœ¨é“¾è¡¨æ’å…¥æ—¶æ˜¯å°¾æ’æ³•ï¼Œè€Œ1.7æ˜¯å¤´æ’æ³•ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</strong></p><p>HashMapåœ¨jdk1.7ä¸­é‡‡ç”¨å¤´æ’å…¥æ³•ï¼Œåœ¨æ‰©å®¹æ—¶ä¼šæ”¹å˜é“¾è¡¨ä¸­å…ƒç´ åŸæœ¬çš„é¡ºåºï¼Œä»¥è‡³äºåœ¨å¹¶å‘åœºæ™¯ä¸‹å¯¼è‡´é“¾è¡¨æˆç¯çš„é—®é¢˜ã€‚è€Œåœ¨jdk1.8ä¸­é‡‡ç”¨å°¾æ’å…¥æ³•ï¼Œåœ¨æ‰©å®¹æ—¶ä¼šä¿æŒé“¾è¡¨å…ƒç´ åŸæœ¬çš„é¡ºåºï¼Œå°±ä¸ä¼šå‡ºç°é“¾è¡¨æˆç¯çš„é—®é¢˜äº†ã€‚</p><p><strong>6. æ€»ç»“ä¸‹HashMapåœ¨1.7å’Œ1.8ä¹‹é—´çš„å˜åŒ–ï¼š</strong></p><ul><li><p>1.7é‡‡ç”¨æ•°ç»„+å•é“¾è¡¨ï¼Œ1.8åœ¨å•é“¾è¡¨è¶…è¿‡ä¸€å®šé•¿åº¦åæ”¹æˆçº¢é»‘æ ‘å­˜å‚¨ã€‚</p></li><li><p>1.7æ‰©å®¹æ—¶éœ€è¦é‡æ–°è®¡ç®—å“ˆå¸Œå€¼å’Œç´¢å¼•ä½ç½®ï¼Œ1.8å¹¶ä¸é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œå·§å¦™åœ°é‡‡ç”¨å’Œæ‰©å®¹åå®¹é‡è¿›è¡Œ&amp;æ“ä½œæ¥è®¡ç®—æ–°çš„ç´¢å¼•ä½ç½®ã€‚</p></li><li><p>1.7æ’å…¥å…ƒç´ åˆ°å•é“¾è¡¨ä¸­é‡‡ç”¨å¤´æ’å…¥æ³•ï¼Œ1.8é‡‡ç”¨çš„æ˜¯å°¾æ’å…¥æ³•ã€‚</p><p>â€‹</p></li></ul><h1 id="4-å‚è€ƒ"><a href="#4-å‚è€ƒ" class="headerlink" title="4.å‚è€ƒ"></a>4.å‚è€ƒ</h1><p><a href="https://www.bilibili.com/video/BV1LJ411W7dP?p=5">HashMapå…¨Bç«™æœ€ç»†è‡´æºç åˆ†æè¯¾ç¨‹</a></p><p><a href="https://blog.csdn.net/yue_2018/article/details/89235709">HashMapæºç åˆ†æ</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµ…è°ˆ==å’Œequals</title>
    <link href="/2021/02/27/%E6%B5%85%E8%B0%88-%E5%92%8Cequals/"/>
    <url>/2021/02/27/%E6%B5%85%E8%B0%88-%E5%92%8Cequals/</url>
    
    <content type="html"><![CDATA[<h1 id="1-è¿è¡Œæ—¶æ•°æ®åŒº"><a href="#1-è¿è¡Œæ—¶æ•°æ®åŒº" class="headerlink" title="1.è¿è¡Œæ—¶æ•°æ®åŒº"></a>1.è¿è¡Œæ—¶æ•°æ®åŒº</h1><p><img src="https://i.loli.net/2021/02/27/ZpzPiYEoBR9GSns.png"></p><p>ç²—ç•¥çš„è®²ä¸‹Javaçš„å†…å­˜ç»“æ„ï¼Œè¦æƒ³æ·±å…¥çš„è®²è¿˜éœ€è¦æŠŠJVMçš„çŸ¥è¯†æ‹¿æ¥ï¼Œä½†æˆ‘ä»¬ç°åœ¨çš„æ ¸å¿ƒæ˜¯<strong>æ¯”è¾ƒ&#x3D;&#x3D;å’Œequalsçš„åŒºåˆ«</strong>ä»¥åŠ<strong>å¸¸è§æ•°æ®ç±»å‹</strong>åœ¨å–ç­‰å’Œè°ƒç”¨equalsæ—¶äº§ç”Ÿçš„ç»“æœå’ŒåŸå› ã€‚</p><p>å¦‚ä¸Šå›¾ï¼Œå¾ˆé‡è¦çš„å°±æ˜¯æ ˆï¼Œå †ï¼Œæ–¹æ³•åŒºï¼Œä¸‹é¢ç®€å•ä»‹ç»ä»–ä»¬çš„ä½œç”¨ï¼š</p><p>æ ˆï¼ˆstackï¼‰ï¼šä½äºé€šç”¨RAMä¸­ï¼Œä½†é€šè¿‡å®ƒçš„â€œæ ˆæŒ‡é’ˆâ€å¯ä»¥ä»å¤„ç†å™¨å“ªé‡Œè·å¾—æ”¯æŒã€‚æ ˆæŒ‡é’ˆè‹¥å‘ä¸‹ç§»åŠ¨ï¼Œåˆ™åˆ†é…æ–°çš„å†…å­˜ï¼›è‹¥å‘ä¸Šç§»åŠ¨ï¼Œåˆ™é‡Šæ”¾é‚£äº› å†…å­˜ã€‚è¿™æ˜¯ä¸€ç§å¿«é€Ÿæœ‰æ•ˆçš„åˆ†é…å­˜å‚¨æ–¹æ³•ï¼Œä»…æ¬¡äºå¯„å­˜å™¨ã€‚åˆ›å»ºç¨‹åºæ—¶å€™ï¼ŒJAVAç¼–è¯‘å™¨å¿…é¡»çŸ¥é“å­˜å‚¨åœ¨æ ˆå†…æ‰€æœ‰æ•°æ®çš„ç¡®åˆ‡å¤§å°å’Œç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºå®ƒå¿…é¡»ç”Ÿæˆ ç›¸åº”çš„ä»£ç ï¼Œä»¥ä¾¿ä¸Šä¸‹ç§»åŠ¨æ ˆæŒ‡é’ˆã€‚è¿™ä¸€çº¦æŸé™åˆ¶äº†ç¨‹åºçš„çµæ´»æ€§ï¼Œæ‰€ä»¥è™½ç„¶æŸäº›JAVAæ•°æ®å­˜å‚¨åœ¨æ ˆä¸­â€”â€”ç‰¹åˆ«æ˜¯å¯¹è±¡å¼•ç”¨ï¼Œä½†æ˜¯JAVAå¯¹è±¡ä¸å­˜å‚¨å…¶ä¸­ã€‚</p><p>â€“ å­˜æ”¾åŸºæœ¬ç±»å‹çš„å˜é‡æ•°æ®å’Œå¯¹è±¡ï¼Œæ•°ç»„çš„<strong>å¼•ç”¨</strong>ï¼Œä½†å¯¹è±¡æœ¬èº«ä¸å­˜æ”¾åœ¨æ ˆä¸­ï¼Œè€Œæ˜¯å­˜æ”¾åœ¨å †ï¼ˆnew å‡ºæ¥çš„å¯¹è±¡ï¼‰æˆ–è€…å¸¸é‡æ± ä¸­ï¼ˆå­—ç¬¦ä¸²å¸¸é‡å¯¹è±¡å­˜æ”¾åœ¨å¸¸é‡æ± ä¸­ï¼‰ã€‚</p><p>å †ï¼ˆheapï¼‰ï¼šä¸€ç§é€šç”¨æ€§çš„å†…å­˜æ± ï¼ˆä¹Ÿå­˜åœ¨äºRAMä¸­ï¼‰ï¼Œç”¨äºå­˜æ”¾æ‰€ä»¥çš„JAVAå¯¹è±¡ã€‚å †ä¸åŒäºæ ˆçš„å¥½å¤„æ˜¯ï¼šç¼–è¯‘å™¨ä¸éœ€è¦çŸ¥é“è¦ä»å †é‡Œåˆ†é…å¤šå°‘å­˜å‚¨åŒº åŸŸï¼Œä¹Ÿä¸å¿…çŸ¥é“å­˜å‚¨çš„æ•°æ®åœ¨å †é‡Œå­˜æ´»å¤šé•¿æ—¶é—´ã€‚å› æ­¤ï¼Œåœ¨å †é‡Œåˆ†é…å­˜å‚¨æœ‰å¾ˆå¤§çš„çµæ´»æ€§ã€‚å½“ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œåªéœ€è¦newå†™ä¸€è¡Œç®€å•çš„ä»£ç ï¼Œå½“æ‰§è¡Œ è¿™è¡Œä»£ç æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨å †é‡Œè¿›è¡Œå­˜å‚¨åˆ†é…ã€‚å½“ç„¶ï¼Œä¸ºè¿™ç§çµæ´»æ€§å¿…é¡»è¦ä»˜å‡ºç›¸åº”çš„ä»£ç ã€‚ç”¨å †è¿›è¡Œå­˜å‚¨åˆ†é…æ¯”ç”¨æ ˆè¿›è¡Œå­˜å‚¨å­˜å‚¨éœ€è¦æ›´å¤šçš„æ—¶é—´ã€‚</p><p>â€” å­˜æ”¾æ‰€æœ‰newå‡ºæ¥çš„å¯¹è±¡ï¼ŒGCä¼šè°ƒç”¨åƒåœ¾å›æ”¶ç®—æ³•å›æ”¶è¿‡æœŸçš„å¯¹è±¡ã€‚</p><p>æ–¹æ³•åŒºï¼šé‡Œé¢å­˜å‚¨è¿è¡Œæ—¶<strong>å¸¸é‡æ± </strong>ï¼Œå·²è¢«è™šæ‹ŸæœºåŠ è½½çš„<strong>ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡</strong>ï¼ŒåŠæ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ï¼Œå¸¸é‡ä»¥HashSetçš„ç­–ç•¥å­˜å‚¨ã€‚</p><p>ä»¥ä¸Šä¸‰è€…ï¼Œé€Ÿåº¦æœ€å¿«çš„æ˜¯æ–¹æ³•åŒºï¼Œå…¶æ¬¡æ˜¯å †ï¼Œæœ€åçš„æ ˆï¼Œ</p><h1 id="2-å’Œ-equalsæ¯”è¾ƒçš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-å’Œ-equalsæ¯”è¾ƒçš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2.&#x3D;&#x3D; å’Œ equalsæ¯”è¾ƒçš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2.&#x3D;&#x3D; å’Œ equalsæ¯”è¾ƒçš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>å¾ˆå¤šæœ‹å‹å¯èƒ½å’Œæˆ‘ä¸€æ ·ï¼Œå¤§ä¸€æ‰å­¦Javaï¼Œè€å¸ˆå°±åªè¯´&#x3D;&#x3D; æ¯”è¾ƒçš„æ˜¯æ•°æ®å‚¨å­˜çš„åœ°å€ï¼Œequalsæ¯”è¾ƒçš„æ˜¯å†…å®¹ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">s1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">s2</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123&quot;</span>;<br>System.out.println(s1 == s2);<br>System.out.println(s1.equals(s2));<br></code></pre></td></tr></table></figure><p>æŒ‰ç…§è€å¸ˆçš„è¯´æ³•ï¼Œè¿™ä¸¤ä¸ªåº”è¯¥éƒ½æ˜¯æ­£ç¡®çš„ï¼Œç¡®å®æˆ‘ä»¬è¿è¡Œä»£ç ä¸æˆ‘ä»¬é¢„æœŸç›¸ç¬¦ï¼Œé‚£ä¹ˆç°åœ¨åˆæ¥äº†ä¸ªå…„å¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">s1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">s2</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">s3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;123&quot;</span>);<br>System.out.println(s1 == s3);<br>System.out.println(s1.equals(s3));<br></code></pre></td></tr></table></figure><p>å¯ä»¥æ€è€ƒä¸‹ç»“æœï¼Œæˆ‘ä»¬å³å°†è¿›å…¥ä»Šå¤©çš„æ­£é¢˜ï¼</p><p>è¿è¡Œç¨‹åºç»“æœå‘ç°æ˜¯</p><p>false</p><p>true</p><p>s3ä¸ä¹Ÿæ˜¯å­—ç¬¦ä¸²â€œ123â€å—ä¸ºä»€ä¹ˆæ˜¯falseï¼Ÿ</p><p>ä¸ºäº†ç†æ¸…æ¥šé‡Œé¢çš„å¥¥å¦™ï¼Œæˆ‘ä»¬éœ€è¦è®°ä½ä¸‹é¢å…³äº&#x3D;&#x3D;å’Œequalsçš„è§„åˆ™ï¼š</p><p>1.&#x3D;&#x3D;<br> æ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹æ—¶ï¼Œæ¯”è¾ƒçš„æ˜¯æ•°å€¼ byteï¼Œshortï¼Œcharï¼Œintï¼Œfloatï¼Œdoubleï¼Œlongï¼Œboolean<br> ä»–ä»¬ä½œä¸ºå¸¸é‡åœ¨æ–¹æ³•åŒºä¸­çš„å¸¸é‡æ± ä»¥<strong>HashSetçš„ç­–ç•¥å­˜å‚¨</strong>,æ ˆä¸­çš„æ•°æ®å¯ä»¥å…±äº«,æ‰€ä»¥åŸºæœ¬æ•°æ®ç±»å‹å’ŒStringå¸¸é‡æ˜¯å¯ä»¥ä¹‹é—´é€šè¿‡&#x3D;&#x3D;æ¥æ¯”è¾ƒçš„<br> æ¯”è¾ƒå¼•ç”¨ç±»å‹ï¼šæ¯”è¾ƒå¼•ç”¨æŒ‡å‘çš„åœ°å€<br> 2.equals<br> é»˜è®¤æ¯”è¾ƒåœ°å€ï¼Œè¯¥æ–¹æ³•æœ€åˆå®šä¹‰åœ¨Objectä¸Šï¼Œé»˜è®¤çš„å®ç°å°±æ˜¯æ¯”è¾ƒåœ°å€<br> è‡ªå®šä¹‰çš„ç±»ï¼Œå¦‚æœéœ€è¦æ¯”è¾ƒçš„æ˜¯å†…å®¹ï¼Œå°±éœ€è¦é‡å†™Stringçš„equalsæ–¹æ³•</p><p>&#x3D;&#x3D;å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹æ¯”è¾ƒçš„å°±æ˜¯å€¼ï¼Œå› ä¸ºä»–ä»¬å­˜å‚¨åœ¨æ–¹æ³•åŒºçš„å¸¸é‡æ± ï¼Œå¯¹äºåº”ç”¨ç±»å‹ï¼ˆå¦‚Stringï¼‰å°±æ˜¯æ¯”è¾ƒçš„åœ°å€ï¼Œequalsé»˜è®¤æ˜¯æ¯”è¾ƒçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤å’Œ&#x3D;&#x3D;æ˜¯æ²¡åŒºåˆ«çš„ï¼Œä½†Stringé‡å†™äº†equalsæ–¹æ³•ï¼Œæ¯”è¾ƒå­—ç¬¦ä¸²çš„å†…å®¹ï¼è€Œå¯¹äºåŸºæœ¬æ•°æ®å°±åªèƒ½é€šè¿‡&#x3D;&#x3D;æ¥æ¯”è¾ƒï¼Œç”¨equalsè¿ç¼–è¯‘éƒ½æ— æ³•é€šè¿‡ï¼</p><p>è¦æƒ³çŸ¥é“s3ä¸æ˜¯å­—ç¬¦ä¸²â€œ123â€å—ï¼Ÿä¸ºä»€ä¹ˆæ˜¯falseï¼Œæˆ‘ä»¬è¦ä¸€æ­¥ä¸€æ­¥çš„æ¥ï¼</p><h1 id="3-å…³äºStringä¸å¾—ä¸æ¸…æ¥šçš„å…«å¤§æƒ…å†µ"><a href="#3-å…³äºStringä¸å¾—ä¸æ¸…æ¥šçš„å…«å¤§æƒ…å†µ" class="headerlink" title="3.å…³äºStringä¸å¾—ä¸æ¸…æ¥šçš„å…«å¤§æƒ…å†µ"></a>3.å…³äºStringä¸å¾—ä¸æ¸…æ¥šçš„å…«å¤§æƒ…å†µ</h1><p><strong>1. String str &#x3D; â€œabcâ€; &#x2F;&#x2F;å¼•ç”¨å¸¸é‡æ± çš„å¯¹è±¡</strong></p><blockquote><p>String str &#x3D; â€œabcâ€ çš„åˆ›å»ºè¿‡ç¨‹ï¼š<br> 1 é¦–å…ˆåœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å†…å®¹ä¸ºâ€abcâ€å­—ç¬¦ä¸²å¯¹è±¡<br> 2 å¦‚æœä¸å­˜åœ¨åˆ™åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºâ€abcâ€ï¼Œå¹¶è®©strå¼•ç”¨è¯¥å¯¹è±¡<br> 3 å¦‚æœå­˜åœ¨åˆ™ç›´æ¥è®©strå¼•ç”¨è¯¥å¯¹è±¡</p></blockquote><p><strong>2.String str1 &#x3D; â€œabcâ€;</strong></p><p><strong>String str2 &#x3D; new String(â€œabcâ€).intern();</strong></p><p><strong>System.out.println(str1 &#x3D;&#x3D; str2);</strong></p><blockquote><p>String str &#x3D; new String(â€œabcâ€)åˆ›å»ºå®ä¾‹çš„è¿‡ç¨‹ï¼š<br>1.é¦–å…ˆåœ¨å †ä¸­ï¼ˆä¸æ˜¯å¸¸é‡æ± ï¼‰åˆ›å»ºä¸€ä¸ªæŒ‡å®šçš„å¯¹è±¡â€abcâ€ï¼Œå¹¶è®©strå¼•ç”¨æŒ‡å‘è¯¥å¯¹è±¡<br>åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æŸ¥çœ‹ï¼Œæ˜¯å¦å­˜åœ¨å†…å®¹ä¸ºâ€abcâ€å­—ç¬¦ä¸²å¯¹è±¡<br>è‹¥å­˜åœ¨ï¼Œåˆ™å°†newå‡ºæ¥çš„å­—ç¬¦ä¸²å¯¹è±¡ä¸å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡è”ç³»èµ·æ¥<br>è‹¥ä¸å­˜åœ¨ï¼Œåˆ™åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä¸ªå†…å®¹ä¸ºâ€abcâ€çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶å°†å †ä¸­çš„å¯¹è±¡ä¸ä¹‹è”ç³»èµ·æ¥<br>intern æ–¹æ³•å¯ä»¥è¿”å›è¯¥å­—ç¬¦ä¸²åœ¨å¸¸é‡æ± ä¸­çš„å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢ä»£ç ç®€å•çš„æµ‹è¯•<br>å½“è°ƒç”¨ intern æ–¹æ³•æ—¶ï¼Œå¦‚æœæ± å·²ç»åŒ…å«ä¸€ä¸ªç­‰äºæ­¤ String å¯¹è±¡çš„å­—ç¬¦ä¸²ï¼ˆç”¨ equals(Object) æ–¹æ³•ç¡®å®šï¼‰ï¼Œåˆ™è¿”å›æ± ä¸­çš„å­—ç¬¦ä¸²ã€‚å¦åˆ™ï¼Œå°†æ­¤ String å¯¹<br>å®ƒéµå¾ªä»¥ä¸‹è§„åˆ™ï¼šå¯¹äºä»»æ„ä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t ï¼Œå½“ä¸”ä»…å½“ s.equals(t) ä¸º true æ—¶ï¼Œs.intern() &#x3D;&#x3D; t.intern() æ‰ä¸º true ã€‚</p></blockquote><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä»‹ç»ä¸Šé¢çš„é—®é¢˜s3æ˜¯å­—ç¬¦ä¸²â€œ123â€ä¸ºä»€ä¹ˆæ˜¯falseï¼Œå› ä¸ºs3æ˜¯newå‡ºæ¥çš„ï¼Œé¦–å…ˆå°±åœ¨å †ä¸­åˆ›å»ºäº†â€œ123â€ï¼Œå³ä½¿åé¢å†å¸¸é‡æ± ä¸­æŸ¥æ‰¾â€œ123â€æ˜¯å­˜åœ¨çš„ï¼Œä½†&#x3D;&#x3D;å§‹ç»ˆæ˜¯æ¯”è¾ƒçš„åœ°å€ï¼Œæ‰€ä»¥å³ä½¿å–ç­‰å†…å®¹ç›¸åŒçš„s1å’Œs3ä¹Ÿæ˜¯è¿”å›falseï¼›</p><p><strong>3.String str3 &#x3D; â€œabâ€ + â€œcâ€;</strong></p><p>â€‹ <strong>System.out.println(str1 &#x3D;&#x3D; str3);</strong></p><blockquote><p>str2ä¼šæ‰¾å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨â€abcâ€ï¼Œå¦‚æœå­˜åœ¨å°±æŠŠstr2æŒ‡å‘str1ï¼Œæ˜¾ç„¶str1å·²ç»åœ¨å¸¸é‡åŒºåˆ›å»ºäº†â€abcâ€,&#x3D;&#x3D; æ˜¯å¯¹äºå¼•ç”¨ç±»å‹æ˜¯æ¯”è¾ƒåœ°å€ï¼Œæ‰€ä»¥str1 å’Œstr2 éƒ½æŒ‡å‘â€abcâ€,ç»“æœä¸ºtrueã€‚</p></blockquote><p><strong>4.String str4 &#x3D; â€œabâ€;</strong></p><p><strong>String str5 &#x3D; str4 + â€œcâ€;</strong></p><p><strong>System.out.println(str5 &#x3D;&#x3D; str1);</strong></p><blockquote><p>æ˜¯å› ä¸ºString str5 &#x3D; str4 + â€œcâ€æ¶‰åŠåˆ°å˜é‡ï¼ˆä¸å…¨æ˜¯å¸¸é‡ï¼‰çš„ç›¸åŠ ï¼Œæ‰€ä»¥ä¼šç”Ÿæˆæ–°çš„å¯¹è±¡ï¼Œå…¶å†…éƒ¨å®ç°æ˜¯å…ˆnewä¸€ä¸ªStringBuilderï¼Œç„¶å append(str4),append(â€œcâ€);ç„¶åè®©str5å¼•ç”¨toString()è¿”å›çš„å¯¹è±¡ã€‚</p></blockquote><p>ç®€å•çš„è¯´å°±æ˜¯newäº†ä¸€ä¸ªStringBuilderï¼Œäº§ç”Ÿäº†æ–°å¯¹è±¡ã€‚</p><p><strong>5.System.out.println(str1 &#x3D;&#x3D; str2);</strong></p><blockquote><p>æˆ‘ä»¬çŸ¥é“ç”¨equalsæ¯”è¾ƒstr1å’Œstr2æ˜¯æ¯«æ— ç–‘é—®è¿”å›trueçš„ï¼Œå› ä¸ºequalé»˜è®¤æ¯”è¾ƒçš„æ˜¯å¼•ç”¨åœ°å€<br> &#x3D;&#x3D;å¯¹äºå¼•ç”¨ç±»å‹ä¹Ÿæ˜¯æ¯”è¾ƒåœ°å€ï¼Œstr1 str2 å¸¸é‡å­˜æ”¾åœ¨å¸¸é‡åŒºï¼Œä¸Šæ–‡ä¹Ÿå·²ç»æåˆ°str1å’Œstr2çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå…ˆçœ‹å¸¸é‡åŒºæ˜¯å¦å­˜åœ¨â€abcâ€,è‹¥æœ‰å°±ä¸åˆ›å»ºäº†ï¼Œä¹‹é—´è®©str2åº”ç”¨è¯¥åœ°å€ï¼Œè‹¥æ— åˆ™åˆ›å»ºï¼Œå¯ä»¥çœ‹åˆ°str1å’Œstr2éƒ½æ˜¯æŒ‡å‘çš„è¯¥åœ°å€ï¼Œæ•…&#x3D;&#x3D;è¿”å›</p></blockquote><p><strong>6.str1 &#x3D; â€œbcdâ€;</strong></p><p><strong>System.out.println(str1 &#x3D;&#x3D; str2);</strong></p><blockquote><p>èµ‹å€¼çš„å˜åŒ–å¯¼è‡´äº†ç±»å¯¹è±¡å¼•ç”¨çš„å˜åŒ–ï¼Œstr1æŒ‡å‘äº†å¦å¤–ä¸€ä¸ªæ–°å¯¹è±¡ï¼è€Œstr2ä»æ—§æŒ‡å‘åŸæ¥çš„å¯¹è±¡ã€‚ä¸Šä¾‹ä¸­ï¼Œå½“æˆ‘ä»¬å°†str1çš„å€¼æ”¹ä¸ºâ€bcdâ€æ—¶ï¼Œ</p><p>JVMå‘ç°åœ¨ å¸¸é‡æ± ä¸­æ²¡æœ‰å­˜æ”¾è¯¥å€¼çš„åœ°å€ï¼Œä¾¿å¼€è¾Ÿäº†è¿™ä¸ªåœ°å€ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå…¶å­—ç¬¦ä¸²çš„å€¼æŒ‡å‘è¿™ä¸ªåœ°å€ã€‚</p></blockquote><p><strong>7.String str6 &#x3D; str1;</strong></p><p><strong>System.out.println(str6);</strong></p><p><strong>String str7 &#x3D; â€œbcdâ€;</strong></p><p><strong>System.out.println(str1 &#x3D;&#x3D; str7);</strong></p><blockquote><p>å¸¸é‡æ± ä¸­ä¸ä»…ä»…æ˜¯å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹æ˜¯ä»¥HashSerç­–ç•¥å­˜å‚¨çš„ï¼Œå¯¹äºStringä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¸€ä¸ªå¸¸é‡åªä¼šå¯¹äºä¸€ä¸ªåœ°å€</p></blockquote><p><strong>8.String str8 &#x3D; new String(â€œabcâ€);</strong></p><p><strong>String str9 &#x3D; â€œabcâ€;</strong></p><p><strong>System.out.println(str8 &#x3D;&#x3D; str9);</strong></p><blockquote><p>newä¼šä¹‹é—´åœ¨å †ä¸­åˆ›å»ºå¯¹è±¡ï¼Œæ‰€ä»¥str8çš„å¼•ç”¨ä¹Ÿæ˜¯æŒ‡å‘çš„å †ä¸­çš„å¯¹è±¡<br> str8æ˜¯å¸¸é‡åŒºçš„ï¼Œå³ä½¿æ•°æ®ç›¸åŒï¼Œä¹Ÿä¸ä¼šè¿”å›true</p></blockquote><h1 id="4-Integerçš„ç¼“å­˜æœºåˆ¶ã€è‡ªå¸¦æ‹†ç®±"><a href="#4-Integerçš„ç¼“å­˜æœºåˆ¶ã€è‡ªå¸¦æ‹†ç®±" class="headerlink" title="4.Integerçš„ç¼“å­˜æœºåˆ¶ã€è‡ªå¸¦æ‹†ç®±"></a>4.Integerçš„ç¼“å­˜æœºåˆ¶ã€è‡ªå¸¦æ‹†ç®±</h1><p><strong>1.Integer i1 &#x3D; new Integer(12);</strong></p><p><strong>Integer i2 &#x3D; new Integer(12);</strong></p><p><strong>System.out.println(i1 &#x3D;&#x3D; i2); &#x2F;&#x2F;false</strong></p><blockquote><p>è¿™é‡Œå¾ˆç®€å•ï¼Œnewäº†æ–°çš„å¯¹è±¡ï¼Œåœ¨å †ä¸­å¼€è¾Ÿæ–°çš„ç©ºé—´ï¼Œ&#x3D;&#x3D;å¯¹äºå¼•ç”¨ç±»å‹æ¯”è¾ƒçš„æ˜¯åœ°å€ï¼Œå¾ˆæ˜¾ç„¶ä¸¤è€…åœ°å€ä¸ä¸€æ ·(æ•°å€¼ç›¸åŒ)</p></blockquote><p><strong>2.Integer i3 &#x3D; 14;</strong></p><p><strong>Integer i4 &#x3D; 14;</strong></p><p><strong>int i5 &#x3D; 14;</strong></p><p><strong>System.out.println(i3 &#x3D;&#x3D; i4);</strong> &#x2F;&#x2F;true</p><p><strong>System.out.println(i3 &#x3D;&#x3D; i5);</strong> &#x2F;&#x2F;true</p><blockquote><p>å¯¹äºi3 &#x3D;&#x3D; i4æ˜¯è¿”å›trueï¼Œå¾ˆå¤šäººå¯èƒ½è§‰å¾—æ˜¯å­˜æ”¾åœ¨å¸¸é‡åŒºçš„åŸå› ï¼Œå…¶å®ä¸ç„¶ï¼Œè¿™æ˜¯Integerçš„ç¼“å­˜æœºåˆ¶ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ä¸ªç¤ºä¾‹ä¸­å¾—åˆ°éªŒè¯</p><p>i3 &#x3D;&#x3D; i4 è¿”å›trueæ˜¯è‡ªåŠ¨æ‹†ç®±æœºåˆ¶ï¼ŒIntegerè½¬int &#x3D;&#x3D;å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹æ¯”è¾ƒçš„æ˜¯å€¼</p></blockquote><p><strong>3.Integer i6 &#x3D; 128;</strong></p><p><strong>Integer i7 &#x3D; 128;</strong></p><p><strong>int i8 &#x3D; 128;</strong></p><p><strong>System.out.println(i6 &#x3D;&#x3D; i7);</strong> &#x2F;&#x2F; false è¶…å‡ºIntegerç¼“å­˜èŒƒå›´ï¼Œ</p><p>**System.out.println(i6 &#x3D;&#x3D; i8); **&#x2F;&#x2F;true</p><blockquote><p>å¯ä»¥çœ‹åˆ°å³ä½¿i6 å’Œ i7 æ•°å€¼ç›¸åŒï¼Œä½†å–&#x3D;&#x3D;å¹¶ä¸è¿”å›trueï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ç¿»é˜…Integerçš„æºç ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Integer <span class="hljs-title function_">valueOf</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br><span class="hljs-keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)<br><span class="hljs-keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(i);<br>&#125;<br><span class="hljs-comment">//è‹¥æ•°å€¼åœ¨-127 - 128ä¹‹é—´åˆ™ä¼šä»ç¼“å­˜ä¸­æ‹¿ï¼Œä¸ä¼šnew ä¹Ÿå°±ä¸ä¼š</span><br><span class="hljs-comment">//å­˜åœ¨çš„å€¼è€Œå·²</span><br><span class="hljs-comment">//è‹¥ä¸åœ¨ï¼Œåˆ™ä¼šnew å¼€è¾Ÿæ–°çš„å †ç©ºé—´</span><br></code></pre></td></tr></table></figure><p>å…¶å®ï¼ŒIntegeræ˜¯ä¸ªå¤§å‘ï¼Œåœ¨é˜¿é‡Œå¼€å‘æ‰‹å†Œå°±æ˜ç¡®å†™é“ï¼š</p><p><strong>æ•´å‹åŒ…è£…ç±»å¯¹è±¡ä¹‹é—´å€¼çš„æ¯”è¾ƒï¼Œå…¨éƒ¨ä½¿ç”¨ equals æ–¹æ³•æ¯”è¾ƒï¼</strong></p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…«å¤§æ’åºç®—æ³•ï¼ˆä¸Šï¼‰</title>
    <link href="/2021/02/18/%E5%85%AB%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%EF%BC%88%E4%B8%8A%EF%BC%89/"/>
    <url>/2021/02/18/%E5%85%AB%E5%A4%A7%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%EF%BC%88%E4%B8%8A%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="æ’åºç®—æ³•çš„ä»‹ç»"><a href="#æ’åºç®—æ³•çš„ä»‹ç»" class="headerlink" title="æ’åºç®—æ³•çš„ä»‹ç»"></a>æ’åºç®—æ³•çš„ä»‹ç»</h1><p>æ’åºä¹Ÿç§°æ’åºç®—æ³•(Sort Algorithm)ï¼Œæ’åºæ˜¯å°†<strong>ä¸€ç»„æ•°æ®</strong>ï¼Œä¾<strong>æŒ‡å®šçš„é¡ºåº</strong>è¿›è¡Œ<strong>æ’åˆ—çš„è¿‡ç¨‹</strong>ã€‚</p><h1 id="æ’åºçš„åˆ†ç±»"><a href="#æ’åºçš„åˆ†ç±»" class="headerlink" title="æ’åºçš„åˆ†ç±»"></a>æ’åºçš„åˆ†ç±»</h1><p>â€‹ 1.å†…éƒ¨æ’åºï¼š</p><p>â€‹ æŒ‡å°†éœ€è¦å¤„ç†çš„æ‰€æœ‰æ•°æ®éƒ½åŠ è½½åˆ°<strong>å†…éƒ¨å­˜å‚¨å™¨</strong>ï¼ˆå†…å­˜ï¼‰ä¸­è¿›è¡Œæ’åºã€‚</p><p>â€‹ 2.å¤–éƒ¨æ’åºï¼š</p><p>â€‹ <strong>æ•°æ®é‡è¿‡å¤§</strong>ï¼Œæ— æ³•å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œéœ€è¦å€ŸåŠ©<strong>å¤–éƒ¨å­˜å‚¨</strong>ï¼ˆæ–‡ä»¶ç­‰ï¼‰è¿›è¡Œæ’åºã€‚</p><p>â€‹ 3.å¸¸è§çš„å†…éƒ¨æ’åºç®—æ³•ï¼š</p><p>â€‹ <img src="https://i.loli.net/2021/02/18/omYbVgidws6nUyM.jpg"></p><h1 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h1><p>å†’æ³¡æ’åºï¼ˆBubble Sortingï¼‰çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šé€šè¿‡å¾…æ’åºåºåˆ—ä»å‰å‘åï¼ˆä»ä¸‹æ ‡è¾ƒå°çš„å…ƒç´ å¼€å§‹ï¼‰ï¼Œä¾æ¬¡æ¯”è¾ƒç›¸é‚»å…ƒç´ çš„å€¼ï¼Œè‹¥å‘ç°é€†åºåˆ™äº¤æ¢ï¼Œä½¿å€¼è¾ƒå¤§çš„å…ƒç´ é€æ¸ä»å‰ç§»å‘åéƒ¨ï¼Œå°±åƒæ°´æ»´çš„æ°”æ³¡é€æ¸å‘ä¸Šå†’ã€‚</p><p>ä¸€å¥è¯æ¦‚æ‹¬ï¼š<strong>å…ˆæ‰¾å¤§çš„ï¼Œæ‰¾åˆ°äº†å°±æŒ‰å…ˆåé¡ºåºå¾€æœ«å°¾ç§»åŠ¨ã€‚</strong></p><p><img src="https://i.loli.net/2021/02/18/waCAqrxp1BeV68D.jpg"></p><p>æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠåœ¨å‰é¢é€šè¿‡æ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªæ•°ï¼Œéå†æ•°ç»„æ‰¾åˆ°æœ€å¤§çš„ï¼Œç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[] bubbleSort(<span class="hljs-type">int</span>[] array)&#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; array.length - <span class="hljs-number">1</span> ; i++) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; array.length -<span class="hljs-number">1</span> -i ; j++) &#123;<br><span class="hljs-keyword">if</span> (array[j] &gt; array[j+<span class="hljs-number">1</span>])&#123;<br>temp = array[j];<br>array[j] = array[j+<span class="hljs-number">1</span>];<br>array[j+<span class="hljs-number">1</span>] = temp;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> array;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥åœ¨å›¾ç¤ºä¸­çœ‹åˆ°ï¼Œåœ¨ç¬¬ä¸‰è¶Ÿæ’åºé€€å‡ºæ—¶ï¼Œæ•°ç»„å·²ç»æ˜¯æœ‰åºçš„äº†ï¼Œä½†è¿˜æ˜¯ä¾ç„¶ä¼šèµ°ç¬¬å››è¶Ÿæ’åºï¼Œå†ä¸ç›¸é‚»å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥å¯ä»¥ä¼˜åŒ–ï¼ŒåŠ å…¥æ ‡å¿—ä½ï¼Œåˆ¤æ–­æ˜¯å¦è¿›å…¥äº¤æ¢ if (array[j] &gt; array[j+1])ä¸­ï¼Œæœªè¿›å…¥ï¼Œè¯´æ˜æ•°ç»„å·²ç»æ˜¯æœ‰åºçš„äº†ï¼Œç›´æ¥è¿”å›å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[] bubbleSort(<span class="hljs-type">int</span>[] array)&#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; array.length - <span class="hljs-number">1</span> ; i++) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; array.length -<span class="hljs-number">1</span> -i ; j++) &#123;<br><span class="hljs-keyword">if</span> (array[j] &gt; array[j+<span class="hljs-number">1</span>])&#123;<br>temp = array[j];<br>array[j] = array[j+<span class="hljs-number">1</span>];<br>array[j+<span class="hljs-number">1</span>] = temp;<br>flag = <span class="hljs-literal">true</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">if</span> (!flag) &#123;<br><span class="hljs-keyword">break</span>;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>flag = <span class="hljs-literal">false</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> array;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h1><p>ä¸€å¥è¯æ¥è¯´ï¼š<strong>æŠŠæœ€å°çš„å€¼æåˆ°æ•°ç»„å‰é¢ï¼Œåœ¨æ•°ç»„çš„é¦–éƒ¨é€æ­¥æœ‰åºåŒ–</strong></p><p><img src="https://i.loli.net/2021/02/18/NnmeAFlwDL4IgTU.jpg"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">selectSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array)</span>&#123;<br><span class="hljs-comment">//å‡å®šç¬¬ä¸€ä¸ªæ˜¯æœ€å°</span><br><span class="hljs-type">int</span> <span class="hljs-variable">minIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> array[<span class="hljs-number">0</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; array.length - <span class="hljs-number">1</span>; j++) &#123;<br><span class="hljs-comment">//äº¤æ¢æ¬¡æ•° n- 1 ä¸å†’æ³¡ä¸€æ · æ—¶é—´å¤æ‚åº¦O(n^2)</span><br><span class="hljs-comment">//å‡å®šæœ€å°çš„å€¼ï¼Œå…¶ç´¢å¼•ä¸º0ï¼Œéå†æ•°ç»„ï¼Œæ‰¾åˆ°çœŸæ­£æœ€å°çš„å€¼ï¼Œäº¤æ¢ï¼Œç„¶åå°†0ç´¢å¼•åç§»ä¸€ä½ï¼Œæ‰¾åˆ°ç¬¬äºŒå°çš„</span><br>minIndex = j;<br>min = array[j];<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> minIndex +<span class="hljs-number">1</span>; i &lt; array.length; i++) &#123;<br><span class="hljs-keyword">if</span> (array[i] &lt; min)&#123;<br>minIndex = i;<br>min = array[i];<br>&#125;<br>&#125;<br><span class="hljs-comment">//å°†æ‰¾åˆ°çš„æœ€å°å€¼ä¸å‡å®šçš„æœ€å°å€¼è¿›è¡Œäº¤æ¢-- äº¤æ¢æ’åºçš„æ ¸å¿ƒ</span><br>array[minIndex] = array[j];<br>array[j] = min;<br>System.out.println(Arrays.toString(array));<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;æœ€ç»ˆ-&quot;</span>+Arrays.toString(array));<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹æ¯”å†’æ³¡æ’åºå’Œé€‰æ‹©æ’åºï¼Œå‰è€…æ‰¾æœ€å¤§çš„æ”¾æœ«å°¾ï¼Œåç½®æ‰¾æœ€å°çš„æ”¾é¦–éƒ¨ï¼Œæ„Ÿè§‰è¿™å®Œå…¨å°±æ˜¯ä¸€ç§ç®—æ³•å§ï¼Œåœ¨å†’æ³¡åœ¨æ”¹å˜æ¡ä»¶ï¼Œä¹Ÿå¯ä»¥å®ç°è¿™æ ·çš„æ•ˆæœï¼Œå…¶å®å¹¶ä¸è¿™æ ·ï¼Œè¿™ä¸¤ç§ç®—æ³•è™½ç„¶è¡¨é¢æ˜¯å…„å¼Ÿï¼Œä½†å®ç°æ€æƒ³å´ä¸ä¸€æ ·ï¼š</p><p>å†’æ³¡æ˜¯åœ¨ä»ç´¢å¼•ä¸º0çš„å…ƒç´ ç›¸é‚»ä¹‹é—´é€ä¸ªæ¯”è¾ƒï¼Œæœ€åæŠŠæœ€å¤§å…ƒç´ æ”¾åˆ°æœ€åï¼Œæ²¡é”™æ˜¯<strong>ç›¸é‚»ä¹‹é—´ï¼Œä¸€ç›´è¿›è¡Œæ¯”è¾ƒå’Œäº¤æ¢</strong>ã€‚</p><p>é€‰æ‹©æ’åºåˆæ˜¯åŸºäºå¦ä¸€ç§ç®—æ³•æ€æƒ³ï¼Œå‡å®šç´¢å¼•ä¸º0çš„å…ƒç´ æ˜¯æœ€å°ï¼Œéå†æ•°ç»„ï¼Œçœ‹æœ‰ä¸æœ‰æ›´å°çš„ï¼Œ<strong>ç›´åˆ°éå†å®Œå…¨ï¼Œä¿å­˜æœ€å°å…ƒç´ çš„ç´¢å¼•ï¼Œæœ€åè¿›è¡Œäº¤æ¢</strong>ï¼Œè€Œä¸æ˜¯æ¯æ¬¡ä¸€æ¯”è¾ƒå°±äº¤æ¢ã€‚</p><h1 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h1><p>æ’å…¥æ’åºå°±æ˜¯æŠŠæ•°ç»„åˆ†æˆæœ‰åºå’Œæ— åºçš„ä¸¤éƒ¨åˆ†ï¼Œæ¯æ¬¡å–åˆ°æ— åºéƒ¨åˆ†çš„å…ƒç´ ï¼ŒæŠŠå®ƒæ”¾åœ¨æœ‰åºéƒ¨åˆ†çš„åˆé€‚ä½ç½®ï¼Œå®ç°æ•°ç»„çš„é€æ­¥æœ‰åºåŒ–ã€‚</p><table><thead><tr><th></th><th>R[0]</th><th>R[1]</th><th>R[2]</th><th>R[3]</th><th>R[4]</th><th><strong>R[5]</strong></th></tr></thead><tbody><tr><td>åˆå§‹çŠ¶æ€</td><td>ï¼ˆ17ï¼‰</td><td>3</td><td>25</td><td>14</td><td>20</td><td>9</td></tr><tr><td>ç¬¬ä¸€æ¬¡æ’å…¥</td><td>ï¼ˆ3</td><td>17ï¼‰</td><td>25</td><td>14</td><td>20</td><td>9</td></tr><tr><td>ç¬¬äºŒæ¬¡æ’å…¥</td><td>ï¼ˆ3</td><td>17</td><td>25ï¼‰</td><td>14</td><td>20</td><td>9</td></tr><tr><td>ç¬¬ä¸‰æ¬¡æ’å…¥</td><td>ï¼ˆ3</td><td>14</td><td>17</td><td>25ï¼‰</td><td>20</td><td>9</td></tr><tr><td>ç¬¬å››æ¬¡æ’å…¥</td><td>ï¼ˆ3</td><td>14</td><td>17</td><td>20</td><td>25ï¼‰</td><td>9</td></tr><tr><td>ç¬¬äº”æ¬¡æ’å…¥</td><td>ï¼ˆ3</td><td>9</td><td>14</td><td>17</td><td>20</td><td>25ï¼‰</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[] insertSort(<span class="hljs-type">int</span>[] array)&#123;<br><span class="hljs-comment">//å¾…æ’å…¥çš„æ•°</span><br><span class="hljs-type">int</span> <span class="hljs-variable">insertVal</span> <span class="hljs-operator">=</span> array[<span class="hljs-number">1</span>];<br><span class="hljs-type">int</span> <span class="hljs-variable">insertIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> -<span class="hljs-number">1</span>; <span class="hljs-comment">//å³arr[1] çš„å‰é¢è¿™ä¸ªæ•°çš„ä¸‹æ ‡</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; array.length ; i++) &#123;<br>insertVal = array[i];<br>insertIndex = i -<span class="hljs-number">1</span>; <span class="hljs-comment">//å³arr[1] çš„å‰é¢è¿™ä¸ªæ•°çš„ä¸‹æ ‡</span><br><span class="hljs-comment">//insertIndex &gt;=0 ä¸è¶Šç•Œ</span><br><span class="hljs-comment">//insertVal &lt; array[insertIndex] è¯´æ˜insertValæ¯”æœ‰åºæ•°ç»„ä¸­çš„ä»»æ„æ•°éƒ½è¦å°ï¼ˆå› ä¸ºarray[insertIndex]å°±æ˜¯æœ€å¤§çš„ï¼‰</span><br><span class="hljs-comment">//ç°åœ¨éœ€è¦æ‰¾åˆ°insertValåˆé€‚çš„ä½ç½®å³å¯</span><br><span class="hljs-comment">//è‹¥ä¸æ»¡è¶³ï¼Œæ‹¿insertValæ¯”æœ‰åºæ•°ç»„æœ€å¤§çš„éƒ½å¤§ ç›´æ¥æ”¾åœ¨æœ‰åºæ•°ç»„çš„æœ€åé¢</span><br><span class="hljs-keyword">while</span> (insertIndex &gt;=<span class="hljs-number">0</span> &amp;&amp; insertVal &lt; array[insertIndex])&#123; <span class="hljs-comment">//æ’å…¥åˆ°æœ‰åºæ•°ç»„ä¸­</span><br>array[insertIndex + <span class="hljs-number">1</span>] = array[insertIndex];<br>insertIndex -- ; <span class="hljs-comment">//æ‰¾åˆ°å¾…æ’å…¥æ•°åˆé€‚çš„ä½ç½®</span><br>&#125;<br>array[insertIndex + <span class="hljs-number">1</span>] = insertVal;<br><span class="hljs-comment">// System.out.println(&quot;ç¬¬&quot;+i+&quot;è½®ï¼š&quot;+ Arrays.toString(array));</span><br>&#125;<br><span class="hljs-keyword">return</span> array;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h1><p>å¸Œå°”æ’åºæ˜¯é’ˆå¯¹æ™®é€šæ’å…¥æ’åºæ’åºå­˜åœ¨çš„é—®é¢˜è€Œæå‡ºçš„ï¼Œå‡å¦‚æ•°ç»„ä¸­è¾ƒå°çš„å…ƒç´ åœ¨æ•°ç»„çš„æœ«å°¾ï¼Œåœ¨æ‰¾æœ€åä¸€ä¸ªå…ƒç´ åˆé€‚ä½ç½®çš„æ—¶å€™ï¼Œwhileå¾ªç¯æ¬¡æ•°å¾ˆå¤šï¼Œæ•ˆç‡ä¸é«˜ï¼Œå¸Œå°”æ’åºé€šè¿‡è®¾ç½®å¢é‡å®ç°æ•ˆç‡çš„æå¤§æå‡ï¼</p><p><img src="https://i.loli.net/2021/02/18/YNhHqGIsFWmALw9.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ€æƒ³ç¡®å®å¾ˆå¥½ï¼Œç±»ä¼¼ä¸€ä¸ªå®è§‚è°ƒæ§ï¼Œå¯¹æ•°ç»„ç®€å•çš„å¾®è°ƒï¼Œæ— éœ€å¤§é‡ç§»åŠ¨æ“ä½œå³å¯å®Œæˆæ•´ä¸ªæ•°ç»„çš„æ’åºã€‚</p><p>ä½†é€šå¸¸æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œä¸€ç§æ˜¯äº¤æ¢æ³•ï¼Œåœ¨æ¯æ¬¡åˆ†ç»„åï¼Œå…ƒç´ å°±è¦å®Œæˆäº¤æ¢ï¼Œå°çš„åœ¨å‰ï¼Œå¤§çš„åœ¨åï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* äº¤æ¢æ³•<br>\* <span class="hljs-meta">@param</span> array<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shellSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array)</span>&#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> array.length;<br><span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> length / <span class="hljs-number">2</span>; n &gt;=<span class="hljs-number">1</span>; n/=<span class="hljs-number">2</span>) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n; i &lt; length; i++) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i -n; j &gt;= <span class="hljs-number">0</span>; j-=n)&#123;<br><span class="hljs-keyword">if</span> (array[j] &gt; array[j+n])&#123;<br>temp = array[j+n];<br>array[j+n] = array[j];<br>array[j] = temp;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ˜¯æœ€å¥½ç†è§£çš„ï¼Œä½†æ•ˆç‡ä½äºç”¨ç§»ä½æ³•å®ç°çš„å¸Œå°”æ’åº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* ç§»ä½æ³•<br>\* <span class="hljs-meta">@param</span> array<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shellSort2</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array)</span>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">gap</span> <span class="hljs-operator">=</span> array.length / <span class="hljs-number">2</span> ; gap &gt;=<span class="hljs-number">1</span> ; gap /= <span class="hljs-number">2</span>)&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> gap; i &lt; array.length; i++) &#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span>i;<br><span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> array[j];<br><span class="hljs-keyword">if</span> (array[j] &lt; array[j - gap])&#123;<br><span class="hljs-keyword">while</span> (j - gap &gt;=<span class="hljs-number">0</span> &amp;&amp; temp &lt; array[j - gap])&#123;<br>array[j] = array[j -gap];<br>j -= gap;<br>&#125;<br>array[j] = temp;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ**ç§»ä½æ³•ç±»ä¼¼æ’å…¥æ’åºï¼Œ**éƒ½æ˜¯whileå¾ªç¯æ‰¾åˆ°å…ƒç´ æœ€ç»ˆçš„ä½ç½®ï¼Œå†è¿›è¡Œç§»åŠ¨ï¼Œå‡å°‘å…ƒç´ äº¤æ¢æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚</p><h1 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h1><p>å¿«é€Ÿæ’åº(Quicksort)æ˜¯å¯¹å†’æ³¡æ’åºçš„ä¸€ç§æ”¹è¿›ã€‚</p><p>åŸºæœ¬æ€æƒ³æ˜¯:é€šè¿‡ä¸€è¶Ÿæ’åºå°† è¦æ’åºçš„æ•°æ®åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½æ¯”å¦å¤–ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½è¦å°ï¼Œç„¶åå†æŒ‰æ­¤æ–¹æ³•å¯¹è¿™ä¸¤éƒ¨åˆ†æ•°æ®åˆ†åˆ«è¿›è¡Œå¿«é€Ÿæ’åºï¼Œæ•´ä¸ªæ’åºè¿‡ç¨‹å¯ä»¥é€’å½’è¿›è¡Œï¼Œä»¥æ­¤è¾¾åˆ°æ•´ä¸ªæ•°æ®å˜æˆæœ‰åºåºåˆ—ã€‚</p><p>ä¸€å¥è¯æ¦‚æ‹¬ï¼š<strong>åˆ†ç»„æ’åºï¼</strong></p><p>æåˆ°åˆ†ç»„ï¼Œå¯èƒ½å¾ˆå¤šæœ‹å‹çœ‹åˆ°è¿™ä¼šæƒ³åˆ°åˆ†æ²»ç®—æ³•äº†å—ï¼Ÿè¿™é‡Œçš„æˆ‘è¯´æ˜¯åˆ†ç»„å°±æ˜¯é€’å½’çš„æ„æ€ï¼Œåé¢çš„å½’å¹¶æ’åºæ‰æ˜¯åˆ†æ²»ç®—æ³•çš„ä¸€ä¸ªå®è·µã€‚</p><p><img src="https://i.loli.net/2021/02/18/hklmtLKyszEUO8p.jpg"></p><p>å¿«æ’æœ‰å¾ˆå¤šå®ç°æ–¹æ³•ï¼Œä¸»è¦çš„åŒºåˆ«å°±æ˜¯é€‰å–çš„æ ‡å‡†ä¸ä¸€æ ·ï¼Œæœ‰ç‚¹æ‰¾æœ«å°¾ï¼Œæœ‰ç‚¹é€‰ä¸­é—´ï¼Œä½†æ“ä½œéƒ½æ˜¯å¤§åŒå°å¼‚ï¼Œé€šè¿‡æ ‡å‡†æ•°ç¬¬ä¸€æ¬¡æŠŠæ•°ç»„åˆ†æˆå·¦å³ä¸¤éƒ¨åˆ†ï¼Œç„¶åå¯¹å·¦å³ä¸¤éƒ¨åˆ†åˆ†åˆ«è¿›è¡Œé€’å½’ï¼Œé€’å½’ç»“æŸï¼Œæ•°ç»„ä¹Ÿå°±å˜å¾—æœ‰åºäº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quickSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array,<span class="hljs-type">int</span> left,<span class="hljs-type">int</span> right)</span>&#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">l</span> <span class="hljs-operator">=</span> left;<br><span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> right;<br><span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">//pivot ä¸­è½´</span><br><span class="hljs-type">int</span> <span class="hljs-variable">pivot</span> <span class="hljs-operator">=</span> array[(left + right) / <span class="hljs-number">2</span>];<br><span class="hljs-keyword">while</span> (l &lt; r)&#123;<br><span class="hljs-keyword">while</span> (array[l] &lt; pivot)&#123;<br>++l;<br>&#125;<br><span class="hljs-keyword">while</span> (array[r] &gt; pivot)&#123;<br>--r;<br>&#125;<br><span class="hljs-keyword">if</span> (l &gt;= r)&#123;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>temp = array[l];<br>array[l] = array[r];<br>array[r] = temp;<br><span class="hljs-keyword">if</span> (array[<span class="hljs-number">1</span>] == pivot)&#123;<br>--r;<br>&#125;<br><span class="hljs-keyword">if</span> (array[r] == pivot)&#123;<br>++l;<br>&#125;<br>&#125;<br><span class="hljs-comment">//é˜²æ­¢l = r å¾ˆé‡è¦ï¼</span><br><span class="hljs-keyword">if</span> (l == r)&#123;<br>++l;<br>--r;<br>&#125;<br><span class="hljs-comment">//å‘å·¦é€’å½’</span><br><span class="hljs-keyword">if</span> (left &lt; r)&#123;<br>quickSort(array,left,r);<br>&#125;<br><span class="hljs-comment">//å‘å³é€’å½’</span><br><span class="hljs-keyword">if</span> (right &gt; l)&#123;<br>quickSort(array,l,right);<br>&#125;<br><span class="hljs-comment">//System.out.println(Arrays.toString(array));</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬æµ‹è¯•ä¸‹äº”ç§æ’åºç®—æ³•çš„æ•ˆç‡</p><p>éšæœºç”Ÿæˆ10Wæ¡æ•°æ®çš„æ•°ç»„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">int</span>[] array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">100000</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) &#123;<br>array[i] = (<span class="hljs-type">int</span>) (Math.random()\*<span class="hljs-number">100000</span>);<br>&#125;<br><span class="hljs-comment">// int[] array = &#123;2,5,3,6,9,4,500,200,40&#125;;</span><br><span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br><span class="hljs-comment">// bubble(array); //æ‰€èŠ±è´¹æ—¶é—´17411ms</span><br><span class="hljs-comment">// select(array); //æ‰€èŠ±è´¹æ—¶é—´3229ms</span><br><span class="hljs-comment">// insert(array); //æ‰€èŠ±è´¹æ—¶é—´1003ms</span><br><span class="hljs-comment">// shell(array); //æ‰€èŠ±è´¹æ—¶é—´18ms</span><br>quick(array); <span class="hljs-comment">//æ‰€èŠ±è´¹æ—¶é—´22ms</span><br><span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>System.out.println(<span class="hljs-string">&quot;æ‰€èŠ±è´¹æ—¶é—´&quot;</span>+(end - start) +<span class="hljs-string">&quot;ms&quot;</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bubble</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array)</span>&#123;<br>BubbleSort.bubbleSort(array);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array)</span>&#123;<br>SelectSort.selectSort(array);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array)</span>&#123;<br>InsertSort.insertSort(array);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shell</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array)</span>&#123;<br>ShellSort.shellSort2(array);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quick</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array)</span>&#123;<br>QuickSort.quickSort(array,<span class="hljs-number">0</span>,array.length -<span class="hljs-number">1</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¸Œå°”æ’åºå’Œå¿«æ’æ•ˆç‡ç¡®å®è¾ƒå‰ä¸‰ç§æ’åºç®—æ³•è¦é«˜å¾ˆå¤šï¼Œåé¢çš„ä¸‰ç§æ’åºæ”¾ä¸‹ä¸€ç¯‡è®²!</p>]]></content>
    
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆå››ï¼‰</title>
    <link href="/2021/01/26/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%B3%BB%E5%88%97%EF%BC%88%E5%9B%9B%EF%BC%89/"/>
    <url>/2021/01/26/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%B3%BB%E5%88%97%EF%BC%88%E5%9B%9B%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h2 id="JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆå››ï¼‰"><a href="#JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆå››ï¼‰" class="headerlink" title="JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆå››ï¼‰"></a>JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆå››ï¼‰</h2><h2 id="17-Volatile"><a href="#17-Volatile" class="headerlink" title="17.Volatile"></a>17.Volatile</h2><blockquote><p>1.ä¿è¯å¯è§æ€§</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Volatileçš„å¯è§æ€§<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">20</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JMMDemo1</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">//ä¸»å­˜ä¸­numå·²ç»ç½®ä¸º10 ä½†çº¿ç¨‹ä¸­æœªå¾—åˆ°ä¿¡æ¯ é™·å…¥æ­»å¾ªç¯</span><br><span class="hljs-comment">//åŠ å…¥Volatile ä¿è¯å¯è§æ€§</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br><span class="hljs-keyword">while</span> (num == <span class="hljs-number">0</span>)&#123;<br>&#125;<br>&#125;).start();<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>num = <span class="hljs-number">10</span>;<br>System.out.println(<span class="hljs-string">&quot;num:&quot;</span>+num);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šä¸€ç¯‡çš„JMMä¸­ï¼Œæˆ‘ä»¬æåˆ°ï¼ŒJMMæ˜¯ä¸èƒ½ä¿è¯å¯è§æ€§çš„ï¼Œmainçº¿ç¨‹ä¸­æŠŠnumç½®ä¸º10äº†ï¼Œä½†æ–°å¼€çš„çº¿ç¨‹ç”±äºä¸çŸ¥é“åˆ°æŠŠnumç½®ä¸º10ï¼Œä¸€ç›´åœ¨whileå¾ªç¯ä¸­è·³ä¸å‡ºæ¥ï¼Œç¨‹åºå‡ºç°æ­»å¾ªç¯ï¼Œè§£å†³çš„åŠæ³•å°±æ˜¯åœ¨numçš„å£°æ˜ä¸­åŠ å…¥volatileï¼Œä¿è¯çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼</p><blockquote><p>2.ä¸ä¿è¯åŸå­æ€§</p></blockquote><p>åŸå­æ€§ : ä¸å¯åˆ†å‰²</p><p>çº¿ç¨‹Aåœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œä¸èƒ½è¢«æ‰“æ‰°çš„ï¼Œä¹Ÿä¸èƒ½è¢«åˆ†å‰²ã€‚è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Volatileä¸ä¿è¯åŸå­æ€§<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">20</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JMMDemo2</span> &#123;<br><span class="hljs-comment">//åŠ äºä¸åŠ  volatile å‡ä¸èƒ½ä¿è¯åŸå­æ€§</span><br><span class="hljs-comment">//è§£å†³æ–¹æ³•</span><br>/\*\*<br>\* <span class="hljs-number">1.</span>åŠ syncä¿è¯addçš„åŒæ­¥æ€§<br>\* <span class="hljs-number">2.</span>åŠ lock åŸç†å’Œsyncä¸€æ · ä¸æ¼”ç¤º<br>\* <span class="hljs-number">3.</span><span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>();<br>\*/<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span>&#123;<br>num++;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//ç†è®ºæ˜¯num åº”è¯¥æ˜¯2ä¸‡</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">20</span>; i++) &#123;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= <span class="hljs-number">1000</span>; j++) &#123;<br>add();<br>&#125;<br>&#125;).start();<br>&#125;<br><span class="hljs-keyword">while</span> (Thread.activeCount()&gt;<span class="hljs-number">2</span>)&#123; <span class="hljs-comment">//åªæœ‰ main gc</span><br>Thread.<span class="hljs-keyword">yield</span>();<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;num:&quot;</span>+num);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç†è®ºä¸Šï¼Œæœ€åè¾“å‡ºçš„numæ˜¯20000ï¼Œä½†ç»“è¯¾ç¡®å§‹ç»ˆè¾¾ä¸åˆ°ã€‚</p><p>å¯ä»¥åˆ°è¿™å¾ˆå¤šæœ‹å‹ä¼šæƒ³åˆ°ç”¨é”ï¼Œ<strong>åŠ å…¥syncæˆ–è€…lockä¿è¯çº¿ç¨‹çš„åŒæ­¥</strong>ï¼Œæ²¡é”™è¿™ä¸ªæ–¹æ³•å¯ä»¥è¾¾åˆ°æˆ‘ä»¬çš„é¢„æœŸï¼</p><p>ä½†è‹¥ä¸åŠ syncæˆ–è€…locké”ï¼Œæ€ä¹ˆä¿è¯åŸå­æ€§å‘¢ï¼Ÿ</p><p>åœ¨åç¼–è¯‘æºæ–‡ä»¶åï¼Œå‘ç°æœ€å¤§çš„é—®é¢˜æ˜¯è¿™ä¸ªnum++æ–¹æ³•ä¸æ˜¯åŸå­æ€§æ“ä½œï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨JDKæä¾›çš„åŸå­ç±»æ¥è§£å†³åŸå­æ€§é—®é¢˜ï¼</p><p><img src="https://i.loli.net/2021/01/26/vcGlPztmZ2W3j1M.jpg"></p><p>å¯ä»¥å‘ç°åŸå­ç±»æ˜¯utilä¸‹çš„ä¸€ä¸ªå¤§ç±»ï¼Œé‡Œé¢æœ‰å¾ˆå¤šåŸºæœ¬ç±»å‹å’Œé›†åˆçš„åŸå­ç±»</p><p>å¼•å…¥åŸå­ç±»ï¼Œæ”¹é€ æˆ‘ä»¬çš„ä»£ç ï¼Œå®ç°Volatileä¿è¯åŸå­æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Volatileä¸ä¿è¯åŸå­æ€§<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">20</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JMMDemo2</span> &#123;<br><span class="hljs-comment">//åŠ äºä¸åŠ  volatile å‡ä¸èƒ½ä¿è¯åŸå­æ€§</span><br><span class="hljs-comment">//è§£å†³æ–¹æ³•</span><br>/\*\*<br>\* <span class="hljs-number">1.</span>åŠ syncä¿è¯addçš„åŒæ­¥æ€§<br>\* <span class="hljs-number">2.</span>åŠ lock åŸç†å’Œsyncä¸€æ · ä¸æ¼”ç¤º<br>\* <span class="hljs-number">3.</span><span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>();<br>\*/<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>();<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span>&#123;<br>num.getAndIncrement();<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//ç†è®ºæ˜¯num åº”è¯¥æ˜¯2ä¸‡</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">20</span>; i++) &#123;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= <span class="hljs-number">1000</span>; j++) &#123;<br>add();<br>&#125;<br>&#125;).start();<br>&#125;<br><span class="hljs-keyword">while</span> (Thread.activeCount()&gt;<span class="hljs-number">2</span>)&#123; <span class="hljs-comment">//åªæœ‰ main gc</span><br>Thread.<span class="hljs-keyword">yield</span>();<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;num:&quot;</span>+num);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŸå­ç±»çš„åº•å±‚ç›´æ¥ä¸æ“ä½œç³»ç»ŸæŒ‚é’©ï¼Œåœ¨å†…å­˜ä¸­ä¿®æ”¹å€¼ï¼Œå¾ˆå®‰å…¨ï¼</p><blockquote><p>3.ç¦æ­¢æŒ‡ä»¤é‡æ’</p></blockquote><p>ä»€ä¹ˆæ˜¯ æŒ‡ä»¤é‡æ’ï¼š<strong>ä½ å†™çš„ç¨‹åºï¼Œè®¡ç®—æœºå¹¶ä¸æ˜¯æŒ‰ç…§ä½ å†™çš„é‚£æ ·å»æ‰§è¡Œçš„ã€‚</strong></p><p>æºä»£ç â€“&gt;ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’â€“&gt; æŒ‡ä»¤å¹¶è¡Œä¹Ÿå¯èƒ½ä¼šé‡æ’â€“&gt; å†…å­˜ç³»ç»Ÿä¹Ÿä¼šé‡æ’â€”&gt; æ‰§è¡Œ</p><p><strong>å¤„ç†å™¨åœ¨è¿›è¡ŒæŒ‡ä»¤é‡æ’çš„æ—¶å€™ï¼Œè€ƒè™‘ï¼šæ•°æ®ä¹‹é—´çš„ä¾èµ–æ€§</strong>ã€‚</p><p>å•çº¿ç¨‹ç¯å¢ƒé‡Œé¢ç¡®ä¿ç¨‹åºæœ€ç»ˆæ‰§è¡Œç»“æœå’Œä»£ç é¡ºåºæ‰§è¡Œç»“æœä¸€è‡´ã€‚</p><p>å¤„ç†å™¨åœ¨è¿›è¡ŒæŒ‡ä»¤é‡æ’åºæ—¶å¿…é¡»è€ƒè™‘æŒ‡ä»¤ä¹‹é—´çš„<strong>æ•°æ®ä¾èµ–æ€§</strong></p><p>å¤šçº¿ç¨‹ç¯å¢ƒä¸­çº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œç”±äºç¼–è¯‘å™¨æŒ‡ä»¤é‡æ’çš„å­˜åœ¨ï¼Œä¸¤ä¸ªçº¿ç¨‹ä½¿ç”¨çš„å˜é‡èƒ½å¦ä¿è¯ä¸€è‡´æ€§æ˜¯æ— æ³•ç¡®è®¤çš„ï¼Œç»“æœæ— æ³•é¢„æµ‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">// 1</span><br><span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; <span class="hljs-comment">// 2</span><br>x = x + <span class="hljs-number">5</span>; <span class="hljs-comment">// 3</span><br>y = x \* x; <span class="hljs-comment">// 4</span><br>æˆ‘ä»¬æ‰€æœŸæœ›çš„ï¼š<span class="hljs-number">1234</span> ä½†æ˜¯å¯èƒ½æ‰§è¡Œçš„æ—¶å€™å›å˜æˆ <span class="hljs-number">2134</span> <span class="hljs-number">1324</span><br>å¯ä¸å¯èƒ½æ˜¯ <span class="hljs-number">4123</span>ï¼Ÿ å½“ç„¶å¯èƒ½ï¼<br></code></pre></td></tr></table></figure><p>å¯èƒ½é€ æˆå½±å“çš„ç»“æœï¼š a b x y è¿™å››ä¸ªå€¼é»˜è®¤éƒ½æ˜¯ 0ï¼›</p><table><thead><tr><th>çº¿ç¨‹A</th><th>çº¿ç¨‹B</th></tr></thead><tbody><tr><td>x&#x3D;a</td><td>y&#x3D;b</td></tr><tr><td>b&#x3D;1</td><td>a&#x3D;2</td></tr></tbody></table><p>æ­£å¸¸çš„ç»“æœï¼š x &#x3D; 0ï¼›y &#x3D; 0ï¼›ä½†æ˜¯å¯èƒ½ç”±äºæŒ‡ä»¤é‡æ’</p><table><thead><tr><th>çº¿ç¨‹A</th><th>çº¿ç¨‹B</th></tr></thead><tbody><tr><td>b&#x3D;1</td><td>a&#x3D;2</td></tr><tr><td>x&#x3D;a</td><td>y&#x3D;b</td></tr></tbody></table><p>ç”±äºæŒ‡ä»¤é‡æ’å¯¼è‡´ï¼šx &#x3D; 2ï¼›y &#x3D; 1ï¼›</p><blockquote><p>ç¦æ­¢æŒ‡ä»¤é‡æ’åº•å±‚åŸç†</p></blockquote><p>volatileå®ç°ç¦æ­¢æŒ‡ä»¤é‡æ’ä¼˜åŒ–ï¼Œä»è€Œé¿å…å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç¨‹åºå‡ºç°ä¹±åºæ‰§è¡Œçš„ç°è±¡</p><p>â€‹ å…ˆäº†è§£ä¸‹æ¦‚å¿µï¼Œå†…å­˜å±éšœï¼ˆMemory Barrierï¼‰åˆç§°å†…å­˜æ …æ ï¼Œæ˜¯ä¸€ä¸ªCPUæŒ‡ä»¤ï¼Œå®ƒçš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼š</p><ul><li><strong>ä¿è¯ç‰¹å®šæ“ä½œæ‰§è¡Œçš„é¡ºåºæ€§</strong></li><li><strong>ä¿è¯æŸäº›å˜é‡çš„å†…å­˜å¯è§æ€§ï¼ˆåˆ©ç”¨è¯¥ç‰¹æ€§å®ç°volatileå†…å­˜å¯è§æ€§ï¼‰</strong></li></ul><p><strong>volatileå®ç°ç¦æ­¢æŒ‡ä»¤é‡æ’ä¼˜åŒ–åº•å±‚åŸç†ï¼š</strong></p><p>â€‹ <strong>ç”±äºç¼–è¯‘å™¨å’Œå¤„ç†å™¨éƒ½èƒ½æ‰§è¡ŒæŒ‡ä»¤é‡æ’ä¼˜åŒ–ã€‚å¦‚æœåœ¨æŒ‡ä»¤é—´æ’å…¥ä¸€æ¡Memory Barrieråˆ™ä¼šå‘Šè¯‰ç¼–è¯‘å™¨å’ŒCPUï¼Œä¸ç®¡ä»€ä¹ˆæŒ‡ä»¤éƒ½ä¸èƒ½å’Œè¿™æ¡Memory BarrieræŒ‡ä»¤é‡æ’ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡æ’å…¥å†…å­˜å±éšœï¼Œå°±èƒ½ç¦æ­¢åœ¨å†…å­˜å±éšœå‰åçš„æŒ‡ä»¤æ‰§è¡Œé‡æ’ä¼˜åŒ–ã€‚å†…å­˜å±éšœå¦å¤–ä¸€ä¸ªä½œç”¨å°±æ˜¯å¼ºåˆ¶åˆ·å‡ºå„ç§CPUçš„ç¼“å­˜æ•°æ®ï¼Œå› æ­¤ä»»ä½•CPUä¸Šçš„çº¿ç¨‹éƒ½èƒ½è¯»å–åˆ°è¿™äº›æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ã€‚</strong></p><p>å·¦è¾¹ï¼šå†™æ“ä½œåœºæ™¯ï¼šå…ˆLoadStoreæŒ‡ä»¤ï¼ŒåLoadLoadæŒ‡ä»¤ã€‚</p><p>å³è¾¹ï¼šè¯»æ“ä½œåœºæ™¯ï¼šå…ˆLoadLoadæŒ‡ä»¤ï¼ŒåLoadStoreæŒ‡ä»¤ã€‚</p><p><img src="https://i.loli.net/2021/01/26/RV6zv3EgCxfKstw.jpg"></p><h2 id="18-å•ä¾‹æ¨¡å¼"><a href="#18-å•ä¾‹æ¨¡å¼" class="headerlink" title="18.å•ä¾‹æ¨¡å¼"></a>18.å•ä¾‹æ¨¡å¼</h2><p>æ‰‹å†™å•ä¾‹æ¨¡å¼ä¹Ÿæ˜¯é¢è¯•å¿…è€ƒçš„çŸ¥è¯†ç‚¹ï¼</p><blockquote><p>é¥¿æ±‰å¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*é¥¿æ±‰å¼å•ä¾‹<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">22</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hungry</span> &#123;<br><span class="hljs-comment">//å¯èƒ½ä¼šæµªè´¹ç©ºé—´</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] data1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>\*<span class="hljs-number">1024</span>];<br><span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] data2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>\*<span class="hljs-number">1024</span>];<br><span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] data3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>\*<span class="hljs-number">1024</span>];<br><span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] data4 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>\*<span class="hljs-number">1024</span>];<br><span class="hljs-keyword">private</span> <span class="hljs-title function_">Hungry</span><span class="hljs-params">()</span>&#123;<br>&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Hungry</span> <span class="hljs-variable">HUNGRY</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hungry</span>();<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Hungry <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">return</span> HUNGRY;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>DCl é¥¿æ±‰å¼</p></blockquote><p>è¿™é‡Œé€šè¿‡å¤šé‡æ£€æµ‹ï¼Œä½†æœ€ç»ˆéƒ½èƒ½è¢«åå°„ç ´åï¼Œäºæ˜¯å¼•å…¥<strong>æšä¸¾</strong>å³å¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼</p><p>ä¸Šä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-keyword">enum</span>ï¼Ÿ æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç±»<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">22</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">EnumSingle</span> &#123;<br>INSTANCE;<br><span class="hljs-keyword">public</span> EnumSingle <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">return</span> INSTANCE;<br>&#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-type">EnumSingle</span> <span class="hljs-variable">instance1</span> <span class="hljs-operator">=</span> EnumSingle.INSTANCE;<br><span class="hljs-comment">//Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Cannot reflectively create enum objects</span><br><span class="hljs-comment">// at java.lang.reflect.Constructor.newInstance(Constructor.java:417)</span><br><span class="hljs-comment">//æœ‰å‚æ„é€  å¹¶éæ— å‚!!!!!!!!!!!</span><br>Constructor&lt;EnumSingle&gt; declaredConstructor = EnumSingle.class.getDeclaredConstructor(String.class,<span class="hljs-type">int</span>.class);<br>declaredConstructor.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-type">EnumSingle</span> <span class="hljs-variable">instance2</span> <span class="hljs-operator">=</span> declaredConstructor.newInstance();<br><span class="hljs-comment">//æ­£å¸¸ throw new IllegalArgumentException(&quot;Cannot reflectively create enum objects&quot;);</span><br><span class="hljs-comment">//java.lang.NoSuchMethodException: com.dev.single.EnumSingle.&lt;init&gt;()</span><br>System.out.println(instance1);<br>System.out.println(instance2);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* æ‡’æ±‰å¼å•ä¾‹<br>\* é“é«˜ä¸€å°ºé­”é«˜ä¸€ä¸ˆ<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">22</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyMan</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">luffy</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-title function_">LazyMan</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//ç¬¬ä¸‰é‡æ£€æµ‹</span><br><span class="hljs-keyword">synchronized</span> (LazyMan.class)&#123;<br><span class="hljs-keyword">if</span> (luffy == <span class="hljs-literal">false</span>)&#123;<br>luffy = <span class="hljs-literal">true</span>;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;ä¸è¦è¯•å›¾ç”¨åå°„ç ´å&quot;</span>);<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> LazyMan lazyMan;<br><span class="hljs-comment">//åŒé‡æ£€æµ‹é”æ¨¡å¼ DCL æ‡’æ±‰å¼å•ä¾‹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LazyMan <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//åŠ é”</span><br><span class="hljs-keyword">if</span> (lazyMan == <span class="hljs-literal">null</span>)&#123;<br><span class="hljs-keyword">synchronized</span> (LazyMan.class)&#123;<br><span class="hljs-keyword">if</span> (lazyMan == <span class="hljs-literal">null</span>)&#123;<br>lazyMan = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazyMan</span>(); <span class="hljs-comment">//ä¸æ˜¯åŸå­æ€§æ“ä½œ</span><br>/\*\*<br>\* <span class="hljs-number">1.</span>åˆ†é…å†…å­˜ç©ºé—´<br>\* <span class="hljs-number">2.</span>æ‰§è¡Œæ„é€ æ–¹æ³•ï¼Œåˆå§‹åŒ–å¯¹è±¡<br>\* <span class="hljs-number">3.</span>æŠŠå¯¹è±¡æŒ‡å‘åœ¨è¿™ä¸ªç©ºé—´<br>\*<br>\* å¯èƒ½å‘ç”ŸæŒ‡ä»¤é‡æ’<br>\*<br>\* <span class="hljs-number">123</span><br>\* <span class="hljs-number">132</span><br>\*/<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> lazyMan;<br>&#125;<br><span class="hljs-comment">//å•çº¿ç¨‹ä¸‹OK</span><br><span class="hljs-comment">//å¹¶å‘ä¸‹</span><br><span class="hljs-comment">// public static void main(String[] args) &#123;</span><br><span class="hljs-comment">// for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="hljs-comment">// new Thread(()-&gt;&#123;</span><br><span class="hljs-comment">// LazyMan.getInstance();</span><br><span class="hljs-comment">// &#125;).start();</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">//åå°„</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-comment">// LazyMan instance1= LazyMan.getInstance();</span><br><span class="hljs-comment">//ç ´ç¯å¯†é’¥çš„ç§æœ‰æƒé™</span><br><span class="hljs-type">Field</span> <span class="hljs-variable">luffy</span> <span class="hljs-operator">=</span> LazyMan.class.getDeclaredField(<span class="hljs-string">&quot;luffy&quot;</span>);<br>luffy.setAccessible(<span class="hljs-literal">true</span>);<br>Constructor&lt;LazyMan&gt; declaredConstructor = LazyMan.class.getDeclaredConstructor(<span class="hljs-literal">null</span>);<br>declaredConstructor.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-comment">//ä¸¤ä¸ªç”¨åå°„åˆ›å»ºå®ä¾‹</span><br><span class="hljs-comment">// LazyMan instance1 = declaredConstructor.newInstance();4</span><br><span class="hljs-comment">//ä½¿ç”¨æšä¸¾ è‡ªå¸¦å•ä¾‹ å³å¯è§£å†³ï¼</span><br><span class="hljs-type">EnumSingle</span> <span class="hljs-variable">instance1</span> <span class="hljs-operator">=</span> EnumSingle.INSTANCE;<br><span class="hljs-type">EnumSingle</span> <span class="hljs-variable">instance2</span> <span class="hljs-operator">=</span> EnumSingle.INSTANCE;<br>luffy.set(instance1,<span class="hljs-literal">false</span>);<br><span class="hljs-comment">// LazyMan instance2 = declaredConstructor.newInstance();</span><br>System.out.println(instance1.hashCode());<br>System.out.println(instance2.hashCode());<br>&#125;<br></code></pre></td></tr></table></figure><p>æšä¸¾Enumæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œå…¶å®ä¸€æ—¦ä¸€ä¸ªç±»å£°æ˜ä¸ºæšä¸¾ï¼Œå®é™…ä¸Šå°±æ˜¯ç»§æ‰¿äº†Enumï¼Œæ‰€ä»¥ä¼šæœ‰ï¼ˆString.class,int.classï¼‰çš„æ„é€ å™¨ã€‚æ—¢ç„¶æ˜¯å¯ä»¥è·å–åˆ°çˆ¶ç±»Enumçš„æ„é€ å™¨ï¼Œé‚£ä½ ä¹Ÿè®¸ä¼šè¯´åˆšæ‰æˆ‘çš„åå°„æ˜¯å› ä¸ºè‡ªèº«çš„ç±»<strong>æ²¡æœ‰æ— å‚æ„é€ æ–¹æ³•æ‰å¯¼è‡´çš„å¼‚å¸¸</strong>ï¼Œå¹¶ä¸èƒ½è¯´å•ä¾‹æšä¸¾é¿å…äº†åå°„æ”»å‡»ã€‚</p><p>è¿™é‡Œæœ‰ç¯‡åšå®¢å†™çš„ä¸é”™ï¼š</p><p><a href="https://www.cnblogs.com/chiclee/p/9097772.html">ä¸ºä»€ä¹ˆè¦ç”¨æšä¸¾å®ç°å•ä¾‹æ¨¡å¼ï¼ˆé¿å…åå°„ã€åºåˆ—åŒ–é—®é¢˜ï¼‰</a></p><h2 id="19-æ·±å…¥ç†è§£CAS"><a href="#19-æ·±å…¥ç†è§£CAS" class="headerlink" title="19.æ·±å…¥ç†è§£CAS"></a>19.æ·±å…¥ç†è§£CAS</h2><blockquote><p>ä»€ä¹ˆæ˜¯CAS</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* CAS æ¯”è¾ƒå¹¶æ“ä½œ<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">22</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CASDemo1</span> &#123;<br><span class="hljs-comment">//CAS compareAndSetï¼šæ¯”è¾ƒå¹¶äº¤æ¢</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">atomicInteger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">2020</span>);<br><span class="hljs-comment">//æœŸæœ›ã€æ›´æ–°</span><br><span class="hljs-comment">//æœŸæœ›è¾¾åˆ°ï¼Œå°±æ›´æ–°</span><br><span class="hljs-comment">//CAS CPUçš„</span><br>System.out.println(atomicInteger.compareAndSet(<span class="hljs-number">2020</span>, <span class="hljs-number">2022</span>));<br>System.out.println(atomicInteger.get());<br>atomicInteger.getAndIncrement();<br>System.out.println(atomicInteger.compareAndSet(<span class="hljs-number">2023</span>, <span class="hljs-number">2022</span>));<br>System.out.println(atomicInteger.get());<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹åŸå­ç±»æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AtomicInteger</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Number</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">java</span>.io.Serializable &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">6214790243416807050L</span>;<br><span class="hljs-comment">// setup to use Unsafe.compareAndSwapInt for updates</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Unsafe</span> <span class="hljs-variable">unsafe</span> <span class="hljs-operator">=</span> Unsafe.getUnsafe();<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> valueOffset;<br><span class="hljs-keyword">static</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br>valueOffset = unsafe.objectFieldOffset<br>(AtomicInteger.class.getDeclaredField(<span class="hljs-string">&quot;value&quot;</span>));<br>&#125; <span class="hljs-keyword">catch</span> (Exception ex) &#123; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(ex); &#125;<br>&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> value;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨çš„Unsafeç±»ï¼Œè¿›å…¥Unsafeå‘ç°éƒ½æ˜¯å¤§å¤šæ•°éƒ½æ˜¯Nativeæ–¹æ³•ï¼Œè¯´æ˜Javaå¹¶ä¸èƒ½ç›´æ¥æ“ä½œå†…å­˜ï¼Œè€Œæ˜¯æ“ä½œC++å»æ“ä½œå†…å­˜ï¼Œå®ç°CASï¼Œæ‰€ä»¥CASæ•ˆç‡å·¨é«˜ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAndAddInt</span><span class="hljs-params">(Object var1, <span class="hljs-type">long</span> var2, <span class="hljs-type">int</span> var4)</span> &#123;<br><span class="hljs-type">int</span> var5;<br><span class="hljs-keyword">do</span> &#123;<br>var5 = <span class="hljs-built_in">this</span>.getIntVolatile(var1, var2);<br>&#125; <span class="hljs-keyword">while</span>(!<span class="hljs-built_in">this</span>.compareAndSwapInt(var1, var2, var5, var5 + var4)); <span class="hljs-comment">//è‡ªæ—‹é”å®ç°</span><br><span class="hljs-keyword">return</span> var5;<br>&#125;<br></code></pre></td></tr></table></figure><p>CAS ï¼š æ¯”è¾ƒå½“å‰å·¥ä½œå†…å­˜ä¸­çš„å€¼å’Œä¸»å†…å­˜ä¸­çš„å€¼ï¼Œå¦‚æœè¿™ä¸ªå€¼æ˜¯æœŸæœ›çš„ï¼Œé‚£ä¹ˆåˆ™æ‰§è¡Œæ“ä½œï¼å¦‚æœä¸æ˜¯å°±</p><p>ä¸€ç›´å¾ªç¯ï¼</p><p>ç¼ºç‚¹ï¼š</p><p>1ã€ å¾ªç¯ä¼šè€—æ—¶</p><p>2ã€ä¸€æ¬¡æ€§åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ€§</p><p>3ã€<strong>ABAé—®é¢˜</strong></p><p>ABAé—®é¢˜ä¹Ÿæ˜¯é¢è¯•å¸¸é—®çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ¢ç©¶ä¸‹ABAé—®é¢˜</p><blockquote><p>CASï¼šABAé—®é¢˜</p></blockquote><p><img src="https://i.loli.net/2021/01/26/SPsQUwr6xEMqK48.jpg"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* CAS æ¯”è¾ƒå¹¶æ“ä½œ<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">22</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CASDemo1</span> &#123;<br><span class="hljs-comment">//CAS compareAndSetï¼šæ¯”è¾ƒå¹¶äº¤æ¢</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">atomicInteger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">2020</span>);<br><span class="hljs-comment">//æœŸæœ›ã€æ›´æ–°</span><br><span class="hljs-comment">//æœŸæœ›è¾¾åˆ°ï¼Œå°±æ›´æ–°</span><br><span class="hljs-comment">//CAS CPUçš„</span><br>System.out.println(atomicInteger.compareAndSet(<span class="hljs-number">2020</span>, <span class="hljs-number">2022</span>));<br>System.out.println(atomicInteger.get());<br>atomicInteger.getAndIncrement();<br>System.out.println(atomicInteger.compareAndSet(<span class="hljs-number">2023</span>, <span class="hljs-number">2022</span>));<br>System.out.println(atomicInteger.get());<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="20-åŸå­å¼•ç”¨"><a href="#20-åŸå­å¼•ç”¨" class="headerlink" title="20.åŸå­å¼•ç”¨"></a>20.åŸå­å¼•ç”¨</h2><blockquote><p>è§£å†³ABAé—®é¢˜ï¼Œå¼•å…¥åŸå­å¼•ç”¨ï¼ç±»ä¼¼ä¹è§‚é”</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* CAS è§£å†³ABAé—®é¢˜<br>\* ç±»ä¼¼ä¹è§‚é”ï¼ï¼<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">22</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CASDemo2</span> &#123;<br><span class="hljs-comment">//Integerä½¿ç”¨äº†å¯¹è±¡ç¼“å­˜æœºåˆ¶,é»˜è®¤èŒƒå›´æ˜¯-128 ~ 127æ¨èä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•valueOfè·å–å¯¹è±¡å®ä¾‹,</span><br><span class="hljs-comment">// è€Œä¸æ˜¯new ,å› ä¸ºvalueOfä½¿ç”¨ç¼“å­˜,è€Œnew -å®šä¼šåˆ›å»ºæ–°çš„å¯¹è±¡åˆ†é…æ–°çš„å†…å­˜ç©ºé—´;</span><br><span class="hljs-comment">//CAS compareAndSetï¼šæ¯”è¾ƒå¹¶äº¤æ¢</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>AtomicStampedReference&lt;Integer&gt; atomicStampedReference = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicStampedReference</span>&lt;Integer&gt;(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> atomicStampedReference.getStamp();<br>System.out.println(<span class="hljs-string">&quot;a1=&gt;&quot;</span>+atomicStampedReference.getStamp());<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>atomicStampedReference.compareAndSet(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,atomicStampedReference.getStamp(),atomicStampedReference.getStamp()+<span class="hljs-number">1</span>);<br>System.out.println(<span class="hljs-string">&quot;a2=&gt;&quot;</span>+atomicStampedReference.getStamp());<br>atomicStampedReference.compareAndSet(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,atomicStampedReference.getStamp(),atomicStampedReference.getStamp()+<span class="hljs-number">1</span>);<br>System.out.println(<span class="hljs-string">&quot;a3=&gt;&quot;</span>+atomicStampedReference.getStamp());<br>&#125;,<span class="hljs-string">&quot;a&quot;</span>).start();<br><span class="hljs-comment">//å¦å¤–ä¸€ä¸ªçº¿ç¨‹</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> atomicStampedReference.getStamp();<br>System.out.println(<span class="hljs-string">&quot;b1=&gt;&quot;</span>+stamp);<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>atomicStampedReference.compareAndSet(<span class="hljs-number">1</span>,<span class="hljs-number">6</span>,atomicStampedReference.getStamp(),atomicStampedReference.getStamp()+<span class="hljs-number">1</span>);<br>System.out.println(<span class="hljs-string">&quot;b2=&gt;&quot;</span>+atomicStampedReference.getStamp());<br>&#125;,<span class="hljs-string">&quot;b&quot;</span>).start();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p>a1&#x3D;&gt;1<br>b1&#x3D;&gt;1<br>a2&#x3D;&gt;2<br>b2&#x3D;&gt;2<br>a3&#x3D;&gt;3</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡åœ¨ä¿®æ”¹æ•°æ®åè·å–stampï¼ˆç±»ä¼¼ç‰ˆæœ¬å·ï¼‰ï¼Œéƒ½åœ¨+1ï¼Œè®©çº¿ç¨‹çŸ¥é“è‡ªå·±è·å–åˆ°çš„å€¼æ˜¯è¢«ä¿®æ”¹è¿‡çš„ã€‚</p><h2 id="21-å„ç§é”çš„ç†è§£"><a href="#21-å„ç§é”çš„ç†è§£" class="headerlink" title="21.å„ç§é”çš„ç†è§£"></a>21.å„ç§é”çš„ç†è§£</h2><h3 id="1-å…¬å¹³é”å’Œéå…¬å¹³é”"><a href="#1-å…¬å¹³é”å’Œéå…¬å¹³é”" class="headerlink" title="1.å…¬å¹³é”å’Œéå…¬å¹³é”"></a>1.å…¬å¹³é”å’Œéå…¬å¹³é”</h3><p>å…¬å¹³é”ï¼š éå¸¸å…¬å¹³ï¼Œ ä¸èƒ½å¤Ÿæ’é˜Ÿï¼Œå¿…é¡»å…ˆæ¥ååˆ°ï¼</p><p>éå…¬å¹³é”ï¼šéå¸¸ä¸å…¬å¹³ï¼Œå¯ä»¥æ’é˜Ÿ ï¼ˆé»˜è®¤éƒ½æ˜¯éå…¬å¹³ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Creates an instance of &#123;<span class="hljs-meta">@code</span> ReentrantLock&#125;.<br>\* This is equivalent to using &#123;<span class="hljs-meta">@code</span> ReentrantLock(<span class="hljs-literal">false</span>)&#125;.<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ReentrantLock</span><span class="hljs-params">()</span> &#123;<br>sync = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonfairSync</span>();<br>&#125;<br>/\*\*<br>\* Creates an instance of &#123;<span class="hljs-meta">@code</span> ReentrantLock&#125; with the<br>\* given fairness policy.<br>\*<br>\* <span class="hljs-meta">@param</span> fair &#123;<span class="hljs-meta">@code</span> <span class="hljs-literal">true</span>&#125; <span class="hljs-keyword">if</span> <span class="hljs-built_in">this</span> lock should use a fair ordering policy<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ReentrantLock</span><span class="hljs-params">(<span class="hljs-type">boolean</span> fair)</span> &#123;<br>sync = fair ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">FairSync</span>() : <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonfairSync</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°åˆ›å»ºReentrantLockï¼Œé»˜è®¤æ˜¯èµ°çš„æ— å‚æ„é€ ï¼Œåˆ›å»ºéå…¬å¹³é”</p><p>è¿™ç§å›¾æ˜¯ç½‘ä¸Šä¸€ä¸ªå¤§ä½¬ç”»çš„ï¼Œååˆ†ç”ŸåŠ¨å½¢è±¡è®²äº†å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«</p><p><img src="https://i.loli.net/2021/01/26/la7GvINcTKe2RHz.png"></p><p><a href="https://www.jianshu.com/p/f584799f1c77">ä¸€å¼ å›¾è¯»æ‡‚éå…¬å¹³é”ä¸å…¬å¹³é”</a></p><h3 id="2-å¯é‡å…¥é”"><a href="#2-å¯é‡å…¥é”" class="headerlink" title="2.å¯é‡å…¥é”"></a>2.å¯é‡å…¥é”</h3><p>å¯é‡å…¥é”ï¼ˆé€’å½’é”ï¼‰</p><p>å¯é‡å…¥æ€§è¡¨ç°åœ¨åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å¾—é”ï¼Œè€Œä¸åŒçº¿ç¨‹ä¾ç„¶ä¸å¯å¤šæ¬¡è·å¾—é”ï¼Œåº•å±‚æ¶‰åŠåˆ°AQSï¼Œåé¢å‡ºä¸€ç¯‡è®²AQSçš„åšå®¢ï¼Œç°åœ¨äº†è§£å¯é‡å…¥é”çš„æ˜¯ä»€ä¹ˆæ ·å­å°±è¡Œ</p><blockquote><p>sync</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* å¯é‡å…¥é” ï¼ˆé€’å½’é”ï¼‰<br>\* <span class="hljs-keyword">synchronized</span>ç‰ˆ<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">22</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo01</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>phone.sms();<br>&#125;,<span class="hljs-string">&quot;a&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>phone.sms();<br>&#125;,<span class="hljs-string">&quot;b&quot;</span>).start();<br>&#125;<br>/\*\*<br>\* a sms<br>\* a call<br>\* b sms<br>\* b call<br>\*/<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sms</span><span class="hljs-params">()</span>&#123;<br>System.out.println(Thread.currentThread().getName()+<span class="hljs-string">&quot; sms&quot;</span>);<br>call(); <span class="hljs-comment">//call ä¹ŸåŠ äº†é”</span><br>&#125;<br>ReentrantLock lock= <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>&#123;<br>System.out.println(Thread.currentThread().getName()+<span class="hljs-string">&quot; call&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>lock</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* ç”¨lockå®ç°å¯é‡å…¥é”<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">22</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo02</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">Phone2</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone2</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>phone.sms();<br>&#125;,<span class="hljs-string">&quot;a&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>phone.sms();<br>&#125;,<span class="hljs-string">&quot;b&quot;</span>).start();<br>&#125;<br>/\*\*<br>\* a sms<br>\* a call<br>\* b sms<br>\* b call<br>\*/<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone2</span>&#123;<br><span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sms</span><span class="hljs-params">()</span>&#123;<br>lock.lock(); <span class="hljs-comment">//ç»†èŠ‚é—®é¢˜ ä¸¤å¯¹é” lock.lock() lock.unlock() å¿…é¡»é…å¯¹</span><br><span class="hljs-keyword">try</span> &#123;<br>System.out.println(Thread.currentThread().getName()+<span class="hljs-string">&quot; sms&quot;</span>);<br>call(); <span class="hljs-comment">//call ä¹ŸåŠ äº†é”</span><br>&#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>e.printStackTrace();<br>&#125;<span class="hljs-keyword">finally</span> &#123;<br>lock.unlock();<br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>&#123;<br>lock.lock();<br><span class="hljs-keyword">try</span> &#123;<br>System.out.println(Thread.currentThread().getName()+<span class="hljs-string">&quot; call&quot;</span>);<br>&#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>e.printStackTrace();<br>&#125;<span class="hljs-keyword">finally</span> &#123;<br>lock.unlock();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-è‡ªæ—‹é”"><a href="#3-è‡ªæ—‹é”" class="headerlink" title="3.è‡ªæ—‹é”"></a>3.è‡ªæ—‹é”</h3><p>ä¸Šé¢åœ¨å¼•å…¥åŸå­ç±»è°ƒç”¨Unsafeç±»è§£å†³ABAé—®é¢˜ï¼Œå°±çœ‹åˆ°äº†åº•å±‚æ˜¯ç”¨è‡ªæ—‹é”å»å®ç°çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAndAddInt</span><span class="hljs-params">(Object var1, <span class="hljs-type">long</span> var2, <span class="hljs-type">int</span> var4)</span> &#123;<br><span class="hljs-type">int</span> var5;<br><span class="hljs-keyword">do</span> &#123;<br>var5 = <span class="hljs-built_in">this</span>.getIntVolatile(var1, var2);<br>&#125; <span class="hljs-keyword">while</span>(!<span class="hljs-built_in">this</span>.compareAndSwapInt(var1, var2, var5, var5 + var4)); <span class="hljs-comment">//è‡ªæ—‹é”</span><br><span class="hljs-keyword">return</span> var5;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åº•å±‚å°±æ˜¯whileçš„åˆ¤æ–­ï¼Œä¸æ–­å»æäº¤ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å®ç°ä¸€æŠŠè‡ªæ—‹é”ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\*æ‰‹åŠ¨å®ç°è‡ªæ—‹é”<br>\* åº•å±‚ä½¿ç”¨CAS<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">22</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SprinLockDemo</span> &#123;<br>AtomicReference&lt;Thread&gt; atomicReference = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;();<br><span class="hljs-comment">//åŠ é”</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myLock</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;==&gt; mylock&quot;</span>);<br><span class="hljs-comment">//è‡ªæ—‹é”</span><br><span class="hljs-keyword">while</span> (!atomicReference.compareAndSet(<span class="hljs-literal">null</span>, thread)) &#123;<br>&#125;<br>&#125;<br><span class="hljs-comment">//è§£é”</span><br><span class="hljs-comment">//åŠ é”</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myUnlock</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;==&gt; myUnlock&quot;</span>);<br>atomicReference.compareAndSet(thread,<span class="hljs-literal">null</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">22</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestSpinLock</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//åº•å±‚ä½¿ç”¨è‡ªæ—‹é” CAS</span><br><span class="hljs-type">SprinLockDemo</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SprinLockDemo</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>lock.myLock();<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">5</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<span class="hljs-keyword">finally</span> &#123;<br>lock.myUnlock();<br>&#125;<br>&#125;,<span class="hljs-string">&quot;T1&quot;</span>).start();<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>lock.myLock();<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>lock.myUnlock();<br>&#125;<br>&#125;,<span class="hljs-string">&quot;T2&quot;</span>).start();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p>T1&#x3D;&#x3D;&gt; mylock<br>T2&#x3D;&#x3D;&gt; mylock<br>T1&#x3D;&#x3D;&gt; myUnlock<br>T2&#x3D;&#x3D;&gt; myUnlock</p><h3 id="4-æ­»é”"><a href="#4-æ­»é”" class="headerlink" title="4.æ­»é”"></a>4.æ­»é”</h3><blockquote><p>æ­»é”æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>æ­»é”ä¸€è¯åº”è¯¥æ˜¯æˆ‘ä»¬å¬çš„æœ€å¤šçš„äº†ï¼Œæ•°æ®åº“é‡Œçš„æ­»é”ï¼Œè®¡ç®—æœºç½‘ç»œé‡Œçš„æ­»é”ï¼Œé‚£ä¹ˆæ­»é”åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§åƒµå±€ï¼ˆDeadly-Embrace) ) ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œè¿™äº›è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰éƒ½å°†æ— æ³•å‘å‰æ¨è¿›ã€‚</p><blockquote><p>æ­»é”ä¸é¥¥é¥¿çš„åŒºåˆ«?</p></blockquote><p>é¥¥é¥¿ï¼ˆStarvationï¼‰æŒ‡ä¸€ä¸ªè¿›ç¨‹ä¸€ç›´å¾—ä¸åˆ°èµ„æºã€‚</p><p>æ­»é”å’Œé¥¥é¥¿éƒ½æ˜¯ç”±äºè¿›ç¨‹ç«äº‰èµ„æºè€Œå¼•èµ·çš„ã€‚é¥¥é¥¿ä¸€èˆ¬ä¸å æœ‰èµ„æºï¼Œæ­»é”è¿›ç¨‹ä¸€å®šå æœ‰èµ„æºã€‚</p><p>è¿™ç¯‡æ–‡ç« è®²çš„ä¸é”™ï¼š</p><p><a href="https://blog.csdn.net/wljliujuan/article/details/79614019">æ­»é”ï¼Œæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ä»¥åŠå¤„ç†ç­–ç•¥</a></p><h2 id="22-Gihubæºç "><a href="#22-Gihubæºç " class="headerlink" title="22.Gihubæºç "></a>22.Gihubæºç </h2><p><a href="https://github.com/luffy997/JUC-Notes">JUC-Notes</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆä¸‰ï¼‰</title>
    <link href="/2021/01/26/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89/"/>
    <url>/2021/01/26/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆä¸‰ï¼‰"><a href="#JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆä¸‰ï¼‰" class="headerlink" title="JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆä¸‰ï¼‰"></a>JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆä¸‰ï¼‰</h1><h2 id="11-çº¿ç¨‹æ± "><a href="#11-çº¿ç¨‹æ± " class="headerlink" title="11.çº¿ç¨‹æ± "></a>11.çº¿ç¨‹æ± </h2><p>çº¿ç¨‹æ± ï¼šä¸‰å¤§æ–¹æ³•ã€ä¸ƒå¤§å‚æ•°ã€å››ç§æ‹’ç»ç­–ç•¥</p><blockquote><p>æ± åŒ–æŠ€æœ¯</p></blockquote><p>ç¨‹åºçš„è¿è¡Œï¼Œæœ¬è´¨ï¼šå ç”¨ç³»ç»Ÿçš„èµ„æºï¼ ä¼˜åŒ–èµ„æºçš„ä½¿ç”¨ï¼&#x3D;&gt;æ± åŒ–æŠ€æœ¯</p><p>çº¿ç¨‹æ± ã€è¿æ¥æ± ã€å†…å­˜æ± ã€å¯¹è±¡æ± &#x2F;&#x2F;&#x2F;â€¦.. åˆ›å»ºã€é”€æ¯ã€‚ååˆ†æµªè´¹èµ„æº</p><p>æ± åŒ–æŠ€æœ¯ï¼šäº‹å…ˆå‡†å¤‡å¥½ä¸€äº›èµ„æºï¼Œæœ‰äººè¦ç”¨ï¼Œå°±æ¥æˆ‘è¿™é‡Œæ‹¿ï¼Œç”¨å®Œä¹‹åè¿˜ç»™æˆ‘ã€‚</p><p><strong>çº¿ç¨‹æ± çš„å¥½å¤„ï¼š</strong></p><p>1.é™ä½èµ„æºçš„æ¶ˆè€—</p><p>2.æé«˜å“åº”çš„é€Ÿåº¦</p><p>3.æ–¹ä¾¿ç®¡ç†</p><p>ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„æ˜¯å‡å°‘åœ¨åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ä¸Šæ‰€èŠ±çš„æ—¶é—´ä»¥åŠç³»ç»Ÿèµ„æºçš„å¼€é”€ï¼Œè§£å†³èµ„æºä¸è¶³çš„é—®é¢˜ã€‚å¦‚æœä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæœ‰å¯èƒ½é€ æˆç³»ç»Ÿåˆ›å»ºå¤§é‡åŒç±»çº¿ç¨‹è€Œå¯¼è‡´æ¶ˆè€—å®Œå†…å­˜æˆ–è€… â€œè¿‡åº¦åˆ‡æ¢â€çš„é—®é¢˜ã€‚</p><blockquote><p>çº¿ç¨‹æ± ï¼šä¸‰å¤§æ–¹æ³•</p></blockquote><p><a href="https://imgchr.com/i/sOkyWR"><img src="https://s3.ax1x.com/2021/01/25/sOkyWR.jpg"></a></p><p>å…¶ä¸­Integer.MAX_VALUEçº¦ä¸º21äº¿ï¼ŒFixedThreadPoolæ˜¯ä¼¸ç¼©æ€§çš„çº¿ç¨‹æ± ï¼Œæœ€å°ä¸º1ï¼Œæœ€å¤§ä¸º21äº¿ï¼Œå¯æƒ³è‹¥åˆ›å»º21äº¿ä¸ªçº¿ç¨‹ï¼Œå¤§é‡è¯·æ±‚å †ç§¯ï¼ŒåŠ¿å¿…ä¼šé€ æˆå†…å­˜æº¢å‡ºã€‚åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± åˆä¸èƒ½æœ€å¤§ç¨‹åº¦åˆ©ç”¨æœºå™¨æ€§èƒ½ï¼Œæ‰€ä»¥é˜¿é‡Œå¼€å‘æ‰‹å†Œè§„å®šéœ€è¦æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± ï¼</p><p>ä¸‹é¢æˆ‘ä»¬å…ˆä½¿ç”¨Executorsæ¥åˆ›å»ºçº¿ç¨‹æ± ï¼Œåˆ†æä¸‰ç§åˆ›å»ºçš„åº•å±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* çº¿ç¨‹æ± <br>\* ä¸‰å¤§æ–¹æ³•ã€<span class="hljs-number">7</span>å¤§å‚æ•°ã€<span class="hljs-number">4</span>ç§æ‹’ç»ç­–ç•¥<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">19</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo01</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//é˜¿é‡Œå¼€å‘æ‰‹å†Œè§„å®šï¼šä¸å…è®¸ä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± ï¼Œè€Œæ˜¯é€šè¿‡ThreadPoolExcutorçš„æ–¹å¼å¸¸è§ï¼Œ</span><br><span class="hljs-comment">//æ˜ç¡®å†™å‡ºåˆ›å»ºçš„çº¿ç¨‹æµ‹çš„è§„åˆ™ï¼Œé¿å…èµ„æºè€—å°½çš„é£é™©</span><br><span class="hljs-comment">//å·¥å…·ç±»Executorsåˆ›å»ºçš„ä¸‰ç§çº¿ç¨‹æ± åº•å±‚å‡æ˜¯ThreadPoolExecutor</span><br><span class="hljs-comment">//æ•…æ‰‹å†™çº¿ç¨‹æ± ï¼Œåªéœ€è¦é€šè¿‡ThreadPoolExecutor åˆ›å»ºå³å¯</span><br><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">threadPool</span> <span class="hljs-operator">=</span> Executors.newSingleThreadExecutor(); <span class="hljs-comment">//ä¸€ä¸ªçº¿ç¨‹</span><br><span class="hljs-comment">//ExecutorService threadPool = Executors.newFixedThreadPool(5); //å›ºå®šçº¿ç¨‹æ± å¤§å°</span><br><span class="hljs-comment">//ExecutorService threadPool = Executors.newCachedThreadPool(); //å¯ä¼¸ç¼©çº¿ç¨‹æ±  é‡å¼ºåˆ™å¼ºï¼Œé‡å¼±åˆ™å¼±</span><br><span class="hljs-comment">//ä½¿ç”¨çº¿ç¨‹æ± æ“ä½œçº¿ç¨‹</span><br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30</span>; i++) &#123;<br>threadPool.execute(() -&gt; &#123;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; OK&quot;</span>);<br>&#125;);<br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br><span class="hljs-comment">//å…³é—­çº¿ç¨‹æ± </span><br>threadPool.shutdown();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Executors.newSingleThreadExecutor();</strong></p><p>åº•å±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Creates an Executor that uses a single worker thread operating<br>\* off an unbounded queue. (Note however that <span class="hljs-keyword">if</span> <span class="hljs-built_in">this</span> single<br>\* thread terminates due to a failure during execution prior to<br>\* shutdown, a <span class="hljs-keyword">new</span> <span class="hljs-title class_">one</span> will take its place <span class="hljs-keyword">if</span> needed to execute<br>\* subsequent tasks.) Tasks are guaranteed to execute<br>\* sequentially, and no more than one task will be active at any<br>\* given time. Unlike the otherwise equivalent<br>\* &#123;<span class="hljs-meta">@code</span> newFixedThreadPool(<span class="hljs-number">1</span>)&#125; the returned executor is<br>\* guaranteed not to be reconfigurable to use additional threads.<br>\*<br>\* <span class="hljs-meta">@return</span> the newly created single-threaded Executor<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newSingleThreadExecutor</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FinalizableDelegatedExecutorService</span><br>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,<br><span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡ThreadPoolExecutor()çš„æœ‰å‚æ„é€ åˆ›å»ºçš„ï¼Œå…·ä½“æ¯ä¸ªå˜é‡æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><blockquote><p>çº¿ç¨‹æ± ï¼šä¸ƒå¤§å‚æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Creates a <span class="hljs-keyword">new</span> &#123;<span class="hljs-meta">@code</span> ThreadPoolExecutor&#125; with the given initial<br>\* parameters.<br>\*<br>\* <span class="hljs-meta">@param</span> corePoolSize the number of threads to keep in the pool, even<br>\* <span class="hljs-keyword">if</span> they are idle, unless &#123;<span class="hljs-meta">@code</span> allowCoreThreadTimeOut&#125; is set<br>\* <span class="hljs-meta">@param</span> maximumPoolSize the maximum number of threads to allow in the<br>\* pool<br>\* <span class="hljs-meta">@param</span> keepAliveTime <span class="hljs-keyword">when</span> the number of threads is greater than<br>\* the core, <span class="hljs-built_in">this</span> is the maximum time that excess idle threads<br>\* will wait <span class="hljs-keyword">for</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">tasks</span> before terminating.<br>\* <span class="hljs-meta">@param</span> unit the time unit <span class="hljs-keyword">for</span> the &#123;<span class="hljs-meta">@code</span> keepAliveTime&#125; argument<br>\* <span class="hljs-meta">@param</span> workQueue the queue to use <span class="hljs-keyword">for</span> holding tasks before they are<br>\* executed. This queue will hold only the &#123;<span class="hljs-meta">@code</span> Runnable&#125;<br>\* tasks submitted by the &#123;<span class="hljs-meta">@code</span> execute&#125; method.<br>\* <span class="hljs-meta">@param</span> threadFactory the factory to use <span class="hljs-keyword">when</span> the executor<br>\* creates a <span class="hljs-keyword">new</span> <span class="hljs-title class_">thread</span><br>\* <span class="hljs-meta">@param</span> handler the handler to use <span class="hljs-keyword">when</span> execution is blocked<br>\* because the thread bounds and queue capacities are reached<br>\* <span class="hljs-meta">@throws</span> IllegalArgumentException <span class="hljs-keyword">if</span> one of the following holds:&lt;br&gt;<br>\* &#123;<span class="hljs-meta">@code</span> corePoolSize &lt; <span class="hljs-number">0</span>&#125;&lt;br&gt;<br>\* &#123;<span class="hljs-meta">@code</span> keepAliveTime &lt; <span class="hljs-number">0</span>&#125;&lt;br&gt;<br>\* &#123;<span class="hljs-meta">@code</span> maximumPoolSize &lt;= <span class="hljs-number">0</span>&#125;&lt;br&gt;<br>\* &#123;<span class="hljs-meta">@code</span> maximumPoolSize &lt; corePoolSize&#125;<br>\* <span class="hljs-meta">@throws</span> NullPointerException <span class="hljs-keyword">if</span> &#123;<span class="hljs-meta">@code</span> workQueue&#125;<br>\* or &#123;<span class="hljs-meta">@code</span> threadFactory&#125; or &#123;<span class="hljs-meta">@code</span> handler&#125; is <span class="hljs-literal">null</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,</span><br><span class="hljs-params"><span class="hljs-type">int</span> maximumPoolSize,</span><br><span class="hljs-params"><span class="hljs-type">long</span> keepAliveTime,</span><br><span class="hljs-params">TimeUnit unit,</span><br><span class="hljs-params">BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="hljs-params">ThreadFactory threadFactory,</span><br><span class="hljs-params">RejectedExecutionHandler handler)</span> &#123;<br><span class="hljs-keyword">if</span> (corePoolSize &lt; <span class="hljs-number">0</span> ||<br>maximumPoolSize &lt;= <span class="hljs-number">0</span> ||<br>maximumPoolSize &lt; corePoolSize ||<br>keepAliveTime &lt; <span class="hljs-number">0</span>)<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>();<br><span class="hljs-keyword">if</span> (workQueue == <span class="hljs-literal">null</span> || threadFactory == <span class="hljs-literal">null</span> || handler == <span class="hljs-literal">null</span>)<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();<br><span class="hljs-built_in">this</span>.acc = System.getSecurityManager() == <span class="hljs-literal">null</span> ?<br><span class="hljs-literal">null</span> :<br>AccessController.getContext();<br><span class="hljs-built_in">this</span>.corePoolSize = corePoolSize;<br><span class="hljs-built_in">this</span>.maximumPoolSize = maximumPoolSize;<br><span class="hljs-built_in">this</span>.workQueue = workQueue;<br><span class="hljs-built_in">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);<br><span class="hljs-built_in">this</span>.threadFactory = threadFactory;<br><span class="hljs-built_in">this</span>.handler = handler;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ°è¿™ï¼Œåˆä¸­ç”Ÿéƒ½èƒ½çœ‹æ‡‚çš„è‹±è¯­ï¼Œä¾æ¬¡æ˜¯çº¿ç¨‹æ± çš„æ ¸å¿ƒå¤§å°ï¼Œæœ€å¤§çº¿ç¨‹æ•°ï¼Œå­˜æ´»æ—¶é—´ï¼Œæ—¶é—´å•ä½ï¼Œåº•å±‚å®ç°çš„é˜Ÿåˆ—ï¼Œé»˜è®¤çº¿ç¨‹æ± æ„é€ å·¥å‚ï¼Œé»˜è®¤æ‹’ç»ç­–ç•¥ï¼Œè¿™å°±æ˜¯çº¿ç¨‹æ± çš„ä¸ƒå¤§å‚æ•°ã€‚</p><p>å‚æ•°ä¸­å¤§éƒ¨åˆ†æˆ‘ä»¬éƒ½çŸ¥é“å¡«ä»€ä¹ˆï¼Œå°±æœ€åè¿™ä¸ªhandleræ˜¯ä»€ä¹ˆï¼Ÿç‚¹è¿›å»å‘ç°æ˜¯ä¸ªæ¥å£ï¼Œé‚£å°±çœ‹å®ç°ç±»</p><p><a href="https://imgchr.com/i/sOe0Pg"><img src="https://s3.ax1x.com/2021/01/25/sOe0Pg.jpg"></a></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ¥å£æœ‰å››ä¸ªå®ç°ç±»ï¼ŒæŸ¥çœ‹æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* A handler <span class="hljs-keyword">for</span> rejected tasks that runs the rejected task<br>\* directly in the calling thread of the &#123;<span class="hljs-meta">@code</span> execute&#125; method,<br>\* unless the executor has been shut down, in which <span class="hljs-keyword">case</span> the task<br>\* is discarded.<br>\*/<br><span class="hljs-comment">//ç”¨äºæ‹’ç»ä»»åŠ¡çš„å¤„ç†ç¨‹åºï¼Œå¯ä»¥ç›´æ¥åœ¨&#123;@code execute&#125;æ–¹æ³•çš„è°ƒç”¨çº¿ç¨‹ä¸­è¿</span><br><span class="hljs-comment">//è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡\*é™¤éæ‰§è¡Œå™¨å·²è¢«å…³é—­ï¼Œå¦åˆ™è¿™ç§æƒ…å†µä¸‹è¯¥ä»»åŠ¡å°†è¢«ä¸¢å¼ƒã€‚</span><br><span class="hljs-comment">//ç®€å•ç‚¹å°±æ˜¯è°è°ƒç”¨è°æ‰§è¡Œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallerRunsPolicy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RejectedExecutionHandler</span> &#123;<br>/\*\*<br>\* Creates a &#123;<span class="hljs-meta">@code</span> CallerRunsPolicy&#125;.<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">CallerRunsPolicy</span><span class="hljs-params">()</span> &#123; &#125;<br>/\*\*<br>\* Executes task r in the caller<span class="hljs-string">&#x27;s thread, unless the executor</span><br><span class="hljs-string">\* has been shut down, in which case the task is discarded.</span><br><span class="hljs-string">\*</span><br><span class="hljs-string">\* @param r the runnable task requested to be executed</span><br><span class="hljs-string">\* @param e the executor attempting to execute this task</span><br><span class="hljs-string">\*/</span><br><span class="hljs-string">public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;</span><br><span class="hljs-string">if (!e.isShutdown()) &#123;</span><br><span class="hljs-string">r.run();</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">/\*\*</span><br><span class="hljs-string">\* A handler for rejected tasks that throws a</span><br><span class="hljs-string">\* &#123;@code RejectedExecutionException&#125;.</span><br><span class="hljs-string">\*/</span><br><span class="hljs-string">//ç›´æ¥æŠ›å¼‚å¸¸</span><br><span class="hljs-string">public static class AbortPolicy implements RejectedExecutionHandler &#123;</span><br><span class="hljs-string">/\*\*</span><br><span class="hljs-string">\* Creates an &#123;@code AbortPolicy&#125;.</span><br><span class="hljs-string">\*/</span><br><span class="hljs-string">public AbortPolicy() &#123; &#125;</span><br><span class="hljs-string">/\*\*</span><br><span class="hljs-string">\* Always throws RejectedExecutionException.</span><br><span class="hljs-string">\*</span><br><span class="hljs-string">\* @param r the runnable task requested to be executed</span><br><span class="hljs-string">\* @param e the executor attempting to execute this task</span><br><span class="hljs-string">\* @throws RejectedExecutionException always</span><br><span class="hljs-string">\*/</span><br><span class="hljs-string">public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;</span><br><span class="hljs-string">throw new RejectedExecutionException(&quot;Task &quot; + r.toString() +</span><br><span class="hljs-string">&quot; rejected from &quot; +</span><br><span class="hljs-string">e.toString());</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">/\*\*</span><br><span class="hljs-string">\* A handler for rejected tasks that silently discards the</span><br><span class="hljs-string">\* rejected task.</span><br><span class="hljs-string">\*/</span><br><span class="hljs-string">//ç›´æ¥æ”¾å¼ƒ</span><br><span class="hljs-string">public static class DiscardPolicy implements RejectedExecutionHandler &#123;</span><br><span class="hljs-string">/\*\*</span><br><span class="hljs-string">\* Creates a &#123;@code DiscardPolicy&#125;.</span><br><span class="hljs-string">\*/</span><br><span class="hljs-string">public DiscardPolicy() &#123; &#125;</span><br><span class="hljs-string">/\*\*</span><br><span class="hljs-string">\* Does nothing, which has the effect of discarding task r.</span><br><span class="hljs-string">\*</span><br><span class="hljs-string">\* @param r the runnable task requested to be executed</span><br><span class="hljs-string">\* @param e the executor attempting to execute this task</span><br><span class="hljs-string">\*/</span><br><span class="hljs-string">public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">/\*\*</span><br><span class="hljs-string">\* A handler for rejected tasks that discards the oldest unhandled</span><br><span class="hljs-string">\* request and then retries &#123;@code execute&#125;, unless the executor</span><br><span class="hljs-string">\* is shut down, in which case the task is discarded.</span><br><span class="hljs-string">\*/</span><br><span class="hljs-string">//æ”¾å¼ƒæœ€æ—§æœªå¤„ç†çš„ç¨‹åº</span><br><span class="hljs-string">public static class DiscardOldestPolicy implements RejectedExecutionHandler &#123;</span><br><span class="hljs-string">/\*\*</span><br><span class="hljs-string">\* Creates a &#123;@code DiscardOldestPolicy&#125; for the given executor.</span><br><span class="hljs-string">\*/</span><br><span class="hljs-string">public DiscardOldestPolicy() &#123; &#125;</span><br><span class="hljs-string">/\*\*</span><br><span class="hljs-string">\* Obtains and ignores the next task that the executor</span><br><span class="hljs-string">\* would otherwise execute, if one is immediately available,</span><br><span class="hljs-string">\* and then retries execution of task r, unless the executor</span><br><span class="hljs-string">\* is shut down, in which case task r is instead discarded.</span><br><span class="hljs-string">\*</span><br><span class="hljs-string">\* @param r the runnable task requested to be executed</span><br><span class="hljs-string">\* @param e the executor attempting to execute this task</span><br><span class="hljs-string">\*/</span><br><span class="hljs-string">public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;</span><br><span class="hljs-string">if (!e.isShutdown()) &#123;</span><br><span class="hljs-string">e.getQueue().poll();</span><br><span class="hljs-string">e.execute(r);</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure><p>new ThreadPoolExecutor.AbortPolicy() &#x2F;&#x2F; é“¶è¡Œæ»¡äº†ï¼Œè¿˜æœ‰äººè¿›æ¥ï¼Œä¸å¤„ç†è¿™ä¸ªäººçš„ï¼ŒæŠ›å‡ºå¼‚å¸¸</p><p>new ThreadPoolExecutor.CallerRunsPolicy() &#x2F;&#x2F; å“ªæ¥çš„å»å“ªé‡Œï¼</p><p>new ThreadPoolExecutor.DiscardPolicy() &#x2F;&#x2F;é˜Ÿåˆ—æ»¡äº†ï¼Œä¸¢æ‰ä»»åŠ¡ï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼</p><p>new ThreadPoolExecutor.DiscardOldestPolicy() &#x2F;&#x2F;é˜Ÿåˆ—æ»¡äº†ï¼Œå°è¯•å»å’Œæœ€æ—©çš„ç«äº‰ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼</p><p>å¯ä»¥ç”»ä¸€ä¸ªå›¾ï¼Œå…·ä½“ç†è§£7å¤§å‚æ•°çš„æ„æ€</p><p><a href="https://imgchr.com/i/sOdBJH"><img src="https://s3.ax1x.com/2021/01/25/sOdBJH.jpg"></a></p><blockquote><p>æ‰‹å†™çº¿ç¨‹æ± </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± <br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">19</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo02</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">// æœ€å¤§çº¿ç¨‹åˆ°åº•è¯¥å¦‚ä½•å®šä¹‰</span><br><span class="hljs-comment">// 1ã€CPU å¯†é›†å‹ï¼Œå‡ æ ¸ï¼Œå°±æ˜¯å‡ \*2ï¼Œå¯ä»¥ä¿æŒCPuçš„æ•ˆç‡æœ€é«˜ï¼</span><br><span class="hljs-comment">// 2ã€IO å¯†é›†å‹ &gt; åˆ¤æ–­ä½ ç¨‹åºä¸­ååˆ†è€—IOçš„çº¿ç¨‹ï¼Œ</span><br><span class="hljs-comment">// ç¨‹åº 15ä¸ªå¤§å‹ä»»åŠ¡ ioååˆ†å ç”¨èµ„æºï¼</span><br>System.out.println(Runtime.getRuntime().availableProcessors());<br><span class="hljs-comment">//ThreadPoolExecutorçš„æ„é€ æ–¹æ³•</span><br>/\*\*<br>\* ä¸ƒå¤§å‚æ•°<br>\* <span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,</span><br><span class="hljs-params">\* <span class="hljs-type">int</span> maximumPoolSize,</span><br><span class="hljs-params">\* <span class="hljs-type">long</span> keepAliveTime,</span><br><span class="hljs-params">\* TimeUnit unit,</span><br><span class="hljs-params">\* BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="hljs-params">\* ThreadFactory threadFactory)</span> &#123;<br>\* <span class="hljs-built_in">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,<br>\* threadFactory, defaultHandler);<br>\* &#125;<br>\*<br>\*<br>\* å››ç§æ‹’ç»ç­–ç•¥<br>\* A handler <span class="hljs-keyword">for</span> rejected tasks that <span class="hljs-keyword">throws</span> a<br>\* &#123;<span class="hljs-meta">@code</span> RejectedExecutionException&#125;. ä¸å¤„ç†ï¼ŒæŠ›å¼‚å¸¸<br>\* AbortPolicy<br>\*<br>\* A handler <span class="hljs-keyword">for</span> rejected tasks that runs the rejected task<br>\* directly in the calling thread of the &#123;<span class="hljs-meta">@code</span> execute&#125; method,<br>\* unless the executor has been shut down, in which <span class="hljs-keyword">case</span> the task<br>\* is discarded. å“ªæ¥çš„å»å“ªé‡Œï¼<br>\* ç”¨äºæ‹’ç»ä»»åŠ¡çš„å¤„ç†ç¨‹åºï¼Œå¯ä»¥ç›´æ¥åœ¨æ–¹æ³•çš„è°ƒç”¨çº¿ç¨‹ä¸­è¿è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡\*é™¤éæ‰§è¡Œå™¨å·²è¢«å…³é—­ï¼Œå¦åˆ™è¿™ç§æƒ…å†µä¸‹è¯¥ä»»åŠ¡å°†è¢«ä¸¢å¼ƒã€‚<br>\* CallerRunsPolicy<br>\*<br>\* A handler <span class="hljs-keyword">for</span> rejected tasks that discards the oldest unhandled<br>\* request and then retries &#123;<span class="hljs-meta">@code</span> execute&#125;, unless the executor<br>\* is shut down, in which <span class="hljs-keyword">case</span> the task is discarded.<br>\* æ‹’ç»ä»»åŠ¡çš„å¤„ç†ç¨‹åºï¼Œå®ƒä¸¢å¼ƒ&lt;p&gt;æœ€æ—§&lt;/p&gt;çš„æœªå¤„ç†\*è¯·æ±‚ï¼Œç„¶åé‡è¯•ï¼Œé™¤éæ‰§è¡Œç¨‹åº\*è¢«å…³é—­ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥ä»»åŠ¡å°†è¢«ä¸¢å¼ƒã€‚<br>\* DiscardOldestPolicy<br>\*<br>\* A handler <span class="hljs-keyword">for</span> rejected tasks that silently discards the<br>\* rejected task. ç›´æ¥æŠ›å¼ƒ<br>\* DiscardPolicy<br>\*<br>\*<br>\*<br>\*<br>\*<br>\*/<br><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">threadPoolExecutor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br><span class="hljs-number">2</span>,<br><span class="hljs-number">5</span>,<br><span class="hljs-number">3</span>,<br>TimeUnit.SECONDS,<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="hljs-number">3</span>), <span class="hljs-comment">//é˜»å¡é˜Ÿåˆ—å®ç°</span><br>Executors.defaultThreadFactory(), <span class="hljs-comment">//é»˜è®¤çº¿ç¨‹å·¥å‚</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.DiscardPolicy() <span class="hljs-comment">//æ‹’ç»ç­–ç•¥</span><br>);<br>/\*\*<br>\* æœ€å¤§æ‰¿è½½ï¼šmax+deque<br>\* è¶…è¿‡RejectedExecutionException<br>\*/<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>threadPoolExecutor.execute(() -&gt; &#123;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; OK&quot;</span>);<br>&#125;);<br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>threadPoolExecutor.shutdown();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>çº¿ç¨‹æ± çš„å¤§å°å¦‚ä½•è®¾ç½®?</p></blockquote><p>IOå¯†é›†å‹ï¼ŒCPUå¯†é›†å‹ï¼šï¼ˆè°ƒä¼˜ï¼‰</p><p>é€šè¿‡Runtime.getRuntime().availableProcessors()æ‹¿åˆ°æœºå™¨çš„é€»è¾‘å¤„ç†å™¨æ•°é‡ï¼Œå³ä¸ºçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°</p><h2 id="12-å››å¤§å‡½æ•°å¼æ¥å£"><a href="#12-å››å¤§å‡½æ•°å¼æ¥å£" class="headerlink" title="12.å››å¤§å‡½æ•°å¼æ¥å£"></a>12.å››å¤§å‡½æ•°å¼æ¥å£</h2><blockquote><p>å‡½æ•°å¼æ¥å£ï¼šåªæœ‰ä¸€ä¸ªæ–¹æ³•çš„æ¥å£</p><p>ç›®çš„ï¼šæä¾›äº†åŸºç¡€ç¼–ç¨‹æ¨¡å‹ï¼Œç®€åŒ–ç¼–ç¨‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Runnable</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span>;<br>&#125;<br><span class="hljs-comment">//æ³›å‹ã€æšä¸¾ã€åå°„</span><br><span class="hljs-comment">//lambdaè¡¨è¾¾å¼ï¼Œé“¾å¼ç¼–ç¨‹ï¼Œå‡½æ•°å¼æ¥å£ï¼ŒStreamæµå¼è®¡ç®—</span><br><span class="hljs-comment">//FunctionalInterface</span><br></code></pre></td></tr></table></figure><blockquote><p>Functionå‡½æ•°å¼æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Represents a function that accepts one argument and produces a result.<br>\*<br>\* &lt;p&gt;This is a &lt;a href=<span class="hljs-string">&quot;package-summary.html&quot;</span>&gt;functional interface&lt;/a&gt;<br>\* whose functional method is &#123;<span class="hljs-meta">@link</span> #apply(Object)&#125;.<br>\*<br>\* <span class="hljs-meta">@param</span> &lt;T&gt; the type of the input to the function<br>\* <span class="hljs-meta">@param</span> &lt;R&gt; the type of the result of the function<br>\*<br>\* <span class="hljs-meta">@since</span> <span class="hljs-number">1.8</span><br>\*/<br><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Function</span>&lt;T, R&gt; &#123;<br>/\*\*<br>\* Applies <span class="hljs-built_in">this</span> function to the given argument.<br>\*<br>\* <span class="hljs-meta">@param</span> t the function argument<br>\* <span class="hljs-meta">@return</span> the function result<br>\*/<br>R <span class="hljs-title function_">apply</span><span class="hljs-params">(T t)</span>;<br></code></pre></td></tr></table></figure><p>Tä¸ºä¼ å…¥å‚æ•°çš„ç±»å‹ï¼ŒRä¸ºè¿”å›å‚æ•°çš„ç±»å‹</p><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Function å‡½æ•°å‹æ¥å£ï¼Œæœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œä¸€ä¸ªè¾“å‡º<br>\* åªè¦æ˜¯å‡½æ•°å‹æ¥å£ å¯ä»¥ç”¨lambdaè¡¨è¾¾ç®€åŒ–<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">20</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo1</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">// Function function = new Function&lt;String,String&gt;() &#123;</span><br><span class="hljs-comment">// @Override</span><br><span class="hljs-comment">// public String apply(String str) &#123;</span><br><span class="hljs-comment">// return str;</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// &#125;;</span><br><span class="hljs-comment">//ä½¿ç”¨lambdaç®€åŒ–</span><br><span class="hljs-type">Function</span> <span class="hljs-variable">function</span> <span class="hljs-operator">=</span> (str)-&gt;&#123;<span class="hljs-keyword">return</span> str;&#125;;<br>System.out.println(function.apply(<span class="hljs-string">&quot;1223&quot;</span>));<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ–­å®šå‹æ¥å£ï¼šæœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿”å›å€¼åªèƒ½æ˜¯å¸ƒå°”å€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Represents a <span class="hljs-title function_">predicate</span> <span class="hljs-params">(<span class="hljs-type">boolean</span>-valued function)</span> of one argument.<br>\*<br>\* &lt;p&gt;This is a &lt;a href=<span class="hljs-string">&quot;package-summary.html&quot;</span>&gt;functional interface&lt;/a&gt;<br>\* whose functional method is &#123;<span class="hljs-meta">@link</span> #test(Object)&#125;.<br>\*<br>\* <span class="hljs-meta">@param</span> &lt;T&gt; the type of the input to the predicate<br>\*<br>\* <span class="hljs-meta">@since</span> <span class="hljs-number">1.8</span><br>\*/<br><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Predicate</span>&lt;T&gt; &#123;<br>/\*\*<br>\* Evaluates <span class="hljs-built_in">this</span> predicate on the given argument.<br>\*<br>\* <span class="hljs-meta">@param</span> t the input argument<br>\* <span class="hljs-meta">@return</span> &#123;<span class="hljs-meta">@code</span> <span class="hljs-literal">true</span>&#125; <span class="hljs-keyword">if</span> the input argument matches the predicate,<br>\* otherwise &#123;<span class="hljs-meta">@code</span> <span class="hljs-literal">false</span>&#125;<br>\*/<br><span class="hljs-type">boolean</span> <span class="hljs-title function_">test</span><span class="hljs-params">(T t)</span>;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* æ–­å®šå‹æ¥å£ï¼šæœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿”å›å€¼åªèƒ½æ˜¯ä¸€ä¸ª <span class="hljs-type">boolean</span><br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">20</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo2</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">// Predicate&lt;String&gt; predicate = new Predicate&lt;String&gt;() &#123;</span><br><span class="hljs-comment">// @Override</span><br><span class="hljs-comment">// public boolean test(String str) &#123;</span><br><span class="hljs-comment">// return str.isEmpty();</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// &#125;;</span><br>Predicate&lt;String&gt; predicate = (str)-&gt;&#123;<span class="hljs-keyword">return</span> str.isEmpty();&#125;;<br>System.out.println(predicate.test(<span class="hljs-string">&quot;a&quot;</span>));<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>Consumeræ¶ˆè´¹æ€§æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Represents an operation that accepts a single input argument and returns no<br>\* result. Unlike most other functional interfaces, &#123;<span class="hljs-meta">@code</span> Consumer&#125; is expected<br>\* to operate via side-effects.<br>\*<br>\* &lt;p&gt;This is a &lt;a href=<span class="hljs-string">&quot;package-summary.html&quot;</span>&gt;functional interface&lt;/a&gt;<br>\* whose functional method is &#123;<span class="hljs-meta">@link</span> #accept(Object)&#125;.<br>\*<br>\* <span class="hljs-meta">@param</span> &lt;T&gt; the type of the input to the operation<br>\*<br>\* <span class="hljs-meta">@since</span> <span class="hljs-number">1.8</span><br>\*/<br><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Consumer</span>&lt;T&gt; &#123;<br>/\*\*<br>\* Performs <span class="hljs-built_in">this</span> operation on the given argument.<br>\*<br>\* <span class="hljs-meta">@param</span> t the input argument<br>\*/<br><span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(T t)</span>;<br></code></pre></td></tr></table></figure><p><strong>åªæœ‰è¾“å…¥ï¼Œæ— è¿”å›å€¼</strong></p><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Consumer æ¶ˆè´¹å‹æ¥å£ï¼šåªè¦è¾“å…¥ï¼Œæ— è¿”å›å€¼<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">20</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo3</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">// Consumer&lt;String&gt; consumer = new Consumer&lt;String&gt;() &#123;</span><br><span class="hljs-comment">// @Override</span><br><span class="hljs-comment">// public void accept(String s) &#123;</span><br><span class="hljs-comment">// System.out.println(s);</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// &#125;;</span><br><span class="hljs-comment">// consumer.accept(&quot;aaaa&quot;);</span><br>Consumer&lt;String&gt; consumer =(s)-&gt;&#123;<br>System.out.println(s);<br>&#125;;<br>consumer.accept(<span class="hljs-string">&quot;aaa&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>Supplier ä¾›ç»™å‹æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Represents a supplier of results.<br>\*<br>\* &lt;p&gt;There is no requirement that a <span class="hljs-keyword">new</span> <span class="hljs-title class_">or</span> distinct result be returned each<br>\* time the supplier is invoked.<br>\*<br>\* &lt;p&gt;This is a &lt;a href=<span class="hljs-string">&quot;package-summary.html&quot;</span>&gt;functional interface&lt;/a&gt;<br>\* whose functional method is &#123;<span class="hljs-meta">@link</span> #get()&#125;.<br>\*<br>\* <span class="hljs-meta">@param</span> &lt;T&gt; the type of results supplied by <span class="hljs-built_in">this</span> supplier<br>\*<br>\* <span class="hljs-meta">@since</span> <span class="hljs-number">1.8</span><br>\*/<br><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Supplier</span>&lt;T&gt; &#123;<br>/\*\*<br>\* Gets a result.<br>\*<br>\* <span class="hljs-meta">@return</span> a result<br>\*/<br>T <span class="hljs-title function_">get</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ— å‚æ•°ï¼Œåªæœ‰è¿”å›å€¼</strong></p><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Supplier ä¾›ç»™å‹æ¥å£ï¼šæ²¡æœ‰å‚æ•°ï¼Œåªæœ‰è¿”å›<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">20</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo4</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">// Supplier&lt;Integer&gt; supplier = new Supplier&lt;Integer&gt;() &#123;</span><br><span class="hljs-comment">// @Override</span><br><span class="hljs-comment">// public Integer get() &#123;</span><br><span class="hljs-comment">// return 1024;</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// &#125;;</span><br>Supplier&lt;Integer&gt; supplier = ()-&gt;&#123;<span class="hljs-keyword">return</span> <span class="hljs-number">1024</span>;&#125;;<br>System.out.println(supplier.get());<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="13-Streamæµå¼è®¡ç®—"><a href="#13-Streamæµå¼è®¡ç®—" class="headerlink" title="13.Streamæµå¼è®¡ç®—"></a>13.Streamæµå¼è®¡ç®—</h2><blockquote><p>ä»€ä¹ˆæ˜¯Streamï¼Ÿ</p></blockquote><p>è¿™é‡Œè¯´çš„Streamä¸æ˜¯IOé‡Œçš„è¾“å…¥è¾“å‡ºæµï¼ŒStreamæµæ˜¯ä¸€ä¸ªé›†åˆå…ƒç´ çš„å‡½æ•°æ¨¡å‹(å¤„ç†çš„æ­¥éª¤æ–¹æ³•)ï¼Œå®ƒå¹¶ä¸æ˜¯é›†åˆï¼Œä¹Ÿä¸æ˜¯æ•°æ®ç»“æ„ï¼Œå…¶æœ¬èº«å¹¶ä¸å­˜å‚¨ä»»ä½•å…ƒç´ ï¼ˆæˆ–å…¶åœ°å€å€¼ï¼‰ã€‚</p><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* é¢˜ç›®è¦æ±‚ï¼šä¸€åˆ†é’Ÿå†…å®Œæˆæ­¤é¢˜ï¼Œåªèƒ½ç”¨ä¸€è¡Œä»£ç å®ç°ï¼<br>\* ç°åœ¨æœ‰<span class="hljs-number">5</span>ä¸ªç”¨æˆ·ï¼ç­›é€‰ï¼š<br>\* <span class="hljs-number">1</span>ã€ID å¿…é¡»æ˜¯å¶æ•°<br>\* <span class="hljs-number">2</span>ã€å¹´é¾„å¿…é¡»å¤§äº<span class="hljs-number">23</span>å²<br>\* <span class="hljs-number">3</span>ã€ç”¨æˆ·åè½¬ä¸ºå¤§å†™å­—æ¯<br>\* <span class="hljs-number">4</span>ã€ç”¨æˆ·åå­—æ¯å€’ç€æ’åº<br>\* <span class="hljs-number">5</span>ã€åªè¾“å‡ºä¸€ä¸ªç”¨æˆ·ï¼<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">User</span> <span class="hljs-variable">u1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-number">21</span>);<br><span class="hljs-type">User</span> <span class="hljs-variable">u2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">2</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-number">22</span>);<br><span class="hljs-type">User</span> <span class="hljs-variable">u3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">3</span>,<span class="hljs-string">&quot;c&quot;</span>,<span class="hljs-number">23</span>);<br><span class="hljs-type">User</span> <span class="hljs-variable">u4</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">4</span>,<span class="hljs-string">&quot;d&quot;</span>,<span class="hljs-number">24</span>);<br><span class="hljs-type">User</span> <span class="hljs-variable">u5</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">6</span>,<span class="hljs-string">&quot;e&quot;</span>,<span class="hljs-number">25</span>);<br><span class="hljs-comment">//è½¬é›†åˆ æ–¹ä¾¿æ“ä½œ</span><br>List&lt;User&gt; list = Arrays.asList(u1, u2, u3, u4, u5);<br><span class="hljs-comment">//stream</span><br>list.stream()<br>.filter((u)-&gt;&#123;<span class="hljs-keyword">return</span> u.getId()%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>;&#125;)<br>.filter((u)-&gt;&#123;<span class="hljs-keyword">return</span> u.getAge()&gt;<span class="hljs-number">23</span>;&#125;)<br>.map((u)-&gt;&#123;<span class="hljs-keyword">return</span> u.getName().toUpperCase();&#125;)<br>.sorted((uu1,uu2)-&gt;&#123;<span class="hljs-keyword">return</span> uu2.compareTo(uu1);&#125;)<br>.limit(<span class="hljs-number">1</span>).forEach(System.out::println);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="14-ForkJoin"><a href="#14-ForkJoin" class="headerlink" title="14.ForkJoin"></a>14.ForkJoin</h2><blockquote><p>ä»€ä¹ˆæ˜¯ForkJoin</p></blockquote><p>ForkJoinåœ¨JDK1.7ï¼Œå¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼æé«˜æ•ˆç‡ï¼</p><p><img src="https://i.loli.net/2021/01/26/Mq7gxTiZkLWP6No.jpg"></p><p>æŸ¥çœ‹JDK1.8å¸®åŠ©æ–‡æ¡£ï¼š</p><p><img src="https://i.loli.net/2021/01/26/BAacq5SvRrGVUke.jpg"></p><p><img src="https://i.loli.net/2021/01/26/j946zWAKDEobUML.jpg"></p><p><img src="https://i.loli.net/2021/01/26/6I2r9zU7DXOhYSf.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ç±»ä¼¼ä¸€ä¸ªåˆ†ä»»åŠ¡é€’å½’çš„å»æ‰§è¡Œï¼Œæ ¹æ®éœ€æ±‚å¯ä»¥é€‰æ‹©æ— è¿”å›å€¼å’Œæœ‰è¿”å›å€¼çš„æ–¹æ³•</p><p>å¯ä»¥å†™ä¸ªæµ‹è¯•ä¾‹å­ï¼Œå¯¹æ¯”ä¸‰ç§æ±‚å’Œæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* ForkJoinåˆ†æ”¯åˆå¹¶<br>\* ä½¿ç”¨æ–¹æ³•ï¼š<br>\* <span class="hljs-number">1.</span>forkJoinPool é€šè¿‡å®ƒæ‰§è¡Œ<br>\* <span class="hljs-number">2.</span>è®¡ç®—ä»»åŠ¡ forkjoinPool.execute(ForkJoinTask task)<br>\* <span class="hljs-number">3.</span>è®¡ç®—ç±»è¦ç»§æ‰¿ ForkJoinTask<br>\* æ±‚å’Œä»»åŠ¡ è®¡ç®—<span class="hljs-number">1</span>-<span class="hljs-number">10</span>äº¿çš„å’Œ<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">20</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForkJoinDemo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecursiveTask</span>&lt;Long&gt; &#123;<br><span class="hljs-keyword">private</span> Long start;<br><span class="hljs-keyword">private</span> Long end;<br><span class="hljs-comment">//ä¸´ç•Œå€¼</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">Long</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000L</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ForkJoinDemo</span><span class="hljs-params">(Long start, Long end)</span> &#123;<br><span class="hljs-built_in">this</span>.start = start;<br><span class="hljs-built_in">this</span>.end = end;<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> Long <span class="hljs-title function_">compute</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">if</span> ((end-start)&lt;temp)&#123;<br><span class="hljs-type">Long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0L</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">Long</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt;= end; i++) &#123;<br>sum += i;<br>&#125;<br><span class="hljs-keyword">return</span> sum;<br>&#125;<span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">//forkjoiné€’å½’</span><br><span class="hljs-type">long</span> <span class="hljs-variable">middle</span> <span class="hljs-operator">=</span> (start + end) / <span class="hljs-number">2</span>;<br><span class="hljs-type">ForkJoinDemo</span> <span class="hljs-variable">task1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinDemo</span>(start , middle);<br>task1.fork(); <span class="hljs-comment">// æ‹†åˆ†ä»»åŠ¡ï¼ŒæŠŠä»»åŠ¡å‹å…¥çº¿ç¨‹é˜Ÿåˆ—</span><br><span class="hljs-type">ForkJoinDemo</span> <span class="hljs-variable">task2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinDemo</span>(middle+<span class="hljs-number">1</span> , end);<br>task2.fork(); <span class="hljs-comment">// æ‹†åˆ†ä»»åŠ¡ï¼ŒæŠŠä»»åŠ¡å‹å…¥çº¿ç¨‹é˜Ÿåˆ—</span><br><span class="hljs-keyword">return</span> task1.join() + task2.join();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* æµ‹è¯•<span class="hljs-number">3</span>ç§æ±‚å’Œæ–¹å¼çš„æ€§èƒ½<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">20</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br><span class="hljs-comment">//test1(); //sum=500000000500000000 èŠ±è´¹æ—¶é—´ï¼š8366</span><br><span class="hljs-comment">//test2(); // sum=500000000500000000 èŠ±è´¹æ—¶é—´ï¼š8599</span><br>test3(); <span class="hljs-comment">//sum=500000000500000000 èŠ±è´¹æ—¶é—´ï¼š238</span><br>&#125;<br><span class="hljs-comment">//1.ç›´æ¥forå¾ªç¯æ±‚</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-type">Long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0L</span>;<br><span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br><span class="hljs-keyword">for</span> (<span class="hljs-type">Long</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>; i &lt;= <span class="hljs-number">10</span>\_0000\_0000; i++) &#123;<br>sum +=i;<br>&#125;<br><span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>System.out.println(<span class="hljs-string">&quot;sum=&quot;</span>+sum+<span class="hljs-string">&quot; èŠ±è´¹æ—¶é—´ï¼š&quot;</span>+(end-start));<br>&#125;<br><span class="hljs-comment">//2.forJoin</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br><span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br><span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">forkJoinPool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinPool</span>();<br>ForkJoinTask&lt;Long&gt; task = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinDemo</span>(<span class="hljs-number">0L</span>, <span class="hljs-number">10</span>\_0000\_0000L);<br>ForkJoinTask&lt;Long&gt; submit = forkJoinPool.submit(task);<br><span class="hljs-type">Long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> submit.get();<br><span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>System.out.println(<span class="hljs-string">&quot;sum=&quot;</span>+sum+<span class="hljs-string">&quot; èŠ±è´¹æ—¶é—´ï¼š&quot;</span>+(end-start));<br>&#125;<br><span class="hljs-comment">//3.Streamå¹¶è¡Œæµæ“ä½œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br><span class="hljs-comment">//Stream å¹¶è¡Œæµ</span><br><span class="hljs-type">Long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> LongStream.rangeClosed(<span class="hljs-number">0L</span>, <span class="hljs-number">10</span>\_0000\_0000L).parallel().reduce(<span class="hljs-number">0</span>,Long::sum);<br><span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>System.out.println(<span class="hljs-string">&quot;sum=&quot;</span>+sum+<span class="hljs-string">&quot; èŠ±è´¹æ—¶é—´ï¼š&quot;</span>+(end-start));<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°Streamçš„è®¡ç®—å·¨å¿«ï¼</p><p>è¿™é‡Œä¹Ÿåªæ˜¯è®²è§£ä¸‹ForkJoinçš„æ€æƒ³ï¼ŒStreamçš„ç›¸å…³çš„APIåœ¨JDKå¸®åŠ©æ–‡æ¡£ä¸­å†™çš„å¾ˆæ¸…æ¥šï¼Œå½“é‡åˆ°æŸä¸ªéœ€æ±‚æ—¶ï¼Œå¯ä»¥ç›´æ¥å»æŸ¥é˜…å³å¯ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šé˜è¿°ã€‚</p><h2 id="15-å¼‚æ­¥å›è°ƒ"><a href="#15-å¼‚æ­¥å›è°ƒ" class="headerlink" title="15.å¼‚æ­¥å›è°ƒ"></a>15.å¼‚æ­¥å›è°ƒ</h2><blockquote><p>Futureè®¾è®¡çš„åˆè¡·ï¼šå¯¹å°†æ¥çš„æŸä¸ªäº‹ä»¶çš„ç»“æœè¿›è¡Œå»ºæ¨¡</p></blockquote><p><img src="https://i.loli.net/2021/01/26/8XYHUZA6eumQSLJ.png"></p><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* å¼‚æ­¥è°ƒç”¨ï¼šCompletableFuture<br>\* ç±»ä¼¼Ajax Success error<br>\* å¼‚æ­¥æ‰§è¡Œ<br>\* æˆåŠŸå›è°ƒ<br>\* å¤±è´¥å›è°ƒ<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">20</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo1</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br><span class="hljs-comment">//æ— è¿”å›å€¼çš„runAsync å¼‚æ­¥å›è°ƒ</span><br><span class="hljs-comment">// CompletableFuture&lt;Void&gt; completableFuture = CompletableFuture.runAsync(()-&gt;&#123;</span><br><span class="hljs-comment">// try &#123;</span><br><span class="hljs-comment">// TimeUnit.SECONDS.sleep(2);</span><br><span class="hljs-comment">// &#125; catch (InterruptedException e) &#123;</span><br><span class="hljs-comment">// e.printStackTrace();</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// System.out.println(Thread.currentThread().getName()+&quot;runAsync=&gt;Void&quot;);</span><br><span class="hljs-comment">// &#125;);</span><br><span class="hljs-comment">// System.out.println(&quot;111&quot;);</span><br><span class="hljs-comment">// completableFuture.get(); //è·å–å›è°ƒç»“æœ</span><br><span class="hljs-comment">//æœ‰è¿”å›å€¼çš„å›è°ƒ</span><br>CompletableFuture&lt;Integer&gt; completableFuture = CompletableFuture.supplyAsync(()-&gt;&#123;<br>System.out.println(Thread.currentThread().getName()+<span class="hljs-string">&quot;supplyAsync=&gt;Integer&quot;</span>);<br><span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span> / <span class="hljs-number">0</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-number">1024</span>;<br>&#125;);<br>completableFuture.whenComplete((t,u)-&gt;&#123;<br>System.out.println(<span class="hljs-string">&quot;t====&gt;&quot;</span>+t); <span class="hljs-comment">//æ­£ç¡®çš„è¿”å›ç»“æœ</span><br>System.out.println(<span class="hljs-string">&quot;u====&gt;&quot;</span>+u); <span class="hljs-comment">//é”™è¯¯çš„è¿”å›ç»“æœ</span><br>&#125;).exceptionally((e)-&gt;&#123; <span class="hljs-comment">//é”™è¯¯çš„è¿”å›å‡½æ•°</span><br>System.out.println(e.getMessage()); <span class="hljs-comment">//CompletionException</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">233</span>;<br>&#125;).get();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="16-JMM"><a href="#16-JMM" class="headerlink" title="16.JMM"></a>16.JMM</h2><blockquote><p>Volatileçš„ç†è§£</p></blockquote><p>Volatile æ˜¯ Java è™šæ‹Ÿæœºæä¾›<strong>è½»é‡çº§çš„åŒæ­¥æœºåˆ¶</strong></p><p>1ã€ä¿è¯å¯è§æ€§</p><p>2ã€ä¸ä¿è¯åŸå­æ€§</p><p>3ã€ç¦æ­¢æŒ‡ä»¤é‡æ’</p><blockquote><p>JMMæ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>Javaçš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹</p><p><strong>å…³äºJMMçš„ä¸€äº›åŒæ­¥çº¦å®šï¼š</strong></p><p>1.çº¿ç¨‹è§£é”å‰ï¼Œå¿…é¡»æŠŠå…±äº«å˜é‡ç«‹åˆ»åˆ·å›ä¸»å­˜ï¼›</p><p>2.çº¿ç¨‹åŠ é”å‰ï¼Œå¿…é¡»è¯»å–ä¸»å­˜ä¸­çš„æœ€æ–°å€¼åˆ°å·¥ä½œå†…å­˜ä¸­ï¼›</p><p>3.åŠ é”å’Œè§£é”æ˜¯åŒä¸€æŠŠé”ã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯å·¥ä½œå†…å­˜ï¼Ÿä»€ä¹ˆæ˜¯ä¸»å­˜ï¼Ÿ</p></blockquote><p><img src="https://i.loli.net/2021/01/26/qYidJoawj3S7L5e.jpg"></p><p><a href="https://imgchr.com/i/sXts0S"><img src="https://s3.ax1x.com/2021/01/26/sXts0S.jpg"></a></p><p><strong>å†…å­˜äº¤äº’æ“ä½œæœ‰8ç§ï¼Œè™šæ‹Ÿæœºå®ç°å¿…é¡»ä¿è¯æ¯ä¸€ä¸ªæ“ä½œéƒ½æ˜¯åŸå­çš„ï¼Œä¸å¯åœ¨åˆ†çš„ï¼ˆå¯¹äºdoubleå’Œlongç±»</strong></p><p><strong>å‹çš„å˜é‡æ¥è¯´ï¼Œloadã€storeã€readå’Œwriteæ“ä½œåœ¨æŸäº›å¹³å°ä¸Šå…è®¸ä¾‹å¤–ï¼‰</strong></p><ul><li>lock ï¼ˆé”å®šï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºçº¿ç¨‹ç‹¬å çŠ¶æ€</li><li>unlock ï¼ˆè§£é”ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®š</li><li>read ï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨</li><li>load ï¼ˆè½½å…¥ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠreadæ“ä½œä»ä¸»å­˜ä¸­å˜é‡æ”¾å…¥å·¥ä½œå†…å­˜ä¸­</li><li>use ï¼ˆä½¿ç”¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ä¼ è¾“ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡çš„å€¼ï¼Œå°±ä¼šä½¿ç”¨åˆ°è¿™ä¸ªæŒ‡ä»¤</li><li>assign ï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“ä¸­æ¥å—åˆ°çš„å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­</li><li>store ï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»å·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿åç»­çš„writeä½¿ç”¨</li><li>write ï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­</li></ul><p><strong>JMMå¯¹è¿™å…«ç§æŒ‡ä»¤çš„ä½¿ç”¨ï¼Œåˆ¶å®šäº†å¦‚ä¸‹è§„åˆ™ï¼š</strong></p><ul><li><p>ä¸å…è®¸readå’Œloadã€storeå’Œwriteæ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°ã€‚å³ä½¿ç”¨äº†readå¿…é¡»loadï¼Œä½¿ç”¨äº†storeå¿…é¡»write</p></li><li><p>ä¸å…è®¸çº¿ç¨‹ä¸¢å¼ƒä»–æœ€è¿‘çš„assignæ“ä½œï¼Œå³å·¥ä½œå˜é‡çš„æ•°æ®æ”¹å˜äº†ä¹‹åï¼Œå¿…é¡»å‘ŠçŸ¥ä¸»å­˜</p></li><li><p>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹å°†æ²¡æœ‰assignçš„æ•°æ®ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜</p></li><li><p>ä¸€ä¸ªæ–°çš„å˜é‡å¿…é¡»åœ¨ä¸»å†…å­˜ä¸­è¯ç”Ÿï¼Œä¸å…è®¸å·¥ä½œå†…å­˜ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–çš„å˜é‡ã€‚å°±æ˜¯å¯¹å˜é‡å®æ–½useã€storeæ“ä½œä¹‹å‰ï¼Œå¿…é¡»ç»è¿‡assignå’Œloadæ“ä½œ</p></li><li><p>ä¸€ä¸ªå˜é‡åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¯¹å…¶è¿›è¡Œlockã€‚<strong>å¤šæ¬¡lockåï¼Œå¿…é¡»æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„unlockæ‰èƒ½è§£é”</strong></p></li><li><p>å¦‚æœå¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œlockæ“ä½œï¼Œä¼šæ¸…ç©ºæ‰€æœ‰å·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œå¿…é¡»é‡æ–°loadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼</p></li><li><p>å¦‚æœä¸€ä¸ªå˜é‡æ²¡æœ‰è¢«lockï¼Œå°±ä¸èƒ½å¯¹å…¶è¿›è¡Œunlockæ“ä½œã€‚ä¹Ÿä¸èƒ½unlockä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”ä½çš„å˜é‡å¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»æŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜</p><p>â€‹</p></li></ul><p>å†™ä¸ªæµ‹è¯•ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Volatileçš„å¯è§æ€§<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">20</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JMMDemo1</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">//ä¸»å­˜ä¸­numå·²ç»ç½®ä¸º10 ä½†çº¿ç¨‹ä¸­æœªå¾—åˆ°ä¿¡æ¯ é™·å…¥æ­»å¾ªç¯</span><br><span class="hljs-comment">//åŠ å…¥Volatile ä¿è¯å¯è§æ€§</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br><span class="hljs-keyword">while</span> (num == <span class="hljs-number">0</span>)&#123;<br>&#125;<br>&#125;).start();<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>num = <span class="hljs-number">10</span>;<br>System.out.println(<span class="hljs-string">&quot;num:&quot;</span>+num);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>mainçº¿ç¨‹ä¸­æŠŠnumç½®ä¸º10äº†ï¼Œä½†æ–°å¼€çš„çº¿ç¨‹ç”±äºä¸çŸ¥é“åˆ°æŠŠnumç½®ä¸º10ï¼Œä¸€ç›´åœ¨whileå¾ªç¯ä¸­è·³ä¸å‡ºæ¥ï¼Œç¨‹åºå‡ºç°æ­»å¾ªç¯ï¼Œè§£å†³çš„åŠæ³•å°±æ˜¯åœ¨numçš„å£°æ˜ä¸­åŠ å…¥volatileï¼Œä¿è¯çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼</p><p>å…³äºvolatileå…·ä½“çš„ç†è§£å’Œæµ‹è¯•ï¼Œå°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è¿›è¡Œè¯¦ç»†è®²è§£ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆäºŒï¼‰</title>
    <link href="/2021/01/25/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <url>/2021/01/25/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆäºŒï¼‰"><a href="#JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆäºŒï¼‰" class="headerlink" title="JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆäºŒï¼‰"></a>JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆäºŒï¼‰</h1><h2 id="6-å…«é”é—®é¢˜"><a href="#6-å…«é”é—®é¢˜" class="headerlink" title="6.å…«é”é—®é¢˜"></a>6.å…«é”é—®é¢˜</h2><blockquote><p>1.ä¸¤ä¸ªsync <strong>é”çš„å¯¹è±¡æ˜¯æ–¹æ³•çš„è°ƒç”¨è€…</strong>ï¼ŒæŒ‰é¡ºåºè°ƒç”¨ å‘çŸ­ä¿¡ æ‰“ç”µè¯</p><p>2.å‘çŸ­ä¿¡ä¼‘çœ 4S ä¾æ—§ä¸€æ · æŒ‰é¡ºåºè°ƒç”¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-number">8</span>é”ï¼Œå…³äºé”çš„<span class="hljs-number">8</span>ä¸ªé—®é¢˜<br>\* <span class="hljs-number">1.</span>ä¸¤ä¸ªsync é”çš„å¯¹è±¡æ˜¯æ–¹æ³•çš„è°ƒç”¨è€…ï¼ŒæŒ‰é¡ºåºè°ƒç”¨ å‘çŸ­ä¿¡ æ‰“ç”µè¯<br>\* <span class="hljs-number">2.</span>å‘çŸ­ä¿¡ä¼‘çœ 4S ä¾æ—§ä¸€æ · æŒ‰é¡ºåºè°ƒç”¨<br>\* æ ¸å¿ƒï¼š å¯¹è±¡ï¼ï¼ï¼<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">18</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test1</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();<br><span class="hljs-type">Phone</span> <span class="hljs-variable">phone1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>phone.sendMes();<br>&#125;, <span class="hljs-string">&quot;A&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>phone.call();<br>&#125;, <span class="hljs-string">&quot;B&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>phone1.call();<br>&#125;, <span class="hljs-string">&quot;C&quot;</span>).start();<br>&#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMes</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;å‘çŸ­ä¿¡&quot;</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>System.out.println(<span class="hljs-string">&quot;æ‰“ç”µè¯&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>3.å¢åŠ ä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸ä¼šå—syncçš„é™åˆ¶ï¼Œä¼˜å…ˆæ‰§è¡Œ</p><p>4.ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸¤ä¸ªåŒæ­¥æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-number">3.</span>å¢åŠ ä¸€ä¸ªæ™®é€šæ–¹æ³• è¯¥æ–¹æ³•ä¸å—åŒæ­¥é”é™åˆ¶ ä¼šå…ˆæ‰§è¡Œ<br>\* <span class="hljs-number">4.</span>ä¸¤ä¸ªå¯¹è±¡ ä¸¤ä¸ªåŒæ­¥æ–¹æ³•<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">18</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test2</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸¤æŠŠé”ï¼Œé‚£å°±æŒ‰æ—¶é—´å…ˆåæ‰§è¡Œ</span><br><span class="hljs-type">Phone2</span> <span class="hljs-variable">phone1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone2</span>();<br><span class="hljs-type">Phone2</span> <span class="hljs-variable">phone2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone2</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>phone1.sendMes();<br>&#125;, <span class="hljs-string">&quot;A&quot;</span>).start();<br><span class="hljs-comment">// æ•è·</span><br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>phone2.call();<br>&#125;, <span class="hljs-string">&quot;B&quot;</span>).start();<br>&#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone2</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMes</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>System.out.println(Thread.currentThread().getName() +<span class="hljs-string">&quot;å‘çŸ­ä¿¡&quot;</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>System.out.println(Thread.currentThread().getName() +<span class="hljs-string">&quot;æ‰“ç”µè¯&quot;</span>);<br>&#125;<br><span class="hljs-comment">//ä¸€ä¸ªä¸åŠ é”çš„åŒæ­¥æ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayHello</span><span class="hljs-params">()</span> &#123;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;=====&gt;hello&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ul><li><p>æŠŠæ™®é€šæ–¹æ³•å’Œsyncæ–¹æ³•æ”¾ä¸€èµ·æ‰§è¡Œï¼Œç”±äºsyncæ‰§è¡Œéœ€è¦æ‹¿åˆ°é”æ‰èƒ½æ‰§è¡Œï¼Œä½†æ™®é€šæ–¹æ³•ä¸å—é”çš„å½±å“ï¼Œæ‰€ä»¥ä¼˜å…ˆæ‰§è¡Œï¼›</p></li><li><p>ä¸¤ä¸ªå¯¹è±¡ï¼Œå»æ“ä½œsyncæ–¹æ³•ï¼Œä¼šå‘ç°æ²¡æœ‰è¿›è¡Œçº¿ç¨‹ä¼‘çœ çš„call()å…ˆè¿è¡Œï¼Œå› ä¸ºä¸¤ä¸ªå¯¹è±¡å°±æ˜¯ä¸¤æŠŠé”äº†ï¼Œä¼šæŒ‰æ—¶é—´å…ˆåè¿›è¡Œäº†ã€‚</p><p>â€‹</p></li></ul><blockquote><p>5.ä¸¤ä¸ªé™æ€syncæ–¹æ³•ï¼Œä¸€ä¸ªå¯¹è±¡å»è°ƒç”¨</p><p>6.ä¸¤ä¸ªé™æ€syncæ–¹æ³•ï¼Œä¸¤ä¸ªå¯¹è±¡å»è°ƒç”¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-number">5.</span>å¢åŠ ä¸¤ä¸ªé™æ€æ–¹æ³• ä¸€ä¸ªå¯¹è±¡ å‘çŸ­ä¿¡ æ‰“ç”µè¯<br>\* <span class="hljs-number">6.</span>ä¸¤ä¸ªå¯¹è±¡ ä¸¤ä¸ªé™æ€çš„åŒæ­¥æ–¹æ³• å‘çŸ­ä¿¡ æ‰“ç”µè¯<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">18</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test3</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//ä¸¤ä¸ªå¯¹è±¡çš„classç±»æ¨¡æ¿åªæœ‰ä¸€ä¸ªï¼Œstatisé”çš„æ˜¯class</span><br><span class="hljs-type">Phone3</span> <span class="hljs-variable">phone1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone3</span>();<br><span class="hljs-type">Phone3</span> <span class="hljs-variable">phone2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone3</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>phone1.sendMes();<br>&#125;, <span class="hljs-string">&quot;A&quot;</span>).start();<br><span class="hljs-comment">// æ•è·</span><br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>phone2.call();<br>&#125;, <span class="hljs-string">&quot;B&quot;</span>).start();<br>&#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone3</span> &#123;<br><span class="hljs-comment">//é™æ€çš„åŒæ­¥æ–¹æ³• é”çš„æ˜¯ classç±»æ¨¡æ¿</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMes</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;å‘çŸ­ä¿¡&quot;</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>System.out.println(<span class="hljs-string">&quot;æ‰“ç”µè¯&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ul><li><p>éœ€è¦æ³¨æ„çš„æ˜¯staticæ˜¯ç±»çš„ä¿®é¥°ï¼Œæ„æ˜¯åœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºäº†ï¼Œç”¨staticå»ä¿®è®¾syncæ–¹æ³•ï¼Œæ­¤æ—¶å°±ä¸æ˜¯é”çš„æ–¹æ³•çš„è°ƒç”¨è€…äº†ï¼Œæ˜¯é”çš„æ•´ä¸ªç±»äº†ï¼Œæ•…å½“ä¸€ä¸ªå¯¹è±¡å»è°ƒç”¨æ—¶ï¼ŒæŒ‰è°ƒç”¨æ¬¡åºçš„å…ˆåæ‰§è¡Œã€‚</p></li><li><p>ç±»é”ä¸èµ„æºå¯¹è±¡çš„å¤šå°‘æ— å…³ï¼Œå¤šä¸ªèµ„æºå¯¹è±¡å…±äº«ä¸€ä¸ªç±»é”</p><p>â€‹</p></li></ul><blockquote><p>7.ä¸€ä¸ªé™æ€çš„åŒæ­¥æ–¹æ³•ï¼Œä¸€ä¸ªæ™®é€šçš„åŒæ­¥æ–¹æ³• ä¸€ä¸ªå¯¹è±¡ æ‰“ç”µè¯ å‘çŸ­ä¿¡</p><p>8.ä¸€ä¸ªé™æ€çš„åŒæ­¥æ–¹æ³•ï¼Œä¸€ä¸ªæ™®é€šçš„åŒæ­¥æ–¹æ³• ä¸¤ä¸ªä¸ªå¯¹è±¡ æ‰“ç”µè¯ å‘çŸ­ä¿¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-number">7.</span>ä¸€ä¸ªé™æ€çš„åŒæ­¥æ–¹æ³• ä¸€ä¸ªæ™®é€šçš„åŒæ­¥æ–¹æ³• ä¸€ä¸ªå¯¹è±¡ æ‰“ç”µè¯ å‘çŸ­ä¿¡<br>\* <span class="hljs-number">8.</span>ä¸€ä¸ªé™æ€çš„åŒæ­¥æ–¹æ³• ä¸€ä¸ªæ™®é€šçš„åŒæ­¥æ–¹æ³• ä¸¤ä¸ªå¯¹è±¡ æ‰“ç”µè¯ å‘çŸ­ä¿¡<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">18</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test4</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">Phone4</span> <span class="hljs-variable">phone1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone4</span>();<br><span class="hljs-type">Phone4</span> <span class="hljs-variable">phone2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone4</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>phone1.sendMes();<br>&#125;, <span class="hljs-string">&quot;A&quot;</span>).start();<br><span class="hljs-comment">// æ•è·</span><br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>phone2.call();<br>&#125;, <span class="hljs-string">&quot;B&quot;</span>).start();<br>&#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone4</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMes</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;å‘çŸ­ä¿¡&quot;</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>System.out.println(<span class="hljs-string">&quot;æ‰“ç”µè¯&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><p>ç±»é”å’Œå¯¹è±¡é”äº’ä¸å¹²æ‰°ï¼Œç”±äºsendMes() æ˜¯ç±»é”ï¼Œè¦ç­‰4ç§’ï¼Œè€Œcall()å’Œå®ƒä¸æ˜¯ä¸€ç±»é”ï¼Œæ‰€ä»¥å…ˆæ‰§è¡Œã€‚</p><p><strong>æ€»ç»“ï¼š</strong></p><p>1ã€å½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è®¿é—®åŒæ­¥ä»£ç å—æ—¶ï¼Œå®ƒé¦–å…ˆå¿…é¡»å¾—åˆ°é”ï¼Œé€€å‡ºæˆ–æŠ›å‡ºå¼‚å¸¸æ—¶å¿…é¡»é‡Šæ”¾é”ã€‚</p><p>2ã€Java ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ï¼›<strong>æ™®é€šåŒæ­¥æ–¹æ³•é” thisï¼Œé™æ€åŒæ­¥æ–¹æ³•é” Class</strong>ï¼ŒåŒæ­¥æ–¹æ³•å—é”æ‹¬å·ï¼›</p><p>3ã€åªè¦<strong>é”çš„å¯¹è±¡ä¸æ˜¯åŒä¸€ä¸ª</strong>ï¼Œå°±ç›´æ¥æŒ‰ç…§çº¿ç¨‹æ‰§è¡Œçš„<strong>å¿«æ…¢æ¥å†³å®š</strong>ï¼›<strong>é”çš„å¯¹è±¡æ˜¯åŒä¸€ä¸ª</strong>ï¼Œå°±æŒ‰ç…§çº¿ç¨‹è¿›å…¥çš„å…ˆ<strong>åé¡ºåºå†³å®š</strong>ã€‚</p><h2 id="7-é›†åˆç±»ä¸å®‰å…¨"><a href="#7-é›†åˆç±»ä¸å®‰å…¨" class="headerlink" title="7.é›†åˆç±»ä¸å®‰å…¨"></a>7.é›†åˆç±»ä¸å®‰å…¨</h2><blockquote><p>Listä¸å®‰å…¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">18</span><br>\*/<br><span class="hljs-comment">//java.util.ConcurrentModificationException</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ListTest</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//æµ‹è¯•å¹¶å‘ä¸‹çš„ArraysList ä¸å®‰å…¨ java.util.ConcurrentModificationException</span><br>/\*\*<br>\* è§£å†³æ–¹æ¡ˆï¼š<br>\* <span class="hljs-number">1.</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector</span>() çº¿ç¨‹å®‰å…¨<br>\* <span class="hljs-number">2.</span>Collections.synchronizedList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;());<br>\* <span class="hljs-number">3.</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;();<br>\*/<br><span class="hljs-comment">//CopyOnWrite å†™å…¥æ—¶å¤åˆ¶ COW è®¡ç®—æœºç¨‹åºè®¾è®¡é¢†åŸŸçš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥</span><br><span class="hljs-comment">//å¤šçº¿ç¨‹è°ƒç”¨æ—¶ï¼Œlistï¼Œè¯»å–çš„æ—¶å€™ï¼Œå›ºå®šçš„ï¼Œå†™å…¥è¦†ç›–</span><br><span class="hljs-comment">//å†å†™å…¥çš„æ—¶å€™é¿å…è¦†ç›–ï¼Œé€ æˆæ•°æ®é—®é¢˜</span><br><span class="hljs-comment">//è¯»å†™åˆ†ç¦»</span><br><span class="hljs-comment">//CopyOnWriteArray åº•å±‚æ˜¯æ•°ç»„å¤åˆ¶ Voctorçš„addåº•å±‚æ˜¯sync æ•ˆç‡è¾ƒä½</span><br>List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vector</span>&lt;&gt;();<br><span class="hljs-comment">// List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());</span><br><span class="hljs-comment">// List&lt;Object&gt; list = new CopyOnWriteArrayList&lt;&gt;();</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>list.add(UUID.randomUUID().toString().substring(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>));<br>list.forEach(System.out::println);<br>&#125;, String.valueOf(i)).start();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>Mapä¸å®‰å…¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* æµ‹è¯•HashMap<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">18</span><br>\*/<br><span class="hljs-comment">//java.util.ConcurrentModificationException</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapTest</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//map</span><br>/\*\*<br>\* è§£å†³æ–¹æ¡ˆ<br>\* <span class="hljs-number">1.</span> Collections.synchronizedMap(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;());<br>\* <span class="hljs-number">2.</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br>\*/<br><span class="hljs-comment">//é»˜è®¤ç­‰ä»·äºä»€ä¹ˆï¼Ÿ new HashMap(16,0.75);</span><br><span class="hljs-comment">// Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="hljs-comment">// Map&lt;String, Object&gt; map = Collections.synchronizedMap(new HashMap&lt;&gt;());</span><br>Map&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>map.put(Thread.currentThread().getName(), UUID.randomUUID().toString().substring(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>));<br>System.out.println(map);<br>&#125;).start();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>HashMapé¢è¯•ç»å¯¹ä¼šé—®åº•å±‚å®ç°å’Œå¦‚ä½•æ’å…¥é‡å¤keyï¼Œåé¢ä¼šå•ç‹¬å†™ä¸€ç¯‡å…³äºHashMapçš„æ–‡ç« ï¼</p><blockquote><p>Setæµ‹è¯•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* æµ‹è¯•HashSet<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">18</span><br>\*/<br><span class="hljs-comment">//java.util.ConcurrentModificationException</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetTest</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//Set&lt;String&gt; set = new HashSet&lt;&gt;();</span><br><span class="hljs-comment">//HashSet åº•å±‚å°±æ˜¯HashMap</span><br>/\*\*<br>\* è§£å†³æ–¹æ¡ˆï¼š<br>\* <span class="hljs-number">1.</span>Collections.synchronizedSet(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;());<br>\* <span class="hljs-number">2.</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArraySet</span>&lt;&gt;();<br>\*/<br><span class="hljs-comment">// Set&lt;Object&gt; set = Collections.synchronizedSet(new HashSet&lt;&gt;());</span><br>Set&lt;Object&gt; set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArraySet</span>&lt;&gt;();<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>set.add(UUID.randomUUID().toString().substring(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>));<br>System.out.println(set);<br>&#125;).start();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>hashSetåº•å±‚æ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> HashMap&lt;E,Object&gt; map;<br><span class="hljs-comment">// Dummy value to associate with an Object in the backing Map</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">PRESENT</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>/\*\*<br>\* Constructs a <span class="hljs-keyword">new</span>, empty set; the backing &lt;tt&gt;HashMap&lt;/tt&gt; instance has<br>\* <span class="hljs-keyword">default</span> initial <span class="hljs-title function_">capacity</span> <span class="hljs-params">(<span class="hljs-number">16</span>)</span> and load <span class="hljs-title function_">factor</span> <span class="hljs-params">(<span class="hljs-number">0.75</span>)</span>.<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">HashSet</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">//å¥½å®¶ä¼™ï¼Œåº•å±‚ä¹‹é—´newçš„HashMap()</span><br>map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>&#125;<br>/\*\*<br>\* Constructs a <span class="hljs-keyword">new</span> <span class="hljs-title class_">set</span> containing the elements in the specified<br>\* collection. The &lt;tt&gt;HashMap&lt;/tt&gt; is created with <span class="hljs-keyword">default</span> load factor<br>\* (<span class="hljs-number">0.75</span>) and an initial capacity sufficient to contain the elements in<br>\* the specified collection.<br>\*<br>\* <span class="hljs-meta">@param</span> c the collection whose elements are to be placed into <span class="hljs-built_in">this</span> set<br>\* <span class="hljs-meta">@throws</span> NullPointerException <span class="hljs-keyword">if</span> the specified collection is <span class="hljs-literal">null</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">HashSet</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> &#123;<br>map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(Math.max((<span class="hljs-type">int</span>) (c.size()/<span class="hljs-number">.75f</span>) + <span class="hljs-number">1</span>, <span class="hljs-number">16</span>));<br>addAll(c);<br>&#125;<br>/\*\*<br>\* Constructs a <span class="hljs-keyword">new</span>, empty set; the backing &lt;tt&gt;HashMap&lt;/tt&gt; instance has<br>\* the specified initial capacity and the specified load factor.<br>\*<br>\* <span class="hljs-meta">@param</span> initialCapacity the initial capacity of the hash map<br>\* <span class="hljs-meta">@param</span> loadFactor the load factor of the hash map<br>\* <span class="hljs-meta">@throws</span> IllegalArgumentException <span class="hljs-keyword">if</span> the initial capacity is less<br>\* than zero, or <span class="hljs-keyword">if</span> the load factor is nonpositive<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">HashSet</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity, <span class="hljs-type">float</span> loadFactor)</span> &#123;<br>map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(initialCapacity, loadFactor);<br>&#125;<br>/\*\*<br>\* Constructs a <span class="hljs-keyword">new</span>, empty set; the backing &lt;tt&gt;HashMap&lt;/tt&gt; instance has<br>\* the specified initial capacity and <span class="hljs-keyword">default</span> load <span class="hljs-title function_">factor</span> <span class="hljs-params">(<span class="hljs-number">0.75</span>)</span>.<br>\*<br>\* <span class="hljs-meta">@param</span> initialCapacity the initial capacity of the hash table<br>\* <span class="hljs-meta">@throws</span> IllegalArgumentException <span class="hljs-keyword">if</span> the initial capacity is less<br>\* than zero<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">HashSet</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity)</span> &#123;<br>map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(initialCapacity);<br>&#125;<br>/\*\*<br>\* Constructs a <span class="hljs-keyword">new</span>, empty linked hash set. (This <span class="hljs-keyword">package</span> <span class="hljs-keyword">private</span><br>\* constructor is only used by LinkedHashSet.) The backing<br>\* HashMap instance is a LinkedHashMap with the specified initial<br>\* capacity and the specified load factor.<br>\*<br>\* <span class="hljs-meta">@param</span> initialCapacity the initial capacity of the hash map<br>\* <span class="hljs-meta">@param</span> loadFactor the load factor of the hash map<br>\* <span class="hljs-meta">@param</span> dummy <span class="hljs-title function_">ignored</span> <span class="hljs-params">(distinguishes <span class="hljs-built_in">this</span></span><br><span class="hljs-params">\* constructor from other <span class="hljs-type">int</span>, <span class="hljs-type">float</span> constructor.)</span><br>\* <span class="hljs-meta">@throws</span> IllegalArgumentException <span class="hljs-keyword">if</span> the initial capacity is less<br>\* than zero, or <span class="hljs-keyword">if</span> the load factor is nonpositive<br>\*/<br>HashSet(<span class="hljs-type">int</span> initialCapacity, <span class="hljs-type">float</span> loadFactor, <span class="hljs-type">boolean</span> dummy) &#123;<br>map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;(initialCapacity, loadFactor);<br>&#125;<br>/\*\*<br>\* Returns an iterator over the elements in <span class="hljs-built_in">this</span> set. The elements<br>\* are returned in no particular order.<br>\*<br>\* <span class="hljs-meta">@return</span> an Iterator over the elements in <span class="hljs-built_in">this</span> set<br>\* <span class="hljs-meta">@see</span> ConcurrentModificationException<br>\*/<br><span class="hljs-keyword">public</span> Iterator&lt;E&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> map.keySet().iterator();<br>&#125;<br>/\*\*<br>\* Returns the number of elements in <span class="hljs-built_in">this</span> <span class="hljs-title function_">set</span> <span class="hljs-params">(its cardinality)</span>.<br>\*<br>\* <span class="hljs-meta">@return</span> the number of elements in <span class="hljs-built_in">this</span> <span class="hljs-title function_">set</span> <span class="hljs-params">(its cardinality)</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> map.size();<br>&#125;<br>/\*\*<br>\* Returns &lt;tt&gt;<span class="hljs-literal">true</span>&lt;/tt&gt; <span class="hljs-keyword">if</span> <span class="hljs-built_in">this</span> set contains no elements.<br>\*<br>\* <span class="hljs-meta">@return</span> &lt;tt&gt;<span class="hljs-literal">true</span>&lt;/tt&gt; <span class="hljs-keyword">if</span> <span class="hljs-built_in">this</span> set contains no elements<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> map.isEmpty();<br>&#125;<br>/\*\*<br>\* Returns &lt;tt&gt;<span class="hljs-literal">true</span>&lt;/tt&gt; <span class="hljs-keyword">if</span> <span class="hljs-built_in">this</span> set contains the specified element.<br>\* More formally, returns &lt;tt&gt;<span class="hljs-literal">true</span>&lt;/tt&gt; <span class="hljs-keyword">if</span> and only <span class="hljs-keyword">if</span> <span class="hljs-built_in">this</span> set<br>\* contains an element &lt;tt&gt;e&lt;/tt&gt; such that<br>\* &lt;tt&gt;(o==<span class="hljs-literal">null</span>&amp;nbsp;?&amp;nbsp;e==<span class="hljs-literal">null</span>&amp;nbsp;:&amp;nbsp;o.equals(e))&lt;/tt&gt;.<br>\*<br>\* <span class="hljs-meta">@param</span> o element whose presence in <span class="hljs-built_in">this</span> set is to be tested<br>\* <span class="hljs-meta">@return</span> &lt;tt&gt;<span class="hljs-literal">true</span>&lt;/tt&gt; <span class="hljs-keyword">if</span> <span class="hljs-built_in">this</span> set contains the specified element<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(Object o)</span> &#123;<br><span class="hljs-keyword">return</span> map.containsKey(o);<br>&#125;<br>/\*\*<br>\* Adds the specified element to <span class="hljs-built_in">this</span> set <span class="hljs-keyword">if</span> it is not already present.<br>\* More formally, adds the specified element &lt;tt&gt;e&lt;/tt&gt; to <span class="hljs-built_in">this</span> set <span class="hljs-keyword">if</span><br>\* <span class="hljs-built_in">this</span> set contains no element &lt;tt&gt;e2&lt;/tt&gt; such that<br>\* &lt;tt&gt;(e==<span class="hljs-literal">null</span>&amp;nbsp;?&amp;nbsp;e2==<span class="hljs-literal">null</span>&amp;nbsp;:&amp;nbsp;e.equals(e2))&lt;/tt&gt;.<br>\* If <span class="hljs-built_in">this</span> set already contains the element, the call leaves the set<br>\* unchanged and returns &lt;tt&gt;<span class="hljs-literal">false</span>&lt;/tt&gt;.<br>\*<br>\* <span class="hljs-meta">@param</span> e element to be added to <span class="hljs-built_in">this</span> set<br>\* <span class="hljs-meta">@return</span> &lt;tt&gt;<span class="hljs-literal">true</span>&lt;/tt&gt; <span class="hljs-keyword">if</span> <span class="hljs-built_in">this</span> set did not already contain the specified<br>\* element<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span> &#123;<br><span class="hljs-comment">//map å’Œ setçš„åŒºåˆ« è‹¥ä¹‹å‰å­˜åœ¨çš„keyæ˜¯ä¸èƒ½å†åŠ å…¥setçš„ï¼Œè¿”å›false</span><br><span class="hljs-comment">//mapåˆ™ä¼šè¦†ç›–</span><br><span class="hljs-keyword">return</span> map.put(e, PRESENT)==<span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="8-å¸¸ç”¨è¾…åŠ©ç±»"><a href="#8-å¸¸ç”¨è¾…åŠ©ç±»" class="headerlink" title="8.å¸¸ç”¨è¾…åŠ©ç±»"></a>8.å¸¸ç”¨è¾…åŠ©ç±»</h2><h3 id="8-1-CountDownLatch"><a href="#8-1-CountDownLatch" class="headerlink" title="8.1.CountDownLatch"></a><strong>8.1.CountDownLatch</strong></h3><p><a href="https://imgchr.com/i/sLpdnH"><img src="https://s3.ax1x.com/2021/01/25/sLpdnH.jpg"></a></p><p>JDK1.8å®˜æ–¹æ–‡æ¡£å·²ç»è¯´çš„å¾ˆæ¸…æ¥šäº†ï¼ŒCountDownLatchèµ·ä¸€ä¸ªçº¿ç¨‹åŒæ­¥è¾…åŠ©çš„ä½œç”¨ï¼Œç±»ä¼¼ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå·²ç»ç»™å‡ºç¤ºä¾‹ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å†™æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* CountDownLatch è®¡æ•°å™¨<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">18</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountDownLatchDemo</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><span class="hljs-comment">//æœ‰çº¿ç¨‹ä»»åŠ¡çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ï¼</span><br><span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">6</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++) &#123;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>countDownLatch.countDown();<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; Go out&quot;</span>+<span class="hljs-string">&quot;å½“å‰è®¡æ•°å™¨==&gt;&quot;</span>+countDownLatch.getCount());<br>&#125;, String.valueOf(i)).start();<br>&#125;<br>countDownLatch.await();<br>System.out.println(<span class="hljs-string">&quot;Close Door&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><p>countDownLatch.countDown(); &#x2F;&#x2F;æ•°é‡-1</p><p>countDownLatch.await(); &#x2F;&#x2F;ç­‰å¾…è®¡æ•°å™¨å½’é›¶ï¼Œç„¶åå†å‘ä¸‹æ‰§è¡Œ</p><p>æ¯æ¬¡æœ‰çº¿ç¨‹è°ƒç”¨ countDown() æ•°é‡-1ï¼Œå‡è®¾è®¡æ•°å™¨å˜ä¸º0ï¼ŒcountDownLatch.await() å°±ä¼šè¢«å”¤é†’ï¼Œç»§ç»­</p><p>æ‰§è¡Œï¼</p><h3 id="8-2-CyclicBarrier"><a href="#8-2-CyclicBarrier" class="headerlink" title="8.2.CyclicBarrier"></a><strong>8.2.CyclicBarrier</strong></h3><p><a href="https://imgchr.com/i/sLB7vR"><img src="https://s3.ax1x.com/2021/01/25/sLB7vR.jpg"></a></p><p>åŠ æ³•è®¡ç®—å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* CyclicBarrier åŠ æ³•è®¡æ•°å™¨<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">19</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CyclicbarrierDemo</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>/\*\*<br>\* é›†é½<span class="hljs-number">7</span>é¢—é¾™ç ï¼Œå¬å”¤ç¥é¾™<br>\*/<br><span class="hljs-type">CyclicBarrier</span> <span class="hljs-variable">cyclicBarrier</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CyclicBarrier</span>(<span class="hljs-number">7</span>, () -&gt; &#123;<br>System.out.println(<span class="hljs-string">&quot;å¬å”¤ç¥é¾™æˆåŠŸï¼&quot;</span>);<br>&#125;);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">7</span>; i++) &#123;<br><span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> i;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;æ‹¿åˆ°&quot;</span> + temp + <span class="hljs-string">&quot;é¾™ç &quot;</span>);<br><span class="hljs-keyword">try</span> &#123;<br>cyclicBarrier.await();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">catch</span> (BrokenBarrierException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;).start();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•å‘ç°ï¼Œå½“çº¿ç¨‹é¢„æœŸæ²¡æœ‰è¾¾åˆ°è®¡æ•°å™¨çš„åˆå§‹å€¼æ—¶ï¼Œ<strong>éƒ½ä¼šé˜»å¡</strong>ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œç›´åˆ°æ»¡è¶³æœŸæœ›æ‰ä¼šæ‰§è¡Œæœ€ç»ˆçš„æ–¹æ³•ã€‚</p><h3 id="8-3-Semaphore"><a href="#8-3-Semaphore" class="headerlink" title="8.3.Semaphore"></a><strong>8.3.Semaphore</strong></h3><p>ä¿¡å·é‡</p><p><a href="https://imgchr.com/i/sL6STP"><img src="https://s3.ax1x.com/2021/01/25/sL6STP.jpg"></a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">19</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SemaphoreDemo</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//çº¿ç¨‹æ•°é‡ï¼šåœè½¦ä½ï¼é™æµï¼</span><br><span class="hljs-type">Semaphore</span> <span class="hljs-variable">semaphore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Semaphore</span>(<span class="hljs-number">3</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">6</span>; i++) &#123;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">try</span> &#123;<br>semaphore.acquire(); <span class="hljs-comment">//è·å–</span><br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;æŠ¢åˆ°äº†è½¦ä½&quot;</span>);<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;ç¦»å¼€äº†è½¦ä½&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>semaphore.release(); <span class="hljs-comment">//é‡Šæ”¾</span><br>&#125;<br>&#125;, String.valueOf(i)).start();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p>2æŠ¢åˆ°äº†è½¦ä½<br>3æŠ¢åˆ°äº†è½¦ä½<br>1æŠ¢åˆ°äº†è½¦ä½<br>1ç¦»å¼€äº†è½¦ä½<br>3ç¦»å¼€äº†è½¦ä½<br>4æŠ¢åˆ°äº†è½¦ä½<br>2ç¦»å¼€äº†è½¦ä½<br>6æŠ¢åˆ°äº†è½¦ä½<br>5æŠ¢åˆ°äº†è½¦ä½<br>6ç¦»å¼€äº†è½¦ä½<br>4ç¦»å¼€äº†è½¦ä½<br>5ç¦»å¼€äº†è½¦ä½</p><p>å¯ä»¥çœ‹åˆ°åœ¨åŒä¸€æ—¶é—´ï¼Œåªæœ‰<strong>ä¸‰è¾†è½¦åœç€çš„</strong>ï¼Œä¸Semaphoreåˆå§‹å€¼ç›¸åŒï¼Œç¬¦åˆé¢„æœŸï¼</p><p>semaphore.acquire() è·å¾—ï¼Œå‡è®¾å¦‚æœå·²ç»æ»¡äº†ï¼Œç­‰å¾…ç›´åˆ°è¢«é‡Šæ”¾ä¸ºæ­¢</p><p>semaphore.release() é‡Šæ”¾ï¼Œä¼šå°†å½“å‰çš„ä¿¡å·é‡é‡Šæ”¾+1.ç„¶åå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼</p><p>ä½œç”¨ï¼š<strong>å¤šä¸ªå…±äº«èµ„æºäº’æ–¥çš„ä½¿ç”¨ï¼å¹¶å‘é™æµï¼Œæ§åˆ¶æœ€å¤§çš„çº¿ç¨‹æ•°ï¼</strong></p><h2 id="9-è¯»å†™é”"><a href="#9-è¯»å†™é”" class="headerlink" title="9.è¯»å†™é”"></a>9.è¯»å†™é”</h2><p><a href="https://imgchr.com/i/sLg0Ld"><img src="https://s3.ax1x.com/2021/01/25/sLg0Ld.jpg"></a></p><p>å¯ä»¥çœ‹åˆ°è¯»å†™é”æ˜¯æŠŠ<strong>lockæ›´ç»†ç²’åº¦çš„åˆ†åŒ–</strong>ï¼Œè¯»å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»ï¼Œä½†å†™çš„æ—¶å€™åªèƒ½ä¸€ä¸ªçº¿ç¨‹å»å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* ç‹¬å é”ï¼ˆå†™é”ï¼‰ ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å ç”¨<br>\* å…±äº«é”ï¼ˆè¯»é”ï¼‰ å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å ç”¨<br>\* ReadWriteLock<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">19</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadWriteLockDemo</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">// MyCache myCache = new MyCache();</span><br><span class="hljs-type">MyCacheLock</span> <span class="hljs-variable">myCache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCacheLock</span>();<br><span class="hljs-comment">//æµ‹è¯•å†™</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> i;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>myCache.write(temp + <span class="hljs-string">&quot;&quot;</span>, temp + <span class="hljs-string">&quot;&quot;</span>);<br>&#125;, String.valueOf(i)).start();<br>&#125;<br><span class="hljs-comment">//æµ‹è¯•è¯»å–</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> i;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>myCache.read(temp + <span class="hljs-string">&quot;&quot;</span>);<br>&#125;, String.valueOf(i)).start();<br>&#125;<br>&#125;<br>&#125;<br>/\*\*<br>\* è‡ªå®šä¹‰ç¼“å­˜---ä¸åŠ é”<br>\*/<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCache</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(String key, Object o)</span> &#123;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;å†™å…¥Key&quot;</span> + key);<br>map.put(key, o);<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;å†™å…¥å®Œæˆ&quot;</span> + key);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">read</span><span class="hljs-params">(String key)</span> &#123;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;è¯»å–key&quot;</span> + key);<br>map.get(key);<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;è¯»å–æˆåŠŸ&quot;</span> + key);<br>&#125;<br>&#125;<br>/\*\*<br>\* è‡ªå®šä¹‰ç¼“å­˜--&gt;åŠ å…¥è¯»å†™é” ReadWriteLock æ¯”lock ç²’åº¦æ›´ç»†<br>\*/<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCacheLock</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-keyword">private</span> <span class="hljs-type">ReadWriteLock</span> <span class="hljs-variable">readWriteLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(String key, Object o)</span> &#123;<br>readWriteLock.writeLock().lock();<br><span class="hljs-keyword">try</span> &#123;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;å†™å…¥Key&quot;</span> + key);<br>map.put(key, o);<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;å†™å…¥å®Œæˆ&quot;</span> + key);<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>readWriteLock.writeLock().unlock();<br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">read</span><span class="hljs-params">(String key)</span> &#123;<br>readWriteLock.readLock().lock();<br><span class="hljs-keyword">try</span> &#123;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;è¯»å–key&quot;</span> + key);<br>map.get(key);<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;è¯»å–æˆåŠŸ&quot;</span> + key);<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>readWriteLock.readLock().unlock();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨å†™æµ‹è¯•ç±»çš„æ—¶å€™ï¼Œå†™äº†ä¸¤ä¸ªè‡ªå®šä¹‰ç¼“å­˜ç±»ï¼Œä¸€ä¸ªä¸åŠ é”ï¼Œä¸€ä¸ªåŠ é”</p><p>ä¸åŠ é”çš„ç»“æœå¦‚ä¸‹ï¼š</p><p><a href="https://imgchr.com/i/sLRlU1"><img src="https://s3.ax1x.com/2021/01/25/sLRlU1.jpg"></a></p><p>ä»¥å‘ç°åœ¨çº¿ç¨‹1å†™å…¥key1çš„æ—¶å€™ï¼Œçº¿ç¨‹5ä¹Ÿåœ¨å†™å…¥key5ï¼Œç„¶åçº¿ç¨‹4ç›´æ¥å°±æŠŠkey4å†™å…¥å®Œæˆäº†ï¼Œè¿™å¾ˆæ˜æ˜¾ä¸ç¬¦åˆå¤šçº¿ç¨‹çš„è¦æ±‚ï¼Œå¾ˆå®¹æ˜“å‡ºç°çº¿ç¨‹ä¸å®‰å…¨ï¼ˆkey1è¿˜æ²¡å†™å…¥å®Œæˆï¼Œåé¢æœ‰æ’é˜Ÿçº¿ç¨‹æ‰§è¡Œå†™å…¥key1ï¼Œç›´æ¥å°±æŠŠkey1çš„å€¼è¦†ç›–äº†ï¼‰ã€‚</p><p>åŠ å¦‚è¯»å†™é”çš„ç»“æœï¼š</p><p><a href="https://imgchr.com/i/sLWFqH"><img src="https://s3.ax1x.com/2021/01/25/sLWFqH.jpg"></a></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå†™å…¥æ˜¯æ—¶å€™åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå¿…é¡»ç­‰è¯¥çº¿ç¨‹å†™å…¥å®Œæ¯•åï¼Œå…¶å®ƒçº¿ç¨‹æ‰èƒ½ç»§ç»­å†™å…¥ï¼Œä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼</p><h2 id="10-é˜»å¡é˜Ÿåˆ—"><a href="#10-é˜»å¡é˜Ÿåˆ—" class="headerlink" title="10.é˜»å¡é˜Ÿåˆ—"></a>10.é˜»å¡é˜Ÿåˆ—</h2><p><a href="https://imgchr.com/i/sLfFpV"><img src="https://s3.ax1x.com/2021/01/25/sLfFpV.png"></a></p><p><a href="https://imgchr.com/i/sLfMfx"><img src="https://s3.ax1x.com/2021/01/25/sLfMfx.jpg"></a></p><p><a href="https://imgchr.com/i/sLhvIs"><img src="https://s3.ax1x.com/2021/01/25/sLhvIs.jpg"></a></p><p>é˜»å¡é˜Ÿåˆ—çš„ä½¿ç”¨åœºæ™¯ï¼šå¹¶å‘å¤„ç†ï¼Œçº¿ç¨‹æ± </p><p>å­¦ä¼šä½¿ç”¨é˜Ÿåˆ—çš„å››ç»„API</p><table><thead><tr><th>æ–¹æ³•</th><th>æŠ›å‡ºå¼‚å¸¸</th><th>æœ‰è¿”å›å€¼ï¼Œä¸æŠ›å‡ºå¼‚å¸¸</th><th>é˜»å¡ç­‰å¾…</th><th>ç­‰å¾…è¶…æ—¶</th></tr></thead><tbody><tr><td>æ·»åŠ </td><td>add</td><td>offer</td><td>put</td><td>offer</td></tr><tr><td>ç§»é™¤</td><td>remove</td><td>poll</td><td>take</td><td>poll</td></tr><tr><td>æ£€æŸ¥é˜Ÿé¦–å…ƒç´ </td><td>element</td><td>peek</td><td></td><td></td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* ArrayBlockingQueueå››ç»„APIçš„ä½¿ç”¨<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">19</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockingQueueDemo</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>test4();<br>&#125;<br>/\*\*<br>\* æŠ›å‡ºå¼‚å¸¸<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">ArrayBlockingQueue</span> <span class="hljs-variable">blockingQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>);<br>System.out.println(blockingQueue.add(<span class="hljs-string">&quot;a&quot;</span>));<br>System.out.println(blockingQueue.add(<span class="hljs-string">&quot;b&quot;</span>));<br>System.out.println(blockingQueue.add(<span class="hljs-string">&quot;c&quot;</span>));<br><span class="hljs-comment">//java.lang.IllegalStateException: Queue full</span><br><span class="hljs-comment">//System.out.println(blockingQueue.add(&quot;d&quot;));</span><br>System.out.println(<span class="hljs-string">&quot;----------------------&quot;</span>);<br>System.out.println(blockingQueue.remove());<br>System.out.println(blockingQueue.remove());<br>System.out.println(blockingQueue.remove());<br><span class="hljs-comment">//java.util.NoSuchElementException</span><br><span class="hljs-comment">// System.out.println(blockingQueue.remove());</span><br>&#125;<br>/\*\*<br>\* æœ‰è¿”å›å€¼ï¼Œä¸æŠ›å‡ºå¼‚å¸¸<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">ArrayBlockingQueue</span> <span class="hljs-variable">blockingQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>);<br>System.out.println(blockingQueue.offer(<span class="hljs-string">&quot;a&quot;</span>));<br>System.out.println(blockingQueue.offer(<span class="hljs-string">&quot;b&quot;</span>));<br>System.out.println(blockingQueue.offer(<span class="hljs-string">&quot;c&quot;</span>));<br><span class="hljs-comment">//è¶…å‡ºé˜Ÿåˆ—å®¹é‡ è¿”å›false</span><br><span class="hljs-comment">//System.out.println(blockingQueue.offer(&quot;c&quot;));</span><br>System.out.println(<span class="hljs-string">&quot;--------------------------&quot;</span>);<br>System.out.println(blockingQueue.poll());<br>System.out.println(blockingQueue.poll());<br>System.out.println(blockingQueue.poll());<br><span class="hljs-comment">//é˜Ÿåˆ—ä¸ºç©º ç»§ç»­poll è¿”å›null</span><br>System.out.println(blockingQueue.poll());<br>&#125;<br>/\*\*<br>\* é˜»å¡ç­‰å¾…<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><span class="hljs-type">ArrayBlockingQueue</span> <span class="hljs-variable">blockingQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>);<br>blockingQueue.put(<span class="hljs-string">&quot;a&quot;</span>);<br>blockingQueue.put(<span class="hljs-string">&quot;b&quot;</span>);<br>blockingQueue.put(<span class="hljs-string">&quot;c&quot;</span>);<br><span class="hljs-comment">//è¶…å‡ºé˜Ÿåˆ—å®¹é‡ é˜»å¡ing</span><br><span class="hljs-comment">//blockingQueue.put(&quot;a&quot;);</span><br>System.out.println(<span class="hljs-string">&quot;---------------&quot;</span>);<br>System.out.println(blockingQueue.take());<br>System.out.println(blockingQueue.take());<br>System.out.println(blockingQueue.take());<br><span class="hljs-comment">//é˜Ÿåˆ—å·²ç©ºï¼Œç»§ç»­å‡ºé˜Ÿï¼Œé˜»å¡ing</span><br><span class="hljs-comment">//System.out.println(blockingQueue.take());</span><br>&#125;<br>/\*\*<br>\* ç­‰å¾…ï¼Œé˜»å¡ï¼ˆè¶…æ—¶ç­‰å¾…ï¼‰<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test4</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><span class="hljs-type">ArrayBlockingQueue</span> <span class="hljs-variable">blockingQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>);<br>System.out.println(blockingQueue.offer(<span class="hljs-string">&quot;a&quot;</span>));<br>System.out.println(blockingQueue.offer(<span class="hljs-string">&quot;b&quot;</span>));<br>System.out.println(blockingQueue.offer(<span class="hljs-string">&quot;c&quot;</span>));<br><span class="hljs-comment">//é˜Ÿåˆ—å·²æ»¡ï¼Œè‹¥ç»§ç»­å…¥é˜Ÿï¼Œåˆ™è§¦å‘è¶…æ—¶ç­‰å¾…ï¼Œ2ç§’åç»“æŸç¨‹åº</span><br><span class="hljs-comment">// blockingQueue.offer(&quot;d&quot;,2, TimeUnit.SECONDS);</span><br>System.out.println(<span class="hljs-string">&quot;----------------------&quot;</span>);<br>System.out.println(blockingQueue.poll());<br>System.out.println(blockingQueue.poll());<br>System.out.println(blockingQueue.poll());<br><span class="hljs-comment">//é˜Ÿåˆ—å·²ç©ºï¼Œè‹¥ç»§ç»­å‡ºé˜Ÿï¼Œåˆ™è§¦å‘è¶…æ—¶ç­‰å¾…ï¼Œ3ç§’åç»“æŸç¨‹åº</span><br><span class="hljs-comment">//System.out.println(blockingQueue.poll(3,TimeUnit.SECONDS));</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ä¸ªå¾ˆç®€å•ï¼Œå’Œæ•°æ®ç»“æ„çš„é˜Ÿåˆ—å¤§åŒå°å¼‚ã€‚</p><blockquote><p>SynchronousQueue åŒæ­¥é˜Ÿåˆ—</p></blockquote><p>æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ç›¸åº”çš„åˆ é™¤æ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚ åŒæ­¥é˜Ÿåˆ—æ²¡æœ‰ä»»ä½•å†…éƒ¨å®¹é‡ï¼Œç”šè‡³æ²¡æœ‰ä¸€ä¸ªå®¹é‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* åŒæ­¥é˜Ÿåˆ—<br>\* å’Œå…¶ä»–çš„BlockingQueueä¸ä¸€æ ·ï¼ŒSynchronousQueueä¸å­˜å‚¨å…ƒç´ <br>\* putä¸€ä¸ªå…ƒç´ ï¼Œå¿…é¡»ä»é‡Œé¢å–å‡ºæ¥ï¼Œå¦åˆ™ä¸èƒ½put<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">19</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronousQueueDemo</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>BlockingQueue&lt;String&gt; blockingQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;&gt;();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">try</span> &#123;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;put 1&quot;</span>);<br>blockingQueue.put(<span class="hljs-string">&quot;1&quot;</span>);<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;put 2&quot;</span>);<br>blockingQueue.put(<span class="hljs-string">&quot;2&quot;</span>);<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;put 3&quot;</span>);<br>blockingQueue.put(<span class="hljs-string">&quot;3&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;, <span class="hljs-string">&quot;T1&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">try</span> &#123;<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;=&gt;&quot;</span> + blockingQueue.take());<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;=&gt;&quot;</span> + blockingQueue.take());<br>TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;=&gt;&quot;</span> + blockingQueue.take());<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;, <span class="hljs-string">&quot;T2&quot;</span>).start();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆä¸€ï¼‰</title>
    <link href="/2021/01/24/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <url>/2021/01/24/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆä¸€ï¼‰"><a href="#JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆä¸€ï¼‰" class="headerlink" title="JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆä¸€ï¼‰"></a>JUCå¹¶å‘ç¼–ç¨‹ç³»åˆ—ï¼ˆä¸€ï¼‰</h1><p><strong>ä¼šå†™å››ç¯‡å¤šçº¿ç¨‹å’ŒJUCç›¸å…³çš„çŸ¥è¯†ï¼Œå¹²æ´»æ»¡æ»¡ï¼Œæ‰‹æŠŠæ‰‹è°ƒè¯•ï¼Œä¿å§†çº§å¾…é‡ï¼</strong></p><h2 id="1-ä»€ä¹ˆæ˜¯JUCï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯JUCï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯JUCï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯JUCï¼Ÿ</h2><p>æœ‰ç€å¤šçº¿ç¨‹çš„åŸºç¡€ï¼Œå°±è¿›ä¸€æ­¥å­¦ä¹ Javaå…³äºå¹¶å‘æ“ä½œå°è£…çš„å·¥å…·ç±»ï¼ŒæŸ¥çœ‹<strong>JDK1.8</strong>å¸®åŠ©æ–‡æ¡£å¯çŸ¥ï¼š</p><p><a href="https://imgchr.com/i/sHsUQ1"><img src="https://s3.ax1x.com/2021/01/24/sHsUQ1.jpg"></a></p><h2 id="2-å›é¡¾å¤šçº¿ç¨‹çŸ¥è¯†"><a href="#2-å›é¡¾å¤šçº¿ç¨‹çŸ¥è¯†" class="headerlink" title="2.å›é¡¾å¤šçº¿ç¨‹çŸ¥è¯†"></a>2.å›é¡¾å¤šçº¿ç¨‹çŸ¥è¯†</h2><p><strong>åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•</strong></p><p><strong>1.ç»§æ‰¿Threadç±»ï¼Œé‡å†™run()æ–¹æ³•ï¼Œè°ƒç”¨start()</strong></p><p>é€šè¿‡ç»§æ‰¿Threadå®ç°çš„çº¿ç¨‹ç±»ï¼Œå¤šä¸ªçº¿ç¨‹é—´æ— æ³•å…±äº«çº¿ç¨‹ç±»çš„å®ä¾‹å˜é‡ã€‚ï¼ˆéœ€è¦åˆ›å»ºä¸åŒThreadå¯¹è±¡ï¼Œè‡ªç„¶ä¸å…±äº«ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\*åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•ï¼š<span class="hljs-number">1.</span>ç»§æ‰¿Threadç±»ï¼Œé‡å†™run()æ–¹æ³•ï¼Œè°ƒç”¨start()<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">23</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo01</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span>&#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">//runæ–¹æ³• çº¿ç¨‹ä½“</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) &#123;<br>System.out.println(<span class="hljs-string">&quot;æˆ‘åœ¨å†™åšå®¢-----&gt;&quot;</span>+i);<br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//main ä¸»çº¿ç¨‹</span><br><span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œè°ƒç”¨start(),å¼€å¯çº¿ç¨‹</span><br><span class="hljs-type">Demo01</span> <span class="hljs-variable">demo01</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo01</span>();<br><span class="hljs-comment">//demo01.run(); //åªæœ‰ä¸»çº¿ç¨‹ä¸€æ¡æ‰§è¡Œè·¯å¾„</span><br>demo01.start(); <span class="hljs-comment">//å¤šçº¿ç¨‹ï¼Œä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹äº¤æ›¿æ‰§è¡Œ</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) &#123;<br>System.out.println(<span class="hljs-string">&quot;æˆ‘åœ¨å¤ä¹ å¤šçº¿ç¨‹---&gt;&quot;</span>+i);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://imgchr.com/i/sHyJ78"><img src="https://s3.ax1x.com/2021/01/24/sHyJ78.jpg"></a></p><p><strong>2.å®ç°runnableæ¥å£ï¼Œé‡å†™runæ–¹æ³•ï¼Œæ‰§è¡Œçº¿ç¨‹éœ€è¦ä¸¢å…¥runnableæ¥å£å®ç°ç±»ï¼Œè°ƒç”¨startæ–¹æ³•</strong></p><p>æ­¤Threadå¯¹è±¡æ‰æ˜¯çœŸæ­£çš„çº¿ç¨‹å¯¹è±¡ã€‚é€šè¿‡å®ç°Runnableæ¥å£çš„çº¿ç¨‹ç±»ï¼Œæ˜¯äº’ç›¸å…±äº«èµ„æºçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•<span class="hljs-number">2</span>ï¼šå®ç°runnableæ¥å£ï¼Œé‡å†™runæ–¹æ³•ï¼Œæ‰§è¡Œçº¿ç¨‹éœ€è¦ä¸¢å…¥runnableæ¥å£å®ç°ç±»ï¼Œè°ƒç”¨startæ–¹æ³•<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">23</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo02</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) &#123;<br>System.out.println(<span class="hljs-string">&quot;æˆ‘è¿˜æ˜¯åœ¨å†™ä»£ç ----&gt;&quot;</span>+i);<br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//åˆ›å»ºRunnableæ¥å£å®ç°ç±»çš„å¯¹è±¡</span><br><span class="hljs-type">Demo02</span> <span class="hljs-variable">demo02</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo02</span>();<br><span class="hljs-comment">//åˆ›å»ºçº¿ç¨‹å¯¹è±¡ï¼Œé€šè¿‡çº¿ç¨‹å¯¹è±¡æ¥å¼€å¯æˆ‘ä»¬çš„çº¿ç¨‹ï¼Œ----&gt;ä»£ç†</span><br><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(demo02);<br>thread.start();<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) &#123;<br>System.out.println(<span class="hljs-string">&quot;æˆ‘è¿˜æ˜¯åœ¨å†™åšå®¢---&gt;&quot;</span>+i);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>3.åˆ›å»ºCallableæ¥å£çš„å®ç°ç±»ï¼Œå¹¶å®ç°call()æ–¹æ³•ï¼Œè¯¥call()æ–¹æ³•å°†ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ï¼Œå¹¶ä¸”æœ‰è¿”å›å€¼ã€‚</strong></p><p>Callableä¸Runnableçš„åŠŸèƒ½å¤§è‡´ç›¸ä¼¼ï¼ŒCallableä¸­æœ‰ä¸€ä¸ªcall()å‡½æ•°ï¼Œ<strong>ä½†æ˜¯call()å‡½æ•°æœ‰è¿”å›å€¼</strong>ï¼Œè€ŒRunnableçš„run()å‡½æ•°ä¸èƒ½å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç¨‹åºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•<span class="hljs-number">3</span>ï¼šåˆ›å»ºCallableæ¥å£çš„å®ç°ç±»ï¼Œå¹¶å®ç°call()æ–¹æ³•ï¼Œè¯¥call()æ–¹æ³•å°†ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ï¼Œå¹¶ä¸”æœ‰è¿”å›å€¼ã€‚<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">18</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallableTets</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br><span class="hljs-comment">// new Thread().start(); //æ€ä¹ˆå¯åŠ¨Callable</span><br><span class="hljs-type">MyThread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>();<br><span class="hljs-type">FutureTask</span> <span class="hljs-variable">futureTask</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>(thread);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) &#123;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(futureTask,String.valueOf(i)).start();<br>System.out.println(Thread.currentThread().getName()+<span class="hljs-string">&quot;----&gt;è¿›æ¥äº†&quot;</span>);<br>&#125;<br><span class="hljs-type">Integer</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> (Integer) futureTask.get(); <span class="hljs-comment">//get å¯èƒ½ä¼šäº§ç”Ÿé˜»å¡ æ”¾åˆ°æœ€å</span><br><span class="hljs-comment">// æˆ–è€…ä½¿ç”¨å¼‚æ­¥</span><br>System.out.println(o);<br>&#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;Integer&gt; &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>System.out.println(<span class="hljs-string">&quot;call()&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">1024</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼çš„å¯¹æ¯”ï¼š</strong></p><p><a href="https://imgchr.com/i/sHyInx"><img src="https://s3.ax1x.com/2021/01/24/sHyInx.jpg"></a></p><p>1ã€é‡‡ç”¨å®ç°Runnableã€Callableæ¥å£çš„æ–¹å¼åˆ›å»ºå¤šçº¿ç¨‹æ—¶ï¼Œ</p><p>ä¼˜åŠ¿æ˜¯ï¼š</p><p>çº¿ç¨‹ç±»åªæ˜¯å®ç°äº†Runnableæ¥å£æˆ–Callableæ¥å£ï¼Œè¿˜å¯ä»¥ç»§æ‰¿å…¶ä»–ç±»ã€‚</p><p>åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªtargetå¯¹è±¡ï¼Œæ‰€ä»¥éå¸¸é€‚åˆå¤šä¸ªç›¸åŒçº¿ç¨‹æ¥å¤„ç†åŒä¸€ä»½èµ„æºçš„æƒ…å†µï¼Œä»è€Œå¯ä»¥å°†CPUã€ä»£ç å’Œæ•°æ®åˆ†å¼€ï¼Œå½¢æˆæ¸…æ™°çš„æ¨¡å‹ï¼Œè¾ƒå¥½åœ°ä½“ç°äº†é¢å‘å¯¹è±¡çš„æ€æƒ³ã€‚</p><p>åŠ£åŠ¿æ˜¯ï¼š</p><p>ç¼–ç¨‹ç¨å¾®å¤æ‚ï¼Œå¦‚æœè¦è®¿é—®å½“å‰çº¿ç¨‹ï¼Œåˆ™å¿…é¡»ä½¿ç”¨Thread.currentThread()æ–¹æ³•ã€‚</p><p>2ã€ä½¿ç”¨ç»§æ‰¿Threadç±»çš„æ–¹å¼åˆ›å»ºå¤šçº¿ç¨‹æ—¶ï¼Œ</p><p>ä¼˜åŠ¿æ˜¯ï¼š</p><p>ç¼–å†™ç®€å•ï¼Œå¦‚æœéœ€è¦è®¿é—®å½“å‰çº¿ç¨‹ï¼Œåˆ™æ— éœ€ä½¿ç”¨Thread.currentThread()æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨thiså³å¯è·å¾—å½“å‰çº¿ç¨‹ã€‚</p><p>åŠ£åŠ¿æ˜¯ï¼š</p><p>çº¿ç¨‹ç±»å·²ç»ç»§æ‰¿äº†Threadç±»ï¼Œæ‰€ä»¥ä¸èƒ½å†ç»§æ‰¿å…¶ä»–çˆ¶ç±»ã€‚</p><p>3ã€Runnableå’ŒCallableçš„åŒºåˆ«</p><p>(1) Callableè§„å®šï¼ˆé‡å†™ï¼‰çš„æ–¹æ³•æ˜¯call()ï¼ŒRunnableè§„å®šï¼ˆé‡å†™ï¼‰çš„æ–¹æ³•æ˜¯run()ã€‚</p><p>(2) Callableçš„ä»»åŠ¡æ‰§è¡Œåå¯è¿”å›å€¼ï¼Œè€ŒRunnableçš„ä»»åŠ¡æ˜¯ä¸èƒ½è¿”å›å€¼çš„ã€‚</p><p>(3) callæ–¹æ³•å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œrunæ–¹æ³•ä¸å¯ä»¥ã€‚</p><p>(4) è¿è¡ŒCallableä»»åŠ¡å¯ä»¥æ‹¿åˆ°ä¸€ä¸ªFutureå¯¹è±¡ï¼Œè¡¨ç¤ºå¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚å®ƒæä¾›äº†æ£€æŸ¥è®¡ç®—æ˜¯å¦å®Œæˆçš„æ–¹æ³•ï¼Œä»¥ç­‰å¾…è®¡ç®—çš„å®Œæˆï¼Œå¹¶æ£€ç´¢è®¡ç®—çš„ç»“æœã€‚é€šè¿‡Futureå¯¹è±¡å¯ä»¥äº†è§£ä»»åŠ¡æ‰§è¡Œæƒ…å†µï¼Œå¯å–æ¶ˆä»»åŠ¡çš„æ‰§è¡Œï¼Œè¿˜å¯è·å–æ‰§è¡Œç»“æœã€‚</p><h2 id="3-çº¿ç¨‹å’Œè¿›ç¨‹"><a href="#3-çº¿ç¨‹å’Œè¿›ç¨‹" class="headerlink" title="3.çº¿ç¨‹å’Œè¿›ç¨‹"></a><strong>3.çº¿ç¨‹å’Œè¿›ç¨‹</strong></h2><ul><li>**è¿›ç¨‹ï¼š**è¿›ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¸­å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä½œä¸ºèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚è¡¨ç¤ºè¿è¡Œä¸­çš„ç¨‹åºã€‚</li><li>**çº¿ç¨‹ï¼š**çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªå®ä¾‹ï¼Œä½œä¸ºç³»ç»Ÿè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ã€‚æ˜¯è¿›ç¨‹ä¸­çš„ä¸€æ®µåºåˆ—ï¼Œèƒ½å¤Ÿå®Œæˆè¿›ç¨‹ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ã€‚</li></ul><p><strong>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼š</strong></p><p>ï¼ˆ1ï¼‰åŒä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘åŒ…å«ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½å­˜åœ¨äºä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚</p><p>ï¼ˆ2ï¼‰åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„æ‰€æœ‰çº¿ç¨‹èƒ½å¤Ÿå…±äº«è¯¥è¿›ç¨‹ä¸‹çš„èµ„æºã€‚ï¼ˆç³»ç»Ÿè¿è¡Œæ—¶ä¼šä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸åŒçš„å†…å­˜åŒºåŸŸï¼Œä½†ä¸ä¼šä¸ºçº¿ç¨‹åˆ†é…å†…å­˜ã€‚çº¿ç¨‹åªèƒ½å…±äº«å®ƒæ‰€å±è¿›ç¨‹çš„èµ„æºã€‚ï¼‰</p><p>ï¼ˆ3ï¼‰è¿›ç¨‹ç»“æŸåï¼Œè¯¥è¿›ç¨‹ä¸‹çš„æ‰€æœ‰çº¿ç¨‹å°†é”€æ¯ï¼Œè€Œä¸€ä¸ªçº¿ç¨‹çš„ç»“æŸä¸ä¼šå½±å“åŒä¸€è¿›ç¨‹ä¸‹çš„å…¶ä»–çº¿ç¨‹ã€‚</p><p>ï¼ˆ4ï¼‰çº¿ç¨‹æ˜¯è½»é‡çº§çš„è¿›ç¨‹ï¼Œå®ƒçš„åˆ›å»ºå’Œé”€æ¯æ‰€éœ€è¦çš„æ—¶é—´æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œæ‰€æœ‰æ“ä½œç³»ç»Ÿçš„æ‰§è¡ŒåŠŸèƒ½éƒ½æ˜¯é€šè¿‡åˆ›å»ºçº¿ç¨‹å»å®Œæˆçš„ã€‚</p><p>ï¼ˆ5ï¼‰çº¿ç¨‹åœ¨æ‰§è¡Œæ—¶æ˜¯åŒæ­¥å’Œäº’æ–¥çš„ï¼Œå› ä¸ºä»–ä»¬å…±äº«åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„èµ„æºã€‚</p><p>ï¼ˆ6ï¼‰åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æ˜¯æ‹¥æœ‰ç³»ç»Ÿèµ„æºçš„ç‹¬ç«‹å•å…ƒï¼Œå®ƒå¯ä»¥æ‹¥æœ‰è‡ªå·±çš„èµ„æºã€‚ä¸€èˆ¬è€Œè¨€ï¼Œçº¿ç¨‹ä¸èƒ½æ‹¥æœ‰è‡ªå·±çš„èµ„æºï¼Œä½†æ˜¯å®ƒèƒ½å¤Ÿè®¿é—®å…¶éš¶å±è¿›ç¨‹çš„èµ„æºã€‚</p><p><strong>ä¸¾ä¸ªæ —å­ï¼š</strong></p><p>**è¿›ç¨‹ï¼š**ä¸€ä¸ªç¨‹åºï¼ŒQQï¼ŒQQæ¸¸æˆï¼Œlolç­‰ç¨‹åºçš„é›†åˆ</p><p>ä¸€ä¸ªè¿›ç¨‹å¾€å¾€å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œè‡³å°‘åŒ…å«ä¸€ä¸ªï¼</p><p>Javaé»˜è®¤æœ‰å‡ ä¸ªçº¿ç¨‹ï¼Ÿ2ä¸ª Mainã€GC</p><p>çº¿ç¨‹ï¼šQQå‘ä¿¡æ¯ï¼Œä¼ æ–‡ä»¶</p><p>å¯¹äºJavaè€Œè¨€ï¼šThreadã€Runnableã€Callable</p><p>Javaæ˜¯ä¸èƒ½æ“ä½œçº¿ç¨‹çš„ï¼Œåº•å±‚è°ƒç”¨C++</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> &#123;<br>/\*\*<br>\* This method is not invoked <span class="hljs-keyword">for</span> the main method thread or <span class="hljs-string">&quot;system&quot;</span><br>\* group threads created/set up by the VM. Any <span class="hljs-keyword">new</span> <span class="hljs-title class_">functionality</span> added<br>\* to <span class="hljs-built_in">this</span> method in the future may have to also be added to the VM.<br>\*<br>\* A zero status value corresponds to state <span class="hljs-string">&quot;NEW&quot;</span>.<br>\*/<br><span class="hljs-keyword">if</span> (threadStatus != <span class="hljs-number">0</span>)<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalThreadStateException</span>();<br>/\* Notify the group that <span class="hljs-built_in">this</span> thread is about to be started<br>\* so that it can be added to the group<span class="hljs-string">&#x27;s list of threads</span><br><span class="hljs-string">\* and the group&#x27;</span>s unstarted count can be decremented. \*/<br>group.add(<span class="hljs-built_in">this</span>);<br><span class="hljs-type">boolean</span> <span class="hljs-variable">started</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">try</span> &#123;<br>start0();<br>started = <span class="hljs-literal">true</span>;<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">if</span> (!started) &#123;<br>group.threadStartFailed(<span class="hljs-built_in">this</span>);<br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> (Throwable ignore) &#123;<br>/\* <span class="hljs-keyword">do</span> nothing. If start0 threw a Throwable then<br>it will be passed up the call stack \*/<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start0</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><blockquote><p>å¹¶è¡Œå’Œå¹¶å‘</p></blockquote><p>å¹¶å‘ç¼–ç¨‹ï¼šå¹¶å‘ã€å¹¶è¡Œ</p><p>å¹¶å‘ï¼ˆå¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªèµ„æºï¼‰</p><p>è€å¸ˆè®©ä¸¤ä¸ªåŒå­¦å»åŠå…¬å®¤è°ˆè¯ã€‚å¦‚æœè¿™ä¸¤åŒå­¦(è¿›ç¨‹)æ˜¯å¹¶åˆ—è·¨è¿‡åŠå…¬å®¤é—¨(CPU)çš„ï¼Œé‚£ä¹ˆå°±æ˜¯å¹¶è¡Œã€‚å¦‚æœåŒå­¦Aå…ˆè¿›åŒå­¦Båè¿›å…¥(æˆ–è€…å…ˆBåA)ï¼Œæˆ–è€…ä¸¤äººå¹¶åˆ—åŒæ—¶è¿›å…¥ï¼Œä½†æ˜¯åœ¨åŠå…¬å®¤å¤–çš„è·¯äººç”²(ç”¨æˆ·)çœ‹æ¥ï¼ŒåŒå­¦Aå’ŒåŒå­¦BåŒæ—¶éƒ½åœ¨åŠå…¬å®¤å†…ï¼Œè¿™æ˜¯å¹¶å‘ã€‚</p><p><a href="https://imgchr.com/i/s7cN3d"><img src="https://s3.ax1x.com/2021/01/23/s7cN3d.jpg"></a></p><p>å¦‚æœä¸¾ä¾‹è¦ç²¾ç¡®ä¸€ç‚¹ï¼Œé‚£ä¹ˆå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼šè¿›åŠå…¬å®¤æœ‰ä¸¤ä¸ªé—¨(ä¸¤CPU)ï¼Œå¦‚æœä¸¤åŒå­¦åˆ†åˆ«ä»ä¸åŒçš„é—¨è¿›å…¥ï¼Œä¸ç®¡å…ˆåæ€§ï¼Œä¸¤è€…äº’ç›¸ç‹¬ç«‹ï¼Œé‚£ä¹ˆæ˜¯å¹¶è¡Œï¼›å¦‚æœä¸¤åŒå­¦ä¸ç®¡ä»¥ä»€ä¹ˆæ–¹å¼è¿›å…¥ï¼Œåœ¨è·¯äººç”²çœ‹æ¥ï¼Œä»–ä¸¤åŒæ—¶éƒ½åœ¨åŠå…¬å®¤å†…ï¼Œå°±æ˜¯å¹¶å‘ã€‚</p><p><a href="https://imgchr.com/i/s7cUgA"><img src="https://s3.ax1x.com/2021/01/23/s7cUgA.jpg"></a></p><p><a href="https://www.cnblogs.com/f-ck-need-u/p/11161481.html">è¿™ç¯‡åšå®¢è®²çš„å¾ˆæ¸…æ¥š</a></p><p>å¹¶å‘ç¼–ç¨‹çš„æœ¬è´¨ï¼š<strong>å……åˆ†åˆ©ç”¨CPUèµ„æº</strong></p><blockquote><p>çº¿ç¨‹çš„çŠ¶æ€</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">State</span> &#123;<br>/\*\*<br>\* Thread state <span class="hljs-keyword">for</span> a thread which has not yet started.<br>\*/<br>NEW,<br><span class="hljs-comment">//çœ‹çš„å‡ºæ¥ï¼Œè¿™æ˜¯å±äºä¸€ä¸ªå·²ç»åˆ›å»ºçš„çº¿ç¨‹ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨startæ–¹æ³•å¯åŠ¨çš„çº¿ç¨‹æ‰€å¤„çš„çŠ¶æ€ã€‚</span><br>/\*\*<br>\* Thread state <span class="hljs-keyword">for</span> a runnable thread. A thread in the runnable<br>\* state is executing in the Java virtual machine but it may<br>\* be waiting <span class="hljs-keyword">for</span> other resources from the operating system<br>\* such as processor.<br>\*/<br>RUNNABLE,<br><span class="hljs-comment">//æ­£å¦‚JDKä¸­ä»‹ç»ï¼Œè¯¥çŠ¶æ€åŒ…å«ä¸¤ç§å¯èƒ½ã€‚æœ‰å¯èƒ½æ­£åœ¨è¿è¡Œï¼Œæˆ–è€…æ­£åœ¨ç­‰å¾…CPUèµ„æºã€‚æ€»ä½“ä¸Šå°±æ˜¯å½“æˆ‘ä»¬åˆ›å»ºçº¿ç¨‹å¹¶ä¸”å¯åŠ¨ä¹‹åï¼Œå°±å±äºRunnableçŠ¶æ€ã€‚</span><br>/\*\*<br>\* Thread state <span class="hljs-keyword">for</span> a thread blocked waiting <span class="hljs-keyword">for</span> a monitor lock.<br>\* A thread in the blocked state is waiting <span class="hljs-keyword">for</span> a monitor lock<br>\* to enter a <span class="hljs-keyword">synchronized</span> block/method or<br>\* reenter a <span class="hljs-keyword">synchronized</span> block/method after calling<br>\* &#123;<span class="hljs-meta">@link</span> Object#wait() Object.wait&#125;.<br>\*/<br>BLOCKED,<br><span class="hljs-comment">//é˜»å¡çŠ¶æ€ï¼Œå½“çº¿ç¨‹å‡†å¤‡è¿›å…¥synchronizedåŒæ­¥å—æˆ–åŒæ­¥æ–¹æ³•çš„æ—¶å€™ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªç›‘è§†å™¨é”è€Œè¿›è¡Œçš„ç­‰å¾…ï¼Œä¼šä½¿çº¿ç¨‹è¿›å…¥BLOCKEDçŠ¶æ€ã€‚</span><br>/\*\*<br>\* Thread state <span class="hljs-keyword">for</span> a waiting thread.<br>\* A thread is in the waiting state due to calling one of the<br>\* following methods:<br>\* &lt;ul&gt;<br>\* &lt;li&gt;&#123;<span class="hljs-meta">@link</span> Object#wait() Object.wait&#125; with no timeout&lt;/li&gt;<br>\* &lt;li&gt;&#123;<span class="hljs-meta">@link</span> #join() Thread.join&#125; with no timeout&lt;/li&gt;<br>\* &lt;li&gt;&#123;<span class="hljs-meta">@link</span> LockSupport#park() LockSupport.park&#125;&lt;/li&gt;<br>\* &lt;/ul&gt;<br>\*<br>\* &lt;p&gt;A thread in the waiting state is waiting <span class="hljs-keyword">for</span> another thread to<br>\* perform a particular action.<br>\*<br>\* For example, a thread that has called &lt;tt&gt;Object.wait()&lt;/tt&gt;<br>\* on an object is waiting <span class="hljs-keyword">for</span> another thread to call<br>\* &lt;tt&gt;Object.notify()&lt;/tt&gt; or &lt;tt&gt;Object.notifyAll()&lt;/tt&gt; on<br>\* that object. A thread that has called &lt;tt&gt;Thread.join()&lt;/tt&gt;<br>\* is waiting <span class="hljs-keyword">for</span> a specified thread to terminate.<br>\*/<br>WAITING,<br><span class="hljs-comment">//è¯¥çŠ¶æ€çš„å‡ºç°æ˜¯å› ä¸ºè°ƒç”¨äº†Object.waitï¼ˆï¼‰æˆ–è€…Thread.joinï¼ˆï¼‰æˆ–è€…LockSupport.parkï¼ˆï¼‰ã€‚å¤„äºè¯¥çŠ¶æ€ä¸‹çš„çº¿ç¨‹åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ æ‰§è¡Œä¸€äº›å…¶ä½™actionæ¥å°†å…¶å”¤é†’ã€‚</span><br>/\*\*<br>\* Thread state <span class="hljs-keyword">for</span> a waiting thread with a specified waiting time.<br>\* A thread is in the timed waiting state due to calling one of<br>\* the following methods with a specified positive waiting time:<br>\* &lt;ul&gt;<br>\* &lt;li&gt;&#123;<span class="hljs-meta">@link</span> #sleep Thread.sleep&#125;&lt;/li&gt;<br>\* &lt;li&gt;&#123;<span class="hljs-meta">@link</span> Object#wait(<span class="hljs-type">long</span>) Object.wait&#125; with timeout&lt;/li&gt;<br>\* &lt;li&gt;&#123;<span class="hljs-meta">@link</span> #join(<span class="hljs-type">long</span>) Thread.join&#125; with timeout&lt;/li&gt;<br>\* &lt;li&gt;&#123;<span class="hljs-meta">@link</span> LockSupport#parkNanos LockSupport.parkNanos&#125;&lt;/li&gt;<br>\* &lt;li&gt;&#123;<span class="hljs-meta">@link</span> LockSupport#parkUntil LockSupport.parkUntil&#125;&lt;/li&gt;<br>\* &lt;/ul&gt;<br>\*/<br>TIMED\_WAITING,<br><span class="hljs-comment">//è¯¥çŠ¶æ€å’Œä¸Šä¸€ä¸ªçŠ¶æ€å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œæ˜¯ä¸è¿‡å…¶ç­‰å¾…çš„æ—¶é—´æ˜¯æ˜ç¡®çš„ã€‚</span><br>/\*\*<br>\* Thread state <span class="hljs-keyword">for</span> a terminated thread.<br>\* The thread has completed execution.<br>\*/<br>TERMINATED;<br><span class="hljs-comment">// æ¶ˆäº¡çŠ¶æ€æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œé‚£å°±æ˜¯çº¿ç¨‹æ‰§è¡Œç»“æŸäº†ï¼Œrunæ–¹æ³•æ‰§è¡Œç»“æŸè¡¨ç¤ºçº¿ç¨‹å¤„äºæ¶ˆäº¡çŠ¶æ€äº†ã€‚</span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p><strong>å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­å¸¸ç”¨çš„å‡½æ•°æ¯”è¾ƒ</strong></p></blockquote><p><strong>sleep å’Œ wait çš„åŒºåˆ«ï¼š</strong></p><ul><li>sleepæ–¹æ³•ï¼šæ˜¯Threadç±»çš„é™æ€æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹å°†ç¡çœ næ¯«ç§’ï¼Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚å½“ç¡çœ æ—¶é—´åˆ°äº†ï¼Œä¼šè§£é™¤é˜»å¡ï¼Œè¿›å…¥å¯è¿è¡ŒçŠ¶æ€ï¼Œç­‰å¾…CPUçš„åˆ°æ¥ã€‚ç¡çœ ä¸é‡Šæ”¾é”ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</li><li>waitæ–¹æ³•ï¼šæ˜¯Objectçš„æ–¹æ³•ï¼Œå¿…é¡»ä¸synchronizedå…³é”®å­—ä¸€èµ·ä½¿ç”¨ï¼Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå½“notifyæˆ–è€…notifyallè¢«è°ƒç”¨åï¼Œä¼šè§£é™¤é˜»å¡ã€‚ä½†æ˜¯ï¼Œåªæœ‰<strong>é‡æ–°å ç”¨äº’æ–¥é”</strong>ä¹‹åæ‰ä¼šè¿›å…¥å¯è¿è¡ŒçŠ¶æ€ã€‚ç¡çœ æ—¶ï¼Œä¼šé‡Šæ”¾äº’æ–¥é”ã€‚</li><li>joinæ–¹æ³•ï¼šå½“å‰çº¿ç¨‹è°ƒç”¨ï¼Œåˆ™å…¶å®ƒçº¿ç¨‹å…¨éƒ¨åœæ­¢ï¼Œç­‰å¾…å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œæ¥ç€æ‰§è¡Œã€‚</li><li>yieldæ–¹æ³•ï¼šè¯¥æ–¹æ³•ä½¿å¾—çº¿ç¨‹æ”¾å¼ƒå½“å‰åˆ†å¾—çš„ CPU æ—¶é—´ã€‚ä½†æ˜¯ä¸ä½¿çº¿ç¨‹é˜»å¡ï¼Œå³çº¿ç¨‹ä»å¤„äºå¯æ‰§è¡ŒçŠ¶æ€ï¼Œéšæ—¶å¯èƒ½å†æ¬¡åˆ†å¾— CPU æ—¶é—´ã€‚</li></ul><p><strong>ä¸»è¦è€ƒå¯Ÿï¼š</strong> sleepå’Œwaitæ–¹æ³•æ‰€å¤„çš„ç±»æ˜¯å“ªä¸ªï¼Œå¹¶ä¸”è€ƒå¯Ÿå…¶åœ¨ä¼‘çœ çš„æ—¶å€™<strong>å¯¹äºäº’æ–¥é”</strong>çš„å¤„ç†ã€‚</p><p>ä¸Šé¢æ˜¯ç‰›å®¢çš„é¢è¯•é¢˜æ€»ç»“ï¼Œä¸‹é¢è‡ªå·±åˆ†æä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«ï¼š</p><p><strong>1ã€æ¥è‡ªä¸åŒçš„ç±»</strong></p><p>wait &#x3D;&gt; Object</p><p>sleep &#x3D;&gt; Thread</p><p><strong>2ã€å…³äºé”çš„é‡Šæ”¾ï¼š</strong></p><p>wait ä¼šé‡Šæ”¾é”ï¼Œsleep ç¡è§‰äº†ï¼ŒæŠ±ç€é”ç¡è§‰ï¼Œä¸ä¼šé‡Šæ”¾ï¼</p><p>3ã€ä½¿ç”¨çš„èŒƒå›´ä¸åŒ</p><p>waitå¿…é¡»åœ¨åŒæ­¥ä»£ç å—ä¸­ï¼Œåœ¨sync(){}ä¸­</p><h2 id="4-Locké”"><a href="#4-Locké”" class="headerlink" title="4.Locké”"></a>4.Locké”</h2><blockquote><p>ä¼ ç»ŸSynchronized ï¼ˆåé¢ä¸ºç®€åŒ–ä¹¦å†™ï¼Œç»Ÿä¸€å†™ä¸ºsyncï¼‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* å–ç¥¨<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">17</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaleTicketDemo01</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//å¹¶å‘å¤šä¸ªçº¿ç¨‹ æ“ä½œåŒä¸€ä¸ªèµ„æº</span><br><span class="hljs-type">Ticket</span> <span class="hljs-variable">ticket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ticket</span>();<br><span class="hljs-comment">// @FunctionalInterface å‡½æ•°å¼æ¥å£ï¼Œjdk1.8 lambdaè¡¨è¾¾å¼ (å‚æ•°)-&gt;&#123; ä»£ç  &#125;</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>ticket.saleTicket();<br>&#125;<br>&#125;, <span class="hljs-string">&quot;A&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>ticket.saleTicket();<br>&#125;<br>&#125;, <span class="hljs-string">&quot;B&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>ticket.saleTicket();<br>&#125;<br>&#125;, <span class="hljs-string">&quot;C&quot;</span>).start();<br>&#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Ticket</span> &#123;<br><span class="hljs-comment">//å±æ€§</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">tikcketNums</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;<br><span class="hljs-comment">//åŠ å…¥åŒæ­¥é”</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saleTicket</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">if</span> (tikcketNums &gt; <span class="hljs-number">0</span>) &#123;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;å–å‡ºäº†&quot;</span> + (tikcketNums--) + <span class="hljs-string">&quot;è¿˜å‰©&quot;</span> + tikcketNums);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼š</p><ul><li><p>åœ¨å”®ç¥¨çš„æ–¹æ³•é‡ŒåŠ å…¥syncåŒæ­¥æ–¹æ³•ï¼Œå¦åˆ™ä¼šå‡ºç°çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ï¼›</p></li><li><p>åˆ›å»ºçº¿ç¨‹ä½¿ç”¨çš„lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œï¼›</p></li><li><p>oopçš„æ€æƒ³ï¼Œçº¿ç¨‹æ˜¯ä¸€ä¸ªå•ç‹¬çš„èµ„æºç±»ï¼ˆå±æ€§å’Œæ–¹æ³•ï¼‰ï¼Œä¸ä¼šå†™åœ¨ä¸€èµ·ï¼Œé™ä½è€¦åˆã€‚</p><p>â€‹</p></li></ul><blockquote><p>Lockæ¥å£</p></blockquote><p>JDK1.8æ–‡æ¡£å¯¹å®ƒçš„å®šä¹‰ï¼š</p><blockquote><p><strong>Interface Lock</strong></p><p>æ‰€æœ‰å·²çŸ¥å®ç°ç±»ï¼š</p><p>ReentrantLock ReentrantReadWriteLock.WriteRead ReentrantReadWriteLock.WriteLock</p><p>public interface Lock</p><p><code>Lock</code>å®ç°æä¾›æ¯”ä½¿ç”¨<code>synchronized</code>æ–¹æ³•å’Œè¯­å¥å¯ä»¥è·å¾—çš„æ›´å¹¿æ³›çš„é”å®šæ“ä½œã€‚</p><p>å®ƒä»¬å…è®¸æ›´çµæ´»çš„ç»“æ„åŒ–ï¼Œå¯èƒ½å…·æœ‰å®Œå…¨ä¸åŒçš„å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒå¤šä¸ªç›¸å…³è”çš„å¯¹è±¡Condition ã€‚</p><p>é”æ˜¯ç”¨äºé€šè¿‡å¤šä¸ªçº¿ç¨‹æ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®çš„å·¥å…·ã€‚ é€šå¸¸ï¼Œé”æä¾›å¯¹å…±äº«èµ„æºçš„ç‹¬å è®¿é—®ï¼šä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–é”ï¼Œå¹¶ä¸”å¯¹å…±äº«èµ„æºçš„æ‰€æœ‰è®¿é—®éƒ½è¦æ±‚é¦–å…ˆè·å–é”ã€‚ ä½†æ˜¯ï¼Œä¸€äº›é”å¯èƒ½å…è®¸å¹¶å‘è®¿é—®å…±äº«èµ„æºï¼Œå¦‚<strong>ReadWriteLock</strong>çš„è¯»é”ã€‚</p><p>â€‹ ä½¿ç”¨<code>synchronized</code>æ–¹æ³•æˆ–è¯­å¥æä¾›å¯¹ä¸æ¯ä¸ªå¯¹è±¡ç›¸å…³è”çš„éšå¼ç›‘è§†å™¨é”çš„è®¿é—®ï¼Œä½†æ˜¯<strong>å¼ºåˆ¶æ‰€æœ‰é”è·å–å’Œé‡Šæ”¾ä»¥å—ç»“æ„çš„æ–¹å¼å‘ç”Ÿï¼šå½“è·å–å¤šä¸ªé”æ—¶ï¼Œå®ƒä»¬å¿…é¡»ä»¥ç›¸åçš„é¡ºåºè¢«é‡Šæ”¾ï¼Œå¹¶ä¸”æ‰€æœ‰çš„é”éƒ½å¿…é¡»è¢«é‡Šæ”¾åœ¨ä¸å®ƒä»¬ç›¸åŒçš„è¯æ±‡èŒƒå›´å†…</strong>ã€‚</p><p>â€‹ è™½ç„¶<code>synchronized</code>æ–¹æ³•å’Œè¯­å¥çš„èŒƒå›´æœºåˆ¶ä½¿å¾—ä½¿ç”¨ç›‘è§†å™¨é”æ›´å®¹æ˜“ç¼–ç¨‹ï¼Œå¹¶ä¸”æœ‰<strong>åŠ©äºé¿å…æ¶‰åŠé”çš„è®¸å¤šå¸¸è§ç¼–ç¨‹é”™è¯¯ï¼Œä½†æ˜¯æœ‰æ—¶æ‚¨éœ€è¦ä»¥æ›´çµæ´»çš„æ–¹å¼å¤„ç†é”</strong>ã€‚ ä¾‹å¦‚ï¼Œç”¨äºéå†å¹¶å‘è®¿é—®çš„æ•°æ®ç»“æ„çš„ä¸€äº›ç®—æ³•éœ€è¦ä½¿ç”¨â€œæ‰‹åŠ¨â€æˆ–â€œé“¾é”å®šâ€ï¼šæ‚¨è·å–èŠ‚ç‚¹Açš„é”å®šï¼Œç„¶åè·å–èŠ‚ç‚¹Bï¼Œç„¶åé‡Šæ”¾Aå¹¶è·å–Cï¼Œç„¶åé‡Šæ”¾Bå¹¶è·å¾—Dç­‰ã€‚ æ‰€è¿°çš„å®æ–½æ–¹å¼ä¸­<code>Lock</code>æ¥å£é€šè¿‡å…è®¸è·å¾—å¹¶åœ¨ä¸åŒçš„èŒƒå›´é‡Šæ”¾çš„é”ï¼Œå¹¶å…è®¸è·å¾—å¹¶ä»¥ä»»ä½•é¡ºåºé‡Šæ”¾å¤šä¸ªé”ä½¿å¾—èƒ½å¤Ÿä½¿ç”¨è¿™æ ·çš„æŠ€æœ¯ã€‚</p><p>â€‹ éšç€è¿™ç§å¢åŠ çš„çµæ´»æ€§ï¼Œé¢å¤–çš„è´£ä»»ã€‚ æ²¡æœ‰å—ç»“æ„åŒ–é”å®šä¼šåˆ é™¤ä½¿ç”¨<code>synchronized</code>æ–¹æ³•å’Œè¯­å¥å‘ç”Ÿçš„é”çš„è‡ªåŠ¨é‡Šæ”¾ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”ä½¿ç”¨ä»¥ä¸‹<strong>æƒ¯ç”¨è¯­</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">Lock l = ...; l.lock(); try &#123; // access the resource protected by this lock &#125; finally &#123; l.unlock(); &#125;<br></code></pre></td></tr></table></figure><p>å½“åœ¨ä¸åŒèŒƒå›´å†…<strong>å‘ç”Ÿé”å®šå’Œè§£é”æ—¶ï¼Œå¿…é¡»æ³¨æ„ç¡®ä¿åœ¨é”å®šæ—¶æ‰§è¡Œçš„æ‰€æœ‰ä»£ç ç”±try-finallyæˆ–try-catchä¿æŠ¤ï¼Œä»¥ç¡®ä¿åœ¨å¿…è¦æ—¶é‡Šæ”¾é”å®šã€‚</strong></p><p>â€‹ <code>Lock</code>å®ç°æä¾›äº†ä½¿ç”¨<code>synchronized</code>æ–¹æ³•å’Œè¯­å¥çš„é™„åŠ åŠŸèƒ½ï¼Œé€šè¿‡æä¾›éé˜»å¡å°è¯•æ¥è·å–é” tryLock()ï¼Œå°è¯•è·å–å¯è¢«ä¸­æ–­çš„é”lockInterruptibly() ï¼Œä»¥åŠå°è¯•è·å–å¯ä»¥è¶…æ—¶ï¼ˆtryLock(long, TimeUnitï¼‰ã€‚</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">ä¸€ä¸ª`Lock`ç±»è¿˜å¯ä»¥æä¾›ä¸éšå¼ç›‘è§†é”å®šçš„è¡Œä¸ºå’Œè¯­ä¹‰å®Œå…¨ä¸åŒçš„è¡Œä¸ºå’Œè¯­ä¹‰ï¼Œä¾‹å¦‚ä¿è¯æ’åºï¼Œéé‡å…¥ä½¿ç”¨æˆ–æ­»é”æ£€æµ‹ã€‚ å¦‚æœä¸€ä¸ªå®ç°æä¾›äº†è¿™æ ·çš„ä¸“é—¨çš„è¯­ä¹‰ï¼Œé‚£ä¹ˆå®ç°å¿…é¡»è®°å½•è¿™äº›è¯­ä¹‰ã€‚<br></code></pre></td></tr></table></figure><p>â€‹ è¯·æ³¨æ„ï¼Œ <code>Lock</code>å®ä¾‹åªæ˜¯æ™®é€šå¯¹è±¡ï¼Œå®ƒä»¬æœ¬èº«å¯ä»¥ç”¨ä½œ<code>synchronized</code>è¯­å¥ä¸­çš„ç›®æ ‡ã€‚ è·å–<code>Lock</code>å®ä¾‹çš„ç›‘è§†å™¨é”ä¸è°ƒç”¨è¯¥å®ä¾‹çš„ä»»ä½•lock()æ–¹æ³•æ²¡æœ‰ç‰¹å®šå…³ç³»ã€‚ å»ºè®®ä¸ºé¿å…æ··æ·†ï¼Œæ‚¨ä¸è¦ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨<code>Lock</code>å®ä¾‹ï¼Œé™¤äº†åœ¨è‡ªå·±çš„å®ç°ä¸­ã€‚</p><p>é™¤éå¦æœ‰è¯´æ˜ï¼Œä¼ é€’ä»»ä½•å‚æ•°çš„<code>null</code>å€¼å°†å¯¼è‡´NullPointerExceptionè¢«æŠ›å‡ºã€‚</p></blockquote><p>æ–‡æ¡£å·²ç»è¯´çš„ç›¸å½“æ¸…æ¥šäº†ï¼Œsyncåœ¨è·å–é”æ—¶æ˜¯è·å–æ‰€æœ‰é”ä»¥åŠé‡Šæ”¾ä»¥å—çš„å½¢å¼é‡Šæ”¾ï¼Œå¹¶ä¸”å½“å¤šä¸ªé”éœ€è¦è¢«é‡Šæ”¾æ—¶ï¼Œæ˜¯ä»¥ç›¸åçš„é¡ºåºï¼Œä¸”éƒ½è¦è¢«syncçš„ä»£ç å—{}åŒ…è£¹ã€‚</p><p>Lockç›¸æ¯”syncæ›´çµæ´»ï¼Œæ‰‹åŠ¨åŠ é”å’Œé‡Šæ”¾é”ï¼Œå¹¶ä¸”å¯ä»¥æä¾›æ›´å¤šæ“ä½œç­‰ç­‰ï¼ŒLocké”çš„æ¨¡æ¿ä¹Ÿå·²ç»ç»™å‡ºï¼Œä¸‹é¢ç›´æ¥æµ‹è¯•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">17</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaleTicketDemo02</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//å¹¶å‘å¤šä¸ªçº¿ç¨‹ æ“ä½œåŒä¸€ä¸ªèµ„æº</span><br><span class="hljs-type">Ticket2</span> <span class="hljs-variable">ticket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ticket2</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>ticket.saleTicket();<br>&#125;<br>&#125;, <span class="hljs-string">&quot;A&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>ticket.saleTicket();<br>&#125;<br>&#125;, <span class="hljs-string">&quot;B&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>ticket.saleTicket();<br>&#125;<br>&#125;, <span class="hljs-string">&quot;C&quot;</span>).start();<br>&#125;<br>&#125;<br><span class="hljs-comment">//lockä¸‰éƒ¨æ›²</span><br><span class="hljs-comment">//1 new ReentrantLock();</span><br><span class="hljs-comment">//2 Lock.lock(); åŠ é”</span><br><span class="hljs-comment">//3 finally=&gt; lock.unlock(); è§£é”</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Ticket2</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">tikcketNums</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;<br><span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saleTicket</span><span class="hljs-params">()</span> &#123;<br>lock.lock(); <span class="hljs-comment">//åŠ é”</span><br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">if</span> (tikcketNums &gt; <span class="hljs-number">0</span>) &#123;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;å–å‡ºäº†&quot;</span> + (tikcketNums--) + <span class="hljs-string">&quot;è¿˜å‰©&quot;</span> + tikcketNums);<br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>lock.unlock(); <span class="hljs-comment">//è§£é”</span><br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åˆ›å»ºLocké”æ˜¯å…ˆnewäº†ä¸€ä¸ªReentrantLock() å¯é‡å…¥é”ï¼Œç¿»é˜…æºç æœ‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Creates an instance of &#123;<span class="hljs-meta">@code</span> ReentrantLock&#125;.<br>\* This is equivalent to using &#123;<span class="hljs-meta">@code</span> ReentrantLock(<span class="hljs-literal">false</span>)&#125;.<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ReentrantLock</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">//å¯é‡å…¥é”é»˜è®¤æ˜¯éå…¬å¹³é”</span><br>sync = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonfairSync</span>();<br>&#125;<br>/\*\*<br>\* Creates an instance of &#123;<span class="hljs-meta">@code</span> ReentrantLock&#125; with the<br>\* given fairness policy.<br>\*<br>\* <span class="hljs-meta">@param</span> fair &#123;<span class="hljs-meta">@code</span> <span class="hljs-literal">true</span>&#125; <span class="hljs-keyword">if</span> <span class="hljs-built_in">this</span> lock should use a fair ordering policy<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ReentrantLock</span><span class="hljs-params">(<span class="hljs-type">boolean</span> fair)</span> &#123;<br>sync = fair ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">FairSync</span>() : <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonfairSync</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°new ReentrantLock() ï¼Œä¸ä¼ å‚æ•°ï¼Œèµ°çš„æ— å‚æ„é€ ï¼Œé»˜è®¤æ˜¯NonfairSync() éå…¬å¹³é”ï¼Œè‹¥è¦æŒ‡å®šä¸ºå…¬å¹³é”éœ€è¦new ReentrantLock()çš„æœ‰å‚æ„é€ ï¼Œä¼ å…¥trueå³å¯ã€‚</p><p><strong>é—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆæ˜¯å…¬å¹³é”å’Œéå…¬å¹³é”ï¼Ÿ</strong></p><p>å…¬å¹³é”ï¼šååˆ†å…¬å¹³ï¼Œéµå®ˆå…ˆæ¥ååˆ°</p><p>éå…¬å¹³é”ï¼šååˆ†ä¸å…¬å¹³ï¼Œçº¿ç¨‹å¯ä»¥æ’é˜Ÿï¼ˆé»˜è®¤ï¼‰</p><p>å¯é‡å…¥é”æ¶‰åŠçš„çŸ¥è¯†å¾ˆå¤šï¼Œåé¢å†è®²ã€‚</p><blockquote><p>sync å’Œ LockåŒºåˆ«</p></blockquote><p>1ã€Synchronized å†…ç½®çš„Javaå…³é”®å­—ï¼Œ Lock æ˜¯ä¸€ä¸ªJavaç±»<br>2ã€Synchronized æ— æ³•åˆ¤æ–­è·å–é”çš„çŠ¶æ€ï¼ŒLock å¯ä»¥åˆ¤æ–­æ˜¯å¦è·å–åˆ°äº†é”<br>3ã€Synchronized ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œlock å¿…é¡»è¦æ‰‹åŠ¨é‡Šæ”¾é”ï¼å¦‚æœä¸é‡Šæ”¾é”ï¼Œæ­»é”<br>4ã€Synchronized çº¿ç¨‹ 1ï¼ˆè·å¾—é”ï¼Œé˜»å¡ï¼‰ã€çº¿ç¨‹2ï¼ˆç­‰å¾…ï¼Œå‚»å‚»çš„ç­‰ï¼‰ï¼›Locké”å°±ä¸ä¸€å®šä¼šç­‰å¾…ä¸‹<br>å»ï¼›<br>5ã€Synchronized å¯é‡å…¥é”ï¼Œä¸å¯ä»¥ä¸­æ–­çš„ï¼Œéå…¬å¹³ï¼›Lock ï¼Œå¯é‡å…¥é”ï¼Œå¯ä»¥ åˆ¤æ–­é”ï¼Œéå…¬å¹³ï¼ˆå¯ä»¥<br>è‡ªå·±è®¾ç½®ï¼‰ï¼›<br>6ã€Synchronized é€‚åˆé”å°‘é‡çš„ä»£ç åŒæ­¥é—®é¢˜ï¼ŒLock é€‚åˆé”å¤§é‡çš„åŒæ­¥ä»£ç ï¼</p><h2 id="5-ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜"><a href="#5-ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜" class="headerlink" title="5.ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜"></a>5.ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜</h2><blockquote><p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜ syncç‰ˆ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡é—®é¢˜ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜<br>\* çº¿ç¨‹äº¤æ›¿æ‰§è¡Œ A B æ“ä½œåŒä¸€å˜é‡ num = <span class="hljs-number">0</span><br>\*A num+<span class="hljs-number">1</span><br>\*B num-<span class="hljs-number">1</span><br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">18</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//çº¿ç¨‹èµ„æºç±»</span><br><span class="hljs-type">Data</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>data.increment();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>&#125;, <span class="hljs-string">&quot;A&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>data.decrement();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>&#125;, <span class="hljs-string">&quot;B&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>data.increment();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>&#125;, <span class="hljs-string">&quot;C&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>data.decrement();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>&#125;, <span class="hljs-string">&quot;D&quot;</span>).start();<br>&#125;<br>&#125;<br><span class="hljs-comment">//ç­‰å¾…ï¼Œä¸šåŠ¡ï¼Œé€šçŸ¥</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Data</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">//+1</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><span class="hljs-comment">//ç”¨ifåˆ¤æ–­ ä¼šäº§ç”Ÿè™šå‡å”¤é†’</span><br><span class="hljs-keyword">if</span> (number != <span class="hljs-number">0</span>) &#123;<br><span class="hljs-comment">//ç­‰å¾…</span><br><span class="hljs-built_in">this</span>.wait();<br>&#125;<br>number++;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;=&gt;&quot;</span> + number);<br><span class="hljs-comment">//é€šçŸ¥å…¶ä»–çº¿ç¨‹ï¼Œ+1å®Œæ¯•</span><br><span class="hljs-built_in">this</span>.notifyAll();<br>&#125;<br><span class="hljs-comment">//-1</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrement</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><span class="hljs-keyword">if</span> (number == <span class="hljs-number">0</span>) &#123;<br><span class="hljs-comment">//ç­‰å¾…</span><br><span class="hljs-built_in">this</span>.wait();<br>&#125;<br>number--;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;=&gt;&quot;</span> + number);<br><span class="hljs-comment">//é€šçŸ¥å…¶ä»–çº¿ç¨‹ï¼Œ-1å®Œæ¯•</span><br><span class="hljs-built_in">this</span>.notifyAll();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„æ„æ€æ˜¯å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªè´Ÿè´£num+1ï¼Œä¸€ä¸ªè´Ÿè´£num-1ï¼Œç”±äºåŠ å…¥syncï¼Œå¹¶ä¸”åŠ äº†numæ˜¯å¦ä¸º0çš„åˆ¤æ–­ï¼Œæ‰€ä»¥æŒ‰é“ç†åº”è¯¥æ˜¯çº¿ç¨‹è¿›æ¥ï¼Œä¸€ä¸ªç”Ÿæˆ+1ï¼Œä¸€ä¸ªæ¶ˆè´¹-1ï¼Œä½†è¿è¡Œç»“åˆå‡ºç°ï¼š</p><p>D&#x3D;&gt;0<br>C&#x3D;&gt;1<br>A&#x3D;&gt;2<br>C&#x3D;&gt;3</p><p>å¾ˆæ˜æ˜¾è¿˜æ˜¯å‡ºç°çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜ï¼ŒæŸ¥é˜…JDKå¸®åŠ©æ–‡æ¡£çš„waitæ–¹æ³•ï¼Œå‘ç°ï¼š</p><p><a href="https://imgchr.com/i/sHB4wF"><img src="https://s3.ax1x.com/2021/01/24/sHB4wF.jpg"></a></p><p>waitå­˜åœ¨è™šå‡å”¤é†’ï¼Œéœ€è¦ç”¨æŠŠ<strong>ifæ”¹æˆwhile</strong>ï¼Œå®ç°ç±»ä¼¼è‡ªæ—‹é”çš„åŠŸèƒ½ï¼Œå§‹ç»ˆå»åˆ¤æ–­ï¼</p><p>æ•…åŸæ¥çš„ä»£ç å¯ä»¥æ”¹æˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ç­‰å¾…ï¼Œä¸šåŠ¡ï¼Œé€šçŸ¥</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Data</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">//+1</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><span class="hljs-comment">//ç”¨ifåˆ¤æ–­ ä¼šäº§ç”Ÿè™šå‡å”¤é†’</span><br><span class="hljs-keyword">while</span> (number != <span class="hljs-number">0</span>) &#123;<br><span class="hljs-comment">//ç­‰å¾…</span><br><span class="hljs-built_in">this</span>.wait();<br>&#125;<br>number++;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;=&gt;&quot;</span> + number);<br><span class="hljs-comment">//é€šçŸ¥å…¶ä»–çº¿ç¨‹ï¼Œ+1å®Œæ¯•</span><br><span class="hljs-built_in">this</span>.notifyAll();<br>&#125;<br><span class="hljs-comment">//-1</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrement</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><span class="hljs-keyword">while</span> (number == <span class="hljs-number">0</span>) &#123;<br><span class="hljs-comment">//ç­‰å¾…</span><br><span class="hljs-built_in">this</span>.wait();<br>&#125;<br>number--;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;=&gt;&quot;</span> + number);<br><span class="hljs-comment">//é€šçŸ¥å…¶ä»–çº¿ç¨‹ï¼Œ-1å®Œæ¯•</span><br><span class="hljs-built_in">this</span>.notifyAll();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•é€šè¿‡ï¼</p><blockquote><p>å›¾è§£ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</p></blockquote><p><a href="https://imgchr.com/i/sHDZTg"><img src="https://s3.ax1x.com/2021/01/24/sHDZTg.jpg"></a></p><p>é€šè¿‡Lockæ‰¾åˆ°Codition</p><p><a href="https://imgchr.com/i/sHDW9A"><img src="https://s3.ax1x.com/2021/01/24/sHDW9A.jpg"></a></p><p>å¯ä»¥å‘ç°ï¼ŒLockç‰ˆçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜å¯ä»¥new ä¸€ä¸ªReentrantLockå®ä¾‹ï¼Œç”¨å®ƒçš„å®ä¾‹å»åˆ›å»ºconditionï¼Œç„¶åå†å»å®ç°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜çš„æœ¬è´¨ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* JUCçš„Lockæ›¿ä»£Sync<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">18</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">Data2</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data2</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>data.increment();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>&#125;, <span class="hljs-string">&quot;A&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>data.decrement();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>&#125;, <span class="hljs-string">&quot;B&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>data.increment();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>&#125;, <span class="hljs-string">&quot;C&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>data.decrement();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>&#125;, <span class="hljs-string">&quot;D&quot;</span>).start();<br>&#125;<br>&#125;<br><span class="hljs-comment">//</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Data2</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><span class="hljs-type">Condition</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> lock.newCondition();<br><span class="hljs-comment">//+1</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>lock.lock();<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//ä¸šåŠ¡ä»£ç </span><br><span class="hljs-comment">//ç”¨ifåˆ¤æ–­ ä¼šäº§ç”Ÿè™šå‡å”¤é†’</span><br><span class="hljs-keyword">while</span> (number != <span class="hljs-number">0</span>) &#123;<br><span class="hljs-comment">//ç­‰å¾…</span><br>condition.await();<br>&#125;<br>number++;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;=&gt;&quot;</span> + number);<br><span class="hljs-comment">//é€šçŸ¥å…¶ä»–çº¿ç¨‹ï¼Œ+1å®Œæ¯•</span><br>condition.signalAll();<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>lock.unlock();<br>&#125;<br>&#125;<br><span class="hljs-comment">//-1</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrement</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>lock.lock();<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//ç”¨ifåˆ¤æ–­ ä¼šäº§ç”Ÿè™šå‡å”¤é†’</span><br><span class="hljs-keyword">while</span> (number == <span class="hljs-number">0</span>) &#123;<br><span class="hljs-comment">//ç­‰å¾…</span><br>condition.await();<br>&#125;<br>number--;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;=&gt;&quot;</span> + number);<br><span class="hljs-comment">//é€šçŸ¥å…¶ä»–çº¿ç¨‹ï¼Œ-1å®Œæ¯•</span><br>condition.signalAll();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>lock.unlock();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆåˆ°è¿™ï¼Œå¯èƒ½ä½ ä¼šé—®ï¼Ÿsyncå°±å¯ä»¥å®ç°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜ï¼Œä¸ºå•¥è¿˜è¦ç”¨Lockå‘¢ï¼Ÿä»£ç æ˜æ˜¾å¢å¤šäº†</p><blockquote><p>Condition å®ç°ç²¾å‡†çš„é€šçŸ¥å’Œå”¤é†’çº¿ç¨‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* JUCçš„ç²¾å‡†é€šçŸ¥å’Œå”¤é†’çº¿ç¨‹<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">18</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">Data3</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data3</span>();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>data.printA();<br>&#125;<br>&#125;, <span class="hljs-string">&quot;A&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>data.printB();<br>&#125;<br>&#125;, <span class="hljs-string">&quot;B&quot;</span>).start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>data.printC();<br>&#125;<br>&#125;, <span class="hljs-string">&quot;C&quot;</span>).start();<br>&#125;<br>&#125;<br><span class="hljs-comment">//èµ„æºç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Data3</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><span class="hljs-keyword">private</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">condition1</span> <span class="hljs-operator">=</span> lock.newCondition();<br><span class="hljs-keyword">private</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">condition2</span> <span class="hljs-operator">=</span> lock.newCondition();<br><span class="hljs-keyword">private</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">condition3</span> <span class="hljs-operator">=</span> lock.newCondition();<br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printA</span><span class="hljs-params">()</span> &#123;<br>lock.lock();<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//ä¸šåŠ¡</span><br><span class="hljs-keyword">while</span> (number != <span class="hljs-number">1</span>) &#123;<br>condition1.await();<br>&#125;<br>number = <span class="hljs-number">2</span>;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;BBBBB&quot;</span>);<br><span class="hljs-comment">//ç²¾å‡†å”¤é†’</span><br>condition2.signal();<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>lock.unlock();<br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printB</span><span class="hljs-params">()</span> &#123;<br>lock.lock();<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//ä¸šåŠ¡</span><br><span class="hljs-keyword">while</span> (number != <span class="hljs-number">2</span>) &#123;<br>condition2.await();<br>&#125;<br>number = <span class="hljs-number">3</span>;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;CCCCCC&quot;</span>);<br><span class="hljs-comment">//ç²¾å‡†å”¤é†’</span><br>condition3.signal();<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>lock.unlock();<br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printC</span><span class="hljs-params">()</span> &#123;<br>lock.lock();<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//ä¸šåŠ¡</span><br><span class="hljs-keyword">while</span> (number != <span class="hljs-number">3</span>) &#123;<br>condition3.await();<br>&#125;<br>number = <span class="hljs-number">1</span>;<br>System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;AAAAAA&quot;</span>);<br><span class="hljs-comment">//ç²¾å‡†å”¤é†’</span><br>condition1.signal();<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>lock.unlock();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://imgchr.com/i/sHs9Mt"><img src="https://s3.ax1x.com/2021/01/24/sHs9Mt.jpg"></a></p>]]></content>
    
    
    
    <tags>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBooté›†æˆJSR303</title>
    <link href="/2021/01/23/SpringBoot%E9%9B%86%E6%88%90JSR303/"/>
    <url>/2021/01/23/SpringBoot%E9%9B%86%E6%88%90JSR303/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringBooté›†æˆJSR303"><a href="#SpringBooté›†æˆJSR303" class="headerlink" title="SpringBooté›†æˆJSR303"></a>SpringBooté›†æˆJSR303</h1><p>JSR-303 æ˜¯ JAVA EE 6 ä¸­çš„ä¸€é¡¹å­è§„èŒƒï¼Œå«åš <strong>Bean Validation</strong>ï¼Œå®˜æ–¹å‚è€ƒå®ç°æ˜¯<strong>Hibernate Validator</strong>ã€‚</p><p>æ­¤å®ç°ä¸ Hibernate ORM æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚ JSR 303 ç”¨äºå¯¹ Java Bean ä¸­çš„å­—æ®µçš„å€¼è¿›è¡ŒéªŒè¯ã€‚<br>Spring MVC 3.x ä¹‹ä¸­ä¹Ÿå¤§åŠ›æ”¯æŒ JSR-303ï¼Œå¯ä»¥åœ¨æ§åˆ¶å™¨ä¸­å¯¹è¡¨å•æäº¤çš„æ•°æ®æ–¹ä¾¿åœ°éªŒè¯ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä½¿ç”¨SpringBootæ¥è¯¦ç»†è®²è§£å¦‚ä½•ä½¿ç”¨JSR303åšæ•°æ®æ ¡éªŒ</p><h2 id="1-mavenä¾èµ–"><a href="#1-mavenä¾èµ–" class="headerlink" title="1.mavenä¾èµ–"></a>1.mavenä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--JSR303--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°±ä¸è¿æ•°æ®åº“äº†ï¼Œæˆ‘ä»¬çš„ç›®çš„åªæ˜¯éªŒè¯æ•°æ®æ˜¯å¦èƒ½å¾—åˆ°æ ¡éªŒã€‚</p><h2 id="2-æ³¨è§£"><a href="#2-æ³¨è§£" class="headerlink" title="2.æ³¨è§£"></a>2.æ³¨è§£</h2><p>ä½¿ç”¨JSR303ä¸»è¦å°±æ˜¯ç”¨å®ƒæä¾›çš„<strong>æ³¨è§£</strong>ï¼Œä¸‹é¢æ˜¯æ³¨è§£è®²è§£ï¼š</p><p><strong>ç©ºæ£€æŸ¥</strong></p><ul><li>@Null éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ºnull</li><li>@NotNull éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ä¸ºnull, æ— æ³•æŸ¥æ£€é•¿åº¦ä¸º0çš„å­—ç¬¦ä¸²</li><li>@NotBlank æ£€æŸ¥çº¦æŸå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯Nullè¿˜æœ‰è¢«Trimçš„é•¿åº¦æ˜¯å¦å¤§äº0,åªå¯¹å­—ç¬¦ä¸²,ä¸”ä¼šå»æ‰å‰åç©ºæ ¼.</li><li>@NotEmpty æ£€æŸ¥çº¦æŸå…ƒç´ æ˜¯å¦ä¸ºNULLæˆ–è€…æ˜¯EMPTY.</li></ul><p><strong>Booelanæ£€æŸ¥</strong></p><ul><li>@AssertTrue éªŒè¯ Booleanï¼Œå¯¹è±¡æ˜¯å¦ä¸º true</li><li>@AssertFalse éªŒè¯ Booleanï¼Œå¯¹è±¡æ˜¯å¦ä¸º false</li></ul><p><strong>é•¿åº¦æ£€æŸ¥</strong></p><ul><li>@Size(min&#x3D;, max&#x3D;) éªŒè¯å¯¹è±¡ï¼ˆArray,Collection,Map,Stringï¼‰é•¿åº¦æ˜¯å¦åœ¨ç»™å®šçš„èŒƒå›´ä¹‹å†…</li><li>@Length(min&#x3D;, max&#x3D;) éªŒè¯çº¦æŸå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«åœ¨æœ€å°å’Œæœ€å¤§ä¹‹é—´ã€‚</li></ul><p><strong>æ—¥æœŸæ£€æŸ¥</strong></p><ul><li>@Past éªŒè¯ Dateå’Œ Calendarï¼Œå¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å‰ï¼ŒéªŒè¯æˆç«‹çš„è¯è¢«æ³¨é‡Šçš„å…ƒç´ ä¸€å®šæ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ</li><li>@Future éªŒè¯ Dateå’Œ Calendarå¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹åï¼ŒéªŒè¯æˆç«‹çš„è¯è¢«æ³¨é‡Šçš„å…ƒç´ ä¸€å®šæ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ</li><li>@Pattern éªŒè¯ Stringå¯¹è±¡æ˜¯å¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™ï¼Œè¢«æ³¨é‡Šçš„å…ƒç´ ç¬¦åˆåˆ¶å®šçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œregexp:æ­£åˆ™è¡¨è¾¾å¼ flags: æŒ‡å®š Pattern.Flag çš„æ•°ç»„ï¼Œè¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„ç›¸å…³é€‰é¡¹ã€‚</li></ul><p><strong>æ•°å€¼æ£€æŸ¥</strong><br>å»ºè®®ä½¿ç”¨åœ¨Stirng,Integerç±»å‹ï¼Œä¸å»ºè®®ä½¿ç”¨åœ¨ int ç±»å‹ä¸Šï¼Œå› ä¸ºè¡¨å•å€¼ä¸º ç©º æ—¶æ— æ³•è½¬æ¢ä¸ºintï¼Œ</p><ul><li>@Min éªŒè¯ Number</li><li>å’Œ String å¯¹è±¡æ˜¯å¦å¤§ç­‰äºæŒ‡å®šçš„å€¼</li><li>@Max éªŒè¯ Numberå’Œ String å¯¹è±¡æ˜¯å¦å°ç­‰äºæŒ‡å®šçš„å€¼</li><li>@DecimalMax è¢«æ ‡æ³¨çš„å€¼å¿…é¡»ä¸å¤§äºçº¦æŸä¸­æŒ‡å®šçš„æœ€å¤§å€¼.è¿™ä¸ªçº¦æŸçš„å‚æ•°æ˜¯ä¸€ä¸ªé€šè¿‡BigDecimalå®šä¹‰çš„æœ€å¤§å€¼çš„å­—ç¬¦ä¸²è¡¨ç¤º. å°æ•°å­˜åœ¨ç²¾åº¦ï¼ˆ Double,float, BigDecimal ï¼‰</li><li>@DecimalMin è¢«æ ‡æ³¨çš„å€¼å¿…é¡»ä¸å°äºçº¦æŸä¸­æŒ‡å®šçš„æœ€å°å€¼.è¿™ä¸ªçº¦æŸçš„å‚æ•°æ˜¯ä¸€ä¸ªé€šè¿‡BigDecimalå®šä¹‰çš„æœ€å°å€¼çš„å­—ç¬¦ä¸²è¡¨ç¤º. å°æ•°å­˜åœ¨ç²¾åº¦</li><li>@Digits éªŒè¯ Numberå’Œ String çš„æ„æˆæ˜¯å¦åˆæ³•</li><li>@Digits(integer&#x3D;,fraction&#x3D;) éªŒè¯å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ç¬¦åˆæŒ‡å®šæ ¼å¼çš„æ•°å­—ï¼ŒintergeræŒ‡å®šæ•´æ•°ç²¾åº¦ï¼ŒfractionæŒ‡å®šå°æ•°ç²¾åº¦ã€‚</li><li>@Range(min&#x3D;, max&#x3D;) è¢«æŒ‡å®šçš„å…ƒç´ å¿…é¡»åœ¨åˆé€‚çš„èŒƒå›´å†…</li><li>@Range(min&#x3D;10000,max&#x3D;50000,message&#x3D;â€range.bean.wageâ€)</li><li>@Valid é€’å½’çš„å¯¹å…³è”å¯¹è±¡è¿›è¡Œæ ¡éªŒ,å¦‚æœå…³è”å¯¹è±¡æ˜¯ä¸ªé›†åˆæˆ–è€…æ•°ç»„,é‚£ä¹ˆå¯¹å…¶ä¸­çš„å…ƒç´ è¿›è¡Œé€’å½’æ ¡éªŒ,å¦‚æœæ˜¯ä¸€ä¸ªmap,åˆ™å¯¹å…¶ä¸­çš„å€¼éƒ¨åˆ†è¿›è¡Œæ ¡éªŒ.(æ˜¯å¦è¿›è¡Œé€’å½’éªŒè¯)</li><li>@CreditCardNumber ä¿¡ç”¨å¡éªŒè¯</li><li>@Email éªŒè¯æ˜¯å¦æ˜¯é‚®ä»¶åœ°å€ï¼Œå¦‚æœä¸ºnull,ä¸è¿›è¡ŒéªŒè¯ï¼Œç®—é€šè¿‡éªŒè¯ã€‚</li><li>@ScriptAssert(lang&#x3D; ,script&#x3D;, alias&#x3D;)</li><li>@URL(protocol&#x3D;,host&#x3D;, port&#x3D;,regexp&#x3D;, flags&#x3D;)</li></ul><h2 id="3-è¡¨å•æ ¡éªŒ"><a href="#3-è¡¨å•æ ¡éªŒ" class="headerlink" title="3.è¡¨å•æ ¡éªŒ"></a>3.è¡¨å•æ ¡éªŒ</h2><p><strong>User.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* ç”¨æˆ·å®ä½“ç±»<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">23</span><br>\*/<br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br><span class="hljs-keyword">private</span> Integer uid; <span class="hljs-comment">//ä¸»é”®</span><br><span class="hljs-meta">@NotEmpty(message = &quot;å§“åä¸èƒ½ä¸ºç©º&quot;)</span><br><span class="hljs-meta">@Length(min = 1,max = 10,message = &quot;é•¿åº¦å¿…é¡»åœ¨1-10ä¹‹é—´&quot;)</span><br><span class="hljs-keyword">private</span> String name; <span class="hljs-comment">//å§“å</span><br><span class="hljs-meta">@NotBlank</span><br><span class="hljs-meta">@Pattern(regexp = &quot;^134[0-8]\\d&#123;7&#125;$|^13[^4]\\d&#123;8&#125;$|^14[5-9]\\d&#123;8&#125;$|^15[^4]\\d&#123;8&#125;$|^16[6]\\d&#123;8&#125;$|^17[0-8]\\d&#123;8&#125;$|^18[\\d]&#123;9&#125;$|^19[8,9]\\d&#123;8&#125;$&quot;, message = &quot;ç”µè¯å·ç æ ¼å¼ä¸æ­£ç¡®&quot;)</span><br><span class="hljs-keyword">private</span> String tel; <span class="hljs-comment">//ç”µè¯</span><br><span class="hljs-meta">@Email(message = &quot;é‚®ä»¶æ ¼å¼ä¸æ­£ç¡®&quot;)</span><br><span class="hljs-meta">@NotEmpty</span><br><span class="hljs-keyword">private</span> String mail; <span class="hljs-comment">//é‚®ç®±</span><br><span class="hljs-meta">@NotBlank</span><br><span class="hljs-meta">@Pattern(regexp = &quot;[1-9][0-9]&#123;4,14&#125;&quot;, message = &quot;qqæ ¼å¼ä¸æ­£ç¡®&quot;)</span><br><span class="hljs-keyword">private</span> String qq; <span class="hljs-comment">//qq</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å±æ€§æ˜¯åŠ ä¸Šåˆé€‚çš„æ³¨è§£ï¼Œå³å¯å®ç°æ ¡éªŒï¼Œå¯¹äºç”µè¯ï¼Œqqç­‰ç­‰å¯ä»¥ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ ¡éªŒã€‚</p><p><strong>UserController.Java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* ç”¨æˆ·æ³¨å†Œ<br>\* <span class="hljs-meta">@param</span> user<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@PostMapping(&quot;/user&quot;)</span><br><span class="hljs-comment">//@Valid åŠ å…¥å‚æ•°æ ¡éªŒ</span><br><span class="hljs-comment">// @Validated ä¸¤è€…åŸºæœ¬ä½¿ç”¨æ— åŒºåˆ«</span><br>/\*\*<br>\* <span class="hljs-meta">@Valid</span>----<br>\* <span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Valid &#123;<br>\* &#125;<br>\*<br>\* <span class="hljs-meta">@Validated</span>-----<br>\* <span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Validated &#123;<br>\* Class&lt;?&gt;[] value() <span class="hljs-keyword">default</span> &#123;&#125;;<br>\* &#125;<br>\*<br>\*/<br><span class="hljs-keyword">public</span> BaseResponse&lt;Integer&gt; <span class="hljs-title function_">insUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> <span class="hljs-meta">@Valid</span> User user)</span>&#123;<br>log.info(<span class="hljs-string">&quot;è¡¨å•ä¼ å€¼====&gt;&quot;</span>+user);<br><span class="hljs-type">Integer</span> <span class="hljs-variable">integer</span> <span class="hljs-operator">=</span> userService.registerUser(user);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;æ³¨å†ŒæˆåŠŸ&quot;</span>,integer);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ ¡éªŒ@RequestBodyæ³¨è§£çš„æ•°æ®æ—¶,å¯ä»¥ä½¿ç”¨@Validatedå’Œ@Validï¼Œä¸¤è€…æœ‰åŒºåˆ«å—ï¼Ÿ</p><h3 id="3-1-æ‰€å±åŒ…ä¸åŒ"><a href="#3-1-æ‰€å±åŒ…ä¸åŒ" class="headerlink" title="3.1 æ‰€å±åŒ…ä¸åŒ"></a>3.1 æ‰€å±åŒ…ä¸åŒ</h3><p>å¯ä»¥çœ‹åˆ°@Validatedå±äº<code>spring</code>ï¼Œè€Œ@Validå±äº<code>javax</code>ã€‚</p><ul><li>@Validated ï¼š<code>org.springframework.validation.annotation.Validated</code></li><li>@Validï¼š<code>javax.validation.Valid</code></li></ul><h3 id="3-2-æºç åŒºåˆ«"><a href="#3-2-æºç åŒºåˆ«" class="headerlink" title="3.2 æºç åŒºåˆ«"></a>3.2 æºç åŒºåˆ«</h3><p>@Valid</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.METHOD, ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE\_USE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Valid &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>@Validated</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD, ElementType.PARAMETER&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Validated &#123;<br>Class&lt;?&gt;[] value() <span class="hljs-keyword">default</span> &#123;&#125;;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡æºç å¯ä»¥çœ‹åˆ°@Validatedå¯ä»¥<code>åœ¨ç±»ä¸Šé¢ä½¿ç”¨</code>ï¼Œå¹¶ä¸”å¤šäº†ä¸€ä¸ª<code>valueå±æ€§</code>ã€‚</p><p>@Validatedæä¾›äº†ä¸€ä¸ª<code>åˆ†ç»„åŠŸèƒ½</code>ï¼Œåœ¨æ ¡éªŒå‚æ•°æ—¶ï¼Œå¯ä»¥æ ¹æ®<code>ä¸åŒçš„åˆ†ç»„</code>é‡‡ç”¨<code>ä¸åŒçš„æ ¡éªŒæœºåˆ¶</code>ã€‚æ²¡æœ‰æ·»åŠ åˆ†ç»„å±æ€§æ—¶ï¼Œé»˜è®¤éªŒè¯æ²¡æœ‰åˆ†ç»„çš„éªŒè¯å±æ€§ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¹‹é—´å¯åŠ¨é¡¹ç›®ï¼Œåˆ©ç”¨Postmanæµ‹è¯•ï¼š</p><p><a href="https://imgchr.com/i/sTc0L6"><img src="https://s3.ax1x.com/2021/01/23/sTc0L6.jpg"></a></p><p><strong>æäº¤ä¸ç¬¦åˆæ ¼å¼çš„æ•°æ®ï¼Œæ ¡éªŒä¸é€šè¿‡ï¼Œè¿”å›400è¯·æ±‚å¤±è´¥</strong></p><p><a href="https://imgchr.com/i/sTcwsx"><img src="https://s3.ax1x.com/2021/01/23/sTcwsx.png"></a></p><p>å¯ä»¥çœ‹åˆ°SpringMVCçš„é€šè¿‡æ³¨è§£å®ç°äº†æ ¡éªŒ@RequestBodyä¸­çš„æ•°æ®ï¼Œæµ‹è¯•é€šè¿‡ï¼</p><h2 id="4-åˆ†ç»„æ ¡éªŒ"><a href="#4-åˆ†ç»„æ ¡éªŒ" class="headerlink" title="4.åˆ†ç»„æ ¡éªŒ"></a>4.åˆ†ç»„æ ¡éªŒ</h2><p>ä¸Šé¢çš„è¡¨å•æäº¤ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸èƒ½åˆ†æƒ…å†µå»æäº¤æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨ä¿®åœ¨ç”µè¯å·ç çš„æ—¶å€™ï¼Œéœ€è¦åœ¨è¯·æ±‚ä¸­ä¼ å…¥ç”¨æˆ·åï¼Œé‚®ç®±ç­‰ç­‰ä¿¡æ¯ï¼Œå¦åˆ™ä¹Ÿä¼šè¿”å›400ï¼Œæ•°æ®å†—ä½™ï¼Œæ‰€ä»¥å°±å½“äº§ç”Ÿè¿™ç§éœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨@Validatedçš„åˆ†ç»„æ ¡éªŒåŠŸèƒ½ã€‚</p><p><strong>ç¼–å†™åˆ†ç»„æ ¡éªŒæ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* åˆ†ç»„æ ¡éªŒ<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">23</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ValidatedGroup</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Add</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Default</span> &#123;&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Delete</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Default</span> &#123;&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Update</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Default</span> &#123;&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Query</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Default</span> &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ”¹é€ ä¸‹ä¹‹å‰çš„User.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">23</span><br>\*/<br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestUser</span> &#123;<br><span class="hljs-keyword">private</span> Integer uid; <span class="hljs-comment">//ä¸»é”®</span><br><span class="hljs-meta">@NotEmpty(groups = &#123;ValidatedGroup.Add.class&#125;,message = &quot;æ›´æ–°ä¸èƒ½ä¸ºç©º&quot;)</span><br><span class="hljs-meta">@Length(min = 1,max = 10,message = &quot;é•¿åº¦å¿…é¡»åœ¨1-10ä¹‹é—´&quot;)</span><br><span class="hljs-keyword">private</span> String name; <span class="hljs-comment">//å§“å</span><br><span class="hljs-meta">@NotBlank(groups = &#123;ValidatedGroup.Add.class&#125;,message = &quot;æ›´æ–°ç”µè¯å·ç ä¸èƒ½ä¸ºç©º&quot;)</span><br><span class="hljs-meta">@Pattern(regexp = &quot;^134[0-8]\\d&#123;7&#125;$|^13[^4]\\d&#123;8&#125;$|^14[5-9]\\d&#123;8&#125;$|^15[^4]\\d&#123;8&#125;$|^16[6]\\d&#123;8&#125;$|^17[0-8]\\d&#123;8&#125;$|^18[\\d]&#123;9&#125;$|^19[8,9]\\d&#123;8&#125;$&quot;, message = &quot;ç”µè¯å·ç æ ¼å¼ä¸æ­£ç¡®&quot;)</span><br><span class="hljs-keyword">private</span> String tel; <span class="hljs-comment">//ç”µè¯</span><br><span class="hljs-meta">@Email(message = &quot;é‚®ä»¶æ ¼å¼ä¸æ­£ç¡®&quot;)</span><br><span class="hljs-meta">@NotBlank(groups = &#123;ValidatedGroup.Add.class&#125; , message = &quot;æ›´æ–°é‚®ç®±ä¸èƒ½ä¸ºç©º&quot;)</span><br><span class="hljs-keyword">private</span> String mail; <span class="hljs-comment">//é‚®ç®±</span><br><span class="hljs-meta">@NotBlank(groups = &#123;ValidatedGroup.Update.class,ValidatedGroup.Add.class&#125;,message = &quot;æ›´æ–°å’Œæ–°å¢çš„qqä¸èƒ½ä¸ºç©º&quot;)</span><br><span class="hljs-meta">@Pattern(regexp = &quot;[1-9][0-9]&#123;4,14&#125;&quot;, message = &quot;qqæ ¼å¼ä¸æ­£ç¡®&quot;)</span><br><span class="hljs-keyword">private</span> String qq; <span class="hljs-comment">//qq</span><br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢åˆ†æ@Validatedå’Œ@Validæ³¨è§£çš„æºç ï¼Œæˆ‘ä»¬çŸ¥é“@Validatedè¿˜æä¾›äº†åˆ†ç»„æ ¡éªŒï¼Œå…·ä½“å®ç°æ€è·¯ï¼š</p><p>åœ¨å®ä½“ç±»ä¸­çš„æ³¨è§£ä¸­è¯´æ˜éœ€è¦æ ¡éªŒçš„æ¡ä»¶ï¼Œå¦‚ï¼š</p><p>@NotBlank(groups &#x3D; {ValidatedGroup.Add.class},message &#x3D; â€œæ›´æ–°ç”µè¯å·ç ä¸èƒ½ä¸ºç©ºâ€)</p><p>æ­¤æ³¨è§£æ ‡æ˜åªæœ‰åœ¨æ–°å¢çš„æ—¶å€™ï¼Œæ‰ä¼šæ ¡éªŒç”µè¯å·ç ï¼Œåœ¨controllerä¸­å†™æ˜æ ¡éªŒçš„æ¡ä»¶å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* ä¿®æ”¹ä¿¡æ¯<br>\* <span class="hljs-meta">@param</span> testUser<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@PostMapping(&quot;/updateUser&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;Integer&gt; <span class="hljs-title function_">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> <span class="hljs-meta">@Validated(value = ValidatedGroup.Update.class)</span> TestUser testUser)</span>&#123;<br>log.info(<span class="hljs-string">&quot;è¡¨å•ä¼ å€¼====&gt;&quot;</span>+testUser);<br><span class="hljs-type">Integer</span> <span class="hljs-variable">integer</span> <span class="hljs-operator">=</span> userService.updateUser(testUser);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;ä¿®æ”¹æˆåŠŸ&quot;</span>,integer);<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨updateUser()æ–¹æ³•æ—¶ï¼Œç”±äºåœ¨@Validatedä¸­åŠ å…¥äº†åˆ†ç»„æ ¡éªŒï¼Œåªæœ‰åœ¨å®ä½“ç±»ä¸­åŠ å…¥äº†Updateåˆ†ç»„çš„æ–¹æ³•æ‰ä¼šè¢«è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œ<strong>å‡å°‘æ•°æ®å†—æ‚</strong>ã€‚</p><p><a href="https://imgchr.com/i/sTg2AU"><img src="https://s3.ax1x.com/2021/01/23/sTg2AU.jpg"></a></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰æ ¡éªŒqqæ ¼å¼çš„æ³¨è§£ç”Ÿæ•ˆ</p><p><a href="https://imgchr.com/i/sT2put"><img src="https://s3.ax1x.com/2021/01/23/sT2put.png"></a></p><p>æµ‹è¯•é€šè¿‡ï¼</p><h2 id="5-GitHubæºç "><a href="#5-GitHubæºç " class="headerlink" title="5.GitHubæºç "></a>5.GitHubæºç </h2><p><a href="https://github.com/luffy997/SpringBootBucket/tree/main/springboot-jsr303">springboot-jsr303</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootä¹‹é›†æˆRedis</title>
    <link href="/2021/01/21/SpringBoot%E4%B9%8B%E9%9B%86%E6%88%90Redis/"/>
    <url>/2021/01/21/SpringBoot%E4%B9%8B%E9%9B%86%E6%88%90Redis/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringBootä¹‹é›†æˆRedis"><a href="#SpringBootä¹‹é›†æˆRedis" class="headerlink" title="SpringBootä¹‹é›†æˆRedis"></a>SpringBootä¹‹é›†æˆRedis</h1><p><a href="https://imgchr.com/i/s4Bp5V"><img src="https://s3.ax1x.com/2021/01/21/s4Bp5V.png"></a></p><p><a href="https://redis.io/">Rediså®˜ç½‘</a>å¯¹Redisçš„ä»‹ç»ï¼š</p><blockquote><p>Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache, and message broker. Redis provides data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes, and streams. Redis has built-in replication, Lua scripting, LRU eviction, transactions, and different levels of on-disk persistence, and provides high availability via Redis Sentinel and automatic partitioning with Redis Cluster.</p></blockquote><p>ç®€å•çš„ç¿»è¯‘ä¸‹ï¼šRedisæ˜¯ä¸€æ¬¾åŸºäºå†…å­˜çš„é”®å€¼å¯¹æ•°æ®åº“ï¼Œç”¨ä½œæ•°æ®åº“ï¼Œç¼“å­˜å’Œæ¶ˆæ¯ä»£ç†ã€‚Redisæä¾›æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ï¼Œå“ˆå¸Œï¼Œåˆ—è¡¨ï¼Œé›†åˆï¼Œå¸¦èŒƒå›´æŸ¥è¯¢çš„æ’åºé›†åˆï¼Œä½å›¾ï¼Œè¶…æ—¥å¿—ï¼Œåœ°ç†ç©ºé—´ç´¢å¼•å’Œæµã€‚æ€»ä¹‹å¾ˆå¼ºå¤§å°±æ˜¯äº†ã€‚</p><h2 id="1-Redisä»‹ç»"><a href="#1-Redisä»‹ç»" class="headerlink" title="1.Redisä»‹ç»"></a>1.Redisä»‹ç»</h2><p>Redisæ˜¯ç°åœ¨æœ€å—æ¬¢è¿çš„NoSQLæ•°æ®åº“ä¹‹ä¸€ï¼ŒRedisæ˜¯ä¸€ä¸ªä½¿ç”¨ANSI Cç¼–å†™çš„å¼€æºã€åŒ…å«å¤šç§æ•°æ®ç»“æ„ã€æ”¯æŒç½‘ç»œã€åŸºäºå†…å­˜ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ï¼Œå…¶å…·å¤‡å¦‚ä¸‹ç‰¹æ€§ï¼š</p><ul><li>åŸºäºå†…å­˜è¿è¡Œï¼Œæ€§èƒ½é«˜æ•ˆ</li><li>æ”¯æŒåˆ†å¸ƒå¼ï¼Œç†è®ºä¸Šå¯ä»¥æ— é™æ‰©å±•</li><li>key-valueå­˜å‚¨ç³»ç»Ÿ</li><li>å¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€éµå®ˆBSDåè®®ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€Key-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„API</li></ul><p>ç›¸æ¯”äºå…¶ä»–æ•°æ®åº“ç±»å‹ï¼ŒRediså…·å¤‡çš„ç‰¹ç‚¹æ˜¯ï¼š</p><ul><li>C&#x2F;Sé€šè®¯æ¨¡å‹</li><li>å•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å‹</li><li>ä¸°å¯Œçš„æ•°æ®ç±»å‹</li><li>æ“ä½œå…·æœ‰åŸå­æ€§</li><li>æŒä¹…åŒ–</li><li>é«˜å¹¶å‘è¯»å†™</li><li>æ”¯æŒluaè„šæœ¬</li></ul><p>å“ªäº›å¤§å‚åœ¨ä½¿ç”¨Redisï¼Ÿ</p><ul><li>github</li><li>twitter</li><li>Stack Overflow</li><li>é˜¿é‡Œå·´å·´</li><li>ç¾å›¢</li></ul><p><strong>Redisçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</strong></p><p>Redis çš„åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼šç¼“å­˜ç³»ç»Ÿï¼ˆâ€œçƒ­ç‚¹â€æ•°æ®ï¼šé«˜é¢‘è¯»ã€ä½é¢‘å†™ï¼‰ã€è®¡æ•°å™¨ã€æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿã€æ’è¡Œæ¦œã€ç¤¾äº¤ç½‘ç»œå’Œå®æ—¶ç³»ç»Ÿã€‚</p><p>æ¯”å¦‚å¸¸è§çš„ç”µå•†åœºæ™¯ï¼Œæ ¹æ®å•†å“ ID è·å–å•†å“ä¿¡æ¯æ—¶ï¼Œåº—é“ºä¿¡æ¯å’Œå•†å“è¯¦æƒ…ä¿¡æ¯å°±å¯ä»¥ç¼“å­˜åœ¨ Redisï¼Œç›´æ¥ä» Redis è·å–ã€‚ å‡å°‘äº†å»æ•°æ®åº“æŸ¥è¯¢çš„æ¬¡æ•°ã€‚ä½†ä¼šå‡ºç°æ–°çš„é—®é¢˜ï¼Œå°±æ˜¯å¦‚ä½•å¯¹ç¼“å­˜è¿›è¡Œæ›´æ–°ï¼Ÿè¿™å°±æ˜¯ä¸‹é¢è¦è®²çš„ã€‚</p><p><strong>Redisçš„æ•°æ®ç±»å‹åŠä¸»è¦ç‰¹æ€§ï¼Ÿ</strong></p><p>Redisæä¾›çš„æ•°æ®ç±»å‹ä¸»è¦åˆ†ä¸º5ç§è‡ªæœ‰ç±»å‹å’Œä¸€ç§è‡ªå®šä¹‰ç±»å‹ï¼Œè¿™5ç§è‡ªæœ‰ç±»å‹åŒ…æ‹¬ï¼šStringç±»å‹ã€å“ˆå¸Œç±»å‹ã€åˆ—è¡¨ç±»å‹ã€é›†åˆç±»å‹å’Œé¡ºåºé›†åˆç±»å‹ã€‚</p><h2 id="2-Redisæ›´æ–°ç­–ç•¥"><a href="#2-Redisæ›´æ–°ç­–ç•¥" class="headerlink" title="2.Redisæ›´æ–°ç­–ç•¥"></a>2.Redisæ›´æ–°ç­–ç•¥</h2><p>å‚è€ƒ<a href="http://coolshell.cn/articles/17416.html">ã€Šç¼“å­˜æ›´æ–°çš„å¥—è·¯ã€‹</a> ï¼Œç¼“å­˜æ›´æ–°çš„æ¨¡å¼æœ‰å››ç§ï¼š</p><ol><li>Cache aside</li><li>Read through</li><li>Write through</li><li>Write behind caching</li></ol><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Cache Aside ç­–ç•¥ï¼Œä»ä¸‰ä¸ªç»´åº¦ï¼š</p><ul><li>å¤±æ•ˆï¼šåº”ç”¨ç¨‹åºå…ˆä»cacheå–æ•°æ®ï¼Œæ²¡æœ‰å¾—åˆ°ï¼Œåˆ™ä»æ•°æ®åº“ä¸­å–æ•°æ®ï¼ŒæˆåŠŸåï¼Œæ”¾åˆ°ç¼“å­˜ä¸­ã€‚</li><li>å‘½ä¸­ï¼šåº”ç”¨ç¨‹åºä»cacheä¸­å–æ•°æ®ï¼Œå–åˆ°åè¿”å›ã€‚</li><li>æ›´æ–°ï¼šå…ˆæŠŠæ•°æ®å­˜åˆ°æ•°æ®åº“ä¸­ï¼ŒæˆåŠŸåï¼Œå†è®©ç¼“å­˜å¤±æ•ˆã€‚</li></ul><p>å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><p>è·å–å•†å“è¯¦æƒ…ä¸¾ä¾‹</p><ol><li>ä»å•†å“ Cache ä¸­è·å–å•†å“è¯¦æƒ…ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›è·å– Cache æ•°æ®è¿”å›ã€‚</li><li>å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä»å•†å“ DB ä¸­è·å–ã€‚è·å–æˆåŠŸåï¼Œå°†æ•°æ®å­˜åˆ° Cache ä¸­ã€‚åˆ™ä¸‹æ¬¡è·å–å•†å“è¯¦æƒ…ï¼Œå°±å¯ä»¥ä» Cache å°±å¯ä»¥å¾—åˆ°å•†å“è¯¦æƒ…æ•°æ®ã€‚</li><li>ä»å•†å“ DB ä¸­æ›´æ–°æˆ–è€…åˆ é™¤å•†å“è¯¦æƒ…æˆåŠŸåï¼Œåˆ™ä»ç¼“å­˜ä¸­åˆ é™¤å¯¹åº”å•†å“çš„è¯¦æƒ…ç¼“å­˜</li></ol><p><a href="https://imgchr.com/i/s4DxhV"><img src="https://s3.ax1x.com/2021/01/21/s4DxhV.png"></a></p><h2 id="3-æ·»åŠ mavenä¾èµ–"><a href="#3-æ·»åŠ mavenä¾èµ–" class="headerlink" title="3.æ·»åŠ mavenä¾èµ–"></a>3.æ·»åŠ mavenä¾èµ–</h2><p>æˆ‘ä»¬ä»¥Mybatisåšæ•°æ®è®¿é—®å±‚æ“ä½œï¼ŒRedisåšç¼“å­˜æ“ä½œ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--mysqlè¿æ¥--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--mybatis--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--druid--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--redis--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--Java å·¥å…·ç±»åº“ï¼šHutool--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hutool-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.57<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="4-é…ç½®application-properties"><a href="#4-é…ç½®application-properties" class="headerlink" title="4.é…ç½®application.properties"></a>4.é…ç½®application.properties</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">server.port</span>=<span class="hljs-string">8009</span><br><span class="hljs-comment">#pool</span><br><span class="hljs-attr">spring.datasorce.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br><span class="hljs-attr">spring.datasource.driverClassName</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><br><span class="hljs-attr">mybatis.type-aliases-package</span>=<span class="hljs-string">com.dev.entity</span><br><span class="hljs-attr">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/mybatis-plus?useUnicode=true&amp;characterEncoding=UTF-8</span><br><span class="hljs-attr">spring.datasource.username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-string">123456</span><br><span class="hljs-comment">#å…³é—­é©¼å³°å‘½å</span><br><span class="hljs-attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="hljs-string">false</span><br><span class="hljs-attr">logging.level.com.dev.mapper</span>=<span class="hljs-string">debug</span><br><span class="hljs-comment"># Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰</span><br><span class="hljs-attr">spring.redis.database</span>=<span class="hljs-string">0</span><br><span class="hljs-comment"># RedisæœåŠ¡å™¨åœ°å€</span><br><span class="hljs-attr">spring.redis.host</span>=<span class="hljs-string">127.0.0.1</span><br><span class="hljs-comment"># RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span><br><span class="hljs-attr">spring.redis.port</span>=<span class="hljs-string">6379</span><br><span class="hljs-comment"># RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰</span><br><span class="hljs-attr">spring.redis.password</span>=<span class="hljs-string"></span><br><span class="hljs-comment"># è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span><br><span class="hljs-attr">spring.redis.jedis.pool.max-active</span>=<span class="hljs-string">20</span><br><span class="hljs-comment"># è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span><br><span class="hljs-attr">spring.redis.jedis.pool.max-wait</span>=<span class="hljs-string">-1</span><br><span class="hljs-comment"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span><br><span class="hljs-attr">spring.redis.jedis.pool.max-idle</span>=<span class="hljs-string">10</span><br><span class="hljs-comment"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span><br><span class="hljs-attr">spring.redis.jedis.pool.min-idle</span>=<span class="hljs-string">0</span><br><span class="hljs-comment"># è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span><br><span class="hljs-attr">spring.redis.timeout</span>=<span class="hljs-string">1000</span><br></code></pre></td></tr></table></figure><h2 id="5-æ·»åŠ Redisåºåˆ—åŒ–é…ç½®ç±»"><a href="#5-æ·»åŠ Redisåºåˆ—åŒ–é…ç½®ç±»" class="headerlink" title="5.æ·»åŠ Redisåºåˆ—åŒ–é…ç½®ç±»"></a>5.æ·»åŠ Redisåºåˆ—åŒ–é…ç½®ç±»</h2><p>RedisTemplate é»˜è®¤ä½¿ç”¨JDKçš„åºåˆ—åŒ–æœºåˆ¶, å­˜å‚¨äºŒè¿›åˆ¶å­—èŠ‚ç , æ‰€ä»¥è‡ªå®šä¹‰åºåˆ—åŒ–ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">5</span><br>\*/<br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableCaching</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> &#123;<br><span class="hljs-comment">//è¯»å–é»˜è®¤çš„application.propertiesæ–‡ä»¶çš„redisçš„é…ç½®å‚æ•°</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="hljs-title function_">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;<br><span class="hljs-comment">//è®¾ç½®åºåˆ—åŒ–</span><br><span class="hljs-comment">//ä½¿ç”¨Jackson2JsonRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„valueå€¼ï¼ˆé»˜è®¤ä½¿ç”¨JDKçš„åºåˆ—åŒ–æ–¹å¼ï¼‰</span><br><span class="hljs-type">Jackson2JsonRedisSerializer</span> <span class="hljs-variable">jackson2JsonRedisSerializer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonRedisSerializer</span>(Object.class);<br><span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">om</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br><span class="hljs-comment">//æŒ‡å®šè¦åºåˆ—åŒ–çš„åŸŸï¼Œfield,getå’Œset,ä»¥åŠä¿®é¥°ç¬¦èŒƒå›´ï¼ŒANYæ˜¯éƒ½æœ‰åŒ…æ‹¬privateå’Œpublic</span><br>om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);<br>om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON\_FINAL);<br>jackson2JsonRedisSerializer.setObjectMapper(om);<br><span class="hljs-comment">//é…ç½®redisTemplate</span><br>RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>&lt;&gt;();<br><span class="hljs-comment">// é…ç½®è¿æ¥å·¥å‚</span><br>redisTemplate.setConnectionFactory(redisConnectionFactory);<br><span class="hljs-type">RedisSerializer</span> <span class="hljs-variable">stringSerializer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>();<br>redisTemplate.setKeySerializer(stringSerializer);<span class="hljs-comment">//keyåºåˆ—åŒ–</span><br>redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);<span class="hljs-comment">//valueåºåˆ—åŒ–</span><br>redisTemplate.setHashKeySerializer(stringSerializer);<span class="hljs-comment">//Hash keyåºåˆ—åŒ–</span><br>redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);<span class="hljs-comment">//Hash valueåºåˆ—åŒ–</span><br>redisTemplate.afterPropertiesSet();<br><span class="hljs-keyword">return</span> redisTemplate;<br>&#125;<br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> CacheManager <span class="hljs-title function_">cacheManager</span><span class="hljs-params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;<br>RedisCacheManager.<span class="hljs-type">RedisCacheManagerBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> RedisCacheManager<br>.RedisCacheManagerBuilder<br>.fromConnectionFactory(redisConnectionFactory);<br><span class="hljs-keyword">return</span> builder.build();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="6-ä½¿ç”¨æ¼”ç¤º"><a href="#6-ä½¿ç”¨æ¼”ç¤º" class="headerlink" title="6.ä½¿ç”¨æ¼”ç¤º"></a>6.ä½¿ç”¨æ¼”ç¤º</h2><p>åŸºäºç¼“å­˜æ›´æ–°ç­–ç•¥ï¼Œæˆ‘ä»¬ä»ä¸‰ä¸ªç»´åº¦æµ‹è¯•Redisçš„å¤±æ•ˆï¼Œå‘½ä¸­å’Œæ›´æ–°</p><p>service.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Service<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">5</span><br>\*/<br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> UserMapper userDao;<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><span class="hljs-comment">//æŸ¥æ‰€æœ‰ç”¨æˆ·</span><br><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">queryAll</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">return</span> userDao.queryAll();<br>&#125;<br>/\*\*<br>\* è·å–ç”¨æˆ·ç­–ç•¥:å…ˆä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·ï¼Œæ²¡æœ‰åˆ™è¯»mysqlæ•°æ®ï¼Œå†å°†æ•°æ®å†™å…¥ç¼“å­˜<br>\*/<br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">findUserById</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span>&#123;<br><span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;user\_&quot;</span>+id;<br>ValueOperations&lt;String,User&gt; operations = redisTemplate.opsForValue();<br><span class="hljs-comment">//åˆ¤æ–­redisä¸­æ˜¯å¦æœ‰é”®ä¸ºkeyçš„ç¼“å­˜</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">hasKey</span> <span class="hljs-operator">=</span> redisTemplate.hasKey(key);<br><span class="hljs-keyword">if</span>(hasKey)&#123;<br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> operations.get(key);<br>System.out.println(<span class="hljs-string">&quot;ä»ç¼“å­˜ä¸­è·å–æ•°æ®:&quot;</span>+user.getUserName());<br>System.out.println(<span class="hljs-string">&quot;-----------------------------&quot;</span>);<br><span class="hljs-keyword">return</span> user;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userDao.findUserById(id);<br><span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>)&#123;<br>System.out.println(<span class="hljs-string">&quot;æŸ¥è¯¢æ•°æ®åº“è·å–æ•°æ®:&quot;</span>+user.getUserName());<br>System.out.println(<span class="hljs-string">&quot;------------å†™å…¥ç¼“å­˜---------------------&quot;</span>);<br><span class="hljs-comment">//å†™å…¥ç¼“å­˜</span><br>operations.set(key,user,<span class="hljs-number">5</span>, TimeUnit.HOURS);<br><span class="hljs-keyword">return</span> user;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br>&#125;<br><span class="hljs-comment">//åˆ é™¤ç”¨æˆ·ç­–ç•¥:åˆ é™¤æ•°æ®è¡¨ä¸­æ•°æ®ï¼Œç„¶ååˆ é™¤ç¼“å­˜</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">deleteUserById</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span>&#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> userDao.deleteUserById(id);<br><span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;user\_&quot;</span>+id;<br><span class="hljs-keyword">if</span>(result!=<span class="hljs-number">0</span>)&#123;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">hasKey</span> <span class="hljs-operator">=</span> redisTemplate.hasKey(key);<br><span class="hljs-keyword">if</span>(hasKey)&#123;<br>redisTemplate.delete(key);<br>System.out.println(<span class="hljs-string">&quot;åˆ é™¤äº†ç¼“å­˜ä¸­çš„key:&quot;</span>+key);<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> result;<br>&#125;<br>/\*\*<br>\* æ›´æ–°ç”¨æˆ·ç­–ç•¥ï¼šå…ˆæ›´æ–°æ•°æ®è¡¨ï¼ŒæˆåŠŸä¹‹åï¼Œåˆ é™¤åŸæ¥çš„ç¼“å­˜ï¼Œå†æ›´æ–°ç¼“å­˜<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(User user)</span> &#123;<br>ValueOperations&lt;String, User&gt; operations = redisTemplate.opsForValue();<br><span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> userDao.updateUser(user);<br><span class="hljs-keyword">if</span> (result != <span class="hljs-number">0</span>) &#123;<br><span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;user\_&quot;</span> + user.getId();<br><span class="hljs-type">boolean</span> <span class="hljs-variable">haskey</span> <span class="hljs-operator">=</span> redisTemplate.hasKey(key);<br><span class="hljs-keyword">if</span> (haskey) &#123;<br>redisTemplate.delete(key);<br>System.out.println(<span class="hljs-string">&quot;åˆ é™¤ç¼“å­˜ä¸­çš„key-----------&gt; &quot;</span> + key);<br>&#125;<br><span class="hljs-comment">// å†å°†æ›´æ–°åçš„æ•°æ®åŠ å…¥ç¼“å­˜</span><br><span class="hljs-type">User</span> <span class="hljs-variable">userNew</span> <span class="hljs-operator">=</span> userDao.findUserById(user.getId());<br><span class="hljs-keyword">if</span> (userNew != <span class="hljs-literal">null</span>) &#123;<br>operations.set(key, userNew, <span class="hljs-number">3</span>, TimeUnit.HOURS);<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> result;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬æˆ‘ç”¨å°è£…çš„RedisTemplateç±»å»æ“ä½œç¼“å­˜ï¼Œå…¶ä¸­è®¾ç½®ç¼“å­˜ï¼Œæ›´æ–°ç¼“å­˜ï¼Œåˆ é™¤ç¼“å­˜çš„æ“ä½œåœ¨ä¸Šé¢ä»£ç ä¸­æœ‰è¯¦ç»†æ³¨é‡Šï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šå‚æ•°ã€‚</p><p><a href="https://imgchr.com/i/s4soLQ"><img src="https://s3.ax1x.com/2021/01/21/s4soLQ.jpg"></a></p><p>åˆ©ç”¨Postmanæµ‹è¯•æ¥å£ï¼Œåœ¨æ§åˆ¶å°å³å¯çœ‹åˆ°ç¼“å­˜ç”Ÿæ•ˆï¼Œæµ‹è¯•æˆåŠŸï¼</p><h2 id="7-GitHubæºç "><a href="#7-GitHubæºç " class="headerlink" title="7.GitHubæºç "></a>7.GitHubæºç </h2><p><a href="https://github.com/luffy997/SpringBootBucket/tree/main/springboot-redis">springboot-redis</a></p><h2 id="8-æ€»ç»“"><a href="#8-æ€»ç»“" class="headerlink" title="8.æ€»ç»“"></a>8.æ€»ç»“</h2><p>Redisçš„ç”¨é€”è¿œä¸åŠåšç¼“å­˜ï¼Œè¿˜å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ã€ç®€å•çš„mqå’Œæ­å»ºé«˜æ€§èƒ½é›†ç¾¤ç­‰ç­‰ï¼Œè¿™é‡Œåªæ˜¯ç®€å•çš„è®²SpringBootå¦‚ä½•é›†æˆRedisï¼Œä½¿å¾—ç¼“å­˜ç”Ÿæ•ˆï¼åé¢æˆ‘è¿˜ä¼šè¯¦ç»†è®²Redisçš„åº”ç”¨ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootä¹‹é›†æˆSwagger2</title>
    <link href="/2021/01/21/SpringBoot%E4%B9%8B%E9%9B%86%E6%88%90Swagger2/"/>
    <url>/2021/01/21/SpringBoot%E4%B9%8B%E9%9B%86%E6%88%90Swagger2/</url>
    
    <content type="html"><![CDATA[<h2 id="SpringBootä¹‹é›†æˆSwagger2"><a href="#SpringBootä¹‹é›†æˆSwagger2" class="headerlink" title="SpringBootä¹‹é›†æˆSwagger2"></a>SpringBootä¹‹é›†æˆSwagger2</h2><p>Swaggeræ˜¯ä¸€ä¸ªç®€å•ä½†åŠŸèƒ½å¼ºå¤§çš„APIè¡¨è¾¾å·¥å…·ã€‚å®ƒå…·æœ‰åœ°çƒä¸Šæœ€å¤§çš„APIå·¥å…·ç”Ÿæ€ç³»ç»Ÿï¼Œæ•°ä»¥åƒè®¡çš„å¼€å‘äººå‘˜ï¼Œ ä½¿ç”¨å‡ ä¹æ‰€æœ‰çš„ç°ä»£ç¼–ç¨‹è¯­è¨€ï¼Œéƒ½åœ¨æ”¯æŒå’Œä½¿ç”¨Swaggerã€‚ä½¿ç”¨Swaggerç”ŸæˆAPIï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°äº¤äº’å¼æ–‡æ¡£ï¼Œ è‡ªåŠ¨ç”Ÿæˆä»£ç çš„SDKä»¥åŠAPIçš„å‘ç°ç‰¹æ€§ç­‰ã€‚</p><p>Swagger2å¯ä»¥åˆ©ç”¨æ³¨è§£å¿«é€Ÿã€è‡ªåŠ¨åœ°ç”Ÿæˆæ¥å£æ–‡æ¡£é¡µé¢ï¼Œåœ¨å‰åç«¯åˆ†ç¦»å¼€å‘ä¸­èµ·ç€é‡è¦ä½œç”¨ï¼Œæ–¹ä¾¿æ¥å£æµ‹è¯•å’Œè°ƒç”¨ï¼</p><p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p><p>è®¿é—®URLï¼š</p><p><a href="http://127.0.0.1:8010/swagger-ui.htm">http://127.0.0.1:8010/swagger-ui.htm</a></p><p><a href="https://imgchr.com/i/shy45q"><img src="https://s3.ax1x.com/2021/01/21/shy45q.md.jpg"></a></p><p><a href="https://imgchr.com/i/sh6MQS"><img src="https://s3.ax1x.com/2021/01/21/sh6MQS.jpg"></a></p><p>å¯ä»¥çœ‹åˆ°APIæ ¹æ®åç«¯Controlleråˆ†ç±»ï¼Œæ¯ä¸ªAPIéƒ½å¸¦æœ‰æ³¨é‡Šï¼Œè¯¦ç»†æ³¨é‡Šäº†å‚æ•°å’Œå“åº”ä½“çš„å†…å®¹ï¼Œåç«¯è®¾è®¡åŸºäºRESTfulé£æ ¼çš„APIï¼ˆä¹‹å‰å·²ç»è®²åˆ°ï¼‰ï¼Œå¼€å‘æ•ˆç‡æ˜¯æ æ çš„ã€‚</p><h2 id="1-æ„å»ºRESTful-API"><a href="#1-æ„å»ºRESTful-API" class="headerlink" title="1.æ„å»ºRESTful API"></a>1.æ„å»ºRESTful API</h2><p>åœ¨ä½¿ç”¨Swagger2å‰æˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªRESTful APIçš„é¡¹ç›®ï¼ŒSpringBootåˆ›å»ºRESTful APIé¡¹ç›®éå¸¸çš„æ–¹ä¾¿å’Œå¿«é€Ÿã€‚</p><p>SpringBootæ„å»ºRESTful APIæä¸ºç®€å•ï¼Œå®é™…å°±æ˜¯Spring MVCã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* &lt;p&gt;<br>\* å‰ç«¯æ§åˆ¶å™¨<br>\* &lt;/p&gt;<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@since</span> <span class="hljs-number">2021</span>-<span class="hljs-number">01</span>-<span class="hljs-number">21</span><br>\*/<br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/goods&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodsController</span> &#123;<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> GoodsService goodsService;<br><span class="hljs-meta">@ApiOperation(&quot;åˆ—è¡¨æ˜¾ç¤º&quot;)</span><br><span class="hljs-meta">@GetMapping(&quot;/&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;List&lt;Goods&gt;&gt; <span class="hljs-title function_">showGoodsList</span><span class="hljs-params">()</span>&#123;<br>List&lt;Goods&gt; list = goodsService.list(<span class="hljs-literal">null</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;æŸ¥è¯¢æˆåŠŸ&quot;</span>,list);<br>&#125;<br><span class="hljs-meta">@ApiOperation(&quot;æŸ¥è¯¢å•†å“&quot;)</span><br><span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;Goods&gt; <span class="hljs-title function_">selGood</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span>&#123;<br><span class="hljs-type">Goods</span> <span class="hljs-variable">goods</span> <span class="hljs-operator">=</span> goodsService.getById(id);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;æŸ¥è¯¢æˆåŠŸ&quot;</span>,goods);<br>&#125;<br><span class="hljs-meta">@ApiOperation(&quot;æ–°å¢å•†å“&quot;)</span><br><span class="hljs-meta">@PostMapping(&quot;/&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;Integer&gt; <span class="hljs-title function_">insGood</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Goods goods)</span>&#123;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">save</span> <span class="hljs-operator">=</span> goodsService.save(goods);<br><span class="hljs-keyword">if</span>(save == <span class="hljs-literal">true</span>)&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;æ·»åŠ æˆåŠŸ&quot;</span>,<span class="hljs-number">200</span>);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;æ·»åŠ å¤±è´¥&quot;</span>,<span class="hljs-number">500</span>);<br>&#125;<br>&#125;<br><span class="hljs-meta">@ApiOperation(&quot;ä¿®æ”¹å•†å“ä¿¡æ¯&quot;)</span><br><span class="hljs-meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;Integer&gt; <span class="hljs-title function_">updGood</span><span class="hljs-params">(<span class="hljs-meta">@ModelAttribute</span> Goods goods)</span>&#123;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">update</span> <span class="hljs-operator">=</span> goodsService.updateById(goods);<br><span class="hljs-keyword">if</span>(update == <span class="hljs-literal">true</span>)&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;ä¿®æ”¹æˆåŠŸ&quot;</span>,<span class="hljs-number">200</span>);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;ä¿®æ”¹å¤±è´¥&quot;</span>,<span class="hljs-number">500</span>);<br>&#125;<br>&#125;<br><span class="hljs-meta">@ApiOperation(&quot;åˆ é™¤å•†å“&quot;)</span><br><span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;Integer&gt; <span class="hljs-title function_">delGood</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span>&#123;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">delete</span> <span class="hljs-operator">=</span> goodsService.removeById(id);<br><span class="hljs-keyword">if</span>(delete == <span class="hljs-literal">true</span>)&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;ä¿®æ”¹æˆåŠŸ&quot;</span>,<span class="hljs-number">200</span>);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;ä¿®æ”¹å¤±è´¥&quot;</span>,<span class="hljs-number">500</span>);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œè¯¦ç»†è®²ä¸‹Swgger2ç¯å¢ƒçš„æ­å»ºå’Œå¸¸ç”¨æ³¨è§£åŠŸèƒ½</p><h2 id="2-é¡¹ç›®ä¾èµ–"><a href="#2-é¡¹ç›®ä¾èµ–" class="headerlink" title="2.é¡¹ç›®ä¾èµ–"></a>2.é¡¹ç›®ä¾èµ–</h2><p>mavenä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--swagger--&gt;</span><br><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.swagger<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>swagger-annotations<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.swagger<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>swagger-models<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--MySQL JDBCé©±åŠ¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--Druid--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--mybatis-plus--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.velocity<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>velocity-engine-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>è¿™é‡Œåˆ†äº«ä¸ªè‡ªå·±è¸©è¿‡çš„å‘:</strong></p><p>æŸ¥é˜…å®˜ç½‘ï¼Œå¯ä»¥çœ‹åˆ°Swagger2ä¾èµ–å¹¶æ²¡æœ‰è¿™ä¹ˆå¤šï¼Œä½†æˆ‘åœ¨ä¸€æ¬¡ä½¿ç”¨RESTful å¼€å‘APIï¼Œåˆ©ç”¨Swaggerç”Ÿæˆæ¥å£æ–‡æ¡£æ—¶ï¼Œå‘ç”ŸæŠ¥é”™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">java.lang.NumberFormatException: For input string: <span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>åªè¦æµè§ˆå™¨ä¸­ä¸€è®¿é—®Swaggeræ¥å£æ–‡æ¡£ï¼Œå°±ä¼šå‘ç”Ÿè¿™ä¸ªæŠ¥é”™ï¼Œå¯ä»¥çœ‹åˆ°å°±æ˜¯ç©ºå­—ç¬¦ä¸²æ— æ³•è‡ªåŠ¨è½¬æ¢æˆæ•°å­—ç±»å‹é€ æˆçš„ï¼ŒåŸå› å¾ˆç®€å•ï¼Œè¯·æ±‚Swaggerçš„é¡µé¢å°±å‘é€äº†ç©ºçš„å­—ç¬¦ä¸²å‚æ•°ï¼Œä½†{id}éœ€è¦intï¼Œæ•…å‘ç”ŸæŠ¥é”™ã€‚</p><p>åˆ†æå’Œè§£å†³ï¼š</p><p><code>io.springfox:springfox-swagger2:2.9.2</code>ä¸­ä¾èµ–äº†<code>swagger-models</code>çš„<strong>1.5.20</strong>ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥æ’é™¤<code>springfox-swagger2</code>ä¸­çš„<code>swagger-models</code>ä¾èµ–ï¼Œå¯¼å…¥<code>io.swagger:swagger-models</code>çš„<strong>1.5.21</strong>ç‰ˆæœ¬å³å¯ã€‚</p><p><a href="https://imgchr.com/i/shWG8I"><img src="https://s3.ax1x.com/2021/01/21/shWG8I.md.jpg"></a></p><p>æ•…æ˜ å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--swagger--&gt;</span><br><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.swagger<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>swagger-annotations<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å…¶æ¬¡ï¼Œå¼•å…¥MybatiesPlusç®€åŒ–æ“ä½œï¼Œåˆ›å»ºå’Œé…ç½®å¥½æ•°æ®åº“ï¼Œå¯åŠ¨DevGenerator.javaï¼Œè‡ªåŠ¨ç”Ÿæˆåç«¯åŸºç¡€ç¯å¢ƒã€‚</p><h2 id="3-ç¼–å†™Swaggeré…ç½®ç±»"><a href="#3-ç¼–å†™Swaggeré…ç½®ç±»" class="headerlink" title="3.ç¼–å†™Swaggeré…ç½®ç±»"></a>3.ç¼–å†™Swaggeré…ç½®ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableSwagger2</span><br>/\*\*<br>\* Swaggeré…ç½®<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">5</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwaggerConfig</span> &#123;<br>/\*\*<br>\* æ˜¯å¦å¯ç”¨swaggeræ–‡æ¡£<br>\*/<br><span class="hljs-meta">@Value(&quot;$&#123;swagger.enable&#125;&quot;)</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> enable;<br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">docket</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER\_2)<br>.enable(enable)<br>.apiInfo(apiInfo())<br>.select()<br>.apis(RequestHandlerSelectors.withClassAnnotation(RestController.class))<br>.build();<br>&#125;<br><span class="hljs-comment">//é…ç½®swagger ä¿¡æ¯ = apiInfo</span><br><span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">apiInfo</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">//ä½œè€…ä¿¡æ¯</span><br><span class="hljs-type">Contact</span> <span class="hljs-variable">contact</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Contact</span>(<span class="hljs-string">&quot;æ¥å£æ–‡æ¡£&quot;</span>, <span class="hljs-string">&quot;https://github.com/luffy997&quot;</span>, <span class="hljs-string">&quot;389783961@qq.com&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfo</span>(<span class="hljs-string">&quot;æ¥å£æ–‡æ¡£&quot;</span>,<br><span class="hljs-string">&quot;æ¥å£æ–‡æ¡£&quot;</span>,<br><span class="hljs-string">&quot;v1.0&quot;</span>,<br><span class="hljs-string">&quot;www.baidu.com&quot;</span>, contact,<br><span class="hljs-string">&quot;Appache2.0&quot;</span>,<br><span class="hljs-string">&quot;http://www.appache.org/licenses/LICENSE-2.0&quot;</span>,<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;());<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Swagger2æä¾›äº†ä¸€äº›æ³¨è§£æ¥ä¸°å¯Œæ¥å£çš„ä¿¡æ¯,å¸¸ç”¨çš„æœ‰:</p><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>@Apiï¼šç”¨åœ¨ç±»ä¸Šï¼Œè¯´æ˜è¯¥ç±»çš„ä½œç”¨</li><li>@ApiOperationï¼šç”¨åœ¨æ–¹æ³•ä¸Šï¼Œè¯´æ˜æ–¹æ³•çš„ä½œç”¨</li><li>@ApiImplicitParamsï¼šç”¨åœ¨æ–¹æ³•ä¸ŠåŒ…å«ä¸€ç»„å‚æ•°è¯´æ˜</li><li>@ApiImplicitParamï¼šç”¨åœ¨@ApiImplicitParamsæ³¨è§£ä¸­ï¼ŒæŒ‡å®šä¸€ä¸ªè¯·æ±‚å‚æ•°çš„å„ä¸ªæ–¹é¢<ul><li>paramTypeï¼šå‚æ•°æ”¾åœ¨å“ªä¸ªåœ°æ–¹<ul><li>headerâ€“&gt;è¯·æ±‚å‚æ•°çš„è·å–ï¼š@RequestHeader</li><li>queryâ€“&gt;è¯·æ±‚å‚æ•°çš„è·å–ï¼š@RequestParam</li><li>pathï¼ˆç”¨äºrestfulæ¥å£ï¼‰â€“&gt;è¯·æ±‚å‚æ•°çš„è·å–ï¼š@PathVariable</li><li>bodyï¼ˆä¸å¸¸ç”¨ï¼‰</li><li>formï¼ˆä¸å¸¸ç”¨ï¼‰</li></ul></li><li>nameï¼šå‚æ•°å</li><li>dataTypeï¼šå‚æ•°ç±»å‹</li><li>requiredï¼šå‚æ•°æ˜¯å¦å¿…é¡»ä¼ </li><li>valueï¼šå‚æ•°çš„æ„æ€</li><li>defaultValueï¼šå‚æ•°çš„é»˜è®¤å€¼</li></ul></li><li>@ApiResponsesï¼šç”¨äºè¡¨ç¤ºä¸€ç»„å“åº”</li><li>@ApiResponseï¼šç”¨åœ¨@ApiResponsesä¸­ï¼Œä¸€èˆ¬ç”¨äºè¡¨è¾¾ä¸€ä¸ªé”™è¯¯çš„å“åº”ä¿¡æ¯<ul><li>codeï¼šæ•°å­—ï¼Œä¾‹å¦‚400</li><li>messageï¼šä¿¡æ¯ï¼Œä¾‹å¦‚â€è¯·æ±‚å‚æ•°æ²¡å¡«å¥½â€</li><li>responseï¼šæŠ›å‡ºå¼‚å¸¸çš„ç±»</li></ul></li><li>@ApiModelï¼šæè¿°ä¸€ä¸ªModelçš„ä¿¡æ¯ï¼ˆè¿™ç§ä¸€èˆ¬ç”¨åœ¨poståˆ›å»ºçš„æ—¶å€™ï¼Œä½¿ç”¨@RequestBodyè¿™æ ·çš„åœºæ™¯ï¼Œè¯·æ±‚å‚æ•°æ— æ³•ä½¿ç”¨@ApiImplicitParamæ³¨è§£è¿›è¡Œæè¿°çš„æ—¶å€™ï¼‰</li><li>@ApiModelPropertyï¼šæè¿°ä¸€ä¸ªmodelçš„å±æ€§</li></ul><p>ä»¥ä¸Šè¿™äº›å°±æ˜¯æœ€å¸¸ç”¨çš„å‡ ä¸ªæ³¨è§£äº†ã€‚</p><p>å…·ä½“å…¶ä»–çš„æ³¨è§£ï¼ŒæŸ¥çœ‹ï¼š</p><p><a href="https://github.com/swagger-api/swagger-core/wiki/Annotations#apimodel">https://github.com/swagger-api/swagger-core/wiki/Annotations#apimodel</a></p><p>æ›´å¤šè¯·å‚è€ƒ<a href="http://docs.swagger.io/swagger-core/apidocs/com/wordnik/swagger/annotations/package-summary.html">Swaggeræ³¨è§£æ–‡æ¡£</a></p><h2 id="4-å‚è€ƒæ–‡æ¡£"><a href="#4-å‚è€ƒæ–‡æ¡£" class="headerlink" title="4.å‚è€ƒæ–‡æ¡£"></a>4.å‚è€ƒæ–‡æ¡£</h2><ul><li><p><a href="https://www.xncoding.com/2017/07/08/spring/sb-swagger2.html">SpringBootç³»åˆ— - é›†æˆSwagger2</a></p></li><li><p><a href="https://github.com/Yuicon/blog/issues/1">Spring Bootä¸­ä½¿ç”¨Swagger2æ„å»ºAPIæ–‡æ¡£</a></p><p>â€‹</p></li></ul><h2 id="5-GitHubæºç "><a href="#5-GitHubæºç " class="headerlink" title="5.GitHubæºç "></a>5.GitHubæºç </h2><p><a href="https://github.com/luffy997/SpringBootBucket/tree/main/springboot-swagger">springboot-swagger</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootä¹‹å®ç°RESTfulæ¥å£</title>
    <link href="/2021/01/20/SpringBoot%E4%B9%8B%E5%AE%9E%E7%8E%B0RESTful%E6%8E%A5%E5%8F%A3/"/>
    <url>/2021/01/20/SpringBoot%E4%B9%8B%E5%AE%9E%E7%8E%B0RESTful%E6%8E%A5%E5%8F%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringBootä¹‹å®ç°RESTfulæ¥å£"><a href="#SpringBootä¹‹å®ç°RESTfulæ¥å£" class="headerlink" title="SpringBootä¹‹å®ç°RESTfulæ¥å£"></a>SpringBootä¹‹å®ç°RESTfulæ¥å£</h1><p>RESTï¼Œå³Representational State Transferçš„ç¼©å†™ï¼Œå¯¹è¿™ä¸ªè¯ç»„çš„ç¿»è¯‘æ˜¯<code>è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–</code>ã€‚</p><p>RESTfulæ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡é£æ ¼ï¼Œå°±æ˜¯ç›®å‰æœ€æµè¡Œçš„ä¸€ç§äº’è”ç½‘è½¯ä»¶æ¶æ„ã€‚å®ƒç»“æ„æ¸…æ™°ã€ç¬¦åˆæ ‡å‡†ã€æ˜“äºç†è§£ã€æ‰©å±•æ–¹ä¾¿ï¼Œæ‰€ä»¥æ­£å¾—åˆ°è¶Šæ¥è¶Šå¤šç½‘ç«™çš„é‡‡ç”¨ã€‚</p><p>SpringMVCå¯¹RESTfulé£æ ¼çš„æ¥å£æœ‰ç€å¤©ç„¶çš„æ”¯æŒï¼Œæœ¬ç¯‡å°†è®²è¿°å¦‚ä½•åœ¨SpringBootä¸­æ€æ ·å†™ã€‚</p><h2 id="1-é‡è¦æ³¨è§£"><a href="#1-é‡è¦æ³¨è§£" class="headerlink" title="1.é‡è¦æ³¨è§£"></a>1.é‡è¦æ³¨è§£</h2><p>åœ¨è®²è¿°ä½¿ç”¨ä¹‹å‰ï¼Œæƒ³è¦ç†è§£SpringMVCçš„å‡ ä¸ªå¸¸ç”¨æ³¨è§£ï¼š</p><ol><li>@Controllerï¼šä¿®é¥°classï¼Œç”¨æ¥åˆ›å»ºå¤„ç†httpè¯·æ±‚çš„å¯¹è±¡</li><li>@RestControllerï¼šSpring4ä¹‹ååŠ å…¥çš„æ³¨è§£ï¼ŒåŸæ¥åœ¨@Controllerä¸­è¿”å›jsonéœ€è¦@ResponseBodyæ¥é…åˆï¼Œå¦‚æœç›´æ¥ç”¨@RestControlleræ›¿ä»£@Controllerå°±ä¸éœ€è¦å†é…ç½®@ResponseBodyï¼Œé»˜è®¤è¿”å›jsonæ ¼å¼ã€‚</li><li>@RequestMappingï¼šé…ç½®urlæ˜ å°„</li><li>@PostMapping: è¿™ä¸ªæ˜¯@RequestMapping+POSTæ–¹æ³•çš„ç®€å†™</li><li>@RequestHeader: è¯·æ±‚Headerå‚æ•°</li><li>@PathVariable: URLè·¯å¾„å‚æ•°ï¼Œæ¯”å¦‚&#x2F;user&#x2F;{id}ä¸­çš„idå‚æ•°</li><li>@RequestParam: URLè¯·æ±‚å‚æ•°ï¼Œæ¯”å¦‚&#x2F;user?id&#x3D;1ä¸­çš„idå‚æ•°</li><li>@RequestBody: è¯·æ±‚Bodyå‚æ•°</li></ol><p>ä¸‹é¢æˆ‘ä»¬å°è¯•ä½¿ç”¨Spring MVCæ¥å®ç°ä¸€ç»„å¯¹Userå¯¹è±¡æ“ä½œçš„RESTful APIï¼Œé…åˆæ³¨é‡Šè¯¦ç»†è¯´æ˜åœ¨Spring MVCä¸­å¦‚ä½•æ˜ å°„HTTPè¯·æ±‚ã€å¦‚ä½•ä¼ å‚ã€å¦‚ä½•ç¼–å†™å•å…ƒæµ‹è¯•ã€‚</p><h2 id="2-APIè®¾è®¡"><a href="#2-APIè®¾è®¡" class="headerlink" title="2.APIè®¾è®¡"></a>2.APIè®¾è®¡</h2><table><thead><tr><th>è¯·æ±‚ç±»å‹</th><th>URL</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>GET</td><td>&#x2F;uer&#x2F;</td><td>æŸ¥è¯¢å…¨éƒ¨</td></tr><tr><td>POST</td><td>&#x2F;uer</td><td>æ’å…¥æ•°æ®</td></tr><tr><td>GET</td><td>&#x2F;uer&#x2F;{id}</td><td>æ ¹æ®idæŸ¥è¯¢</td></tr><tr><td>PUT</td><td>&#x2F;uer&#x2F;{id}</td><td>æ ¹æ®idæ›´æ–°</td></tr><tr><td>DELETE</td><td>&#x2F;uer&#x2F;{id}</td><td>æ ¹æ®idåˆ é™¤</td></tr><tr><td>POST</td><td>&#x2F;user&#x2F;{id}</td><td>æµ‹è¯•ä¹è§‚é”</td></tr><tr><td>GET</td><td>&#x2F;user&#x2F;pageInfo&#x2F;{pageNo}</td><td>åˆ†é¡µæŸ¥è¯¢</td></tr></tbody></table><p>RESTfulæ¶æ„æœ‰ä¸€äº›å…¸å‹çš„è®¾è®¡è¯¯åŒºï¼Œå°±æ˜¯URIåŒ…å«åŠ¨è¯ã€‚å› ä¸ºâ€èµ„æºâ€è¡¨ç¤ºä¸€ç§å®ä½“ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯åè¯ï¼ŒURIä¸åº”è¯¥æœ‰åŠ¨è¯ï¼ŒåŠ¨è¯åº”è¯¥æ”¾åœ¨HTTPåè®®ä¸­ã€‚ ä¸Šé¢è®¾è®¡çš„APIçš„URIä¸­éƒ½æ˜¯åè¯ã€‚</p><h2 id="3-å®šä¹‰å®ä½“"><a href="#3-å®šä¹‰å®ä½“" class="headerlink" title="3.å®šä¹‰å®ä½“"></a>3.å®šä¹‰å®ä½“</h2><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨MybatisPlusçš„ä»£ç ç”Ÿæˆå™¨ï¼Œç®€åŒ–æ“ä½œï¼Œåªéœ€ç¼–å†™RESTfulé£æ ¼çš„API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* &lt;p&gt;<br>\*<br>\* &lt;/p&gt;<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@since</span> <span class="hljs-number">2021</span>-<span class="hljs-number">01</span>-<span class="hljs-number">05</span><br>\*/<br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@EqualsAndHashCode(callSuper = false)</span><br><span class="hljs-meta">@Accessors(chain = true)</span><br><span class="hljs-meta">@ApiModel(value = &quot;Users&quot;, description = &quot;Users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Users</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><span class="hljs-meta">@ApiModelProperty(value = &quot;ä¸»é”®ID&quot;)</span><br><span class="hljs-meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span><br><span class="hljs-keyword">private</span> Long id;<br><span class="hljs-meta">@ApiModelProperty(value = &quot;å§“å&quot;)</span><br><span class="hljs-keyword">private</span> String name;<br><span class="hljs-meta">@ApiModelProperty(value = &quot;å¹´é¾„&quot;)</span><br><span class="hljs-keyword">private</span> Integer age;<br><span class="hljs-meta">@ApiModelProperty(value = &quot;é‚®ç®±&quot;)</span><br><span class="hljs-keyword">private</span> String email;<br><span class="hljs-meta">@Version</span><br><span class="hljs-keyword">private</span> Integer version;<br><span class="hljs-meta">@ApiModelProperty(value = &quot;é€»è¾‘åˆ é™¤&quot;)</span><br><span class="hljs-meta">@TableLogic</span><br><span class="hljs-keyword">private</span> Integer deleted;<br><span class="hljs-meta">@ApiModelProperty(value = &quot;åˆ›å»ºæ—¶é—´&quot;)</span><br><span class="hljs-keyword">private</span> Date create\_time;<br><span class="hljs-meta">@ApiModelProperty(value = &quot;æ›´æ–°æ—¶é—´&quot;)</span><br><span class="hljs-keyword">private</span> Date update\_time;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-controllerçš„ç¼–å†™"><a href="#4-controllerçš„ç¼–å†™" class="headerlink" title="4.controllerçš„ç¼–å†™"></a>4.controllerçš„ç¼–å†™</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* &lt;p&gt;<br>\* å‰ç«¯æ§åˆ¶å™¨<br>\* &lt;/p&gt;<br>\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@since</span> <span class="hljs-number">2021</span>-<span class="hljs-number">01</span>-<span class="hljs-number">05</span><br>\*/<br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> UserService userService;<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> UserMapper userMapper;<br>/\*\*<br>\* æŸ¥è¯¢å…¨éƒ¨<br>\*<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@ApiOperation(&quot;æŸ¥è¯¢å…¨éƒ¨&quot;)</span><br><span class="hljs-meta">@GetMapping(&quot;/&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;List&lt;Users&gt;&gt; <span class="hljs-title function_">getAll</span><span class="hljs-params">()</span> &#123;<br>List&lt;Users&gt; list = userService.list(<span class="hljs-literal">null</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>, <span class="hljs-string">&quot;æŸ¥è¯¢æˆåŠŸ&quot;</span>, list);<br>&#125;<br>/\*\*<br>\* æ ¹æ®idæŸ¥<br>\*<br>\* <span class="hljs-meta">@param</span> id<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢&quot;)</span><br><span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;Users&gt; <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br><span class="hljs-type">Users</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getById(id);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>, <span class="hljs-string">&quot;æŸ¥è¯¢æˆåŠŸ&quot;</span>, user);<br>&#125;<br>/\*\*<br>\* æ ¹æ®idåˆ é™¤<br>\*<br>\* <span class="hljs-meta">@param</span> id<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@ApiOperation(&quot;æ ¹æ®idåˆ é™¤&quot;)</span><br><span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;String&gt; <span class="hljs-title function_">dellteUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>userService.removeById(id);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>, <span class="hljs-string">&quot;åˆ é™¤æˆåŠŸ&quot;</span>, <span class="hljs-string">&quot;200&quot;</span>);<br>&#125;<br>/\*\*<br>\* æ ¹æ®idæ›´æ–°<br>\*<br>\* <span class="hljs-meta">@param</span> id<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@ApiOperation(&quot;æ ¹æ®idæ›´æ–°&quot;)</span><br><span class="hljs-meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;String&gt; <span class="hljs-title function_">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id, <span class="hljs-meta">@ModelAttribute</span> Users user)</span> &#123;<br>userService.updateById(user);<br>log.info(<span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>, <span class="hljs-string">&quot;æ›´æ–°æˆåŠŸ&quot;</span>, <span class="hljs-string">&quot;200&quot;</span>);<br>&#125;<br>/\*\*<br>\* æ’å…¥æ•°æ®<br>\*<br>\* <span class="hljs-meta">@param</span> user<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@ApiOperation(&quot;æ’å…¥æ•°æ®&quot;)</span><br><span class="hljs-meta">@PostMapping(&quot;/&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;String&gt; <span class="hljs-title function_">insUser</span><span class="hljs-params">(<span class="hljs-meta">@ModelAttribute</span> Users user)</span> &#123;<br>userService.save(user);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>, <span class="hljs-string">&quot;æ’å…¥æˆåŠŸ&quot;</span>, <span class="hljs-string">&quot;200&quot;</span>);<br>&#125;<br>/\*\*<br>\* æµ‹è¯•ä¹è§‚é”<br>\*<br>\* <span class="hljs-meta">@param</span> id<br>\* <span class="hljs-meta">@param</span> user<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@ApiOperation(&quot;æµ‹è¯•ä¹è§‚é”&quot;)</span><br><span class="hljs-meta">@PostMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;Users&gt; <span class="hljs-title function_">insUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id, <span class="hljs-meta">@ModelAttribute</span> Users user)</span> &#123;<br><span class="hljs-comment">//å…ˆæ‹¿æ•°æ®ï¼Œå†æ›´æ–°ï¼Œä¹è§‚é”æ‰èµ·ä½œç”¨</span><br><span class="hljs-type">Users</span> <span class="hljs-variable">users</span> <span class="hljs-operator">=</span> userService.getById(id);<br>userService.updateById(user);<br><span class="hljs-type">Users</span> <span class="hljs-variable">userServiceById</span> <span class="hljs-operator">=</span> userService.getById(id);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>, <span class="hljs-string">&quot;æˆåŠŸ&quot;</span>, userServiceById);<br>&#125;<br>/\*\*<br>\* åˆ†é¡µæ˜¾ç¤º<br>\*<br>\* <span class="hljs-meta">@param</span> pageNo<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@ApiOperation(&quot;åˆ†é¡µæŸ¥è¯¢&quot;)</span><br><span class="hljs-meta">@GetMapping(&quot;/pageInfo/&#123;pageNo&#125;&quot;)</span><br><span class="hljs-keyword">public</span> BaseResponse&lt;List&lt;Users&gt;&gt; <span class="hljs-title function_">pageInfoUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-type">int</span> pageNo)</span> &#123;<br><span class="hljs-comment">//é»˜è®¤æ¯é¡µ5ä¸ª</span><br><span class="hljs-comment">// å‚æ•°ä¸€ï¼šå½“å‰é¡µ</span><br><span class="hljs-comment">// å‚æ•°äºŒï¼šé¡µé¢å¤§å°</span><br>Page&lt;Users&gt; page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(pageNo, <span class="hljs-number">5</span>);<br>userService.page(page, <span class="hljs-literal">null</span>);<br>List&lt;Users&gt; list = page.getRecords();<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>&lt;&gt;(<span class="hljs-literal">true</span>, <span class="hljs-string">&quot;æŸ¥è¯¢æˆåŠŸ&quot;</span>, list);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5-æµ‹è¯•"><a href="#5-æµ‹è¯•" class="headerlink" title="5.æµ‹è¯•"></a>5.æµ‹è¯•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringbootRestfulApplicationTests</span> &#123;<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> UserMapper userMapper;<br><span class="hljs-comment">// æµ‹è¯•æ’å…¥</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsert</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">Users</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Users</span>();<br>user.setName(<span class="hljs-string">&quot;Alen&quot;</span>);<br>user.setAge(<span class="hljs-number">3</span>);<br>user.setEmail(<span class="hljs-string">&quot;1234@qq.com&quot;</span>);<br><span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> userMapper.insert(user); <span class="hljs-comment">// å¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆid</span><br>System.out.println(result); <span class="hljs-comment">// å—å½±å“çš„è¡Œæ•°</span><br>System.out.println(user); <span class="hljs-comment">// å‘ç°ï¼Œidä¼šè‡ªåŠ¨å›å¡«</span><br>&#125;<br><span class="hljs-comment">//æµ‹è¯•ä¹è§‚é”</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testversion</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">Users</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.selectById(<span class="hljs-number">1L</span>);<br><span class="hljs-comment">//ä¿®æ”¹</span><br>user.setName(<span class="hljs-string">&quot;æœ€å¼ºçš„&quot;</span>);<br>user.setAge(<span class="hljs-number">11</span>);<br><span class="hljs-comment">//æ›´æ–°</span><br>userMapper.updateById(user);<br>&#125;<br><span class="hljs-comment">// æµ‹è¯•ä¹è§‚é”å¤±è´¥ï¼å¤šçº¿ç¨‹ä¸‹</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testOptimisticLocker2</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">// çº¿ç¨‹ 1</span><br><span class="hljs-type">Users</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.selectById(<span class="hljs-number">1L</span>);<br>user.setName(<span class="hljs-string">&quot;Luffy11111&quot;</span>);<br>user.setEmail(<span class="hljs-string">&quot;134@qq.com&quot;</span>);<br><span class="hljs-comment">// æ¨¡æ‹Ÿå¦å¤–ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº†æ’é˜Ÿæ“ä½œ</span><br><span class="hljs-type">Users</span> <span class="hljs-variable">user2</span> <span class="hljs-operator">=</span> userMapper.selectById(<span class="hljs-number">1L</span>);<br>user2.setName(<span class="hljs-string">&quot;Luffy22222&quot;</span>);<br>user2.setEmail(<span class="hljs-string">&quot;134@qq.com&quot;</span>);<br>userMapper.updateById(user2);<br><span class="hljs-comment">// è‡ªæ—‹é”æ¥å¤šæ¬¡å°è¯•æäº¤ï¼</span><br>userMapper.updateById(user); <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ä¹è§‚é”å°±ä¼šè¦†ç›–æ’é˜Ÿçº¿ç¨‹çš„å€¼ï¼</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨Postmanæµ‹è¯•Postï¼ŒDeleteï¼ŒPutç±»å‹çš„æ¥å£ï¼Œæµ‹è¯•æˆåŠŸï¼</p><h2 id="6-GitHubæºç "><a href="#6-GitHubæºç " class="headerlink" title="6.GitHubæºç "></a>6.GitHubæºç </h2><p><a href="https://github.com/luffy997/SpringBootBucket/tree/main/springboot-restful">springboot-restful</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBooté›†æˆMybatisçš„ä½¿ç”¨</title>
    <link href="/2021/01/12/SpringBoot%E9%9B%86%E6%88%90Mybatis%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/01/12/SpringBoot%E9%9B%86%E6%88%90Mybatis%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringBooté›†æˆMybatisçš„ä½¿ç”¨"><a href="#SpringBooté›†æˆMybatisçš„ä½¿ç”¨" class="headerlink" title="SpringBooté›†æˆMybatisçš„ä½¿ç”¨"></a>SpringBooté›†æˆMybatisçš„ä½¿ç”¨</h1><p><img src="https://s3.ax1x.com/2021/01/23/s7Z8xK.png"></p><p>MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ”¯æŒå®šåˆ¶åŒ– SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚ MyBatis å¯ä»¥ä½¿ç”¨ç®€å•çš„ <strong>XML</strong> æˆ–<strong>æ³¨è§£</strong>æ¥é…ç½®å’Œæ˜ å°„åŸç”Ÿä¿¡æ¯ï¼Œå°†æ¥å£å’Œ Java çš„ POJOsæ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•ã€‚</p><p>è¿™é‡Œæˆ‘ä½¿ç”¨åŸç”Ÿçš„Mybatisï¼Œä¸ä½¿ç”¨Mybatisæ’ä»¶ï¼Œæ¥è®²è§£SpringBootå¦‚ä½•æ­å»ºMybatisç¯å¢ƒï¼Œå¹¶ç¼–å†™æ¥å£æµ‹è¯•æ¡ˆä¾‹ã€‚</p><p>Mybatisä¸­æ–‡å®˜ç½‘ï¼š<a href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></p><h2 id="1-Mavenä¾èµ–"><a href="#1-Mavenä¾èµ–" class="headerlink" title="1.Mavenä¾èµ–"></a>1.Mavenä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.dev<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springboot-mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>springboot-mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Spring Booté›†æˆMybatis<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--mysql--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--mybatis--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="2-åˆ›å»ºæ•°æ®åº“è¡¨"><a href="#2-åˆ›å»ºæ•°æ®åº“è¡¨" class="headerlink" title="2.åˆ›å»ºæ•°æ®åº“è¡¨"></a>2.åˆ›å»ºæ•°æ®åº“è¡¨</h2><p>åˆ›å»ºä¸€ä¸ªt_usersçš„æ•°æ®è¡¨ï¼Œæ’å…¥æµ‹è¯•æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `t\_users` (<br>`id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT NULL</span> AUTO\_INCREMENT,<br>`username` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">CHARACTER SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4\_general\_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>`password` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">CHARACTER SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4\_general\_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>`salt` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">CHARACTER SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4\_general\_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>`<span class="hljs-keyword">create</span>\_time` datetime <span class="hljs-keyword">NOT NULL</span>,<br>`<span class="hljs-keyword">update</span>\_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br><span class="hljs-keyword">PRIMARY KEY</span> (`id`) <span class="hljs-keyword">USING</span> BTREE<br>) ENGINE <span class="hljs-operator">=</span> InnoDB AUTO\_INCREMENT <span class="hljs-operator">=</span> <span class="hljs-number">6</span> <span class="hljs-keyword">CHARACTER SET</span> <span class="hljs-operator">=</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8mb4\_general\_ci <span class="hljs-type">ROW</span>\_FORMAT <span class="hljs-operator">=</span> Compact;<br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-comment">-- Records of t\_users</span><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-keyword">INSERT INTO</span> `t\_users` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;è·¯é£&#x27;</span>, <span class="hljs-string">&#x27;be59564e3e648e0f606e17d7bb5b7934&#x27;</span>, <span class="hljs-string">&#x27;noJmwJ7F&#x27;</span>, <span class="hljs-string">&#x27;2020-12-31 23:00:02&#x27;</span>, <span class="hljs-string">&#x27;2021-01-07 22:59:59&#x27;</span>);<br><span class="hljs-keyword">INSERT INTO</span> `t\_users` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;Alen&#x27;</span>, <span class="hljs-string">&#x27;99cdfcdb829c4c505acd92ed77f1b536&#x27;</span>, <span class="hljs-string">&#x27;7Vy^!Kjp&#x27;</span>, <span class="hljs-string">&#x27;2021-01-28 23:00:05&#x27;</span>, <span class="hljs-string">&#x27;2021-01-20 23:00:11&#x27;</span>);<br><span class="hljs-keyword">INSERT INTO</span> `t\_users` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;å°æ˜&#x27;</span>, <span class="hljs-string">&#x27;7cdd798bd3ad0235cfb93f67e24aa485&#x27;</span>, <span class="hljs-string">&#x27;@4qpfdQS&#x27;</span>, <span class="hljs-string">&#x27;2021-01-27 23:00:08&#x27;</span>, <span class="hljs-string">&#x27;2021-01-23 23:00:15&#x27;</span>);<br><span class="hljs-keyword">INSERT INTO</span> `t\_users` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;Luffy&#x27;</span>, <span class="hljs-string">&#x27;7cdd798bd3ad0235cfb93f67e24aa485&#x27;</span>, <span class="hljs-string">&#x27;3$^\*G)df&#x27;</span>, <span class="hljs-string">&#x27;2021-01-11 23:27:47&#x27;</span>, <span class="hljs-string">&#x27;2021-01-11 23:27:47&#x27;</span>);<br><span class="hljs-keyword">SET</span> <span class="hljs-keyword">FOREIGN</span>\_KEY\_CHECKS <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><h2 id="3-é…ç½®æ–‡ä»¶"><a href="#3-é…ç½®æ–‡ä»¶" class="headerlink" title="3.é…ç½®æ–‡ä»¶"></a>3.é…ç½®æ–‡ä»¶</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">server.port</span>=<span class="hljs-string">8031</span><br><span class="hljs-attr">spring.datasource.driver-class-name</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><br><span class="hljs-attr">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/shiro?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8</span><br><span class="hljs-attr">spring.datasource.username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-string">root</span><br><span class="hljs-comment">#å®ä½“ç±»æ‰«æ</span><br><span class="hljs-attr">mybatis.type-aliases-package</span>=<span class="hljs-string">com.dev.entity</span><br><span class="hljs-comment">#å¼€å¯é©¼å³°å‘½å</span><br><span class="hljs-attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="hljs-string">false</span><br><span class="hljs-attr">logging.level.com.dev.mapper</span>=<span class="hljs-string">debug</span><br><span class="hljs-attr">debug</span>=<span class="hljs-string">true</span><br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><p>mybatis.type-aliases-package æ˜¯å®ä½“ç±»entiyä½ç½®å­˜æ”¾çš„ä½ç½®</p><p>mybatis.configuration.map-underscore-to-camel-case é©¼å³°å‘½åçš„å¼€å¯ é»˜è®¤ä¸å¼€å¯ è¿™ä¸ªçœ‹ä¸ªäººä¹ æƒ¯</p><h2 id="4-å®ä½“ç±»"><a href="#4-å®ä½“ç±»" class="headerlink" title="4.å®ä½“ç±»"></a>4.å®ä½“ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Userså®ä½“ç±»<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">11</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Users</span> &#123;<br><span class="hljs-keyword">private</span> Integer id;<br><span class="hljs-keyword">private</span> String username;<br><span class="hljs-keyword">private</span> String password;<br><span class="hljs-keyword">private</span> String salt;<br><span class="hljs-keyword">private</span> Date create\_time;<br><span class="hljs-keyword">private</span> Date update\_time;<br><span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> id;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Integer id)</span> &#123;<br><span class="hljs-built_in">this</span>.id = id;<br>&#125;<br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> username;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> &#123;<br><span class="hljs-built_in">this</span>.username = username;<br>&#125;<br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> password;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> &#123;<br><span class="hljs-built_in">this</span>.password = password;<br>&#125;<br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSalt</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> salt;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSalt</span><span class="hljs-params">(String salt)</span> &#123;<br><span class="hljs-built_in">this</span>.salt = salt;<br>&#125;<br><span class="hljs-keyword">public</span> Date getCreate\_time() &#123;<br><span class="hljs-keyword">return</span> create\_time;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> setCreate\_time(Date create\_time) &#123;<br><span class="hljs-built_in">this</span>.create\_time = create\_time;<br>&#125;<br><span class="hljs-keyword">public</span> Date getUpdate\_time() &#123;<br><span class="hljs-keyword">return</span> update\_time;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> setUpdate\_time(Date update\_time) &#123;<br><span class="hljs-built_in">this</span>.update\_time = update\_time;<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Users&#123;&quot;</span> +<br><span class="hljs-string">&quot;id=&quot;</span> + id +<br><span class="hljs-string">&quot;, username=&#x27;&quot;</span> + username + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br><span class="hljs-string">&quot;, password=&#x27;&quot;</span> + password + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br><span class="hljs-string">&quot;, salt=&#x27;&quot;</span> + salt + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br><span class="hljs-string">&quot;, create\_time=&quot;</span> + create\_time +<br><span class="hljs-string">&quot;, update\_time=&quot;</span> + update\_time +<br><span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5-æŒä¹…å±‚"><a href="#5-æŒä¹…å±‚" class="headerlink" title="5.æŒä¹…å±‚"></a>5.æŒä¹…å±‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* æŒä¹…å±‚<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">11</span><br>\*/<br><span class="hljs-meta">@Mapper</span><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UsersMapper</span> &#123;<br><span class="hljs-comment">//æµ‹è¯•å¢åˆ æ”¹æŸ¥</span><br><span class="hljs-meta">@Select(&quot;SELECT \* FROM t\_users&quot;)</span><br>List&lt;Users&gt; <span class="hljs-title function_">selAllUsers</span><span class="hljs-params">()</span>;<br><span class="hljs-meta">@Select(&quot;SELECT \* FROM t\_users WHERE username = #&#123;username&#125; &quot;)</span><br>Users <span class="hljs-title function_">selUser</span><span class="hljs-params">(String username)</span>;<br><span class="hljs-meta">@Insert(&quot;INSERT INTO t\_users VALUES(DEFAULT,#&#123;username&#125;,#&#123;password&#125;,#&#123;salt&#125;,now(),now())&quot;)</span><br>Integer <span class="hljs-title function_">insUser</span><span class="hljs-params">(Users users)</span>;<br><span class="hljs-meta">@Update(&quot;UPDATE t\_users SET username = #&#123;username&#125; WHERE id = &#123;id&#125;&quot;)</span><br>Integer <span class="hljs-title function_">updUser</span><span class="hljs-params">(String username,Integer id)</span>;<br><span class="hljs-meta">@Delete(&quot;DELETE FROM t\_users WHERE username =#&#123;username&#125;&quot;)</span><br>Integer <span class="hljs-title function_">delUser</span><span class="hljs-params">(String username)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Mybatisæ”¯æŒXMLå’Œæ³¨è§£çš„æ–¹å¼ç¼–å†™SQLï¼ŒXMLç¼–å†™æœ‰ä¸€ç‚¹éš¾åº¦ï¼Œä½†å¯¹äºå¤æ‚çš„SQLéœ€è¦ç”¨åˆ°XMLæ¥å†™ã€‚è¿™é‡Œä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘é‡‡ç”¨æ³¨è§£çš„æ–¹å¼æ¥ç¼–å†™CRUDæµ‹è¯•æ¡ˆä¾‹ã€‚</p><h2 id="6-serviceå’Œserviceå®ç°ç±»"><a href="#6-serviceå’Œserviceå®ç°ç±»" class="headerlink" title="6.serviceå’Œserviceå®ç°ç±»"></a>6.serviceå’Œserviceå®ç°ç±»</h2><p>service.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* UsersæœåŠ¡æ¥å£<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">11</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UsersService</span> &#123;<br>List&lt;Users&gt; <span class="hljs-title function_">selAllUsers</span><span class="hljs-params">()</span>;<br>Users <span class="hljs-title function_">selUser</span><span class="hljs-params">(String username)</span>;<br>Integer <span class="hljs-title function_">insUser</span><span class="hljs-params">(Users users)</span>;<br>Integer <span class="hljs-title function_">updUser</span><span class="hljs-params">(String username,Integer id)</span>;<br>Integer <span class="hljs-title function_">delUser</span><span class="hljs-params">(String username)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>serviceImpl.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* UsersæœåŠ¡æ¥å£å®ç°<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">11</span><br>\*/<br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsersServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UsersService</span> &#123;<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> UsersMapper usersMapper;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;Users&gt; <span class="hljs-title function_">selAllUsers</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> usersMapper.selAllUsers();<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Users <span class="hljs-title function_">selUser</span><span class="hljs-params">(String username)</span> &#123;<br><span class="hljs-keyword">return</span> usersMapper.selUser(username);<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">insUser</span><span class="hljs-params">(Users users)</span> &#123;<br><span class="hljs-keyword">return</span> usersMapper.insUser(users);<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">updUser</span><span class="hljs-params">(String username, Integer id)</span> &#123;<br><span class="hljs-keyword">return</span> usersMapper.updUser(username,id);<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">delUser</span><span class="hljs-params">(String username)</span> &#123;<br><span class="hljs-keyword">return</span> usersMapper.delUser(username);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="7-controlleræ¥å£å±‚"><a href="#7-controlleræ¥å£å±‚" class="headerlink" title="7.controlleræ¥å£å±‚"></a>7.controlleræ¥å£å±‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* Usersæ¥å£å±‚<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2021</span>/<span class="hljs-number">1</span>/<span class="hljs-number">11</span><br>\*/<br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsersController</span> &#123;<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> UsersService usersService;<br>/\*\*<br>\* æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@GetMapping(&quot;/showAll&quot;)</span><br><span class="hljs-keyword">public</span> List&lt;Users&gt; <span class="hljs-title function_">showAllUsers</span><span class="hljs-params">()</span>&#123;<br>List&lt;Users&gt; users = usersService.selAllUsers();<br><span class="hljs-keyword">return</span> users;<br>&#125;<br>/\*\*<br>\* æŸ¥è¯¢ç”¨æˆ·<br>\* <span class="hljs-meta">@param</span> username<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@PostMapping(&quot;/selUser&quot;)</span><br><span class="hljs-keyword">public</span> Users <span class="hljs-title function_">selUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value = &quot;username&quot;)</span> String username)</span>&#123;<br><span class="hljs-type">Users</span> <span class="hljs-variable">users</span> <span class="hljs-operator">=</span> usersService.selUser(username);<br><span class="hljs-keyword">return</span> users;<br>&#125;<br>/\*\*<br>\* æ’å…¥ç”¨æˆ·<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@PostMapping(&quot;/insUser&quot;)</span><br><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title function_">insUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Users users)</span>&#123;<br>Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-type">Integer</span> <span class="hljs-variable">integer</span> <span class="hljs-operator">=</span> usersService.insUser(users);<br><span class="hljs-keyword">if</span> (integer &gt; <span class="hljs-number">0</span> )&#123;<br>map.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">200</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;success&quot;</span>);<br><span class="hljs-keyword">return</span> map;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>map.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">100</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;failed&quot;</span>);<br><span class="hljs-keyword">return</span> map;<br>&#125;<br>&#125;<br>/\*\*<br>\* ä¿®æ”¹ç”¨æˆ·<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@PostMapping(&quot;/updUser&quot;)</span><br><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title function_">updUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value = &quot;id&quot;)</span> Integer id,</span><br><span class="hljs-params"><span class="hljs-meta">@RequestParam(value = &quot;username&quot;)</span>String username)</span>&#123;<br>Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-type">Integer</span> <span class="hljs-variable">integer</span> <span class="hljs-operator">=</span> usersService.updUser(username,id);<br><span class="hljs-keyword">if</span> (integer &gt; <span class="hljs-number">0</span> )&#123;<br>map.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">200</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;success&quot;</span>);<br><span class="hljs-keyword">return</span> map;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>map.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">100</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;failed&quot;</span>);<br><span class="hljs-keyword">return</span> map;<br>&#125;<br>&#125;<br>/\*\*<br>\* åˆ é™¤ç”¨æˆ·<br>\* <span class="hljs-meta">@param</span> username<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@PostMapping(&quot;/delUser&quot;)</span><br><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title function_">delUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value = &quot;username&quot;)</span> String username)</span>&#123;<br>Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-type">Integer</span> <span class="hljs-variable">integer</span> <span class="hljs-operator">=</span> usersService.delUser(username);<br><span class="hljs-keyword">if</span> (integer &gt; <span class="hljs-number">0</span> )&#123;<br>map.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">200</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;success&quot;</span>);<br><span class="hljs-keyword">return</span> map;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>map.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">100</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;failed&quot;</span>);<br><span class="hljs-keyword">return</span> map;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯SpringMVCçš„æ“ä½œäº†ï¼Œå‡ ä¸ªæ ¸å¿ƒæ³¨è§£éœ€è¦æ³¨æ„ï¼š</p><p>@RestController æ˜¯@Controllerå’Œ@ResponseBodyçš„æ•´åˆï¼Œæ ‡æ˜è¯¥ç±»æ˜¯æ¥å£ï¼Œå¹¶æŠŠæ•°æ®ä»¥JSONçš„æ ¼å¼è¿”å›</p><p>@RequestMapping æ˜¯æ¥å£æ˜ å°„åœ°å€ï¼ŒåŒ…å«æ‰€æœ‰ç±»å‹çš„è¯·æ±‚ï¼Œæ”¾åœ¨æ¥å£å±‚æœ€å‰é¢ï¼ŒæŠŠè¯¥æ¥å£çš„è·¯å¾„éƒ½è§„å®šä¸º&#x2F;users&#x2F;*</p><p>@GetMapping GETè¯·æ±‚çš„æ¥å£</p><p>@PostMapping POSTè¯·æ±‚çš„æ¥å£</p><p>@RequestParam POSTè¯·æ±‚éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æŠŠContent-Typeè®¾ç½®ä¸ºapplication&#x2F;x-www-form-urlencodedï¼Œå¸¸è§å‚æ•°æäº¤ï¼Œä¹Ÿæ˜¯é»˜è®¤Ajaxå’ŒAxiosé»˜è®¤çš„å‚æ•°æäº¤æ ¼å¼</p><p>@RequestBody POSTè¯·æ±‚éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æŠŠContent-Typeè®¾ç½®ä¸ºapplication&#x2F;jsonï¼Œä¸€èˆ¬ç”¨äºè¡¨å•æäº¤</p><h2 id="8-æµ‹è¯•ç±»"><a href="#8-æµ‹è¯•ç±»" class="headerlink" title="8.æµ‹è¯•ç±»"></a>8.æµ‹è¯•ç±»</h2><p>åœ¨æµ‹è¯•ç±»åœ¨æ³¨å…¥UsersServiceï¼Œæµ‹è¯•æŸ¥è¯¢æ–¹æ³•æ˜¯å¦æˆåŠŸç”Ÿæ•ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringbootMybatisApplicationTests</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(SpringbootMybatisApplicationTests.class);<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> UsersService usersService;<br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showAll</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">//lambadasè¡¨è¾¾å¼</span><br>logger.info(<span class="hljs-string">&quot;-----------æŸ¥è¯¢å…¨éƒ¨-------------&quot;</span>);<br>usersService.selAllUsers().forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/12/UjYBlEgXwi6ZJbq.jpg"></p><p>æµ‹è¯•æˆåŠŸï¼Œè¿”å›æ•°æ®ã€‚</p><h2 id="9-PostManæµ‹è¯•"><a href="#9-PostManæµ‹è¯•" class="headerlink" title="9.PostManæµ‹è¯•"></a>9.PostManæµ‹è¯•</h2><p>controllerå±‚é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ï¼Œåç«¯åªå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œç¼–å†™APIï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨PostManæµ‹è¯•APIæ˜¯å¦èƒ½æˆåŠŸè¿”å›æ•°æ®</p><p><img src="https://i.loli.net/2021/01/12/btCmFzeYQVa6IRw.jpg"></p><p>æµ‹è¯•POSTæäº¤å‚æ•°</p><p><img src="https://i.loli.net/2021/01/12/V1NRcZEI8Uezwjy.jpg"></p><p>æµ‹è¯•æˆåŠŸï¼</p><h2 id="10-GitHubæºç "><a href="#10-GitHubæºç " class="headerlink" title="10.GitHubæºç "></a>10.GitHubæºç </h2><p><a href="https://github.com/luffy997/SpringBootBucket/tree/main/springboot-mybatis">springboot-mybatis</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œå­¦ä¹ ç¬”è®°</title>
    <link href="/2021/01/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2021/01/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="è®¡ç®—æœºç½‘ç»œå­¦ä¹ ç¬”è®°"><a href="#è®¡ç®—æœºç½‘ç»œå­¦ä¹ ç¬”è®°" class="headerlink" title="è®¡ç®—æœºç½‘ç»œå­¦ä¹ ç¬”è®°"></a>è®¡ç®—æœºç½‘ç»œå­¦ä¹ ç¬”è®°</h1><h2 id="1-TCP-IPå››å±‚æ¨¡å‹ï¼ŒOSIä¸ƒå±‚æ¨¡å‹çš„ç†è§£"><a href="#1-TCP-IPå››å±‚æ¨¡å‹ï¼ŒOSIä¸ƒå±‚æ¨¡å‹çš„ç†è§£" class="headerlink" title="1.TCP&#x2F;IPå››å±‚æ¨¡å‹ï¼ŒOSIä¸ƒå±‚æ¨¡å‹çš„ç†è§£"></a>1.TCP&#x2F;IPå››å±‚æ¨¡å‹ï¼ŒOSIä¸ƒå±‚æ¨¡å‹çš„ç†è§£</h2><p>ä¸ºäº†å¢å¼ºé€šç”¨æ€§å’Œå…¼å®¹æ€§ï¼Œè®¡ç®—æœºç½‘ç»œéƒ½è¢«è®¾è®¡æˆå±‚æ¬¡æœºæ„ï¼Œæ¯ä¸€å±‚éƒ½éµå®ˆä¸€å®šçš„è§„åˆ™ã€‚</p><p>å› æ­¤æœ‰äº†OSIè¿™æ ·ä¸€ä¸ªæŠ½è±¡çš„ç½‘ç»œé€šä¿¡å‚è€ƒæ¨¡å‹ï¼ŒæŒ‰ç…§è¿™ä¸ªæ ‡å‡†ä½¿è®¡ç®—æœºç½‘ç»œç³»ç»Ÿå¯ä»¥äº’ç›¸è¿æ¥ã€‚</p><ul><li><strong>ç‰©ç†å±‚</strong>ï¼šé€šè¿‡ç½‘çº¿ã€å…‰ç¼†ç­‰è¿™ç§ç‰©ç†æ–¹å¼å°†ç”µè„‘è¿æ¥èµ·æ¥ã€‚ä¼ é€’çš„æ•°æ®æ˜¯<strong>æ¯”ç‰¹æµ</strong>ï¼Œ0101010100ã€‚</li><li><strong>æ•°æ®é“¾è·¯å±‚</strong>ï¼šé¦–å…ˆï¼ŒæŠŠæ¯”ç‰¹æµå°è£…æˆæ•°æ®<strong>å¸§</strong>çš„æ ¼å¼ï¼Œå¯¹0ã€1è¿›è¡Œåˆ†ç»„ã€‚ç”µè„‘è¿æ¥èµ·æ¥ä¹‹åï¼Œæ•°æ®éƒ½ç»è¿‡ç½‘å¡æ¥ä¼ è¾“ï¼Œè€Œç½‘å¡ä¸Šå®šä¹‰äº†å…¨ä¸–ç•Œå”¯ä¸€çš„MACåœ°å€ã€‚ç„¶åå†é€šè¿‡å¹¿æ’­çš„å½¢å¼å‘å±€åŸŸç½‘å†…æ‰€æœ‰ç”µè„‘å‘é€æ•°æ®ï¼Œå†æ ¹æ®æ•°æ®ä¸­MACåœ°å€å’Œè‡ªèº«å¯¹æ¯”åˆ¤æ–­æ˜¯å¦æ˜¯å‘ç»™è‡ªå·±çš„ã€‚</li><li><strong>ç½‘ç»œå±‚</strong>ï¼šå¹¿æ’­çš„å½¢å¼å¤ªä½æ•ˆï¼Œä¸ºäº†åŒºåˆ†å“ªäº›MACåœ°å€å±äºåŒä¸€ä¸ªå­ç½‘ï¼Œç½‘ç»œå±‚å®šä¹‰äº†IPå’Œå­ç½‘æ©ç ï¼Œé€šè¿‡å¯¹IPå’Œå­ç½‘æ©ç è¿›è¡Œä¸è¿ç®—å°±çŸ¥é“æ˜¯å¦æ˜¯åŒä¸€ä¸ªå­ç½‘ï¼Œå†é€šè¿‡è·¯ç”±å™¨å’Œäº¤æ¢æœºè¿›è¡Œä¼ è¾“ã€‚IPåè®®å±äºç½‘ç»œå±‚çš„åè®®ã€‚</li><li><strong>ä¼ è¾“å±‚</strong>ï¼šæœ‰äº†ç½‘ç»œå±‚çš„MAC+IPåœ°å€ä¹‹åï¼Œä¸ºäº†ç¡®å®šæ•°æ®åŒ…æ˜¯ä»å“ªä¸ªè¿›ç¨‹å‘é€è¿‡æ¥çš„ï¼Œå°±éœ€è¦ç«¯å£å·ï¼Œé€šè¿‡ç«¯å£æ¥å»ºç«‹é€šä¿¡ï¼Œæ¯”å¦‚TCPå’ŒUDPå±äºè¿™ä¸€å±‚çš„åè®®ã€‚</li><li><strong>ä¼šè¯å±‚</strong>ï¼šè´Ÿè´£å»ºç«‹å’Œæ–­å¼€è¿æ¥</li><li><strong>è¡¨ç¤ºå±‚</strong>ï¼šä¸ºäº†ä½¿å¾—æ•°æ®èƒ½å¤Ÿè¢«å…¶ä»–çš„è®¡ç®—æœºç†è§£ï¼Œå†æ¬¡å°†æ•°æ®è½¬æ¢æˆå¦å¤–ä¸€ç§æ ¼å¼ï¼Œæ¯”å¦‚æ–‡å­—ã€è§†é¢‘ã€å›¾ç‰‡ç­‰ã€‚</li><li><strong>åº”ç”¨å±‚</strong>ï¼šæœ€é«˜å±‚ï¼Œé¢å¯¹ç”¨æˆ·ï¼Œæä¾›è®¡ç®—æœºç½‘ç»œä¸æœ€ç»ˆå‘ˆç°ç»™ç”¨æˆ·çš„ç•Œé¢</li></ul><p><img src="https://i.loli.net/2021/01/11/nEM9Fk2QNpLur34.jpg"></p><p>TCP&#x2F;IPåˆ™æ˜¯å››å±‚çš„ç»“æ„ï¼Œç›¸å½“äºæ˜¯å¯¹OSIæ¨¡å‹çš„ç®€åŒ–ã€‚</p><ol><li>æ•°æ®é“¾è·¯å±‚ï¼Œä¹Ÿæœ‰ç§°ä½œç½‘ç»œè®¿é—®å±‚ã€ç½‘ç»œæ¥å£å±‚ã€‚ä»–åŒ…å«äº†OSIæ¨¡å‹çš„ç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚ï¼ŒæŠŠç”µè„‘è¿æ¥èµ·æ¥ã€‚</li><li>ç½‘ç»œå±‚ï¼Œä¹Ÿå«åšIPå±‚ï¼Œå¤„ç†IPæ•°æ®åŒ…çš„ä¼ è¾“ã€è·¯ç”±ï¼Œå»ºç«‹ä¸»æœºé—´çš„é€šä¿¡ã€‚</li><li>ä¼ è¾“å±‚ï¼Œå°±æ˜¯ä¸ºä¸¤å°ä¸»æœºè®¾å¤‡æä¾›ç«¯åˆ°ç«¯çš„é€šä¿¡ã€‚</li><li>åº”ç”¨å±‚ï¼ŒåŒ…å«OSIçš„ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚å’Œåº”ç”¨å±‚ï¼Œæä¾›äº†ä¸€äº›å¸¸ç”¨çš„åè®®è§„èŒƒï¼Œæ¯”å¦‚FTPã€SMPTã€HTTPç­‰ã€‚</li></ol><p>æ€»ç»“ä¸‹æ¥ï¼Œå°±æ˜¯ç‰©ç†å±‚é€šè¿‡ç‰©ç†æ‰‹æ®µæŠŠç”µè„‘è¿æ¥èµ·æ¥ï¼Œæ•°æ®é“¾è·¯å±‚åˆ™å¯¹æ¯”ç‰¹æµçš„æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œç½‘ç»œå±‚æ¥å»ºç«‹ä¸»æœºåˆ°ä¸»æœºçš„é€šä¿¡ï¼Œä¼ è¾“å±‚å»ºç«‹ç«¯å£åˆ°ç«¯å£çš„é€šä¿¡ï¼Œåº”ç”¨å±‚æœ€ç»ˆè´Ÿè´£å»ºç«‹è¿æ¥ï¼Œæ•°æ®æ ¼å¼è½¬æ¢ï¼Œæœ€ç»ˆå‘ˆç°ç»™ç”¨æˆ·ã€‚</p><h2 id="2-TCP-3æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹"><a href="#2-TCP-3æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹" class="headerlink" title="2.TCP 3æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹"></a>2.TCP 3æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹</h2><p>å»ºç«‹è¿æ¥å‰serverç«¯éœ€è¦ç›‘å¬ç«¯å£ï¼Œæ‰€ä»¥åˆå§‹çŠ¶æ€æ˜¯LISTENã€‚</p><ol><li>clientç«¯å»ºç«‹è¿æ¥ï¼Œå‘é€ä¸€ä¸ªSYNåŒæ­¥åŒ…ï¼Œå‘é€ä¹‹åçŠ¶æ€å˜æˆSYN_SENT</li><li>serverç«¯æ”¶åˆ°SYNä¹‹åï¼ŒåŒæ„å»ºç«‹è¿æ¥ï¼Œè¿”å›ä¸€ä¸ªACKå“åº”ï¼ŒåŒæ—¶ä¹Ÿä¼šç»™clientå‘é€ä¸€ä¸ªSYNåŒ…ï¼Œå‘é€å®Œæˆä¹‹åçŠ¶æ€å˜ä¸ºSYN_RCVD</li><li>clientç«¯æ”¶åˆ°serverçš„ACKä¹‹åï¼ŒçŠ¶æ€å˜ä¸ºESTABLISHEDï¼Œè¿”å›ACKç»™serverç«¯ã€‚serveræ”¶åˆ°ä¹‹åçŠ¶æ€ä¹Ÿå˜ä¸ºESTABLISHEDï¼Œè¿æ¥å»ºç«‹å®Œæˆã€‚</li></ol><p><img src="https://i.loli.net/2021/01/11/K7yV8h4Mu9bCkJF.jpg"></p><h2 id="3-ä¸ºä»€ä¹ˆè¦3æ¬¡ï¼Ÿ2æ¬¡ï¼Œ4æ¬¡ä¸è¡Œå—ï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆè¦3æ¬¡ï¼Ÿ2æ¬¡ï¼Œ4æ¬¡ä¸è¡Œå—ï¼Ÿ" class="headerlink" title="3.ä¸ºä»€ä¹ˆè¦3æ¬¡ï¼Ÿ2æ¬¡ï¼Œ4æ¬¡ä¸è¡Œå—ï¼Ÿ"></a>3.ä¸ºä»€ä¹ˆè¦3æ¬¡ï¼Ÿ2æ¬¡ï¼Œ4æ¬¡ä¸è¡Œå—ï¼Ÿ</h2><p>å› ä¸ºTCPæ˜¯åŒå·¥ä¼ è¾“æ¨¡å¼ï¼Œä¸åŒºåˆ†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œè¿æ¥çš„å»ºç«‹æ˜¯åŒå‘çš„è¿‡ç¨‹ã€‚</p><p>å¦‚æœåªæœ‰ä¸¤æ¬¡ï¼Œæ— æ³•åšåˆ°åŒå‘è¿æ¥çš„å»ºç«‹ï¼Œä»å»ºç«‹è¿æ¥serverå›å¤çš„SYNå’ŒACKåˆå¹¶æˆä¸€æ¬¡å¯ä»¥çœ‹å‡ºæ¥ï¼Œä»–ä¹Ÿä¸éœ€è¦4æ¬¡ã€‚</p><p>æŒ¥æ‰‹ä¸ºä»€ä¹ˆè¦å››æ¬¡ï¼Ÿå› ä¸ºæŒ¥æ‰‹çš„ACKå’ŒFINä¸èƒ½åŒæ—¶å‘é€ï¼Œå› ä¸ºæ•°æ®å‘é€çš„æˆªæ­¢æ—¶é—´ä¸åŒã€‚</p><h2 id="4-TCP-4æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Ÿ"><a href="#4-TCP-4æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="4.TCP 4æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Ÿ"></a>4.TCP 4æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Ÿ</h2><ol><li>clientç«¯å‘serverå‘é€FINåŒ…ï¼Œè¿›å…¥FIN_WAIT_1çŠ¶æ€ï¼Œè¿™ä»£è¡¨clientç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†</li><li>serverç«¯æ”¶åˆ°ä¹‹åï¼Œè¿”å›ä¸€ä¸ªACKï¼Œè¿›å…¥CLOSE_WAITç­‰å¾…å…³é—­çš„çŠ¶æ€ï¼Œå› ä¸ºserverç«¯å¯èƒ½è¿˜æœ‰æ²¡æœ‰å‘é€å®Œæˆçš„æ•°æ®</li><li>ç­‰åˆ°serverç«¯æ•°æ®éƒ½å‘é€å®Œæ¯•ä¹‹åï¼Œserverç«¯å°±å‘clientå‘é€FINï¼Œè¿›å…¥LAST_ACKçŠ¶æ€</li><li>clientæ”¶åˆ°ACKä¹‹åï¼Œè¿›å…¥TIME_WAITçš„çŠ¶æ€ï¼ŒåŒæ—¶å›å¤ACKï¼Œserveræ”¶åˆ°ä¹‹åç›´æ¥è¿›å…¥CLOSEDçŠ¶æ€ï¼Œè¿æ¥å…³é—­ã€‚ä½†æ˜¯clientè¦ç­‰å¾…2MSL(æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´)çš„æ—¶é—´ï¼Œæ‰ä¼šè¿›å…¥CLOSEDçŠ¶æ€ã€‚</li></ol><p><img src="https://i.loli.net/2021/01/11/iotQIj58BlxHTvy.jpg"></p><h2 id="5-ä¸ºä»€ä¹ˆè¦ç­‰å¾…2MSLçš„æ—¶é—´æ‰å…³é—­ï¼Ÿ"><a href="#5-ä¸ºä»€ä¹ˆè¦ç­‰å¾…2MSLçš„æ—¶é—´æ‰å…³é—­ï¼Ÿ" class="headerlink" title="5.ä¸ºä»€ä¹ˆè¦ç­‰å¾…2MSLçš„æ—¶é—´æ‰å…³é—­ï¼Ÿ"></a>5.ä¸ºä»€ä¹ˆè¦ç­‰å¾…2MSLçš„æ—¶é—´æ‰å…³é—­ï¼Ÿ</h2><ol><li>ä¸ºäº†ä¿è¯è¿æ¥çš„å¯é å…³é—­ã€‚å¦‚æœserveræ²¡æœ‰æ”¶åˆ°æœ€åä¸€ä¸ªACKï¼Œé‚£ä¹ˆå°±ä¼šé‡å‘FINã€‚</li><li>ä¸ºäº†é¿å…ç«¯å£é‡ç”¨å¸¦æ¥çš„æ•°æ®æ··æ·†ã€‚å¦‚æœclientç›´æ¥è¿›å…¥CLOSEDçŠ¶æ€ï¼Œåˆç”¨ç›¸åŒç«¯å£å·å‘serverå»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œä¸Šä¸€æ¬¡è¿æ¥çš„éƒ¨åˆ†æ•°æ®åœ¨ç½‘ç»œä¸­å»¶è¿Ÿåˆ°è¾¾serverï¼Œæ•°æ®å°±å¯èƒ½å‘ç”Ÿæ··æ·†äº†ã€‚</li></ol><h2 id="6-TCPæ€ä¹ˆä¿è¯ä¼ è¾“è¿‡ç¨‹çš„å¯é æ€§ï¼Ÿ"><a href="#6-TCPæ€ä¹ˆä¿è¯ä¼ è¾“è¿‡ç¨‹çš„å¯é æ€§ï¼Ÿ" class="headerlink" title="6.TCPæ€ä¹ˆä¿è¯ä¼ è¾“è¿‡ç¨‹çš„å¯é æ€§ï¼Ÿ"></a>6.TCPæ€ä¹ˆä¿è¯ä¼ è¾“è¿‡ç¨‹çš„å¯é æ€§ï¼Ÿ</h2><p><strong>æ ¡éªŒå’Œ</strong>ï¼šå‘é€æ–¹åœ¨å‘é€æ•°æ®ä¹‹å‰è®¡ç®—æ ¡éªŒå’Œï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®ååŒæ ·è®¡ç®—ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œé‚£ä¹ˆä¼ è¾“æœ‰è¯¯ã€‚</p><p><strong>ç¡®è®¤åº”ç­”ï¼Œåºåˆ—å·</strong>ï¼šTCPè¿›è¡Œä¼ è¾“æ—¶æ•°æ®éƒ½è¿›è¡Œäº†ç¼–å·ï¼Œæ¯æ¬¡æ¥æ”¶æ–¹è¿”å›ACKéƒ½æœ‰ç¡®è®¤åºåˆ—å·ã€‚</p><p><strong>è¶…æ—¶é‡ä¼ </strong>ï¼šå¦‚æœå‘é€æ–¹å‘é€æ•°æ®ä¸€æ®µæ—¶é—´åæ²¡æœ‰æ”¶åˆ°ACKï¼Œé‚£ä¹ˆå°±é‡å‘æ•°æ®ã€‚</p><p><strong>è¿æ¥ç®¡ç†</strong>ï¼šä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ã€‚</p><p><strong>æµé‡æ§åˆ¶</strong>ï¼šTCPåè®®æŠ¥å¤´åŒ…å«16ä½çš„çª—å£å¤§å°ï¼Œæ¥æ”¶æ–¹ä¼šåœ¨è¿”å›ACKæ—¶åŒæ—¶æŠŠè‡ªå·±çš„å³æ—¶çª—å£å¡«å…¥ï¼Œå‘é€æ–¹å°±æ ¹æ®æŠ¥æ–‡ä¸­çª—å£çš„å¤§å°æ§åˆ¶å‘é€é€Ÿåº¦ã€‚</p><p><strong>æ‹¥å¡æ§åˆ¶</strong>ï¼šåˆšå¼€å§‹å‘é€æ•°æ®çš„æ—¶å€™ï¼Œæ‹¥å¡çª—å£æ˜¯1ï¼Œä»¥åæ¯æ¬¡æ”¶åˆ°ACKï¼Œåˆ™æ‹¥å¡çª—å£+1ï¼Œç„¶åå°†æ‹¥å¡çª—å£å’Œæ”¶åˆ°çš„çª—å£å–è¾ƒå°å€¼ä½œä¸ºå®é™…å‘é€çš„çª—å£ï¼Œå¦‚æœå‘ç”Ÿè¶…æ—¶é‡ä¼ ï¼Œæ‹¥å¡çª—å£é‡ç½®ä¸º1ã€‚è¿™æ ·åšçš„ç›®çš„å°±æ˜¯ä¸ºäº†ä¿è¯ä¼ è¾“è¿‡ç¨‹çš„é«˜æ•ˆæ€§å’Œå¯é æ€§ã€‚</p><h2 id="7-æµè§ˆå™¨è¯·æ±‚ä¸€ä¸ªç½‘å€çš„è¿‡ç¨‹ï¼Ÿ"><a href="#7-æµè§ˆå™¨è¯·æ±‚ä¸€ä¸ªç½‘å€çš„è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="7.æµè§ˆå™¨è¯·æ±‚ä¸€ä¸ªç½‘å€çš„è¿‡ç¨‹ï¼Ÿ"></a>7.æµè§ˆå™¨è¯·æ±‚ä¸€ä¸ªç½‘å€çš„è¿‡ç¨‹ï¼Ÿ</h2><ol><li>é¦–å…ˆé€šè¿‡DNSæœåŠ¡å™¨æŠŠåŸŸåè§£ææˆIPåœ°å€ï¼Œé€šè¿‡IPå’Œå­ç½‘æ©ç åˆ¤æ–­æ˜¯å¦å±äºåŒä¸€ä¸ªå­ç½‘</li><li>æ„é€ åº”ç”¨å±‚è¯·æ±‚httpæŠ¥æ–‡ï¼Œä¼ è¾“å±‚æ·»åŠ TCP&#x2F;UDPå¤´éƒ¨ï¼Œç½‘ç»œå±‚æ·»åŠ IPå¤´éƒ¨ï¼Œæ•°æ®é“¾è·¯å±‚æ·»åŠ ä»¥å¤ªç½‘åè®®å¤´éƒ¨</li><li>æ•°æ®ç»è¿‡è·¯ç”±å™¨ã€äº¤æ¢æœºè½¬å‘ï¼Œæœ€ç»ˆè¾¾åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œç›®æ ‡æœåŠ¡å™¨åŒæ ·è§£ææ•°æ®ï¼Œæœ€ç»ˆæ‹¿åˆ°httpæŠ¥æ–‡ï¼ŒæŒ‰ç…§å¯¹åº”çš„ç¨‹åºçš„é€»è¾‘å“åº”å›å»ã€‚</li></ol><p><img src="https://i.loli.net/2021/01/11/TQ8FiMj5x9GYpqR.jpg"></p><h2 id="8-HTTPSçš„å·¥ä½œåŸç†"><a href="#8-HTTPSçš„å·¥ä½œåŸç†" class="headerlink" title="8.HTTPSçš„å·¥ä½œåŸç†"></a>8.HTTPSçš„å·¥ä½œåŸç†</h2><ol><li>ç”¨æˆ·é€šè¿‡æµè§ˆå™¨è¯·æ±‚httpsç½‘ç«™ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œé€‰æ‹©æµè§ˆå™¨æ”¯æŒçš„åŠ å¯†å’Œhashç®—æ³•ï¼ŒåŒæ—¶è¿”å›æ•°å­—è¯ä¹¦ç»™æµè§ˆå™¨ï¼ŒåŒ…å«é¢å‘æœºæ„ã€ç½‘å€ã€å…¬é’¥ã€è¯ä¹¦æœ‰æ•ˆæœŸç­‰ä¿¡æ¯ã€‚</li><li>æµè§ˆå™¨å¯¹è¯ä¹¦çš„å†…å®¹è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªæç¤ºè­¦å‘Šã€‚å¦åˆ™ï¼Œå°±ç”Ÿæˆä¸€ä¸ªéšæœºæ•°Xï¼ŒåŒæ—¶ä½¿ç”¨è¯ä¹¦ä¸­çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”å‘é€ç»™æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨æ”¶åˆ°ä¹‹åï¼Œä½¿ç”¨ç§é’¥è§£å¯†ï¼Œå¾—åˆ°éšæœºæ•°Xï¼Œç„¶åä½¿ç”¨Xå¯¹ç½‘é¡µå†…å®¹è¿›è¡ŒåŠ å¯†ï¼Œè¿”å›ç»™æµè§ˆå™¨</li><li>æµè§ˆå™¨åˆ™ä½¿ç”¨Xå’Œä¹‹å‰çº¦å®šçš„åŠ å¯†ç®—æ³•è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç½‘é¡µå†…å®¹</li></ol><p><img src="https://i.loli.net/2021/01/11/U9NBn17AEc4l5PI.jpg"></p><h2 id="9-è´Ÿè½½å‡è¡¡çš„å®ç°æ–¹å¼ï¼Ÿ"><a href="#9-è´Ÿè½½å‡è¡¡çš„å®ç°æ–¹å¼ï¼Ÿ" class="headerlink" title="9.è´Ÿè½½å‡è¡¡çš„å®ç°æ–¹å¼ï¼Ÿ"></a>9.è´Ÿè½½å‡è¡¡çš„å®ç°æ–¹å¼ï¼Ÿ</h2><p><strong>DNS</strong>ï¼šè¿™æ˜¯æœ€ç®€å•çš„è´Ÿè½½å‡è¡¡çš„æ–¹å¼ï¼Œä¸€èˆ¬ç”¨äºå®ç°åœ°ç†çº§åˆ«çš„è´Ÿè½½å‡è¡¡ï¼Œä¸åŒåœ°åŸŸçš„ç”¨æˆ·é€šè¿‡DNSçš„è§£æå¯ä»¥è¿”å›ä¸åŒçš„IPåœ°å€ï¼Œè¿™ç§æ–¹å¼çš„è´Ÿè½½å‡è¡¡ç®€å•ï¼Œä½†æ˜¯æ‰©å±•æ€§å¤ªå·®ï¼Œæ§åˆ¶æƒåœ¨åŸŸåæœåŠ¡å•†ã€‚</p><p><strong>Httpé‡å®šå‘</strong>ï¼šé€šè¿‡ä¿®æ”¹Httpå“åº”å¤´çš„Locationè¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„ï¼ŒHttpçš„302é‡å®šå‘ã€‚è¿™ç§æ–¹å¼å¯¹æ€§èƒ½æœ‰å½±å“ï¼Œè€Œä¸”å¢åŠ è¯·æ±‚è€—æ—¶ã€‚</p><p><strong>åå‘ä»£ç†</strong>ï¼šä½œç”¨äºåº”ç”¨å±‚çš„æ¨¡å¼ï¼Œä¹Ÿè¢«ç§°ä½œä¸º<strong>ä¸ƒå±‚è´Ÿè½½å‡è¡¡</strong>ï¼Œæ¯”å¦‚å¸¸è§çš„Nginxï¼Œæ€§èƒ½ä¸€èˆ¬å¯ä»¥è¾¾åˆ°ä¸‡çº§ã€‚è¿™ç§æ–¹å¼éƒ¨ç½²ç®€å•ï¼Œæˆæœ¬ä½ï¼Œè€Œä¸”å®¹æ˜“æ‰©å±•ã€‚</p><p><strong>IP</strong>ï¼šä½œç”¨äºç½‘ç»œå±‚çš„å’Œä¼ è¾“å±‚çš„æ¨¡å¼ï¼Œä¹Ÿè¢«ç§°ä½œ<strong>å››å±‚è´Ÿè½½å‡è¡¡</strong>ï¼Œé€šè¿‡å¯¹æ•°æ®åŒ…çš„IPåœ°å€å’Œç«¯å£è¿›è¡Œä¿®æ”¹æ¥è¾¾åˆ°è´Ÿè½½å‡è¡¡çš„æ•ˆæœã€‚å¸¸è§çš„æœ‰LVSï¼ˆLinux Virtual Serverï¼‰ï¼Œé€šå¸¸æ€§èƒ½å¯ä»¥æ”¯æŒ10ä¸‡çº§å¹¶å‘ã€‚</p><p>æŒ‰ç…§ç±»å‹æ¥åˆ’åˆ†çš„è¯ï¼Œè¿˜å¯ä»¥åˆ†æˆDNSè´Ÿè½½å‡è¡¡ã€ç¡¬ä»¶è´Ÿè½½å‡è¡¡ã€è½¯ä»¶è´Ÿè½½å‡è¡¡ã€‚</p><p>å…¶ä¸­ç¡¬ä»¶è´Ÿè½½å‡è¡¡ä»·æ ¼æ˜‚è´µï¼Œæ€§èƒ½æœ€å¥½ï¼Œèƒ½è¾¾åˆ°ç™¾ä¸‡çº§ï¼Œè½¯ä»¶è´Ÿè½½å‡è¡¡åŒ…æ‹¬Nginxã€LVSè¿™ç§ã€‚</p><h2 id="10-å‚è€ƒæ–‡æ¡£"><a href="#10-å‚è€ƒæ–‡æ¡£" class="headerlink" title="10.å‚è€ƒæ–‡æ¡£"></a>10.å‚è€ƒæ–‡æ¡£</h2><p><a href="https://mp.weixin.qq.com/s/4d1ZHK558838RcWnB-zwjw">ã€Šæˆ‘æƒ³è¿›å¤§å‚ã€‹ä¹‹ç½‘ç»œç¯‡å¤ºå‘½è¿ç¯12é—®</a></p><p>ä»¥ä¸Šæ˜¯æˆ‘å­¦ä¹ ç‹é“çš„è®¡ç®—æœºç½‘ç»œåï¼Œå†çœ‹çš„åšä¸»è‰¾å°ä»™æ•´ç†çš„å…³äºè®¡ç½‘çš„é¢è¯•é¢˜ï¼ŒåŠ æ·±ç†è§£ã€‚</p><p>æœ€åï¼Œé™„ä¸Šç‹é“è®¡ç½‘çš„æ•´ç†ç¬”è®°ï¼š</p><p><a href="https://blog.csdn.net/weixin_45067603/article/details/106974036">è®¡ç®—æœºç½‘ç»œç¬”è®°</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootä¹‹AOPçš„ä½¿ç”¨</title>
    <link href="/2021/01/06/SpringBoot%E4%B9%8BAOP%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/01/06/SpringBoot%E4%B9%8BAOP%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringBootä¹‹AOPçš„ä½¿ç”¨"><a href="#SpringBootä¹‹AOPçš„ä½¿ç”¨" class="headerlink" title="SpringBootä¹‹AOPçš„ä½¿ç”¨"></a>SpringBootä¹‹AOPçš„ä½¿ç”¨</h1><p>springæ ¸å¿ƒæ€æƒ³åˆ†ä¸‰å¤§ç±»ï¼š<strong>æ§åˆ¶åè½¬ï¼ˆIOCï¼‰ï¼Œä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰å’Œé¢å‘åˆ‡é¢ï¼ˆAOPï¼‰</strong></p><h2 id="1-ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹"><a href="#1-ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹" class="headerlink" title="1.ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹"></a>1.ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹</h2><ul><li><p>AOPç®€ä»‹</p><p>AOPä¸ºAspect Oriented Programmingçš„ç¼©å†™ï¼Œæ„ä¸ºï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸé—´åŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½çš„ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ã€‚</p></li><li><p>ä¸ºä»€ä¹ˆä½¿ç”¨AOPç¼–ç¨‹èŒƒå¼ï¼Ÿ</p><p>åˆ†ç¦»åŠŸèƒ½æ€§éœ€æ±‚å’ŒéåŠŸèƒ½æ€§éœ€æ±‚</p><p>é›†ä¸­å¤„ç†æŸä¸€å…³æ³¨ç‚¹</p><p>ä¾µå…¥æ€§å°‘ï¼Œå¢å¼ºä»£ç å¯è¯»æ€§åŠå¯ç»´æŠ¤æ€§</p></li><li><p>AOPåº”ç”¨åœºæ™¯</p><p>æƒé™æ§åˆ¶ã€ç¼“å­˜æ§åˆ¶ã€äº‹åŠ¡æ§åˆ¶ã€åˆ†å¸ƒå¼è¿½è¸ªã€å¼‚å¸¸å¤„ç†ç­‰</p><p>æ€»ä¹‹ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼ŒåŠ¨æ€åœ°å°†ä»£ç åˆ‡å…¥åˆ°ç±»çš„æŒ‡å®šæ–¹æ³•æˆ–ä½ç½®ä¸Šçš„æ€æƒ³ï¼Œå°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p><p>â€‹</p></li></ul><h2 id="2-AOPå¸¸ç”¨æœ¯è¯­"><a href="#2-AOPå¸¸ç”¨æœ¯è¯­" class="headerlink" title="2.AOPå¸¸ç”¨æœ¯è¯­"></a>2.AOPå¸¸ç”¨æœ¯è¯­</h2><p>Springçš„AOPä¸­æœ‰å‡ ä¸ªé‡è¦æ¦‚å¿µææ¸…æ¥šå°±è¡Œ</p><ul><li>æ‰§è¡Œç‚¹ï¼ˆExecutepointï¼‰ - ç±»åˆå§‹åŒ–ï¼Œæ–¹æ³•è°ƒç”¨ã€‚</li><li>è¿æ¥ç‚¹ï¼ˆJoinpointï¼‰ - æ‰§è¡Œç‚¹+æ–¹ä½çš„ç»„åˆï¼Œå¯ç¡®å®šJoinpointï¼Œæ¯”å¦‚ç±»å¼€å§‹åˆå§‹åŒ–å‰ï¼Œç±»åˆå§‹åŒ–åï¼Œæ–¹æ³•è°ƒç”¨å‰ï¼Œæ–¹æ³•è°ƒç”¨åã€‚</li><li>åˆ‡ç‚¹ï¼ˆPointcutï¼‰ - åœ¨ä¼—å¤šæ‰§è¡Œç‚¹ä¸­ï¼Œå®šä½æ„Ÿå…´è¶£çš„æ‰§è¡Œç‚¹ã€‚Executepointç›¸å½“äºæ•°æ®åº“è¡¨ä¸­çš„è®°å½•ï¼Œè€ŒPointcutç›¸å½“äºæŸ¥è¯¢æ¡ä»¶ã€‚</li><li>å¢å¼ºï¼ˆAdviceï¼‰ - ç»‡å…¥åˆ°ç›®æ ‡ç±»è¿æ¥ç‚¹ä¸Šçš„ä¸€æ®µç¨‹åºä»£ç ã€‚é™¤äº†ä¸€æ®µç¨‹åºä»£ç å¤–ï¼Œè¿˜æ‹¥æœ‰æ‰§è¡Œç‚¹çš„æ–¹ä½ä¿¡æ¯ã€‚</li><li>ç›®æ ‡å¯¹è±¡ï¼ˆTargetï¼‰ - å¢å¼ºé€»è¾‘çš„ç»‡å…¥ç›®æ ‡ç±»</li><li>å¼•ä»‹ï¼ˆIntroductionï¼‰ - ä¸€ç§ç‰¹æ®Šçš„å¢å¼ºï¼ˆadviceï¼‰ï¼Œå®ƒä¸ºç±»æ·»åŠ ä¸€äº›é¢å¤–çš„å±æ€§å’Œæ–¹æ³•ï¼ŒåŠ¨æ€ä¸ºä¸šåŠ¡ç±»æ·»åŠ å…¶ä»–æ¥å£çš„å®ç°é€»è¾‘ï¼Œè®©ä¸šåŠ¡ç±»æˆä¸ºè¿™ä¸ªæ¥å£çš„å®ç°ç±»ã€‚</li><li>ä»£ç†ï¼ˆProxyï¼‰ - ä¸€ä¸ªç±»è¢«AOPç»‡å…¥åï¼Œäº§ç”Ÿä¸€ä¸ªç»“æœç±»ï¼Œå®ƒä¾¿æ˜¯èåˆäº†åŸç±»å’Œå¢å¼ºé€»è¾‘çš„ä»£ç†ç±»ã€‚</li><li>åˆ‡é¢ï¼ˆAspectï¼‰ - åˆ‡é¢ç”±åˆ‡ç‚¹ï¼ˆPointcutï¼‰å’Œå¢å¼ºï¼ˆAdvice&#x2F;Introductionï¼‰ç»„æˆï¼Œæ—¢åŒ…æ‹¬æ¨ªåˆ‡é€»è¾‘å®šä¹‰ï¼Œä¹ŸåŒ…æ‹¬è¿æ¥ç‚¹å®šä¹‰ã€‚</li></ul><p>AOPå·¥ä½œé‡ç‚¹ï¼š</p><ul><li>å¦‚ä½•é€šè¿‡åˆ‡ç‚¹ï¼ˆPointcutï¼‰å’Œå¢å¼ºï¼ˆAdviceï¼‰å®šä½åˆ°è¿æ¥ç‚¹ï¼ˆJointpointï¼‰ä¸Šï¼›</li><li>å¦‚ä½•åœ¨å¢å¼ºï¼ˆAdviceï¼‰ä¸­ç¼–å†™åˆ‡é¢çš„ä»£ç ã€‚</li></ul><h2 id="3-Advice-äº”ç§å¢å¼ºæ–¹å¼"><a href="#3-Advice-äº”ç§å¢å¼ºæ–¹å¼" class="headerlink" title="3.Advice-äº”ç§å¢å¼ºæ–¹å¼"></a>3.Advice-äº”ç§å¢å¼ºæ–¹å¼</h2><p>ä¾‹å¦‚åœ¨æ‰§è¡ŒæŸä¸ªç‰¹å®šæ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸åŒçš„å¢å¼ºæ–¹å¼ï¼ˆå¦‚å‰ç½®é€šçŸ¥&#x2F;å¢å¼ºï¼Œåœ¨æ–¹æ³•è¿è¡Œå‰æ‰§è¡Œï¼‰ï¼Œè¾¾åˆ°æˆ‘ä»¬ç»‡å…¥åçš„ä¸åŒæ•ˆæœã€‚</p><ul><li>å‰ç½®é€šçŸ¥:åœ¨æˆ‘ä»¬æ‰§è¡Œç›®æ ‡æ–¹æ³•ä¹‹å‰è¿è¡Œ(@Before)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Pointcut(&quot;within(com.example.demo.Service.\*)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">matchType</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-meta">@Before(&quot;matchType()&quot;)</span> <span class="hljs-comment">//å¯åœ¨æ­¤åŠ å…¥JoinPointæ‰“å°åˆ‡ç‚¹ä¿¡æ¯</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">(JoinPoint joinPoint)</span>&#123;<br>System.out.println(<span class="hljs-string">&quot;------ã€å‰ç½®é€šçŸ¥ã€‘------&quot;</span> + joinPoint);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åç½®é€šçŸ¥:åœ¨æˆ‘ä»¬ç›®æ ‡æ–¹æ³•è¿è¡Œç»“æŸä¹‹å ,ä¸ç®¡æœ‰æ²¡æœ‰å¼‚å¸¸(@After)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@After(value=&quot;execution(\* com.example.aspectJ.demo1.ProductDao.findAll(..))&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span>&#123;<br>System.out.println(<span class="hljs-string">&quot;æœ€ç»ˆé€šçŸ¥==================&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>è¿”å›é€šçŸ¥:åœ¨æˆ‘ä»¬çš„ç›®æ ‡æ–¹æ³•æ­£å¸¸è¿”å›å€¼åè¿è¡Œ(@AfterReturning)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AfterReturning(value=&quot;execution(\* com.example.aspectJ.demo1.ProductDao.update(..))&quot; ,returning = &quot;result&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterReturning</span><span class="hljs-params">(Object result)</span>&#123; <span class="hljs-comment">//é€šè¿‡returningå±æ€§ï¼Œå®šä¹‰æ–¹æ³•è¿”å›å€¼ä½œä¸ºå‚æ•°</span><br>System.out.println(<span class="hljs-string">&quot;åç½®é€šçŸ¥=========&quot;</span>+result);<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://imgchr.com/i/sVsXeU"><img src="https://s3.ax1x.com/2021/01/06/sVsXeU.md.png" alt="sVsXeU.md.png"></a></p><ul><li>å¼‚å¸¸é€šçŸ¥:åœ¨æˆ‘ä»¬çš„ç›®æ ‡æ–¹æ³•å‡ºç°å¼‚å¸¸åè¿è¡Œ(@AfterThrowing)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é€šè¿‡è®¾ç½®throwingå±æ€§ï¼Œå¯ä»¥è®¾ç½®å‘ç”Ÿå¼‚å¸¸å¯¹è±¡å‚æ•°</span><br><span class="hljs-meta">@AfterThrowing(value = &quot;execution(\* com.example.aspectJ.demo1.ProductDao.findOne(..))&quot;,throwing = &quot;e&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterThrowing</span><span class="hljs-params">(Throwable e)</span>&#123;<br>System.out.println(<span class="hljs-string">&quot;æŠ›å‡ºå¼‚å¸¸é€šçŸ¥&quot;</span>+e.getMessage());<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ç¯ç»•é€šçŸ¥:åŠ¨æ€ä»£ç†, éœ€è¦æ‰‹åŠ¨æ‰§è¡ŒjoinPoint.procced()(å…¶å®å°±æ˜¯æ‰§è¡Œæˆ‘ä»¬çš„ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰ç›¸å½“äºå‰ç½®é€šçŸ¥, æ‰§è¡Œä¹‹åå°±ç›¸å½“äºæˆ‘ä»¬åç½®é€šçŸ¥(@Around)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Around(value = &quot;execution(\* com.example.aspectJ.demo1.ProductDao.delete(..))&quot;)</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>System.out.println(<span class="hljs-string">&quot;ç¯ç»•å‰é€šçŸ¥&quot;</span>);<br><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> joinPoint.proceed(); <span class="hljs-comment">//æ‰§è¡Œç›®æ ‡æ–¹æ³•</span><br>System.out.println(<span class="hljs-string">&quot;ç¯ç»•åé€šçŸ¥&quot;</span>);<br><span class="hljs-keyword">return</span> obj;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://imgchr.com/i/sVsrid"><img src="https://s3.ax1x.com/2021/01/06/sVsrid.md.png" alt="sVsrid.md.png"></a></p><h2 id="4-SpringAOPä½¿ç”¨è¯¦è§£"><a href="#4-SpringAOPä½¿ç”¨è¯¦è§£" class="headerlink" title="4.SpringAOPä½¿ç”¨è¯¦è§£"></a>4.SpringAOPä½¿ç”¨è¯¦è§£</h2><p><strong>åˆ‡é¢è¡¨è¾¾å¼</strong></p><p><a href="https://imgchr.com/i/sVcsJJ"><img src="https://s3.ax1x.com/2021/01/06/sVcsJJ.jpg" alt="sVcsJJ.jpg"></a></p><p><strong>excutionè¡¨è¾¾å¼</strong></p><ul><li><p>execution(</p></li><li><p>ä¿®é¥°ç¬¦pattern</p></li><li><p>è¿”å›å€¼pattern</p></li><li><p>æè¿°åŒ…å</p></li><li><p>æ–¹æ³•å(å‚æ•°)</p></li><li><p>æ–¹æ³•æŠ›å‡ºå¼‚å¸¸pattern</p><p>)</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Pointcut(&quot;execution(public \* com.example.controller.\*Controller.\*(..))&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">match</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-meta">@Before(&quot;match()&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//å‰ç½®é€šçŸ¥...</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>withinè¡¨è¾¾å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åŒ¹é…StudentServiceç±»é‡Œæ‰€æœ‰æ–¹æ³•</span><br><span class="hljs-meta">@Pointcut(&quot;within(com.example.service.StudentService)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">matchType</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-comment">//åŒ¹é…com.exampleåŒ…åŠå­åŒ…ä¸‹æ‰€æœ‰ç±»æ–¹æ³•</span><br><span class="hljs-meta">@Pointcut(&quot;within(com.example..\*)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">matchPackage</span><span class="hljs-params">()</span>&#123;&#125;<br></code></pre></td></tr></table></figure><p><strong>å¯¹è±¡åŒ¹é…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">serviceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">service</span>\*/<br><span class="hljs-comment">//åŒ¹é…AOPå¯¹è±¡çš„ç›®æ ‡å¯¹è±¡ä¸ºæŒ‡å®šç±»å‹æ–¹æ³•ï¼Œå³serviceImplçš„aopä»£ç†å¯¹è±¡æ–¹æ³•</span><br><span class="hljs-meta">@Pointcut(&quot;this(com.example.serviceImpl)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">thisDemo</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-comment">//åŒ¹é…å®ç°serviceæ¥å£çš„ç›®æ ‡å¯¹è±¡ï¼ˆéaopä»£ç†åçš„å¯¹è±¡ï¼‰æ–¹æ³•ï¼Œè¿™é‡ŒæŒ‡çš„å°±æ˜¯serviceImplçš„æ–¹æ³•</span><br><span class="hljs-meta">@Pointcut(&quot;target(com.example.service)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">targetDemo</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-comment">//åŒ¹é…æ‰€æœ‰ä»¥Serviceç»“å°¾çš„beanä¸­æ–¹æ³•</span><br><span class="hljs-meta">@Pointcut(&quot;bean(\*Service)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beanDemo</span><span class="hljs-params">()</span>&#123;&#125;<br></code></pre></td></tr></table></figure><p><strong>å‚æ•°åŒ¹é…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åŒ¹é…ä»»ä½•ä»¥findå¼€å¤´ä¸”åªæœ‰ä¸€ä¸ªLongå‚æ•°çš„æ–¹æ³•</span><br><span class="hljs-meta">@Pointcut(&quot;execution(\* \*..find\*(Long))&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">argsDemo1</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-comment">//åŒ¹é…ä»»ä½•åªæœ‰ä¸€ä¸ªLongå‚æ•°çš„æ–¹æ³•</span><br><span class="hljs-meta">@Pointcut(&quot;args(Long)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">argsDemo2</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-comment">//åŒ¹é…ä»»ä½•ä»¥findå¼€å¤´ä¸”ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºLongçš„æ–¹æ³•</span><br><span class="hljs-meta">@Pointcut(&quot;execution(\* \*..find\*(Long,..))&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">argsDemo3</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-comment">//åŒ¹é…ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºLongçš„æ–¹æ³•</span><br><span class="hljs-meta">@Pointcut(&quot;args(Long,..)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">argsDemo4</span><span class="hljs-params">()</span>&#123;&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨è§£åŒ¹é…ï¼ˆè‡ªå®šä¹‰æ³¨è§£ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åŒ¹é…æ–¹æ³•æ³¨è§£æœ‰@AdminOnlyçš„æ–¹æ³•</span><br><span class="hljs-meta">@Pointcut(&quot;@annotation(com.example.security.AdminOnly)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">annoDemo</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-comment">//åŒ¹é…æ³¨è§£æœ‰@Test1çš„ç±»ä¸‹æ‰€æœ‰æ–¹æ³•ï¼Œè¦æ±‚æ³¨è§£çš„RetentionPolicyçº§åˆ«ä¸ºCLASS</span><br><span class="hljs-meta">@Pointcut(&quot;@within(com.example.annotation.Test1)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">annoWithinDemo</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-comment">//åŒ¹é…æ³¨è§£æœ‰@Test2ç±»ä¸‹æ‰€æœ‰æ–¹æ³•ï¼Œè¦æ±‚æ³¨è§£çš„RetentionPolicyçº§åˆ«ä¸ºRUNTIME</span><br><span class="hljs-meta">@Pointcut(&quot;@target(com.example.repository.Test2)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">annoTargetDemo</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-comment">//åŒ¹é…ä¼ å…¥å‚æ•°ç±»å…·æœ‰@Test3çš„æ³¨è§£çš„æ–¹æ³•ï¼ˆä¾‹å¦‚studentå®ä½“ç±»æœ‰æ³¨è§£@Test3ï¼Œåªè¦æ–¹æ³•ä¼ å…¥studentç±»å°±ä¼šè¢«æ‹¦æˆªï¼‰</span><br><span class="hljs-meta">@Pointcut(&quot;@args(org.example.repository.Test3)&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">annoArgsDemo</span><span class="hljs-params">()</span>&#123;&#125;<br></code></pre></td></tr></table></figure><p>ä¸¤ä¸ªaopåˆ‡é¢ç±»éƒ½å·¥ä½œäº†ï¼Œé¡ºåºå‘¢å°±æ˜¯ä¸‹é¢çš„ï¼š</p><p><a href="https://imgchr.com/i/sVrzxP"><img src="https://s3.ax1x.com/2021/01/06/sVrzxP.png" alt="sVrzxP.png"></a></p><p>spring aopå°±æ˜¯ä¸€ä¸ªåŒå¿ƒåœ†ï¼Œè¦æ‰§è¡Œçš„æ–¹æ³•ä¸ºåœ†å¿ƒï¼Œæœ€å¤–å±‚çš„orderæœ€å°ã€‚ä»æœ€å¤–å±‚æŒ‰ç…§AOP1ã€AOP2çš„é¡ºåºä¾æ¬¡æ‰§è¡ŒdoAroundæ–¹æ³•ï¼ŒdoBeforeæ–¹æ³•ã€‚ç„¶åæ‰§è¡Œmethodæ–¹æ³•ï¼Œæœ€åæŒ‰ç…§AOP2ã€AOP1çš„é¡ºåºä¾æ¬¡æ‰§è¡ŒdoAfterã€doAfterReturnæ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹å¤šä¸ªAOPæ¥è¯´ï¼Œå…ˆbeforeçš„ï¼Œä¸€å®šåafterã€‚</p><p>å¯¹äºä¸Šé¢çš„ä¾‹å­å°±æ˜¯ï¼Œå…ˆå¤–å±‚çš„å°±æ˜¯å¯¹æ‰€æœ‰controllerçš„åˆ‡é¢ï¼Œå†…å±‚å°±æ˜¯è‡ªå®šä¹‰æ³¨è§£çš„ã€‚ é‚£ä¸åŒçš„åˆ‡é¢ï¼Œé¡ºåºæ€ä¹ˆå†³å®šå‘¢ï¼Œå°¤å…¶æ˜¯åŒæ ¼å¼çš„åˆ‡é¢å¤„ç†ï¼Œè­¬å¦‚ä¸¤ä¸ªexecutionçš„æƒ…å†µï¼Œé‚£springå°±æ˜¯éšæœºå†³å®šå“ªä¸ªåœ¨å¤–å“ªä¸ªåœ¨å†…äº†ã€‚</p><p>æ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šé¡ºåºï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åœ¨Aspectåˆ‡é¢ç±»ä¸ŠåŠ ä¸Š@Order(1)æ³¨è§£å³å¯ï¼Œorderè¶Šå°æœ€å…ˆæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ä½äºæœ€å¤–å±‚ã€‚åƒä¸€äº›å…¨å±€å¤„ç†çš„å°±å¯ä»¥æŠŠorderè®¾å°ä¸€ç‚¹ï¼Œå…·ä½“åˆ°æŸä¸ªç»†èŠ‚çš„å°±è®¾å¤§ä¸€ç‚¹ã€‚</p><h2 id="5-å‚è€ƒæ–‡æ¡£"><a href="#5-å‚è€ƒæ–‡æ¡£" class="headerlink" title="5.å‚è€ƒæ–‡æ¡£"></a>5.å‚è€ƒæ–‡æ¡£</h2><p><a href="https://www.515code.com/posts/egs95cdu/">SpringAOP-ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Ÿ</a></p><p><a href="https://www.xncoding.com/2017/07/24/spring/sb-aop.html">SpringBootç³»åˆ— - ä½¿ç”¨AOP</a></p><h2 id="6-GitHubæºç "><a href="#6-GitHubæºç " class="headerlink" title="6.GitHubæºç "></a>6.GitHubæºç </h2><p><a href="https://github.com/luffy997/SpringBootBucket/tree/main/springboot-aop">springboot-aop</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JWTä»‹ç»å’Œå®‰å…¨é˜²èŒƒä»¥åŠSpringBootæ•´åˆJWTå®ç°æ¥å£æƒé™è®¤è¯</title>
    <link href="/2021/01/03/JWT%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83%E4%BB%A5%E5%8F%8ASpringBoot%E6%95%B4%E5%90%88JWT%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81/"/>
    <url>/2021/01/03/JWT%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83%E4%BB%A5%E5%8F%8ASpringBoot%E6%95%B4%E5%90%88JWT%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81/</url>
    
    <content type="html"><![CDATA[<h1 id="JWTä»‹ç»å’Œå®‰å…¨é˜²èŒƒä»¥åŠSpringBooté›†æˆJWTå®ç°æ¥å£æƒé™è®¤è¯"><a href="#JWTä»‹ç»å’Œå®‰å…¨é˜²èŒƒä»¥åŠSpringBooté›†æˆJWTå®ç°æ¥å£æƒé™è®¤è¯" class="headerlink" title="JWTä»‹ç»å’Œå®‰å…¨é˜²èŒƒä»¥åŠSpringBooté›†æˆJWTå®ç°æ¥å£æƒé™è®¤è¯"></a><strong>JWTä»‹ç»å’Œå®‰å…¨é˜²èŒƒä»¥åŠSpringBooté›†æˆJWTå®ç°æ¥å£æƒé™è®¤è¯</strong></h1><p><img src="https://i.loli.net/2021/01/03/KRLVpsuZXa3rMH8.png"></p><h2 id="1-ä»€ä¹ˆæ˜¯JWT"><a href="#1-ä»€ä¹ˆæ˜¯JWT" class="headerlink" title="1.ä»€ä¹ˆæ˜¯JWT"></a>1.ä»€ä¹ˆæ˜¯JWT</h2><p>JSON Web Token (JWT) is an open standard (<a href="https://tools.ietf.org/html/rfc7519">RFC 7519</a>) that defines a compact and self-contained way for securely transmitting information between parties as a JSON object. This information can be verified and trusted because it is digitally signed. JWTs can be signed using a secret (with the <strong>HMAC</strong> algorithm) or a public&#x2F;private key pair using <strong>RSA</strong> or <strong>ECDSA</strong>.</p><p>â€‹ â€”[æ‘˜è‡ªå®˜ç½‘]</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1.ç¿»è¯‘</span><br><span class="hljs-bullet">-</span> å®˜ç½‘åœ°å€: https://jwt.io/introduction/<br><span class="hljs-bullet">-</span> ç¿»è¯‘: jsonwebtokenï¼ˆJWTï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼ˆrfc7519ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘çš„ã€è‡ªåŒ…å«çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä»¥JSONå¯¹è±¡å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚æ­¤ä¿¡æ¯å¯ä»¥éªŒè¯å’Œä¿¡ä»»ï¼Œå› ä¸ºå®ƒæ˜¯æ•°å­—ç­¾åçš„ã€‚jwtå¯ä»¥ä½¿ç”¨ç§˜å¯†ï¼ˆä½¿ç”¨HMACç®—æ³•ï¼‰æˆ–ä½¿ç”¨RSAæˆ–ECDSAçš„å…¬é’¥/ç§é’¥å¯¹è¿›è¡Œç­¾å<br><span class="hljs-section"># 2.é€šä¿—è§£é‡Š</span><br><span class="hljs-bullet">-</span> JWTç®€ç§°JSON Web Token,ä¹Ÿå°±æ˜¯é€šè¿‡JSONå½¢å¼ä½œä¸ºWebåº”ç”¨ä¸­çš„ä»¤ç‰Œ,ç”¨äºåœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°å°†ä¿¡æ¯ä½œä¸ºJSONå¯¹è±¡ä¼ è¾“ã€‚åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­è¿˜å¯ä»¥å®Œæˆæ•°æ®åŠ å¯†ã€ç­¾åç­‰ç›¸å…³å¤„ç†ã€‚<br></code></pre></td></tr></table></figure><h2 id="2-JWTèƒ½åšä»€ä¹ˆ"><a href="#2-JWTèƒ½åšä»€ä¹ˆ" class="headerlink" title="2.JWTèƒ½åšä»€ä¹ˆ"></a>2.JWTèƒ½åšä»€ä¹ˆ</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1.æˆæƒ</span><br><span class="hljs-bullet">-</span> è¿™æ˜¯ä½¿ç”¨JWTçš„æœ€å¸¸è§æ–¹æ¡ˆã€‚ä¸€æ—¦ç”¨æˆ·ç™»å½•ï¼Œæ¯ä¸ªåç»­è¯·æ±‚å°†åŒ…æ‹¬JWTï¼Œä»è€Œå…è®¸ç”¨æˆ·è®¿é—®è¯¥ä»¤ç‰Œå…è®¸çš„è·¯ç”±ï¼ŒæœåŠ¡å’Œèµ„æºã€‚å•ç‚¹ç™»å½•æ˜¯å½“ä»Šå¹¿æ³›ä½¿ç”¨JWTçš„ä¸€é¡¹åŠŸèƒ½ï¼Œå› ä¸ºå®ƒçš„å¼€é”€å¾ˆå°å¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„åŸŸä¸­è½»æ¾ä½¿ç”¨ã€‚<br><span class="hljs-section"># 2.ä¿¡æ¯äº¤æ¢</span><br><span class="hljs-bullet">-</span> JSON Web Tokenæ˜¯åœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯çš„å¥½æ–¹æ³•ã€‚å› ä¸ºå¯ä»¥å¯¹JWTè¿›è¡Œç­¾åï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨å…¬é’¥/ç§é’¥å¯¹ï¼‰ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥ç¡®ä¿å‘ä»¶äººæ˜¯ä»–ä»¬æ‰€è¯´çš„äººã€‚æ­¤å¤–ï¼Œç”±äºç­¾åæ˜¯ä½¿ç”¨æ ‡å¤´å’Œæœ‰æ•ˆè´Ÿè½½è®¡ç®—çš„ï¼Œå› æ­¤æ‚¨è¿˜å¯ä»¥éªŒè¯å†…å®¹æ˜¯å¦é­åˆ°ç¯¡æ”¹ã€‚<br></code></pre></td></tr></table></figure><h2 id="3-ä¸ºä»€ä¹ˆæ˜¯JWT"><a href="#3-ä¸ºä»€ä¹ˆæ˜¯JWT" class="headerlink" title="3.ä¸ºä»€ä¹ˆæ˜¯JWT"></a>3.ä¸ºä»€ä¹ˆæ˜¯JWT</h2><h3 id="åŸºäºä¼ ç»Ÿçš„Sessionè®¤è¯"><a href="#åŸºäºä¼ ç»Ÿçš„Sessionè®¤è¯" class="headerlink" title="åŸºäºä¼ ç»Ÿçš„Sessionè®¤è¯"></a>åŸºäºä¼ ç»Ÿçš„Sessionè®¤è¯</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1.è®¤è¯æ–¹å¼</span><br><span class="hljs-bullet">-</span> æˆ‘ä»¬çŸ¥é“ï¼Œhttpåè®®æœ¬èº«æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®ï¼Œè€Œè¿™å°±æ„å‘³ç€å¦‚æœç”¨æˆ·å‘æˆ‘ä»¬çš„åº”ç”¨æä¾›äº†ç”¨æˆ·åå’Œå¯†ç æ¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œç”¨æˆ·è¿˜è¦å†ä¸€æ¬¡è¿›è¡Œç”¨æˆ·è®¤è¯æ‰è¡Œï¼Œå› ä¸ºæ ¹æ®httpåè®®ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ï¼Œæ‰€ä»¥ä¸ºäº†è®©æˆ‘ä»¬çš„åº”ç”¨èƒ½è¯†åˆ«æ˜¯å“ªä¸ªç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ï¼Œæˆ‘ä»¬åªèƒ½åœ¨æœåŠ¡å™¨å­˜å‚¨ä¸€ä»½ç”¨æˆ·ç™»å½•çš„ä¿¡æ¯ï¼Œè¿™ä»½ç™»å½•ä¿¡æ¯ä¼šåœ¨å“åº”æ—¶ä¼ é€’ç»™æµè§ˆå™¨ï¼Œå‘Šè¯‰å…¶ä¿å­˜ä¸ºcookie,ä»¥ä¾¿ä¸‹æ¬¡è¯·æ±‚æ—¶å‘é€ç»™æˆ‘ä»¬çš„åº”ç”¨ï¼Œè¿™æ ·æˆ‘ä»¬çš„åº”ç”¨å°±èƒ½è¯†åˆ«è¯·æ±‚æ¥è‡ªå“ªä¸ªç”¨æˆ·äº†,è¿™å°±æ˜¯ä¼ ç»Ÿçš„åŸºäºsessionè®¤è¯ã€‚<br>t<br><span class="hljs-section"># 2.è®¤è¯æµç¨‹</span><br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/7zc3ZTKaImx251p.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 3.æš´éœ²é—®é¢˜</span><br><span class="hljs-bullet">-</span> 1.æ¯ä¸ªç”¨æˆ·ç»è¿‡æˆ‘ä»¬çš„åº”ç”¨è®¤è¯ä¹‹åï¼Œæˆ‘ä»¬çš„åº”ç”¨éƒ½è¦åœ¨æœåŠ¡ç«¯åšä¸€æ¬¡è®°å½•ï¼Œä»¥æ–¹ä¾¿ç”¨æˆ·ä¸‹æ¬¡è¯·æ±‚çš„é‰´åˆ«ï¼Œé€šå¸¸è€Œè¨€sessionéƒ½æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œéšç€è®¤è¯ç”¨æˆ·çš„å¢å¤šï¼ŒæœåŠ¡ç«¯çš„å¼€é”€ä¼šæ˜æ˜¾å¢å¤§<br><span class="hljs-bullet">-</span> 2.ç”¨æˆ·è®¤è¯ä¹‹åï¼ŒæœåŠ¡ç«¯åšè®¤è¯è®°å½•ï¼Œå¦‚æœè®¤è¯çš„è®°å½•è¢«ä¿å­˜åœ¨å†…å­˜ä¸­çš„è¯ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·ä¸‹æ¬¡è¯·æ±‚è¿˜å¿…é¡»è¦è¯·æ±‚åœ¨è¿™å°æœåŠ¡å™¨ä¸Š,è¿™æ ·æ‰èƒ½æ‹¿åˆ°æˆæƒçš„èµ„æºï¼Œè¿™æ ·åœ¨åˆ†å¸ƒå¼çš„åº”ç”¨ä¸Šï¼Œç›¸åº”çš„é™åˆ¶äº†è´Ÿè½½å‡è¡¡å™¨çš„èƒ½åŠ›ã€‚è¿™ä¹Ÿæ„å‘³ç€é™åˆ¶äº†åº”ç”¨çš„æ‰©å±•èƒ½åŠ›ã€‚<br><span class="hljs-bullet">-</span> 3.å› ä¸ºæ˜¯åŸºäºcookieæ¥è¿›è¡Œç”¨æˆ·è¯†åˆ«çš„, cookieå¦‚æœè¢«æˆªè·ï¼Œç”¨æˆ·å°±ä¼šå¾ˆå®¹æ˜“å—åˆ°è·¨ç«™è¯·æ±‚ä¼ªé€ çš„æ”»å‡»ã€‚<br><span class="hljs-bullet">-</span> 4.åœ¨å‰åç«¯åˆ†ç¦»ç³»ç»Ÿä¸­å°±æ›´åŠ ç—›è‹¦:å¦‚ä¸‹å›¾æ‰€ç¤º<br>ä¹Ÿå°±æ˜¯è¯´å‰åç«¯åˆ†ç¦»åœ¨åº”ç”¨è§£è€¦åå¢åŠ äº†éƒ¨ç½²çš„å¤æ‚æ€§ã€‚é€šå¸¸ç”¨æˆ·ä¸€æ¬¡è¯·æ±‚å°±è¦è½¬å‘å¤šæ¬¡ã€‚å¦‚æœç”¨session æ¯æ¬¡æºå¸¦sessionid åˆ°æœåŠ¡ å™¨ï¼ŒæœåŠ¡å™¨è¿˜è¦æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚åŒæ—¶å¦‚æœç”¨æˆ·å¾ˆå¤šã€‚è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­ï¼Œç»™æœåŠ¡å™¨å¢åŠ è´Ÿæ‹…ã€‚è¿˜æœ‰å°±æ˜¯CSRFï¼ˆè·¨ç«™ä¼ªé€ è¯·æ±‚æ”» å‡»ï¼‰æ”»å‡»ï¼Œsessionæ˜¯åŸºäºcookieè¿›è¡Œç”¨æˆ·è¯†åˆ«çš„, cookieå¦‚æœè¢«æˆªè·ï¼Œç”¨æˆ·å°±ä¼šå¾ˆå®¹æ˜“å—åˆ°è·¨ç«™è¯·æ±‚ä¼ªé€ çš„æ”»å‡»ã€‚è¿˜æœ‰å°±æ˜¯ sessionidå°±æ˜¯ä¸€ä¸ªç‰¹å¾å€¼ï¼Œè¡¨è¾¾çš„ä¿¡æ¯ä¸å¤Ÿä¸°å¯Œã€‚ä¸å®¹æ˜“æ‰©å±•ã€‚è€Œä¸”å¦‚æœä½ åç«¯åº”ç”¨æ˜¯å¤šèŠ‚ç‚¹éƒ¨ç½²ã€‚é‚£ä¹ˆå°±éœ€è¦å®ç°sessionå…±äº«æœºåˆ¶ã€‚ ä¸æ–¹ä¾¿é›†ç¾¤åº”ç”¨ã€‚<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/ENP3ft6qbITsgXx.png"></p><h3 id="åŸºäºJWTè®¤è¯"><a href="#åŸºäºJWTè®¤è¯" class="headerlink" title="åŸºäºJWTè®¤è¯"></a>åŸºäºJWTè®¤è¯</h3><p><img src="https://i.loli.net/2021/01/03/oVvBmUdWECah5Nc.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1.è®¤è¯æµç¨‹</span><br><span class="hljs-bullet">-</span> é¦–å…ˆï¼Œå‰ç«¯é€šè¿‡Webè¡¨å•å°†è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç å‘é€åˆ°åç«¯çš„æ¥å£ã€‚è¿™ä¸€è¿‡ç¨‹ä¸€èˆ¬æ˜¯ä¸€ä¸ªHTTP POSTè¯·æ±‚ã€‚å»ºè®®çš„æ–¹å¼æ˜¯é€šè¿‡SSLåŠ å¯†çš„ä¼ è¾“ï¼ˆhttpsåè®®ï¼‰ï¼Œä»è€Œé¿å…æ•æ„Ÿä¿¡æ¯è¢«å—…æ¢ã€‚<br><span class="hljs-bullet">-</span> åç«¯æ ¸å¯¹ç”¨æˆ·åå’Œå¯†ç æˆåŠŸåï¼Œå°†ç”¨æˆ·çš„idç­‰å…¶ä»–ä¿¡æ¯ä½œä¸ºJWT Payloadï¼ˆè´Ÿè½½ï¼‰ï¼Œå°†å…¶ä¸å¤´éƒ¨åˆ†åˆ«è¿›è¡ŒBase64ç¼–ç æ‹¼æ¥åç­¾åï¼Œå½¢æˆä¸€ä¸ªJWT(Token)ã€‚å½¢æˆçš„JWTå°±æ˜¯ä¸€ä¸ªå½¢åŒlll.zzz.xxxçš„å­—ç¬¦ä¸²ã€‚ token head.payload.singurater<br><span class="hljs-bullet">-</span> åç«¯å°†JWTå­—ç¬¦ä¸²ä½œä¸ºç™»å½•æˆåŠŸçš„è¿”å›ç»“æœè¿”å›ç»™å‰ç«¯ã€‚å‰ç«¯å¯ä»¥å°†è¿”å›çš„ç»“æœä¿å­˜åœ¨localStorageæˆ–sessionStorageä¸Šï¼Œé€€å‡ºç™»å½•æ—¶å‰ç«¯åˆ é™¤ä¿å­˜çš„JWTå³å¯ã€‚<br><span class="hljs-bullet">-</span> å‰ç«¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å°†JWTæ”¾å…¥HTTP Headerä¸­çš„Authorizationä½ã€‚(è§£å†³XSSå’ŒXSRFé—®é¢˜) HEADER<br><span class="hljs-bullet">-</span> åç«¯æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œå¦‚å­˜åœ¨éªŒè¯JWTçš„æœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œæ£€æŸ¥ç­¾åæ˜¯å¦æ­£ç¡®ï¼›æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸï¼›æ£€æŸ¥Tokençš„æ¥æ”¶æ–¹æ˜¯å¦æ˜¯è‡ªå·±ï¼ˆå¯é€‰ï¼‰ã€‚<br><span class="hljs-bullet">-</span> éªŒè¯é€šè¿‡ååç«¯ä½¿ç”¨JWTä¸­åŒ…å«çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œå…¶ä»–é€»è¾‘æ“ä½œï¼Œè¿”å›ç›¸åº”ç»“æœã€‚<br><span class="hljs-section"># 2.jwtä¼˜åŠ¿</span><br><span class="hljs-bullet">-</span> ç®€æ´(Compact): å¯ä»¥é€šè¿‡URLï¼ŒPOSTå‚æ•°æˆ–è€…åœ¨HTTP headerå‘é€ï¼Œå› ä¸ºæ•°æ®é‡å°ï¼Œä¼ è¾“é€Ÿåº¦ä¹Ÿå¾ˆå¿«<br><span class="hljs-bullet">-</span> è‡ªåŒ…å«(Self-contained)ï¼šè´Ÿè½½ä¸­åŒ…å«äº†æ‰€æœ‰ç”¨æˆ·æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“<br><span class="hljs-bullet">-</span> å› ä¸ºTokenæ˜¯ä»¥JSONåŠ å¯†çš„å½¢å¼ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ï¼Œæ‰€ä»¥JWTæ˜¯è·¨è¯­è¨€çš„ï¼ŒåŸåˆ™ä¸Šä»»ä½•webå½¢å¼éƒ½æ”¯æŒã€‚<br><span class="hljs-bullet">-</span> ä¸éœ€è¦åœ¨æœåŠ¡ç«¯ä¿å­˜ä¼šè¯ä¿¡æ¯ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼å¾®æœåŠ¡ã€‚<br></code></pre></td></tr></table></figure><h2 id="4-JWTçš„ç»“æ„æ˜¯ä»€ä¹ˆ"><a href="#4-JWTçš„ç»“æ„æ˜¯ä»€ä¹ˆ" class="headerlink" title="4.JWTçš„ç»“æ„æ˜¯ä»€ä¹ˆ?"></a>4.JWTçš„ç»“æ„æ˜¯ä»€ä¹ˆ?</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown">token string ====&gt; header.payload.singnature token<br><span class="hljs-section"># 1.ä»¤ç‰Œç»„æˆ</span><br><span class="hljs-bullet">-</span> 1.æ ‡å¤´(Header)<br><span class="hljs-bullet">-</span> 2.æœ‰æ•ˆè½½è·(Payload)<br><span class="hljs-bullet">-</span> 3.ç­¾å(Signature)<br><span class="hljs-bullet">-</span> å› æ­¤ï¼ŒJWTé€šå¸¸å¦‚ä¸‹æ‰€ç¤º:xxxxx.yyyyy.zzzzz Header.Payload.Signature<br></code></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 2.Header</span><br><span class="hljs-bullet">-</span> æ ‡å¤´é€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä»¤ç‰Œçš„ç±»å‹ï¼ˆå³JWTï¼‰å’Œæ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ï¼Œä¾‹å¦‚HMAC SHA256æˆ–RSAã€‚å®ƒä¼šä½¿ç”¨ Base64 ç¼–ç ç»„æˆ JWT ç»“æ„çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚<br><span class="hljs-bullet">-</span> æ³¨æ„:Base64æ˜¯ä¸€ç§ç¼–ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯å¯ä»¥è¢«ç¿»è¯‘å›åŸæ¥çš„æ ·å­æ¥çš„ã€‚å®ƒå¹¶ä¸æ˜¯ä¸€ç§åŠ å¯†è¿‡ç¨‹ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;alg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;HS256&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;typ&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;JWT&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 3.Payload</span><br><span class="hljs-bullet">-</span> ä»¤ç‰Œçš„ç¬¬äºŒéƒ¨åˆ†æ˜¯æœ‰æ•ˆè´Ÿè½½ï¼Œå…¶ä¸­åŒ…å«å£°æ˜ã€‚å£°æ˜æ˜¯æœ‰å…³å®ä½“ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·ï¼‰å’Œå…¶ä»–æ•°æ®çš„å£°æ˜ã€‚åŒæ ·çš„ï¼Œå®ƒä¼šä½¿ç”¨ Base64 ç¼–ç ç»„æˆ JWT ç»“æ„çš„ç¬¬äºŒéƒ¨åˆ†<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;sub&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1234567890&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;John Doe&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;admin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 4.Signature</span><br><span class="hljs-bullet">-</span> å‰é¢ä¸¤éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨ Base64 è¿›è¡Œç¼–ç çš„ï¼Œå³å‰ç«¯å¯ä»¥è§£å¼€çŸ¥é“é‡Œé¢çš„ä¿¡æ¯ã€‚Signature éœ€è¦ä½¿ç”¨ç¼–ç åçš„ header å’Œ payload ä»¥åŠæˆ‘ä»¬æä¾›çš„ä¸€ä¸ªå¯†é’¥ï¼Œç„¶åä½¿ç”¨ header ä¸­æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆHS256ï¼‰è¿›è¡Œç­¾åã€‚ç­¾åçš„ä½œç”¨æ˜¯ä¿è¯ JWT æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡<br><span class="hljs-bullet">-</span> å¦‚:<br>HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload),secret);<br><span class="hljs-section"># ç­¾åç›®çš„</span><br><span class="hljs-bullet">-</span> æœ€åä¸€æ­¥ç­¾åçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šæ˜¯å¯¹å¤´éƒ¨ä»¥åŠè´Ÿè½½å†…å®¹è¿›è¡Œç­¾åï¼Œé˜²æ­¢å†…å®¹è¢«çªœæ”¹ã€‚å¦‚æœæœ‰äººå¯¹å¤´éƒ¨ä»¥åŠè´Ÿè½½çš„å†…å®¹è§£ç ä¹‹åè¿›è¡Œä¿®æ”¹ï¼Œå†è¿›è¡Œç¼–ç ï¼Œæœ€ååŠ ä¸Šä¹‹å‰çš„ç­¾åç»„åˆå½¢æˆæ–°çš„JWTçš„è¯ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ç«¯ä¼šåˆ¤æ–­å‡ºæ–°çš„å¤´éƒ¨å’Œè´Ÿè½½å½¢æˆçš„ç­¾åå’ŒJWTé™„å¸¦ä¸Šçš„ç­¾åæ˜¯ä¸ä¸€æ ·çš„ã€‚å¦‚æœè¦å¯¹æ–°çš„å¤´éƒ¨å’Œè´Ÿè½½è¿›è¡Œç­¾åï¼Œåœ¨ä¸çŸ¥é“æœåŠ¡å™¨åŠ å¯†æ—¶ç”¨çš„å¯†é’¥çš„è¯ï¼Œå¾—å‡ºæ¥çš„ç­¾åä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚<br><span class="hljs-section"># ä¿¡æ¯å®‰å…¨é—®é¢˜</span><br><span class="hljs-bullet">-</span> åœ¨è¿™é‡Œå¤§å®¶ä¸€å®šä¼šé—®ä¸€ä¸ªé—®é¢˜ï¼šBase64æ˜¯ä¸€ç§ç¼–ç ï¼Œæ˜¯å¯é€†çš„ï¼Œé‚£ä¹ˆæˆ‘çš„ä¿¡æ¯ä¸å°±è¢«æš´éœ²äº†å—ï¼Ÿ<br><span class="hljs-bullet">-</span> æ˜¯çš„ã€‚æ‰€ä»¥ï¼Œåœ¨JWTä¸­ï¼Œä¸åº”è¯¥åœ¨è´Ÿè½½é‡Œé¢åŠ å…¥ä»»ä½•æ•æ„Ÿçš„æ•°æ®ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼ è¾“çš„æ˜¯ç”¨æˆ·çš„User IDã€‚è¿™ä¸ªå€¼å®é™…ä¸Šä¸æ˜¯ä»€ä¹ˆæ• æ„Ÿå†…å®¹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¢«çŸ¥é“ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯åƒå¯†ç è¿™æ ·çš„å†…å®¹å°±ä¸èƒ½è¢«æ”¾åœ¨JWTä¸­äº†ã€‚å¦‚æœå°†ç”¨æˆ·çš„å¯†ç æ”¾åœ¨äº†JWTä¸­ï¼Œé‚£ä¹ˆæ€€æœ‰æ¶æ„çš„ç¬¬ ä¸‰æ–¹é€šè¿‡Base64è§£ç å°±èƒ½å¾ˆå¿«åœ°çŸ¥é“ä½ çš„å¯†ç äº†ã€‚å› æ­¤JWTé€‚åˆç”¨äºå‘Webåº”ç”¨ä¼ é€’ä¸€äº›éæ•æ„Ÿä¿¡æ¯ã€‚JWTè¿˜ç»å¸¸ç”¨äºè®¾è®¡ç”¨æˆ·è®¤è¯å’Œæˆæƒç³» ç»Ÿï¼Œç”šè‡³å®ç°Webåº”ç”¨çš„å•ç‚¹ç™»å½•ã€‚<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/ihK6jSt4N2ZdJBI.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 5.æ”¾åœ¨ä¸€èµ·</span><br><span class="hljs-bullet">-</span> è¾“å‡ºæ˜¯ä¸‰ä¸ªç”±ç‚¹åˆ†éš”çš„Base64-URLå­—ç¬¦ä¸²ï¼Œå¯ä»¥åœ¨HTMLå’ŒHTTPç¯å¢ƒä¸­è½»æ¾ä¼ é€’è¿™äº›å­—ç¬¦ä¸²ï¼Œä¸åŸºäºXMLçš„æ ‡å‡†ï¼ˆä¾‹å¦‚SAMLï¼‰ç›¸æ¯”ï¼Œå®ƒæ›´ç´§å‡‘ã€‚<br><span class="hljs-bullet">-</span> ç®€æ´(Compact)<br>å¯ä»¥é€šè¿‡URL, POST å‚æ•°æˆ–è€…åœ¨ HTTP header å‘é€ï¼Œå› ä¸ºæ•°æ®é‡å°ï¼Œä¼ è¾“é€Ÿåº¦å¿«<br><span class="hljs-bullet">-</span> è‡ªåŒ…å«(Self-contained)<br>è´Ÿè½½ä¸­åŒ…å«äº†æ‰€æœ‰ç”¨æˆ·æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/yXNpgTKioFBeH41.png"></p><h2 id="5-æ”»å‡»é¢"><a href="#5-æ”»å‡»é¢" class="headerlink" title="5.æ”»å‡»é¢"></a>5.æ”»å‡»é¢</h2><h3 id="5-1æ•æ„Ÿä¿¡æ¯æ³„éœ²"><a href="#5-1æ•æ„Ÿä¿¡æ¯æ³„éœ²" class="headerlink" title="5.1æ•æ„Ÿä¿¡æ¯æ³„éœ²"></a>5.1æ•æ„Ÿä¿¡æ¯æ³„éœ²</h3><p>JWTä¸­çš„header å’Œ payload è™½ç„¶çœ‹èµ·æ¥ä¸å¯è¯»ï¼Œä½†å®é™…ä¸Šéƒ½åªç»è¿‡ç®€å•ç¼–ç ï¼Œ å¼€å‘è€…å¯èƒ½è¯¯å°†æ•æ„Ÿä¿¡æ¯å­˜å‚¨åœ¨é‡Œé¢ã€‚ä½¿ç”¨ä¸Šè¿°å·¥å…·å¯ä»¥æ–¹ä¾¿åœ°è§£ç JWTä¸­å‰ä¸¤éƒ¨åˆ†çš„ä¿¡æ¯ã€‚</p><h3 id="5-2æŒ‡å®šç®—æ³•ä¸ºnone"><a href="#5-2æŒ‡å®šç®—æ³•ä¸ºnone" class="headerlink" title="5.2æŒ‡å®šç®—æ³•ä¸ºnone"></a>5.2æŒ‡å®šç®—æ³•ä¸ºnone</h3><p>ä¸Šé¢æåˆ°ç®—æ³• none æ˜¯JWTè§„èŒƒä¸­å¼ºåˆ¶è¦æ±‚å®ç°çš„ï¼Œä½†æœ‰äº›å®ç°JWTçš„åº“ç›´æ¥å°†ä½¿ç”¨none ç®—æ³•çš„tokenè§†ä¸ºå·²ç»è¿‡æ ¡éªŒã€‚ è¿™æ ·æ”»å‡»è€…å°±å¯ä»¥è®¾ç½®alg ä¸ºnone ï¼Œä½¿signature éƒ¨åˆ†ä¸ºç©ºï¼Œç„¶åæ„é€ åŒ…å«ä»»æ„payload çš„JWTæ¥æ¬ºéª—æœåŠ¡ç«¯ã€‚</p><h3 id="5-3å°†ç­¾åç®—æ³•ä»éå¯¹ç§°ç±»å‹æ”¹ä¸ºå¯¹ç§°ç±»å‹"><a href="#5-3å°†ç­¾åç®—æ³•ä»éå¯¹ç§°ç±»å‹æ”¹ä¸ºå¯¹ç§°ç±»å‹" class="headerlink" title="5.3å°†ç­¾åç®—æ³•ä»éå¯¹ç§°ç±»å‹æ”¹ä¸ºå¯¹ç§°ç±»å‹"></a>5.3å°†ç­¾åç®—æ³•ä»éå¯¹ç§°ç±»å‹æ”¹ä¸ºå¯¹ç§°ç±»å‹</h3><p>ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆä¸»è¦åŸºäºRSAã€ECDSAï¼Œå¦‚S256ï¼‰åˆ†å‘JWTçš„è¿‡ç¨‹æ˜¯ä½¿ç”¨ç§é’¥ï¼ˆprivateï¼‰åŠ å¯†ç”ŸæˆJWTï¼Œä½¿ç”¨å…¬é’¥ï¼ˆpublicï¼‰è§£å¯†éªŒè¯ã€‚</p><p>ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆä¸»è¦åŸºäºHMACï¼Œå¦‚HS256ï¼‰åˆ†å‘JWTçš„è¿‡ç¨‹æ˜¯ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ï¼ˆsecretï¼‰ç”Ÿæˆå’ŒéªŒè¯JWTã€‚</p><p>å¦‚æœæœåŠ¡ç«¯æœŸå¾…æ”¶åˆ°çš„ç®—æ³•ç±»å‹ä¸ºRS256ï¼Œç„¶åä»¥RS256å’Œpublicå»éªŒè¯JWTï¼Œè€Œå®é™…ä¸Šæ”¶åˆ°çš„ç®—æ³•ç±»å‹æ˜¯HS256ï¼Œ é‚£ä¹ˆæœåŠ¡ç«¯å°±å¯èƒ½å°è¯•æŠŠpublicå½“ä½œsecretï¼Œç„¶åç”¨HS256ç®—æ³•è§£å¯†éªŒè¯JWTã€‚</p><p>ç”±äºRS256çš„publicäººäººéƒ½å¯è·å¾—ï¼Œæ”»å‡»è€…å¯ä»¥é¢„å…ˆä»¥publicä¸ºå¯†é’¥ï¼Œç”¨HS256ç®—æ³•ä¼ªé€ åŒ…å«ä»»æ„payload çš„JWTï¼Œä»è€ŒæˆåŠŸé€šè¿‡æœåŠ¡ç«¯çš„éªŒè¯ã€‚</p><h3 id="5-4çˆ†ç ´å¯†é’¥"><a href="#5-4çˆ†ç ´å¯†é’¥" class="headerlink" title="5.4çˆ†ç ´å¯†é’¥"></a>5.4çˆ†ç ´å¯†é’¥</h3><p>WTçš„å®‰å…¨æ€§ä¾èµ–äºå¯†é’¥çš„ä¿å¯†æ€§ï¼Œä»»ä½•æ‹¥æœ‰å¯†é’¥çš„äººéƒ½å¯ä»¥æ„é€ ä»»ä½•å†…å®¹çš„åˆæ³•tokenã€‚</p><p>å½“ä¸€ä¸ªJSON Web Token è¢«åˆ†å‘å‡ºå»ï¼Œå¦‚æœå¯†é’¥ä¸å¤Ÿå¼ºå£®å°±å­˜åœ¨è¢«çˆ†ç ´çš„é£é™©ï¼Œè€Œä¸”æ•´ä¸ªçˆ†ç ´è¿‡ç¨‹å¯ä»¥ç¦»çº¿è¿›è¡Œã€‚</p><p>å·²ç»æœ‰äººå†™äº†ä¸€äº›å·¥å…·ï¼Œæ¨èå¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/jmaxxz/jwtbrute">jwtbrute</a></li><li><a href="https://github.com/Sjord/jwtcrack/blob/master/crackjwt.py">Sjordâ€™ python script</a></li><li><a href="https://github.com/magnumripper/JohnTheRipper">John the Ripper</a></li></ul><h3 id="5-5ä¼ªé€ å¯†é’¥"><a href="#5-5ä¼ªé€ å¯†é’¥" class="headerlink" title="5.5ä¼ªé€ å¯†é’¥"></a>5.5ä¼ªé€ å¯†é’¥</h3><p>æ—¶JWTé‡‡ç”¨header ä¸­çš„kid å­—æ®µå…³è”æ ¡éªŒç®—æ³•çš„å¯†é’¥ï¼Œè¿™ä¸ªå¯†é’¥å¯èƒ½æ˜¯å¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼Œä¹Ÿå¯èƒ½æ˜¯éå¯¹ç§°åŠ å¯†çš„å…¬é’¥ã€‚ å¦‚æœèƒ½å¤ŸçŒœæµ‹kid å’Œ å¯†é’¥çš„å…³è”æ€§ï¼Œæ”»å‡»è€…å°±å¯èƒ½ä¿®æ”¹kid æ¥æ¬ºéª—æœåŠ¡ç«¯ï¼Œä½¿å…¶æ ¡éªŒæ—¶ä½¿ç”¨æ”»å‡»è€…å¯æ§çš„å¯†é’¥ï¼Œ äºæ˜¯æ”»å‡»è€…å°±å¯ä»¥ä¼ªé€ ä»»æ„å†…å®¹çš„å¯é€šè¿‡æ ¡éªŒçš„JWTã€‚</p><h2 id="6-å®‰å…¨å»ºè®®"><a href="#6-å®‰å…¨å»ºè®®" class="headerlink" title="6.å®‰å…¨å»ºè®®"></a>6.å®‰å…¨å»ºè®®</h2><p>éªŒè¯å‡½æ•°åº”å¿½ç•¥JWTä¸­çš„algo å­—æ®µï¼Œé¢„å…ˆå°±æ˜ç¡®JWTä½¿ç”¨çš„ç®—æ³•ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å¤šç§ç®—æ³•ï¼Œå¯ä»¥åœ¨header ä¸­ä½¿ç”¨è¡¨ç¤ºâ€key IDâ€ çš„kid å­—æ®µï¼ŒæŸ¥è¯¢æ¯ä¸ªkid å¯¹åº”çš„ç®—æ³•ã€‚ JWT&#x2F;JWS æ ‡å‡†åº”è¯¥ç§»é™¤ header ä¸­çš„algo å­—æ®µã€‚JWTçš„è®¸å¤šå®‰å…¨ç¼ºé™·éƒ½æ¥è‡ªäºå¼€å‘è€…ä¾èµ–è¿™ä¸€å®¢æˆ·ç«¯å¯æ§çš„å­—æ®µã€‚ å¼€å‘è€…åº”å‡çº§ç›¸åº”åº“åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå› ä¸ºæ—§ç‰ˆæœ¬å¯èƒ½å­˜åœ¨è‡´å‘½ç¼ºé™·ã€‚</p><ol><li>ä¸åº”è¯¥åœ¨jwtçš„payloadéƒ¨åˆ†å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¯¥éƒ¨åˆ†æ˜¯å®¢æˆ·ç«¯å¯è§£å¯†çš„éƒ¨åˆ†ã€‚</li><li>ä¿æŠ¤å¥½secretç§é’¥ï¼Œè¯¥ç§é’¥éå¸¸é‡è¦ã€‚</li><li>è¯·ä½¿ç”¨httpsçš„å®‰å…¨é€šé“è¿›è¡Œä¼ è¾“</li><li>éªŒè¯å‡½æ•°åº”å¿½ç•¥JWTä¸­çš„algo å­—æ®µï¼Œé¢„å…ˆå°±æ˜ç¡®JWTä½¿ç”¨çš„ç®—æ³•ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å¤šç§ç®—æ³•ï¼Œ å¯ä»¥åœ¨headerä¸­ä½¿ç”¨è¡¨ç¤ºâ€key IDâ€çš„kidå­—æ®µï¼ŒæŸ¥è¯¢æ¯ä¸ªkidå¯¹åº”çš„ç®—æ³•ã€‚</li><li>JWT&#x2F;JWS æ ‡å‡†åº”è¯¥ç§»é™¤ header ä¸­çš„algo å­—æ®µã€‚JWTçš„è®¸å¤šå®‰å…¨ç¼ºé™·éƒ½æ¥è‡ªäºå¼€å‘è€…ä¾èµ–è¿™ä¸€å®¢æˆ·ç«¯å¯æ§çš„å­—æ®µã€‚</li><li>å¼€å‘è€…åº”å‡çº§ç›¸åº”åº“åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå› ä¸ºæ—§ç‰ˆæœ¬å¯èƒ½å­˜åœ¨è‡´å‘½ç¼ºé™·ã€‚</li></ol><h2 id="7-ä½¿ç”¨JWT"><a href="#7-ä½¿ç”¨JWT" class="headerlink" title="7.ä½¿ç”¨JWT"></a>7.ä½¿ç”¨JWT</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1.å¼•å…¥ä¾èµ–</span><br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¼•å…¥jwt--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.auth0<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>java-jwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 2.ç”Ÿæˆtoken</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Calendar</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> Calendar.getInstance();<br>instance.add(Calendar.SECOND, <span class="hljs-number">90</span>);<br><span class="hljs-comment">//ç”Ÿæˆä»¤ç‰Œ</span><br><span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> JWT.create()<br>.withClaim(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>)<span class="hljs-comment">//è®¾ç½®è‡ªå®šä¹‰ç”¨æˆ·å</span><br>.withExpiresAt(instance.getTime())<span class="hljs-comment">//è®¾ç½®è¿‡æœŸæ—¶é—´</span><br>.sign(Algorithm.HMAC256(<span class="hljs-string">&quot;token!Q2W#E$RW&quot;</span>));<span class="hljs-comment">//è®¾ç½®ç­¾å ä¿å¯† å¤æ‚</span><br><span class="hljs-comment">//è¾“å‡ºä»¤ç‰Œ</span><br>System.out.println(token);<br></code></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> ç”Ÿæˆç»“æœ<br>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOlsicGhvbmUiLCIxNDMyMzIzNDEzNCJdLCJleHAiOjE1OTU3Mzk0NDIsInVzZXJuYW1lIjoi5byg5LiJIn0.aHmE3RNqvAjFr\<span class="hljs-emphasis">_dvyn\_</span>sD2VJ46P7EGiS5OBMO\<span class="hljs-emphasis">_TI5jg</span><br></code></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 3.æ ¹æ®ä»¤ç‰Œå’Œç­¾åè§£ææ•°æ®</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">JWTVerifier</span> <span class="hljs-variable">jwtVerifier</span> <span class="hljs-operator">=</span> JWT.require(Algorithm.HMAC256(<span class="hljs-string">&quot;token!Q2W#E$RW&quot;</span>)).build();<br><span class="hljs-type">DecodedJWT</span> <span class="hljs-variable">decodedJWT</span> <span class="hljs-operator">=</span> jwtVerifier.verify(token);<br>System.out.println(<span class="hljs-string">&quot;ç”¨æˆ·å: &quot;</span> + decodedJWT.getClaim(<span class="hljs-string">&quot;username&quot;</span>).asString());<br>System.out.println(<span class="hljs-string">&quot;è¿‡æœŸæ—¶é—´: &quot;</span>+decodedJWT.getExpiresAt());<br></code></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 4.å¸¸è§å¼‚å¸¸ä¿¡æ¯</span><br><span class="hljs-bullet">-</span> SignatureVerificationException: ç­¾åä¸ä¸€è‡´å¼‚å¸¸<br><span class="hljs-bullet">-</span> TokenExpiredException: ä»¤ç‰Œè¿‡æœŸå¼‚å¸¸<br><span class="hljs-bullet">-</span> AlgorithmMismatchException: ç®—æ³•ä¸åŒ¹é…å¼‚å¸¸<br><span class="hljs-bullet">-</span> InvalidClaimException: å¤±æ•ˆçš„payloadå¼‚å¸¸<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/FVD7cj2vuTghE6P.png" alt="image-20200805184517282.png"></p><h2 id="8-å°è£…å·¥å…·ç±»"><a href="#8-å°è£…å·¥å…·ç±»" class="headerlink" title="8. å°è£…å·¥å…·ç±»"></a>8. å°è£…å·¥å…·ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JWTUtils</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOKEN</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;token!Q@W3e4r&quot;</span>;<br>/\*\*<br>\* ç”Ÿæˆtoken<br>\* <span class="hljs-meta">@param</span> map <span class="hljs-comment">//ä¼ å…¥payload</span><br>\* <span class="hljs-meta">@return</span> è¿”å›token<br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getToken</span><span class="hljs-params">(Map&lt;String,String&gt; map)</span>&#123;<br>JWTCreator.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> JWT.create();<br>map.forEach((k,v)-&gt;&#123;<br>builder.withClaim(k,v);<br>&#125;);<br><span class="hljs-type">Calendar</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> Calendar.getInstance();<br>instance.add(Calendar.SECOND,<span class="hljs-number">7</span>);<br>builder.withExpiresAt(instance.getTime());<br><span class="hljs-keyword">return</span> builder.sign(Algorithm.HMAC256(TOKEN)).toString();<br>&#125;<br>/\*\*<br>\* éªŒè¯token<br>\* <span class="hljs-meta">@param</span> token<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">verify</span><span class="hljs-params">(String token)</span>&#123;<br>JWT.require(Algorithm.HMAC256(TOKEN)).build().verify(token);<br>&#125;<br>/\*\*<br>\* è·å–tokenä¸­payload<br>\* <span class="hljs-meta">@param</span> token<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DecodedJWT <span class="hljs-title function_">getToken</span><span class="hljs-params">(String token)</span>&#123;<br><span class="hljs-keyword">return</span> JWT.require(Algorithm.HMAC256(TOKEN)).build().verify(token);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="9-æ•´åˆspringboot"><a href="#9-æ•´åˆspringboot" class="headerlink" title="9.æ•´åˆspringboot"></a>9.æ•´åˆspringboot</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 0.æ­å»ºspringboot+mybatis+jwtç¯å¢ƒ</span><br><span class="hljs-bullet">-</span> å¼•å…¥ä¾èµ–<br><span class="hljs-bullet">-</span> ç¼–å†™é…ç½®<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¼•å…¥jwt--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.auth0<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>java-jwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--å¼•å…¥mybatis--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--å¼•å…¥lombok--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--å¼•å…¥druid--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.19<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--å¼•å…¥mysql--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.38<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">server.port</span>=<span class="hljs-string">8989</span><br><span class="hljs-attr">spring.application.name</span>=<span class="hljs-string">jwt</span><br><span class="hljs-attr">spring.datasource.type</span>=<span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br><span class="hljs-attr">spring.datasource.driver-class-name</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><br><span class="hljs-attr">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/jwt?characterEncoding=UTF-8</span><br><span class="hljs-attr">spring.datasource.username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">mybatis.type-aliases-package</span>=<span class="hljs-string">com.baizhi.entity</span><br><span class="hljs-attr">mybatis.mapper-locations</span>=<span class="hljs-string">classpath:com/baizhi/mapper/\*.xml</span><br><span class="hljs-attr">logging.level.com.baizhi.dao</span>=<span class="hljs-string">debug</span><br></code></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 1.å¼€å‘æ•°æ®åº“</span><br><span class="hljs-bullet">-</span> è¿™é‡Œé‡‡ç”¨æœ€ç®€å•çš„è¡¨ç»“æ„éªŒè¯JWTä½¿ç”¨<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/Gut2MTg6e8LpiPJ.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `<span class="hljs-keyword">user</span>`;<br><span class="hljs-keyword">CREATE TABLE</span> `<span class="hljs-keyword">user</span>` (<br>`id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT NULL</span> AUTO\_INCREMENT COMMENT <span class="hljs-string">&#x27;ä¸»é”®&#x27;</span>,<br>`name` <span class="hljs-type">varchar</span>(<span class="hljs-number">80</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>,<br>`password` <span class="hljs-type">varchar</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;ç”¨æˆ·å¯†ç &#x27;</span>,<br><span class="hljs-keyword">PRIMARY KEY</span> (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO\_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br></code></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 2.å¼€å‘entity</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Accessors(chain=true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br><span class="hljs-keyword">private</span> String id;<br><span class="hljs-keyword">private</span> String name;<br><span class="hljs-keyword">private</span> String password;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/1L4jdvUKZWnNtSb.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 3.å¼€å‘DAOæ¥å£å’Œmapper.xml</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDAO</span> &#123;<br>User <span class="hljs-title function_">login</span><span class="hljs-params">(User user)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/gyLSMHvw5rNUWYF.png" alt="image-20200805213603655.png"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.baizhi.dao.UserDAO&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!--è¿™é‡Œå°±å†™çš„ç®€å•ç‚¹äº†æ¯•ç«Ÿä¸æ˜¯é‡ç‚¹--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;User&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>select \* from user where name=#&#123;name&#125; and password = #&#123;password&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/irCLvOdeEsYZkRT.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 4.å¼€å‘Service æ¥å£ä»¥åŠå®ç°ç±»</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br>User <span class="hljs-title function_">login</span><span class="hljs-params">(User user)</span>;<span class="hljs-comment">//ç™»å½•æ¥å£</span><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/85eiXrKvPRV4Eqh.png" alt="image-20200805213648147.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> UserDAO userDAO;<br><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Transactional(propagation = Propagation.SUPPORTS)</span><br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">login</span><span class="hljs-params">(User user)</span> &#123;<br><span class="hljs-type">User</span> <span class="hljs-variable">userDB</span> <span class="hljs-operator">=</span> userDAO.login(user);<br><span class="hljs-keyword">if</span>(userDB!=<span class="hljs-literal">null</span>)&#123;<br><span class="hljs-keyword">return</span> userDB;<br>&#125;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;ç™»å½•å¤±è´¥~~&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/58Yh6ZcsftpGwXl.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 5.å¼€å‘controller</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> UserService userService;<br><span class="hljs-meta">@GetMapping(&quot;/user/login&quot;)</span><br><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title function_">login</span><span class="hljs-params">(User user)</span> &#123;<br>Map&lt;String,Object&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>log.info(<span class="hljs-string">&quot;ç”¨æˆ·å: [&#123;&#125;]&quot;</span>, user.getName());<br>log.info(<span class="hljs-string">&quot;å¯†ç : [&#123;&#125;]&quot;</span>, user.getPassword());<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-type">User</span> <span class="hljs-variable">userDB</span> <span class="hljs-operator">=</span> userService.login(user);<br>Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<span class="hljs-comment">//ç”¨æ¥å­˜æ”¾payload</span><br>map.put(<span class="hljs-string">&quot;id&quot;</span>,userDB.getId());<br>map.put(<span class="hljs-string">&quot;username&quot;</span>, userDB.getName());<br><span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> JWTUtils.getToken(map);<br>result.put(<span class="hljs-string">&quot;state&quot;</span>,<span class="hljs-literal">true</span>);<br>result.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;ç™»å½•æˆåŠŸ!!!&quot;</span>);<br>result.put(<span class="hljs-string">&quot;token&quot;</span>,token); <span class="hljs-comment">//æˆåŠŸè¿”å›tokenä¿¡æ¯</span><br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>result.put(<span class="hljs-string">&quot;state&quot;</span>,<span class="hljs-string">&quot;false&quot;</span>);<br>result.put(<span class="hljs-string">&quot;msg&quot;</span>,e.getMessage());<br>&#125;<br><span class="hljs-keyword">return</span> result;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/3QL85NecUd2uwH6.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 6.æ•°æ®åº“æ·»åŠ æµ‹è¯•æ•°æ®å¯åŠ¨é¡¹ç›®</span><br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/eFZQzWXhUO9cpLR.png"></p><p><img src="https://i.loli.net/2021/01/03/fQtoqvOH4gmnd62.png" alt="image-20200805214424786.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 7.é€šè¿‡postmanæ¨¡æ‹Ÿç™»å½•å¤±è´¥</span><br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/65xukczt3PUyEiv.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 8.é€šè¿‡postmanæ¨¡æ‹Ÿç™»å½•æˆåŠŸ</span><br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/sGOpZEWBjRFIxXi.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 9.ç¼–å†™æµ‹è¯•æ¥å£</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/test/test&quot;)</span><br><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">test</span><span class="hljs-params">(String token)</span> &#123;<br>Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-keyword">try</span> &#123;<br>JWTUtils.verify(token);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;éªŒè¯é€šè¿‡~~~&quot;</span>);<br>map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-literal">true</span>);<br>&#125; <span class="hljs-keyword">catch</span> (TokenExpiredException e) &#123;<br>map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-literal">false</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;Tokenå·²ç»è¿‡æœŸ!!!&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (SignatureVerificationException e)&#123;<br>map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-literal">false</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;ç­¾åé”™è¯¯!!!&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (AlgorithmMismatchException e)&#123;<br>map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-literal">false</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;åŠ å¯†ç®—æ³•ä¸åŒ¹é…!!!&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-literal">false</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;æ— æ•ˆtoken~~&quot;</span>);<br>&#125;<br><span class="hljs-keyword">return</span> map;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/01/03/aF7HtC3qgjOuNJo.png"></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 10.é€šè¿‡postmanè¯·æ±‚æ¥å£</span><br></code></pre></td></tr></table></figure><p><a href="https://imgchr.com/i/sp5yod"><img src="https://s3.ax1x.com/2021/01/03/sp5yod.png"></a><br><a href="https://imgchr.com/i/sp5sdH"><img src="https://s3.ax1x.com/2021/01/03/sp5sdH.png"></a></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 11.é—®é¢˜?</span><br><span class="hljs-bullet">-</span> ä½¿ç”¨ä¸Šè¿°æ–¹å¼æ¯æ¬¡éƒ½è¦ä¼ é€’tokenæ•°æ®,æ¯ä¸ªæ–¹æ³•éƒ½éœ€è¦éªŒè¯tokenä»£ç å†—ä½™,ä¸å¤Ÿçµæ´»? å¦‚ä½•ä¼˜åŒ–<br><span class="hljs-bullet">-</span> ä½¿ç”¨æ‹¦æˆªå™¨è¿›è¡Œä¼˜åŒ–<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;token&quot;</span>);<br>Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-keyword">try</span> &#123;<br>JWTUtils.verify(token);<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125; <span class="hljs-keyword">catch</span> (TokenExpiredException e) &#123;<br>map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-literal">false</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;Tokenå·²ç»è¿‡æœŸ!!!&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (SignatureVerificationException e)&#123;<br>map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-literal">false</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;ç­¾åé”™è¯¯!!!&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (AlgorithmMismatchException e)&#123;<br>map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-literal">false</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;åŠ å¯†ç®—æ³•ä¸åŒ¹é…!!!&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>e.printStackTrace();<br>map.put(<span class="hljs-string">&quot;state&quot;</span>, <span class="hljs-literal">false</span>);<br>map.put(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;æ— æ•ˆtoken~~&quot;</span>);<br>&#125;<br><span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>().writeValueAsString(map);<br>response.setContentType(<span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>);<br>response.getWriter().println(json);<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InterceptorConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JwtTokenInterceptor</span>()).<br>excludePathPatterns(<span class="hljs-string">&quot;/user/\*\*&quot;</span>)<br>.addPathPatterns(<span class="hljs-string">&quot;/\*\*&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="10-å‚è€ƒæ–‡ç« "><a href="#10-å‚è€ƒæ–‡ç« " class="headerlink" title="10.å‚è€ƒæ–‡ç« "></a>10.å‚è€ƒæ–‡ç« </h2><ul><li><a href="https://www.jianshu.com/p/576dbf44b2ae">ä»€ä¹ˆæ˜¯ JWT â€“ JSON WEB TOKEN</a></li><li><a href="https://findneo.github.io/180503jwt/">JSON Web Tokençš„è®¤è¯†ä¸æ”»å‡»</a></li><li><a href="https://www.xncoding.com/2017/06/22/security/jwt.html">JWTä»‹ç»å’Œå®‰å…¨é˜²èŒƒ</a></li></ul><h2 id="11-GitHubæºç "><a href="#11-GitHubæºç " class="headerlink" title="11.GitHubæºç "></a>11.GitHubæºç </h2><p><a href="https://github.com/luffy997/springboot-jwt">springboot-jwt</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SSMå®ç°å‰åç«¯åˆ†ç¦»ï¼Œæ•´åˆhtmlä½œä¸ºè§†å›¾å¼•æ“ï¼Œè§£å†³è·¨åŸŸå’Œæ‹¦æˆªé—®é¢˜</title>
    <link href="/2020/12/21/SSM%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%8C%E6%95%B4%E5%90%88html%E4%BD%9C%E4%B8%BA%E8%A7%86%E5%9B%BE%E5%BC%95%E6%93%8E%EF%BC%8C%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E5%92%8C%E6%8B%A6%E6%88%AA%E9%97%AE%E9%A2%98/"/>
    <url>/2020/12/21/SSM%E5%AE%9E%E7%8E%B0%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%8C%E6%95%B4%E5%90%88html%E4%BD%9C%E4%B8%BA%E8%A7%86%E5%9B%BE%E5%BC%95%E6%93%8E%EF%BC%8C%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E5%92%8C%E6%8B%A6%E6%88%AA%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="SSMå®ç°å‰åç«¯åˆ†ç¦»ï¼Œæ•´åˆhtmlä½œä¸ºè§†å›¾å¼•æ“ï¼Œè§£å†³è·¨åŸŸå’Œæ‹¦æˆªé—®é¢˜"><a href="#SSMå®ç°å‰åç«¯åˆ†ç¦»ï¼Œæ•´åˆhtmlä½œä¸ºè§†å›¾å¼•æ“ï¼Œè§£å†³è·¨åŸŸå’Œæ‹¦æˆªé—®é¢˜" class="headerlink" title="SSMå®ç°å‰åç«¯åˆ†ç¦»ï¼Œæ•´åˆhtmlä½œä¸ºè§†å›¾å¼•æ“ï¼Œè§£å†³è·¨åŸŸå’Œæ‹¦æˆªé—®é¢˜"></a>SSMå®ç°å‰åç«¯åˆ†ç¦»ï¼Œæ•´åˆhtmlä½œä¸ºè§†å›¾å¼•æ“ï¼Œè§£å†³è·¨åŸŸå’Œæ‹¦æˆªé—®é¢˜</h1><p>æŒ‰ç…§csdnæŸ¥çš„è¯´sping4.2ä»¥ä¸Šçš„jar è·¨åŸŸä½¿ç”¨@CrosssOrginæ³¨è§£å°±å¯ä»¥è·¨åŸŸäº†ä½†æˆ‘ä¸çŸ¥é“ä¸ºå•¥æ²¡æœ‰ç”¨ã€‚ä¸è¿‡ä½¿ç”¨è·¨åŸŸè¿‡æ»¤å™¨å·¥å…·ç±»çš„æ–¹å¼è§£å†³çš„è·¨åŸŸé—®é¢˜ï¼Œåç«¯çš„jsonæ•°æ®èƒ½å¤Ÿè·¨åŸŸè¢«æ¥æ”¶åˆ°ã€‚</p><h2 id="1-å†™CrossingFilterè¿‡æ»¤å™¨ç±»ï¼Œå®ç°-Interfaces-æœ¬åœ°ApacheTomcatçš„Filteræ¥å£"><a href="#1-å†™CrossingFilterè¿‡æ»¤å™¨ç±»ï¼Œå®ç°-Interfaces-æœ¬åœ°ApacheTomcatçš„Filteræ¥å£" class="headerlink" title="1. å†™CrossingFilterè¿‡æ»¤å™¨ç±»ï¼Œå®ç°(Interfaces)æœ¬åœ°ApacheTomcatçš„Filteræ¥å£"></a>1. å†™CrossingFilterè¿‡æ»¤å™¨ç±»ï¼Œå®ç°(Interfaces)æœ¬åœ°ApacheTomcatçš„Filteræ¥å£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> javax.servlet.Filter;<br><span class="hljs-keyword">import</span> javax.servlet.FilterChain;<br><span class="hljs-keyword">import</span> javax.servlet.FilterConfig;<br><span class="hljs-keyword">import</span> javax.servlet.ServletException;<br><span class="hljs-keyword">import</span> javax.servlet.ServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.ServletResponse;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CrossingFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isCross</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>isCross = <span class="hljs-literal">false</span>;<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span><br><span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br><span class="hljs-keyword">if</span> (isCross) &#123;<br><span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">httpServletRequest</span> <span class="hljs-operator">=</span> (HttpServletRequest) request;<br><span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">httpServletResponse</span> <span class="hljs-operator">=</span> (HttpServletResponse) response;<br>System.out.println(<span class="hljs-string">&quot;æ‹¦æˆªè¯·æ±‚: &quot;</span> + httpServletRequest.getServletPath());<br>httpServletResponse.setHeader(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="hljs-string">&quot;\*&quot;</span>);<br><span class="hljs-comment">// httpServletResponse.setHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;\*&quot;); // è¡¨ç¤ºæ‰€æœ‰è¯·æ±‚éƒ½æœ‰æ•ˆ</span><br>httpServletResponse.setHeader(<span class="hljs-string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="hljs-string">&quot;POST, GET, OPTIONS, DELETE&quot;</span>);<br>httpServletResponse.setHeader(<span class="hljs-string">&quot;Access-Control-Max-Age&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>);<br>httpServletResponse.setHeader(<span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>,<br><span class="hljs-string">&quot;Origin, No-Cache, X-Requested-With, If-Modified-Since, Pragma, Last-Modified, Cache-Control, Expires, Content-Type, X-E4M-With,userId,token&quot;</span>);<br>httpServletResponse.setHeader(<span class="hljs-string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<br>httpServletResponse.setHeader(<span class="hljs-string">&quot;XDomainRequestAllowed&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>&#125;<br>chain.doFilter(request, response);<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br><span class="hljs-type">String</span> <span class="hljs-variable">isCrossStr</span> <span class="hljs-operator">=</span> filterConfig.getInitParameter(<span class="hljs-string">&quot;IsCross&quot;</span>);<br>isCross = isCrossStr.equals(<span class="hljs-string">&quot;true&quot;</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;<br>System.out.println(<span class="hljs-string">&quot;è·¨åŸŸå¼€å¯çŠ¶æ€ï¼š&quot;</span> + isCrossStr);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-åœ¨web-xmlæ–‡ä»¶ä¸­æ³¨å†ŒCrossingFilterè¿‡æ»¤å™¨"><a href="#2-åœ¨web-xmlæ–‡ä»¶ä¸­æ³¨å†ŒCrossingFilterè¿‡æ»¤å™¨" class="headerlink" title="2. åœ¨web.xmlæ–‡ä»¶ä¸­æ³¨å†ŒCrossingFilterè¿‡æ»¤å™¨"></a>2. åœ¨web.xmlæ–‡ä»¶ä¸­æ³¨å†ŒCrossingFilterè¿‡æ»¤å™¨</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- é…ç½®è·¨åŸŸè¿‡æ»¤å™¨ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>CrossingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>com.dev.filter.CrossingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>IsCross<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>CrossingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/\*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="3-é…ç½®web-xmlï¼Œä¸æ‹¦æˆª-html"><a href="#3-é…ç½®web-xmlï¼Œä¸æ‹¦æˆª-html" class="headerlink" title="3. é…ç½®web.xmlï¼Œä¸æ‹¦æˆª.html"></a>3. é…ç½®web.xmlï¼Œä¸æ‹¦æˆª.html</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--é…ç½®è¯¥æ®µä»£ç è¡¨ç¤ºå¯¹htmlè¯·æ±‚ä¸é˜»æŒ¡--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>default<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>\*.html<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>æ€»ç»“ï¼šSSMæˆ‘åœ¨å­¦çš„æ—¶å€™å°±è§è¯†äº†å®ƒé…ç½®çš„å¤æ‚ï¼Œè¿™æ¬¡æ¥äº†çš„å•å­åˆæ˜¯SSM+jQueryçš„ï¼Œæˆ‘è¿˜æ˜¯ä¸€å¦‚æ—¢å¾€çš„ä½¿ç”¨å‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯å¥—çš„æ¨¡æ¿ï¼Œå°±ä¸å¾—ä¸è§£å†³è·¨åŸŸå’Œé…ç½®htmlé¡µé¢ã€‚ï¼ˆæ‰‹åŠ¨ç‹—å¤´ï¼‰springbootæ˜¯çœŸé¦™ï¼</strong></p><blockquote><p>å€Ÿé‰´æŸè€å“¥çš„åšæ–‡è§£å†³é—®é¢˜ï¼Œé™„ä¸Šé“¾æ¥ï¼š</p><p><a href="https://my.oschina.net/u/4079187/blog/3160786">Javaå‰åç«¯åˆ†ç¦»SSM+Vueæ¡†æ¶ åç«¯è§£å†³è·¨åŸŸè¯·æ±‚</a></p></blockquote>]]></content>
    
    
    
    <tags>
      
      <tag>SSM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•å®ç°æ–‡ä»¶çš„å®‰å…¨ä¸Šä¼ ï¼Ÿ</title>
    <link href="/2020/11/13/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E7%9A%84%E5%AE%89%E5%85%A8%E4%B8%8A%E4%BC%A0%EF%BC%9F/"/>
    <url>/2020/11/13/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E7%9A%84%E5%AE%89%E5%85%A8%E4%B8%8A%E4%BC%A0%EF%BC%9F/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>é¡¹ç›®ä¸­å¸¸ä¼šé‡åˆ°éœ€è¦æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½çš„åœ°æ–¹ï¼Œå…¶ä¸­æ–‡ä»¶ä¸Šä¼ çš„å®‰å…¨é—®é¢˜ä¸å¯å¿½è§†ï¼Œä¸‹é¢æ˜¯æˆ‘è€ƒè™‘åˆ°çš„æ–‡ä»¶ä¸Šä¼ å®‰å…¨é—®é¢˜å’Œç”¨ç¼–ç å®ç°çš„è¿‡ç¨‹</p><ul><li><p>å¯¹æ–‡ä»¶å¤§å°çš„åˆ¤æ–­ï¼Œé˜²æ­¢æ¶æ„ä¸Šä¼ å¤§æ–‡ä»¶æŒ¤å æœåŠ¡å™¨èµ„æº</p></li><li><p>å¯¹æ–‡ä»¶ç±»å‹çš„åˆ¤æ–­ï¼Œè¿™é‡Œå®ç°çš„æ˜¯å¯¹å›¾ç‰‡çš„åˆ¤æ–­</p></li><li><p>å¯¹å›¾ç‰‡è¿›è¡Œresizeå¤„ç†ï¼Œé˜²æ­¢å›¾ç‰‡åµŒå…¥æ¶æ„å¯æ‰§è¡Œçš„ä»£ç ï¼Œé€šè¿‡å‹ç¼©å¯ä»¥å®ç°å¯¹åµŒå…¥å¯ä»£ç çš„ç ´å</p></li><li><p>æ–‡ä»¶ä¿å­˜çš„åœ°å€æœ‰ä¸¤ç§ï¼Œä¸€ä¸ªå°±æ˜¯å€ŸåŠ©ç¬¬ä¸‰æ–¹æœåŠ¡å™¨è¿›è¡Œä¿å­˜ï¼ˆä¸ƒç‰›äº‘ï¼‰ï¼Œæˆ–è€…æ˜¯æ”¾åœ¨è‡ªå·±çš„æœåŠ¡å™¨ï¼Œåœ¨æˆåŠŸè¯»å–æ–‡ä»¶åï¼Œè¿›è¡Œä¿å­˜çš„æ—¶å€™ï¼Œå¯ä»¥å¯¹æ–‡ä»¶åè¿›è¡Œä¿®æ”¹ï¼Œé‡‡ç”¨éšæœºæ•°ï¼Œä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†å®‰å…¨æ€§</p></li><li><p>æ–‡ä»¶æœåŠ¡å™¨å’Œåº”ç”¨æœåŠ¡å™¨çš„åˆ†å¼€ï¼Œé¿å…å¯¹åº”ç”¨ç¨‹åºçš„ç›´æ¥ç ´å</p></li><li><p>æ–‡ä»¶å¤¹æƒé™çš„è®¾ç½®ï¼Œå¯¹ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶å¤¹è®¾ç½®åªè¯»æƒé™ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢è¿œç«¯ç›´æ¥å¯åŠ¨æœ¨é©¬ç¨‹åº</p></li><li><p>å½“ç„¶ï¼Œå‡å¦‚è¿™ä¸ªåŠŸèƒ½ä¸éœ€è¦ï¼Œç›´æ¥å…³é—­æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ˜¯æœ€å®‰å…¨çš„</p><hr><p>â€‹</p></li></ul><h1 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h1><p>æ­¤Demoå®ç°æ–‡ä»¶ä¸Šä¼ çš„è¯»å–ä¿å­˜ï¼Œå¹¶åœ¨æ•°æ®åº“ä¸­æ’å…¥æ•°æ®</p><p>é¡¹ç›®ç›®å½•</p><p><img src="https://i.loli.net/2020/11/13/6tvGmkhTRHSQq5f.png" alt="6.png"></p><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.dev<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springboot-file-upload-download<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>springboot-file-upload-download<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Demo project for Spring Boot<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- springbootæ•´åˆthymeleaf--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--mysqlè¿æ¥--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--mybatis--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--druid--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--fastjson--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.57<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--thumbnailator--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.coobird<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>thumbnailator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.4.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å•æ–‡ä»¶ä¸Šä¼ çš„æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java">/\*\*<br>\* å•æ–‡ä»¶ä¸Šä¼ <br>\* <span class="hljs-meta">@param</span> file å‰ç«¯ä¼ æ–‡ä»¶çš„å‚æ•°<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-meta">@RequestMapping(&quot;/upload&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">upload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file,HttpServletRequest request)</span> &#123;<br><span class="hljs-type">FileDoc</span> <span class="hljs-variable">fileDoc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileDoc</span>();<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">if</span> (file.isEmpty()) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ–‡ä»¶ä¸ºç©º&quot;</span>;<br>&#125;<br><span class="hljs-comment">//è·å–å¤§å°</span><br><span class="hljs-type">long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> file.getSize();<br>log.info(<span class="hljs-string">&quot;æ–‡ä»¶å¤§å°ï¼š&quot;</span> + size);<br><span class="hljs-comment">//åˆ¤æ–­æ–‡ä»¶ä¸Šä¼ å¤§å°</span><br><span class="hljs-keyword">if</span> (!FileUtils.checkFileSize(file, <span class="hljs-number">20</span>, <span class="hljs-string">&quot;M&quot;</span>)) &#123;<br>log.info(<span class="hljs-string">&quot;ä¸Šä¼ æ–‡ä»¶è§„å®šå°äº20MB&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ä¸Šä¼ æ–‡ä»¶è§„å®šå°äº20MB&quot;</span>;<br>&#125;<br><span class="hljs-comment">//è·å–æ–‡ä»¶å</span><br><span class="hljs-type">String</span> <span class="hljs-variable">filename</span> <span class="hljs-operator">=</span> file.getOriginalFilename();<br>log.info(<span class="hljs-string">&quot;ä¸Šä¼ çš„æ–‡ä»¶åä¸ºï¼š&quot;</span> + filename);<br><span class="hljs-comment">//è·å–æ–‡ä»¶åç¼€å</span><br><span class="hljs-type">String</span> <span class="hljs-variable">suffixName</span> <span class="hljs-operator">=</span> filename.substring(filename.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br>log.info(<span class="hljs-string">&quot;æ–‡ä»¶çš„ååç¼€åï¼š&quot;</span> + suffixName);<br><span class="hljs-comment">//è‹¥è¦åˆ¤æ–­æ–‡ä»¶ä¸Šä¼ çš„ç±»å‹ï¼Œ</span><br><span class="hljs-comment">//ç”Ÿæˆæ–°æ–‡ä»¶å 6ä½éšæœºæ•°+æ–‡ä»¶åç¼€å</span><br>fileDoc.setFile\_name(CodeGenerateUtil.generateVerCode(<span class="hljs-number">6</span>).toString()+suffixName);<br><span class="hljs-comment">//æ‹¿åˆ°ipåœ°å€</span><br>fileDoc.setIp\_addr(request.getRemoteAddr());<br><span class="hljs-type">File</span> <span class="hljs-variable">dest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(FILEPATH+fileDoc.getFile\_name());<br><span class="hljs-comment">//æ£€æµ‹ç›®å½•æ˜¯å¦å­˜åœ¨</span><br><span class="hljs-keyword">if</span> (!dest.getParentFile().exists()) &#123;<br>dest.getParentFile().mkdirs(); <span class="hljs-comment">//æ–°å»ºæ–‡ä»¶å¤¹</span><br>&#125;<br>file.transferTo(dest); <span class="hljs-comment">//æ–‡ä»¶å†™å…¥</span><br><span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> fileDocService.uploadFile(fileDoc);<br><span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>)&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ&quot;</span>;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;</span>;<br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> (IllegalStateException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>FileUtils.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.dev.util;<br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<br>/\*\*<br>\* <span class="hljs-meta">@author</span> è·¯é£<br>\* <span class="hljs-meta">@create</span> <span class="hljs-number">2020</span>/<span class="hljs-number">11</span>/<span class="hljs-number">1</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileUtils</span> &#123;<br>/\*\*<br>\*æ£€æŸ¥æ–‡ä»¶å¤§å°<br>\* <span class="hljs-meta">@param</span> file<br>\* <span class="hljs-meta">@param</span> size<br>\* <span class="hljs-meta">@param</span> unit<br>\* <span class="hljs-meta">@return</span><br>\*/<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkFileSize</span><span class="hljs-params">(MultipartFile file,<span class="hljs-type">int</span> size,String unit)</span>&#123;<br><span class="hljs-type">long</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> file.getSize();<br><span class="hljs-type">double</span> <span class="hljs-variable">fileSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;B&quot;</span>.equals(unit.toUpperCase()))&#123;<br>fileSize = len;<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;k&quot;</span>.equals(unit.toUpperCase()))&#123;<br>fileSize = (<span class="hljs-type">double</span>)len / <span class="hljs-number">1024</span>;<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;M&quot;</span>.equals(unit.toUpperCase()))&#123;<br>fileSize = (<span class="hljs-type">double</span>)len / <span class="hljs-number">1048576</span>;<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;G&quot;</span>.equals(unit.toUpperCase()))&#123;<br>fileSize = (<span class="hljs-type">double</span>)len / <span class="hljs-number">1073741824</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (fileSize &gt; size)&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾ï¼š</p><p><img src="https://i.loli.net/2020/11/13/bHWRD5MVKsIwO6x.png" alt="7.png"></p><p><img src="https://i.loli.net/2020/11/13/huk9BKjNdFGzCi8.png" alt="8.png"></p><p>æµ‹è¯•è¶…è¿‡ä¸Šä¼ è¦æ±‚çš„æ–‡ä»¶</p><p><img src="https://i.loli.net/2020/11/13/A1CltTnEcI9osdK.png" alt="9.png"></p><p>æµ‹è¯•å¤šæ–‡ä»¶ä¸Šä¼ </p><p><img src="https://i.loli.net/2020/11/13/xoJy9XGELbH7p6s.png" alt="10.png"></p><p>åœ¨è¿›è¡Œå¤šæ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™ï¼Œä¼šå¯¹æ¯ä¸ªæ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼Œä¸ç¬¦åˆä¸Šä¼ è¦æ±‚çš„ä¼šç›´æ¥è¿”å›</p><p><img src="https://i.loli.net/2020/11/13/9DhWgztXnkfKYSr.png" alt="11.png"></p><p>æµ‹è¯•æ–‡ä»¶ä¸‹è½½å°±ä¸æµ‹è¯•äº†ï¼Œè¿™é‡Œæä¾›ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§å°±æ˜¯ç›´æ¥åˆ©ç”¨IOç›´æ¥è¯»å–æ–‡ä»¶ï¼Œè¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œç¬¬äºŒç§å°±æ˜¯ç›´æ¥åˆ©ç”¨springbootçš„èµ„æºæ˜ å°„é…ç½®ç±»ï¼ŒæŠŠæœåŠ¡å™¨çš„æ–‡ä»¶èµ„æºæ˜ å°„åˆ°äº’è”ç½‘ä¸Šï¼Œç›´æ¥è¯·æ±‚è·¯å¾„å³å¯ä¸‹è½½æ–‡ä»¶</p><p>WebMvcConfigurer.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;<br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcConfigurer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebMvcConfigurerAdapter</span> &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> &#123;<br><span class="hljs-comment">//å’Œé¡µé¢æœ‰å…³çš„é™æ€ç›®å½•éƒ½æ”¾åœ¨é¡¹ç›®çš„staticç›®å½•ä¸‹</span><br>registry.addResourceHandler(<span class="hljs-string">&quot;/static/\*\*&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:/static/&quot;</span>);<br><span class="hljs-comment">//ä¸Šä¼ çš„å›¾ç‰‡åœ¨Cç›˜ä¸‹çš„imageç›®å½•ä¸‹ï¼Œè®¿é—®è·¯å¾„å¦‚ï¼šhttps://localhost:443/image/d3cf0281-bb7f-40e0-ab77-406db95ccf2c.jpg</span><br><span class="hljs-comment">//å…¶ä¸­OTAè¡¨ç¤ºè®¿é—®çš„å‰ç¼€ã€‚&quot;file:D:/OTA/&quot;æ˜¯æ–‡ä»¶çœŸå®çš„å­˜å‚¨è·¯å¾„</span><br>registry.addResourceHandler(<span class="hljs-string">&quot;/image/\*\*&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;file:C:/image/&quot;</span>);<br>registry.addResourceHandler(<span class="hljs-string">&quot;/lost/\*\*&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;file:C:/lost/&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åï¼Œæ˜¯å¯¹å›¾ç‰‡ä¸Šä¼ çš„æµ‹è¯•ï¼Œè¿™é‡Œå¼•å…¥<strong>è°·æ­Œçš„Thumbnailator</strong>ï¼Œå¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©å¤„ç†ï¼Œç ´åæ‰åµŒå…¥å¯æ‰§è¡Œä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/uploadImage&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">upload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file, HttpServletRequest request)</span> &#123;<br><span class="hljs-type">FileDoc</span> <span class="hljs-variable">fileDoc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileDoc</span>();<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">if</span> (file.isEmpty()) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ–‡ä»¶ä¸ºç©º&quot;</span>;<br>&#125;<br><span class="hljs-comment">//è·å–å¤§å°</span><br><span class="hljs-type">long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> file.getSize();<br>log.info(<span class="hljs-string">&quot;æ–‡ä»¶å¤§å°ï¼š&quot;</span> + size);<br><span class="hljs-comment">//åˆ¤æ–­æ–‡ä»¶ä¸Šä¼ å¤§å°</span><br><span class="hljs-keyword">if</span> (!FileUtils.checkFileSize(file, <span class="hljs-number">10</span>, <span class="hljs-string">&quot;M&quot;</span>)) &#123;<br>log.info(<span class="hljs-string">&quot;ä¸Šä¼ æ–‡ä»¶è§„å®šå°äº10MB&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ä¸Šä¼ æ–‡ä»¶è§„å®šå°äº10MB&quot;</span>;<br>&#125;<br><span class="hljs-comment">//è·å–æ–‡ä»¶å</span><br><span class="hljs-type">String</span> <span class="hljs-variable">filename</span> <span class="hljs-operator">=</span> file.getOriginalFilename();<br>log.info(<span class="hljs-string">&quot;ä¸Šä¼ çš„æ–‡ä»¶åä¸ºï¼š&quot;</span> + filename);<br><span class="hljs-comment">//è·å–æ–‡ä»¶åç¼€å</span><br><span class="hljs-type">String</span> <span class="hljs-variable">suffixName</span> <span class="hljs-operator">=</span> filename.substring(filename.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br>log.info(<span class="hljs-string">&quot;æ–‡ä»¶çš„ååç¼€åï¼š&quot;</span> + suffixName);<br><span class="hljs-comment">//åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸ºå›¾ç‰‡</span><br><span class="hljs-keyword">if</span> (!ImageTypeUtils.checkImageUtils(suffixName))&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è¯·ä¸Šä¼ å›¾ç‰‡æ ¼å¼ä¸ºjpg,png,gifçš„å›¾ç‰‡&quot;</span>;<br>&#125;<br><span class="hljs-comment">//ç”Ÿæˆæ–°æ–‡ä»¶å 6ä½éšæœºæ•°+æ–‡ä»¶åç¼€å</span><br>fileDoc.setFile\_name(CodeGenerateUtil.generateVerCode(<span class="hljs-number">6</span>).toString()+suffixName);<br><span class="hljs-comment">//æ‹¿åˆ°ipåœ°å€</span><br>fileDoc.setIp\_addr(request.getRemoteAddr());<br><span class="hljs-type">File</span> <span class="hljs-variable">dest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(FILEPATH+fileDoc.getFile\_name());<br><span class="hljs-comment">//æ£€æµ‹ç›®å½•æ˜¯å¦å­˜åœ¨</span><br><span class="hljs-keyword">if</span> (!dest.getParentFile().exists()) &#123;<br>dest.getParentFile().mkdirs(); <span class="hljs-comment">//æ–°å»ºæ–‡ä»¶å¤¹</span><br>&#125;<br>file.transferTo(dest); <span class="hljs-comment">//æ–‡ä»¶å†™å…¥</span><br><span class="hljs-comment">//åˆ©ç”¨Thumbnailså¯¹å›¾ç‰‡è¿›è¡Œresize</span><br>Thumbnails.of(FILEPATH+fileDoc.getFile\_name())<br>.scale(<span class="hljs-number">1f</span>)<br>.outputQuality(<span class="hljs-number">0.7F</span>)<br>.toFile(FILEPATH+fileDoc.getFile\_name());<br>log.info(<span class="hljs-string">&quot;å›¾ç‰‡å‹ç¼©æˆåŠŸ&quot;</span>);<br><span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> fileDocService.uploadFile(fileDoc);<br><span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>)&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸ&quot;</span>;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;</span>;<br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> (IllegalStateException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Thumbnailsçš„ä½¿ç”¨æ–¹æ³•</p><p>scale: æŒ‰ç…§æ¯”ä¾‹è¿›è¡Œç¼©æ”¾ã€‚èŒƒå›´ï¼š0.0~Nã€‚<br>scale(0.5) å®½é«˜æ¯”ä¾‹éƒ½æ˜¯50%ç¼©æ”¾ , scale(1,0.5) å®½ä¸å˜ï¼Œé«˜ä¸º50%ç¼©æ”¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Thumbnails.of(<span class="hljs-string">&quot;åŸå›¾æ–‡ä»¶çš„è·¯å¾„&quot;</span>)<br>.scale(<span class="hljs-number">1F</span>) <span class="hljs-comment">//1Fä¸ç¼©æ”¾</span><br>.outputQuality(<span class="hljs-number">0.7F</span>) <span class="hljs-comment">//å›¾ç‰‡å“è´¨ 0-1 é è¿‘1è´¨é‡è¶Šé«˜</span><br>.watermark(Positions.BOTTOM\_RIGHT, ImageIO.read(æ°´å°), <span class="hljs-number">0.5f</span>)<br>.toFile(<span class="hljs-string">&quot;è½¬æ¢åæ–‡ä»¶çš„è·¯å¾„&quot;</span>);<br></code></pre></td></tr></table></figure><p>æ ¼å¼çš„æ ¡éªŒ</p><p><img src="https://i.loli.net/2020/11/13/3sAU7TO5h8iYVNI.png" alt="12.png"></p><p>æˆåŠŸä¸Šä¼ åä¼šå¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©</p><p><img src="https://i.loli.net/2020/11/13/W2lPQuxYpR9XqAN.png" alt="13.png"></p><p>è‡ªå·±å†™çš„ä¸€ä¸ªç®€å•çš„Demoï¼Œæœªè€ƒè™‘çš„å®‰å…¨é—®é¢˜è¿˜æœ‰å¾ˆå¤šï¼Œå¯¹Javaåˆå­¦è€…åº”è¯¥ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚</p><p>è¯¦ç»†ä»£ç è§Githubï¼š</p><p><a href="https://github.com/luffy997/springboot-file-upload-download">Githubé¡¹ç›®åœ°å€</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>ç½‘å®‰</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>api-design-demo åç«¯å¿«é€Ÿå¼€å‘è„šæ‰‹æ¶</title>
    <link href="/2020/10/31/api-design-demo-%E5%90%8E%E7%AB%AF%E5%BF%AB%E9%80%9F%E5%BC%80%E5%8F%91%E8%84%9A%E6%89%8B%E6%9E%B6/"/>
    <url>/2020/10/31/api-design-demo-%E5%90%8E%E7%AB%AF%E5%BF%AB%E9%80%9F%E5%BC%80%E5%8F%91%E8%84%9A%E6%89%8B%E6%9E%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1.ä»‹ç»"></a>1.ä»‹ç»</h1><ul><li><strong>api-design-demo</strong>æ˜¯æˆ‘å¯¹ä¹‹å‰æ‰€å­¦æ¡†æ¶çš„ä¸€ä¸ªæ•´åˆï¼ŒåŸºäºSpringBootæ•´åˆMybatis,Redis,Shiroï¼ŒèåˆSwaggeråšæ¥å£æ–‡æ¡£ï¼Œè¿ç”¨JSR303åšæ•°æ®æ ¡éªŒ,åˆ©ç”¨MybatisPlusç®€åŒ–æ•°æ®è®¿é—®å±‚çš„æ“ä½œï¼Œåˆ©ç”¨AutoGeneratorè‡ªåŠ¨ä»£ç ç”Ÿæˆå™¨ï¼Œå‡å°‘ä»£ç çš„ç¼–å†™ï¼Œæ›´åŠ ä¸“æ³¨ä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼Œä»è€Œæé«˜å¼€å‘æ•ˆç‡ã€‚</li><li>è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Œä½¿<strong>controller</strong>å±‚å§‹ç»ˆèƒ½è¿”å›ç»™å‰ç«¯æ ‡å‡†å“åº”çŠ¶æ€</li></ul><h1 id="2-é¡¹ç›®ç»“æ„"><a href="#2-é¡¹ç›®ç»“æ„" class="headerlink" title="2.é¡¹ç›®ç»“æ„"></a>2.é¡¹ç›®ç»“æ„</h1><p><strong>api-design-demo</strong> â€”-<strong>src</strong> â€” <strong>config</strong></p><p>â€‹ <strong>enums</strong></p><p>â€‹ <strong>handler</strong></p><p>â€‹ <strong>exception</strong></p><p>â€‹ <strong>handler</strong></p><p>â€‹ <strong>shiro</strong></p><p>â€‹ <strong>util</strong></p><p>â€‹ <strong>vo</strong></p><p>â€‹ <strong>resources</strong></p><p>â€‹ <strong>test</strong></p><h1 id="3-ä½¿ç”¨æ–¹å¼"><a href="#3-ä½¿ç”¨æ–¹å¼" class="headerlink" title="3.ä½¿ç”¨æ–¹å¼"></a>3.ä½¿ç”¨æ–¹å¼</h1><ul><li>åœ¨resourcesçš„sqlä¸‹æ‰¾åˆ°æ•°æ®åº“æ–‡ä»¶users.sqlï¼Œå¯¼å…¥æ•°æ®åº“</li><li>åœ¨resourcesçš„application-dev.propertiesä¸‹é…ç½®Mysqlå’ŒRedis</li><li>é…ç½®scrä¸‹çš„utilé‡Œçš„DevGeneratorç±»ä¸­çš„æ•°æ®æºå‚æ•°ï¼Œè¿è¡Œè¯¥ç±»å³å¯è‡ªåŠ¨ç”Ÿæˆå®ä½“ç±»ï¼Œæ•°æ®è®¿é—®å±‚ï¼ŒæœåŠ¡å±‚ï¼ŒæœåŠ¡å®ç°å±‚ï¼Œæ§åˆ¶å™¨å±‚</li><li>configåŒ…ä¸‹é…ç½®äº†è·¨åŸŸï¼ŒDruidï¼Œå…¨å±€å¼‚å¸¸å¤„ç†ï¼ŒMybatisPlusï¼ŒRedisï¼Œå“åº”çŠ¶æ€å¤„ç†ï¼ŒShrioï¼ŒSwaggerï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œå¼€å¯æ˜¯å¦ä½¿ç”¨ä»–ä»¬</li></ul><h1 id="4-æµ‹è¯•"><a href="#4-æµ‹è¯•" class="headerlink" title="4. æµ‹è¯•"></a>4. æµ‹è¯•</h1><ol><li>æµ‹è¯•æŸ¥è¯¢æ•°æ®</li></ol><p><img src="https://i.loli.net/2020/11/01/aZkHCBVlXN7ohQb.png"></p><p>â€‹ 2. æµ‹è¯•æ·»åŠ æ•°æ®</p><p><img src="https://i.loli.net/2020/11/01/HpjCSVZrt9uhGwc.png"></p><p>â€‹ å½“æ·»åŠ æ˜¯æ•°æ®ä¸æ»¡è¶³æ ¼å¼æ—¶ï¼Œåˆ™ä¼šè¿”å›æ ¡éªŒç»“æœ</p><p><img src="https://i.loli.net/2020/11/01/85KTlUbW2sV1uaB.png"></p><h1 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5.æ€»ç»“"></a>5.æ€»ç»“</h1><p>è‡ªæ­¤æ•´ä¸ªåç«¯æ¥å£åŸºæœ¬ä½“ç³»å°±æ„å»ºå®Œæ¯•äº†</p><ul><li>é€šè¿‡Validator + è‡ªåŠ¨æŠ›å‡ºå¼‚å¸¸æ¥å®Œæˆäº†æ–¹ä¾¿çš„å‚æ•°æ ¡éªŒ</li><li>é€šè¿‡å…¨å±€å¼‚å¸¸å¤„ç† + è‡ªå®šä¹‰å¼‚å¸¸å®Œæˆäº†å¼‚å¸¸æ“ä½œçš„è§„èŒƒ</li><li>é€šè¿‡æ•°æ®ç»Ÿä¸€å“åº”å®Œæˆäº†å“åº”æ•°æ®çš„è§„èŒƒ</li><li>å¤šä¸ªæ–¹é¢ç»„è£…éå¸¸ä¼˜é›…çš„å®Œæˆäº†åç«¯æ¥å£çš„åè°ƒï¼Œè®©å¼€å‘äººå‘˜æœ‰æ›´å¤šçš„ç»å†æ³¨é‡ä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œè½»æ¾æ„å»ºåç«¯æ¥å£</li><li>æ•´åˆMybatisï¼ŒRedisï¼ŒShiroï¼Œå¸®ä½ å¿«é€Ÿæ­å»ºå¼€å‘ç¯å¢ƒ</li></ul><p>é¡¹ç›®ä½“ç³»è¯¥æ€ä¹ˆæ„å»ºã€åç«¯æ¥å£è¯¥æ€ä¹ˆå†™éƒ½æ²¡æœ‰ä¸€ä¸ªç»å¯¹ç»Ÿä¸€çš„æ ‡å‡†ï¼Œä¸æ˜¯è¯´ä¸€å®šè¦æŒ‰ç…§æœ¬æ–‡çš„æ¥æ‰æ˜¯æœ€å¥½çš„ï¼Œä½ æ€æ ·éƒ½å¯ä»¥ã€‚</p><p>æœ€ååœ¨è¿™é‡Œæ”¾ä¸Šæ­¤é¡¹ç›®çš„<a href="https://github.com/luffy997/api-design-demo">githubåœ°å€</a>ï¼Œcloneåˆ°æœ¬åœ°å³å¯ç›´æ¥è¿è¡Œã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é˜¿é‡Œäº‘éƒ¨ç½²SpringBooté¡¹ç›®(å†…ç½®Tomcat)ï¼Œé…ç½®httpsï¼Œé…ç½®é‚®ç®±ç«¯å£465ï¼ŒæˆåŠŸéƒ¨ç½²å‘å¸ƒ</title>
    <link href="/2020/10/15/%E9%98%BF%E9%87%8C%E4%BA%91%E9%83%A8%E7%BD%B2SpringBoot%E9%A1%B9%E7%9B%AE-%E5%86%85%E7%BD%AETomcat-%EF%BC%8C%E9%85%8D%E7%BD%AEhttps%EF%BC%8C%E9%85%8D%E7%BD%AE%E9%82%AE%E7%AE%B1%E7%AB%AF%E5%8F%A3465%EF%BC%8C%E6%88%90%E5%8A%9F%E9%83%A8%E7%BD%B2%E5%8F%91%E5%B8%83/"/>
    <url>/2020/10/15/%E9%98%BF%E9%87%8C%E4%BA%91%E9%83%A8%E7%BD%B2SpringBoot%E9%A1%B9%E7%9B%AE-%E5%86%85%E7%BD%AETomcat-%EF%BC%8C%E9%85%8D%E7%BD%AEhttps%EF%BC%8C%E9%85%8D%E7%BD%AE%E9%82%AE%E7%AE%B1%E7%AB%AF%E5%8F%A3465%EF%BC%8C%E6%88%90%E5%8A%9F%E9%83%A8%E7%BD%B2%E5%8F%91%E5%B8%83/</url>
    
    <content type="html"><![CDATA[<h2 id="é…ç½®https"><a href="#é…ç½®https" class="headerlink" title="é…ç½®https"></a>é…ç½®https</h2><p>æˆ‘æ˜¯é˜¿é‡Œäº‘çš„æœåŠ¡å™¨ï¼Œé‡Œé¢æœ‰ä¸ªç™½å«–çš„SSLè¯ä¹¦ï¼Œç”³è¯·æˆåŠŸåæŠŠå®ƒå’ŒåŸŸåç»‘å®šå°±è¡Œï¼Œå†ä¸‹è½½è¯ä¹¦å°±è¡Œäº†ã€‚</p><p>å› ä¸ºæˆ‘ç”¨çš„å†…ç½®çš„Tomcatï¼Œæ‰€ä»¥ä¸‹è½½çš„è¿˜æ˜¯Tomcatçš„è¯ä¹¦ï¼š</p><p><img src="https://i.loli.net/2020/10/16/H8lYFgCXKkQbPjw.png"></p><p>ç°åœ¨å°±æ˜¯é…é¡¹ç›®é…ç½®httpsï¼Œæˆ‘çš„springbootç‰ˆæœ¬æ˜¯1.5.10.RELEASEï¼Œ2.0Xç‰ˆæœ¬çš„å°±ä¸çŸ¥é“äº†ï¼Œæˆ‘è¿™ä¸ªé…ç½®å¾ˆç®€å•ï¼Œæ”¾åˆ°resourcesæ˜¯æ–‡ä»¶å¤¹ä¸‹å°±è¡Œäº†</p><p><img src="https://i.loli.net/2020/10/16/78kj2Fx635gilI4.png"></p><h2 id="åœ¨application-propertiesä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼Œè®©é¡¹ç›®åŠ è½½ssl"><a href="#åœ¨application-propertiesä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼Œè®©é¡¹ç›®åŠ è½½ssl" class="headerlink" title="åœ¨application.propertiesä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼Œè®©é¡¹ç›®åŠ è½½ssl"></a>åœ¨application.propertiesä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼Œè®©é¡¹ç›®åŠ è½½ssl</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#httpsé…ç½®</span><br><span class="hljs-attr">server.port</span>=<span class="hljs-string">443</span><br><span class="hljs-attr">server.ssl.key-store</span>=<span class="hljs-string">classpath:3904483\_www.XXXXX.top.pfx</span><br><span class="hljs-attr">server.ssl.key-store-password</span>=<span class="hljs-string">XXXXX</span><br><span class="hljs-attr">server.ssl.keyStoreType</span>=<span class="hljs-string">PKCS12</span><br><span class="hljs-attr">server.ssl.enabled</span>=<span class="hljs-string">true</span><br></code></pre></td></tr></table></figure><p>å°±å®Œæˆäº†ï¼Œå› ä¸ºhttpsåè®®é»˜è®¤æ˜¯443ç«¯å£æ‰€ä»¥æˆ‘æŠŠé¡¹ç›®ç«¯å£æ”¹æˆ443ï¼Œè¿™æ ·å°±ä¸ç”¨é…ç½®hhtpè½¬httpsäº†ã€‚</p><p>å…¶å®åˆ°mavenæ‰“åŒ…ï¼Œå°±å¯ä»¥éƒ¨ç½²äº†ï¼Œä½†é¡¹ç›®é‡Œæœ‰ä¸ªå‘é€é‚®ä»¶çš„ï¼Œé»˜è®¤æ˜¯25ç«¯å£ï¼Œè¿™ä¸ªå›½å†…çš„æœåŠ¡å™¨ç›´æ¥å°±ç¦ç”¨äº†25ç«¯å£ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬æ”¹ç«¯å£æˆ–è€…ç”³è¯·è§£å°25ç«¯å£ï¼Œä¸€ä¸ªå¤§å­¦ç”Ÿç”³è¯·æ²¡å•¥ææ–™è‚¯å®šæ˜¯ä¸ä¼šé€šè¿‡äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é€‰æ‹©æ”¹ç«¯å£å°±å¯ä»¥äº†ã€‚</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#é…ç½®é‚®ç®±</span><br><span class="hljs-attr">spring.mail.username</span>=<span class="hljs-string">your maill</span><br><span class="hljs-attr">spring.mail.password</span>=<span class="hljs-string"></span><br><span class="hljs-attr">spring.mail.host</span>=<span class="hljs-string"></span><br><span class="hljs-comment">#SSLè¯ä¹¦Socketå·¥å‚</span><br><span class="hljs-attr">spring.mail.properties.mail.smtp.socketFactory.class</span>=<span class="hljs-string">javax.net.ssl.SSLSocketFactory</span><br><span class="hljs-comment">#ä½¿ç”¨SMTPSåè®®465ç«¯å£</span><br><span class="hljs-attr">spring.mail.properties.mail.smtp.socketFactory.port</span>=<span class="hljs-string">465</span><br><span class="hljs-attr">spring.mail.properties.mail.smtp.auth</span>=<span class="hljs-string">true</span><br><span class="hljs-attr">spring.mail.properties.mail.smtp.starttls.enable</span>=<span class="hljs-string">true</span><br><span class="hljs-attr">spring.mail.properties.mail.smtp.starttls.required</span>=<span class="hljs-string">true</span><br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºä¸€ä¸ªSSLSocketFactory"><a href="#åˆ›å»ºä¸€ä¸ªSSLSocketFactory" class="headerlink" title="åˆ›å»ºä¸€ä¸ªSSLSocketFactory"></a>åˆ›å»ºä¸€ä¸ªSSLSocketFactory</h2><p>ä¹‹å‰å°±æ²¡æœ‰ï¼Œæ‰€ä»¥å°±æ²¡æœ‰æŠŠç«¯å£å·æ”¹æˆ465,è¿™æ ·æˆ‘ä»¬çš„é¡¹ç›®å°±å®Œæˆé…ç½®httpsï¼Œä¿®æ”¹é‚®ä»¶ç«¯å£ï¼Œæœ€åæ‰“åŒ…å‘å¸ƒå°±è¡Œäº†;</p><p><img src="https://i.loli.net/2020/10/16/HYPjROv9mCcrI3S.png"></p><h2 id="æŠŠåŸŸåäº¤ç»™å‰ç«¯-å¾®ä¿¡å°ç¨‹åº-ï¼šhttps-è‡ªå·±çš„åŸŸå"><a href="#æŠŠåŸŸåäº¤ç»™å‰ç«¯-å¾®ä¿¡å°ç¨‹åº-ï¼šhttps-è‡ªå·±çš„åŸŸå" class="headerlink" title="æŠŠåŸŸåäº¤ç»™å‰ç«¯(å¾®ä¿¡å°ç¨‹åº)ï¼šhttps:&#x2F;&#x2F;è‡ªå·±çš„åŸŸå"></a>æŠŠåŸŸåäº¤ç»™å‰ç«¯(å¾®ä¿¡å°ç¨‹åº)ï¼šhttps:&#x2F;&#x2F;è‡ªå·±çš„åŸŸå</h2><p>è¿™é‡Œæ”¶è—ä¸€ç¯‡å¥½çš„åšæ–‡ï¼š<a href="https://blog.csdn.net/weixin_40593587/article/details/89812619?utm_medium=distribute.pc_relevant.none-task-blog-OPENSEARCH-1.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-OPENSEARCH-1.nonecase">springbootä½¿ç”¨465ç«¯å£å‘é€é‚®ä»¶</a></p><p>æ³¨ï¼šé˜¿é‡Œäº‘çš„ç«¯å£å‡ ä¹éƒ½æ˜¯è¢«é˜²ç«å¢™å…³é—­äº†çš„ï¼Œå¼€å¯ç«¯å£éœ€è¦é…ç½®ç›¸åº”å®ä¾‹çš„å®‰å…¨ç»„ï¼Œä¸ç„¶ä¼šè®¿é—®ä¸åˆ°çš„ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexoå¸¸ç”¨å‘½ä»¤</title>
    <link href="/2020/10/14/hexo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2020/10/14/hexo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h1 id="hexoå¸¸ç”¨å‘½ä»¤"><a href="#hexoå¸¸ç”¨å‘½ä»¤" class="headerlink" title="hexoå¸¸ç”¨å‘½ä»¤"></a>hexoå¸¸ç”¨å‘½ä»¤</h1><ol><li>åˆå§‹åŒ–hexo</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain"># hexo init<br></code></pre></td></tr></table></figure><ol start="2"><li>å¯åŠ¨hexo</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain"># hexo s<br></code></pre></td></tr></table></figure><ol start="3"><li>æ¸…æ¥šç¼“å­˜</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain"># hexo clean<br></code></pre></td></tr></table></figure><ol start="4"><li>ç”Ÿæˆé™æ€ç½‘ç«™</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain"># hexo g<br></code></pre></td></tr></table></figure><ol start="5"><li>å°†ç°åœ¨çš„æ–‡ä»¶éƒ¨ç½²åˆ°è¿œç«¯</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain"># hexo d<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2020/10/10/hello-world/"/>
    <url>/2020/10/10/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
